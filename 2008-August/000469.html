<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Griffith-svn] r988 - branches/0.9.x/glade branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk/glade trunk/lib	trunk/lib/plugins/movie
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/griffith-svn/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r988%20-%20branches/0.9.x/glade%20branches/0.9.x/lib%0A%09branches/0.9.x/lib/plugins/movie%20trunk/glade%20trunk/lib%0A%09trunk/lib/plugins/movie&In-Reply-To=%3C200808161521.m7GFL9hV013976%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000470.html">
   <LINK REL="Next"  HREF="000467.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Griffith-svn] r988 - branches/0.9.x/glade branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk/glade trunk/lib	trunk/lib/plugins/movie</H1>
    <B>mikej06 at mail.berlios.de</B> 
    <A HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r988%20-%20branches/0.9.x/glade%20branches/0.9.x/lib%0A%09branches/0.9.x/lib/plugins/movie%20trunk/glade%20trunk/lib%0A%09trunk/lib/plugins/movie&In-Reply-To=%3C200808161521.m7GFL9hV013976%40sheep.berlios.de%3E"
       TITLE="[Griffith-svn] r988 - branches/0.9.x/glade branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk/glade trunk/lib	trunk/lib/plugins/movie">mikej06 at mail.berlios.de
       </A><BR>
    <I>Sat Aug 16 17:21:09 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000470.html">[Griffith-svn] r987 - branches/0.9.x	branches/0.9.x/lib/plugins/movie trunk trunk/lib/plugins/movie
</A></li>
        <LI>Next message: <A HREF="000467.html">[Griffith-svn] r989 - in trunk: . lib/plugins/movie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#469">[ date ]</a>
              <a href="thread.html#469">[ thread ]</a>
              <a href="subject.html#469">[ subject ]</a>
              <a href="author.html#469">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mikej06
Date: 2008-08-16 17:20:49 +0200 (Sat, 16 Aug 2008)
New Revision: 988

Added:
   branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
   trunk/lib/plugins/movie/PluginMovieAmazon.py
Modified:
   branches/0.9.x/glade/griffith.glade
   branches/0.9.x/lib/add.py
   branches/0.9.x/lib/amazon.py
   branches/0.9.x/lib/edit.py
   branches/0.9.x/lib/test_movieplugins.py
   trunk/glade/griffith.glade
   trunk/lib/add.py
   trunk/lib/amazon.py
   trunk/lib/edit.py
   trunk/lib/test_movieplugins.py
Log:
* added Amazon plugin (supports search by UPC/EAN)
* added Amazon language support for CA and FR
* Amazon support is now closer to the current specification

Modified: branches/0.9.x/glade/griffith.glade
===================================================================
--- branches/0.9.x/glade/griffith.glade	2008-08-16 15:09:30 UTC (rev 987)
+++ branches/0.9.x/glade/griffith.glade	2008-08-16 15:20:49 UTC (rev 988)
@@ -5396,6 +5396,8 @@
                                     &lt;property name=&quot;items&quot;&gt;US
 UK
 DE
+CA
+FR
 JP&lt;/property&gt;
                                   &lt;/widget&gt;
                                   &lt;packing&gt;

Modified: branches/0.9.x/lib/add.py
===================================================================
--- branches/0.9.x/lib/add.py	2008-08-16 15:09:30 UTC (rev 987)
+++ branches/0.9.x/lib/add.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -494,6 +494,8 @@
 	plugin = __import__(plugin_name)
 	self.movie = plugin.Plugin(m_id)
 	self.movie.locations = self.locations
+	self.movie.debug = self.debug
+	self.movie.config = self.config
 	
 	fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
 				'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
@@ -593,6 +595,8 @@
 		plugin_name = 'PluginMovie%s' % option
 		plugin = __import__(plugin_name)
 		self.search_movie = plugin.SearchPlugin()
+		self.search_movie.debug = self.debug
+		self.search_movie.config = self.config
 		if o_title:
 			self.search_movie.url = self.search_movie.original_url_search
 			if self.search_movie.remove_accents:

Modified: branches/0.9.x/lib/amazon.py
===================================================================
--- branches/0.9.x/lib/amazon.py	2008-08-16 15:09:30 UTC (rev 987)
+++ branches/0.9.x/lib/amazon.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -85,6 +85,8 @@
 ASSOCIATE = &quot;webservices-20&quot;
 HTTP_PROXY = None
 LOCALE = &quot;us&quot;
+# default API version is from 2005-10-05
+APIVERSION='2008-06-26'
 
 # don't touch the rest of these constants
 class AmazonError(Exception): pass
@@ -220,27 +222,38 @@
             rc = int(rc)
     return rc
 
-def buildURL(search_type, keyword, product_line, type, page, license_key, locale, associate):
+def buildURL(search_type, searchfield, searchvalue, product_line, type, page, license_key, locale, associate):
     _checkLocaleSupported(locale)
     url = &quot;<A HREF="http://">http://</A>&quot; + _supportedLocales[locale][1]
-    url += &quot;&amp;AssociateTag=%s&quot; % associate
-    url += &quot;&amp;AWSAccessKeyId=%s&quot; % license_key.strip()
-    url += &quot;&amp;ResponseGroup=%s&quot; % type
-    #if _supportedLocales[locale][0]:
-    #    url += &quot;&amp;locale=%s&quot; % _supportedLocales[locale][0]
-    #if page:
-    #    url += &quot;&amp;page=%s&quot; % page
-    if product_line:
-        url += &quot;&amp;SearchIndex=%s&quot; % product_line
-    url += &quot;&amp;Operation=%s&quot; % search_type
-    url += &quot;&amp;Keywords=%s&quot; % urllib.quote(keyword)
+    if search_type == 'ItemLookup':
+        url += &quot;&amp;AssociateTag=%s&quot; % associate
+        url += &quot;&amp;AWSAccessKeyId=%s&quot; % license_key.strip()
+        url += &quot;&amp;ResponseGroup=%s&quot; % type
+        if product_line:
+            url += &quot;&amp;SearchIndex=%s&quot; % product_line
+        url += &quot;&amp;Operation=%s&quot; % search_type
+        url += &quot;&amp;IdType=%s&quot; % searchfield
+        url += &quot;&amp;ItemId=%s&quot; % searchvalue
+    else:
+        url += &quot;&amp;AssociateTag=%s&quot; % associate
+        url += &quot;&amp;AWSAccessKeyId=%s&quot; % license_key.strip()
+        url += &quot;&amp;ResponseGroup=%s&quot; % type
+        if page:
+            url += &quot;&amp;ItemPage=%s&quot; % page
+        if product_line:
+            url += &quot;&amp;SearchIndex=%s&quot; % product_line
+        url += &quot;&amp;Operation=%s&quot; % search_type
+        url += &quot;&amp;%s=%s&quot; % (searchfield, urllib.quote(searchvalue))
+        url += &quot;&amp;Sort=titlerank&quot;
+    if not APIVERSION is None:
+        url += &quot;&amp;Version=%s&quot; % APIVERSION
     return url
 
 
 ## main functions
 
 
-def search(search_type, keyword, product_line, type = &quot;Large&quot;, page = None,
+def search(search_type, searchfield, searchvalue, product_line, type = &quot;Large&quot;, page = None,
            license_key=None, http_proxy = None, locale = None, associate = None):
     &quot;&quot;&quot;search Amazon
 
@@ -289,7 +302,7 @@
     license_key = getLicense(license_key)
     locale = getLocale(locale)
     associate = getAssociate(associate)
-    url = buildURL(search_type, keyword, product_line, type, page, 
+    url = buildURL(search_type, searchfield, searchvalue, product_line, type, page, 
             license_key, locale, associate)
     proxies = getProxies(http_proxy)
     u = urllib.FancyURLopener(proxies)
@@ -300,67 +313,80 @@
 #     PrettyPrint(xmldoc)
 
     usock.close()
+    data = unmarshal(xmldoc)
     if search_type == &quot;BlendedSearch&quot;:
-        data = unmarshal(xmldoc).BlendedSearch
-    else:    
-        data = unmarshal(xmldoc).ItemSearchResponse        
-        
-    if hasattr(data, 'Error'):
-        raise AmazonError, data.Error
+        if hasattr(data, 'BlendedSearch'):
+            data = data.BlendedSearch
+    elif hasattr(data, 'ItemSearchResponse'):
+        data = data.ItemSearchResponse 
+    elif hasattr(data, 'ItemLookupResponse'):
+        data = data.ItemLookupResponse 
+
+    if hasattr(data, 'Errors'):
+        raise AmazonError, data.Errors
     else:
         if search_type == &quot;BlendedSearch&quot;:
             return data 
         else:            
-            return data.Items
+            if hasattr(data, 'Items'):
+                return data.Items
+            else:
+                return data
 
 def searchByKeyword(keyword, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;ItemSearch&quot;, keyword, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ItemSearch&quot;, 'Keywords', keyword, product_line, type, page, license_key, http_proxy, locale, associate)
 
+def searchByTitle(keyword, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
+    return search(&quot;ItemSearch&quot;, 'Title', keyword, product_line, type, page, license_key, http_proxy, locale, associate)
+
 def browseBestSellers(browse_node, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;BrowseNodeSearch&quot;, browse_node, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;BrowseNodeSearch&quot;, 'Keywords', browse_node, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByASIN(ASIN, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;AsinSearch&quot;, ASIN, None, type, None, license_key, http_proxy, locale, associate)
+    return search(&quot;ItemLookup&quot;, 'ASIN', ASIN, None, type, None, license_key, http_proxy, locale, associate)
 
-def searchByUPC(UPC, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;UpcSearch&quot;, UPC, None, type, None, license_key, http_proxy, locale, associate)
+def searchByUPC(UPC, product_line=&quot;Books&quot;, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
+    return search(&quot;ItemLookup&quot;, 'UPC', UPC, product_line, type, None, license_key, http_proxy, locale, associate)
 
+def searchByEAN(EAN, product_line=&quot;Books&quot;, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
+    return search(&quot;ItemLookup&quot;, 'EAN', EAN, product_line, type, None, license_key, http_proxy, locale, associate)
+
 def searchByAuthor(author, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;AuthorSearch&quot;, author, &quot;Books&quot;, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;AuthorSearch&quot;, 'Keywords', author, &quot;Books&quot;, type, page, license_key, http_proxy, locale, associate)
 
 def searchByArtist(artist, product_line=&quot;Music&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;music&quot;, &quot;classical&quot;):
         raise AmazonError, &quot;product_line must be in ('Music', 'Classical')&quot;
-    return search(&quot;ArtistSearch&quot;, artist, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ArtistSearch&quot;, 'Keywords', artist, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByActor(actor, product_line=&quot;DVD&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;DVD&quot;, &quot;VHS&quot;, &quot;Video&quot;):
         raise AmazonError, &quot;product_line must be in ('DVD', 'VHS', 'Video')&quot;
-    return search(&quot;ActorSearch&quot;, actor, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ActorSearch&quot;, 'Keywords', actor, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByDirector(director, product_line=&quot;DVD&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;DVD&quot;, &quot;VHS&quot;, &quot;Video&quot;):
         raise AmazonError, &quot;product_line must be in ('DVD', 'VHS', 'Video')&quot;
-    return search(&quot;DirectorSearch&quot;, director, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;DirectorSearch&quot;, 'Keywords', director, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByManufacturer(manufacturer, product_line=&quot;pc-hardware&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;electronics&quot;, &quot;kitchen&quot;, &quot;videogames&quot;, &quot;software&quot;, &quot;photo&quot;, &quot;pc-hardware&quot;):
         raise AmazonError, &quot;product_line must be in ('electronics', 'kitchen', 'videogames', 'software', 'photo', 'pc-hardware')&quot;
-    return search(&quot;ManufacturerSearch&quot;, manufacturer, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ManufacturerSearch&quot;, 'Keywords', manufacturer, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByListMania(listManiaID, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;ListManiaSearch&quot;, listManiaID, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ListManiaSearch&quot;, 'Keywords', listManiaID, None, type, page, license_key, http_proxy, locale, associate)
 
 def searchSimilar(ASIN, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;SimilaritySearch&quot;, ASIN, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;SimilaritySearch&quot;, 'Keywords', ASIN, None, type, page, license_key, http_proxy, locale, associate)
 
 def searchByWishlist(wishlistID, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;WishlistSearch&quot;, wishlistID, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;WishlistSearch&quot;, 'Keywords', wishlistID, None, type, page, license_key, http_proxy, locale, associate)
 
 def searchByPower(keyword, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;PowerSearch&quot;, keyword, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;PowerSearch&quot;, 'Keywords', keyword, product_line, type, page, license_key, http_proxy, locale, associate)
     # &gt;&gt;&gt; RecentKing = amazon.searchByPower('author:Stephen King and pubdate:2003')
     # &gt;&gt;&gt; SnowCrash = amazon.searchByPower('title:Snow Crash')
 
 def searchByBlended(keyword, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;BlendedSearch&quot;, keyword, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;BlendedSearch&quot;, 'Keywords', keyword, None, type, page, license_key, http_proxy, locale, associate)

Modified: branches/0.9.x/lib/edit.py
===================================================================
--- branches/0.9.x/lib/edit.py	2008-08-16 15:09:30 UTC (rev 987)
+++ branches/0.9.x/lib/edit.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -138,7 +138,11 @@
 		locale = 'de'
 		keyword = self.widgets['movie']['title'].get_text()
 	elif locale == '3':
-		locale = 'uk'
+		locale = 'ca'
+	elif locale == '4':
+		locale = 'fr'
+	elif locale == '5':
+		locale = 'jp'
 	else:
 		locale = None
 

Added: branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-08-16 15:09:30 UTC (rev 987)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -0,0 +1,450 @@
+# -*- coding: UTF-8 -*-
+
+__revision__ = '$Id$'
+
+# Copyright (c) 2006-2008
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
+
+# You may use and distribute this software under the terms of the
+# GNU General Public License, version 2 or later
+
+from gettext import gettext as _
+import gutils
+import movie
+import string
+import re
+import amazon
+import gdebug
+import threading
+import gtk
+from operator import isSequenceType
+from urlparse import urlsplit
+
+plugin_name = &quot;Amazon&quot;
+plugin_description = &quot;Amazon&quot;
+plugin_url = &quot;www.amazon.com/.uk/.de/.ca/.fr/.jp&quot;
+plugin_language = _(&quot;International&quot;)
+plugin_author = &quot;Michael Jahn&quot;
+plugin_author_email = &quot;&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;&quot;
+plugin_version = &quot;1.0&quot;
+
+class Plugin(movie.Movie):
+
+	def __init__(self, id):
+		self.encode='utf8'
+		self.movie_id = id
+		self.url = '<A HREF="http://www.amazon.de/dp/">http://www.amazon.de/dp/</A>' + str(self.movie_id)
+
+	def open_page(self, parent_window=None, url=None):
+		# dont use base functionality
+		# use the Amazon Web API
+		self.parent_window = parent_window
+		progress = movie.Progress(parent_window,_('Searching'),_('Wait a moment'))
+		try:
+			locale = self.config.get('amazon_locale', 0, section='add')
+			if locale == '1':
+				locale = 'uk'
+			elif locale == '2':
+				locale = 'de'
+			elif locale == '3':
+				locale = 'ca'
+			elif locale == '4':
+				locale = 'fr'
+			elif locale == '5':
+				locale = 'jp'
+			else:
+				locale = None
+			retriever = AmazonRetriever(self.movie_id, locale, parent_window, progress, self.debug, 'Get')
+			retriever.start()
+			while retriever.isAlive():
+				progress.pulse()
+				while gtk.events_pending():
+					gtk.main_iteration()
+			self.page = retriever.result.Item
+		except:
+			try:
+				self.debug.show(&quot;Error retrieving results from amazon.&quot;)
+				self.debug.show(retriever.result.Request.Errors.Error.Message)
+			except:
+				pass
+		progress.close()
+		return self.page
+
+	def get_image(self):
+		self.image_url = ''
+		if hasattr(self.page, 'LargeImage'):
+			self.image_url = self.page.LargeImage.URL
+		elif hasattr(self.page, 'MediumImage'):
+			self.image_url = self.page.MediumImage.URL
+		elif hasattr(self.page, 'SmallImage'):
+			self.image_url = self.page.SmallImage.URL
+
+	def get_o_title(self):
+		if hasattr(self.page.ItemAttributes, 'Title'):
+			self.o_title = self.page.ItemAttributes.Title
+		else:
+			self.director = ''
+
+	def get_title(self):
+		if hasattr(self.page.ItemAttributes, 'Title'):
+			self.title = self.page.ItemAttributes.Title
+		else:
+			self.director = ''
+
+	def get_director(self):
+		if hasattr(self.page.ItemAttributes, 'Director'):
+			self.director = self.page.ItemAttributes.Director
+		else:
+			self.director = ''
+
+	def get_plot(self):
+		self.plot = ''
+		if hasattr(self.page, 'EditorialReviews'):
+			if hasattr(self.page.EditorialReviews, 'EditorialReview'):
+				if isSequenceType(self.page.EditorialReviews.EditorialReview):
+					for review in self.page.EditorialReviews.EditorialReview:
+						if string.find(review.Source, 'Amazon') &gt; -1:
+							self.plot = review.Content
+				else:
+					if hasattr(self.page.EditorialReviews.EditorialReview, 'Source') and \
+						hasattr(self.page.EditorialReviews.EditorialReview, 'Content') and \
+						string.find(self.page.EditorialReviews.EditorialReview.Source, 'Amazon') &gt; -1:
+						self.plot = self.page.EditorialReviews.EditorialReview.Content
+
+	def get_year(self):
+		if hasattr(self.page.ItemAttributes, 'TheatricalReleaseDate'):
+			self.year = self.page.ItemAttributes.TheatricalReleaseDate[:4]
+		elif hasattr(self.page.ItemAttributes, 'ReleaseDate'):
+			self.year = self.page.ItemAttributes.ReleaseDate[:4]
+		else:
+			self.year = ''
+
+	def get_runtime(self):
+		if hasattr(self.page.ItemAttributes, 'RunningTime'):
+			self.runtime = self.page.ItemAttributes.RunningTime
+		else:
+			self.runtime = ''
+
+	def get_genre(self):
+		# BrowseNodeId 547664 (Genres)
+		self.genre = ''
+		delimiter = ''
+		if hasattr(self.page, 'BrowseNodes') and hasattr(self.page.BrowseNodes, 'BrowseNode'):
+			if isSequenceType(self.page.BrowseNodes.BrowseNode):
+				for node in self.page.BrowseNodes.BrowseNode:
+					parentnode = node
+					while hasattr(parentnode, 'Ancestors') and parentnode.BrowseNodeId &lt;&gt; '547664' \
+							and parentnode.BrowseNodeId &lt;&gt; '13628901': # no production countries; they are also arranged under genres
+						parentnode = parentnode.Ancestors.BrowseNode
+					if parentnode.BrowseNodeId == '547664':
+						self.genre = self.genre + delimiter + node.Name
+						delimiter = ', '
+
+	def get_cast(self):
+		self.cast = ''
+		if hasattr(self.page.ItemAttributes, 'Actor'):
+			for actor in self.page.ItemAttributes.Actor:
+				self.cast += actor + '\n'
+
+	def get_classification(self):
+		if hasattr(self.page.ItemAttributes, 'AudienceRating'):
+			self.classification = self.page.ItemAttributes.AudienceRating
+		else:
+			self.classification = ''
+
+	def get_studio(self):
+		if hasattr(self.page.ItemAttributes, 'Studio'):
+			self.studio = self.page.ItemAttributes.Studio
+		else:
+			self.studio = ''
+
+	def get_o_site(self):
+		self.o_site = ''
+
+	def get_site(self):
+		if hasattr(self.page, 'DetailPageURL'):
+			parts = urlsplit(self.page.DetailPageURL)
+			self.site = parts[0] + '://' + parts[1] + '/dp/' + self.movie_id
+		else:
+			self.site = ''
+
+	def get_trailer(self):
+		self.trailer = ''
+
+	def get_country(self):
+		# BrowseNodeId 13628901 (production countries)
+		self.country = ''
+		delimiter = ''
+		if hasattr(self.page, 'BrowseNodes') and hasattr(self.page.BrowseNodes, 'BrowseNode'):
+			if isSequenceType(self.page.BrowseNodes.BrowseNode):
+				for node in self.page.BrowseNodes.BrowseNode:
+					parentnode = node
+					while hasattr(parentnode, 'Ancestors') and parentnode.BrowseNodeId &lt;&gt; '13628901':
+						parentnode = parentnode.Ancestors.BrowseNode
+					if parentnode.BrowseNodeId == '13628901':
+						self.country = self.country + delimiter + node.Name
+						delimiter = ', '
+
+	def get_rating(self):
+		self.rating = '0'
+		if hasattr(self.page, 'CustomerReviews') and \
+			hasattr(self.page.CustomerReviews, 'AverageRating'):
+			try:
+				tmp_float = float(self.page.CustomerReviews.AverageRating)
+				tmp_float = round(2 * tmp_float, 0)
+				self.rating = str(tmp_float)
+			except:
+				pass
+
+	def get_notes(self):
+		self.notes = ''
+		if hasattr(self.page.ItemAttributes, 'EAN'):
+			self.notes = 'EAN: ' + self.page.ItemAttributes.EAN
+
+
+class SearchPlugin(movie.SearchMovie):
+
+	def __init__(self):
+		self.original_url_search   = '<A HREF="http://www.amazon.de">http://www.amazon.de</A>'
+		self.translated_url_search = '<A HREF="http://www.amazon.de">http://www.amazon.de</A>'
+		self.encode='utf8'
+		self.remove_accents = False
+
+	def search(self,parent_window):
+		# dont use base functionality
+		# use the Amazon Web API
+		self.titles = [&quot;&quot;]
+		self.ids = [&quot;&quot;]
+		progress = movie.Progress(parent_window,_('Searching'),_('Wait a moment'))
+		try:
+			locale = self.config.get('amazon_locale', 0, section='add')
+			if locale == '1':
+				locale = 'uk'
+			elif locale == '2':
+				locale = 'de'
+			elif locale == '3':
+				locale = 'ca'
+			elif locale == '4':
+				locale = 'fr'
+			elif locale == '5':
+				locale = 'jp'
+			else:
+				locale = None
+			retriever = AmazonRetriever(self.title.encode('iso8859-1'), locale, parent_window, progress, self.debug)
+			retriever.start()
+			while retriever.isAlive():
+				progress.pulse()
+				while gtk.events_pending():
+					gtk.main_iteration()
+			self.page = retriever.result
+		except:
+			try:
+				self.debug.show(&quot;Error retrieving results from amazon.&quot;)
+				self.debug.show(retriever.result.Request.Errors.Error.Message)
+			except:
+				pass
+		progress.close()
+		return self.page
+
+	def get_searches(self):
+		for result in self.page:
+			if hasattr(result, 'Item'):
+				if hasattr(result.Item, 'ASIN'):
+					self.add_item(result.Item)
+				else:
+					for item in result.Item:
+						self.add_item(item)
+			elif hasattr(result, 'Items'):
+				if hasattr(result.Item, 'ASIN'):
+					self.add_item(result.Items)
+				else:
+					for item in result.Items:
+						self.add_item(item)
+
+	def add_item(self, item):
+		self.ids.append(item.ASIN)
+		if hasattr(item.ItemAttributes, 'ProductGroup'):
+			productGroup = item.ItemAttributes.ProductGroup + ' - '
+		else:
+			productGroup = ''
+		if hasattr(item.ItemAttributes, 'Title'):
+			title = item.ItemAttributes.Title
+		else:
+			title = ''
+		if hasattr(item.ItemAttributes, 'TheatricalReleaseDate'):
+			theatricalReleaseDate = ' (' + item.ItemAttributes.TheatricalReleaseDate + ')'
+		else:
+			theatricalReleaseDate = ''
+		self.titles.append(&quot;%s%s%s&quot; % (productGroup, title, theatricalReleaseDate))
+
+class AmazonRetriever(threading.Thread):
+
+	def __init__(self, title, locale, parent_window, progress, debug, lookuptype='Search', destination=None):
+		self.title = title
+		self.locale = locale
+		self.result = None
+		self.destination = destination
+		self.parent_window = parent_window
+		self.progress = progress
+		self.debug = debug
+		# Search or Get
+		self.lookuptype = lookuptype
+		self._stopevent = threading.Event()
+		self._sleepperiod = 1.0
+		threading.Thread.__init__(self, name='Retriever')
+
+	def run(self):
+		if self.lookuptype == 'Get':
+			self.run_get()
+		else:
+			self.run_search()
+
+	def run_search(self):
+		self.result = []
+		try:
+			amazon.setLicense('04GDDMMXX8X9CJ1B22G2')
+			try:
+				tmp = amazon.searchByTitle(self.title, type='ItemAttributes', product_line='Video', locale=self.locale, page=1)
+				self.result.append(tmp)
+				if hasattr(tmp, 'TotalPages'):
+					pages = int(tmp.TotalPages) - 1
+					page = 2
+					while page &lt; pages and page &lt; 11:
+						tmp = amazon.searchByTitle(self.title, type='ItemAttributes', product_line='Video', locale=self.locale, page=page)
+						self.result.append(tmp)
+						page = page + 1
+			except amazon.AmazonError, e:
+				self.debug.show(e.Message)
+			# if all digits then try to find an EAN / UPC
+			if self.title.isdigit():
+				if len(self.title) == 13:
+					try:
+						tmp = amazon.searchByEAN(self.title, type='ItemAttributes', product_line='Video', locale=self.locale)
+						self.result.append(tmp)
+					except amazon.AmazonError, e:
+						self.debug.show(e.Message)
+				elif len(self.title) == 12:
+					try:
+						tmp = amazon.searchByUPC(self.title, type='ItemAttributes', product_line='Video', locale=self.locale)
+						self.result.append(tmp)
+					except amazon.AmazonError, e:
+						self.debug.show(e.Message)
+		except IOError:
+			self.progress.dialog.hide()
+			gutils.urllib_error(_('Connection error'), self.parent_window)
+			self.suspend()
+
+	def run_get(self):
+		self.result = None
+		try:
+			amazon.setLicense('04GDDMMXX8X9CJ1B22G2')
+			# get by ASIN
+			try:
+				self.result = amazon.searchByASIN(self.title, type='Large', locale=self.locale)
+			except amazon.AmazonError, e:
+				self.debug.show(e.Message)
+		except IOError:
+			self.progress.dialog.hide()
+			gutils.urllib_error(_('Connection error'), self.parent_window)
+			self.suspend()
+
+#
+# Plugin Test
+#
+class SearchPluginTest(SearchPlugin):
+	#
+	# Configuration for automated tests:
+	# dict { movie_id -&gt; expected result count }
+	#
+	test_configuration = {
+		'Rocky Balboa'			: 10,
+		'Arahan'				: 5,
+		'Ein gl&#252;ckliches Jahr'	: 1
+	}
+
+class PluginTest:
+	#
+	# Configuration for automated tests:
+	# dict { movie_id -&gt; dict { arribute -&gt; value } }
+	#
+	# value: * True/False if attribute only should be tested for any value
+	#        * or the expected value
+	#
+	test_configuration = {
+		'B000TIQMMI' : { 
+			'title' 			: 'Rocky Balboa',
+			'o_title' 			: 'Rocky Balboa',
+			'director'			: '',
+			'plot' 				: True,
+			'cast'				: 'Sylvester Stallone\n\
+Antonio Traver\n\
+Burt Young',
+			'country'			: 'USA',
+			'genre'				: 'Mehr Drama, Drama',
+			'classification'	: 'Freigegeben ab 12 Jahren',
+			'studio'			: 'MGM Home Entertainment GmbH (dt.)',
+			'o_site'			: False,
+			'site'				: '<A HREF="http://www.amazon.de/dp/B000TIQMMI">http://www.amazon.de/dp/B000TIQMMI</A>',
+			'trailer'			: False,
+			'year'				: 2006,
+			'notes'				: 'EAN: 4045167004504',
+			'runtime'			: 97,
+			'image'				: True,
+			'rating'			: 9
+		},
+		'B0009NSASM' : { 
+			'title' 			: 'Ein gl&#252;ckliches Jahr',
+			'o_title' 			: 'Ein gl&#252;ckliches Jahr',
+			'director'			: 'Claude Lelouch',
+			'plot' 				: False,
+			'cast'				: 'Lino Ventura\n\
+Fran&#231;oise Fabian\n\
+Charles G&#233;rard',
+			'country'			: 'Frankreich, Italien',
+			'genre'				: 'Krimi, Mehr Drama, Mehr Kom&#246;die, Drama, Kom&#246;die, Krimi',
+			'classification'	: 'Freigegeben ab 12 Jahren',
+			'studio'			: 'Warner Home Video - DVD',
+			'o_site'			: False,
+			'site'				: '<A HREF="http://www.amazon.de/dp/B0009NSASM">http://www.amazon.de/dp/B0009NSASM</A>',
+			'trailer'			: False,
+			'year'				: 1973,
+			'notes'				: 'EAN: 7321921998843',
+			'runtime'			: 110,
+			'image'				: True,
+			'rating'			: 10
+		},
+		'B000BSNOD6' : { 
+			'title' 			: 'Arahan (Vanilla-DVD)',
+			'o_title' 			: 'Arahan (Vanilla-DVD)',
+			'director'			: 'Ryoo Seung-wan',
+			'plot' 				: False,
+			'cast'				: 'Ryu Seung-beom\n\
+Yoon So-yi\n\
+Ahn Sung-kee',
+			'country'			: 'S&#252;dkorea',
+			'genre'				: 'Actionkom&#246;die, Abenteuer- &amp; Actionkom&#246;die, Fantasykom&#246;die, Action, Kom&#246;die, Mehr Fantasy, Korea, Action, Kom&#246;die, Fantasy, Unter 10 EUR',
+			'classification'	: 'Freigegeben ab 16 Jahren',
+			'studio'			: 'Splendid Entertainment/WVG',
+			'o_site'			: False,
+			'site'				: '<A HREF="http://www.amazon.de/dp/B000BSNOD6">http://www.amazon.de/dp/B000BSNOD6</A>',
+			'trailer'			: False,
+			'year'				: 2005,
+			'notes'				: 'EAN: 4013549871105',
+			'runtime'			: 108,
+			'image'				: True,
+			'rating'			: 8
+		}
+	}

Modified: branches/0.9.x/lib/test_movieplugins.py
===================================================================
--- branches/0.9.x/lib/test_movieplugins.py	2008-08-16 15:09:30 UTC (rev 987)
+++ branches/0.9.x/lib/test_movieplugins.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -44,6 +44,9 @@
 import initialize
 import gdebug
 import gutils
+import config
+import os
+from time import sleep
 try:
 	import gtk
 	import gobject
@@ -59,6 +62,7 @@
 #
 class PluginTester:
 	test_plugins = [
+		'PluginMovieAmazon',
 		'PluginMovieFilmeVonAZ',
 		'PluginMovieKinoDe',
 		'PluginMovieOFDb',
@@ -70,8 +74,14 @@
 	# the count of results with the expected count
 	#
 	def test_search(self, plugin, title, cnt):
+		global debug, myconfig
+		plugin.debug = debug
+		plugin.config = myconfig
 		plugin.url = plugin.translated_url_search
-		plugin.title = gutils.remove_accents(title, 'utf-8')
+		if plugin.remove_accents:
+			plugin.title = gutils.remove_accents(title, 'utf-8')
+		else:
+			plugin.title = title
 		plugin.search(None)
 		plugin.get_searches()
 		if not len(plugin.ids) - 1 == cnt:	# first entry is always '' (???)
@@ -97,6 +107,7 @@
 				searchPlugin = plugin.SearchPlugin()
 				if not self.test_search(searchPlugin, i, pluginTestConfig.test_configuration[i]):
 					result = False
+				sleep(1) # needed for amazon
 		
 		if domsgbox:
 			if not result:
@@ -111,10 +122,13 @@
 	# compares the results with the expected once
 	#
 	def test_one_movie(self, movieplugin, results_expected):
+		global debug, myconfig
 		result = True
 		self.movie = movieplugin
 		self.movie.parent_window = None
 		self.movie.locations = self.locations
+		self.movie.debug = debug
+		self.movie.config = myconfig
 
 		fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
 				'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
@@ -194,7 +208,8 @@
 				moviePlugin = plugin.Plugin(i)
 				if not self.test_one_movie(moviePlugin, pluginTestConfig.test_configuration[i]):
 					result = False
-		
+				sleep(1) # needed for amazon
+
 		if domsgbox:
 			if not result:
 				gutils.error(self, 'PluginTest %s: Test NOT successful !' % plugin_name)
@@ -209,10 +224,14 @@
 	# and executes the Plugin and SearchPlugin test methods
 	#
 	def do_test(self, domsgbox=True):
-		global debug
+		global debug, myconfig
 		debug = self.debug = gdebug.GriffithDebug()
+		#self.debug.set_debug(True)
 		self._tmp_home = None
+		self._tmp_config = 'griffith.cfg'
 		initialize.locations(self)
+		configFileName = os.path.join(self.locations['home'], self._tmp_config)
+		myconfig = self.config = config.Config(file=configFileName)
 		search_successful = ''
 		search_unsuccessful = ''
 		get_successful = ''

Modified: trunk/glade/griffith.glade
===================================================================
--- trunk/glade/griffith.glade	2008-08-16 15:09:30 UTC (rev 987)
+++ trunk/glade/griffith.glade	2008-08-16 15:20:49 UTC (rev 988)
@@ -5384,8 +5384,9 @@
                                     &lt;property name=&quot;items&quot;&gt;US
 UK
 DE
-JP
-FR&lt;/property&gt;
+CA
+FR
+JP&lt;/property&gt;
                                   &lt;/widget&gt;
                                   &lt;packing&gt;
                                     &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;

Modified: trunk/lib/add.py
===================================================================
--- trunk/lib/add.py	2008-08-16 15:09:30 UTC (rev 987)
+++ trunk/lib/add.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -177,6 +177,7 @@
     plugin = __import__(plugin_name)
     self.movie = plugin.Plugin(m_id)
     self.movie.locations = self.locations
+    self.movie.config = self.config
     
     fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
                 'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
@@ -278,6 +279,7 @@
         plugin_name = 'PluginMovie%s' % option
         plugin = __import__(plugin_name)
         self.search_movie = plugin.SearchPlugin()
+        self.search_movie.config = self.config
         if o_title:
             self.search_movie.url = self.search_movie.original_url_search
             if self.search_movie.remove_accents:

Modified: trunk/lib/amazon.py
===================================================================
--- trunk/lib/amazon.py	2008-08-16 15:09:30 UTC (rev 987)
+++ trunk/lib/amazon.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -85,6 +85,8 @@
 ASSOCIATE = &quot;webservices-20&quot;
 HTTP_PROXY = None
 LOCALE = &quot;us&quot;
+# default API version is from 2005-10-05
+APIVERSION='2008-06-26'
 
 # don't touch the rest of these constants
 class AmazonError(Exception): pass
@@ -220,27 +222,38 @@
             rc = int(rc)
     return rc
 
-def buildURL(search_type, keyword, product_line, type, page, license_key, locale, associate):
+def buildURL(search_type, searchfield, searchvalue, product_line, type, page, license_key, locale, associate):
     _checkLocaleSupported(locale)
     url = &quot;<A HREF="http://">http://</A>&quot; + _supportedLocales[locale][1]
-    url += &quot;&amp;AssociateTag=%s&quot; % associate
-    url += &quot;&amp;AWSAccessKeyId=%s&quot; % license_key.strip()
-    url += &quot;&amp;ResponseGroup=%s&quot; % type
-    #if _supportedLocales[locale][0]:
-    #    url += &quot;&amp;locale=%s&quot; % _supportedLocales[locale][0]
-    #if page:
-    #    url += &quot;&amp;page=%s&quot; % page
-    if product_line:
-        url += &quot;&amp;SearchIndex=%s&quot; % product_line
-    url += &quot;&amp;Operation=%s&quot; % search_type
-    url += &quot;&amp;Keywords=%s&quot; % urllib.quote(keyword)
+    if search_type == 'ItemLookup':
+        url += &quot;&amp;AssociateTag=%s&quot; % associate
+        url += &quot;&amp;AWSAccessKeyId=%s&quot; % license_key.strip()
+        url += &quot;&amp;ResponseGroup=%s&quot; % type
+        if product_line:
+            url += &quot;&amp;SearchIndex=%s&quot; % product_line
+        url += &quot;&amp;Operation=%s&quot; % search_type
+        url += &quot;&amp;IdType=%s&quot; % searchfield
+        url += &quot;&amp;ItemId=%s&quot; % searchvalue
+    else:
+        url += &quot;&amp;AssociateTag=%s&quot; % associate
+        url += &quot;&amp;AWSAccessKeyId=%s&quot; % license_key.strip()
+        url += &quot;&amp;ResponseGroup=%s&quot; % type
+        if page:
+            url += &quot;&amp;ItemPage=%s&quot; % page
+        if product_line:
+            url += &quot;&amp;SearchIndex=%s&quot; % product_line
+        url += &quot;&amp;Operation=%s&quot; % search_type
+        url += &quot;&amp;%s=%s&quot; % (searchfield, urllib.quote(searchvalue))
+        url += &quot;&amp;Sort=titlerank&quot;
+    if not APIVERSION is None:
+        url += &quot;&amp;Version=%s&quot; % APIVERSION
     return url
 
 
 ## main functions
 
 
-def search(search_type, keyword, product_line, type = &quot;Large&quot;, page = None,
+def search(search_type, searchfield, searchvalue, product_line, type = &quot;Large&quot;, page = None,
            license_key=None, http_proxy = None, locale = None, associate = None):
     &quot;&quot;&quot;search Amazon
 
@@ -289,7 +302,7 @@
     license_key = getLicense(license_key)
     locale = getLocale(locale)
     associate = getAssociate(associate)
-    url = buildURL(search_type, keyword, product_line, type, page, 
+    url = buildURL(search_type, searchfield, searchvalue, product_line, type, page, 
             license_key, locale, associate)
     proxies = getProxies(http_proxy)
     u = urllib.FancyURLopener(proxies)
@@ -300,67 +313,80 @@
 #     PrettyPrint(xmldoc)
 
     usock.close()
+    data = unmarshal(xmldoc)
     if search_type == &quot;BlendedSearch&quot;:
-        data = unmarshal(xmldoc).BlendedSearch
-    else:    
-        data = unmarshal(xmldoc).ItemSearchResponse        
-        
-    if hasattr(data, 'Error'):
-        raise AmazonError, data.Error
+        if hasattr(data, 'BlendedSearch'):
+            data = data.BlendedSearch
+    elif hasattr(data, 'ItemSearchResponse'):
+        data = data.ItemSearchResponse 
+    elif hasattr(data, 'ItemLookupResponse'):
+        data = data.ItemLookupResponse 
+
+    if hasattr(data, 'Errors'):
+        raise AmazonError, data.Errors
     else:
         if search_type == &quot;BlendedSearch&quot;:
             return data 
         else:            
-            return data.Items
+            if hasattr(data, 'Items'):
+                return data.Items
+            else:
+                return data
 
 def searchByKeyword(keyword, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;ItemSearch&quot;, keyword, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ItemSearch&quot;, 'Keywords', keyword, product_line, type, page, license_key, http_proxy, locale, associate)
 
+def searchByTitle(keyword, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
+    return search(&quot;ItemSearch&quot;, 'Title', keyword, product_line, type, page, license_key, http_proxy, locale, associate)
+
 def browseBestSellers(browse_node, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;BrowseNodeSearch&quot;, browse_node, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;BrowseNodeSearch&quot;, 'Keywords', browse_node, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByASIN(ASIN, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;AsinSearch&quot;, ASIN, None, type, None, license_key, http_proxy, locale, associate)
+    return search(&quot;ItemLookup&quot;, 'ASIN', ASIN, None, type, None, license_key, http_proxy, locale, associate)
 
-def searchByUPC(UPC, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;UpcSearch&quot;, UPC, None, type, None, license_key, http_proxy, locale, associate)
+def searchByUPC(UPC, product_line=&quot;Books&quot;, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
+    return search(&quot;ItemLookup&quot;, 'UPC', UPC, product_line, type, None, license_key, http_proxy, locale, associate)
 
+def searchByEAN(EAN, product_line=&quot;Books&quot;, type=&quot;Large&quot;, license_key=None, http_proxy=None, locale=None, associate=None):
+    return search(&quot;ItemLookup&quot;, 'EAN', EAN, product_line, type, None, license_key, http_proxy, locale, associate)
+
 def searchByAuthor(author, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;AuthorSearch&quot;, author, &quot;Books&quot;, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;AuthorSearch&quot;, 'Keywords', author, &quot;Books&quot;, type, page, license_key, http_proxy, locale, associate)
 
 def searchByArtist(artist, product_line=&quot;Music&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;music&quot;, &quot;classical&quot;):
         raise AmazonError, &quot;product_line must be in ('Music', 'Classical')&quot;
-    return search(&quot;ArtistSearch&quot;, artist, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ArtistSearch&quot;, 'Keywords', artist, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByActor(actor, product_line=&quot;DVD&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;DVD&quot;, &quot;VHS&quot;, &quot;Video&quot;):
         raise AmazonError, &quot;product_line must be in ('DVD', 'VHS', 'Video')&quot;
-    return search(&quot;ActorSearch&quot;, actor, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ActorSearch&quot;, 'Keywords', actor, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByDirector(director, product_line=&quot;DVD&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;DVD&quot;, &quot;VHS&quot;, &quot;Video&quot;):
         raise AmazonError, &quot;product_line must be in ('DVD', 'VHS', 'Video')&quot;
-    return search(&quot;DirectorSearch&quot;, director, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;DirectorSearch&quot;, 'Keywords', director, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByManufacturer(manufacturer, product_line=&quot;pc-hardware&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
     if product_line not in (&quot;electronics&quot;, &quot;kitchen&quot;, &quot;videogames&quot;, &quot;software&quot;, &quot;photo&quot;, &quot;pc-hardware&quot;):
         raise AmazonError, &quot;product_line must be in ('electronics', 'kitchen', 'videogames', 'software', 'photo', 'pc-hardware')&quot;
-    return search(&quot;ManufacturerSearch&quot;, manufacturer, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ManufacturerSearch&quot;, 'Keywords', manufacturer, product_line, type, page, license_key, http_proxy, locale, associate)
 
 def searchByListMania(listManiaID, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;ListManiaSearch&quot;, listManiaID, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;ListManiaSearch&quot;, 'Keywords', listManiaID, None, type, page, license_key, http_proxy, locale, associate)
 
 def searchSimilar(ASIN, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;SimilaritySearch&quot;, ASIN, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;SimilaritySearch&quot;, 'Keywords', ASIN, None, type, page, license_key, http_proxy, locale, associate)
 
 def searchByWishlist(wishlistID, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;WishlistSearch&quot;, wishlistID, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;WishlistSearch&quot;, 'Keywords', wishlistID, None, type, page, license_key, http_proxy, locale, associate)
 
 def searchByPower(keyword, product_line=&quot;Books&quot;, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;PowerSearch&quot;, keyword, product_line, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;PowerSearch&quot;, 'Keywords', keyword, product_line, type, page, license_key, http_proxy, locale, associate)
     # &gt;&gt;&gt; RecentKing = amazon.searchByPower('author:Stephen King and pubdate:2003')
     # &gt;&gt;&gt; SnowCrash = amazon.searchByPower('title:Snow Crash')
 
 def searchByBlended(keyword, type=&quot;Large&quot;, page=1, license_key=None, http_proxy=None, locale=None, associate=None):
-    return search(&quot;BlendedSearch&quot;, keyword, None, type, page, license_key, http_proxy, locale, associate)
+    return search(&quot;BlendedSearch&quot;, 'Keywords', keyword, None, type, page, license_key, http_proxy, locale, associate)

Modified: trunk/lib/edit.py
===================================================================
--- trunk/lib/edit.py	2008-08-16 15:09:30 UTC (rev 987)
+++ trunk/lib/edit.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -149,7 +149,11 @@
         locale = 'de'
         keyword = self.widgets['movie']['title'].get_text()
     elif locale == '3':
-        locale = 'uk'
+        locale = 'ca'
+    elif locale == '4':
+        locale = 'fr'
+    elif locale == '5':
+        locale = 'jp'
     else:
         locale = None
 

Added: trunk/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-08-16 15:09:30 UTC (rev 987)
+++ trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -0,0 +1,450 @@
+# -*- coding: UTF-8 -*-
+
+__revision__ = '$Id$'
+
+# Copyright (c) 2006-2008
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
+
+# You may use and distribute this software under the terms of the
+# GNU General Public License, version 2 or later
+
+from gettext import gettext as _
+import gutils
+import movie
+import string
+import re
+import amazon
+import threading
+import gtk
+from operator import isSequenceType
+from urlparse import urlsplit
+import logging
+log = logging.getLogger(&quot;Griffith&quot;)
+
+plugin_name = &quot;Amazon&quot;
+plugin_description = &quot;Amazon&quot;
+plugin_url = &quot;www.amazon.com/.uk/.de/.ca/.fr/.jp&quot;
+plugin_language = _(&quot;International&quot;)
+plugin_author = &quot;Michael Jahn&quot;
+plugin_author_email = &quot;&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;&quot;
+plugin_version = &quot;1.0&quot;
+
+class Plugin(movie.Movie):
+
+    def __init__(self, id):
+        self.encode='utf8'
+        self.movie_id = id
+        self.url = '<A HREF="http://www.amazon.de/dp/">http://www.amazon.de/dp/</A>' + str(self.movie_id)
+
+    def open_page(self, parent_window=None, url=None):
+        # dont use base functionality
+        # use the Amazon Web API
+        self.parent_window = parent_window
+        progress = movie.Progress(parent_window,_('Searching'),_('Wait a moment'))
+        try:
+            locale = self.config.get('amazon_locale', 0, section='add')
+            if locale == '1':
+                locale = 'uk'
+            elif locale == '2':
+                locale = 'de'
+            elif locale == '3':
+                locale = 'ca'
+            elif locale == '4':
+                locale = 'fr'
+            elif locale == '5':
+                locale = 'jp'
+            else:
+                locale = None
+            retriever = AmazonRetriever(self.movie_id, locale, parent_window, progress, 'Get')
+            retriever.start()
+            while retriever.isAlive():
+                progress.pulse()
+                while gtk.events_pending():
+                    gtk.main_iteration()
+            self.page = retriever.result.Item
+        except:
+            try:
+                log.error(&quot;Error retrieving results from amazon.&quot;)
+                log.error(retriever.result.Request.Errors.Error.Message)
+            except:
+                pass
+        progress.close()
+        return self.page
+
+    def get_image(self):
+        self.image_url = ''
+        if hasattr(self.page, 'LargeImage'):
+            self.image_url = self.page.LargeImage.URL
+        elif hasattr(self.page, 'MediumImage'):
+            self.image_url = self.page.MediumImage.URL
+        elif hasattr(self.page, 'SmallImage'):
+            self.image_url = self.page.SmallImage.URL
+
+    def get_o_title(self):
+        if hasattr(self.page.ItemAttributes, 'Title'):
+            self.o_title = self.page.ItemAttributes.Title
+        else:
+            self.director = ''
+
+    def get_title(self):
+        if hasattr(self.page.ItemAttributes, 'Title'):
+            self.title = self.page.ItemAttributes.Title
+        else:
+            self.director = ''
+
+    def get_director(self):
+        if hasattr(self.page.ItemAttributes, 'Director'):
+            self.director = self.page.ItemAttributes.Director
+        else:
+            self.director = ''
+
+    def get_plot(self):
+        self.plot = ''
+        if hasattr(self.page, 'EditorialReviews'):
+            if hasattr(self.page.EditorialReviews, 'EditorialReview'):
+                if isSequenceType(self.page.EditorialReviews.EditorialReview):
+                    for review in self.page.EditorialReviews.EditorialReview:
+                        if string.find(review.Source, 'Amazon') &gt; -1:
+                            self.plot = review.Content
+                else:
+                    if hasattr(self.page.EditorialReviews.EditorialReview, 'Source') and \
+                        hasattr(self.page.EditorialReviews.EditorialReview, 'Content') and \
+                        string.find(self.page.EditorialReviews.EditorialReview.Source, 'Amazon') &gt; -1:
+                        self.plot = self.page.EditorialReviews.EditorialReview.Content
+
+    def get_year(self):
+        if hasattr(self.page.ItemAttributes, 'TheatricalReleaseDate'):
+            self.year = self.page.ItemAttributes.TheatricalReleaseDate[:4]
+        elif hasattr(self.page.ItemAttributes, 'ReleaseDate'):
+            self.year = self.page.ItemAttributes.ReleaseDate[:4]
+        else:
+            self.year = ''
+
+    def get_runtime(self):
+        if hasattr(self.page.ItemAttributes, 'RunningTime'):
+            self.runtime = self.page.ItemAttributes.RunningTime
+        else:
+            self.runtime = ''
+
+    def get_genre(self):
+        # BrowseNodeId 547664 (Genres)
+        self.genre = ''
+        delimiter = ''
+        if hasattr(self.page, 'BrowseNodes') and hasattr(self.page.BrowseNodes, 'BrowseNode'):
+            if isSequenceType(self.page.BrowseNodes.BrowseNode):
+                for node in self.page.BrowseNodes.BrowseNode:
+                    parentnode = node
+                    while hasattr(parentnode, 'Ancestors') and parentnode.BrowseNodeId &lt;&gt; '547664' \
+                            and parentnode.BrowseNodeId &lt;&gt; '13628901': # no production countries; they are also arranged under genres
+                        parentnode = parentnode.Ancestors.BrowseNode
+                    if parentnode.BrowseNodeId == '547664':
+                        self.genre = self.genre + delimiter + node.Name
+                        delimiter = ', '
+
+    def get_cast(self):
+        self.cast = ''
+        if hasattr(self.page.ItemAttributes, 'Actor'):
+            for actor in self.page.ItemAttributes.Actor:
+                self.cast += actor + '\n'
+
+    def get_classification(self):
+        if hasattr(self.page.ItemAttributes, 'AudienceRating'):
+            self.classification = self.page.ItemAttributes.AudienceRating
+        else:
+            self.classification = ''
+
+    def get_studio(self):
+        if hasattr(self.page.ItemAttributes, 'Studio'):
+            self.studio = self.page.ItemAttributes.Studio
+        else:
+            self.studio = ''
+
+    def get_o_site(self):
+        self.o_site = ''
+
+    def get_site(self):
+        if hasattr(self.page, 'DetailPageURL'):
+            parts = urlsplit(self.page.DetailPageURL)
+            self.site = parts[0] + '://' + parts[1] + '/dp/' + self.movie_id
+        else:
+            self.site = ''
+
+    def get_trailer(self):
+        self.trailer = ''
+
+    def get_country(self):
+        # BrowseNodeId 13628901 (production countries)
+        self.country = ''
+        delimiter = ''
+        if hasattr(self.page, 'BrowseNodes') and hasattr(self.page.BrowseNodes, 'BrowseNode'):
+            if isSequenceType(self.page.BrowseNodes.BrowseNode):
+                for node in self.page.BrowseNodes.BrowseNode:
+                    parentnode = node
+                    while hasattr(parentnode, 'Ancestors') and parentnode.BrowseNodeId &lt;&gt; '13628901':
+                        parentnode = parentnode.Ancestors.BrowseNode
+                    if parentnode.BrowseNodeId == '13628901':
+                        self.country = self.country + delimiter + node.Name
+                        delimiter = ', '
+
+    def get_rating(self):
+        self.rating = '0'
+        if hasattr(self.page, 'CustomerReviews') and \
+            hasattr(self.page.CustomerReviews, 'AverageRating'):
+            try:
+                tmp_float = float(self.page.CustomerReviews.AverageRating)
+                tmp_float = round(2 * tmp_float, 0)
+                self.rating = str(tmp_float)
+            except:
+                pass
+
+    def get_notes(self):
+        self.notes = ''
+        if hasattr(self.page.ItemAttributes, 'EAN'):
+            self.notes = 'EAN: ' + self.page.ItemAttributes.EAN
+
+
+class SearchPlugin(movie.SearchMovie):
+
+    def __init__(self):
+        self.original_url_search   = '<A HREF="http://www.amazon.de">http://www.amazon.de</A>'
+        self.translated_url_search = '<A HREF="http://www.amazon.de">http://www.amazon.de</A>'
+        self.encode='utf8'
+        self.remove_accents = False
+
+    def search(self,parent_window):
+        # dont use base functionality
+        # use the Amazon Web API
+        self.titles = [&quot;&quot;]
+        self.ids = [&quot;&quot;]
+        progress = movie.Progress(parent_window,_('Searching'),_('Wait a moment'))
+        try:
+            locale = self.config.get('amazon_locale', 0, section='add')
+            if locale == '1':
+                locale = 'uk'
+            elif locale == '2':
+                locale = 'de'
+            elif locale == '3':
+                locale = 'ca'
+            elif locale == '4':
+                locale = 'fr'
+            elif locale == '5':
+                locale = 'jp'
+            else:
+                locale = None
+            retriever = AmazonRetriever(self.title.encode('iso8859-1'), locale, parent_window, progress)
+            retriever.start()
+            while retriever.isAlive():
+                progress.pulse()
+                while gtk.events_pending():
+                    gtk.main_iteration()
+            self.page = retriever.result
+        except:
+            try:
+                log.error(&quot;Error retrieving results from amazon.&quot;)
+                log.error(retriever.result.Request.Errors.Error.Message)
+            except:
+                pass
+        progress.close()
+        return self.page
+
+    def get_searches(self):
+        for result in self.page:
+            if hasattr(result, 'Item'):
+                if hasattr(result.Item, 'ASIN'):
+                    self.add_item(result.Item)
+                else:
+                    for item in result.Item:
+                        self.add_item(item)
+            elif hasattr(result, 'Items'):
+                if hasattr(result.Item, 'ASIN'):
+                    self.add_item(result.Items)
+                else:
+                    for item in result.Items:
+                        self.add_item(item)
+
+    def add_item(self, item):
+        self.ids.append(item.ASIN)
+        if hasattr(item.ItemAttributes, 'ProductGroup'):
+            productGroup = item.ItemAttributes.ProductGroup + ' - '
+        else:
+            productGroup = ''
+        if hasattr(item.ItemAttributes, 'Title'):
+            title = item.ItemAttributes.Title
+        else:
+            title = ''
+        if hasattr(item.ItemAttributes, 'TheatricalReleaseDate'):
+            theatricalReleaseDate = ' (' + item.ItemAttributes.TheatricalReleaseDate + ')'
+        else:
+            theatricalReleaseDate = ''
+        self.titles.append(&quot;%s%s%s&quot; % (productGroup, title, theatricalReleaseDate))
+
+class AmazonRetriever(threading.Thread):
+
+    def __init__(self, title, locale, parent_window, progress, lookuptype='Search', destination=None):
+        self.title = title
+        self.locale = locale
+        self.result = None
+        self.destination = destination
+        self.parent_window = parent_window
+        self.progress = progress
+        # Search or Get
+        self.lookuptype = lookuptype
+        self._stopevent = threading.Event()
+        self._sleepperiod = 1.0
+        threading.Thread.__init__(self, name='Retriever')
+
+    def run(self):
+        if self.lookuptype == 'Get':
+            self.run_get()
+        else:
+            self.run_search()
+
+    def run_search(self):
+        self.result = []
+        try:
+            amazon.setLicense('04GDDMMXX8X9CJ1B22G2')
+            try:
+                tmp = amazon.searchByTitle(self.title, type='ItemAttributes', product_line='Video', locale=self.locale, page=1)
+                self.result.append(tmp)
+                if hasattr(tmp, 'TotalPages'):
+                    pages = int(tmp.TotalPages) - 1
+                    page = 2
+                    while page &lt; pages and page &lt; 11:
+                        tmp = amazon.searchByTitle(self.title, type='ItemAttributes', product_line='Video', locale=self.locale, page=page)
+                        self.result.append(tmp)
+                        page = page + 1
+            except amazon.AmazonError, e:
+                log.error(e.Message)
+            # if all digits then try to find an EAN / UPC
+            if self.title.isdigit():
+                if len(self.title) == 13:
+                    try:
+                        tmp = amazon.searchByEAN(self.title, type='ItemAttributes', product_line='Video', locale=self.locale)
+                        self.result.append(tmp)
+                    except amazon.AmazonError, e:
+                        log.error(e.Message)
+                elif len(self.title) == 12:
+                    try:
+                        tmp = amazon.searchByUPC(self.title, type='ItemAttributes', product_line='Video', locale=self.locale)
+                        self.result.append(tmp)
+                    except amazon.AmazonError, e:
+                        log.error(e.Message)
+        except IOError:
+            self.progress.dialog.hide()
+            gutils.urllib_error(_('Connection error'), self.parent_window)
+            self.suspend()
+
+    def run_get(self):
+        self.result = None
+        try:
+            amazon.setLicense('04GDDMMXX8X9CJ1B22G2')
+            # get by ASIN
+            try:
+                self.result = amazon.searchByASIN(self.title, type='Large', locale=self.locale)
+            except amazon.AmazonError, e:
+                log.error(e.Message)
+        except IOError:
+            self.progress.dialog.hide()
+            gutils.urllib_error(_('Connection error'), self.parent_window)
+            self.suspend()
+
+#
+# Plugin Test
+#
+class SearchPluginTest(SearchPlugin):
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; expected result count }
+    #
+    test_configuration = {
+        'Rocky Balboa'            : 10,
+        'Arahan'                : 5,
+        'Ein gl&#252;ckliches Jahr'    : 1
+    }
+
+class PluginTest:
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute only should be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        'B000TIQMMI' : { 
+            'title'             : 'Rocky Balboa',
+            'o_title'             : 'Rocky Balboa',
+            'director'            : '',
+            'plot'                 : True,
+            'cast'                : 'Sylvester Stallone\n\
+Antonio Traver\n\
+Burt Young',
+            'country'            : 'USA',
+            'genre'                : 'Mehr Drama, Drama',
+            'classification'    : 'Freigegeben ab 12 Jahren',
+            'studio'            : 'MGM Home Entertainment GmbH (dt.)',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.amazon.de/dp/B000TIQMMI">http://www.amazon.de/dp/B000TIQMMI</A>',
+            'trailer'            : False,
+            'year'                : 2006,
+            'notes'                : 'EAN: 4045167004504',
+            'runtime'            : 97,
+            'image'                : True,
+            'rating'            : 9
+        },
+        'B0009NSASM' : { 
+            'title'             : 'Ein gl&#252;ckliches Jahr',
+            'o_title'             : 'Ein gl&#252;ckliches Jahr',
+            'director'            : 'Claude Lelouch',
+            'plot'                 : False,
+            'cast'                : 'Lino Ventura\n\
+Fran&#231;oise Fabian\n\
+Charles G&#233;rard',
+            'country'            : 'Frankreich, Italien',
+            'genre'                : 'Krimi, Mehr Drama, Mehr Kom&#246;die, Drama, Kom&#246;die, Krimi',
+            'classification'    : 'Freigegeben ab 12 Jahren',
+            'studio'            : 'Warner Home Video - DVD',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.amazon.de/dp/B0009NSASM">http://www.amazon.de/dp/B0009NSASM</A>',
+            'trailer'            : False,
+            'year'                : 1973,
+            'notes'                : 'EAN: 7321921998843',
+            'runtime'            : 110,
+            'image'                : True,
+            'rating'            : 10
+        },
+        'B000BSNOD6' : { 
+            'title'             : 'Arahan (Vanilla-DVD)',
+            'o_title'             : 'Arahan (Vanilla-DVD)',
+            'director'            : 'Ryoo Seung-wan',
+            'plot'                 : False,
+            'cast'                : 'Ryu Seung-beom\n\
+Yoon So-yi\n\
+Ahn Sung-kee',
+            'country'            : 'S&#252;dkorea',
+            'genre'                : 'Actionkom&#246;die, Abenteuer- &amp; Actionkom&#246;die, Fantasykom&#246;die, Action, Kom&#246;die, Mehr Fantasy, Korea, Action, Kom&#246;die, Fantasy, Unter 10 EUR',
+            'classification'    : 'Freigegeben ab 16 Jahren',
+            'studio'            : 'Splendid Entertainment/WVG',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.amazon.de/dp/B000BSNOD6">http://www.amazon.de/dp/B000BSNOD6</A>',
+            'trailer'            : False,
+            'year'                : 2005,
+            'notes'                : 'EAN: 4013549871105',
+            'runtime'            : 108,
+            'image'                : True,
+            'rating'            : 8
+        }
+    }

Modified: trunk/lib/test_movieplugins.py
===================================================================
--- trunk/lib/test_movieplugins.py	2008-08-16 15:09:30 UTC (rev 987)
+++ trunk/lib/test_movieplugins.py	2008-08-16 15:20:49 UTC (rev 988)
@@ -43,6 +43,9 @@
 import sys
 import initialize
 import gutils
+import config
+import os
+from time import sleep
 try:
     import gtk
     import gobject
@@ -58,6 +61,7 @@
 #
 class PluginTester:
     test_plugins = [
+        'PluginMovieAmazon',
         'PluginMovieFilmeVonAZ',
         'PluginMovieKinoDe',
         'PluginMovieOFDb',
@@ -69,8 +73,13 @@
     # the count of results with the expected count
     #
     def test_search(self, plugin, title, cnt):
+        global myconfig
+        plugin.config = myconfig
         plugin.url = plugin.translated_url_search
-        plugin.title = gutils.remove_accents(title, 'utf-8')
+        if plugin.remove_accents:
+            plugin.title = gutils.remove_accents(title, 'utf-8')
+        else:
+            plugin.title = title
         plugin.search(None)
         plugin.get_searches()
         if not len(plugin.ids) - 1 == cnt:    # first entry is always '' (???)
@@ -96,6 +105,7 @@
                 searchPlugin = plugin.SearchPlugin()
                 if not self.test_search(searchPlugin, i, pluginTestConfig.test_configuration[i]):
                     result = False
+                sleep(1) # needed for amazon
         
         if domsgbox:
             if not result:
@@ -110,10 +120,12 @@
     # compares the results with the expected once
     #
     def test_one_movie(self, movieplugin, results_expected):
+        global myconfig
         result = True
         self.movie = movieplugin
         self.movie.parent_window = None
         self.movie.locations = self.locations
+        self.movie.config = myconfig
 
         fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
                 'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
@@ -193,6 +205,7 @@
                 moviePlugin = plugin.Plugin(i)
                 if not self.test_one_movie(moviePlugin, pluginTestConfig.test_configuration[i]):
                     result = False
+                sleep(1) # needed for amazon
         
         if domsgbox:
             if not result:
@@ -208,8 +221,12 @@
     # and executes the Plugin and SearchPlugin test methods
     #
     def do_test(self, domsgbox=True):
+        global myconfig
         self._tmp_home = None
+        self._tmp_config = 'griffith.cfg'
         initialize.locations(self)
+        configFileName = os.path.join(self.locations['home'], self._tmp_config)
+        myconfig = self.config = config.Config(file=configFileName)
         search_successful = ''
         search_unsuccessful = ''
         get_successful = ''


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000470.html">[Griffith-svn] r987 - branches/0.9.x	branches/0.9.x/lib/plugins/movie trunk trunk/lib/plugins/movie
</A></li>
	<LI>Next message: <A HREF="000467.html">[Griffith-svn] r989 - in trunk: . lib/plugins/movie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#469">[ date ]</a>
              <a href="thread.html#469">[ thread ]</a>
              <a href="subject.html#469">[ subject ]</a>
              <a href="author.html#469">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/griffith-svn">More information about the Griffith-svn
mailing list</a><br>
</body></html>
