<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Griffith-svn] r971 - in trunk: . debian lib lib/plugins/export	lib/plugins/imp lib/plugins/movie
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/griffith-svn/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r971%20-%20in%20trunk%3A%20.%20debian%20lib%20lib/plugins/export%0A%09lib/plugins/imp%20lib/plugins/movie&In-Reply-To=%3C200807282128.m6SLS36w005320%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000453.html">
   <LINK REL="Next"  HREF="000455.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Griffith-svn] r971 - in trunk: . debian lib lib/plugins/export	lib/plugins/imp lib/plugins/movie</H1>
    <B>piotrek at BerliOS</B> 
    <A HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r971%20-%20in%20trunk%3A%20.%20debian%20lib%20lib/plugins/export%0A%09lib/plugins/imp%20lib/plugins/movie&In-Reply-To=%3C200807282128.m6SLS36w005320%40sheep.berlios.de%3E"
       TITLE="[Griffith-svn] r971 - in trunk: . debian lib lib/plugins/export	lib/plugins/imp lib/plugins/movie">piotrek at mail.berlios.de
       </A><BR>
    <I>Mon Jul 28 23:28:03 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000453.html">[Griffith-svn] r969 - branches/0.9.x/docs/en branches/0.9.x/docs/pl	branches/0.9.x/docs/pt trunk/docs/en trunk/docs/pl trunk/docs/pt
</A></li>
        <LI>Next message: <A HREF="000455.html">[Griffith-svn] r972 - in trunk: . lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#454">[ date ]</a>
              <a href="thread.html#454">[ thread ]</a>
              <a href="subject.html#454">[ subject ]</a>
              <a href="author.html#454">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: piotrek
Date: 2008-07-28 23:26:40 +0200 (Mon, 28 Jul 2008)
New Revision: 971

Added:
   trunk/lib/db.py
Modified:
   trunk/ChangeLog
   trunk/debian/control
   trunk/griffith
   trunk/lib/about.py
   trunk/lib/add.py
   trunk/lib/backup.py
   trunk/lib/config.py
   trunk/lib/cover.py
   trunk/lib/dbupgrade.py
   trunk/lib/delete.py
   trunk/lib/edit.py
   trunk/lib/gconsole.py
   trunk/lib/gdebug.py
   trunk/lib/gemail.py
   trunk/lib/gutils.py
   trunk/lib/initialize.py
   trunk/lib/loan.py
   trunk/lib/main_treeview.py
   trunk/lib/movie.py
   trunk/lib/people.py
   trunk/lib/plugins/export/PluginExportHTML.py
   trunk/lib/plugins/export/PluginExportXML.py
   trunk/lib/plugins/export/PluginExportiPod.py
   trunk/lib/plugins/imp/CSV.py
   trunk/lib/plugins/imp/__init__.py
   trunk/lib/plugins/movie/PluginMovie7arte.py
   trunk/lib/plugins/movie/PluginMovieAllocine.py
   trunk/lib/plugins/movie/PluginMovieAniDB.py
   trunk/lib/plugins/movie/PluginMovieCSFD.py
   trunk/lib/plugins/movie/PluginMovieCineMovies.py
   trunk/lib/plugins/movie/PluginMovieCinematografo.py
   trunk/lib/plugins/movie/PluginMovieCineteka.py
   trunk/lib/plugins/movie/PluginMovieCulturalia.py
   trunk/lib/plugins/movie/PluginMovieDVDEmpire.py
   trunk/lib/plugins/movie/PluginMovieDVDPalace.py
   trunk/lib/plugins/movie/PluginMovieE-Pipoca.py
   trunk/lib/plugins/movie/PluginMovieFDb.py
   trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
   trunk/lib/plugins/movie/PluginMovieFilmDb.py
   trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   trunk/lib/plugins/movie/PluginMovieFilmtipset.py
   trunk/lib/plugins/movie/PluginMovieFilmweb.py
   trunk/lib/plugins/movie/PluginMovieIMDB-de.py
   trunk/lib/plugins/movie/PluginMovieIMDB-es.py
   trunk/lib/plugins/movie/PluginMovieIMDB.py
   trunk/lib/plugins/movie/PluginMovieKinoDe.py
   trunk/lib/plugins/movie/PluginMovieMediadis.py
   trunk/lib/plugins/movie/PluginMovieMoviefone.py
   trunk/lib/plugins/movie/PluginMovieOFDb.py
   trunk/lib/plugins/movie/PluginMovieOnet.py
   trunk/lib/plugins/movie/PluginMoviePTGate.py
   trunk/lib/plugins/movie/PluginMovieStopklatka.py
   trunk/lib/plugins/movie/PluginMovieTanukiAnime.py
   trunk/lib/plugins/movie/PluginMovieWP.py
   trunk/lib/plugins/movie/PluginMovieZelluloid.py
   trunk/lib/preferences.py
   trunk/lib/quick_filter.py
   trunk/lib/sql.py
   trunk/lib/test_movieplugins.py
   trunk/lib/update.py
   trunk/lib/view.py
   trunk/lib/widgets.py
   trunk/winsetup.py
Log:
* Switch back to 4 spaces indentation
* Rewrite SQLAlchemy related data to use session (to ease accessing simultaneously multiple databases)


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/ChangeLog	2008-07-28 21:26:40 UTC (rev 971)
@@ -4,6 +4,11 @@
 ------------------
 (c) 2005-2008  Vasco Nunes, Piotr O&#197;&#188;arowski
 
+
+2008-07-28  Piotr O&#197;&#188;arowski
+	* Switch back to 4 spaces indentation
+	* Rewrite SQLAlchemy related data to use session (to ease accessing simultaneously multiple databases)
+
 ---- 0.9.7.1 ---
 
 2008-07-26  Piotr O&#197;&#188;arowski

Modified: trunk/debian/control
===================================================================
--- trunk/debian/control	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/debian/control	2008-07-28 21:26:40 UTC (rev 971)
@@ -13,7 +13,7 @@
 Package: griffith
 Architecture: all
 Depends: ${python:Depends}, python-gtk2 (&gt;= 2.8.6-1), python-glade2 (&gt;= 2.8.6-1),
- python-sqlalchemy (&gt;= 0.5),
+ python-sqlalchemy (&gt;= 0.4.6),
  python (&gt;= 2.5) | python-pysqlite2 (&gt;= 2.3.0-1),
  python-reportlab (&gt;= 1.20debian-6), python-imaging (&gt;= 1.1.5-6)
 Recommends: python-gnome2-extras (&gt;= 2.14.0-1), python-chardet,

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/griffith	2008-07-28 21:26:40 UTC (rev 971)
@@ -27,7 +27,7 @@
 lib = os.path.abspath(os.path.join(os.path.dirname(sys.argv[0]), 'lib'))
 #lib = os.path.abspath(os.path.join(os.path.dirname(__file__), 'lib'))
 if os.path.isdir(lib):
-	sys.path.insert(1, lib)
+    sys.path.insert(1, lib)
 del lib
 
 # check dependencies
@@ -35,1215 +35,1216 @@
 (required, extra) = get_dependencies()
 missing = []
 for i in required:
-	if i['version'] is False or (i['version'] is not True and i['version'][0] == '-'):
-		missing.append(i)
+    if i['version'] is False or (i['version'] is not True and i['version'][0] == '-'):
+        missing.append(i)
 if len(missing) &gt; 0:
-	print 'Error: missing modules:'
-	for i in missing:
-		print &quot;%(module)s&quot; % i,
-		if i.has_key('module_req'):
-			print &quot;\t:: required version: %(module_req)s&quot; % i,
-			if i['version'] is not False and i['version'][0] == '-':
-				print &quot;\t:: detected: %(version)s&quot; % i
-		print &quot;\n&quot;,
-	sys.exit(1)
+    print 'Error: missing modules:'
+    for i in missing:
+        print &quot;%(module)s&quot; % i,
+        if i.has_key('module_req'):
+            print &quot;\t:: required version: %(module_req)s&quot; % i,
+            if i['version'] is not False and i['version'][0] == '-':
+                print &quot;\t:: detected: %(version)s&quot; % i
+        print &quot;\n&quot;,
+    sys.exit(1)
 del missing
 
 # other imports
 import gtk, gtk.glade
 import add, config, gconsole, gutils, gdebug, initialize, main_treeview, quick_filter, update
 from gettext import gettext as _
+import db
 
 class Griffith:
-	&quot;&quot;&quot;The main application class&quot;&quot;&quot;
+    &quot;&quot;&quot;The main application class&quot;&quot;&quot;
 
-	Image = gtk.Image()
-	founded_results_id = None
-	initialized = False
-	lang = {}
+    Image = gtk.Image()
+    founded_results_id = None
+    initialized = False
+    lang = {}
 
-	def __init__(self):
-		&quot;&quot;&quot;main griffith application constructor&quot;&quot;&quot;	
+    def __init__(self):
+        &quot;&quot;&quot;main griffith application constructor&quot;&quot;&quot;    
 
-		# debug object
-		global debug
-		debug = self.debug = gdebug.GriffithDebug()
-		
-		gconsole.check_args(self)
-		initialize.locations(self)
-		
-		initialize.i18n(self, self.locations['i18n'])
-		self.posix = (os.name == 'posix')
-	
-		# Configuration
-		if self._tmp_config.find('/') &gt;=0 or self._tmp_config.find('\\') &gt;=0:
-			configFileName = self._tmp_config
-		else:
-			configFileName = os.path.join(self.locations['home'], self._tmp_config)
-		self.config = config.Config(file=configFileName)
-		initialize.location_posters(self.locations, self.config)
+        # debug object
+        global debug
+        debug = self.debug = gdebug.GriffithDebug()
+        
+        gconsole.check_args(self)
+        initialize.locations(self)
+        
+        initialize.i18n(self, self.locations['i18n'])
+        self.posix = (os.name == 'posix')
+    
+        # Configuration
+        if self._tmp_config.find('/') &gt;=0 or self._tmp_config.find('\\') &gt;=0:
+            configFileName = self._tmp_config
+        else:
+            configFileName = os.path.join(self.locations['home'], self._tmp_config)
+        self.config = config.Config(file=configFileName)
+        initialize.location_posters(self.locations, self.config)
 
-		# convert old database
-		filename = os.path.join(self.locations['home'], self.config.get('file', 'griffith.db', section='database'))
-		if self.config.get('file', 'griffith.db', section='database').lower().endswith('.gri'):
-			debug.show('Old database format detected. Converting...')
-			from dbupgrade import convert_from_old_db
-			if convert_from_old_db(self, filename, os.path.join(self.locations['home'], 'griffith.db')):
-				self.config.save()
-				initialize.location_posters(self.locations, self.config)
-			else:
-				print 'Cant convert old database, exiting.'
-				sys.exit(4)
-		
-		# create/connect db
-		from sql import GriffithSQL
-		self.db = GriffithSQL(self.config, self.debug, self.locations['home'])
+        # convert old database
+        filename = os.path.join(self.locations['home'], self.config.get('file', 'griffith.db', section='database'))
+        if self.config.get('file', 'griffith.db', section='database').lower().endswith('.gri'):
+            debug.show('Old database format detected. Converting...')
+            from dbupgrade import convert_from_old_db
+            if convert_from_old_db(self, filename, os.path.join(self.locations['home'], 'griffith.db')):
+                self.config.save()
+                initialize.location_posters(self.locations, self.config)
+            else:
+                print 'Cant convert old database, exiting.'
+                sys.exit(4)
+        
+        # create/connect db
+        from sql import GriffithSQL
+        self.db = GriffithSQL(self.config, self.debug, self.locations['home'])
 
-		# let's check any console arguments to parse
-		gconsole.check_args_with_db(self)
+        # let's check any console arguments to parse
+        gconsole.check_args_with_db(self)
 
-		gtk.window_set_auto_startup_notification(True)
-		self.Image = gtk.Image()
-		self.filter_l = False
-		initialize.gui(self)
-		initialize.toolbar(self)
-		initialize.treeview(self)
-		initialize.loans_treeview(self)
-		initialize.lang_treeview(self)
-		initialize.dictionaries(self)
-		initialize.combos(self)
-		initialize.preferences(self)
-		initialize.movie_plugins(self)
-		initialize.export_plugins(self)
-		initialize.people_treeview(self)
-		initialize.web_results(self)
-		self.initialized = True
+        gtk.window_set_auto_startup_notification(True)
+        self.Image = gtk.Image()
+        self.filter_l = False
+        initialize.gui(self)
+        initialize.toolbar(self)
+        initialize.treeview(self)
+        initialize.loans_treeview(self)
+        initialize.lang_treeview(self)
+        initialize.dictionaries(self)
+        initialize.combos(self)
+        initialize.preferences(self)
+        initialize.movie_plugins(self)
+        initialize.export_plugins(self)
+        initialize.people_treeview(self)
+        initialize.web_results(self)
+        self.initialized = True
 
-		self.restore_state()
-		self.clear_details()
-		self.populate_treeview()
+        self.restore_state()
+        self.clear_details()
+        self.populate_treeview()
 
-		# adding some completion fields
-		self.completion = gtk.EntryCompletion()
-		self.widgets['add']['o_title'].set_completion(self.completion)
-		self.completion.set_model(self.treemodel)
-		self.completion.set_text_column(3)
-		self.completion_t = gtk.EntryCompletion()
-		self.widgets['add']['title'].set_completion(self.completion_t)
-		self.completion_t.set_model(self.treemodel)
-		self.completion_t.set_text_column(4)
-		
-		initialize.gtkspell(self)
+        # adding some completion fields
+        self.completion = gtk.EntryCompletion()
+        self.widgets['add']['o_title'].set_completion(self.completion)
+        self.completion.set_model(self.treemodel)
+        self.completion.set_text_column(3)
+        self.completion_t = gtk.EntryCompletion()
+        self.widgets['add']['title'].set_completion(self.completion_t)
+        self.completion_t.set_model(self.treemodel)
+        self.completion_t.set_text_column(4)
+        
+        initialize.gtkspell(self)
 
-		# add default folders to some select widgets
-		if self.windows:
-			from win32com.shell import shellcon, shell
-			fonts_dir = shell.SHGetFolderPath(0, shellcon.CSIDL_FONTS, 0, 0)
-			self.widgets['preferences']['font'].set_current_folder(fonts_dir)
-		elif self.mac:
-			self.widgets['preferences']['font'].set_current_folder(&quot;/System/Library/Fonts/&quot;)
-		else:
-			self.widgets['preferences']['font'].set_current_folder(os.path.join(sys.prefix, 'share', 'fonts'))
+        # add default folders to some select widgets
+        if self.windows:
+            from win32com.shell import shellcon, shell
+            fonts_dir = shell.SHGetFolderPath(0, shellcon.CSIDL_FONTS, 0, 0)
+            self.widgets['preferences']['font'].set_current_folder(fonts_dir)
+        elif self.mac:
+            self.widgets['preferences']['font'].set_current_folder(&quot;/System/Library/Fonts/&quot;)
+        else:
+            self.widgets['preferences']['font'].set_current_folder(os.path.join(sys.prefix, 'share', 'fonts'))
 
-	def main(self):
-		gtk.gdk.threads_init()
-		gtk.gdk.threads_enter()
-		gtk.main()
-		gtk.gdk.threads_leave()
-		return 0
+    def main(self):
+        gtk.gdk.threads_init()
+        gtk.gdk.threads_enter()
+        gtk.main()
+        gtk.gdk.threads_leave()
+        return 0
 
-	###########
-	# callbacks
-	###########		
+    ###########
+    # callbacks
+    ###########        
 
-	def on_export_activate(self, menu_iter, plugin_name):
-		export_plugin = __import__('PluginExport%s' % plugin_name)
-		export_plugin.ExportPlugin(self.db, self.locations, self.widgets['window'], self.debug, config=self.config)
+    def on_export_activate(self, menu_iter, plugin_name):
+        export_plugin = __import__('PluginExport%s' % plugin_name)
+        export_plugin.ExportPlugin(self.db, self.locations, self.widgets['window'], self.debug, config=self.config)
 
-	def on_import_activate(self, *args):
-		if self.widgets.has_key('import'):
-			self.widgets['import']['window'].show()
-		else:
-			initialize.import_plugins(self)
+    def on_import_activate(self, *args):
+        if self.widgets.has_key('import'):
+            self.widgets['import']['window'].show()
+        else:
+            initialize.import_plugins(self)
 
-	def destroy(self, widget, data=None):
-		self.save_state()
-		gtk.main_quit()
+    def destroy(self, widget, data=None):
+        self.save_state()
+        gtk.main_quit()
 
-	def on_configure(self, widget, data=None):
-		# size should only be saved on microsoft windows systems
-		# on other systems the window manager should manage the windows
-		if self.windows and not data is None:
-			if not hasattr(self, 'mainwindow_state') or self.mainwindow_state is None:
-				self.mainwindow_state = {}
-			self.mainwindow_state['left'] = data.x
-			self.mainwindow_state['top'] = data.y
-			self.mainwindow_state['height'] = data.height
-			self.mainwindow_state['width'] = data.width
+    def on_configure(self, widget, data=None):
+        # size should only be saved on microsoft windows systems
+        # on other systems the window manager should manage the windows
+        if self.windows and not data is None:
+            if not hasattr(self, 'mainwindow_state') or self.mainwindow_state is None:
+                self.mainwindow_state = {}
+            self.mainwindow_state['left'] = data.x
+            self.mainwindow_state['top'] = data.y
+            self.mainwindow_state['height'] = data.height
+            self.mainwindow_state['width'] = data.width
 
-	def on_window_state(self, widget, windowstate=None):
-		# size should only be saved on microsoft windows systems
-		# on other systems the window manager should manage the windows
-		# here: save the window state
-		if self.windows and not windowstate is None:
-			if not hasattr(self, 'mainwindow_state') or self.mainwindow_state is None:
-				self.mainwindow_state = {}
-			self.mainwindow_state['state'] = int(windowstate.new_window_state &amp; gtk.gdk.WINDOW_STATE_MAXIMIZED)
+    def on_window_state(self, widget, windowstate=None):
+        # size should only be saved on microsoft windows systems
+        # on other systems the window manager should manage the windows
+        # here: save the window state
+        if self.windows and not windowstate is None:
+            if not hasattr(self, 'mainwindow_state') or self.mainwindow_state is None:
+                self.mainwindow_state = {}
+            self.mainwindow_state['state'] = int(windowstate.new_window_state &amp; gtk.gdk.WINDOW_STATE_MAXIMIZED)
 
 
-	# about dialog	-------------------------------------------------------			
+    # about dialog    -------------------------------------------------------            
 
-	def about_dialog(self, *args):
-		from about import AboutDialog
-		about_dialog = AboutDialog(self.locations)
+    def about_dialog(self, *args):
+        from about import AboutDialog
+        about_dialog = AboutDialog(self.locations)
 
-	# add movie -----------------------------------------------------------
+    # add movie -----------------------------------------------------------
 
-	def clear_add_dialog(self, *args):
-		add.clear(self)
+    def clear_add_dialog(self, *args):
+        add.clear(self)
 
-	def edit_movie(self, *args):
-		movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).first()
-		if movie is not None:
-			add.edit_movie(self, movie)
-		else:
-			gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
+    def edit_movie(self, *args):
+        movie = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).first()
+        if movie is not None:
+            add.edit_movie(self, movie)
+        else:
+            gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
 
-	def hide_add_window(self, *args):
-		#if self.widgets['add']['b_get_from_web'].is_sensitive() is True: # fetch from amazon is not working
-		self.widgets['window'].present()
-		self.widgets['results']['window'].hide()
-		self.widgets['add']['window'].hide()
+    def hide_add_window(self, *args):
+        #if self.widgets['add']['b_get_from_web'].is_sensitive() is True: # fetch from amazon is not working
+        self.widgets['window'].present()
+        self.widgets['results']['window'].hide()
+        self.widgets['add']['window'].hide()
 
-	def get_from_web(self, *args):
-		add.get_from_web(self)
+    def get_from_web(self, *args):
+        add.get_from_web(self)
 
-	def show_search_results(self, results):
-		add.show_websearch_results(self)
+    def show_search_results(self, results):
+        add.show_websearch_results(self)
 
-	def populate_dialog_with_results(self, *args):
-		add.populate_with_results(self)
+    def populate_dialog_with_results(self, *args):
+        add.populate_with_results(self)
 
-	def source_changed(self, *args):
-		add.source_changed(self)
+    def source_changed(self, *args):
+        add.source_changed(self)
 
-	def on_enter(self, *args):
-		# push Get From Web button if return key is pressed in title box 
-		if self._am_movie_id is None:
-			self.widgets['add']['b_get_from_web'].clicked()
+    def on_enter(self, *args):
+        # push Get From Web button if return key is pressed in title box 
+        if self._am_movie_id is None:
+            self.widgets['add']['b_get_from_web'].clicked()
 
-	# preferences ---------------------------------------------------------
+    # preferences ---------------------------------------------------------
 
-	def show_preferences(self, *args):
-		from preferences import show_preferences
-		show_preferences(self)
+    def show_preferences(self, *args):
+        from preferences import show_preferences
+        show_preferences(self)
 
-	def hide_preferences(self, *args):
-		self.widgets['window'].present()
-		self.widgets['preferences']['window'].hide()
+    def hide_preferences(self, *args):
+        self.widgets['window'].present()
+        self.widgets['preferences']['window'].hide()
 
-	def save_preferences(self, *args):
-		from preferences import save_preferences
-		save_preferences(self)
-		self.hide_preferences()
+    def save_preferences(self, *args):
+        from preferences import save_preferences
+        save_preferences(self)
+        self.hide_preferences()
 
-	def on_p_db_type_changed(self, widget):
-		active = widget.get_active()
-		if active == 0:
-			# change port number if it is something useful at the moment; for clearness
-			if self.widgets['preferences']['db_port'].get_value() == 0 or \
-				self.widgets['preferences']['db_port'].get_value() == 3306 or \
-				self.widgets['preferences']['db_port'].get_value() == 5432 or \
-				self.widgets['preferences']['db_port'].get_value() == 1433:
-				self.widgets['preferences']['db_port'].set_value(0)
-			self.widgets['preferences']['db_passwd'].set_sensitive(False)
-			self.widgets['preferences']['db_user'].set_sensitive(False)
-			self.widgets['preferences']['db_port'].set_sensitive(False)
-			self.widgets['preferences']['db_host'].set_sensitive(False)
-		elif active == 1:
-			# change port number IF previous one was MySQL's or MSSQL one
-			if self.widgets['preferences']['db_port'].get_value() == 0 or \
-				self.widgets['preferences']['db_port'].get_value() == 3306 or \
-				self.widgets['preferences']['db_port'].get_value() == 1433:
-				self.widgets['preferences']['db_port'].set_value(5432)
-			self.widgets['preferences']['db_passwd'].set_sensitive(True)
-			self.widgets['preferences']['db_user'].set_sensitive(True)
-			self.widgets['preferences']['db_port'].set_sensitive(True)
-			self.widgets['preferences']['db_host'].set_sensitive(True)
-		elif active == 2:
-			# change port number IF previous one was PostgreSQL's or MSSQL one
-			if self.widgets['preferences']['db_port'].get_value() == 0 or \
-				self.widgets['preferences']['db_port'].get_value() == 5432 or \
-				self.widgets['preferences']['db_port'].get_value() == 1433:
-				self.widgets['preferences']['db_port'].set_value(3306)
-			self.widgets['preferences']['db_passwd'].set_sensitive(True)
-			self.widgets['preferences']['db_user'].set_sensitive(True)
-			self.widgets['preferences']['db_port'].set_sensitive(True)
-			self.widgets['preferences']['db_host'].set_sensitive(True)
-		elif active == 3:
-			# change port number IF previous one was PostgreSQL's or MySQL one
-			if self.widgets['preferences']['db_port'].get_value() == 0 or \
-				self.widgets['preferences']['db_port'].get_value() == 5432 or \
-				self.widgets['preferences']['db_port'].get_value() == 3306:
-				self.widgets['preferences']['db_port'].set_value(1433)
-			self.widgets['preferences']['db_passwd'].set_sensitive(True)
-			self.widgets['preferences']['db_user'].set_sensitive(True)
-			self.widgets['preferences']['db_port'].set_sensitive(True)
-			self.widgets['preferences']['db_host'].set_sensitive(True)
+    def on_p_db_type_changed(self, widget):
+        active = widget.get_active()
+        if active == 0:
+            # change port number if it is something useful at the moment; for clearness
+            if self.widgets['preferences']['db_port'].get_value() == 0 or \
+                self.widgets['preferences']['db_port'].get_value() == 3306 or \
+                self.widgets['preferences']['db_port'].get_value() == 5432 or \
+                self.widgets['preferences']['db_port'].get_value() == 1433:
+                self.widgets['preferences']['db_port'].set_value(0)
+            self.widgets['preferences']['db_passwd'].set_sensitive(False)
+            self.widgets['preferences']['db_user'].set_sensitive(False)
+            self.widgets['preferences']['db_port'].set_sensitive(False)
+            self.widgets['preferences']['db_host'].set_sensitive(False)
+        elif active == 1:
+            # change port number IF previous one was MySQL's or MSSQL one
+            if self.widgets['preferences']['db_port'].get_value() == 0 or \
+                self.widgets['preferences']['db_port'].get_value() == 3306 or \
+                self.widgets['preferences']['db_port'].get_value() == 1433:
+                self.widgets['preferences']['db_port'].set_value(5432)
+            self.widgets['preferences']['db_passwd'].set_sensitive(True)
+            self.widgets['preferences']['db_user'].set_sensitive(True)
+            self.widgets['preferences']['db_port'].set_sensitive(True)
+            self.widgets['preferences']['db_host'].set_sensitive(True)
+        elif active == 2:
+            # change port number IF previous one was PostgreSQL's or MSSQL one
+            if self.widgets['preferences']['db_port'].get_value() == 0 or \
+                self.widgets['preferences']['db_port'].get_value() == 5432 or \
+                self.widgets['preferences']['db_port'].get_value() == 1433:
+                self.widgets['preferences']['db_port'].set_value(3306)
+            self.widgets['preferences']['db_passwd'].set_sensitive(True)
+            self.widgets['preferences']['db_user'].set_sensitive(True)
+            self.widgets['preferences']['db_port'].set_sensitive(True)
+            self.widgets['preferences']['db_host'].set_sensitive(True)
+        elif active == 3:
+            # change port number IF previous one was PostgreSQL's or MySQL one
+            if self.widgets['preferences']['db_port'].get_value() == 0 or \
+                self.widgets['preferences']['db_port'].get_value() == 5432 or \
+                self.widgets['preferences']['db_port'].get_value() == 3306:
+                self.widgets['preferences']['db_port'].set_value(1433)
+            self.widgets['preferences']['db_passwd'].set_sensitive(True)
+            self.widgets['preferences']['db_user'].set_sensitive(True)
+            self.widgets['preferences']['db_port'].set_sensitive(True)
+            self.widgets['preferences']['db_host'].set_sensitive(True)
 
-	def on_cb_spellchecker_pref_toggled(self, widget):
-		self.widgets['preferences']['vbox_spellchecker'].set_sensitive(widget.get_active())
+    def on_cb_spellchecker_pref_toggled(self, widget):
+        self.widgets['preferences']['vbox_spellchecker'].set_sensitive(widget.get_active())
 
-	# movie related operations --------------------------------------------
+    # movie related operations --------------------------------------------
 
-	def add_movie(self, *args):
-		add.add_movie(self)
+    def add_movie(self, *args):
+        add.add_movie(self)
 
-	def add_movie_db(self, *args):
-		add.add_movie_db(self, 0)
+    def add_movie_db(self, *args):
+        add.add_movie_db(self, 0)
 
-	def add_movie_close_db(self, *args):
-		add.add_movie_db(self, 1)
+    def add_movie_close_db(self, *args):
+        add.add_movie_db(self, 1)
 
-	def delete_movie(self, *args):
-		from delete import delete_movie
-		delete_movie(self)
+    def delete_movie(self, *args):
+        from delete import delete_movie
+        delete_movie(self)
 
-	def update_movie(self, *args):
-		add.update_movie(self)
+    def update_movie(self, *args):
+        add.update_movie(self)
 
-	def clear_details(self):
-		main_treeview.set_details(self)
+    def clear_details(self):
+        main_treeview.set_details(self)
 
-	def loan_movie(self, *args):
-		from loan import loan_movie
-		loan_movie(self)
+    def loan_movie(self, *args):
+        from loan import loan_movie
+        loan_movie(self)
 
-	def clone_movie(self, *args):
-		add.clone_movie(self)
+    def clone_movie(self, *args):
+        add.clone_movie(self)
 
-	def on_m_seen_icon_button_press_event(self, widget, event):
-		if event.button == 1 and event.type == gtk.gdk._2BUTTON_PRESS:
-			self.toggle_seen()
+    def on_m_seen_icon_button_press_event(self, widget, event):
+        if event.button == 1 and event.type == gtk.gdk._2BUTTON_PRESS:
+            self.toggle_seen()
 
-	# poster --------------------------------------------------------------
+    # poster --------------------------------------------------------------
 
-	def change_poster(self, *args):
-		from edit import change_poster
-		change_poster(self)
+    def change_poster(self, *args):
+        from edit import change_poster
+        change_poster(self)
 
-	def del_poster(self, *args):
-		from edit import delete_poster
-		delete_poster(self)
+    def del_poster(self, *args):
+        from edit import delete_poster
+        delete_poster(self)
 
-	def z_poster(self, *args):
-		treeselection = self.widgets['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		if tmp_iter is None:
-			return
-		number = tmp_model.get_value(tmp_iter, 0)
-		movie = self.db.Movie.query.filter_by(number=number).first()
-		if movie is not None:
-			tmp_dest = self.locations['posters']
-			tmp_img = os.path.join(tmp_dest, str(movie.image)+&quot;.jpg&quot;)
-			self.widgets['big_poster'].set_from_file(tmp_img)
-			self.widgets['poster_window'].show()
+    def z_poster(self, *args):
+        treeselection = self.widgets['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        if tmp_iter is None:
+            return
+        number = tmp_model.get_value(tmp_iter, 0)
+        movie = self.db.session.query(db.Movie).filter_by(number=number).first()
+        if movie is not None:
+            tmp_dest = self.locations['posters']
+            tmp_img = os.path.join(tmp_dest, str(movie.image)+&quot;.jpg&quot;)
+            self.widgets['big_poster'].set_from_file(tmp_img)
+            self.widgets['poster_window'].show()
 
-	def z_poster_hide(self, *args):
-		self.widgets['poster_window'].hide()
+    def z_poster_hide(self, *args):
+        self.widgets['poster_window'].hide()
 
-	def get_poster(self, *args):
-		&quot;&quot;&quot;tries to fetch a new big poster from amazon&quot;&quot;&quot;
-		from edit import fetch_bigger_poster
-		fetch_bigger_poster(self)
+    def get_poster(self, *args):
+        &quot;&quot;&quot;tries to fetch a new big poster from amazon&quot;&quot;&quot;
+        from edit import fetch_bigger_poster
+        fetch_bigger_poster(self)
 
-	# rating --------------------------------------------------------------
+    # rating --------------------------------------------------------------
 
-	def scale_rating_change_add(self, *args):
-		add.change_rating_from_slider(self)
+    def scale_rating_change_add(self, *args):
+        add.change_rating_from_slider(self)
 
-	def toggle_seen(self, *args):
-		m_number, m_iter = self.get_maintree_selection()
-		movie = self.db.Movie.query.filter_by(number=m_number).first()
-		if movie is not None:
-			if movie.seen:
-				movie.seen = False
-			else:
-				movie.seen = True
-			movie.update()
-			movie.flush()
-			movie.refresh()
-			self.treemodel.set_value(m_iter,6,movie.seen)
-			self.treeview_clicked()
+    def toggle_seen(self, *args):
+        m_number, m_iter = self.get_maintree_selection()
+        movie = self.db.session.query(db.Movie).filter_by(number=m_number).first()
+        if movie is not None:
+            if movie.seen:
+                movie.seen = False
+            else:
+                movie.seen = True
+            movie.update()
+            movie.flush()
+            movie.refresh()
+            self.treemodel.set_value(m_iter,6,movie.seen)
+            self.treeview_clicked()
 
-	def sugest_movie(self, *args):
-		if not self.widgets['menu']['not_seen_movies'].get_active():
-			self.widgets['menu']['not_seen_movies'].set_active(True)
-		subtotal = len(self.widgets['treeview'].get_model())
-		self.count_statusbar()
-		if subtotal &gt; 0:
-			import random
-			number = random.randrange(subtotal)
-			self.widgets['treeview'].set_cursor(number)
-			self.treeview_clicked()
-		else:
-			gutils.info(self, \
-				_(&quot;You have seen all films in your collection!&quot;), \
-				self.widgets['window'])
+    def sugest_movie(self, *args):
+        if not self.widgets['menu']['not_seen_movies'].get_active():
+            self.widgets['menu']['not_seen_movies'].set_active(True)
+        subtotal = len(self.widgets['treeview'].get_model())
+        self.count_statusbar()
+        if subtotal &gt; 0:
+            import random
+            number = random.randrange(subtotal)
+            self.widgets['treeview'].set_cursor(number)
+            self.treeview_clicked()
+        else:
+            gutils.info(self, \
+                _(&quot;You have seen all films in your collection!&quot;), \
+                self.widgets['window'])
 
-	# volumes/collections ----------------------------------------------{{{
-	def on_am_collection_combo_changed(self,widget):
-		if widget.get_active()!=-1:
-			self._selected_collection = self.collection_combo_ids[widget.get_active()]
-	def on_am_volume_combo_changed(self,widget):
-		if widget.get_active()!=-1:
-			self._selected_volume = self.volume_combo_ids[widget.get_active()]
+    # volumes/collections ----------------------------------------------{{{
+    def on_am_collection_combo_changed(self,widget):
+        if widget.get_active()!=-1:
+            self._selected_collection = self.collection_combo_ids[widget.get_active()]
+    def on_am_volume_combo_changed(self,widget):
+        if widget.get_active()!=-1:
+            self._selected_volume = self.volume_combo_ids[widget.get_active()]
 
-	def add_volume(self, widget):
-		from update import update_volume_combo_ids
-		name = self.widgets['add']['volume'].get_active_text()
-		vol = self.db.Volume(name=name)
-		if vol and vol.add_to_db():
-			update_volume_combo_ids(self)
-			initialize.fill_volumes_combo(self, id)
+    def add_volume(self, widget):
+        from update import update_volume_combo_ids
+        name = self.widgets['add']['volume'].get_active_text()
+        vol = self.db.Volume(name=name)
+        if vol and vol.add_to_db():
+            update_volume_combo_ids(self)
+            initialize.fill_volumes_combo(self, id)
 
-	def add_collection(self, widget):
-		from update import update_collection_combo_ids
-		name = self.widgets['add']['collection'].get_active_text()
-		col = self.db.Collection(name=name)
-		if col and col.add_to_db():
-			update_collection_combo_ids(self)
-			initialize.fill_collections_combo(self, id)
+    def add_collection(self, widget):
+        from update import update_collection_combo_ids
+        name = self.widgets['add']['collection'].get_active_text()
+        col = self.db.Collection(name=name)
+        if col and col.add_to_db():
+            update_collection_combo_ids(self)
+            initialize.fill_collections_combo(self, id)
 
-	def remove_volume(self, widget):
-		from update import update_volume_combo_ids
-		vol_id = self._selected_volume
-		vol = self.db.Volume.query.filter_by(volume_id=vol_id).first()
-		if vol and vol.remove_from_db():
-			update_volume_combo_ids(self)
-			initialize.fill_volumes_combo(self, id)
+    def remove_volume(self, widget):
+        from update import update_volume_combo_ids
+        vol_id = self._selected_volume
+        vol = self.db.session.query(db.Volume).filter_by(volume_id=vol_id).first()
+        if vol and vol.remove_from_db():
+            update_volume_combo_ids(self)
+            initialize.fill_volumes_combo(self, id)
 
-	def remove_collection(self, widget):
-		from update import update_collection_combo_ids
-		col_id = self._selected_collection
-		col = self.db.Collection.query.filter_by(collection_id=col_id).first()
-		if col and col.remove_from_db():
-			update_collection_combo_ids(self)
-			initialize.fill_collections_combo(self, id)
+    def remove_collection(self, widget):
+        from update import update_collection_combo_ids
+        col_id = self._selected_collection
+        col = self.db.session.query(db.Collection).filter_by(collection_id=col_id).first()
+        if col and col.remove_from_db():
+            update_collection_combo_ids(self)
+            initialize.fill_collections_combo(self, id)
 
-	def rename_volume(self, widget):
-		vol_id = self._selected_volume
-		if vol_id != 0:
-			new_name = self.widgets['add']['volume'].get_active_text()
-			vol = self.db.Volume.query.filter_by(volume_id=vol_id).first()
-			if vol:
-				vol.name=new_name
-				if vol.update_in_db():
-					initialize.fill_volumes_combo(self, default=vol_id)
+    def rename_volume(self, widget):
+        vol_id = self._selected_volume
+        if vol_id != 0:
+            new_name = self.widgets['add']['volume'].get_active_text()
+            vol = self.db.session.query(db.Volume).filter_by(volume_id=vol_id).first()
+            if vol:
+                vol.name=new_name
+                if vol.update_in_db():
+                    initialize.fill_volumes_combo(self, default=vol_id)
 
-	def rename_collection(self, widget):
-		col_id = self.e_selected_collection
-		if col_id != 0:
-			new_name = self.widgets['add']['collection'].get_active_text()
-			col = self.db.Collection.query.filter_by(collection_id=col_id).first()
-			if col is not None:
-				col.name=new_name
-				if col.update_in_db():
-					initialize.fill_collections_combo(self, default=col_id)
+    def rename_collection(self, widget):
+        col_id = self.e_selected_collection
+        if col_id != 0:
+            new_name = self.widgets['add']['collection'].get_active_text()
+            col = self.db.session.query(db.Collection).filter_by(collection_id=col_id).first()
+            if col is not None:
+                col.name=new_name
+                if col.update_in_db():
+                    initialize.fill_collections_combo(self, default=col_id)
 
-	def show_volume(self, widget):
-		quick_filter.clear_filter(self)
-		vol_id = self.db.Movie.query.filter_by(movie_id=self._movie_id).first().volume_id
-		pos = gutils.findKey(vol_id, self.volume_combo_ids)
-		self.widgets['filter']['volume'].set_active(pos)
+    def show_volume(self, widget):
+        quick_filter.clear_filter(self)
+        vol_id = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).first().volume_id
+        pos = gutils.findKey(vol_id, self.volume_combo_ids)
+        self.widgets['filter']['volume'].set_active(pos)
 
-	def show_collection(self, widget):
-		quick_filter.clear_filter(self)
-		col_id = self.db.Movie.query.filter_by(movie_id=self._movie_id).first().collection_id
-		pos = gutils.findKey(col_id, self.collection_combo_ids)
-		self.widgets['filter']['collection'].set_active(pos)
-	#}}}
+    def show_collection(self, widget):
+        quick_filter.clear_filter(self)
+        col_id = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).first().collection_id
+        pos = gutils.findKey(col_id, self.collection_combo_ids)
+        self.widgets['filter']['collection'].set_active(pos)
+    #}}}
 
-	# languages -------------------------------------------------------{{{
-	def on_lang_treeview_button_press_event(self, widget, event):
-		&quot;&quot;&quot;add a right click menu to lang tree&quot;&quot;&quot;
-		if event.button == 3:
-			x = int(event.x)
-			y = int(event.y)
-			time = event.time
-			pthinfo = self.widgets['add']['lang_treeview'].get_path_at_pos(x, y)
-			if pthinfo is not None:
-				path, col, cellx, celly = pthinfo
-				self.widgets['add']['lang_treeview'].grab_focus()
-				self.widgets['add']['lang_treeview'].set_cursor( path, col, 0)
-			self.widgets['add']['lang_menu'].popup(None, None, None, event.button, time)
-	
-	def create_language_row(self, lang=None):
-		if len(self.languages_ids) == 1:
-			return False
+    # languages -------------------------------------------------------{{{
+    def on_lang_treeview_button_press_event(self, widget, event):
+        &quot;&quot;&quot;add a right click menu to lang tree&quot;&quot;&quot;
+        if event.button == 3:
+            x = int(event.x)
+            y = int(event.y)
+            time = event.time
+            pthinfo = self.widgets['add']['lang_treeview'].get_path_at_pos(x, y)
+            if pthinfo is not None:
+                path, col, cellx, celly = pthinfo
+                self.widgets['add']['lang_treeview'].grab_focus()
+                self.widgets['add']['lang_treeview'].set_cursor( path, col, 0)
+            self.widgets['add']['lang_menu'].popup(None, None, None, event.button, time)
+    
+    def create_language_row(self, lang=None):
+        if len(self.languages_ids) == 1:
+            return False
 
-		def get_text(model, id):
-			if id == -1:
-				return model[0][1]
-			else:
-				for i in model:
-					if i[0] == id:
-						return i[1]
+        def get_text(model, id):
+            if id == -1:
+                return model[0][1]
+            else:
+                for i in model:
+                    if i[0] == id:
+                        return i[1]
 
-		model = self.widgets['add']['lang_treeview'].get_model()
-		myiter = model.append(None)
-		if lang:
-			model.set_value(myiter, 0, get_text(self.lang['lang'], lang.lang_id))
-			model.set_value(myiter, 1, get_text(self.lang['type'], lang.type))
-			model.set_value(myiter, 2, get_text(self.lang['acodec'], lang.acodec_id))
-			model.set_value(myiter, 3, get_text(self.lang['achannel'], lang.achannel_id))
-			model.set_value(myiter, 4, get_text(self.lang['subformat'], lang.subformat_id))
-		else:
-			model.set_value(myiter, 0, get_text(self.lang['lang'], -1))
-	
-	def on_tv_lang_combo_edited(self, widget, path, new_text, column):
-		model = self.widgets['add']['lang_treeview'].get_model()
-		model[path][column] = new_text
-		mymodel = widget.get_property('model')
-		if column == 1:	# type
-			my_type = 0
-			for i in mymodel:
-				if i[1] == new_text:
-					my_type = i[0]
-			if my_type == 3:	# subtitles
-				model[path][2] = ''
-				model[path][3] = ''
-			else:
-				model[path][4] = ''
-		if column == 4:	# subtitle format
-			model[path][1] = _('subtitles')
-			model[path][2] = ''
-			model[path][3] = ''
-		if column in (2,3):
-			model[path][4] = ''
-			if model[path][1] == _('subtitles'):
-				model[path][1] = ''
+        model = self.widgets['add']['lang_treeview'].get_model()
+        myiter = model.append(None)
+        if lang:
+            model.set_value(myiter, 0, get_text(self.lang['lang'], lang.lang_id))
+            model.set_value(myiter, 1, get_text(self.lang['type'], lang.type))
+            model.set_value(myiter, 2, get_text(self.lang['acodec'], lang.acodec_id))
+            model.set_value(myiter, 3, get_text(self.lang['achannel'], lang.achannel_id))
+            model.set_value(myiter, 4, get_text(self.lang['subformat'], lang.subformat_id))
+        else:
+            model.set_value(myiter, 0, get_text(self.lang['lang'], -1))
+    
+    def on_tv_lang_combo_edited(self, widget, path, new_text, column):
+        model = self.widgets['add']['lang_treeview'].get_model()
+        model[path][column] = new_text
+        mymodel = widget.get_property('model')
+        if column == 1:    # type
+            my_type = 0
+            for i in mymodel:
+                if i[1] == new_text:
+                    my_type = i[0]
+            if my_type == 3:    # subtitles
+                model[path][2] = ''
+                model[path][3] = ''
+            else:
+                model[path][4] = ''
+        if column == 4:    # subtitle format
+            model[path][1] = _('subtitles')
+            model[path][2] = ''
+            model[path][3] = ''
+        if column in (2,3):
+            model[path][4] = ''
+            if model[path][1] == _('subtitles'):
+                model[path][1] = ''
 
-	def on_am_lang_add_clicked(self, widget):
-		self.create_language_row()
-	def on_am_lang_remove_clicked(self, widget):
-		treeselection = self.widgets['add']['lang_treeview'].get_selection()
-		if treeselection:
-			(tmp_model, tmp_iter) = treeselection.get_selected()
-			if tmp_iter:
-				tmp_model.remove(tmp_iter)
+    def on_am_lang_add_clicked(self, widget):
+        self.create_language_row()
+    def on_am_lang_remove_clicked(self, widget):
+        treeselection = self.widgets['add']['lang_treeview'].get_selection()
+        if treeselection:
+            (tmp_model, tmp_iter) = treeselection.get_selected()
+            if tmp_iter:
+                tmp_model.remove(tmp_iter)
 
-	# preferences
-	def on_lang_add_clicked(self, widget):
-		lang = self.db.Lang(name=self.widgets['preferences']['lang_name'].get_active_text())
-		if lang and lang.add_to_db():
-			initialize.language_combos(self)
+    # preferences
+    def on_lang_add_clicked(self, widget):
+        lang = self.db.Lang(name=self.widgets['preferences']['lang_name'].get_active_text())
+        if lang and lang.add_to_db():
+            initialize.language_combos(self)
 
-	def on_lang_remove_clicked(self, widget):
-		active = self.widgets['preferences']['lang_name'].get_active()
-		if active&gt;0:
-			lang_id = self.languages_ids[active]
-			lang = self.db.Lang.query.filter_by(lang_id=lang_id).first()
-			if lang and lang.remove_from_db():
-				initialize.language_combos(self)
-		else:
-			self.debug.show(&quot;You have to select language first&quot;)
+    def on_lang_remove_clicked(self, widget):
+        active = self.widgets['preferences']['lang_name'].get_active()
+        if active&gt;0:
+            lang_id = self.languages_ids[active]
+            lang = self.db.session.query(db.Lang).filter_by(lang_id=lang_id).first()
+            if lang and lang.remove_from_db():
+                initialize.language_combos(self)
+        else:
+            self.debug.show(&quot;You have to select language first&quot;)
 
-	def on_lang_rename_clicked(self, widget):
-		try:
-			active = self.lang_name_active
-		except:
-			return False
-		lang_id = self.languages_ids[active]
-		if lang_id&gt;0:
-			lang = self.db.Lang.query.filter_by(lang_id=lang_id).first()
-			if lang is not None:
-				lang.name = self.widgets['preferences']['lang_name'].get_active_text()
-				if lang.update_in_db():
-					initialize.language_combos(self)
+    def on_lang_rename_clicked(self, widget):
+        try:
+            active = self.lang_name_active
+        except:
+            return False
+        lang_id = self.languages_ids[active]
+        if lang_id&gt;0:
+            lang = self.db.session.query(db.Lang).filter_by(lang_id=lang_id).first()
+            if lang is not None:
+                lang.name = self.widgets['preferences']['lang_name'].get_active_text()
+                if lang.update_in_db():
+                    initialize.language_combos(self)
 
-	def on_lang_name_combo_changed(self, widget):
-		active = self.widgets['preferences']['lang_name'].get_active()
-		if active&gt;-1:
-			self.lang_name_active = active
-	#}}}
+    def on_lang_name_combo_changed(self, widget):
+        active = self.widgets['preferences']['lang_name'].get_active()
+        if active&gt;-1:
+            self.lang_name_active = active
+    #}}}
 
-	# tags -------------------------------------------------------------{{{
-	def on_tag_add_clicked(self, widget):
-		tag = self.db.Tag(name=self.widgets['preferences']['tag_name'].get_active_text())
-		if tag and tag.add_to_db():
-			initialize.fill_preferences_tags_combo(self)
-			initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
-			update.update_bytag_combo_ids(self)
-			initialize.fill_bytag_combo(self)
+    # tags -------------------------------------------------------------{{{
+    def on_tag_add_clicked(self, widget):
+        tag = self.db.Tag(name=self.widgets['preferences']['tag_name'].get_active_text())
+        if tag and tag.add_to_db():
+            initialize.fill_preferences_tags_combo(self)
+            initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
+            update.update_bytag_combo_ids(self)
+            initialize.fill_bytag_combo(self)
 
-	def on_tag_remove_clicked(self, widget):
-		active = self.widgets['preferences']['tag_name'].get_active()
-		if active&gt;-1:
-			tag_id = self.tags_ids[active]
-			tag = self.db.Tag.query.filter_by(tag_id=tag_id).first()
-			if tag and tag.remove_from_db():
-				initialize.fill_preferences_tags_combo(self)
-				initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
-				update.update_bytag_combo_ids(self)
-				initialize.fill_bytag_combo(self)
-		else:
-			self.debug.show(&quot;You have to select tag first&quot;)
+    def on_tag_remove_clicked(self, widget):
+        active = self.widgets['preferences']['tag_name'].get_active()
+        if active&gt;-1:
+            tag_id = self.tags_ids[active]
+            tag = self.db.session.query(db.Tag).filter_by(tag_id=tag_id).first()
+            if tag and tag.remove_from_db():
+                initialize.fill_preferences_tags_combo(self)
+                initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
+                update.update_bytag_combo_ids(self)
+                initialize.fill_bytag_combo(self)
+        else:
+            self.debug.show(&quot;You have to select tag first&quot;)
 
-	def on_tag_rename_clicked(self, widget):
-		try:
-			active = self.tag_name_active
-		except:
-			return False
-		tag_id = self.tags_ids[active]
-		tag = self.db.Tag.query.filter_by(tag_id=tag_id).first()
-		if tag is not None:
-			tag.name = self.widgets['preferences']['tag_name'].get_active_text()
-			if tag.update_in_db():
-				initialize.fill_preferences_tags_combo(self)
-				initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
-				update.update_bytag_combo_ids(self)
-				initialize.fill_bytag_combo(self)
+    def on_tag_rename_clicked(self, widget):
+        try:
+            active = self.tag_name_active
+        except:
+            return False
+        tag_id = self.tags_ids[active]
+        tag = self.db.session.query(db.Tag).filter_by(tag_id=tag_id).first()
+        if tag is not None:
+            tag.name = self.widgets['preferences']['tag_name'].get_active_text()
+            if tag.update_in_db():
+                initialize.fill_preferences_tags_combo(self)
+                initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
+                update.update_bytag_combo_ids(self)
+                initialize.fill_bytag_combo(self)
 
-	def on_tag_name_combo_changed(self, widget):
-		active = self.widgets['preferences']['tag_name'].get_active()
-		if active&gt;-1:
-			self.tag_name_active = active
-	# }}}
+    def on_tag_name_combo_changed(self, widget):
+        active = self.widgets['preferences']['tag_name'].get_active()
+        if active&gt;-1:
+            self.tag_name_active = active
+    # }}}
 
-	# audio codecs ------------------------------------------------------{{{
-	def on_acodec_add_clicked(self, widget):
-		acodec = self.db.ACodec(name=self.widgets['preferences']['acodec_name'].get_active_text())
-		if acodec and acodec.add_to_db():
-			initialize.acodec_combos(self)
+    # audio codecs ------------------------------------------------------{{{
+    def on_acodec_add_clicked(self, widget):
+        acodec = self.db.ACodec(name=self.widgets['preferences']['acodec_name'].get_active_text())
+        if acodec and acodec.add_to_db():
+            initialize.acodec_combos(self)
 
-	def on_acodec_remove_clicked(self, widget):
-		active = self.widgets['preferences']['acodec_name'].get_active()
-		if active&gt;0:
-			acodec_id = self.acodecs_ids[active]
-			acodec = self.db.ACodec.query.filter_by(acodec_id=acodec_id).first()
-			if acodec and acodec.remove_from_db():
-				initialize.acodec_combos(self)
-		else:
-			self.debug.show(&quot;You have to select audio codec first&quot;)
+    def on_acodec_remove_clicked(self, widget):
+        active = self.widgets['preferences']['acodec_name'].get_active()
+        if active&gt;0:
+            acodec_id = self.acodecs_ids[active]
+            acodec = self.db.session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
+            if acodec and acodec.remove_from_db():
+                initialize.acodec_combos(self)
+        else:
+            self.debug.show(&quot;You have to select audio codec first&quot;)
 
-	def on_acodec_rename_clicked(self, widget):
-		try:
-			active = self.acodec_name_active
-		except:
-			return False
-		acodec_id = self.acodecs_ids[active]
-		acodec = self.db.ACodec.query.filter_by(acodec_id=acodec_id).first()
-		if acodec is not None:
-			acodec.name = self.widgets['preferences']['acodec_name'].get_active_text()
-			if acodec.update_in_db():
-				initialize.acodec_combos(self)
+    def on_acodec_rename_clicked(self, widget):
+        try:
+            active = self.acodec_name_active
+        except:
+            return False
+        acodec_id = self.acodecs_ids[active]
+        acodec = self.db.session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
+        if acodec is not None:
+            acodec.name = self.widgets['preferences']['acodec_name'].get_active_text()
+            if acodec.update_in_db():
+                initialize.acodec_combos(self)
 
-	def on_acodec_name_combo_changed(self, widget):
-		active = self.widgets['preferences']['acodec_name'].get_active()
-		if active&gt;-1:
-			self.acodec_name_active = active
-	# }}}
+    def on_acodec_name_combo_changed(self, widget):
+        active = self.widgets['preferences']['acodec_name'].get_active()
+        if active&gt;-1:
+            self.acodec_name_active = active
+    # }}}
 
-	# audio channels ----------------------------------------------------{{{
-	def on_achannel_add_clicked(self, widget):
-		achannel = self.db.AChannel(name=self.widgets['preferences']['achannel_name'].get_active_text())
-		if achannel and achannel.add_to_db():
-			initialize.achannel_combos(self)
+    # audio channels ----------------------------------------------------{{{
+    def on_achannel_add_clicked(self, widget):
+        achannel = self.db.AChannel(name=self.widgets['preferences']['achannel_name'].get_active_text())
+        if achannel and achannel.add_to_db():
+            initialize.achannel_combos(self)
 
-	def on_achannel_remove_clicked(self, widget):
-		active = self.widgets['preferences']['achannel_name'].get_active()
-		if active&gt;0:
-			achannel_id = self.achannels_ids[active]
-			achannel = self.db.AChannel.query.filter_by(achannel_id=achannel_id).first()
-			if achannel and achannel.remove_from_db():
-				initialize.achannel_combos(self)
-		else:
-			self.debug.show(&quot;You have to select audio channel first&quot;)
+    def on_achannel_remove_clicked(self, widget):
+        active = self.widgets['preferences']['achannel_name'].get_active()
+        if active&gt;0:
+            achannel_id = self.achannels_ids[active]
+            achannel = self.db.session.query(db.AChannel).filter_by(achannel_id=achannel_id).first()
+            if achannel and achannel.remove_from_db():
+                initialize.achannel_combos(self)
+        else:
+            self.debug.show(&quot;You have to select audio channel first&quot;)
 
-	def on_achannel_rename_clicked(self, widget):
-		try:
-			active = self.achannel_name_active
-		except:
-			return False
-		achannel_id = self.achannels_ids[active]
-		achannel = self.db.AChannel.query.filter_by(achannel_id=achannel_id).first()
-		if achannel is not None:
-			achannel.name = self.widgets['preferences']['achannel_name'].get_active_text()
-			if achannel.update_in_db():
-				initialize.achannel_combos(self)
+    def on_achannel_rename_clicked(self, widget):
+        try:
+            active = self.achannel_name_active
+        except:
+            return False
+        achannel_id = self.achannels_ids[active]
+        achannel = self.db.session.query(db.AChannel).filter_by(achannel_id=achannel_id).first()
+        if achannel is not None:
+            achannel.name = self.widgets['preferences']['achannel_name'].get_active_text()
+            if achannel.update_in_db():
+                initialize.achannel_combos(self)
 
-	def on_achannel_name_combo_changed(self, widget):
-		active = self.widgets['preferences']['achannel_name'].get_active()
-		if active&gt;-1:
-			self.achannel_name_active = active
-	# }}}
+    def on_achannel_name_combo_changed(self, widget):
+        active = self.widgets['preferences']['achannel_name'].get_active()
+        if active&gt;-1:
+            self.achannel_name_active = active
+    # }}}
 
-	# subformats -------------------------------------------------------------{{{
-	def on_subformat_add_clicked(self, widget):
-		subformat = self.db.SubFormat(name=self.widgets['preferences']['subformat_name'].get_active_text())
-		if subformat and subformat.add_to_db():
-			initialize.subformat_combos(self)
+    # subformats -------------------------------------------------------------{{{
+    def on_subformat_add_clicked(self, widget):
+        subformat = self.db.SubFormat(name=self.widgets['preferences']['subformat_name'].get_active_text())
+        if subformat and subformat.add_to_db():
+            initialize.subformat_combos(self)
 
-	def on_subformat_remove_clicked(self, widget):
-		active = self.widgets['preferences']['subformat_name'].get_active()
-		if active&gt;0:
-			subformat_id = self.subformats_ids[active]
-			subformat = self.db.SubFormat.query.filter_by(subformat_id=subformat_id).first()
-			if subformat and subformat.remove_from_db():
-				initialize.subformat_combos(self)
-		else:
-			self.debug.show(&quot;You have to select subtitle format first&quot;)
+    def on_subformat_remove_clicked(self, widget):
+        active = self.widgets['preferences']['subformat_name'].get_active()
+        if active&gt;0:
+            subformat_id = self.subformats_ids[active]
+            subformat = self.db.session.query(db.SubFormat).filter_by(subformat_id=subformat_id).first()
+            if subformat and subformat.remove_from_db():
+                initialize.subformat_combos(self)
+        else:
+            self.debug.show(&quot;You have to select subtitle format first&quot;)
 
-	def on_subformat_rename_clicked(self, widget):
-		try:
-			active = self.subformat_name_active
-		except:
-			return False
-		subformat_id = self.subformats_ids[active]
-		subformat = self.db.SubFormat.query.filter_by(subformat_id=subformat_id).first()
-		if subformat is not None:
-			subformat.name = self.widgets['preferences']['subformat_name'].get_active_text()
-			if subformat.update_in_db():
-				initialize.subformat_combos(self)
+    def on_subformat_rename_clicked(self, widget):
+        try:
+            active = self.subformat_name_active
+        except:
+            return False
+        subformat_id = self.subformats_ids[active]
+        subformat = self.db.session.query(db.SubFormat).filter_by(subformat_id=subformat_id).first()
+        if subformat is not None:
+            subformat.name = self.widgets['preferences']['subformat_name'].get_active_text()
+            if subformat.update_in_db():
+                initialize.subformat_combos(self)
 
-	def on_subformat_name_combo_changed(self, widget):
-		active = self.widgets['preferences']['subformat_name'].get_active()
-		if active&gt;-1:
-			self.subformat_name_active = active
-	# }}}
+    def on_subformat_name_combo_changed(self, widget):
+        active = self.widgets['preferences']['subformat_name'].get_active()
+        if active&gt;-1:
+            self.subformat_name_active = active
+    # }}}
 
-	# media ------------------------------------------------------------{{{
-	def on_medium_add_clicked(self, widget):
-		medium = self.db.Medium(name=self.widgets['preferences']['medium_name'].get_active_text())
-		if medium and medium.add_to_db():
-			initialize.media_combos(self)
+    # media ------------------------------------------------------------{{{
+    def on_medium_add_clicked(self, widget):
+        medium = self.db.Medium(name=self.widgets['preferences']['medium_name'].get_active_text())
+        if medium and medium.add_to_db():
+            initialize.media_combos(self)
 
-	def on_medium_remove_clicked(self, widget):
-		active = self.widgets['preferences']['medium_name'].get_active()
-		if active&gt;-1:
-			medium_id = self.media_ids[active]
-			medium = self.db.Medium.query.filter_by(medium_id=medium_id).first()
-			if medium and medium.remove_from_db():
-				initialize.media_combos(self)
-		else:
-			self.debug.show(&quot;You have to select medium first&quot;)
+    def on_medium_remove_clicked(self, widget):
+        active = self.widgets['preferences']['medium_name'].get_active()
+        if active&gt;-1:
+            medium_id = self.media_ids[active]
+            medium = self.db.session.query(db.Medium).filter_by(medium_id=medium_id).first()
+            if medium and medium.remove_from_db():
+                initialize.media_combos(self)
+        else:
+            self.debug.show(&quot;You have to select medium first&quot;)
 
-	def on_medium_rename_clicked(self, widget):
-		try:
-			active = self.medium_name_active
-		except:
-			return False
-		medium_id = self.media_ids[active]
-		medium = self.db.Medium.query.filter_by(medium_id=medium_id).first()
-		if medium is not None:
-			medium.name = self.widgets['preferences']['medium_name'].get_active_text()
-			if medium.update_in_db():
-				initialize.media_combos(self)
+    def on_medium_rename_clicked(self, widget):
+        try:
+            active = self.medium_name_active
+        except:
+            return False
+        medium_id = self.media_ids[active]
+        medium = self.db.session.query(db.Medium).filter_by(medium_id=medium_id).first()
+        if medium is not None:
+            medium.name = self.widgets['preferences']['medium_name'].get_active_text()
+            if medium.update_in_db():
+                initialize.media_combos(self)
 
-	def on_medium_name_combo_changed(self, widget):
-		active = self.widgets['preferences']['medium_name'].get_active()
-		if active&gt;-1:
-			self.medium_name_active = active
-	# }}}
+    def on_medium_name_combo_changed(self, widget):
+        active = self.widgets['preferences']['medium_name'].get_active()
+        if active&gt;-1:
+            self.medium_name_active = active
+    # }}}
 
-	# vcodecs -------------------------------------------------------------{{{
-	def on_vcodec_add_clicked(self, widget):
-		vcodec = self.db.VCodec(name=self.widgets['preferences']['vcodec_name'].get_active_text())
-		if vcodec and vcodec.add_to_db():
-			initialize.vcodec_combos(self)
+    # vcodecs -------------------------------------------------------------{{{
+    def on_vcodec_add_clicked(self, widget):
+        vcodec = self.db.VCodec(name=self.widgets['preferences']['vcodec_name'].get_active_text())
+        if vcodec and vcodec.add_to_db():
+            initialize.vcodec_combos(self)
 
-	def on_vcodec_remove_clicked(self, widget):
-		active = self.widgets['preferences']['vcodec_name'].get_active()
-		if active&gt;-1:
-			vcodec_id = self.vcodecs_ids[active]
-			vcodec = self.db.VCodec.query.filter_by(vcodec_id=vcodec_id).first()
-			if vcodec and vcodec.remove_from_db():
-				initialize.vcodec_combos(self)
-		else:
-			self.debug.show(&quot;You have to select video codec first&quot;)
+    def on_vcodec_remove_clicked(self, widget):
+        active = self.widgets['preferences']['vcodec_name'].get_active()
+        if active&gt;-1:
+            vcodec_id = self.vcodecs_ids[active]
+            vcodec = self.db.session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
+            if vcodec and vcodec.remove_from_db():
+                initialize.vcodec_combos(self)
+        else:
+            self.debug.show(&quot;You have to select video codec first&quot;)
 
-	def on_vcodec_rename_clicked(self, widget):
-		try:
-			active = self.vcodec_name_active
-		except:
-			return False
-		vcodec_id = self.vcodecs_ids[active]
-		vcodec = self.db.VCodec.query.filter_by(vcodec_id=vcodec_id).first()
-		if vcodec is not None:
-			vcodec.name = self.widgets['preferences']['vcodec_name'].get_active_text()
-			if vcodec.update_in_db():
-				initialize.vcodec_combos(self)
+    def on_vcodec_rename_clicked(self, widget):
+        try:
+            active = self.vcodec_name_active
+        except:
+            return False
+        vcodec_id = self.vcodecs_ids[active]
+        vcodec = self.db.session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
+        if vcodec is not None:
+            vcodec.name = self.widgets['preferences']['vcodec_name'].get_active_text()
+            if vcodec.update_in_db():
+                initialize.vcodec_combos(self)
 
-	def on_vcodec_name_combo_changed(self, widget):
-		active = self.widgets['preferences']['vcodec_name'].get_active()
-		if active&gt;-1:
-			self.vcodec_name_active = active
-	# }}}
+    def on_vcodec_name_combo_changed(self, widget):
+        active = self.widgets['preferences']['vcodec_name'].get_active()
+        if active&gt;-1:
+            self.vcodec_name_active = active
+    # }}}
 
-	# main treeview -------------------------------------------------------
-	def treeview_clicked(self, *args):
-		main_treeview.treeview_clicked(self)
+    # main treeview -------------------------------------------------------
+    def treeview_clicked(self, *args):
+        main_treeview.treeview_clicked(self)
 
-	def populate_treeview(self, statement=None, where=None):
-		main_treeview.populate(self, statement, where)
+    def populate_treeview(self, statement=None, where=None):
+        main_treeview.populate(self, statement, where)
 
-	def get_maintree_selection(self):
-		treeselection = self.widgets['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		if tmp_model and tmp_iter:
-			return tmp_model.get_value(tmp_iter, 0), tmp_iter
-		else:
-			return None, None
+    def get_maintree_selection(self):
+        treeselection = self.widgets['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        if tmp_model and tmp_iter:
+            return tmp_model.get_value(tmp_iter, 0), tmp_iter
+        else:
+            return None, None
 
-	# backup/restore ------------------------------------------------------	
+    # backup/restore ------------------------------------------------------    
 
-	def backup(self, *args):
-		from backup import backup
-		backup(self)
+    def backup(self, *args):
+        from backup import backup
+        backup(self)
 
-	def restore(self, *args):
-		response = gutils.question(self, \
-			_(&quot;&quot;&quot;Are you sure you want to restore?
+    def restore(self, *args):
+        response = gutils.question(self, \
+            _(&quot;&quot;&quot;Are you sure you want to restore?
 Your current movie collection will be replaced.
 You can't undo this operation.&quot;&quot;&quot;), \
-			1, self.widgets['window'])
-		if response == gtk.RESPONSE_YES:
-			from backup import restore
-			restore(self)
+            1, self.widgets['window'])
+        if response == gtk.RESPONSE_YES:
+            from backup import restore
+            restore(self)
 
-	def merge(self, *args):
-		response = gutils.question(self, \
-			_(&quot;&quot;&quot;Are you sure you want to mix?
+    def merge(self, *args):
+        response = gutils.question(self, \
+            _(&quot;&quot;&quot;Are you sure you want to mix?
 Your current movie collection will be mixed with a backup.
 You can't undo this operation.&quot;&quot;&quot;), \
-			1, self.widgets['window'])
-		if response == gtk.RESPONSE_YES:
-			from backup import merge
-			merge(self)
+            1, self.widgets['window'])
+        if response == gtk.RESPONSE_YES:
+            from backup import merge
+            merge(self)
 
-	# cover ---------------------------------------------------------------
+    # cover ---------------------------------------------------------------
 
-	def print_cover_simple_show(self, *args):
-		self.widgets['print_cover']['cs_size'].set_active(0)
-		self.widgets['print_cover']['window_simple'].show()
+    def print_cover_simple_show(self, *args):
+        self.widgets['print_cover']['cs_size'].set_active(0)
+        self.widgets['print_cover']['window_simple'].show()
 
-	def print_cover_simple_hide(self, *args):
-		self.widgets['print_cover']['window_simple'].hide()
+    def print_cover_simple_hide(self, *args):
+        self.widgets['print_cover']['window_simple'].hide()
 
-	def print_cover_simple_process(self, *args):
-		from cover import cover_simple
-		movie_number, movie_iter = self.get_maintree_selection()
-		if movie_number is not None:
-			cover_simple(self, movie_number)
-		else:
-			gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
+    def print_cover_simple_process(self, *args):
+        from cover import cover_simple
+        movie_number, movie_iter = self.get_maintree_selection()
+        if movie_number is not None:
+            cover_simple(self, movie_number)
+        else:
+            gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
 
-	def print_cover_image(self, *args):
-		self.widgets['print_cover']['ci_size'].set_active(0)
-		self.widgets['print_cover']['window_image'].show()
+    def print_cover_image(self, *args):
+        self.widgets['print_cover']['ci_size'].set_active(0)
+        self.widgets['print_cover']['window_image'].show()
 
-	def print_cover_image_process(self, *args):
-		from cover import cover_image
-		self.widgets['print_cover']['window_image'].hide()
-		movie_number, movie_iter = self.get_maintree_selection()
-		cover_image(self, movie_number)
+    def print_cover_image_process(self, *args):
+        from cover import cover_image
+        self.widgets['print_cover']['window_image'].hide()
+        movie_number, movie_iter = self.get_maintree_selection()
+        cover_image(self, movie_number)
 
-	def print_cover_image_hide(self, *args):
-		self.widgets['print_cover']['window_image'].hide()
+    def print_cover_image_hide(self, *args):
+        self.widgets['print_cover']['window_image'].hide()
 
-	# loans management ----------------------------------------------------	
+    # loans management ----------------------------------------------------    
 
-	def show_people_window(self, *args):
-		from people import show_people_window
-		show_people_window(self)
+    def show_people_window(self, *args):
+        from people import show_people_window
+        show_people_window(self)
 
-	def hide_people_window(self, *args):
-		from people import  hide_people_window
-		hide_people_window(self)
+    def hide_people_window(self, *args):
+        from people import  hide_people_window
+        hide_people_window(self)
 
-	def add_person(self, *args):
-		from people import add_person
-		add_person(self)
+    def add_person(self, *args):
+        from people import add_person
+        add_person(self)
 
-	def add_person_cancel(self, *args):
-		from people import add_person_cancel
-		add_person_cancel(self)
+    def add_person_cancel(self, *args):
+        from people import add_person_cancel
+        add_person_cancel(self)
 
-	def add_person_db(self, *args):
-		from people import add_person_db
-		add_person_db(self)
+    def add_person_db(self, *args):
+        from people import add_person_db
+        add_person_db(self)
 
-	def delete_person(self, *args):
-		from people import delete_person
-		delete_person(self)
+    def delete_person(self, *args):
+        from people import delete_person
+        delete_person(self)
 
-	def edit_person(self, *args):
-		from people import edit_person
-		edit_person(self)
+    def edit_person(self, *args):
+        from people import edit_person
+        edit_person(self)
 
-	def update_person(self, *args):
-		from people import update_person
-		update_person(self)
+    def update_person(self, *args):
+        from people import update_person
+        update_person(self)
 
-	def edit_person_cancel(self, *args):
-		from people import edit_person_cancel
-		edit_person_cancel(self)
+    def edit_person_cancel(self, *args):
+        from people import edit_person_cancel
+        edit_person_cancel(self)
 
-	def cancel_loan(self, *args):
-		from loan import cancel_loan
-		cancel_loan(self)
+    def cancel_loan(self, *args):
+        from loan import cancel_loan
+        cancel_loan(self)
 
-	def commit_loan(self, *args):
-		from loan import commit_loan
-		commit_loan(self)
+    def commit_loan(self, *args):
+        from loan import commit_loan
+        commit_loan(self)
 
-	def return_loan(self, *args):
-		from loan import return_loan
-		return_loan(self)
+    def return_loan(self, *args):
+        from loan import return_loan
+        return_loan(self)
 
-	def email_reminder(self, *args):
-		from gemail import send_email
-		send_email(self)
+    def email_reminder(self, *args):
+        from gemail import send_email
+        send_email(self)
 
-	# statusbar -----------------------------------------------------------
+    # statusbar -----------------------------------------------------------
 
-	def count_statusbar(self):
-		allmovies = self.db.Movie.query.count()
-		loaned = self.db.Movie.query.filter_by(loaned=True).count()
-		not_seen = self.db.Movie.query.filter_by(seen=False).count()
-		self.update_statusbar(str(allmovies) + ' (' + str(self.total) + ')' + _(' movie(s) in collection. ')
-			+ str(loaned) + _(' movie(s) loaned. ')
-			+ _('You haven\'t seen ')+&quot;%s&quot;%str(not_seen)+ _(&quot; movie(s)&quot;)
-		)
+    def count_statusbar(self):
+        allmovies = self.db.session.query(db.Movie).count()
+        loaned = self.db.session.query(db.Movie).filter_by(loaned=True).count()
+        not_seen = self.db.session.query(db.Movie).filter_by(seen=False).count()
+        self.update_statusbar(str(allmovies) + ' (' + str(self.total) + ')' + _(' movie(s) in collection. ')
+            + str(loaned) + _(' movie(s) loaned. ')
+            + _('You haven\'t seen ')+&quot;%s&quot;%str(not_seen)+ _(&quot; movie(s)&quot;)
+        )
 
-	def update_statusbar(self, text):
-		context_id = self.widgets['statusbar'].get_context_id(text)
-		message_id = self.widgets['statusbar'].push(context_id, text)
+    def update_statusbar(self, text):
+        context_id = self.widgets['statusbar'].get_context_id(text)
+        message_id = self.widgets['statusbar'].push(context_id, text)
 
-	# quick filter operations ---------------------------------------------
+    # quick filter operations ---------------------------------------------
 
-	def on_filter_criteria_changed(self, *args):
-		selected_criteria = self.widgets['filter']['criteria'].get_active_text()
-		self.config.set('criteria', selected_criteria, section='mainlist')
-		quick_filter.change_filter(self)
+    def on_filter_criteria_changed(self, *args):
+        selected_criteria = self.widgets['filter']['criteria'].get_active_text()
+        self.config.set('criteria', selected_criteria, section='mainlist')
+        quick_filter.change_filter(self)
 
-	def filter_txt(self, *args):
-		quick_filter.change_filter(self)
+    def filter_txt(self, *args):
+        quick_filter.change_filter(self)
 
-	def clear_filter(self, *args):
-		quick_filter.clear_filter(self)
+    def clear_filter(self, *args):
+        quick_filter.clear_filter(self)
 
-	# menu filter ---------------------------------------------------------
+    # menu filter ---------------------------------------------------------
 
-	def filter_loaned(self, *args):
-		from view import filter_loaned
-		filter_loaned(self)
+    def filter_loaned(self, *args):
+        from view import filter_loaned
+        filter_loaned(self)
 
-	def filter_not_seen(self, *args):
-		from view import filter_not_seen
-		filter_not_seen(self)
+    def filter_not_seen(self, *args):
+        from view import filter_not_seen
+        filter_not_seen(self)
 
-	def filter_all(self, *args):
-		from view import filter_all
-		filter_all(self)
+    def filter_all(self, *args):
+        from view import filter_all
+        filter_all(self)
 
-	def on_delete_event_am(self, *args):
-		self.widgets['add']['window'].hide()
-		return True
+    def on_delete_event_am(self, *args):
+        self.widgets['add']['window'].hide()
+        return True
 
-	def on_delete_event_pw(self, *args):
-		self.widgets['poster_window'].hide()
-		return True
+    def on_delete_event_pw(self, *args):
+        self.widgets['poster_window'].hide()
+        return True
 
-	def filter_collection(self, *args):
-		quick_filter.change_filter(self)
+    def filter_collection(self, *args):
+        quick_filter.change_filter(self)
 
-	def filter_volume(self, *args):
-		quick_filter.change_filter(self)
+    def filter_volume(self, *args):
+        quick_filter.change_filter(self)
 
-	def filter_loanedto(self, *args):
-		quick_filter.change_filter(self)
+    def filter_loanedto(self, *args):
+        quick_filter.change_filter(self)
 
-	def filter_bytag(self, *args):
-		quick_filter.change_filter(self)
+    def filter_bytag(self, *args):
+        quick_filter.change_filter(self)
 
-	# windows/dialogs -----------------------------------------------------
+    # windows/dialogs -----------------------------------------------------
 
-	def results_cancel_ck(self, *args):
-		from widgets import reconnect_add_signals
-		reconnect_add_signals(self)
-		self.widgets['results']['window'].hide()
+    def results_cancel_ck(self, *args):
+        from widgets import reconnect_add_signals
+        reconnect_add_signals(self)
+        self.widgets['results']['window'].hide()
 
-	def save_state(self): 
-		&quot;&quot;&quot;Saves main window state&quot;&quot;&quot;
-		# size should only be saved on microsoft windows systems
-		# on other systems the window manager should manage the windows
-		if self.windows and hasattr(self, 'mainwindow_state') and not self.mainwindow_state is None:
-			self.config.set('width',  self.mainwindow_state['width'],  section='window')
-			self.config.set('height', self.mainwindow_state['height'], section='window')
-			self.config.set('left',   self.mainwindow_state['left'],   section='window')
-			self.config.set('top',    self.mainwindow_state['top'],    section='window')
-			if self.mainwindow_state.has_key('state'):
-				self.config.set('state',  self.mainwindow_state['state'],  section='window')
-			else:
-				self.config.set('state',  0,  section='window')
-			self.config.save()
-		# save the order of the columns in the mainlist
-		treeview_columns = self.widgets['treeview'].get_columns()
-		columnorder = ''
-		delimiter = ''
-		for treeview_column in treeview_columns:
-			if treeview_column == self.number_column:
-				columnorder = columnorder + delimiter + 'number'
-				delimiter = ','
-			elif treeview_column == self.image_column:
-				columnorder = columnorder + delimiter + 'image'
-				delimiter = ','
-			elif treeview_column == self.otitle_column:
-				columnorder = columnorder + delimiter + 'otitle'
-				delimiter = ','
-			elif treeview_column == self.title_column:
-				columnorder = columnorder + delimiter + 'title'
-				delimiter = ','
-			elif treeview_column == self.director_column:
-				columnorder = columnorder + delimiter + 'director'
-				delimiter = ','
-			elif treeview_column == self.genre_column:
-				columnorder = columnorder + delimiter + 'genre'
-				delimiter = ','
-			elif treeview_column == self.seen_column:
-				columnorder = columnorder + delimiter + 'seen'
-				delimiter = ','
-			elif treeview_column == self.year_column:
-				columnorder = columnorder + delimiter + 'year'
-				delimiter = ','
-			elif treeview_column == self.runtime_column:
-				columnorder = columnorder + delimiter + 'runtime'
-				delimiter = ','
-			elif treeview_column == self.rating_column:
-				columnorder = columnorder + delimiter + 'rating'
-				delimiter = ','
-		self.config.set('columnorder',  columnorder,  section='mainlist')
-		self.config.save()
+    def save_state(self): 
+        &quot;&quot;&quot;Saves main window state&quot;&quot;&quot;
+        # size should only be saved on microsoft windows systems
+        # on other systems the window manager should manage the windows
+        if self.windows and hasattr(self, 'mainwindow_state') and not self.mainwindow_state is None:
+            self.config.set('width',  self.mainwindow_state['width'],  section='window')
+            self.config.set('height', self.mainwindow_state['height'], section='window')
+            self.config.set('left',   self.mainwindow_state['left'],   section='window')
+            self.config.set('top',    self.mainwindow_state['top'],    section='window')
+            if self.mainwindow_state.has_key('state'):
+                self.config.set('state',  self.mainwindow_state['state'],  section='window')
+            else:
+                self.config.set('state',  0,  section='window')
+            self.config.save()
+        # save the order of the columns in the mainlist
+        treeview_columns = self.widgets['treeview'].get_columns()
+        columnorder = ''
+        delimiter = ''
+        for treeview_column in treeview_columns:
+            if treeview_column == self.number_column:
+                columnorder = columnorder + delimiter + 'number'
+                delimiter = ','
+            elif treeview_column == self.image_column:
+                columnorder = columnorder + delimiter + 'image'
+                delimiter = ','
+            elif treeview_column == self.otitle_column:
+                columnorder = columnorder + delimiter + 'otitle'
+                delimiter = ','
+            elif treeview_column == self.title_column:
+                columnorder = columnorder + delimiter + 'title'
+                delimiter = ','
+            elif treeview_column == self.director_column:
+                columnorder = columnorder + delimiter + 'director'
+                delimiter = ','
+            elif treeview_column == self.genre_column:
+                columnorder = columnorder + delimiter + 'genre'
+                delimiter = ','
+            elif treeview_column == self.seen_column:
+                columnorder = columnorder + delimiter + 'seen'
+                delimiter = ','
+            elif treeview_column == self.year_column:
+                columnorder = columnorder + delimiter + 'year'
+                delimiter = ','
+            elif treeview_column == self.runtime_column:
+                columnorder = columnorder + delimiter + 'runtime'
+                delimiter = ','
+            elif treeview_column == self.rating_column:
+                columnorder = columnorder + delimiter + 'rating'
+                delimiter = ','
+        self.config.set('columnorder',  columnorder,  section='mainlist')
+        self.config.save()
 
-	def restore_state(self):
-		&quot;&quot;&quot;Restores main window state&quot;&quot;&quot;
-		if self.windows:
-			# windows systems: static gravity needed otherwise we have a
-			# left offset of 4 points (Windows XP border size) and a top
-			# offset of 30 points (height of the title bar) every time the
-			# application is started. The window would move right-down.
-			self.widgets['window'].set_gravity(gtk.gdk.GRAVITY_STATIC)
-		if self.config.get(&quot;left&quot;, None, section='window') == None:
-			pass
-		else:
-			state = self.config.get('state', '0', section='window')
-			if state == str(int(gtk.gdk.WINDOW_STATE_MAXIMIZED)):
-				self.widgets['window'].maximize()
-			else:
-				self.widgets['window'].move(int(self.config.get('left', section='window')), \
-					int(self.config.get('top', section='window')))
-				self.widgets['window'].resize(int(self.config.get('width', section='window')), \
-					int(self.config.get('height', section='window')))
-		self.widgets['window'].show()
+    def restore_state(self):
+        &quot;&quot;&quot;Restores main window state&quot;&quot;&quot;
+        if self.windows:
+            # windows systems: static gravity needed otherwise we have a
+            # left offset of 4 points (Windows XP border size) and a top
+            # offset of 30 points (height of the title bar) every time the
+            # application is started. The window would move right-down.
+            self.widgets['window'].set_gravity(gtk.gdk.GRAVITY_STATIC)
+        if self.config.get(&quot;left&quot;, None, section='window') == None:
+            pass
+        else:
+            state = self.config.get('state', '0', section='window')
+            if state == str(int(gtk.gdk.WINDOW_STATE_MAXIMIZED)):
+                self.widgets['window'].maximize()
+            else:
+                self.widgets['window'].move(int(self.config.get('left', section='window')), \
+                    int(self.config.get('top', section='window')))
+                self.widgets['window'].resize(int(self.config.get('width', section='window')), \
+                    int(self.config.get('height', section='window')))
+        self.widgets['window'].show()
 
-	def on_delete_event_r(self, *args):
-		self.widgets['results']['window'].hide()
-		return True
+    def on_delete_event_r(self, *args):
+        self.widgets['results']['window'].hide()
+        return True
 
-	def on_delete_event_poster(self, *args):
-		self.widgets['poster_window'].hide()
-		return True
+    def on_delete_event_poster(self, *args):
+        self.widgets['poster_window'].hide()
+        return True
 
-	def on_delete_event_wp(self, *args):
-		self.widgets['people']['window'].hide()
-		return True
+    def on_delete_event_wp(self, *args):
+        self.widgets['people']['window'].hide()
+        return True
 
-	def on_delete_event_ap(self, *args):
-		self.widgets['person']['window'].hide()
-		return True
+    def on_delete_event_ap(self, *args):
+        self.widgets['person']['window'].hide()
+        return True
 
-	def on_delete_event_ep(self, *args):
-		self.widgets['person']['e_window'].hide()
-		return True
+    def on_delete_event_ep(self, *args):
+        self.widgets['person']['e_window'].hide()
+        return True
 
-	def on_delete_event_lt(self, *args):
-		self.widgets['w_loan_to'].hide()
-		return True
+    def on_delete_event_lt(self, *args):
+        self.widgets['w_loan_to'].hide()
+        return True
 
-	def on_delete_event_pcs(self, *args):
-		self.widgets['print_cover']['window_simple'].hide()
-		return True
+    def on_delete_event_pcs(self, *args):
+        self.widgets['print_cover']['window_simple'].hide()
+        return True
 
-	def on_delete_event_pci(self, *args):
-		self.widgets['print_cover']['window_image'].hide()
-		return True
+    def on_delete_event_pci(self, *args):
+        self.widgets['print_cover']['window_image'].hide()
+        return True
 
-	def on_delete_event_p(self, *args):
-		self.widgets['preferences']['window'].hide()
-		return True
+    def on_delete_event_p(self, *args):
+        self.widgets['preferences']['window'].hide()
+        return True
 
-	def go_oficial_site(self, *args):
-		if self._o_site_url:
-			gutils.run_browser(self._o_site_url)
+    def go_oficial_site(self, *args):
+        if self._o_site_url:
+            gutils.run_browser(self._o_site_url)
 
-	def go_site(self, *args):
-		if self._site_url:
-			gutils.run_browser(self._site_url)
+    def go_site(self, *args):
+        if self._site_url:
+            gutils.run_browser(self._site_url)
 
-	def go_trailer_site(self, *args):
-		if self._trailer_url:
-			gutils.run_browser(self._trailer_url)
+    def go_trailer_site(self, *args):
+        if self._trailer_url:
+            gutils.run_browser(self._trailer_url)
 
-	def on_goto_homepage_activate(site, *args):
-		gutils.run_browser(&quot;<A HREF="http://www.griffith.cc/">http://www.griffith.cc/</A>&quot;)
-	def on_goto_forum_activate(site, *args):
-		gutils.run_browser(&quot;<A HREF="http://forum.griffith.cc/">http://forum.griffith.cc/</A>&quot;)
-	def on_goto_report_bug_activate(site, *args):
-		gutils.run_browser(&quot;<A HREF="https://bugs.launchpad.net/griffith/">https://bugs.launchpad.net/griffith/</A>&quot;)
+    def on_goto_homepage_activate(site, *args):
+        gutils.run_browser(&quot;<A HREF="http://www.griffith.cc/">http://www.griffith.cc/</A>&quot;)
+    def on_goto_forum_activate(site, *args):
+        gutils.run_browser(&quot;<A HREF="http://forum.griffith.cc/">http://forum.griffith.cc/</A>&quot;)
+    def on_goto_report_bug_activate(site, *args):
+        gutils.run_browser(&quot;<A HREF="https://bugs.launchpad.net/griffith/">https://bugs.launchpad.net/griffith/</A>&quot;)
 
-	# toolbar -------------------------------------------------------------
-	def toggle_toolbar(self, *args):
-		state = self.widgets['menu']['toolbar'].get_active()
-		if state == False:
-			self.widgets['toolbar'].hide()
-		else:
-			self.widgets['toolbar'].show()
-		self.config.set('view_toolbar', state, section='window')
-		self.config.save()
+    # toolbar -------------------------------------------------------------
+    def toggle_toolbar(self, *args):
+        state = self.widgets['menu']['toolbar'].get_active()
+        if state == False:
+            self.widgets['toolbar'].hide()
+        else:
+            self.widgets['toolbar'].show()
+        self.config.set('view_toolbar', state, section='window')
+        self.config.save()
 
-	def new_dbb(self, *args):
-		&quot;&quot;&quot;initializes a new Griffith Database file&quot;&quot;&quot;
-		response = gutils.question(self, \
-			_('Are you sure you want to create a new database?\nYou will lose ALL your current data!'), \
-			1, self.widgets['window'])
-		if response == gtk.RESPONSE_YES:
-			response_sec = gutils.question(self, \
-				_('Last chance!\nDo you confirm that you want\nto lose your current data?'), \
-				1, self.widgets['window'])
-			if response_sec == gtk.RESPONSE_YES:
-				from sqlalchemy import Select
-				from sql import GriffithSQL
-				# delete images
-				posters_dir = self.locations['posters']
-				# NOTE: only used images are removed (posters are shared between various db)
-				debug.show('NEW DB: Removing old images...')
-				
-				movies = Select([self.db.Movie.c.image]).execute().fetchall()
-				for movie in movies:
-					if movie.image is not None:
-						name = movie.image.encode('utf-8')
-						p_file = os.path.join(posters_dir, name+'.jpg')
-						m_file = os.path.join(posters_dir, 'm_'+name+'.jpg')
-						t_file = os.path.join(posters_dir, 't_'+name+'jpg')
-						try:
-							os.remove(p_file)
-							os.remove(m_file)
-							os.remove(t_file)
-						except:
-							pass
-				self.db.metadata.drop_all()
-				from sqlalchemy.orm import clear_mappers
-				clear_mappers()
-				if self.config.get('type', 'sqlite', section='database') == 'sqlite':
-					os.unlink(os.path.join(self.locations['home'],self.config.get('name', 'griffith', section='database') + '.db'))
-					if self.config.get('file', 'griffith.db', section='database') == 'griffith.gri':
-						self.config.set('file', 'griffith.db', section='database')
-				# create/connect db
-				self.db = GriffithSQL(self.config, debug, self.griffith_dir)
-				self.clear_details()
-				self.total = 0
-				self.count_statusbar()
-				self.treemodel.clear()
-				from initialize	import dictionaries, people_treeview
-				dictionaries(self)
-				people_treeview(self)
+    def new_dbb(self, *args):
+        &quot;&quot;&quot;initializes a new Griffith Database file&quot;&quot;&quot;
+        response = gutils.question(self, \
+            _('Are you sure you want to create a new database?\nYou will lose ALL your current data!'), \
+            1, self.widgets['window'])
+        if response == gtk.RESPONSE_YES:
+            response_sec = gutils.question(self, \
+                _('Last chance!\nDo you confirm that you want\nto lose your current data?'), \
+                1, self.widgets['window'])
+            if response_sec == gtk.RESPONSE_YES:
+                from sqlalchemy import select
+                from sql import GriffithSQL
+                # delete images
+                posters_dir = self.locations['posters']
+                # NOTE: only used images are removed (posters are shared between various db)
+                debug.show('NEW DB: Removing old images...')
+                
+                movies = select([db.movies_table.c.image], bind=self.db.session.bind).execute().fetchall()
+                for movie in movies:
+                    if movie.image is not None:
+                        name = movie.image.encode('utf-8')
+                        p_file = os.path.join(posters_dir, name+'.jpg')
+                        m_file = os.path.join(posters_dir, 'm_'+name+'.jpg')
+                        t_file = os.path.join(posters_dir, 't_'+name+'jpg')
+                        try:
+                            os.remove(p_file)
+                            os.remove(m_file)
+                            os.remove(t_file)
+                        except:
+                            pass
+                db.metadata.drop_all(self.db.session.bind.engine)
+                #from sqlalchemy.orm import clear_mappers
+                #clear_mappers()
+                if self.config.get('type', 'sqlite', section='database') == 'sqlite':
+                    os.unlink(os.path.join(self.locations['home'],self.config.get('name', 'griffith', section='database') + '.db'))
+                    if self.config.get('file', 'griffith.db', section='database') == 'griffith.gri':
+                        self.config.set('file', 'griffith.db', section='database')
+                # create/connect db
+                self.db = GriffithSQL(self.config, debug, self.griffith_dir)
+                self.clear_details()
+                self.total = 0
+                self.count_statusbar()
+                self.treemodel.clear()
+                from initialize    import dictionaries, people_treeview
+                dictionaries(self)
+                people_treeview(self)
 
-	# key events ----------------------------------------------------------
+    # key events ----------------------------------------------------------
 
-	def on_key_press_event(self, widget, event):
-		&quot;&quot;&quot;some key events actions&quot;&quot;&quot;
-		keyname = gtk.gdk.keyval_name(event.keyval)
-		if keyname == 'Delete' and self.widgets['treeview'].is_focus() == True:
-			self.delete_movie()
+    def on_key_press_event(self, widget, event):
+        &quot;&quot;&quot;some key events actions&quot;&quot;&quot;
+        keyname = gtk.gdk.keyval_name(event.keyval)
+        if keyname == 'Delete' and self.widgets['treeview'].is_focus() == True:
+            self.delete_movie()
 
-	def on_p_tree_button_press_event(self, widget, event):
-		&quot;&quot;&quot;add a double click event to people tree&quot;&quot;&quot;				
-		if event.type == gtk.gdk._2BUTTON_PRESS:
-			from people import edit_person
-			edit_person(self)
+    def on_p_tree_button_press_event(self, widget, event):
+        &quot;&quot;&quot;add a double click event to people tree&quot;&quot;&quot;                
+        if event.type == gtk.gdk._2BUTTON_PRESS:
+            from people import edit_person
+            edit_person(self)
 
-	def on_maintree_button_press_event(self, widget, event):
-		&quot;&quot;&quot;add a left click menu to main tree&quot;&quot;&quot;
-		if event.button == 3:
-			x = int(event.x)
-			y = int(event.y)
-			time = event.time
-			pthinfo = self.widgets['treeview'].get_path_at_pos(x, y)
-			if pthinfo is not None:
-				path, col, cellx, celly = pthinfo
-				self.widgets['treeview'].grab_focus()
-				self.widgets['treeview'].set_cursor( path, col, 0)
-				self.widgets['popups']['main'].popup( None, None, None, event.button, time)
-			return 1
-		elif event.type == gtk.gdk._2BUTTON_PRESS:
-			self.edit_movie()
+    def on_maintree_button_press_event(self, widget, event):
+        &quot;&quot;&quot;add a left click menu to main tree&quot;&quot;&quot;
+        if event.button == 3:
+            x = int(event.x)
+            y = int(event.y)
+            time = event.time
+            pthinfo = self.widgets['treeview'].get_path_at_pos(x, y)
+            if pthinfo is not None:
+                path, col, cellx, celly = pthinfo
+                self.widgets['treeview'].grab_focus()
+                self.widgets['treeview'].set_cursor( path, col, 0)
+                self.widgets['popups']['main'].popup( None, None, None, event.button, time)
+            return 1
+        elif event.type == gtk.gdk._2BUTTON_PRESS:
+            self.edit_movie()
 
-	def on_results_button_press_event(self, widget, event):
-		&quot;&quot;&quot;add a double click event to add movie results&quot;&quot;&quot;
-		if event.type == gtk.gdk._2BUTTON_PRESS:
-			add.populate_with_results(self)
+    def on_results_button_press_event(self, widget, event):
+        &quot;&quot;&quot;add a double click event to add movie results&quot;&quot;&quot;
+        if event.type == gtk.gdk._2BUTTON_PRESS:
+            add.populate_with_results(self)
 
-	def on_poster_results_button_press_event(self, widget, event):
-		&quot;&quot;&quot;add a double click event to poster results&quot;&quot;&quot;
-		if event.type == gtk.gdk._2BUTTON_PRESS:
-			add.populate_with_results(self)
-	
-	# -=[ treeview ]=------------------------------------------------------
-	def go_first(self, *args):
-		self.click_on(self.widgets['treeview'], 'first')
-	def go_last(self, *args):
-		self.click_on(self.widgets['treeview'], 'last')
-	def go_prev(self, *args):
-		self.click_on(self.widgets['treeview'], 'prev')
-	def go_next(self, *args):
-		self.click_on(self.widgets['treeview'], 'next')
-	# TODO: remove total_filter var.
-	
-	def click_on(self, treeview, direction):
-		treeselection = treeview.get_selection()
-		if not treeselection:
-			treeview.set_cursor_on_cell(0)
-			return 2 # no selection =&gt; selecting first movie
-		(treemodel, treeiter) = treeselection.get_selected()
-		if treemodel is None:
-			return False
-		if treeiter is None or direction=='first':
-			treeview.set_cursor_on_cell(0)
-		elif direction == 'next':
-			nextiter = treemodel.iter_next(treeiter)
-			if nextiter is None:
-				direction = 'last'
-			else:
-				iterpath = treemodel.get_path(nextiter)
-				treeview.set_cursor_on_cell(iterpath[0])
-		elif direction == 'prev':
-			iterpath = treemodel.get_path(treeiter)
-			row = iterpath[0]
-			if row&gt;0:
-				treeview.set_cursor_on_cell(row-1)
-			else:
-				treeview.set_cursor_on_cell(0)
-		if direction == 'last':
-			rows = len(treemodel)
-			if rows&gt;0:
-				treeview.set_cursor_on_cell(rows-1)
-			else:
-				treeview.set_cursor_on_cell(0)
+    def on_poster_results_button_press_event(self, widget, event):
+        &quot;&quot;&quot;add a double click event to poster results&quot;&quot;&quot;
+        if event.type == gtk.gdk._2BUTTON_PRESS:
+            add.populate_with_results(self)
+    
+    # -=[ treeview ]=------------------------------------------------------
+    def go_first(self, *args):
+        self.click_on(self.widgets['treeview'], 'first')
+    def go_last(self, *args):
+        self.click_on(self.widgets['treeview'], 'last')
+    def go_prev(self, *args):
+        self.click_on(self.widgets['treeview'], 'prev')
+    def go_next(self, *args):
+        self.click_on(self.widgets['treeview'], 'next')
+    # TODO: remove total_filter var.
+    
+    def click_on(self, treeview, direction):
+        treeselection = treeview.get_selection()
+        if not treeselection:
+            treeview.set_cursor_on_cell(0)
+            return 2 # no selection =&gt; selecting first movie
+        (treemodel, treeiter) = treeselection.get_selected()
+        if treemodel is None:
+            return False
+        if treeiter is None or direction=='first':
+            treeview.set_cursor_on_cell(0)
+        elif direction == 'next':
+            nextiter = treemodel.iter_next(treeiter)
+            if nextiter is None:
+                direction = 'last'
+            else:
+                iterpath = treemodel.get_path(nextiter)
+                treeview.set_cursor_on_cell(iterpath[0])
+        elif direction == 'prev':
+            iterpath = treemodel.get_path(treeiter)
+            row = iterpath[0]
+            if row&gt;0:
+                treeview.set_cursor_on_cell(row-1)
+            else:
+                treeview.set_cursor_on_cell(0)
+        if direction == 'last':
+            rows = len(treemodel)
+            if rows&gt;0:
+                treeview.set_cursor_on_cell(rows-1)
+            else:
+                treeview.set_cursor_on_cell(0)
 
 if __name__ == &quot;__main__&quot;:
-	griffith = Griffith()
-	griffith.main()
+    griffith = Griffith()
+    griffith.main()
 
 # vim: fdm=marker

Modified: trunk/lib/about.py
===================================================================
--- trunk/lib/about.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/about.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -28,62 +28,62 @@
 import sys
 
 class AboutDialog:
-	&quot;&quot;&quot;Shows a gtk about dialog&quot;&quot;&quot;
-	def __init__(self, locations):
-		TRANSLATORS_FILE = os.path.join(locations['share'], 'TRANSLATORS') # remember to encode this file in UTF-8
-		IMAGES_DIR = locations['images']
-		dialog = gtk.AboutDialog()
-		dialog.set_name(version.pname)
-		dialog.set_version(version.pversion)
-		dialog.set_copyright(&quot;Copyright &#194;&#169; 2005-2008 Vasco Nunes. Piotr O&#197;&#188;arowski&quot;)
-		dialog.set_website(version.pwebsite)
-		dialog.set_authors([
-			_(&quot;Main Authors&quot;) + ':',
-			version.pauthor.replace(', ', '\n') + &quot;\n&quot;,
-			_(&quot;Programmers&quot;) + ':',
-			'Jessica Katharina Parth &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">Jessica.K.P at women-at-work.org</A>&gt;',
-			'Michael Jahn &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;\n',
-			_('Contributors:'), # FIXME: remove &quot;:&quot;
-			'Christian Sagmueller &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">christian at sagmueller.net</A>&gt;\n' \
-			'Arjen Schwarz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">arjen.schwarz at gmail.com</A>&gt;'
-		])
-		dialog.set_artists([_(&quot;Logo, icon and general artwork &quot; + \
-			&quot;by Peek &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">peekpt at gmail.com</A>&gt;.&quot; + \
-			&quot;\nPlease visit <A HREF="http://www.peekmambo.com/\n">http://www.peekmambo.com/\n</A>&quot;),
-			'seen / unseen icons by dragonskulle &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">dragonskulle at gmail.com</A>&gt;'
-		])
-		data = None
-		if os.path.isfile(TRANSLATORS_FILE):
-			data = open(TRANSLATORS_FILE).read()
-		elif os.path.isfile(TRANSLATORS_FILE+'.gz'):
-			from gutils import decompress
-			data = decompress(open(TRANSLATORS_FILE + '.gz').read())
-		elif os.name == 'posix':
-			if os.path.isfile('/usr/share/doc/griffith/TRANSLATORS'):
-				data = open('/usr/share/doc/griffith/TRANSLATORS').read()
-			elif os.path.isfile('/usr/share/doc/griffith/TRANSLATORS.gz'):
-				from gutils import decompress
-				data = decompress(open('/usr/share/doc/griffith/TRANSLATORS.gz').read())
-		translator_credits = ''
-		if data:
-			for line in data.split('\n'):
-				if line.startswith('* '):
-					lang = line[2:]
-					if _(lang) != lang:
-						line = &quot;* %s:&quot; % _(lang)
-				translator_credits += &quot;%s\n&quot; % line
-		else:
-			translator_credits = _(&quot;See TRANSLATORS file&quot;)
-		dialog.set_translator_credits(translator_credits)
-		logo_file = os.path.abspath(os.path.join(IMAGES_DIR, 'griffith.png'))
-		logo = gtk.gdk.pixbuf_new_from_file(logo_file)
-		dialog.set_logo(logo)
-		if os.path.isfile('/usr/share/common-licenses/GPL-2'):
-			dialog.set_license(open('/usr/share/common-licenses/GPL-2').read())
-		else:
-			dialog.set_license(_(&quot;This program is released under the GNU&quot; + \
-				&quot;General Public License.\n&quot; + \
-				&quot;Please visit <A HREF="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</A> for details.&quot;))
-		dialog.set_comments(version.pdescription)
-		dialog.run()
-		dialog.destroy()
+    &quot;&quot;&quot;Shows a gtk about dialog&quot;&quot;&quot;
+    def __init__(self, locations):
+        TRANSLATORS_FILE = os.path.join(locations['share'], 'TRANSLATORS') # remember to encode this file in UTF-8
+        IMAGES_DIR = locations['images']
+        dialog = gtk.AboutDialog()
+        dialog.set_name(version.pname)
+        dialog.set_version(version.pversion)
+        dialog.set_copyright(&quot;Copyright &#194;&#169; 2005-2008 Vasco Nunes. Piotr O&#197;&#188;arowski&quot;)
+        dialog.set_website(version.pwebsite)
+        dialog.set_authors([
+            _(&quot;Main Authors&quot;) + ':',
+            version.pauthor.replace(', ', '\n') + &quot;\n&quot;,
+            _(&quot;Programmers&quot;) + ':',
+            'Jessica Katharina Parth &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">Jessica.K.P at women-at-work.org</A>&gt;',
+            'Michael Jahn &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;\n',
+            _('Contributors:'), # FIXME: remove &quot;:&quot;
+            'Christian Sagmueller &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">christian at sagmueller.net</A>&gt;\n' \
+            'Arjen Schwarz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">arjen.schwarz at gmail.com</A>&gt;'
+        ])
+        dialog.set_artists([_(&quot;Logo, icon and general artwork &quot; + \
+            &quot;by Peek &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">peekpt at gmail.com</A>&gt;.&quot; + \
+            &quot;\nPlease visit <A HREF="http://www.peekmambo.com/\n">http://www.peekmambo.com/\n</A>&quot;),
+            'seen / unseen icons by dragonskulle &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">dragonskulle at gmail.com</A>&gt;'
+        ])
+        data = None
+        if os.path.isfile(TRANSLATORS_FILE):
+            data = open(TRANSLATORS_FILE).read()
+        elif os.path.isfile(TRANSLATORS_FILE+'.gz'):
+            from gutils import decompress
+            data = decompress(open(TRANSLATORS_FILE + '.gz').read())
+        elif os.name == 'posix':
+            if os.path.isfile('/usr/share/doc/griffith/TRANSLATORS'):
+                data = open('/usr/share/doc/griffith/TRANSLATORS').read()
+            elif os.path.isfile('/usr/share/doc/griffith/TRANSLATORS.gz'):
+                from gutils import decompress
+                data = decompress(open('/usr/share/doc/griffith/TRANSLATORS.gz').read())
+        translator_credits = ''
+        if data:
+            for line in data.split('\n'):
+                if line.startswith('* '):
+                    lang = line[2:]
+                    if _(lang) != lang:
+                        line = &quot;* %s:&quot; % _(lang)
+                translator_credits += &quot;%s\n&quot; % line
+        else:
+            translator_credits = _(&quot;See TRANSLATORS file&quot;)
+        dialog.set_translator_credits(translator_credits)
+        logo_file = os.path.abspath(os.path.join(IMAGES_DIR, 'griffith.png'))
+        logo = gtk.gdk.pixbuf_new_from_file(logo_file)
+        dialog.set_logo(logo)
+        if os.path.isfile('/usr/share/common-licenses/GPL-2'):
+            dialog.set_license(open('/usr/share/common-licenses/GPL-2').read())
+        else:
+            dialog.set_license(_(&quot;This program is released under the GNU&quot; + \
+                &quot;General Public License.\n&quot; + \
+                &quot;Please visit <A HREF="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</A> for details.&quot;))
+        dialog.set_comments(version.pdescription)
+        dialog.run()
+        dialog.destroy()

Modified: trunk/lib/add.py
===================================================================
--- trunk/lib/add.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/add.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -28,687 +28,727 @@
 import string
 import shutil
 import quick_filter
+import db
 
 def clear(self):
-	&quot;&quot;&quot;clears all fields in dialog&quot;&quot;&quot;
-	set_details(self, {})
-	self.widgets['add']['cb_only_empty'].set_active(False)
+    &quot;&quot;&quot;clears all fields in dialog&quot;&quot;&quot;
+    set_details(self, {})
+    self.widgets['add']['cb_only_empty'].set_active(False)
 
 def add_movie(self, details={}):
-	set_details(self, details)
-	
-	self.active_plugin = ''
-	self.widgets['add']['add_button'].show()
-	self.widgets['add']['add_close_button'].show()
-	self.widgets['add']['clear_button'].show()
-	self.widgets['add']['save_button'].hide()
-	self.widgets['add']['window'].set_title(_('Add a new movie'))
-	self.widgets['add']['window'].show()
+    set_details(self, details)
+    
+    self.active_plugin = ''
+    self.widgets['add']['add_button'].show()
+    self.widgets['add']['add_close_button'].show()
+    self.widgets['add']['clear_button'].show()
+    self.widgets['add']['save_button'].hide()
+    self.widgets['add']['window'].set_title(_('Add a new movie'))
+    self.widgets['add']['window'].show()
 
 def edit_movie(self, details={}):
-	if not details.has_key('number'):
-		details['number'] = gutils.find_next_available(self.db)
-	set_details(self, details)
-	self.widgets['add']['add_button'].hide()
-	self.widgets['add']['add_close_button'].hide()
-	self.widgets['add']['clear_button'].hide()
-	self.widgets['add']['save_button'].show()
-	self.widgets['add']['window'].set_title(_('Edit movie'))
-	self.widgets['add']['window'].show()
+    if not details.has_key('number'):
+        details['number'] = gutils.find_next_available(self.db)
+    set_details(self, details)
+    self.widgets['add']['add_button'].hide()
+    self.widgets['add']['add_close_button'].hide()
+    self.widgets['add']['clear_button'].hide()
+    self.widgets['add']['save_button'].show()
+    self.widgets['add']['window'].set_title(_('Edit movie'))
+    self.widgets['add']['window'].show()
 
 def set_details(self, item=None):#{{{
-	if item is None:
-		item = {}
-	if item.has_key('movie_id') and item['movie_id']:
-		self._am_movie_id = item['movie_id']
-	else:
-		self._am_movie_id = None
-	w = self.widgets['add']
+    if item is None:
+        item = {}
+    if item.has_key('movie_id') and item['movie_id']:
+        self._am_movie_id = item['movie_id']
+    else:
+        self._am_movie_id = None
+    w = self.widgets['add']
 
-	cast_buffer  = w['cast'].get_buffer()
-	notes_buffer = w['notes'].get_buffer()
-	plot_buffer  = w['plot'].get_buffer()
+    cast_buffer  = w['cast'].get_buffer()
+    notes_buffer = w['notes'].get_buffer()
+    plot_buffer  = w['plot'].get_buffer()
 
-	if item.has_key('o_title') and item['o_title']:
-		w['o_title'].set_text(item['o_title'])
-	else:
-		w['o_title'].set_text('')
-	if item.has_key('title') and item['title']:
-		w['title'].set_text(item['title'])
-	else:
-		w['title'].set_text('')
-	if item.has_key('number') and item['number']:
-		w['number'].set_value(int(item['number']))
-	else:
-		w['number'].set_value(int(gutils.find_next_available(self.db)))
-	if item.has_key('title') and item['title']:
-		w['title'].set_text(item['title'])
-	if item.has_key('year') and item['year']:
-		w['year'].set_value( gutils.digits_only(item['year'], 2100))
-	else:
-		w['year'].set_value(0)
-	if item.has_key('runtime') and item['runtime']:
-		w['runtime'].set_value( gutils.digits_only(item['runtime']))
-	else:
-		w['runtime'].set_value(0)
-	if item.has_key('country') and item['country']:
-		w['country'].set_text(item['country'])
-	else:
-		w['country'].set_text('')
-	if item.has_key('classification') and item['classification']:
-		w['classification'].set_text(item['classification'])
-	else:
-		w['classification'].set_text('')
-	if item.has_key('studio') and item['studio']:
-		w['studio'].set_text(item['studio'])
-	else:
-		w['studio'].set_text('')
-	if item.has_key('o_site') and item['o_site']:
-		w['o_site'].set_text(item['o_site'])
-	else:
-		w['o_site'].set_text('')
-	if item.has_key('director') and item['director']:
-		w['director'].set_text(item['director'])
-	else:
-		w['director'].set_text('')
-	if item.has_key('site') and item['site']:
-		w['site'].set_text(item['site'])
-	else:
-		w['site'].set_text('')
-	if item.has_key('trailer') and item['trailer']:
-		w['trailer'].set_text(item['trailer'])
-	else:
-		w['trailer'].set_text('')
-	if item.has_key('title') and item['title']:
-		w['title'].set_text(item['title'])
-	else:
-		w['title'].set_text('')
-	if item.has_key('genre') and item['genre']:
-		w['genre'].set_text(item['genre'])
-	else:
-		w['genre'].set_text('')
-	if item.has_key('color') and item['color']:
-		w['color'].set_active( gutils.digits_only(item['color'], 3))
-	else:
-		w['color'].set_active( gutils.digits_only(self.config.get('color', 0, section='defaults'), 3))
-	if item.has_key('layers') and item['layers']:
-		w['layers'].set_active( gutils.digits_only(item['layers'], 4))
-	else:
-		w['layers'].set_active( gutils.digits_only(self.config.get('layers', 0, section='defaults'), 4))
-	if item.has_key('region') and item['region']&gt;=0:
-			w['region'].set_active( gutils.digits_only(item['region'], 8))
-	else:
-		w['region'].set_active( gutils.digits_only(self.config.get('region', 0, section='defaults'), 8))
-	if item.has_key('cond') and item['cond']&gt;=0:
-		w['condition'].set_active( gutils.digits_only( item['cond'], 5) )
-	else:
-		w['condition'].set_active( gutils.digits_only( self.config.get('condition', 0, section='defaults'), 5))
-	if item.has_key('media_num') and item['media_num']:
-		w['discs'].set_value( gutils.digits_only(item['media_num']))
-	else:
-		w['discs'].set_value(1)
-	if item.has_key('rating') and item['rating']:
-		w['rating_slider'].set_value( gutils.digits_only(item['rating'], 10) )
-	else:
-		w['rating_slider'].set_value(0)
-	if item.has_key('seen') and item['seen'] is True:
-		w['seen'].set_active(True)
-	else:
-		w['seen'].set_active(False)
-	if item.has_key('cast') and item['cast']:
-		cast_buffer.set_text(item['cast'])
-	else:
-		cast_buffer.set_text('')
-	if item.has_key('notes') and item['notes']:
-		notes_buffer.set_text(item['notes'])
-	else:
-		notes_buffer.set_text('')
-	if item.has_key('plot') and item['plot']:
-		plot_buffer.set_text(item['plot'])
-	else:
-		plot_buffer.set_text('')
-	pos = 0
-	if item.has_key('medium_id') and item['medium_id']:
-		pos = gutils.findKey(item['medium_id'], self.media_ids)
-	else:
-		pos = gutils.findKey(int(self.config.get('media', 0, section='defaults')), self.media_ids)
-	if pos is not None:
-		w['media'].set_active(int(pos))
-	else:
-		w['media'].set_active(0)
-	pos = 0
-	if item.has_key('vcodec_id') and item['vcodec_id']:
-		pos = gutils.findKey(item['vcodec_id'], self.vcodecs_ids)
-	else:
-		pos = gutils.findKey(int(self.config.get('vcodec', 0, section='defaults')), self.vcodecs_ids)
-	if pos is not None:
-		w['vcodec'].set_active(int(pos))
-	else:
-		w['vcodec'].set_active(0)
-	pos = 0
-	if item.has_key('volume_id') and item['volume_id']:
-		pos = gutils.findKey(item['volume_id'], self.volume_combo_ids)
-	if pos is not None:
-		w['volume'].set_active(int(pos))
-	else:
-		w['volume'].set_active(0)
-	pos = 0
-	if item.has_key('collection_id') and item['collection_id']:
-		pos = gutils.findKey(item['collection_id'], self.collection_combo_ids)
-	if pos is not None:
-		w['collection'].set_active(int(pos))
-	else:
-		w['volume'].set_active(0)
-	# tags
-	for tag in self.am_tags:
-		self.am_tags[tag].set_active(False)
-	if item.has_key('tags'):
-		for tag in item['tags']:
-			i = gutils.findKey(tag.tag_id, self.tags_ids)
-			self.am_tags[i].set_active(True)
-	# languages
-	w['lang_treeview'].get_model().clear()
-	if item.has_key('languages') and len(item['languages'])&gt;0:
-		for i in item['languages']:
-			self.create_language_row(i)
-	# poster
-	if item.has_key('image') and item['image']:
-		w['image'].set_text(item['image'])
-		image_path = os.path.join(self.locations['posters'], &quot;m_%s.jpg&quot; % item['image'])
-	else:
-		w['image'].set_text('')
-		image_path = os.path.join(self.locations['images'], 'default.png')
-	if not os.path.isfile(image_path):
-		image_path = os.path.join(self.locations['images'], 'default.png')
-	w['picture'].set_from_file(image_path)
-	
-	w['notebook'].set_current_page(0)
-	w['source'].set_active(self.d_plugin)
-	w['o_title'].grab_focus()
-	#}}}
+    if item.has_key('o_title') and item['o_title']:
+        w['o_title'].set_text(item['o_title'])
+    else:
+        w['o_title'].set_text('')
+    if item.has_key('title') and item['title']:
+        w['title'].set_text(item['title'])
+    else:
+        w['title'].set_text('')
+    if item.has_key('number') and item['number']:
+        w['number'].set_value(int(item['number']))
+    else:
+        w['number'].set_value(int(gutils.find_next_available(self.db)))
+    if item.has_key('title') and item['title']:
+        w['title'].set_text(item['title'])
+    if item.has_key('year') and item['year']:
+        w['year'].set_value( gutils.digits_only(item['year'], 2100))
+    else:
+        w['year'].set_value(0)
+    if item.has_key('runtime') and item['runtime']:
+        w['runtime'].set_value( gutils.digits_only(item['runtime']))
+    else:
+        w['runtime'].set_value(0)
+    if item.has_key('country') and item['country']:
+        w['country'].set_text(item['country'])
+    else:
+        w['country'].set_text('')
+    if item.has_key('classification') and item['classification']:
+        w['classification'].set_text(item['classification'])
+    else:
+        w['classification'].set_text('')
+    if item.has_key('studio') and item['studio']:
+        w['studio'].set_text(item['studio'])
+    else:
+        w['studio'].set_text('')
+    if item.has_key('o_site') and item['o_site']:
+        w['o_site'].set_text(item['o_site'])
+    else:
+        w['o_site'].set_text('')
+    if item.has_key('director') and item['director']:
+        w['director'].set_text(item['director'])
+    else:
+        w['director'].set_text('')
+    if item.has_key('site') and item['site']:
+        w['site'].set_text(item['site'])
+    else:
+        w['site'].set_text('')
+    if item.has_key('trailer') and item['trailer']:
+        w['trailer'].set_text(item['trailer'])
+    else:
+        w['trailer'].set_text('')
+    if item.has_key('title') and item['title']:
+        w['title'].set_text(item['title'])
+    else:
+        w['title'].set_text('')
+    if item.has_key('genre') and item['genre']:
+        w['genre'].set_text(item['genre'])
+    else:
+        w['genre'].set_text('')
+    if item.has_key('color') and item['color']:
+        w['color'].set_active( gutils.digits_only(item['color'], 3))
+    else:
+        w['color'].set_active( gutils.digits_only(self.config.get('color', 0, section='defaults'), 3))
+    if item.has_key('layers') and item['layers']:
+        w['layers'].set_active( gutils.digits_only(item['layers'], 4))
+    else:
+        w['layers'].set_active( gutils.digits_only(self.config.get('layers', 0, section='defaults'), 4))
+    if item.has_key('region') and item['region']&gt;=0:
+            w['region'].set_active( gutils.digits_only(item['region'], 8))
+    else:
+        w['region'].set_active( gutils.digits_only(self.config.get('region', 0, section='defaults'), 8))
+    if item.has_key('cond') and item['cond']&gt;=0:
+        w['condition'].set_active( gutils.digits_only( item['cond'], 5) )
+    else:
+        w['condition'].set_active( gutils.digits_only( self.config.get('condition', 0, section='defaults'), 5))
+    if item.has_key('media_num') and item['media_num']:
+        w['discs'].set_value( gutils.digits_only(item['media_num']))
+    else:
+        w['discs'].set_value(1)
+    if item.has_key('rating') and item['rating']:
+        w['rating_slider'].set_value( gutils.digits_only(item['rating'], 10) )
+    else:
+        w['rating_slider'].set_value(0)
+    if item.has_key('seen') and item['seen'] is True:
+        w['seen'].set_active(True)
+    else:
+        w['seen'].set_active(False)
+    if item.has_key('cast') and item['cast']:
+        cast_buffer.set_text(item['cast'])
+    else:
+        cast_buffer.set_text('')
+    if item.has_key('notes') and item['notes']:
+        notes_buffer.set_text(item['notes'])
+    else:
+        notes_buffer.set_text('')
+    if item.has_key('plot') and item['plot']:
+        plot_buffer.set_text(item['plot'])
+    else:
+        plot_buffer.set_text('')
+    pos = 0
+    if item.has_key('medium_id') and item['medium_id']:
+        pos = gutils.findKey(item['medium_id'], self.media_ids)
+    else:
+        pos = gutils.findKey(int(self.config.get('media', 0, section='defaults')), self.media_ids)
+    if pos is not None:
+        w['media'].set_active(int(pos))
+    else:
+        w['media'].set_active(0)
+    pos = 0
+    if item.has_key('vcodec_id') and item['vcodec_id']:
+        pos = gutils.findKey(item['vcodec_id'], self.vcodecs_ids)
+    else:
+        pos = gutils.findKey(int(self.config.get('vcodec', 0, section='defaults')), self.vcodecs_ids)
+    if pos is not None:
+        w['vcodec'].set_active(int(pos))
+    else:
+        w['vcodec'].set_active(0)
+    pos = 0
+    if item.has_key('volume_id') and item['volume_id']:
+        pos = gutils.findKey(item['volume_id'], self.volume_combo_ids)
+    if pos is not None:
+        w['volume'].set_active(int(pos))
+    else:
+        w['volume'].set_active(0)
+    pos = 0
+    if item.has_key('collection_id') and item['collection_id']:
+        pos = gutils.findKey(item['collection_id'], self.collection_combo_ids)
+    if pos is not None:
+        w['collection'].set_active(int(pos))
+    else:
+        w['volume'].set_active(0)
+    # tags
+    for tag in self.am_tags:
+        self.am_tags[tag].set_active(False)
+    if item.has_key('tags'):
+        for tag in item['tags']:
+            i = gutils.findKey(tag.tag_id, self.tags_ids)
+            self.am_tags[i].set_active(True)
+    # languages
+    w['lang_treeview'].get_model().clear()
+    if item.has_key('languages') and len(item['languages'])&gt;0:
+        for i in item['languages']:
+            self.create_language_row(i)
+    # poster
+    if item.has_key('image') and item['image']:
+        w['image'].set_text(item['image'])
+        image_path = os.path.join(self.locations['posters'], &quot;m_%s.jpg&quot; % item['image'])
+    else:
+        w['image'].set_text('')
+        image_path = os.path.join(self.locations['images'], 'default.png')
+    if not os.path.isfile(image_path):
+        image_path = os.path.join(self.locations['images'], 'default.png')
+    w['picture'].set_from_file(image_path)
+    
+    w['notebook'].set_current_page(0)
+    w['source'].set_active(self.d_plugin)
+    w['o_title'].grab_focus()
+    #}}}
 
 def get_details(self): #{{{
-	w = self.widgets['add']
-	
-	cast_buffer  = w['cast'].get_buffer()
-	notes_buffer = w['notes'].get_buffer()
-	plot_buffer  = w['plot'].get_buffer()
-	
-	t_movies = {
-		'classification' : w['classification'].get_text(),
-		'color'          : w['color'].get_active(),
-		'cond'           : w['condition'].get_active(),
-		'country'        : w['country'].get_text(),
-		'director'       : w['director'].get_text(),
-		'genre'          : w['genre'].get_text(),
-		'image'          : w['image'].get_text(),
-		'layers'         : w['layers'].get_active(),
-		'media_num'      : w['discs'].get_value(),
-		'number'         : w['number'].get_value(),
-		'o_site'         : w['o_site'].get_text(),
-		'o_title'        : w['o_title'].get_text(),
-		'rating'         : w['rating_slider'].get_value(),
-		'region'         : w['region'].get_active(),
-		'runtime'        : w['runtime'].get_text(),
-		'site'           : w['site'].get_text(),
-		'studio'         : w['studio'].get_text(),
-		'title'          : w['title'].get_text(),
-		'trailer'        : w['trailer'].get_text(),
-		'year'           : w['year'].get_value(),
-		'collection_id'  : w['collection'].get_active(),
-		'medium_id'      : w['media'].get_active(),
-		'volume_id'      : w['volume'].get_active(),
-		'vcodec_id'      : w['vcodec'].get_active(),
-		'cast'           : cast_buffer.get_text(cast_buffer.get_start_iter(),cast_buffer.get_end_iter()),
-		'notes'          : notes_buffer.get_text(notes_buffer.get_start_iter(),notes_buffer.get_end_iter()),
-		'plot'           : plot_buffer.get_text(plot_buffer.get_start_iter(),plot_buffer.get_end_iter()),
-	}
-	if self._am_movie_id is not None:
-		t_movies['movie_id'] = self._am_movie_id
-	
-	if t_movies['collection_id'] &gt; 0:
-		t_movies['collection_id'] = self.collection_combo_ids[t_movies['collection_id']]
-	else:
-		t_movies['collection_id'] = None
-	if t_movies['volume_id'] &gt; 0:
-		t_movies['volume_id'] = self.volume_combo_ids[t_movies['volume_id']]
-	else:
-		t_movies['volume_id'] = None
-	if t_movies['medium_id'] &gt; 0:
-		t_movies['medium_id'] = self.media_ids[t_movies['medium_id']]
-	else:
-		t_movies['medium_id'] = None
-	if t_movies['vcodec_id'] &gt; 0:
-		t_movies['vcodec_id'] = self.vcodecs_ids[t_movies['vcodec_id']]
-	else:
-		t_movies['vcodec_id'] = None
-	
-	if w['seen'].get_active():
-		t_movies['seen'] = True
-	else:
-		t_movies['seen'] = False
-	if t_movies['year'] &lt; 1900:
-		t_movies['year'] = None
+    w = self.widgets['add']
+    
+    cast_buffer  = w['cast'].get_buffer()
+    notes_buffer = w['notes'].get_buffer()
+    plot_buffer  = w['plot'].get_buffer()
+    
+    t_movies = {
+        'classification' : w['classification'].get_text(),
+        'color'          : w['color'].get_active(),
+        'cond'           : w['condition'].get_active(),
+        'country'        : w['country'].get_text(),
+        'director'       : w['director'].get_text(),
+        'genre'          : w['genre'].get_text(),
+        'image'          : w['image'].get_text(),
+        'layers'         : w['layers'].get_active(),
+        'media_num'      : w['discs'].get_value(),
+        'number'         : w['number'].get_value(),
+        'o_site'         : w['o_site'].get_text(),
+        'o_title'        : w['o_title'].get_text(),
+        'rating'         : w['rating_slider'].get_value(),
+        'region'         : w['region'].get_active(),
+        'runtime'        : w['runtime'].get_text(),
+        'site'           : w['site'].get_text(),
+        'studio'         : w['studio'].get_text(),
+        'title'          : w['title'].get_text(),
+        'trailer'        : w['trailer'].get_text(),
+        'year'           : w['year'].get_value(),
+        'collection_id'  : w['collection'].get_active(),
+        'medium_id'      : w['media'].get_active(),
+        'volume_id'      : w['volume'].get_active(),
+        'vcodec_id'      : w['vcodec'].get_active(),
+        'cast'           : cast_buffer.get_text(cast_buffer.get_start_iter(),cast_buffer.get_end_iter()),
+        'notes'          : notes_buffer.get_text(notes_buffer.get_start_iter(),notes_buffer.get_end_iter()),
+        'plot'           : plot_buffer.get_text(plot_buffer.get_start_iter(),plot_buffer.get_end_iter()),
+    }
+    if self._am_movie_id is not None:
+        t_movies['movie_id'] = self._am_movie_id
+    
+    if t_movies['collection_id'] &gt; 0:
+        t_movies['collection_id'] = self.collection_combo_ids[t_movies['collection_id']]
+    else:
+        t_movies['collection_id'] = None
+    if t_movies['volume_id'] &gt; 0:
+        t_movies['volume_id'] = self.volume_combo_ids[t_movies['volume_id']]
+    else:
+        t_movies['volume_id'] = None
+    if t_movies['medium_id'] &gt; 0:
+        t_movies['medium_id'] = self.media_ids[t_movies['medium_id']]
+    else:
+        t_movies['medium_id'] = None
+    if t_movies['vcodec_id'] &gt; 0:
+        t_movies['vcodec_id'] = self.vcodecs_ids[t_movies['vcodec_id']]
+    else:
+        t_movies['vcodec_id'] = None
+    
+    if w['seen'].get_active():
+        t_movies['seen'] = True
+    else:
+        t_movies['seen'] = False
+    if t_movies['year'] &lt; 1900:
+        t_movies['year'] = None
 
-	def get_id(model, text):
-		for i in model:
-			if i[1] == text:
-				return i[0]
-		return None
-	# languages
-	from sets import Set as set # for python2.3 compatibility
-	t_movies['languages'] = set()
-	for row in self.lang['model']:
-		lang_id   = get_id(self.lang['lang'], row[0])
-		lang_type = get_id(self.lang['type'], row[1])
-		acodec    = get_id(self.lang['acodec'], row[2])
-		achannel  = get_id(self.lang['achannel'], row[3])
-		subformat = get_id(self.lang['subformat'], row[4])
-		t_movies['languages'].add((lang_id, lang_type, acodec, achannel, subformat))
+    def get_id(model, text):
+        for i in model:
+            if i[1] == text:
+                return i[0]
+        return None
+    # languages
+    from sets import Set as set # for python2.3 compatibility
+    t_movies['languages'] = set()
+    for row in self.lang['model']:
+        lang_id   = get_id(self.lang['lang'], row[0])
+        lang_type = get_id(self.lang['type'], row[1])
+        acodec    = get_id(self.lang['acodec'], row[2])
+        achannel  = get_id(self.lang['achannel'], row[3])
+        subformat = get_id(self.lang['subformat'], row[4])
+        t_movies['languages'].add((lang_id, lang_type, acodec, achannel, subformat))
 
-	# tags
-	t_movies['tags'] = {}
-	for i in self.tags_ids:
-		if self.am_tags[i].get_active() == True:
-			t_movies['tags'][self.tags_ids[i]] = 1
-	
-	validate_details(t_movies)
+    # tags
+    t_movies['tags'] = {}
+    for i in self.tags_ids:
+        if self.am_tags[i].get_active() == True:
+            t_movies['tags'][self.tags_ids[i]] = 1
+    
+    validate_details(t_movies)
 
-	return t_movies	#}}}
+    return t_movies    #}}}
 
 def validate_details(t_movies, allow_only=None):
-	for i in t_movies.keys():
-		if t_movies[i] == '':
-			t_movies[i] = None
-	for i in ['color','cond','layers','region', 'media', 'vcodec']:
-		if t_movies.has_key(i) and t_movies[i] &lt; 1:
-			t_movies[i] = None
-	for i in ['volume_id','collection_id', 'runtime']:
-		if t_movies.has_key(i) and (t_movies[i] is None or int(t_movies[i]) == 0):
-			t_movies[i] = None
-	if allow_only is not None:
-		for i in t_movies:
-			if not i in allow_only:
-				t_movies.pop(i)
+    for i in t_movies.keys():
+        if t_movies[i] == '':
+            t_movies[i] = None
+    for i in ['color','cond','layers','region', 'media', 'vcodec']:
+        if t_movies.has_key(i) and t_movies[i] &lt; 1:
+            t_movies[i] = None
+    for i in ['volume_id','collection_id', 'runtime']:
+        if t_movies.has_key(i) and (t_movies[i] is None or int(t_movies[i]) == 0):
+            t_movies[i] = None
+    if allow_only is not None:
+        for i in t_movies:
+            if not i in allow_only:
+                t_movies.pop(i)
 
 def update_movie(self):
-	movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).one()
-	if movie is None: # movie was deleted in the meantime
-		return add_movie_db(self, True)
-	old_image = movie.image
-	details = get_details(self)
-	if movie.update_in_db(details):
-		treeselection = self.widgets['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		
-		if details['image'] and details['image'] != old_image:
-			# TODO: fetch poster from amazon / load from disk
-			image_path = os.path.join(self.locations['temp'], &quot;poster_%s.jpg&quot; % details['image'])
-			if os.path.isfile(image_path):
-				# delete old image
-				import delete
-				delete.delete_poster(self, old_image)
-				new_image_path = os.path.join(self.locations['posters'], &quot;%s.jpg&quot; % details['image'])
-				shutil.move(image_path, new_image_path)
-				#lets make the thumbnail and medium image from poster for future use
-				gutils.make_thumbnail(self, &quot;%s.jpg&quot;%details['image'])
-				gutils.make_medium_image(self, &quot;%s.jpg&quot;%details['image'])
-				# update thumbnail in main list
-				handler = self.Image.set_from_file(new_image_path)
-				pixbuf = self.Image.get_pixbuf()
-				tmp_model.set_value(tmp_iter,1, pixbuf.scale_simple(30,40,3))
-		# update main treelist
-		tmp_model.set_value(tmp_iter,0,'%004d' % int(movie.number))
-		tmp_model.set_value(tmp_iter,2, movie.o_title)
-		tmp_model.set_value(tmp_iter,3, movie.title)
-		tmp_model.set_value(tmp_iter,4, movie.director)
-		tmp_model.set_value(tmp_iter,5, movie.genre)
-		tmp_model.set_value(tmp_iter,6, movie.seen)
-		if movie.year is None:
-			tmp_model.set_value(tmp_iter,7, '')
-		else:
-			tmp_model.set_value(tmp_iter,7, movie.year)
-		if movie.runtime is None:
-			tmp_model.set_value(tmp_iter,8, '')
-		else:
-			tmp_model.set_value(tmp_iter,8, '%003d' % int(movie.runtime) + _(' min'))
-		# close add window
-		self.widgets['add']['window'].hide()
-		# refresh
-		self.treeview_clicked()
-		self.update_statusbar(_('Movie information has been updated'))
+    movie = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).one()
+    if movie is None: # movie was deleted in the meantime
+        return add_movie_db(self, True)
+    old_image = movie.image
+    details = get_details(self)
+    if movie.update_in_db(details):
+        treeselection = self.widgets['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        
+        if details['image'] and details['image'] != old_image:
+            # TODO: fetch poster from amazon / load from disk
+            image_path = os.path.join(self.locations['temp'], &quot;poster_%s.jpg&quot; % details['image'])
+            if os.path.isfile(image_path):
+                # delete old image
+                import delete
+                delete.delete_poster(self, old_image)
+                new_image_path = os.path.join(self.locations['posters'], &quot;%s.jpg&quot; % details['image'])
+                shutil.move(image_path, new_image_path)
+                #lets make the thumbnail and medium image from poster for future use
+                gutils.make_thumbnail(self, &quot;%s.jpg&quot;%details['image'])
+                gutils.make_medium_image(self, &quot;%s.jpg&quot;%details['image'])
+                # update thumbnail in main list
+                handler = self.Image.set_from_file(new_image_path)
+                pixbuf = self.Image.get_pixbuf()
+                tmp_model.set_value(tmp_iter,1, pixbuf.scale_simple(30,40,3))
+        # update main treelist
+        tmp_model.set_value(tmp_iter,0,'%004d' % int(movie.number))
+        tmp_model.set_value(tmp_iter,2, movie.o_title)
+        tmp_model.set_value(tmp_iter,3, movie.title)
+        tmp_model.set_value(tmp_iter,4, movie.director)
+        tmp_model.set_value(tmp_iter,5, movie.genre)
+        tmp_model.set_value(tmp_iter,6, movie.seen)
+        if movie.year is None:
+            tmp_model.set_value(tmp_iter,7, '')
+        else:
+            tmp_model.set_value(tmp_iter,7, movie.year)
+        if movie.runtime is None:
+            tmp_model.set_value(tmp_iter,8, '')
+        else:
+            tmp_model.set_value(tmp_iter,8, '%003d' % int(movie.runtime) + _(' min'))
+        # close add window
+        self.widgets['add']['window'].hide()
+        # refresh
+        self.treeview_clicked()
+        self.update_statusbar(_('Movie information has been updated'))
 
 def add_movie_db(self, close):
-	details = get_details(self)
-	if not details['o_title'] and not details['title']:
-		gutils.error(self.widgets['results']['window'], _(&quot;You should fill the original title\nor the movie title.&quot;), parent=self.widgets['add']['window'])
-		return False
+    details = get_details(self)
+    if not details['o_title'] and not details['title']:
+        gutils.error(self.widgets['results']['window'], _(&quot;You should fill the original title\nor the movie title.&quot;), parent=self.widgets['add']['window'])
+        return False
 
-	if details['o_title']:
-		tmp_movie = self.db.Movie.query.filter_by(o_title=details['o_title']).first()
-		if tmp_movie is not None:
-			response = gutils.question(self, msg=_('Movie with that title already exists, are you sure you want to add?'), cancel=0, parent=self.widgets['add']['window'])
-			if response == gtk.RESPONSE_NO:
-				return False
-	if details['title']:
-		tmp_movie = self.db.Movie.query.filter_by(title=details['title']).first()
-		if tmp_movie is not None:
-			response = gutils.question(self, msg=_('Movie with that title already exists, are you sure you want to add?'), cancel=0, parent=self.widgets['add']['window'])
-			if response == gtk.RESPONSE_NO:
-				return False
+    if details['o_title']:
+        tmp_movie = self.db.session.query(db.Movie).filter_by(o_title=details['o_title']).first()
+        if tmp_movie is not None:
+            response = gutils.question(self, msg=_('Movie with that title already exists, are you sure you want to add?'), cancel=0, parent=self.widgets['add']['window'])
+            if response == gtk.RESPONSE_NO:
+                return False
+    if details['title']:
+        tmp_movie = self.db.session.query(db.Movie).filter_by(title=details['title']).first()
+        if tmp_movie is not None:
+            response = gutils.question(self, msg=_('Movie with that title already exists, are you sure you want to add?'), cancel=0, parent=self.widgets['add']['window'])
+            if response == gtk.RESPONSE_NO:
+                return False
 
-	movie = self.db.Movie()
-	if not movie.add_to_db(details):
-		return False
+    movie = createMovieInstance(details)
+    self.db.session.add(movie)
+    self.db.session.commit()
+    self.db.session.flush()
+    if not self.db.session.commit():
+        self.debug.show(&quot;cannot add movie&quot;)
+        return False
 
-	# lets move poster from tmp to posters dir
-	tmp_dest = self.locations['posters']
+    # lets move poster from tmp to posters dir
+    tmp_dest = self.locations['posters']
 
-	image_path = ''
-	if details['image']:
-		tmp_image_path = os.path.join(self.locations['temp'], &quot;poster_%s.jpg&quot; % details['image'])
-		if os.path.isfile(tmp_image_path):
-			image_path = os.path.join(tmp_dest, &quot;%s.jpg&quot; % details['image'])
-			shutil.move(tmp_image_path, image_path)
-			#lets make the thumbnail and medium image from poster for future use
-			gutils.make_thumbnail(self, &quot;%s.jpg&quot;%details['image'])
-			gutils.make_medium_image(self, &quot;%s.jpg&quot;%details['image'])
+    image_path = ''
+    if details['image']:
+        tmp_image_path = os.path.join(self.locations['temp'], &quot;poster_%s.jpg&quot; % details['image'])
+        if os.path.isfile(tmp_image_path):
+            image_path = os.path.join(tmp_dest, &quot;%s.jpg&quot; % details['image'])
+            shutil.move(tmp_image_path, image_path)
+            #lets make the thumbnail and medium image from poster for future use
+            gutils.make_thumbnail(self, &quot;%s.jpg&quot;%details['image'])
+            gutils.make_medium_image(self, &quot;%s.jpg&quot;%details['image'])
 
-	rows = len(self.treemodel)
-	if rows&gt;0:
-		insert_after = self.treemodel.get_iter(rows-1)	# last
-	else:
-		insert_after = None
-	myiter = self.treemodel.insert_after(None, insert_after)
+    rows = len(self.treemodel)
+    if rows&gt;0:
+        insert_after = self.treemodel.get_iter(rows-1)    # last
+    else:
+        insert_after = None
+    myiter = self.treemodel.insert_after(None, insert_after)
 
-	if not os.path.isfile(image_path):
-		image_path = os.path.join(self.locations['images'], 'default.png')
-	handler = self.Image.set_from_file(image_path)
-	pixbuf = self.Image.get_pixbuf()
-	self.treemodel.set_value(myiter, 0, '%004d' % details['number'])
-	self.treemodel.set_value(myiter, 1, pixbuf.scale_simple(30,40,3))
-	self.treemodel.set_value(myiter, 2, details['o_title'])
-	self.treemodel.set_value(myiter, 3, details['title'])
-	self.treemodel.set_value(myiter, 4, details['director'])
-	self.treemodel.set_value(myiter, 5, details['genre'])
-	self.treemodel.set_value(myiter, 6, details['seen'])
-	if details['year'] is None:
-		self.treemodel.set_value(myiter, 7, '')
-	else:
-		self.treemodel.set_value(myiter, 7, details['year'])
-	if details['runtime'] is None:
-		self.treemodel.set_value(myiter, 8, '')
-	else:
-		self.treemodel.set_value(myiter, 8, '%003d' % int(details['runtime']) + _(' min'))
-	#update statusbar
-	self.total += 1
-	self.count_statusbar()
-	#select new entry from main treelist
-	self.widgets['treeview'].get_selection().select_iter(myiter)
-	self.treeview_clicked()
-	clear(self)
+    if not os.path.isfile(image_path):
+        image_path = os.path.join(self.locations['images'], 'default.png')
+    handler = self.Image.set_from_file(image_path)
+    pixbuf = self.Image.get_pixbuf()
+    self.treemodel.set_value(myiter, 0, '%004d' % details['number'])
+    self.treemodel.set_value(myiter, 1, pixbuf.scale_simple(30,40,3))
+    self.treemodel.set_value(myiter, 2, details['o_title'])
+    self.treemodel.set_value(myiter, 3, details['title'])
+    self.treemodel.set_value(myiter, 4, details['director'])
+    self.treemodel.set_value(myiter, 5, details['genre'])
+    self.treemodel.set_value(myiter, 6, details['seen'])
+    if details['year'] is None:
+        self.treemodel.set_value(myiter, 7, '')
+    else:
+        self.treemodel.set_value(myiter, 7, details['year'])
+    if details['runtime'] is None:
+        self.treemodel.set_value(myiter, 8, '')
+    else:
+        self.treemodel.set_value(myiter, 8, '%003d' % int(details['runtime']) + _(' min'))
+    #update statusbar
+    self.total += 1
+    self.count_statusbar()
+    #select new entry from main treelist
+    self.widgets['treeview'].get_selection().select_iter(myiter)
+    self.treeview_clicked()
+    clear(self)
 
-	if close:
-		self.hide_add_window()
+    if close:
+        self.hide_add_window()
 
 def change_rating_from_slider(self):
-	rating = int(self.widgets['add']['rating_slider'].get_value())
-	self.widgets['add']['image_rating'].show()
-	try:
-		rimage = int(str(self.config.get('rating_image')))
-	except:
-		rimage = 0
-	if rimage:
-		prefix = ''
-	else:
-		prefix = &quot;meter&quot;
-	rating_file = &quot;%s/%s0%d.png&quot; % (self.locations['images'], prefix, rating)
-	handler = self.widgets['add']['image_rating'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(rating_file))
+    rating = int(self.widgets['add']['rating_slider'].get_value())
+    self.widgets['add']['image_rating'].show()
+    try:
+        rimage = int(str(self.config.get('rating_image')))
+    except:
+        rimage = 0
+    if rimage:
+        prefix = ''
+    else:
+        prefix = &quot;meter&quot;
+    rating_file = &quot;%s/%s0%d.png&quot; % (self.locations['images'], prefix, rating)
+    handler = self.widgets['add']['image_rating'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(rating_file))
 
 def populate_with_results(self):
-	w = self.widgets['add']
-	m_id = None
-	if self.founded_results_id:
-		self.debug.show(&quot;self.founded:results_id: %s&quot; % self.founded_results_id)
-		m_id = self.founded_results_id
-	else:
-		self.founded_results_id = 0
-		treeselection = self.widgets['results']['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		if tmp_iter is None:
-			return False
-		m_id = tmp_model.get_value(tmp_iter, 0)
-	
-	self.treemodel_results.clear()
-	self.widgets['results']['window'].hide()
+    w = self.widgets['add']
+    m_id = None
+    if self.founded_results_id:
+        self.debug.show(&quot;self.founded:results_id: %s&quot; % self.founded_results_id)
+        m_id = self.founded_results_id
+    else:
+        self.founded_results_id = 0
+        treeselection = self.widgets['results']['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        if tmp_iter is None:
+            return False
+        m_id = tmp_model.get_value(tmp_iter, 0)
+    
+    self.treemodel_results.clear()
+    self.widgets['results']['window'].hide()
 
-	plugin_name = 'PluginMovie' + self.active_plugin
-	plugin = __import__(plugin_name)
-	self.movie = plugin.Plugin(m_id)
-	self.movie.locations = self.locations
-	
-	fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
-				'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
-				'notes', 'runtime', 'image', 'rating']
-	# remove fields that user doesn't want to fetch: (see preferences window)
-	fields_to_fetch = [ i for i in fields_to_fetch if self.config.get(&quot;s_%s&quot; % i, True, section='add') ]
+    plugin_name = 'PluginMovie' + self.active_plugin
+    plugin = __import__(plugin_name)
+    self.movie = plugin.Plugin(m_id)
+    self.movie.locations = self.locations
+    
+    fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
+                'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
+                'notes', 'runtime', 'image', 'rating']
+    # remove fields that user doesn't want to fetch: (see preferences window)
+    fields_to_fetch = [ i for i in fields_to_fetch if self.config.get(&quot;s_%s&quot; % i, True, section='add') ]
 
-	if w['cb_only_empty'].get_active(): # only empty fields
-		details = get_details(self)
-		fields_to_fetch = [ i for i in fields_to_fetch if details[i] is None ]
-	self.movie.fields_to_fetch = fields_to_fetch
-	
-	self.movie.open_page(w['window'])
-	self.movie.parse_movie()
+    if w['cb_only_empty'].get_active(): # only empty fields
+        details = get_details(self)
+        fields_to_fetch = [ i for i in fields_to_fetch if details[i] is None ]
+    self.movie.fields_to_fetch = fields_to_fetch
+    
+    self.movie.open_page(w['window'])
+    self.movie.parse_movie()
 
-	if 'year' in fields_to_fetch:
-		w['year'].set_value(int(self.movie.year))
-		fields_to_fetch.pop(fields_to_fetch.index('year'))
-	if 'runtime' in fields_to_fetch:
-		w['runtime'].set_value(int(self.movie.runtime))
-		fields_to_fetch.pop(fields_to_fetch.index('runtime'))
-	if 'cast' in fields_to_fetch:
-		cast_buffer = w['cast'].get_buffer()
-		cast_buffer.set_text(gutils.convert_entities(self.movie.cast))
-		fields_to_fetch.pop(fields_to_fetch.index('cast'))
-	if 'plot' in fields_to_fetch:
-		plot_buffer = w['plot'].get_buffer()
-		plot_buffer.set_text(gutils.convert_entities(self.movie.plot))
-		fields_to_fetch.pop(fields_to_fetch.index('plot'))
-	if 'notes' in fields_to_fetch:
-		notes_buffer = w['notes'].get_buffer()
-		notes_buffer.set_text(gutils.convert_entities(self.movie.notes))
-		fields_to_fetch.pop(fields_to_fetch.index('notes'))
-	if 'rating' in fields_to_fetch:
-		if self.movie.rating:
-			w['rating_slider'].set_value(float(self.movie.rating))
-		fields_to_fetch.pop(fields_to_fetch.index('rating'))
-	# poster
-	if 'image' in fields_to_fetch:
-		if self.movie.image:
-			image = os.path.join(self.locations['temp'], &quot;poster_%s.jpg&quot; % self.movie.image)
-			try:
-				handler = self.Image.set_from_file(image)
-				pixbuf = self.Image.get_pixbuf()
-				w['picture'].set_from_pixbuf(pixbuf.scale_simple(100, 140, 3))
-				w['image'].set_text(self.movie.image)
-			except:
-				image = os.path.join(self.locations['images'], 'default.png')
-				handler = self.Image.set_from_file(image)
-				w['picture'].set_from_pixbuf(self.Image.get_pixbuf())
-		else:
-			image = os.path.join(self.locations['images'], 'default.png')
-			handler = self.Image.set_from_file(image)
-			Pixbuf = self.Image.get_pixbuf()
-			w['picture'].set_from_pixbuf(Pixbuf)
-		fields_to_fetch.pop(fields_to_fetch.index('image'))
-	# other fields
-	for i in fields_to_fetch:
-		w[i].set_text(gutils.convert_entities(self.movie[i]))
+    if 'year' in fields_to_fetch:
+        w['year'].set_value(int(self.movie.year))
+        fields_to_fetch.pop(fields_to_fetch.index('year'))
+    if 'runtime' in fields_to_fetch:
+        w['runtime'].set_value(int(self.movie.runtime))
+        fields_to_fetch.pop(fields_to_fetch.index('runtime'))
+    if 'cast' in fields_to_fetch:
+        cast_buffer = w['cast'].get_buffer()
+        cast_buffer.set_text(gutils.convert_entities(self.movie.cast))
+        fields_to_fetch.pop(fields_to_fetch.index('cast'))
+    if 'plot' in fields_to_fetch:
+        plot_buffer = w['plot'].get_buffer()
+        plot_buffer.set_text(gutils.convert_entities(self.movie.plot))
+        fields_to_fetch.pop(fields_to_fetch.index('plot'))
+    if 'notes' in fields_to_fetch:
+        notes_buffer = w['notes'].get_buffer()
+        notes_buffer.set_text(gutils.convert_entities(self.movie.notes))
+        fields_to_fetch.pop(fields_to_fetch.index('notes'))
+    if 'rating' in fields_to_fetch:
+        if self.movie.rating:
+            w['rating_slider'].set_value(float(self.movie.rating))
+        fields_to_fetch.pop(fields_to_fetch.index('rating'))
+    # poster
+    if 'image' in fields_to_fetch:
+        if self.movie.image:
+            image = os.path.join(self.locations['temp'], &quot;poster_%s.jpg&quot; % self.movie.image)
+            try:
+                handler = self.Image.set_from_file(image)
+                pixbuf = self.Image.get_pixbuf()
+                w['picture'].set_from_pixbuf(pixbuf.scale_simple(100, 140, 3))
+                w['image'].set_text(self.movie.image)
+            except:
+                image = os.path.join(self.locations['images'], 'default.png')
+                handler = self.Image.set_from_file(image)
+                w['picture'].set_from_pixbuf(self.Image.get_pixbuf())
+        else:
+            image = os.path.join(self.locations['images'], 'default.png')
+            handler = self.Image.set_from_file(image)
+            Pixbuf = self.Image.get_pixbuf()
+            w['picture'].set_from_pixbuf(Pixbuf)
+        fields_to_fetch.pop(fields_to_fetch.index('image'))
+    # other fields
+    for i in fields_to_fetch:
+        w[i].set_text(gutils.convert_entities(self.movie[i]))
 
 def show_websearch_results(self):
-	total = self.founded_results_id = 0
-	for g in self.search_movie.ids:
-		if ( str(g) != '' ):
-			total += 1
-	if total &gt; 1:
-		self.widgets['results']['window'].show()
-		self.widgets['results']['window'].set_keep_above(True)
-		row = None	
-		key = 0
-		self.treemodel_results.clear()
-		for row in self.search_movie.ids:
-			if (str(row)!=''):
-				title = str(self.search_movie.titles[key]).decode(self.search_movie.encode)
-				myiter = self.treemodel_results.insert_before(None, None)
-				self.treemodel_results.set_value(myiter, 0, str(row))
-				self.treemodel_results.set_value(myiter, 1, title)
-			key +=1
-		self.widgets['results']['treeview'].show()
-	elif total==1:
-		self.widgets['results']['treeview'].set_cursor(total-1)
-		for row in self.search_movie.ids:
-			if ( str(row) != '' ):
-				self.founded_results_id = str(row)
-				populate_with_results(self)
-	else:
-		gutils.error(self.widgets['results']['window'], _(&quot;No results&quot;), self.widgets['add']['window'])
+    total = self.founded_results_id = 0
+    for g in self.search_movie.ids:
+        if ( str(g) != '' ):
+            total += 1
+    if total &gt; 1:
+        self.widgets['results']['window'].show()
+        self.widgets['results']['window'].set_keep_above(True)
+        row = None    
+        key = 0
+        self.treemodel_results.clear()
+        for row in self.search_movie.ids:
+            if (str(row)!=''):
+                title = str(self.search_movie.titles[key]).decode(self.search_movie.encode)
+                myiter = self.treemodel_results.insert_before(None, None)
+                self.treemodel_results.set_value(myiter, 0, str(row))
+                self.treemodel_results.set_value(myiter, 1, title)
+            key +=1
+        self.widgets['results']['treeview'].show()
+    elif total==1:
+        self.widgets['results']['treeview'].set_cursor(total-1)
+        for row in self.search_movie.ids:
+            if ( str(row) != '' ):
+                self.founded_results_id = str(row)
+                populate_with_results(self)
+    else:
+        gutils.error(self.widgets['results']['window'], _(&quot;No results&quot;), self.widgets['add']['window'])
 
 def get_from_web(self):
-	&quot;&quot;&quot;search the movie in web using the active plugin&quot;&quot;&quot;
-	title = self.widgets['add']['title'].get_text()
-	o_title = self.widgets['add']['o_title'].get_text()
+    &quot;&quot;&quot;search the movie in web using the active plugin&quot;&quot;&quot;
+    title = self.widgets['add']['title'].get_text()
+    o_title = self.widgets['add']['o_title'].get_text()
 
-	if o_title or title:
-		option = gutils.on_combo_box_entry_changed_name(self.widgets['add']['source'])
-		self.active_plugin = option
-		plugin_name = 'PluginMovie%s' % option
-		plugin = __import__(plugin_name)
-		self.search_movie = plugin.SearchPlugin()
-		if o_title:
-			self.search_movie.url = self.search_movie.original_url_search
-			if self.search_movie.remove_accents:
-				self.search_movie.title = gutils.remove_accents(o_title, 'utf-8')
-			else:
-				self.search_movie.title = unicode(o_title, 'utf-8')
-		elif title:
-			self.search_movie.url = self.search_movie.translated_url_search
-			if self.search_movie.remove_accents:
-				self.search_movie.title = gutils.remove_accents(title, 'utf-8')
-			else:
-				self.search_movie.title = unicode(title, 'utf-8')
-		self.search_movie.search(self.widgets['add']['window'])
-		self.search_movie.get_searches()
-		if len(self.search_movie.ids) == 1 and o_title and title:
-			self.search_movie.url = self.search_movie.translated_url_search
-			if self.search_movie.remove_accents:
-				self.search_movie.title = gutils.remove_accents(title, 'utf-8')
-			else:
-				self.search_movie.title = unicode(title, 'utf-8')
-			self.search_movie.search(self.widgets['add']['window'])
-			self.search_movie.get_searches()
-		self.show_search_results(self.search_movie)
-	else:
-		gutils.error(self.widgets['results']['window'], \
-			_(&quot;You should fill the original title\nor the movie title.&quot;))
+    if o_title or title:
+        option = gutils.on_combo_box_entry_changed_name(self.widgets['add']['source'])
+        self.active_plugin = option
+        plugin_name = 'PluginMovie%s' % option
+        plugin = __import__(plugin_name)
+        self.search_movie = plugin.SearchPlugin()
+        if o_title:
+            self.search_movie.url = self.search_movie.original_url_search
+            if self.search_movie.remove_accents:
+                self.search_movie.title = gutils.remove_accents(o_title, 'utf-8')
+            else:
+                self.search_movie.title = unicode(o_title, 'utf-8')
+        elif title:
+            self.search_movie.url = self.search_movie.translated_url_search
+            if self.search_movie.remove_accents:
+                self.search_movie.title = gutils.remove_accents(title, 'utf-8')
+            else:
+                self.search_movie.title = unicode(title, 'utf-8')
+        self.search_movie.search(self.widgets['add']['window'])
+        self.search_movie.get_searches()
+        if len(self.search_movie.ids) == 1 and o_title and title:
+            self.search_movie.url = self.search_movie.translated_url_search
+            if self.search_movie.remove_accents:
+                self.search_movie.title = gutils.remove_accents(title, 'utf-8')
+            else:
+                self.search_movie.title = unicode(title, 'utf-8')
+            self.search_movie.search(self.widgets['add']['window'])
+            self.search_movie.get_searches()
+        self.show_search_results(self.search_movie)
+    else:
+        gutils.error(self.widgets['results']['window'], \
+            _(&quot;You should fill the original title\nor the movie title.&quot;))
 
 def source_changed(self):
-	option = gutils.on_combo_box_entry_changed_name(self.widgets['add']['source'])
-	self.active_plugin = option
-	plugin_name = 'PluginMovie' + option
-	plugin = __import__(plugin_name)
-	self.widgets['add']['plugin_desc'].set_text(plugin.plugin_name+&quot;\n&quot; \
-		+plugin.plugin_description+&quot;\n&quot;+_(&quot;Url: &quot;) \
-		+plugin.plugin_url+&quot;\n&quot;+_(&quot;Language: &quot;)+plugin.plugin_language)
-	image = os.path.join(self.locations['images'], plugin_name + &quot;.png&quot;)
-	# if movie plugin logo exists lets use it
-	if os.path.exists(image):
-		handler = self.widgets['add']['plugin_image'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(image))
+    option = gutils.on_combo_box_entry_changed_name(self.widgets['add']['source'])
+    self.active_plugin = option
+    plugin_name = 'PluginMovie' + option
+    plugin = __import__(plugin_name)
+    self.widgets['add']['plugin_desc'].set_text(plugin.plugin_name+&quot;\n&quot; \
+        +plugin.plugin_description+&quot;\n&quot;+_(&quot;Url: &quot;) \
+        +plugin.plugin_url+&quot;\n&quot;+_(&quot;Language: &quot;)+plugin.plugin_language)
+    image = os.path.join(self.locations['images'], plugin_name + &quot;.png&quot;)
+    # if movie plugin logo exists lets use it
+    if os.path.exists(image):
+        handler = self.widgets['add']['plugin_image'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(image))
 
 def clone_movie(self):
-	treeselection = self.widgets['treeview'].get_selection()
-	(tmp_model, tmp_iter) = treeselection.get_selected()
-	if tmp_iter is None:
-		return False
-	number = tmp_model.get_value(tmp_iter, 0)
-	movie = self.db.Movie.query.filter_by(number=number).first()
+    treeselection = self.widgets['treeview'].get_selection()
+    (tmp_model, tmp_iter) = treeselection.get_selected()
+    if tmp_iter is None:
+        return False
+    number = tmp_model.get_value(tmp_iter, 0)
+    movie = self.db.session.query(db.Movie).filter_by(number=number).first()
 
-	if movie is None:
-		return False
+    if movie is None:
+        return False
 
-	next_number = gutils.find_next_available(self.db)
-	if movie.image is not None:
-		new_image = str(movie.image) + '_' + str(next_number)
-	else:
-		new_image = None
-	
-	# integer problem workaround
-	if int(movie.seen)==1:
-		seen = True
-	else:
-		seen = False
-	new_movie = self.db.Movie()
-	
-	new_movie.cast = movie.cast
-	new_movie.classification = movie.classification
-	new_movie.vcodec_id = movie.vcodec_id
-	new_movie.collection_id = movie.collection_id
-	new_movie.volume_id = movie.volume_id
-	new_movie.color = movie.color
-	new_movie.cond = movie.cond
-	new_movie.country = movie.country
-	new_movie.director = movie.director
-	new_movie.genre = movie.genre
-	new_movie.image = new_image
-	new_movie.site = movie.site
-	new_movie.loaned = movie.loaned
-	new_movie.layers = movie.layers
-	new_movie.medium_id = movie.medium_id
-	new_movie.number = next_number
-	new_movie.media_num = movie.media_num
-	new_movie.notes = movie.notes
-	new_movie.o_title = movie.o_title
-	new_movie.plot = movie.plot
-	new_movie.rating = movie.rating
-	new_movie.region = movie.region
-	new_movie.runtime = movie.runtime
-	new_movie.seen = seen
-	new_movie.o_site = movie.o_site
-	new_movie.studio = movie.studio
-	new_movie.title = movie.title
-	new_movie.trailer = movie.trailer
-	new_movie.year = movie.year
-	
-	new_movie.tags = movie.tags
-	new_movie.languages = movie.languages
-	new_movie.loans = movie.loans
-	
-	# save
-	new_movie.save()
-	new_movie.flush()
+    next_number = gutils.find_next_available(self.db)
+    if movie.image is not None:
+        new_image = str(movie.image) + '_' + str(next_number)
+    else:
+        new_image = None
+    
+    # integer problem workaround
+    if int(movie.seen)==1:
+        seen = True
+    else:
+        seen = False
+    new_movie = db.Movie()
+    
+    new_movie.cast = movie.cast
+    new_movie.classification = movie.classification
+    new_movie.vcodec_id = movie.vcodec_id
+    new_movie.collection_id = movie.collection_id
+    new_movie.volume_id = movie.volume_id
+    new_movie.color = movie.color
+    new_movie.cond = movie.cond
+    new_movie.country = movie.country
+    new_movie.director = movie.director
+    new_movie.genre = movie.genre
+    new_movie.image = new_image
+    new_movie.site = movie.site
+    new_movie.loaned = movie.loaned
+    new_movie.layers = movie.layers
+    new_movie.medium_id = movie.medium_id
+    new_movie.number = next_number
+    new_movie.media_num = movie.media_num
+    new_movie.notes = movie.notes
+    new_movie.o_title = movie.o_title
+    new_movie.plot = movie.plot
+    new_movie.rating = movie.rating
+    new_movie.region = movie.region
+    new_movie.runtime = movie.runtime
+    new_movie.seen = seen
+    new_movie.o_site = movie.o_site
+    new_movie.studio = movie.studio
+    new_movie.title = movie.title
+    new_movie.trailer = movie.trailer
+    new_movie.year = movie.year
+    
+    new_movie.tags = movie.tags
+    new_movie.languages = movie.languages
+    new_movie.loans = movie.loans
+    
+    # save
+    self.db.session.add(new_movie)
+    if not self.db.session.commit():
+        self.debug.show(&quot;cannot clone movie&quot;)
+        return False
 
-	# WARNING: loan problems (don't copy volume/collection data until resolved)
+    # WARNING: loan problems (don't copy volume/collection data until resolved)
 
-	tmp_dest = self.locations['posters']
-	if movie.image is not None:
-		image_path = os.path.join(tmp_dest, str(movie.image)+&quot;.jpg&quot;)
-		clone_path = os.path.join(tmp_dest, new_image+&quot;.jpg&quot;)
-		# clone image
-		# catch IOError otherwise you would not see the cloned entry in
-		# the list before the next start of griffith or another refresh
-		# of the list
-		try:
-			shutil.copyfile(image_path, clone_path)
-			image_path = clone_path
-			gutils.make_thumbnail(self, &quot;%s.jpg&quot; % new_image)
-			gutils.make_medium_image(self, &quot;%s.jpg&quot; % new_image)
-		except IOError:
-			image_path = os.path.join(self.locations['images'], &quot;default.png&quot;)
-	else:
-		image_path = os.path.join(self.locations['images'], &quot;default.png&quot;)
-	handler = self.Image.set_from_file(image_path)
+    tmp_dest = self.locations['posters']
+    if movie.image is not None:
+        image_path = os.path.join(tmp_dest, str(movie.image)+&quot;.jpg&quot;)
+        clone_path = os.path.join(tmp_dest, new_image+&quot;.jpg&quot;)
+        # clone image
+        # catch IOError otherwise you would not see the cloned entry in
+        # the list before the next start of griffith or another refresh
+        # of the list
+        try:
+            shutil.copyfile(image_path, clone_path)
+            image_path = clone_path
+            gutils.make_thumbnail(self, &quot;%s.jpg&quot; % new_image)
+            gutils.make_medium_image(self, &quot;%s.jpg&quot; % new_image)
+        except IOError:
+            image_path = os.path.join(self.locations['images'], &quot;default.png&quot;)
+    else:
+        image_path = os.path.join(self.locations['images'], &quot;default.png&quot;)
+    handler = self.Image.set_from_file(image_path)
 
-	# change_filter calls populate_treeview which updates the status bar
-	quick_filter.change_filter(self)
+    # change_filter calls populate_treeview which updates the status bar
+    quick_filter.change_filter(self)
 
+def createMovieInstance(details):
+    movie = db.Movie()
+    if details is not None:
+        t_tags = t_languages = None
+        if details.has_key('tags'):
+            t_tags = details.pop('tags')
+        if details.has_key('languages'):
+            t_languages = details.pop('languages')
+        for i in db.movies_table.columns.keys():
+            if details.has_key(i):
+                setattr(movie, i, details[i])
+        # languages
+        if t_languages is not None:
+            for lang in t_languages:
+                if lang[0]&gt;0:
+                    ml = db.MovieLang(lang_id=lang[0], type=lang[1],
+                        acodec_id=lang[2], achannel_id=lang[3], subformat_id=lang[4])
+                    movie.languages.append(ml)
+        # tags
+        if t_tags is not None:
+            for tag in t_tags.keys():
+                movie.tags.append(db.Tag(tag_id=tag))
+    return movie
+#    try:
+#        self.flush()
+#    except exceptions.SQLError, e:
+#        debug.show(&quot;add_to_db: %s&quot; % e)
+#        if e.args[0][:16] == '(IntegrityError)':
+#            gutils.error(None, _('Column &quot;%s&quot; is not unique') % _('Number'))
+#        return False
+#    self.refresh()
+
+
 # vim: fdm=marker

Modified: trunk/lib/backup.py
===================================================================
--- trunk/lib/backup.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/backup.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -28,236 +28,236 @@
 import zipfile
 
 def backup(self):
-	&quot;&quot;&quot;perform a compressed griffith database/posters/preferences backup&quot;&quot;&quot;
-	filename = gutils.file_chooser(_(&quot;Save Griffith backup&quot;), \
-		action=gtk.FILE_CHOOSER_ACTION_SAVE, buttons= \
-		(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK), \
-		name=self.config.get('name','griffith', section='database') + '_backup.zip')
-	if filename and filename[0]:
-		overwrite = None
-		zipfilename = filename[0].decode('utf-8')
-		if os.path.isfile(zipfilename):
-			response = gutils.question(self, \
-				_(&quot;File exists. Do you want to overwrite it?&quot;), \
-				1, self.widgets['window'])
-			if response == -8:
-				overwrite = True
-			else:
-				overwrite = False
+    &quot;&quot;&quot;perform a compressed griffith database/posters/preferences backup&quot;&quot;&quot;
+    filename = gutils.file_chooser(_(&quot;Save Griffith backup&quot;), \
+        action=gtk.FILE_CHOOSER_ACTION_SAVE, buttons= \
+        (gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK), \
+        name=self.config.get('name','griffith', section='database') + '_backup.zip')
+    if filename and filename[0]:
+        overwrite = None
+        zipfilename = filename[0].decode('utf-8')
+        if os.path.isfile(zipfilename):
+            response = gutils.question(self, \
+                _(&quot;File exists. Do you want to overwrite it?&quot;), \
+                1, self.widgets['window'])
+            if response == -8:
+                overwrite = True
+            else:
+                overwrite = False
 
-		if overwrite == True or overwrite is None:
-			try:
-				if zipfile.zlib is not None:
-					mzip = zipfile.ZipFile(zipfilename, 'w', zipfile.ZIP_DEFLATED)
-				else:
-					mzip = zipfile.ZipFile(zipfilename, 'w')
-			except:
-				gutils.error(self, _(&quot;Error creating backup&quot;), self.widgets['window'])
-				return False
-			mzip.write(os.path.join(self.locations['home'],'griffith.cfg').encode('utf-8'))
-			if self.db.metadata.engine.name == 'sqlite':
-				fileName = os.path.join(self.locations['home'], self.config.get('name','griffith', section='database') + '.db').encode('utf-8')
-				mzip.write(fileName)
-			else:
-				gutils.error(self, _(&quot;Backup function is available only for SQLite engine for now&quot;), self.widgets['window'])
-				return False
-				from tempfile import mkdtemp
-				from shutil import rmtree, move
-				from sqlalchemy import BoundMetaData
-				import copy
-				# if backup_to_sqlite:
-				tmp_dir = mkdtemp()
-				tmp_config = copy.deepcopy(self.config)
-				tmp_config._file = os.path.join(tmp_dir,'griffith.cfg')
-				tmp_config.get('type', 'sqlite', section='database') == 'sqlite'
-				tmp_config.set('file', section='database') == &quot;griffith.db&quot;
-				tmp_config.save()
+        if overwrite == True or overwrite is None:
+            try:
+                if zipfile.zlib is not None:
+                    mzip = zipfile.ZipFile(zipfilename, 'w', zipfile.ZIP_DEFLATED)
+                else:
+                    mzip = zipfile.ZipFile(zipfilename, 'w')
+            except:
+                gutils.error(self, _(&quot;Error creating backup&quot;), self.widgets['window'])
+                return False
+            mzip.write(os.path.join(self.locations['home'],'griffith.cfg').encode('utf-8'))
+            if self.db.metadata.engine.name == 'sqlite':
+                fileName = os.path.join(self.locations['home'], self.config.get('name','griffith', section='database') + '.db').encode('utf-8')
+                mzip.write(fileName)
+            else:
+                gutils.error(self, _(&quot;Backup function is available only for SQLite engine for now&quot;), self.widgets['window'])
+                return False
+                from tempfile import mkdtemp
+                from shutil import rmtree, move
+                from sqlalchemy import BoundMetaData
+                import copy
+                # if backup_to_sqlite:
+                tmp_dir = mkdtemp()
+                tmp_config = copy.deepcopy(self.config)
+                tmp_config._file = os.path.join(tmp_dir,'griffith.cfg')
+                tmp_config.get('type', 'sqlite', section='database') == 'sqlite'
+                tmp_config.set('file', section='database') == &quot;griffith.db&quot;
+                tmp_config.save()
 
-#				tmp_db = sql.GriffithSQL(tmp_config, self.debug, tmp_dir)
-#				for i in self.db.metadata.tables
-#				tmp_db.
+#                tmp_db = sql.GriffithSQL(tmp_config, self.debug, tmp_dir)
+#                for i in self.db.metadata.tables
+#                tmp_db.
 
-				tmp_file = os.path.join(tmp_dir, tmp_config.get('file', 'griffith.db', section='database')).encode('utf-8')
-				tmp_metadata = BoundMetaData(&quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % tmp_file)
-				tmp_metadata.tables = self.db.metadata.tables
-				tmp_metadata.create_all()
-#				for table in self.db.metadata.tables.keys():
-				for table in [t.name for t in self.db.metadata.table_iterator()]: # table_iterator() will return tables in *correct* order
-					data = self.db.metadata.tables[table].select().execute().fetchall()
-					tmp_metadata.tables[table].insert().execute(data)
-#					for item in data:
-#						tmp_metadata.tables[table].insert().execute(item)
-				tmp_metadata.engine.commit()
-				
-				mzip.write(tmp_file)
-				rmtree(tmp_dir)
-			posters_dir = os.path.join(self.locations['posters'])
-			for movie in self.db.Movie.query.all():
-				if movie.image is not None:
-					filename = str(movie.image)+&quot;.jpg&quot;
-					filename = os.path.join(posters_dir, filename).encode('utf-8')
-					if os.path.isfile(filename):
-						try:
-							mzip.write(filename)
-						except:
-							self.debug.show(&quot;Can't compress %s&quot; % filename)
-			mzip.close()
-			gutils.info(self, _(&quot;Backup has been created&quot;), self.widgets['window'])
+                tmp_file = os.path.join(tmp_dir, tmp_config.get('file', 'griffith.db', section='database')).encode('utf-8')
+                tmp_metadata = BoundMetaData(&quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % tmp_file)
+                tmp_metadata.tables = self.db.metadata.tables
+                tmp_metadata.create_all()
+#                for table in self.db.metadata.tables.keys():
+                for table in [t.name for t in self.db.metadata.table_iterator()]: # table_iterator() will return tables in *correct* order
+                    data = self.db.metadata.tables[table].select().execute().fetchall()
+                    tmp_metadata.tables[table].insert().execute(data)
+#                    for item in data:
+#                        tmp_metadata.tables[table].insert().execute(item)
+                tmp_metadata.engine.commit()
+                
+                mzip.write(tmp_file)
+                rmtree(tmp_dir)
+            posters_dir = os.path.join(self.locations['posters'])
+            for movie in self.db.Movie.query.all():
+                if movie.image is not None:
+                    filename = str(movie.image)+&quot;.jpg&quot;
+                    filename = os.path.join(posters_dir, filename).encode('utf-8')
+                    if os.path.isfile(filename):
+                        try:
+                            mzip.write(filename)
+                        except:
+                            self.debug.show(&quot;Can't compress %s&quot; % filename)
+            mzip.close()
+            gutils.info(self, _(&quot;Backup has been created&quot;), self.widgets['window'])
 
 def restore(self):
-	&quot;&quot;&quot;restores a griffith compressed backup&quot;&quot;&quot;
-	filename = gutils.file_chooser(_(&quot;Restore Griffith backup&quot;), \
-		action=gtk.FILE_CHOOSER_ACTION_OPEN, buttons= \
-		(gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, \
-		gtk.STOCK_OPEN, gtk.RESPONSE_OK))
-	if filename[0]:
-		try:
-			zip = zipfile.ZipFile(filename[0], 'r')
-		except:
-			gutils.error(self, _(&quot;Can't read backup file&quot;), self.widgets['window'])
-			return False
-		mypath = os.path.join(self.locations['posters'])
-		old_config_file = False
-		for each in zip.namelist():
-			file_to_restore = os.path.split(each)
-			if not os.path.isdir(file_to_restore[1]):
-				if file_to_restore[1] == '':
-					continue
-				if file_to_restore[1].endswith('.jpg'):
-					myfile = os.path.join(mypath,file_to_restore[1])
-				else:
-					myfile = os.path.join(self.locations['home'],file_to_restore[1])
-				if file_to_restore[1].endswith('.conf'):
-					old_config_file = myfile
-				outfile = open(myfile, 'wb')
-				outfile.write(zip.read(each))
-				outfile.flush()
-				outfile.close()
-		zip.close()
+    &quot;&quot;&quot;restores a griffith compressed backup&quot;&quot;&quot;
+    filename = gutils.file_chooser(_(&quot;Restore Griffith backup&quot;), \
+        action=gtk.FILE_CHOOSER_ACTION_OPEN, buttons= \
+        (gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, \
+        gtk.STOCK_OPEN, gtk.RESPONSE_OK))
+    if filename[0]:
+        try:
+            zip = zipfile.ZipFile(filename[0], 'r')
+        except:
+            gutils.error(self, _(&quot;Can't read backup file&quot;), self.widgets['window'])
+            return False
+        mypath = os.path.join(self.locations['posters'])
+        old_config_file = False
+        for each in zip.namelist():
+            file_to_restore = os.path.split(each)
+            if not os.path.isdir(file_to_restore[1]):
+                if file_to_restore[1] == '':
+                    continue
+                if file_to_restore[1].endswith('.jpg'):
+                    myfile = os.path.join(mypath,file_to_restore[1])
+                else:
+                    myfile = os.path.join(self.locations['home'],file_to_restore[1])
+                if file_to_restore[1].endswith('.conf'):
+                    old_config_file = myfile
+                outfile = open(myfile, 'wb')
+                outfile.write(zip.read(each))
+                outfile.flush()
+                outfile.close()
+        zip.close()
 
-		# restore config file
-		self.config = config.Config(file=os.path.join(self.locations['home'],'griffith.cfg'))
-		if old_config_file:
-			self.debug.show('Old config file detected. Please note that it will not be used.')
-			f = open(old_config_file, 'r')
-			old_config_raw_data = f.read()
-			f.close()
-			if old_config_raw_data.find('griffith.gri') &gt;= -1:
-				self.config.set('file', 'griffith.gri', section='database')
+        # restore config file
+        self.config = config.Config(file=os.path.join(self.locations['home'],'griffith.cfg'))
+        if old_config_file:
+            self.debug.show('Old config file detected. Please note that it will not be used.')
+            f = open(old_config_file, 'r')
+            old_config_raw_data = f.read()
+            f.close()
+            if old_config_raw_data.find('griffith.gri') &gt;= -1:
+                self.config.set('file', 'griffith.gri', section='database')
 
-		filename = os.path.join(self.locations['home'], self.config.get('name', 'griffith', section='database') + '.db')
+        filename = os.path.join(self.locations['home'], self.config.get('name', 'griffith', section='database') + '.db')
 
-		self.db.metadata.engine.dispose() # close DB
-		from sqlalchemy.orm import clear_mappers
-		clear_mappers()
+        self.db.metadata.engine.dispose() # close DB
+        from sqlalchemy.orm import clear_mappers
+        clear_mappers()
 
-		# check if file needs conversion
-		if self.config.get('file', 'griffith.db', section='database').lower().endswith('.gri'):
-			self.debug.show('Old database format detected. Converting...')
-			from dbupgrade import convert_from_old_db
-			from initialize	import location_posters
-			if convert_from_old_db(self, filename, os.path.join(self.locations['home'], 'griffith.db')):
-				self.config.save()
-				location_posters(self.locations, self.config)
-			else:
-				print 'Cant convert old database, exiting.'
-				import sys
-				sys.exit(4)
+        # check if file needs conversion
+        if self.config.get('file', 'griffith.db', section='database').lower().endswith('.gri'):
+            self.debug.show('Old database format detected. Converting...')
+            from dbupgrade import convert_from_old_db
+            from initialize    import location_posters
+            if convert_from_old_db(self, filename, os.path.join(self.locations['home'], 'griffith.db')):
+                self.config.save()
+                location_posters(self.locations, self.config)
+            else:
+                print 'Cant convert old database, exiting.'
+                import sys
+                sys.exit(4)
 
-		self.db = sql.GriffithSQL(self.config, self.debug, self.locations['home'])
-		from initialize	import dictionaries, people_treeview
-		dictionaries(self)
-		people_treeview(self)
-		# let's refresh the treeview
-		self.clear_details()
-		self.populate_treeview()
-		gutils.info(self, _(&quot;Backup restored&quot;), self.widgets['window'])
+        self.db = sql.GriffithSQL(self.config, self.debug, self.locations['home'])
+        from initialize    import dictionaries, people_treeview
+        dictionaries(self)
+        people_treeview(self)
+        # let's refresh the treeview
+        self.clear_details()
+        self.populate_treeview()
+        gutils.info(self, _(&quot;Backup restored&quot;), self.widgets['window'])
 
-def merge(self):	# FIXME
-	&quot;&quot;&quot;
-		Merge database from:
-		* compressed backup
-		* SQLite2 *.gri file
-		* SQLite3 *.db file
-	&quot;&quot;&quot;
-	filename = gutils.file_chooser(_(&quot;Restore Griffith backup&quot;), \
-		action=gtk.FILE_CHOOSER_ACTION_OPEN, buttons= \
-		(gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, \
-		gtk.STOCK_OPEN, gtk.RESPONSE_OK))[0]
-	if filename:
-		from tempfile import mkdtemp
-		from shutil import rmtree, move
+def merge(self):    # FIXME
+    &quot;&quot;&quot;
+        Merge database from:
+        * compressed backup
+        * SQLite2 *.gri file
+        * SQLite3 *.db file
+    &quot;&quot;&quot;
+    filename = gutils.file_chooser(_(&quot;Restore Griffith backup&quot;), \
+        action=gtk.FILE_CHOOSER_ACTION_OPEN, buttons= \
+        (gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, \
+        gtk.STOCK_OPEN, gtk.RESPONSE_OK))[0]
+    if filename:
+        from tempfile import mkdtemp
+        from shutil import rmtree, move
 
-		#tmp_config={}
-		#tmp_config.get('type', 'sqlite', section='database')
+        #tmp_config={}
+        #tmp_config.get('type', 'sqlite', section='database')
 
-		if filename.lower().endswith('.zip'):
-			tmp_dir = mkdtemp()
-			try:
-				zip = zipfile.ZipFile(filename, 'r')
-			except:
-				gutils.error(self, _(&quot;Can't read backup file&quot;), self.widgets['window'])
-				return False
-			for each in zip.namelist():
-				file_to_restore = os.path.split(each)
-				if not os.path.isdir(file_to_restore[1]):
-					myfile = os.path.join(tmp_dir, file_to_restore[1])
-					outfile = open(myfile, 'wb')
-					outfile.write(zip.read(each))
-					outfile.flush()
-					outfile.close()
-			# load stored database filename
-			tmp_config = config.Config(file=os.path.join(tmp_dir,'griffith.conf'))
-			filename = os.path.join(tmp_dir, tmp_config('name', 'griffith', section='database') + '.db')
-			zip.close()
+        if filename.lower().endswith('.zip'):
+            tmp_dir = mkdtemp()
+            try:
+                zip = zipfile.ZipFile(filename, 'r')
+            except:
+                gutils.error(self, _(&quot;Can't read backup file&quot;), self.widgets['window'])
+                return False
+            for each in zip.namelist():
+                file_to_restore = os.path.split(each)
+                if not os.path.isdir(file_to_restore[1]):
+                    myfile = os.path.join(tmp_dir, file_to_restore[1])
+                    outfile = open(myfile, 'wb')
+                    outfile.write(zip.read(each))
+                    outfile.flush()
+                    outfile.close()
+            # load stored database filename
+            tmp_config = config.Config(file=os.path.join(tmp_dir,'griffith.conf'))
+            filename = os.path.join(tmp_dir, tmp_config('name', 'griffith', section='database') + '.db')
+            zip.close()
 
-		# check if file needs conversion
-		if filename.lower().endswith(&quot;.gri&quot;):
-			if os.path.isfile(filename) and  open(filename).readline()[:47] == &quot;** This file contains an SQLite 2.1 database **&quot;:
-				self.debug.show(&quot;MERGE: SQLite2 database format detected. Converting...&quot;)
-				if not self.db.convert_from_sqlite2(filename, os.path.join(tmp_dir, self.config.get('file', 'griffith.db', section='database'))):
-					self.debug.show(&quot;MERGE: Can't convert database, aborting.&quot;)
-					return False
-		tmp_dir, tmp_file = os.path.split(filename)
-		self.config.get('file', tmp_file, section='database') 
+        # check if file needs conversion
+        if filename.lower().endswith(&quot;.gri&quot;):
+            if os.path.isfile(filename) and  open(filename).readline()[:47] == &quot;** This file contains an SQLite 2.1 database **&quot;:
+                self.debug.show(&quot;MERGE: SQLite2 database format detected. Converting...&quot;)
+                if not self.db.convert_from_sqlite2(filename, os.path.join(tmp_dir, self.config.get('file', 'griffith.db', section='database'))):
+                    self.debug.show(&quot;MERGE: Can't convert database, aborting.&quot;)
+                    return False
+        tmp_dir, tmp_file = os.path.split(filename)
+        self.config.get('file', tmp_file, section='database') 
 
-		tmp_db = sql.GriffithSQL(tmp_config, self.debug, tmp_dir)
+        tmp_db = sql.GriffithSQL(tmp_config, self.debug, tmp_dir)
 
-		merged=0
-		movies = tmp_db.Movie.count()
-		for movie in tmp_db.Movie.query.all():
-			if self.db.Movie.query.filter_by(o_title=movie.o_title).first() is not None:
-				continue
-			t_movies = {}
-			for column in movie.mapper.c.keys():
-				t_movies[column] = eval(&quot;movie.%s&quot;%column)
+        merged=0
+        movies = tmp_db.Movie.count()
+        for movie in tmp_db.Movie.query.all():
+            if self.db.Movie.query.filter_by(o_title=movie.o_title).first() is not None:
+                continue
+            t_movies = {}
+            for column in movie.mapper.c.keys():
+                t_movies[column] = eval(&quot;movie.%s&quot;%column)
 
-			# replace number with new one
-			t_movies[&quot;number&quot;] = gutils.find_next_available(self.db)
+            # replace number with new one
+            t_movies[&quot;number&quot;] = gutils.find_next_available(self.db)
 
-			# don't restore volume/collection/tag/language/loan data (it's dangerous)
-			t_movies.pop('movie_id')
-			t_movies.pop('loaned')
-			t_movies.pop('volume_id')
-			t_movies.pop('collection_id')
+            # don't restore volume/collection/tag/language/loan data (it's dangerous)
+            t_movies.pop('movie_id')
+            t_movies.pop('loaned')
+            t_movies.pop('volume_id')
+            t_movies.pop('collection_id')
 
-			if self.db.add_movie(t_movies):
-				print t_movies
+            if self.db.add_movie(t_movies):
+                print t_movies
 
-			if movie.image is not None:
-				dest_file = os.path.join(self.locations['posters'], movie.image+'.jpg')
-				if not os.path.isfile(dest_file):
-					src_file = os.path.join(tmp_dir, movie.image+'.jpg')
-					if os.path.isfile(src_file):
-						move(src_file, dest_file)
-			merged+=1
-		rmtree(tmp_dir)
+            if movie.image is not None:
+                dest_file = os.path.join(self.locations['posters'], movie.image+'.jpg')
+                if not os.path.isfile(dest_file):
+                    src_file = os.path.join(tmp_dir, movie.image+'.jpg')
+                    if os.path.isfile(src_file):
+                        move(src_file, dest_file)
+            merged+=1
+        rmtree(tmp_dir)
 
-		from initialize	import dictionaries, people_treeview
-		dictionaries(self)
-		people_treeview(self)
-		# let's refresh the treeview
-		self.clear_details()
-		self.populate_treeview(self.db.Movie.query.all())
-		#gutils.info(self, _(&quot;Databases merged!\n\nProcessed movies: %s\nMerged movies: %s&quot;%(movies, merged)), self.widgets['window'])
+        from initialize    import dictionaries, people_treeview
+        dictionaries(self)
+        people_treeview(self)
+        # let's refresh the treeview
+        self.clear_details()
+        self.populate_treeview(self.db.Movie.query.all())
+        #gutils.info(self, _(&quot;Databases merged!\n\nProcessed movies: %s\nMerged movies: %s&quot;%(movies, merged)), self.widgets['window'])
 

Modified: trunk/lib/config.py
===================================================================
--- trunk/lib/config.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/config.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -27,176 +27,176 @@
 #import cPickle as pickle
 
 class Config:
-	subst = {'True': True, 'False': False, 'None': None}
-	def __init__ (self, file):
-		self._file = file
-		if not self.load():
-			self.make_defaults()
+    subst = {'True': True, 'False': False, 'None': None}
+    def __init__ (self, file):
+        self._file = file
+        if not self.load():
+            self.make_defaults()
 
-		#self.set_hooks = []
+        #self.set_hooks = []
 
-	def get(self, option, default=None, section='main'):
-		if not isinstance(option, str):
-			option = str(option)
-		if not self._cfg.has_option(section, option):
-			return default
-		else:
-			value = self._cfg.get(section, option, False)
-			if value in self.subst.keys():
-				value = self.subst[value]
-			return value
+    def get(self, option, default=None, section='main'):
+        if not isinstance(option, str):
+            option = str(option)
+        if not self._cfg.has_option(section, option):
+            return default
+        else:
+            value = self._cfg.get(section, option, False)
+            if value in self.subst.keys():
+                value = self.subst[value]
+            return value
 
-	def set(self, option, value, section='main'):
-		if not isinstance(option, str):
-			option = str(option)
-		if not isinstance(value, str):
-			value = str(value)
-		if not self._cfg.has_section(section):
-			self._cfg.add_section(section)
-		self._cfg.set(section, option, value)
+    def set(self, option, value, section='main'):
+        if not isinstance(option, str):
+            option = str(option)
+        if not isinstance(value, str):
+            value = str(value)
+        if not self._cfg.has_section(section):
+            self._cfg.add_section(section)
+        self._cfg.set(section, option, value)
 
-	def has_key(self, key, section='main'):
-		return self._cfg.has_option(section,key)
+    def has_key(self, key, section='main'):
+        return self._cfg.has_option(section,key)
 
-	def __setitem__(self, k, v):
-		self.set(k,v, section='main')
+    def __setitem__(self, k, v):
+        self.set(k,v, section='main')
 
-	def __getitem__(self, key):
-		return self.get('main', key)
+    def __getitem__(self, key):
+        return self.get('main', key)
 
-	def keys(self, section='main'):
-		return [ i[0] for i in self._cfg.items(section) ]
-	def values(self, section='main'):
-		return [ i[1] for i in self._cfg.items(section) ]
-	def items(self, section='main'):
-		return self._cfg.items(section)
-	def toDict(self, section='main'):
-		d = {}
-		for i,j in self._cfg.items(section):
-			d[i] = j
-		return d
+    def keys(self, section='main'):
+        return [ i[0] for i in self._cfg.items(section) ]
+    def values(self, section='main'):
+        return [ i[1] for i in self._cfg.items(section) ]
+    def items(self, section='main'):
+        return self._cfg.items(section)
+    def toDict(self, section='main'):
+        d = {}
+        for i,j in self._cfg.items(section):
+            d[i] = j
+        return d
 
-	def save(self):
-		if not os.path.exists(os.path.split(self._file)[0]):
-			os.makedirs(os.path.split(self._file)[0])
-		self._cfg.write(open(self._file, 'w'))
+    def save(self):
+        if not os.path.exists(os.path.split(self._file)[0]):
+            os.makedirs(os.path.split(self._file)[0])
+        self._cfg.write(open(self._file, 'w'))
 
-	def load(self):
-		if os.path.isfile(self._file):
-			self._cfg = ConfigParser.SafeConfigParser()
-			try:
-				self._cfg.read(self._file)
-			except:
-				print 'Cannot parse config file'
-				return False
-			# check values for number datatypes
-			# if current value could not be converted to number datatype
-			# the default is set instead
-			# some older config files need that correction but also in
-			# newer files is it possible, that the user inserts non-convertable
-			# values for number fields. The special problem is the string None.
-			tmp_value = self.get('color', 0, 'defaults')
-			try:
-				int(tmp_value)
-			except:
-				self.set('color', 0, 'defaults')
-			tmp_value = self.get('condition', 0, 'defaults')
-			try:
-				int(tmp_value)
-			except:
-				self.set('condition', 0, 'defaults')
-			tmp_value = self.get('layers', 0, 'defaults')
-			try:
-				int(tmp_value)
-			except:
-				self.set('layers', 0, 'defaults')
-			tmp_value = self.get('media', 0, 'defaults')
-			try:
-				int(tmp_value)
-			except:
-				self.set('media', 0, 'defaults')
-			tmp_value = self.get('region', 0, 'defaults')
-			try:
-				int(tmp_value)
-			except:
-				self.set('region', 0, 'defaults')
-			tmp_value = self.get('vcodec', 0, 'defaults')
-			try:
-				int(tmp_value)
-			except:
-				self.set('vcodec', 0, 'defaults')
-			return True
-		else:
-			return False
-			
-	def make_defaults(self):
-		self._cfg = ConfigParser.SafeConfigParser()
-		self._cfg.read(self._file)
-		self._cfg.add_section('database')
-		self._cfg.add_section('defaults')
-		self._cfg.add_section('window')
-		self._cfg.add_section('mainlist')
-		self._cfg.add_section('mail')
-		self._cfg.add_section('spell')
-		self._cfg.add_section('add')
-		self._cfg.add_section('main')
-		self._cfg.set('add', 's_cast', 'True')
-		self._cfg.set('add', 's_classification', 'True')
-		self._cfg.set('add', 's_country', 'True')
-		self._cfg.set('add', 's_director', 'True')
-		self._cfg.set('add', 's_genre', 'True')
-		self._cfg.set('add', 's_image', 'True')
-		self._cfg.set('add', 's_notes', 'True')
-		self._cfg.set('add', 's_o_site', 'True')
-		self._cfg.set('add', 's_o_title', 'True')
-		self._cfg.set('add', 's_plot', 'True')
-		self._cfg.set('add', 's_rating', 'True')
-		self._cfg.set('add', 's_runtime', 'True')
-		self._cfg.set('add', 's_site', 'True')
-		self._cfg.set('add', 's_studio', 'True')
-		self._cfg.set('add', 's_title', 'True')
-		self._cfg.set('add', 's_trailer', 'True')
-		self._cfg.set('add', 's_year', 'True')
-		self._cfg.set('database', 'file', 'griffith.db')
-		self._cfg.set('database', 'host', 'localhost')
-		self._cfg.set('database', 'name', 'griffith')
-		self._cfg.set('database', 'passwd', 'gRiFiTh')
-		self._cfg.set('database', 'port', '5432')
-		self._cfg.set('database', 'type', 'sqlite')
-		self._cfg.set('database', 'user', 'griffith')
-		self._cfg.set('defaults', 'color', '0')
-		self._cfg.set('defaults', 'condition', '0')
-		self._cfg.set('defaults', 'layers', '0')
-		self._cfg.set('defaults', 'media', '0')
-		self._cfg.set('defaults', 'region', '0')
-		self._cfg.set('defaults', 'vcodec', '0')
-		self._cfg.set('mail', 'email', 'griffith')
-		self._cfg.set('mail', 'password', '')
-		self._cfg.set('mail', 'smtp_server', 'localhost')
-		self._cfg.set('mail', 'use_auth', 'False')
-		self._cfg.set('mail', 'username', '')
-		self._cfg.set('mail', 'mail_smtp_port', '25')
-		self._cfg.set('mail', 'mail_use_tls', 'False')
-		self._cfg.set('main', 'default_movie_plugin', 'IMDB')
-		self._cfg.set('main', 'font', '')
-		self._cfg.set('main', 'pdf_reader', 'xpdf')
-		self._cfg.set('main', 'posters', 'posters')
-		self._cfg.set('main', 'rating_image', '0')	# 0 = meter; 1 = stars
-		self._cfg.set('mainlist', 'director', 'True')
-		self._cfg.set('mainlist', 'image', 'True')
-		self._cfg.set('mainlist', 'limit', '0')		# limit search results to x items (0 -&gt; no limits)
-		self._cfg.set('mainlist', 'number', 'True')
-		self._cfg.set('mainlist', 'otitle', 'True')
-		self._cfg.set('mainlist', 'sortby', 'number')
-		self._cfg.set('mainlist', 'sortby_reverse', 'False')
-		self._cfg.set('mainlist', 'title', 'True')
-		self._cfg.set('spell', 'gtkspell', 'True')
-		self._cfg.set('spell', 'lang', 'en')
-		self._cfg.set('spell', 'notes', 'True')
-		self._cfg.set('spell', 'plot', 'True')
-		self._cfg.set('window', 'height', '700')
-		self._cfg.set('window', 'left', 'None')
-		self._cfg.set('window', 'top', 'None')
-		self._cfg.set('window', 'view_toolbar', 'True')
-		self._cfg.set('window', 'width', '500')
-		self.save()
+    def load(self):
+        if os.path.isfile(self._file):
+            self._cfg = ConfigParser.SafeConfigParser()
+            try:
+                self._cfg.read(self._file)
+            except:
+                print 'Cannot parse config file'
+                return False
+            # check values for number datatypes
+            # if current value could not be converted to number datatype
+            # the default is set instead
+            # some older config files need that correction but also in
+            # newer files is it possible, that the user inserts non-convertable
+            # values for number fields. The special problem is the string None.
+            tmp_value = self.get('color', 0, 'defaults')
+            try:
+                int(tmp_value)
+            except:
+                self.set('color', 0, 'defaults')
+            tmp_value = self.get('condition', 0, 'defaults')
+            try:
+                int(tmp_value)
+            except:
+                self.set('condition', 0, 'defaults')
+            tmp_value = self.get('layers', 0, 'defaults')
+            try:
+                int(tmp_value)
+            except:
+                self.set('layers', 0, 'defaults')
+            tmp_value = self.get('media', 0, 'defaults')
+            try:
+                int(tmp_value)
+            except:
+                self.set('media', 0, 'defaults')
+            tmp_value = self.get('region', 0, 'defaults')
+            try:
+                int(tmp_value)
+            except:
+                self.set('region', 0, 'defaults')
+            tmp_value = self.get('vcodec', 0, 'defaults')
+            try:
+                int(tmp_value)
+            except:
+                self.set('vcodec', 0, 'defaults')
+            return True
+        else:
+            return False
+            
+    def make_defaults(self):
+        self._cfg = ConfigParser.SafeConfigParser()
+        self._cfg.read(self._file)
+        self._cfg.add_section('database')
+        self._cfg.add_section('defaults')
+        self._cfg.add_section('window')
+        self._cfg.add_section('mainlist')
+        self._cfg.add_section('mail')
+        self._cfg.add_section('spell')
+        self._cfg.add_section('add')
+        self._cfg.add_section('main')
+        self._cfg.set('add', 's_cast', 'True')
+        self._cfg.set('add', 's_classification', 'True')
+        self._cfg.set('add', 's_country', 'True')
+        self._cfg.set('add', 's_director', 'True')
+        self._cfg.set('add', 's_genre', 'True')
+        self._cfg.set('add', 's_image', 'True')
+        self._cfg.set('add', 's_notes', 'True')
+        self._cfg.set('add', 's_o_site', 'True')
+        self._cfg.set('add', 's_o_title', 'True')
+        self._cfg.set('add', 's_plot', 'True')
+        self._cfg.set('add', 's_rating', 'True')
+        self._cfg.set('add', 's_runtime', 'True')
+        self._cfg.set('add', 's_site', 'True')
+        self._cfg.set('add', 's_studio', 'True')
+        self._cfg.set('add', 's_title', 'True')
+        self._cfg.set('add', 's_trailer', 'True')
+        self._cfg.set('add', 's_year', 'True')
+        self._cfg.set('database', 'file', 'griffith.db')
+        self._cfg.set('database', 'host', 'localhost')
+        self._cfg.set('database', 'name', 'griffith')
+        self._cfg.set('database', 'passwd', 'gRiFiTh')
+        self._cfg.set('database', 'port', '5432')
+        self._cfg.set('database', 'type', 'sqlite')
+        self._cfg.set('database', 'user', 'griffith')
+        self._cfg.set('defaults', 'color', '0')
+        self._cfg.set('defaults', 'condition', '0')
+        self._cfg.set('defaults', 'layers', '0')
+        self._cfg.set('defaults', 'media', '0')
+        self._cfg.set('defaults', 'region', '0')
+        self._cfg.set('defaults', 'vcodec', '0')
+        self._cfg.set('mail', 'email', 'griffith')
+        self._cfg.set('mail', 'password', '')
+        self._cfg.set('mail', 'smtp_server', 'localhost')
+        self._cfg.set('mail', 'use_auth', 'False')
+        self._cfg.set('mail', 'username', '')
+        self._cfg.set('mail', 'mail_smtp_port', '25')
+        self._cfg.set('mail', 'mail_use_tls', 'False')
+        self._cfg.set('main', 'default_movie_plugin', 'IMDB')
+        self._cfg.set('main', 'font', '')
+        self._cfg.set('main', 'pdf_reader', 'xpdf')
+        self._cfg.set('main', 'posters', 'posters')
+        self._cfg.set('main', 'rating_image', '0')    # 0 = meter; 1 = stars
+        self._cfg.set('mainlist', 'director', 'True')
+        self._cfg.set('mainlist', 'image', 'True')
+        self._cfg.set('mainlist', 'limit', '0')        # limit search results to x items (0 -&gt; no limits)
+        self._cfg.set('mainlist', 'number', 'True')
+        self._cfg.set('mainlist', 'otitle', 'True')
+        self._cfg.set('mainlist', 'sortby', 'number')
+        self._cfg.set('mainlist', 'sortby_reverse', 'False')
+        self._cfg.set('mainlist', 'title', 'True')
+        self._cfg.set('spell', 'gtkspell', 'True')
+        self._cfg.set('spell', 'lang', 'en')
+        self._cfg.set('spell', 'notes', 'True')
+        self._cfg.set('spell', 'plot', 'True')
+        self._cfg.set('window', 'height', '700')
+        self._cfg.set('window', 'left', 'None')
+        self._cfg.set('window', 'top', 'None')
+        self._cfg.set('window', 'view_toolbar', 'True')
+        self._cfg.set('window', 'width', '500')
+        self.save()

Modified: trunk/lib/cover.py
===================================================================
--- trunk/lib/cover.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/cover.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -39,160 +39,160 @@
 exec_location = os.path.abspath(os.path.dirname(sys.argv[0]))
 
 def cover_image(self,number):
-	filename = gutils.file_chooser(_(&quot;Select image&quot;), \
-		action=gtk.FILE_CHOOSER_ACTION_OPEN, \
-		buttons=(gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, \
-			gtk.STOCK_OPEN, gtk.RESPONSE_OK))
-	if filename[0]:
-		cover_image_process(self, filename[0], number)
+    filename = gutils.file_chooser(_(&quot;Select image&quot;), \
+        action=gtk.FILE_CHOOSER_ACTION_OPEN, \
+        buttons=(gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, \
+            gtk.STOCK_OPEN, gtk.RESPONSE_OK))
+    if filename[0]:
+        cover_image_process(self, filename[0], number)
 
 def cover_image_process(self, filename, number):
-	size = self.widgets['print_cover']['ci_size'].get_active()
-	print_number = self.widgets['print_cover']['ci_number'].get_active()
+    size = self.widgets['print_cover']['ci_size'].get_active()
+    print_number = self.widgets['print_cover']['ci_number'].get_active()
 
-	if self.config.get('font', '')!='':
-		fontName = &quot;custom_font&quot;
-		pdfmetrics.registerFont(TTFont(fontName,self.config.get('font', '')))
-	else:
-		fontName = &quot;Helvetica&quot;
+    if self.config.get('font', '')!='':
+        fontName = &quot;custom_font&quot;
+        pdfmetrics.registerFont(TTFont(fontName,self.config.get('font', '')))
+    else:
+        fontName = &quot;Helvetica&quot;
 
-	if size == 0:
-		#standard
-		cover_x=774
-		cover_y=518
-	elif size == 1:
-		#slim
-		cover_x=757;
-		cover_y=518
-	else:
-		#double slim
-		cover_x=757
-		cover_y=518
+    if size == 0:
+        #standard
+        cover_x=774
+        cover_y=518
+    elif size == 1:
+        #slim
+        cover_x=757;
+        cover_y=518
+    else:
+        #double slim
+        cover_x=757
+        cover_y=518
 
-	# A4 landscape definition
-	pageWidth = 842
-	pageHeight = 595
+    # A4 landscape definition
+    pageWidth = 842
+    pageHeight = 595
 
-	# hardcoded to A4
-	pos_x=(pageWidth-cover_x)/2;
-	pos_y=(pageHeight-cover_y)/2;
+    # hardcoded to A4
+    pos_x=(pageWidth-cover_x)/2;
+    pos_y=(pageHeight-cover_y)/2;
 
-	# make a pdf
-	# using a truetype font with unicode support
-	c = canvas.Canvas(os.path.join(self.griffith_dir, &quot;cover.pdf&quot;), \
-		(pageWidth, pageHeight))
-	c.setFont(fontName, 8)
-	# copyright line
-	c.drawString(20, 20 ,_(&quot;Cover generated by Griffith v&quot;).encode('utf-8') + \
-		version.pversion+&quot; (C) 2004-2007 Vasco Nunes/Piotr Ozarowski - &quot;+ \
-		_(&quot;Released Under the GNU/GPL License&quot;).encode('utf-8'))
+    # make a pdf
+    # using a truetype font with unicode support
+    c = canvas.Canvas(os.path.join(self.griffith_dir, &quot;cover.pdf&quot;), \
+        (pageWidth, pageHeight))
+    c.setFont(fontName, 8)
+    # copyright line
+    c.drawString(20, 20 ,_(&quot;Cover generated by Griffith v&quot;).encode('utf-8') + \
+        version.pversion+&quot; (C) 2004-2007 Vasco Nunes/Piotr Ozarowski - &quot;+ \
+        _(&quot;Released Under the GNU/GPL License&quot;).encode('utf-8'))
 
-	# get movie information from db
-	movie = self.db.Movie.query.filter_by(number=number).first()
-	if movie is not None:
-		c.drawImage(filename, pos_x, pos_y, cover_x, cover_y)
-		if print_number == True:
-			c.setFillColor(colors.white)
-			c.rect((pageWidth/2)-13, 520, 26, 70, fill=1, stroke=0)
-			c.setFillColor(colors.black)
-			c.setFont(fontName, 10)
-			c.drawCentredString(pageWidth/2, 530, number)
+    # get movie information from db
+    movie = self.db.Movie.query.filter_by(number=number).first()
+    if movie is not None:
+        c.drawImage(filename, pos_x, pos_y, cover_x, cover_y)
+        if print_number == True:
+            c.setFillColor(colors.white)
+            c.rect((pageWidth/2)-13, 520, 26, 70, fill=1, stroke=0)
+            c.setFillColor(colors.black)
+            c.setFont(fontName, 10)
+            c.drawCentredString(pageWidth/2, 530, number)
 
-	# draw cover area
-	c.rect(pos_x, pos_y, cover_x, cover_y)
+    # draw cover area
+    c.rect(pos_x, pos_y, cover_x, cover_y)
 
-	c.showPage()
-	c.save()
-	self.widgets['print_cover']['window_simple'].hide()
-	cover_file = os.path.join(self.griffith_dir, &quot;cover.pdf&quot;)
-	if self.windows:
-		os.popen3(&quot;\&quot;&quot; + cover_file + &quot;\&quot;&quot;)
-	else:
-		os.popen3(self.pdf_reader + &quot; &quot; + cover_file)
+    c.showPage()
+    c.save()
+    self.widgets['print_cover']['window_simple'].hide()
+    cover_file = os.path.join(self.griffith_dir, &quot;cover.pdf&quot;)
+    if self.windows:
+        os.popen3(&quot;\&quot;&quot; + cover_file + &quot;\&quot;&quot;)
+    else:
+        os.popen3(self.pdf_reader + &quot; &quot; + cover_file)
 
 def cover_simple(self, number):
-	size = self.widgets['print_cover']['cs_size'].get_active()
-	print_number = self.widgets['print_cover']['cs_include_movie_number'].get_active()
-	poster = self.widgets['print_cover']['cs_include_poster'].get_active()
+    size = self.widgets['print_cover']['cs_size'].get_active()
+    print_number = self.widgets['print_cover']['cs_include_movie_number'].get_active()
+    poster = self.widgets['print_cover']['cs_include_poster'].get_active()
 
-	if self.config.get('font', '')!='':
-		fontName = &quot;custom_font&quot;
-		pdfmetrics.registerFont(TTFont(fontName,self.config.get('font', '')))
-	else:
-		fontName = &quot;Helvetica&quot;
+    if self.config.get('font', '')!='':
+        fontName = &quot;custom_font&quot;
+        pdfmetrics.registerFont(TTFont(fontName,self.config.get('font', '')))
+    else:
+        fontName = &quot;Helvetica&quot;
 
-	if size == 0:
-		#standard
-		cover_x=774
-		cover_y=518
-	elif size == 1:
-		#slim
-		cover_x=757;
-		cover_y=518
-	else:
-		#double slim
-		cover_x=757
-		cover_y=518
+    if size == 0:
+        #standard
+        cover_x=774
+        cover_y=518
+    elif size == 1:
+        #slim
+        cover_x=757;
+        cover_y=518
+    else:
+        #double slim
+        cover_x=757
+        cover_y=518
 
-	# A4 landscape definition
-	pageWidth = 842
-	pageHeight = 595
+    # A4 landscape definition
+    pageWidth = 842
+    pageHeight = 595
 
-	# hardcoded to A4
-	pos_x=(pageWidth-cover_x)/2;
-	pos_y=(pageHeight-cover_y)/2;
-	# make a pdf
-	c = canvas.Canvas(os.path.join(self.griffith_dir, &quot;cover.pdf&quot;), (pageWidth, pageHeight))
-	c.setFont(fontName,8)
+    # hardcoded to A4
+    pos_x=(pageWidth-cover_x)/2;
+    pos_y=(pageHeight-cover_y)/2;
+    # make a pdf
+    c = canvas.Canvas(os.path.join(self.griffith_dir, &quot;cover.pdf&quot;), (pageWidth, pageHeight))
+    c.setFont(fontName,8)
 
-	# copyright line
-	c.drawString(20,20,_(&quot;Cover generated by Griffith v&quot;).encode('utf-8') + \
-		version.pversion+&quot; (C) 2004-2007 Vasco Nunes/Piotr Ozarowski - &quot;+ \
-		_(&quot;Released Under the GNU/GPL License&quot;).encode('utf-8'))
+    # copyright line
+    c.drawString(20,20,_(&quot;Cover generated by Griffith v&quot;).encode('utf-8') + \
+        version.pversion+&quot; (C) 2004-2007 Vasco Nunes/Piotr Ozarowski - &quot;+ \
+        _(&quot;Released Under the GNU/GPL License&quot;).encode('utf-8'))
 
-	# draw cover area
-	c.rect(pos_x, pos_y, cover_x, cover_y)
+    # draw cover area
+    c.rect(pos_x, pos_y, cover_x, cover_y)
 
-	# get movie information from db
-	movie = self.db.Movie.query.filter_by(number=number).first()
-	if movie is not None:
-		if print_number == True:
-			c.setFont(fontName, 10)
-			c.drawCentredString(pageWidth/2, 530, number)
+    # get movie information from db
+    movie = self.db.Movie.query.filter_by(number=number).first()
+    if movie is not None:
+        if print_number == True:
+            c.setFont(fontName, 10)
+            c.drawCentredString(pageWidth/2, 530, number)
 
-		c.setFont(fontName, 16)
-		c.rotate(90)
-		c.drawString(60, (-pageWidth/2)-8, movie.o_title.encode('utf-8'))
-		c.rotate(-90)
-		if movie.image is not None and movie.image != '':
-			tmp_dest = self.locations['posters']
-			image = str(os.path.join(tmp_dest, str(movie.image)+&quot;.jpg&quot;))
-			c.drawImage(image, x=(pageWidth-30)/2, y=470, width=30, height=50)
-		# print movie info
-		c.setFont(fontName, 8)
-		textObject = c.beginText()
-		textObject.setTextOrigin(pageWidth-cover_x, 300)
-		textObject.setFont(fontName, 8)
-		textObject.textLine(_(&quot;Original Title&quot;).encode('utf-8')+': '+str(movie.o_title).encode('utf-8'))
-		textObject.textLine(_(&quot;Title&quot;).encode('utf-8')+': '+str(movie.title).encode('utf-8'))
-		textObject.textLine(&quot;&quot;)
-		textObject.textLine(_(&quot;Director&quot;).encode('utf-8')+': '+str(movie.director).encode('utf-8'))
-		textObject.textLine(&quot;&quot;)
-		textObject.textLine(_(&quot;Running Time&quot;).encode('utf-8')+': '+str(movie.runtime).encode('utf-8')+ _(&quot; min&quot;).encode('utf-8'))
-		textObject.textLine(_(&quot;Country&quot;).encode('utf-8')+': '+str(movie.country).encode('utf-8'))
-		textObject.textLine(_(&quot;Genre&quot;).encode('utf-8')+': '+str(movie.genre).encode('utf-8'))
-		textObject.textLine(&quot;&quot;)
-		c.drawText(textObject)
-		# draw bigger poster image
-		if poster == True and movie.image is not None:
-			c.drawImage(image, x=(pageWidth-(pageWidth-cover_x)-235), y=(pageHeight/2)-125, width=180, height=250)
-	c.showPage()
-	c.save()
-	self.widgets['print_cover']['window_simple'].hide()
-	cover_file = os.path.join(self.griffith_dir, &quot;cover.pdf&quot;)
-	if self.windows:
-		os.popen3(&quot;\&quot;&quot; + cover_file + &quot;\&quot;&quot;)
-	elif self.mac:
-		os.popen3(&quot;open -a Preview&quot; + &quot; &quot; + cover_file)
-	else:
-		os.popen3(self.pdf_reader + &quot; &quot; + cover_file)
+        c.setFont(fontName, 16)
+        c.rotate(90)
+        c.drawString(60, (-pageWidth/2)-8, movie.o_title.encode('utf-8'))
+        c.rotate(-90)
+        if movie.image is not None and movie.image != '':
+            tmp_dest = self.locations['posters']
+            image = str(os.path.join(tmp_dest, str(movie.image)+&quot;.jpg&quot;))
+            c.drawImage(image, x=(pageWidth-30)/2, y=470, width=30, height=50)
+        # print movie info
+        c.setFont(fontName, 8)
+        textObject = c.beginText()
+        textObject.setTextOrigin(pageWidth-cover_x, 300)
+        textObject.setFont(fontName, 8)
+        textObject.textLine(_(&quot;Original Title&quot;).encode('utf-8')+': '+str(movie.o_title).encode('utf-8'))
+        textObject.textLine(_(&quot;Title&quot;).encode('utf-8')+': '+str(movie.title).encode('utf-8'))
+        textObject.textLine(&quot;&quot;)
+        textObject.textLine(_(&quot;Director&quot;).encode('utf-8')+': '+str(movie.director).encode('utf-8'))
+        textObject.textLine(&quot;&quot;)
+        textObject.textLine(_(&quot;Running Time&quot;).encode('utf-8')+': '+str(movie.runtime).encode('utf-8')+ _(&quot; min&quot;).encode('utf-8'))
+        textObject.textLine(_(&quot;Country&quot;).encode('utf-8')+': '+str(movie.country).encode('utf-8'))
+        textObject.textLine(_(&quot;Genre&quot;).encode('utf-8')+': '+str(movie.genre).encode('utf-8'))
+        textObject.textLine(&quot;&quot;)
+        c.drawText(textObject)
+        # draw bigger poster image
+        if poster == True and movie.image is not None:
+            c.drawImage(image, x=(pageWidth-(pageWidth-cover_x)-235), y=(pageHeight/2)-125, width=180, height=250)
+    c.showPage()
+    c.save()
+    self.widgets['print_cover']['window_simple'].hide()
+    cover_file = os.path.join(self.griffith_dir, &quot;cover.pdf&quot;)
+    if self.windows:
+        os.popen3(&quot;\&quot;&quot; + cover_file + &quot;\&quot;&quot;)
+    elif self.mac:
+        os.popen3(&quot;open -a Preview&quot; + &quot; &quot; + cover_file)
+    else:
+        os.popen3(self.pdf_reader + &quot; &quot; + cover_file)

Added: trunk/lib/db.py
===================================================================
--- trunk/lib/db.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/db.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -0,0 +1,267 @@
+# -*- coding: UTF-8 -*-
+# vim: fdm=marker
+
+__revision__ = '$Id: $'
+
+# Copyright (c) 2008 Vasco Nunes, Piotr O&#197;&#188;arowski
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
+
+# You may use and distribute this software under the terms of the
+# GNU General Public License, version 2 or later
+
+# imports
+from sqlalchemy     import *
+from sqlalchemy.orm import mapper, relation, sessionmaker
+
+metadata = MetaData()
+
+### clases #################################################### {{{
+class Configuration(object):
+    def __repr__(self):
+        return &quot;&lt;Config:%s=%s&gt;&quot; % (self.param, self.value)
+class AChannel(object):
+    pass
+class ACodec(object):
+    pass
+class Collection(object):
+    pass
+class Lang(object):
+    pass
+class Medium(object):
+    pass
+class Person(object):
+    pass
+class SubFormat(object):
+    pass
+class Tag(object):
+    pass
+class VCodec(object):
+    pass
+class Volume(object):
+    pass
+class Loan(object):
+    def __repr__(self):
+        return &quot;&lt;Loan:%s (movie:%s person:%s)&gt;&quot; % (self.loan_id, self.movie_id, self.person_id)
+class Movie(object):
+    def __repr__(self):
+        return &quot;&lt;Movie:%s (number=%s)&gt;&quot; % (self.movie_id, self.number)
+    def __contains__(self, name):
+        if name in ('volume','collection','medium','vcodec','loans','tags','languages','lectors','dubbings','subtitles'): return True
+        else: return name in movies_table.columns
+    def __getitem__(self, name):
+        if name in self:
+            return getattr(self, name)
+        else: raise AttributeError, name
+
+class MovieLang(object):
+    def __repr__(self):
+        return &quot;&lt;MovieLang:%s-%s (Type:%s ACodec:%s AChannel:%s SubFormat:%s)&gt;&quot; % \
+            (self.movie_id, self.lang_id, self.type, self.acodec_id, self.achannel_id, self.subformat_id)
+class MovieTag(object):
+    def __repr__(self):
+        return &quot;&lt;MovieTag:%s-%s&gt;&quot; % (self.movie_id, self.tag_id)
+#}}}
+
+### table definitions ######################################### {{{
+movies_table = Table('movies', metadata,
+    Column('movie_id', Integer, primary_key = True),
+    Column('number', Integer, nullable=False, unique=True),
+    Column('collection_id', Integer, ForeignKey('collections.collection_id')),
+    Column('volume_id', Integer, ForeignKey('volumes.volume_id')),
+    Column('medium_id', Integer, ForeignKey('media.medium_id')),
+    Column('vcodec_id', Integer, ForeignKey('vcodecs.vcodec_id')),
+    Column('loaned', Boolean, nullable=False, default=False),
+    Column('seen', Boolean, nullable=False, default=False),
+    Column('rating', SmallInteger(2)),
+    Column('color', SmallInteger),
+    Column('cond', SmallInteger),    # MySQL will not accept name &quot;condition&quot;
+    Column('layers', SmallInteger),
+    Column('region', SmallInteger),
+    Column('media_num', SmallInteger),
+    Column('runtime', Integer),
+    Column('year', Integer),
+    Column('o_title', VARCHAR(255)),
+    Column('title', VARCHAR(255)),
+    Column('director', VARCHAR(255)),
+    Column('o_site', VARCHAR(255)),
+    Column('site', VARCHAR(255)),
+    Column('trailer', VARCHAR(256)),
+    Column('country', VARCHAR(128)),
+    Column('genre', VARCHAR(128)),
+    Column('image', VARCHAR(128)),
+    Column('studio', VARCHAR(128)),
+    Column('classification', VARCHAR(128)),
+    Column('cast', TEXT),
+    Column('plot', TEXT),
+    Column('notes', TEXT))
+
+loans_table = Table('loans', metadata,
+    Column('loan_id', Integer, primary_key=True),
+    Column('person_id', Integer, ForeignKey('people.person_id'), nullable=False),
+    Column('movie_id', Integer, ForeignKey('movies.movie_id'), nullable=False),
+    Column('volume_id', Integer, ForeignKey('volumes.volume_id')),
+    Column('collection_id', Integer, ForeignKey('collections.collection_id')),
+    Column('date', Date, nullable=False, default=func.current_date()),
+    Column('return_date', Date, nullable=True))
+
+people_table = Table('people', metadata,
+    Column('person_id', Integer, primary_key=True),
+    Column('name', VARCHAR(255), nullable=False, unique=True),
+    Column('email', VARCHAR(128)),
+    Column('phone', VARCHAR(64)))
+
+volumes_table = Table('volumes', metadata,
+    Column('volume_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True),
+    Column('loaned', Boolean, nullable=False, default=False))
+
+collections_table = Table('collections', metadata,
+    Column('collection_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True),
+    Column('loaned', Boolean, nullable=False, default=False))
+
+media_table = Table('media', metadata,
+    Column('medium_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True))
+
+languages_table = Table('languages', metadata,
+    Column('lang_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True))
+
+vcodecs_table = Table('vcodecs', metadata,
+    Column('vcodec_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True))
+
+acodecs_table = Table('acodecs', metadata,
+    Column('acodec_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True))
+
+achannels_table = Table('achannels', metadata,
+    Column('achannel_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True))
+
+subformats_table = Table('subformats', metadata,
+    Column('subformat_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True))
+
+tags_table = Table('tags', metadata,
+    Column('tag_id', Integer, primary_key=True),
+    Column('name', VARCHAR(64), nullable=False, unique=True))
+
+movie_lang_table = Table('movie_lang', metadata,
+    Column('ml_id', Integer, primary_key=True),
+    Column('type', SmallInteger), # 0: Original, 1:lector, 2:dubbing, 3:subtitle 
+    Column('movie_id', Integer, ForeignKey('movies.movie_id'), nullable=False),
+    Column('lang_id', Integer, ForeignKey('languages.lang_id'), nullable=False),
+    Column('acodec_id', Integer, ForeignKey('acodecs.acodec_id')),
+    Column('achannel_id', Integer, ForeignKey('achannels.achannel_id')),
+    Column('subformat_id', Integer, ForeignKey('subformats.subformat_id')))
+
+movie_tag_table = Table('movie_tag', metadata,
+    Column('mt_id', Integer, primary_key=True),
+    Column('movie_id', Integer, ForeignKey('movies.movie_id')),
+    Column('tag_id', Integer, ForeignKey('tags.tag_id')))
+
+configuration_table = Table('configuration', metadata,
+    Column('param', VARCHAR(16), primary_key=True),
+    Column('value', VARCHAR(128), nullable=False))
+#}}}
+
+### mappers ################################################### {{{
+mapper(Configuration, configuration_table)
+mapper(Volume, volumes_table, order_by=volumes_table.c.name, properties={
+    'movies': relation(Movie, backref='volume')})
+mapper(Collection, collections_table, order_by=collections_table.c.name, properties={
+    'movies': relation(Movie, backref='collection')})
+mapper(Medium, media_table, properties={
+    'movies': relation(Movie, backref='medium')})
+mapper(VCodec, vcodecs_table, properties={
+    'movies': relation(Movie, backref='vcodec')})
+mapper(Person, people_table, properties = {
+    'loans'    : relation(Loan, backref='person', cascade='all, delete-orphan')})
+mapper(MovieLang, movie_lang_table, primary_key=[movie_lang_table.c.ml_id], properties = {
+    'movie'    : relation(Movie, lazy=False),
+    'language' : relation(Lang, lazy=False),
+    'achannel' : relation(AChannel),
+    'acodec'   : relation(ACodec),
+    'subformat': relation(SubFormat)})
+mapper(ACodec, acodecs_table, properties={
+    'movielangs': relation(MovieLang, lazy=False)})
+mapper(AChannel, achannels_table, properties={
+    'movielangs': relation(MovieLang, lazy=False)})
+mapper(SubFormat, subformats_table, properties={
+    'movielangs': relation(MovieLang, lazy=False)})
+mapper(Lang, languages_table, properties={
+    'movielangs': relation(MovieLang, lazy=False)})
+mapper(MovieTag, movie_tag_table)
+mapper(Tag, tags_table, properties={'movietags': relation(MovieTag, backref='tag')})
+mapper(Loan, loans_table, properties = {
+    'volume'    : relation(Volume),
+    'collection': relation(Collection)})
+mapper(Movie, movies_table, order_by=movies_table.c.number , properties = {
+    'loans'     : relation(Loan, backref='movie', cascade='all, delete-orphan'),
+    #'tags'       : relation(Tag, cascade='all, delete-orphan', secondary=movie_tag,
+    'tags'      : relation(Tag, secondary=movie_tag_table,
+                           primaryjoin=movies_table.c.movie_id==movie_tag_table.c.movie_id,
+                           secondaryjoin=movie_tag_table.c.tag_id==tags_table.c.tag_id),
+    'languages' : relation(MovieLang, cascade='all, delete-orphan')})
+#}}}
+
+
+
+# for debugging (run: ipython db.py)
+if __name__ == '__main__':
+    import os.path
+
+    ### ENGINE ###
+    engine = create_engine('<A HREF="sqlite:///:memory:">sqlite:///:memory:</A>', echo=False)
+
+    # create tables
+    metadata.create_all(engine)
+
+
+    ### SESSION ###
+    # create a configured &quot;Session&quot; class
+    Session = sessionmaker(bind=engine)
+    # create a Session
+    sess = Session()
+    # work with sess
+    myobject = Movie()
+    print myobject
+    #sess.add(myobject)
+    #sess.commit()
+    # close when finished
+    #sess.close()
+    import sqlalchemy
+    print &quot;SQLAlchemy version: %s&quot; % sqlalchemy.__version__
+
+
+    griffith_dir = &quot;/home/pox/.griffith/&quot;
+    url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, 'griffith.db')
+    engine2 = create_engine(url, echo=False)
+    Session2 = sessionmaker(bind=engine2)
+    sess2 = Session2()
+
+    &quot;&quot;&quot;
+    movie1 = sess2.query(Movie)[503]
+    print movie1, movie1.title
+    movie1_clone = sess.merge(movie1)
+    movie1_clone.title = 'cos'
+    sess.add(movie1_clone)
+    sess.commit()
+    for i in sess.query(Movie)[:3]:
+        print i, i.title
+    &quot;&quot;&quot;

Modified: trunk/lib/dbupgrade.py
===================================================================
--- trunk/lib/dbupgrade.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/dbupgrade.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -25,435 +25,420 @@
 from sqlalchemy import *
 import os.path
 import gutils
-import gtk
+import db
 
-
 def upgrade_database(self, version):
-	&quot;&quot;&quot;Create new db or update existing one to current format&quot;&quot;&quot;
-	if version == 0:
-		self.Configuration.mapper.mapped_table.create()
-		self.Configuration.mapper.mapped_table.insert().execute(param='version', value=self.version)
-		self.Volume.mapper.mapped_table.create()
-		self.Collection.mapper.mapped_table.create()
-		self.Medium.mapper.mapped_table.create()
-		self.Medium.mapper.mapped_table.insert().execute(name='DVD')
-		self.Medium.mapper.mapped_table.insert().execute(name='DVD-R')
-		self.Medium.mapper.mapped_table.insert().execute(name='DVD-RW')
-		self.Medium.mapper.mapped_table.insert().execute(name='DVD+R')
-		self.Medium.mapper.mapped_table.insert().execute(name='DVD+RW')
-		self.Medium.mapper.mapped_table.insert().execute(name='DVD-RAM')
-		self.Medium.mapper.mapped_table.insert().execute(name='CD')
-		self.Medium.mapper.mapped_table.insert().execute(name='CD-RW')
-		self.Medium.mapper.mapped_table.insert().execute(name='VCD')
-		self.Medium.mapper.mapped_table.insert().execute(name='SVCD')
-		self.Medium.mapper.mapped_table.insert().execute(name='VHS')
-		self.Medium.mapper.mapped_table.insert().execute(name='BETACAM')
-		self.Medium.mapper.mapped_table.insert().execute(name='LaserDisc')
-		self.ACodec.mapper.mapped_table.create()
-		self.ACodec.mapper.mapped_table.insert().execute(name='AC-3 Dolby audio')
-		self.ACodec.mapper.mapped_table.insert().execute(name='OGG')
-		self.ACodec.mapper.mapped_table.insert().execute(name='MP3')
-		self.ACodec.mapper.mapped_table.insert().execute(name='MPEG-1')
-		self.ACodec.mapper.mapped_table.insert().execute(name='MPEG-2')
-		self.ACodec.mapper.mapped_table.insert().execute(name='AAC')
-		self.ACodec.mapper.mapped_table.insert().execute(name='Windows Media Audio')
-		self.VCodec.mapper.mapped_table.create()
-		self.VCodec.mapper.mapped_table.insert().execute(name='MPEG-1')
-		self.VCodec.mapper.mapped_table.insert().execute(name='MPEG-2')
-		self.VCodec.mapper.mapped_table.insert().execute(name='XviD')
-		self.VCodec.mapper.mapped_table.insert().execute(name='DivX')
-		self.VCodec.mapper.mapped_table.insert().execute(name='H.264')
-		self.VCodec.mapper.mapped_table.insert().execute(name='RealVideo')
-		self.VCodec.mapper.mapped_table.insert().execute(name='QuickTime')
-		self.VCodec.mapper.mapped_table.insert().execute(name='Windows Media Video')
-		self.AChannel.mapper.mapped_table.create()
-		self.AChannel.mapper.mapped_table.insert().execute(name='mono')
-		self.AChannel.mapper.mapped_table.insert().execute(name='stereo')
-		self.AChannel.mapper.mapped_table.insert().execute(name='5.1')
-		self.AChannel.mapper.mapped_table.insert().execute(name='7.1')
-		self.SubFormat.mapper.mapped_table.create()
-		self.SubFormat.mapper.mapped_table.insert().execute(name='DVD VOB')
-		self.SubFormat.mapper.mapped_table.insert().execute(name='MPL2 (.txt)')
-		self.SubFormat.mapper.mapped_table.insert().execute(name='MicroDVD (.sub)')
-		self.SubFormat.mapper.mapped_table.insert().execute(name='SubRip (.srt)')
-		self.SubFormat.mapper.mapped_table.insert().execute(name='SubViewer2 (.sub)')
-		self.SubFormat.mapper.mapped_table.insert().execute(name='Sub Station Alpha (.ssa)')
-		self.SubFormat.mapper.mapped_table.insert().execute(name='Advanced Sub Station Alpha (.ssa)')
-		self.Person.mapper.mapped_table.create()
-		self.Movie.mapper.mapped_table.create()
-		self.Loan.mapper.mapped_table.create()
-		self.Lang.mapper.mapped_table.create()
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Brazilian Portuguese'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Bulgarian'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Catalan'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Czech'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Danish'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Dutch'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('English'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Estonian'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('French'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('German'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Greek'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Hungarian'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Indonesian'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Italian'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Japanese'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Korean'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Norwegian Bokmal'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Occitan'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Pashto'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Polish'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Portuguese'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Russian'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Simplified Chinese'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Slovak'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Spanish'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Swedish'))
-		self.Lang.mapper.mapped_table.insert().execute(name=_('Turkish'))
-		self.MovieLang.mapper.mapped_table.create()
-		self.Tag.mapper.mapped_table.create()
-		self.Tag.mapper.mapped_table.insert().execute(name=_('Favourite'))
-		self.MovieTag.mapper.mapped_table.create()
-		#self.metadata.commit()
-		return True # upgrade process finished
-	if version == 1: # fix changes between v1 and v2
-		version+=1
-		self.metadata.engine.execute(&quot;UPDATE loans SET return_date = '2007-01-01' WHERE return_date='None';&quot;)
-		db_version = self.Configuration.query.filter_by(param='version').one()
-		db_version.value = version
-		db_version.update()
-		db_version.flush()
-	#if version == 2:	# fix changes between v2 and v3
-	#	version+=1
-	#	self.Configuration.query.filter_by(param='version').one().value = version
+    &quot;&quot;&quot;Create new db or update existing one to current format&quot;&quot;&quot;
+    if version == 0:
+        b = self.session.bind
+        db.metadata.create_all(b)
+        db.configuration_table.insert(bind=b).execute(param='version', value=self.version)
+        db.media_table.insert(bind=b).execute(name='DVD')
+        db.media_table.insert(bind=b).execute(name='DVD-R')
+        db.media_table.insert(bind=b).execute(name='DVD-RW')
+        db.media_table.insert(bind=b).execute(name='DVD+R')
+        db.media_table.insert(bind=b).execute(name='DVD+RW')
+        db.media_table.insert(bind=b).execute(name='DVD-RAM')
+        db.media_table.insert(bind=b).execute(name='CD')
+        db.media_table.insert(bind=b).execute(name='CD-RW')
+        db.media_table.insert(bind=b).execute(name='VCD')
+        db.media_table.insert(bind=b).execute(name='SVCD')
+        db.media_table.insert(bind=b).execute(name='VHS')
+        db.media_table.insert(bind=b).execute(name='BETACAM')
+        db.media_table.insert(bind=b).execute(name='LaserDisc')
+        db.acodecs_table.insert(bind=b).execute(name='AC-3 Dolby audio')
+        db.acodecs_table.insert(bind=b).execute(name='OGG')
+        db.acodecs_table.insert(bind=b).execute(name='MP3')
+        db.acodecs_table.insert(bind=b).execute(name='MPEG-1')
+        db.acodecs_table.insert(bind=b).execute(name='MPEG-2')
+        db.acodecs_table.insert(bind=b).execute(name='AAC')
+        db.acodecs_table.insert(bind=b).execute(name='Windows Media Audio')
+        db.vcodecs_table.insert(bind=b).execute(name='MPEG-1')
+        db.vcodecs_table.insert(bind=b).execute(name='MPEG-2')
+        db.vcodecs_table.insert(bind=b).execute(name='XviD')
+        db.vcodecs_table.insert(bind=b).execute(name='DivX')
+        db.vcodecs_table.insert(bind=b).execute(name='H.264')
+        db.vcodecs_table.insert(bind=b).execute(name='RealVideo')
+        db.vcodecs_table.insert(bind=b).execute(name='QuickTime')
+        db.vcodecs_table.insert(bind=b).execute(name='Windows Media Video')
+        db.achannels_table.insert(bind=b).execute(name='mono')
+        db.achannels_table.insert(bind=b).execute(name='stereo')
+        db.achannels_table.insert(bind=b).execute(name='5.1')
+        db.achannels_table.insert(bind=b).execute(name='7.1')
+        db.subformats_table.insert(bind=b).execute(name='DVD VOB')
+        db.subformats_table.insert(bind=b).execute(name='MPL2 (.txt)')
+        db.subformats_table.insert(bind=b).execute(name='MicroDVD (.sub)')
+        db.subformats_table.insert(bind=b).execute(name='SubRip (.srt)')
+        db.subformats_table.insert(bind=b).execute(name='SubViewer2 (.sub)')
+        db.subformats_table.insert(bind=b).execute(name='Sub Station Alpha (.ssa)')
+        db.subformats_table.insert(bind=b).execute(name='Advanced Sub Station Alpha (.ssa)')
+        db.languages_table.insert(bind=b).execute(name=_('Brazilian Portuguese'))
+        db.languages_table.insert(bind=b).execute(name=_('Bulgarian'))
+        db.languages_table.insert(bind=b).execute(name=_('Catalan'))
+        db.languages_table.insert(bind=b).execute(name=_('Czech'))
+        db.languages_table.insert(bind=b).execute(name=_('Danish'))
+        db.languages_table.insert(bind=b).execute(name=_('Dutch'))
+        db.languages_table.insert(bind=b).execute(name=_('English'))
+        db.languages_table.insert(bind=b).execute(name=_('Estonian'))
+        db.languages_table.insert(bind=b).execute(name=_('French'))
+        db.languages_table.insert(bind=b).execute(name=_('German'))
+        db.languages_table.insert(bind=b).execute(name=_('Greek'))
+        db.languages_table.insert(bind=b).execute(name=_('Hungarian'))
+        db.languages_table.insert(bind=b).execute(name=_('Indonesian'))
+        db.languages_table.insert(bind=b).execute(name=_('Italian'))
+        db.languages_table.insert(bind=b).execute(name=_('Japanese'))
+        db.languages_table.insert(bind=b).execute(name=_('Korean'))
+        db.languages_table.insert(bind=b).execute(name=_('Norwegian Bokmal'))
+        db.languages_table.insert(bind=b).execute(name=_('Occitan'))
+        db.languages_table.insert(bind=b).execute(name=_('Pashto'))
+        db.languages_table.insert(bind=b).execute(name=_('Polish'))
+        db.languages_table.insert(bind=b).execute(name=_('Portuguese'))
+        db.languages_table.insert(bind=b).execute(name=_('Russian'))
+        db.languages_table.insert(bind=b).execute(name=_('Simplified Chinese'))
+        db.languages_table.insert(bind=b).execute(name=_('Slovak'))
+        db.languages_table.insert(bind=b).execute(name=_('Spanish'))
+        db.languages_table.insert(bind=b).execute(name=_('Swedish'))
+        db.languages_table.insert(bind=b).execute(name=_('Turkish'))
+        db.tags_table.insert(bind=b).execute(name=_('Favourite'))
+        return True # upgrade process finished
+    if version == 1: # fix changes between v1 and v2
+        version+=1
+        self.session.bind.execute(&quot;UPDATE loans SET return_date='2007-01-01' WHERE return_date='None';&quot;)
+        db_version = self.Configuration.query.filter_by(param='version').one()
+        db_version.value = version
+        db_version.update()
+        db_version.flush()
+    #if version == 2:    # fix changes between v2 and v3
+    #    version+=1
+    #    self.Configuration.query.filter_by(param='version').one().value = version
 
 
 # ---------------------------------------------------
 # for Griffith &lt;= 0.6.2 compatibility
 # ---------------------------------------------------
 
-def convert_from_old_db(self, source_file, destination_file):	#{{{
-	print 'Converting old database - it can take several minutes...'
-	gutils.info(self,_(&quot;Griffith will now convert your database to the new format. This can take several minutes if you have a large database.&quot;))
-	from sqlalchemy.orm import clear_mappers
-	from sql import GriffithSQL
-	from gutils import digits_only
-	import os
+def convert_from_old_db(self, source_file, destination_file):    #{{{
+    print 'Converting old database - it can take several minutes...'
+    gutils.info(self,_(&quot;Griffith will now convert your database to the new format. This can take several minutes if you have a large database.&quot;))
+    from sqlalchemy.orm import clear_mappers
+    from sql import GriffithSQL
+    from gutils import digits_only
+    import os
 
-	if not os.path.isfile(source_file):
-		return False
-	if open(source_file).readline()[:47] == '** This file contains an SQLite 2.1 database **':
-		try:
-			import sqlite
-			from sqlite import DatabaseError
-		except ImportError:
-			print 'Old DB conversion: please install pysqlite legacy (v1.0)'
-			gutils.warning(self,_(&quot;Old DB conversion: please install pysqlite legacy (v1.0)&quot;))
-			return False
-	else:
-		try:	# Python 2.5
-			from sqlite3 import dbapi2 as sqlite
-			from sqlite3.dbapi2 import DatabaseError
-		except ImportError: # Python &lt; 2.5 - try to use pysqlite2
-			from pysqlite2 import dbapi2 as sqlite
-			from pysqlite2.dbapi2 import DatabaseError
+    if not os.path.isfile(source_file):
+        return False
+    if open(source_file).readline()[:47] == '** This file contains an SQLite 2.1 database **':
+        try:
+            import sqlite
+            from sqlite import DatabaseError
+        except ImportError:
+            print 'Old DB conversion: please install pysqlite legacy (v1.0)'
+            gutils.warning(self,_(&quot;Old DB conversion: please install pysqlite legacy (v1.0)&quot;))
+            return False
+    else:
+        try:    # Python 2.5
+            from sqlite3 import dbapi2 as sqlite
+            from sqlite3.dbapi2 import DatabaseError
+        except ImportError: # Python &lt; 2.5 - try to use pysqlite2
+            from pysqlite2 import dbapi2 as sqlite
+            from pysqlite2.dbapi2 import DatabaseError
 
-	if os.path.isfile(destination_file):
-		# rename destination_file if it already exist
-		i = 1
-		while True:
-			if os.path.isfile(&quot;%s_%s&quot; % (destination_file, i)):
-				i += 1
-			else:
-				break
-		os.rename(destination_file, &quot;%s_%s&quot; % (destination_file, i))
+    if os.path.isfile(destination_file):
+        # rename destination_file if it already exist
+        i = 1
+        while True:
+            if os.path.isfile(&quot;%s_%s&quot; % (destination_file, i)):
+                i += 1
+            else:
+                break
+        os.rename(destination_file, &quot;%s_%s&quot; % (destination_file, i))
 
-	try:
-		old_db = sqlite.connect(source_file)
-	except DatabaseError, e:
-		if str(e) == 'file is encrypted or is not a database':
-			print 'Your database is most probably in wrong SQLite format, please convert it to SQLite3:'
-			print '$ sqlite ~/.griffith/griffith.gri .dump | sqlite3 ~/.griffith/griffith.gri3'
-			print '$ mv ~/.griffith/griffith.gri{,2}'
-			print '$ mv ~/.griffith/griffith.gri{3,}'
-			print 'or install pysqlite in version 1.0'
-			gutils.warning(self,_(&quot;Your database is most probably in SQLite2 format, please convert it to SQLite3&quot;))
-		else:
-			raise
-		return False
+    try:
+        old_db = sqlite.connect(source_file)
+    except DatabaseError, e:
+        if str(e) == 'file is encrypted or is not a database':
+            print 'Your database is most probably in wrong SQLite format, please convert it to SQLite3:'
+            print '$ sqlite ~/.griffith/griffith.gri .dump | sqlite3 ~/.griffith/griffith.gri3'
+            print '$ mv ~/.griffith/griffith.gri{,2}'
+            print '$ mv ~/.griffith/griffith.gri{3,}'
+            print 'or install pysqlite in version 1.0'
+            gutils.warning(self,_(&quot;Your database is most probably in SQLite2 format, please convert it to SQLite3&quot;))
+        else:
+            raise
+        return False
 
-	old_cursor = old_db.cursor()
+    old_cursor = old_db.cursor()
 
-	# fix old database
-	old_cursor.execute(&quot;UPDATE movies SET media = '1' WHERE media = 'DVD';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '2' WHERE media = 'DVD-R';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '3' WHERE media = 'DVD-RW';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '4' WHERE media = 'DVD+R';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '5' WHERE media = 'DVD+RW';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '6' WHERE media = 'DVD-RAM';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'DivX';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'DIVX';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'XviD';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'XVID';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'WMV';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '9' WHERE media = 'VCD';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '10' WHERE media = 'SVCD'; 	&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '11' WHERE media = 'VHS';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET media = '12' WHERE media = 'BETACAM';&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET collection_id=0 WHERE collection_id&lt;1&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET volume_id=0 WHERE volume_id&lt;1&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET color=NULL WHERE color&lt;1 OR color='' OR color&gt;3&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET condition=NULL WHERE condition&lt;0 OR condition='' OR condition&gt;5&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET layers=NULL WHERE layers&lt;0 OR layers='' OR layers&gt;4&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET region=NULL WHERE region='' OR region=2 OR region&lt;0 OR region&gt;8&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET year=NULL WHERE year&lt;1900 or year&gt;2007&quot;)
-	old_cursor.execute(&quot;UPDATE movies SET rating = 0 WHERE rating NOT IN (0,1,2,3,4,5,6,7,8,9,10);&quot;) # rating&gt;10 doesn't work with some DB
-	old_cursor.execute(&quot;UPDATE movies SET runtime = NULL WHERE runtime &gt; 10000;&quot;) # remove strings
-	old_cursor.execute(&quot;UPDATE loans SET return_date=NULL WHERE return_date=''&quot;)
-	old_cursor.execute(&quot;UPDATE loans SET return_date=NULL WHERE return_date='None'&quot;)
-	old_cursor.execute(&quot;DELETE FROM loans WHERE date='' OR date ISNULL&quot;)
-	old_cursor.execute(&quot;DELETE FROM volumes WHERE name = ''&quot;)
-	old_cursor.execute(&quot;DELETE FROM volumes WHERE name = 'None'&quot;)
-	old_cursor.execute(&quot;DELETE FROM collections WHERE name = ''&quot;)
-	old_cursor.execute(&quot;DELETE FROM collections WHERE name = 'None'&quot;)
-	old_cursor.execute(&quot;DELETE FROM languages WHERE name = ''&quot;)
-	
-	self.config.set('type','sqlite', section='database')
-	self.config.set('file', 'griffith.db', section='database')
-	self.config['posters'] = 'posters'
-	self.config.set('color', 0, section='defaults')
-	self.config.set('condition', 0, section='defaults')
-	self.config.set('layers', 0, section='defaults')
-	self.config.set('media', 0, section='defaults')
-	self.config.set('region', 0, section='defaults')
-	self.config.set('vcodec', 0, section='defaults')
-	self.locations['posters'] = os.path.join(self.locations['home'], 'posters')
-	new_db = GriffithSQL(self.config, self.debug, self.locations['home'])
+    # fix old database
+    old_cursor.execute(&quot;UPDATE movies SET media = '1' WHERE media = 'DVD';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '2' WHERE media = 'DVD-R';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '3' WHERE media = 'DVD-RW';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '4' WHERE media = 'DVD+R';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '5' WHERE media = 'DVD+RW';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '6' WHERE media = 'DVD-RAM';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'DivX';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'DIVX';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'XviD';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'XVID';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '7' WHERE media = 'WMV';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '9' WHERE media = 'VCD';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '10' WHERE media = 'SVCD';     &quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '11' WHERE media = 'VHS';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET media = '12' WHERE media = 'BETACAM';&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET collection_id=0 WHERE collection_id&lt;1&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET volume_id=0 WHERE volume_id&lt;1&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET color=NULL WHERE color&lt;1 OR color='' OR color&gt;3&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET condition=NULL WHERE condition&lt;0 OR condition='' OR condition&gt;5&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET layers=NULL WHERE layers&lt;0 OR layers='' OR layers&gt;4&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET region=NULL WHERE region='' OR region=2 OR region&lt;0 OR region&gt;8&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET year=NULL WHERE year&lt;1900 or year&gt;2007&quot;)
+    old_cursor.execute(&quot;UPDATE movies SET rating = 0 WHERE rating NOT IN (0,1,2,3,4,5,6,7,8,9,10);&quot;) # rating&gt;10 doesn't work with some DB
+    old_cursor.execute(&quot;UPDATE movies SET runtime = NULL WHERE runtime &gt; 10000;&quot;) # remove strings
+    old_cursor.execute(&quot;UPDATE loans SET return_date=NULL WHERE return_date=''&quot;)
+    old_cursor.execute(&quot;UPDATE loans SET return_date=NULL WHERE return_date='None'&quot;)
+    old_cursor.execute(&quot;DELETE FROM loans WHERE date='' OR date ISNULL&quot;)
+    old_cursor.execute(&quot;DELETE FROM volumes WHERE name = ''&quot;)
+    old_cursor.execute(&quot;DELETE FROM volumes WHERE name = 'None'&quot;)
+    old_cursor.execute(&quot;DELETE FROM collections WHERE name = ''&quot;)
+    old_cursor.execute(&quot;DELETE FROM collections WHERE name = 'None'&quot;)
+    old_cursor.execute(&quot;DELETE FROM languages WHERE name = ''&quot;)
+    
+    self.config.set('type','sqlite', section='database')
+    self.config.set('file', 'griffith.db', section='database')
+    self.config['posters'] = 'posters'
+    self.config.set('color', 0, section='defaults')
+    self.config.set('condition', 0, section='defaults')
+    self.config.set('layers', 0, section='defaults')
+    self.config.set('media', 0, section='defaults')
+    self.config.set('region', 0, section='defaults')
+    self.config.set('vcodec', 0, section='defaults')
+    self.locations['posters'] = os.path.join(self.locations['home'], 'posters')
+    new_db = GriffithSQL(self.config, self.debug, self.locations['home'])
 
-	# collections
-	collection_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
-	old_cursor.execute(&quot;SELECT id, name FROM collections;&quot;) # loaned status will be set later - buggy databases :-(
-	for i in old_cursor.fetchall():
-		o = new_db.Collection(name=i[1])
-		try:
-			o.save(); o.flush()
-		except Exception, e:
-			self.debug.show(str(e))
-			continue
-		collection_mapper[i[0]] = o.collection_id
-	
-	# volumes
-	volume_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
-	old_cursor.execute(&quot;SELECT id, name FROM volumes;&quot;) # loaned status will be set later - buggy databases :-(
-	for i in old_cursor.fetchall():
-		o = new_db.Volume(name=i[1])
-		try:
-			o.save(); o.flush()
-		except Exception, e:
-			self.debug.show(str(e))
-			continue
-		volume_mapper[i[0]] = o.volume_id
+    # collections
+    collection_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
+    old_cursor.execute(&quot;SELECT id, name FROM collections;&quot;) # loaned status will be set later - buggy databases :-(
+    for i in old_cursor.fetchall():
+        o = new_db.Collection(name=i[1])
+        try:
+            o.save(); o.flush()
+        except Exception, e:
+            self.debug.show(str(e))
+            continue
+        collection_mapper[i[0]] = o.collection_id
+    
+    # volumes
+    volume_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
+    old_cursor.execute(&quot;SELECT id, name FROM volumes;&quot;) # loaned status will be set later - buggy databases :-(
+    for i in old_cursor.fetchall():
+        o = new_db.Volume(name=i[1])
+        try:
+            o.save(); o.flush()
+        except Exception, e:
+            self.debug.show(str(e))
+            continue
+        volume_mapper[i[0]] = o.volume_id
 
-	# people
-	person_mapper = {}
-	old_cursor.execute(&quot;SELECT id, name, email, phone FROM people;&quot;)
-	for i in old_cursor.fetchall():
-		o = new_db.Person(name=i[1], email=i[2], phone=i[3])
-		try:
-			o.save(); o.flush()
-		except Exception, e:
-			self.debug.show(str(e))
-			continue
-		person_mapper[i[0]] = o.person_id
-	
-	# languages
-	language_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
-	old_cursor.execute(&quot;SELECT id, name FROM languages;&quot;)
-	for i in old_cursor.fetchall():
-		o = new_db.Lang.query.filter_by(name=i[1]).first()
-		if o is not None:
-			language_mapper[i[0]] = o.lang_id
-		else:
-			o = new_db.Lang(name=i[1])
-			try:
-				o.save(); o.flush()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
-			language_mapper[i[0]] = o.lang_id
+    # people
+    person_mapper = {}
+    old_cursor.execute(&quot;SELECT id, name, email, phone FROM people;&quot;)
+    for i in old_cursor.fetchall():
+        o = new_db.Person(name=i[1], email=i[2], phone=i[3])
+        try:
+            o.save(); o.flush()
+        except Exception, e:
+            self.debug.show(str(e))
+            continue
+        person_mapper[i[0]] = o.person_id
+    
+    # languages
+    language_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
+    old_cursor.execute(&quot;SELECT id, name FROM languages;&quot;)
+    for i in old_cursor.fetchall():
+        o = new_db.Lang.query.filter_by(name=i[1]).first()
+        if o is not None:
+            language_mapper[i[0]] = o.lang_id
+        else:
+            o = new_db.Lang(name=i[1])
+            try:
+                o.save(); o.flush()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
+            language_mapper[i[0]] = o.lang_id
 
-	# media
-	medium_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
-	old_cursor.execute(&quot;SELECT id, name FROM media;&quot;)
-	for i in old_cursor.fetchall():
-		o = new_db.Medium.query.filter_by(name=i[1]).first()
-		if o is not None:
-			medium_mapper[i[0]] = o.medium_id
-		else:
-			o = new_db.Medium(name=i[1])
-			try:
-				o.save(); o.flush()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
-			medium_mapper[i[0]] = o.medium_id
-	
-	# tags
-	tag_mapper = {}
-	old_cursor.execute(&quot;SELECT id, name FROM tags;&quot;)
-	for i in old_cursor.fetchall():
-		o = new_db.Tag.query.filter_by(name=i[1]).first()
-		if o is not None:
-			tag_mapper[i[0]] = o.tag_id
-		else:
-			o = new_db.Tag(name=i[1])
-			try:
-				o.save(); o.flush()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
-			tag_mapper[i[0]] = o.tag_id
-	
-	# movies
-	movie_mapper = {}
-	old_cursor.execute(&quot;&quot;&quot;
-		SELECT id, volume_id, collection_id, original_title, title, director,
-			number, image, plot, country, year, runtime, classification,
-			genre, studio, site, imdb, actors, trailer, rating, loaned,
-			media, num_media, obs, seen, region, condition, color, layers
-		FROM movies ORDER BY number;&quot;&quot;&quot;)
-	for i in old_cursor.fetchall():
-		o = new_db.Movie()
-		o.number = digits_only(i[6])
-		if volume_mapper.has_key(i[1]):
-			o.volume_id = volume_mapper[i[1]]
-		if collection_mapper.has_key(i[2]):
-			o.collection_id = collection_mapper[i[2]]
-		o.o_title = i[3][:255]
-		o.title = i[4][:255]
-		o.director = i[5][:255]
-		o.image = i[7][:128]
-		o.plot = i[8]
-		o.country = i[9][:128]
-		o.year = digits_only(i[10])
-		o.runtime = digits_only(i[11])
-		o.classification = i[12][:128]
-		o.genre = i[13][:128]
-		o.studio = i[14][:128]
-		o.o_site = i[15][:255]
-		o.site = i[16][:255]
-		o.cast = i[17]
-		o.trailer = i[18][:255]
-		o.rating = digits_only(i[19])
-		#o.loaned = bool(i[20]) # updated later
-		if medium_mapper.has_key(int(i[21])):
-			o.medium_id = medium_mapper[int(i[21])]
-		o.media_num = digits_only(i[22])
-		o.notes = i[23]
-		o.seen = bool(i[24])
-		o.region = digits_only(i[25])
-		o.cond = digits_only(i[26], 5)
-		o.color = digits_only(i[27], 3)
-		o.layers = digits_only(i[28], 4)
-		
-		try:
-			o.save(); o.flush()
-		except Exception, e:
-			self.debug.show(str(e))
-			continue
-		movie_mapper[i[0]] = o.movie_id
+    # media
+    medium_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}
+    old_cursor.execute(&quot;SELECT id, name FROM media;&quot;)
+    for i in old_cursor.fetchall():
+        o = new_db.Medium.query.filter_by(name=i[1]).first()
+        if o is not None:
+            medium_mapper[i[0]] = o.medium_id
+        else:
+            o = new_db.Medium(name=i[1])
+            try:
+                o.save(); o.flush()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
+            medium_mapper[i[0]] = o.medium_id
+    
+    # tags
+    tag_mapper = {}
+    old_cursor.execute(&quot;SELECT id, name FROM tags;&quot;)
+    for i in old_cursor.fetchall():
+        o = new_db.Tag.query.filter_by(name=i[1]).first()
+        if o is not None:
+            tag_mapper[i[0]] = o.tag_id
+        else:
+            o = new_db.Tag(name=i[1])
+            try:
+                o.save(); o.flush()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
+            tag_mapper[i[0]] = o.tag_id
+    
+    # movies
+    movie_mapper = {}
+    old_cursor.execute(&quot;&quot;&quot;
+        SELECT id, volume_id, collection_id, original_title, title, director,
+            number, image, plot, country, year, runtime, classification,
+            genre, studio, site, imdb, actors, trailer, rating, loaned,
+            media, num_media, obs, seen, region, condition, color, layers
+        FROM movies ORDER BY number;&quot;&quot;&quot;)
+    for i in old_cursor.fetchall():
+        o = new_db.Movie()
+        o.number = digits_only(i[6])
+        if volume_mapper.has_key(i[1]):
+            o.volume_id = volume_mapper[i[1]]
+        if collection_mapper.has_key(i[2]):
+            o.collection_id = collection_mapper[i[2]]
+        o.o_title = i[3][:255]
+        o.title = i[4][:255]
+        o.director = i[5][:255]
+        o.image = i[7][:128]
+        o.plot = i[8]
+        o.country = i[9][:128]
+        o.year = digits_only(i[10])
+        o.runtime = digits_only(i[11])
+        o.classification = i[12][:128]
+        o.genre = i[13][:128]
+        o.studio = i[14][:128]
+        o.o_site = i[15][:255]
+        o.site = i[16][:255]
+        o.cast = i[17]
+        o.trailer = i[18][:255]
+        o.rating = digits_only(i[19])
+        #o.loaned = bool(i[20]) # updated later
+        if medium_mapper.has_key(int(i[21])):
+            o.medium_id = medium_mapper[int(i[21])]
+        o.media_num = digits_only(i[22])
+        o.notes = i[23]
+        o.seen = bool(i[24])
+        o.region = digits_only(i[25])
+        o.cond = digits_only(i[26], 5)
+        o.color = digits_only(i[27], 3)
+        o.layers = digits_only(i[28], 4)
+        
+        try:
+            o.save(); o.flush()
+        except Exception, e:
+            self.debug.show(str(e))
+            continue
+        movie_mapper[i[0]] = o.movie_id
 
-	# movie tag
-	old_cursor.execute(&quot;SELECT movie_id, tag_id FROM movie_tag WHERE movie_id IN (SELECT id FROM movies);&quot;)
-	for i in old_cursor.fetchall():
-		o = new_db.MovieTag.query.filter_by(movie_id=movie_mapper[i[0]], tag_id=tag_mapper[i[1]]).first()
-		if o is None:
-			m = new_db.Movie.query.filter_by(movie_id=movie_mapper[i[0]]).one()
-			t = new_db.Tag.query.filter_by(tag_id=tag_mapper[i[1]]).one()
-			t.save()
-			m.tags.append(t)
-			try:
-				m.save(); m.flush()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
-	
-	# movie lang
-	old_cursor.execute(&quot;SELECT movie_id, lang_id, type FROM movie_lang WHERE movie_id IN (SELECT id FROM movies);&quot;)
-	for i in old_cursor.fetchall():
-		o = new_db.MovieLang.query.filter_by(movie_id=movie_mapper[i[0]], lang_id=language_mapper[i[1]], type=i[2]).first()
-		if o is None:
-			m = new_db.Movie.query.filter_by(movie_id=movie_mapper[i[0]]).one()
-			l = new_db.MovieLang(lang_id=language_mapper[i[1]], type=i[2])
-			l.save()
-			m.languages.append(l)
-			try:
-				m.save(); m.flush()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
+    # movie tag
+    old_cursor.execute(&quot;SELECT movie_id, tag_id FROM movie_tag WHERE movie_id IN (SELECT id FROM movies);&quot;)
+    for i in old_cursor.fetchall():
+        o = new_db.MovieTag.query.filter_by(movie_id=movie_mapper[i[0]], tag_id=tag_mapper[i[1]]).first()
+        if o is None:
+            m = new_db.Movie.query.filter_by(movie_id=movie_mapper[i[0]]).one()
+            t = new_db.Tag.query.filter_by(tag_id=tag_mapper[i[1]]).one()
+            t.save()
+            m.tags.append(t)
+            try:
+                m.save(); m.flush()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
+    
+    # movie lang
+    old_cursor.execute(&quot;SELECT movie_id, lang_id, type FROM movie_lang WHERE movie_id IN (SELECT id FROM movies);&quot;)
+    for i in old_cursor.fetchall():
+        o = new_db.MovieLang.query.filter_by(movie_id=movie_mapper[i[0]], lang_id=language_mapper[i[1]], type=i[2]).first()
+        if o is None:
+            m = new_db.Movie.query.filter_by(movie_id=movie_mapper[i[0]]).one()
+            l = new_db.MovieLang(lang_id=language_mapper[i[1]], type=i[2])
+            l.save()
+            m.languages.append(l)
+            try:
+                m.save(); m.flush()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
 
-	# loans
-	old_cursor.execute(&quot;SELECT person_id, movie_id, volume_id, collection_id, date, return_date FROM loans;&quot;)
-	for i in old_cursor.fetchall():
-		vol = col = None
-		not_returned = i[5] is None
+    # loans
+    old_cursor.execute(&quot;SELECT person_id, movie_id, volume_id, collection_id, date, return_date FROM loans;&quot;)
+    for i in old_cursor.fetchall():
+        vol = col = None
+        not_returned = i[5] is None
 
-		if int(i[2]) &gt; 0:
-			try:
-				vol = new_db.Volume.query.filter_by(volume_id=volume_mapper[i[2]]).one()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
-		if int(i[3]) &gt; 0:
-			try:
-				col = new_db.Collection.query.filter_by(collection_id=collection_mapper[i[3]]).one()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
-		if int(i[1]) == 0:
-			if vol is not None and len(vol.movies)&gt;0:
-				m = vol.movies[0]
-			elif col is not None and len(col.movies)&gt;0:
-				m = col.movies[0]
-			else:
-				self.debug.show(&quot;Cannot find associated movie for this loan (%s)&quot; % i)
-				continue
-		else:
-			try:
-				m = new_db.Movie.query.filter_by(movie_id=movie_mapper[i[1]]).one()
-			except Exception, e:
-				self.debug.show(str(e))
-				continue
-		
-		l = new_db.Loan()
-		l.person_id = person_mapper[i[0]]
-		l.date = str(i[4])[:10]
-		if not_returned:
-			m.loaned = True
-			l.return_date = None
-		else:
-			l.return_date = str(i[5])[:10]
-		
-		# update volume / collection status
-		if int(i[2]) &gt; 0:
-			l.volume_id = volume_mapper[i[2]]
-			if not_returned:
-				vol.loaned = True
-				vol.save()
-		if int(i[3]) &gt; 0:
-			l.collection_id = collection_mapper[i[3]]
-			if not_returned:
-				col.loaned = True
-				col.save()
-		l.save();
-		m.loans.append(l)
-		try:
-			m.flush()
-		except Exception, e:
-			self.debug.show(str(e))
-			continue
-	clear_mappers()
-	return True
+        if int(i[2]) &gt; 0:
+            try:
+                vol = new_db.Volume.query.filter_by(volume_id=volume_mapper[i[2]]).one()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
+        if int(i[3]) &gt; 0:
+            try:
+                col = new_db.Collection.query.filter_by(collection_id=collection_mapper[i[3]]).one()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
+        if int(i[1]) == 0:
+            if vol is not None and len(vol.movies)&gt;0:
+                m = vol.movies[0]
+            elif col is not None and len(col.movies)&gt;0:
+                m = col.movies[0]
+            else:
+                self.debug.show(&quot;Cannot find associated movie for this loan (%s)&quot; % i)
+                continue
+        else:
+            try:
+                m = new_db.Movie.query.filter_by(movie_id=movie_mapper[i[1]]).one()
+            except Exception, e:
+                self.debug.show(str(e))
+                continue
+        
+        l = new_db.Loan()
+        l.person_id = person_mapper[i[0]]
+        l.date = str(i[4])[:10]
+        if not_returned:
+            m.loaned = True
+            l.return_date = None
+        else:
+            l.return_date = str(i[5])[:10]
+        
+        # update volume / collection status
+        if int(i[2]) &gt; 0:
+            l.volume_id = volume_mapper[i[2]]
+            if not_returned:
+                vol.loaned = True
+                vol.save()
+        if int(i[3]) &gt; 0:
+            l.collection_id = collection_mapper[i[3]]
+            if not_returned:
+                col.loaned = True
+                col.save()
+        l.save();
+        m.loans.append(l)
+        try:
+            m.flush()
+        except Exception, e:
+            self.debug.show(str(e))
+            continue
+    clear_mappers()
+    return True
 #}}}
 # vim: fdm=marker

Modified: trunk/lib/delete.py
===================================================================
--- trunk/lib/delete.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/delete.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -26,56 +26,56 @@
 import os
 
 def delete_movie(self):
-	m_id = None
-	number, m_iter = self.get_maintree_selection()
-	movie = self.db.Movie.query.filter_by(number=number).first()
-	if movie is None:
-		gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
-		return False
-	
-	if int(movie.loaned)==1:
-		gutils.warning(self, msg=_(&quot;You can't delete movie while it is loaned.&quot;))
-		return False
-	response = gutils.question(self, _(&quot;Are you sure you want to delete this movie?&quot;), \
-		1, self.widgets['window'])
-	if response == -8:	# gtk.RESPONSE_YES == -8
-		# try to delete poster image as well
-		if movie.image is not None:
-			delete_poster(self, movie.image)
-		if movie.remove_from_db():
-			# update main treelist
-			self.total -= 1
-			self.clear_details()
-			self.initialized = False
-			self.go_prev()
-			self.treemodel.remove(m_iter)
-			self.initialized = True
-			self.go_next()
-			self.count_statusbar()
-	else:
-		return False
+    m_id = None
+    number, m_iter = self.get_maintree_selection()
+    movie = self.db.Movie.query.filter_by(number=number).first()
+    if movie is None:
+        gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
+        return False
+    
+    if int(movie.loaned)==1:
+        gutils.warning(self, msg=_(&quot;You can't delete movie while it is loaned.&quot;))
+        return False
+    response = gutils.question(self, _(&quot;Are you sure you want to delete this movie?&quot;), \
+        1, self.widgets['window'])
+    if response == -8:    # gtk.RESPONSE_YES == -8
+        # try to delete poster image as well
+        if movie.image is not None:
+            delete_poster(self, movie.image)
+        if movie.remove_from_db():
+            # update main treelist
+            self.total -= 1
+            self.clear_details()
+            self.initialized = False
+            self.go_prev()
+            self.treemodel.remove(m_iter)
+            self.initialized = True
+            self.go_next()
+            self.count_statusbar()
+    else:
+        return False
 
 def delete_poster(self, poster):
-	if not poster:
-		self.debug.show('Delete poster: no poster to delete')
-		return False
-	posters_dir = os.path.join(self.locations['posters'])
-	image_thumbnail = os.path.join(posters_dir, &quot;t_&quot; + poster + &quot;.jpg&quot;)
-	image_mini = os.path.join(posters_dir, &quot;m_&quot; + poster + &quot;.jpg&quot;)
-	image_full = os.path.join(posters_dir, poster + &quot;.jpg&quot;)
-	if os.path.isfile(image_mini):
-		try:
-			os.remove(image_mini)
-		except:
-			self.debug.show(&quot;Can't remove %s file&quot;%image_mini)
-	if os.path.isfile(image_full):
-		try:
-			os.remove(image_full)
-		except:
-			self.debug.show(&quot;Can't remove %s file&quot;%image_full)
-	if os.path.isfile(image_thumbnail):
-		try:
-			os.remove(image_thumbnail)
-		except:
-			self.debug.show(&quot;Can't remove %s file&quot;%image_thumbnail)
+    if not poster:
+        self.debug.show('Delete poster: no poster to delete')
+        return False
+    posters_dir = os.path.join(self.locations['posters'])
+    image_thumbnail = os.path.join(posters_dir, &quot;t_&quot; + poster + &quot;.jpg&quot;)
+    image_mini = os.path.join(posters_dir, &quot;m_&quot; + poster + &quot;.jpg&quot;)
+    image_full = os.path.join(posters_dir, poster + &quot;.jpg&quot;)
+    if os.path.isfile(image_mini):
+        try:
+            os.remove(image_mini)
+        except:
+            self.debug.show(&quot;Can't remove %s file&quot;%image_mini)
+    if os.path.isfile(image_full):
+        try:
+            os.remove(image_full)
+        except:
+            self.debug.show(&quot;Can't remove %s file&quot;%image_full)
+    if os.path.isfile(image_thumbnail):
+        try:
+            os.remove(image_thumbnail)
+        except:
+            self.debug.show(&quot;Can't remove %s file&quot;%image_thumbnail)
 

Modified: trunk/lib/edit.py
===================================================================
--- trunk/lib/edit.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/edit.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -34,228 +34,228 @@
 from PIL import Image
 
 def change_poster(self):
-	&quot;&quot;&quot;
-	changes movie poster image to a custom one
-	showing a file chooser dialog to select it
-	&quot;&quot;&quot;
-	picture = self.widgets['movie']['picture']
-	number = self.get_maintree_selection()[0]
-	if number is None:
-		gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
-		return False
-	filename = gutils.file_chooser(_(&quot;Select image&quot;), action=gtk.FILE_CHOOSER_ACTION_OPEN, buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_OPEN,gtk.RESPONSE_OK), name=&quot;&quot;, folder=self.locations['desktop'], picture=True)
-	if filename and filename[0]:
-		filename = filename[0].decode('UTF-8')
-		update_image(self, number, filename)
+    &quot;&quot;&quot;
+    changes movie poster image to a custom one
+    showing a file chooser dialog to select it
+    &quot;&quot;&quot;
+    picture = self.widgets['movie']['picture']
+    number = self.get_maintree_selection()[0]
+    if number is None:
+        gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
+        return False
+    filename = gutils.file_chooser(_(&quot;Select image&quot;), action=gtk.FILE_CHOOSER_ACTION_OPEN, buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_OPEN,gtk.RESPONSE_OK), name=&quot;&quot;, folder=self.locations['desktop'], picture=True)
+    if filename and filename[0]:
+        filename = filename[0].decode('UTF-8')
+        update_image(self, number, filename)
 
 def update_image(self, number, file_path):
-	import shutil
-	try:
-		self.widgets['movie']['picture'].set_from_pixbuf(\
-				gtk.gdk.pixbuf_new_from_file(file_path).scale_simple(100, 140, gtk.gdk.INTERP_BILINEAR))
-	except Exception, e:
-		self.debug.show(str(e))
-		gutils.error(self, _(&quot;Image not valid.&quot;), self.widgets['window'])
-		return False
+    import shutil
+    try:
+        self.widgets['movie']['picture'].set_from_pixbuf(\
+                gtk.gdk.pixbuf_new_from_file(file_path).scale_simple(100, 140, gtk.gdk.INTERP_BILINEAR))
+    except Exception, e:
+        self.debug.show(str(e))
+        gutils.error(self, _(&quot;Image not valid.&quot;), self.widgets['window'])
+        return False
 
-	filename = os.path.basename(file_path)
-	new_image = os.path.splitext(filename)[0]
-	if self.db.Movie.query.filter_by(image=new_image).first() is not None:
-		i = 0
-		while True:
-			i += 1
-			if self.db.Movie.query.filter_by(image=&quot;%s_%s&quot; % (new_image, i)).first() is None:
-				new_image = &quot;%s_%s&quot; % (new_image, i)
-				break
+    filename = os.path.basename(file_path)
+    new_image = os.path.splitext(filename)[0]
+    if self.db.Movie.query.filter_by(image=new_image).first() is not None:
+        i = 0
+        while True:
+            i += 1
+            if self.db.Movie.query.filter_by(image=&quot;%s_%s&quot; % (new_image, i)).first() is None:
+                new_image = &quot;%s_%s&quot; % (new_image, i)
+                break
 
-	movie = self.db.Movie.query.filter_by(number=number).one()
-	old_image = os.path.join(self.locations['posters'], &quot;%s.jpg&quot; % movie.image)
-	delete.delete_poster(self, old_image)
-	movie.image = new_image
-	movie.update()
-	movie.flush()
+    movie = self.db.Movie.query.filter_by(number=number).one()
+    old_image = os.path.join(self.locations['posters'], &quot;%s.jpg&quot; % movie.image)
+    delete.delete_poster(self, old_image)
+    movie.image = new_image
+    movie.update()
+    movie.flush()
 
-	shutil.copyfile(file_path, os.path.join(self.locations['posters'], &quot;%s.jpg&quot; % new_image))
+    shutil.copyfile(file_path, os.path.join(self.locations['posters'], &quot;%s.jpg&quot; % new_image))
 
-	gutils.make_thumbnail(self, '%s.jpg' % new_image)
-	gutils.make_medium_image(self, '%s.jpg' % new_image)
-	update_tree_thumbnail(self, os.path.join(self.locations['posters'], 't_%s.jpg' % new_image))
+    gutils.make_thumbnail(self, '%s.jpg' % new_image)
+    gutils.make_medium_image(self, '%s.jpg' % new_image)
+    update_tree_thumbnail(self, os.path.join(self.locations['posters'], 't_%s.jpg' % new_image))
 
-	self.widgets['movie']['picture_button'].set_sensitive(True)
-	self.widgets['add']['delete_poster'].set_sensitive(True)
-	self.widgets['menu']['delete_poster'].set_sensitive(True)
+    self.widgets['movie']['picture_button'].set_sensitive(True)
+    self.widgets['add']['delete_poster'].set_sensitive(True)
+    self.widgets['menu']['delete_poster'].set_sensitive(True)
 
-	self.update_statusbar(_(&quot;Image has been updated&quot;))
+    self.update_statusbar(_(&quot;Image has been updated&quot;))
 
 def delete_poster(self):
-	movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).first()
-	if not movie:
-		self.debug.show(&quot;Can't delete unknown movie's poster!&quot;)
-		return False
-	response = gutils.question(self, _(&quot;Are you sure you want to delete this poster?&quot;), 1, self.widgets['window'])
-	if response==-8:
-		image_path = os.path.join(self.locations['images'], 'default.png')
-		handler = self.widgets['movie']['picture'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(image_path))
-		gutils.garbage(handler)
-		update_tree_thumbnail(self, os.path.join(self.locations['images'], 'default_thumbnail.png'))
-		# update in database
-		old_image = movie.image
-		movie.image = None
-		movie.update()
-		movie.flush()
-		self.update_statusbar(_(&quot;Image has been updated&quot;))
+    movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).first()
+    if not movie:
+        self.debug.show(&quot;Can't delete unknown movie's poster!&quot;)
+        return False
+    response = gutils.question(self, _(&quot;Are you sure you want to delete this poster?&quot;), 1, self.widgets['window'])
+    if response==-8:
+        image_path = os.path.join(self.locations['images'], 'default.png')
+        handler = self.widgets['movie']['picture'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(image_path))
+        gutils.garbage(handler)
+        update_tree_thumbnail(self, os.path.join(self.locations['images'], 'default_thumbnail.png'))
+        # update in database
+        old_image = movie.image
+        movie.image = None
+        movie.update()
+        movie.flush()
+        self.update_statusbar(_(&quot;Image has been updated&quot;))
 
-		self.widgets['add']['delete_poster'].set_sensitive(False)
-		self.widgets['menu']['delete_poster'].set_sensitive(False)
-		self.widgets['movie']['picture_button'].set_sensitive(False)
-		if old_image:
-			delete.delete_poster(self, old_image)
-	else:
-		pass
+        self.widgets['add']['delete_poster'].set_sensitive(False)
+        self.widgets['menu']['delete_poster'].set_sensitive(False)
+        self.widgets['movie']['picture_button'].set_sensitive(False)
+        if old_image:
+            delete.delete_poster(self, old_image)
+    else:
+        pass
 
 def update_tree_thumbnail(self, t_image_path):
-	treeselection = self.widgets['treeview'].get_selection()
-	(tmp_model, tmp_iter) = treeselection.get_selected()
-	self.Image.set_from_file(t_image_path)
-	pixbuf = self.Image.get_pixbuf()
-	self.treemodel.set_value(tmp_iter, 1, pixbuf)
+    treeselection = self.widgets['treeview'].get_selection()
+    (tmp_model, tmp_iter) = treeselection.get_selected()
+    self.Image.set_from_file(t_image_path)
+    pixbuf = self.Image.get_pixbuf()
+    self.treemodel.set_value(tmp_iter, 1, pixbuf)
 
 def fetch_bigger_poster(self):
-	match = 0
-	self.debug.show(&quot;fetching poster from amazon&quot;)
-	movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).first()
-	if movie is None:
-		gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
-		return False
-	current_poster = movie.image
-	amazon.setLicense(&quot;04GDDMMXX8X9CJ1B22G2&quot;)
+    match = 0
+    self.debug.show(&quot;fetching poster from amazon&quot;)
+    movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).first()
+    if movie is None:
+        gutils.error(self,_(&quot;You have no movies in your database&quot;), self.widgets['window'])
+        return False
+    current_poster = movie.image
+    amazon.setLicense(&quot;04GDDMMXX8X9CJ1B22G2&quot;)
 
-	locale = self.config.get('amazon_locale', 0, section='add')
-	keyword = self.widgets['movie']['o_title'].get_text()
-	if locale == '1':
-		locale = 'uk'
-	elif locale == '2':
-		locale = 'de'
-		keyword = self.widgets['movie']['title'].get_text()
-	elif locale == '3':
-		locale = 'uk'
-	else:
-		locale = None
+    locale = self.config.get('amazon_locale', 0, section='add')
+    keyword = self.widgets['movie']['o_title'].get_text()
+    if locale == '1':
+        locale = 'uk'
+    elif locale == '2':
+        locale = 'de'
+        keyword = self.widgets['movie']['title'].get_text()
+    elif locale == '3':
+        locale = 'uk'
+    else:
+        locale = None
 
-	try:
-		result = amazon.searchByKeyword(keyword, type=&quot;Large&quot;, product_line=&quot;DVD&quot;, locale=locale)
-		self.debug.show(&quot;Posters found on amazon: %s posters&quot; % result.TotalResults)
-	except:
-		gutils.warning(self, _(&quot;No posters found for this movie.&quot;))
-		return
+    try:
+        result = amazon.searchByKeyword(keyword, type=&quot;Large&quot;, product_line=&quot;DVD&quot;, locale=locale)
+        self.debug.show(&quot;Posters found on amazon: %s posters&quot; % result.TotalResults)
+    except:
+        gutils.warning(self, _(&quot;No posters found for this movie.&quot;))
+        return
 
-	from widgets import connect_poster_signals, reconnect_add_signals
-	connect_poster_signals(self, get_poster_select_dc, result, current_poster)
+    from widgets import connect_poster_signals, reconnect_add_signals
+    connect_poster_signals(self, get_poster_select_dc, result, current_poster)
 
-	if not len(result.Item):
-		gutils.warning(self, _(&quot;No posters found for this movie.&quot;))
-		reconnect_add_signals(self)
-		return
+    if not len(result.Item):
+        gutils.warning(self, _(&quot;No posters found for this movie.&quot;))
+        reconnect_add_signals(self)
+        return
 
-	for f in range(len(result.Item)):
-		if self.widgets['movie']['o_title'].get_text() == result.Item[f].ItemAttributes.Title:
-			get_poster(self, f, result, current_poster)
-			return
+    for f in range(len(result.Item)):
+        if self.widgets['movie']['o_title'].get_text() == result.Item[f].ItemAttributes.Title:
+            get_poster(self, f, result, current_poster)
+            return
 
-	self.treemodel_results.clear()
-	self.widgets['add']['b_get_from_web'].set_sensitive(False) # disable movie plugins (result window is shared)
+    self.treemodel_results.clear()
+    self.widgets['add']['b_get_from_web'].set_sensitive(False) # disable movie plugins (result window is shared)
 
-	for f in range(len(result.Item)):
+    for f in range(len(result.Item)):
 
-		if (len(result.Item[f].LargeImage.URL)):
-			title = result.Item[f].ItemAttributes.Title
-			myiter = self.treemodel_results.insert_before(None, None)
-			self.treemodel_results.set_value(myiter, 0, str(f))
-			self.treemodel_results.set_value(myiter, 1, title)
+        if (len(result.Item[f].LargeImage.URL)):
+            title = result.Item[f].ItemAttributes.Title
+            myiter = self.treemodel_results.insert_before(None, None)
+            self.treemodel_results.set_value(myiter, 0, str(f))
+            self.treemodel_results.set_value(myiter, 1, title)
 
-	self.widgets['results']['window'].show()
-	self.widgets['results']['window'].set_keep_above(True)
+    self.widgets['results']['window'].show()
+    self.widgets['results']['window'].set_keep_above(True)
 
 def get_poster_select_dc(self, event, mself, result, current_poster):
-	if event.type == gtk.gdk._2BUTTON_PRESS:
-		get_poster(mself, None, result, current_poster)
+    if event.type == gtk.gdk._2BUTTON_PRESS:
+        get_poster(mself, None, result, current_poster)
 
 def get_poster_select(self, mself, result, current_poster):
-	get_poster(mself, None, result, current_poster)
+    get_poster(mself, None, result, current_poster)
 
 def get_poster(self, f, result, current_poster):
-	from widgets import reconnect_add_signals
-	if f is None:
-		treeselection = self.widgets['results']['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		if tmp_iter is None:
-			return False
-		f = int(tmp_model.get_value(tmp_iter, 0))
-		self.widgets['results']['window'].hide()
+    from widgets import reconnect_add_signals
+    if f is None:
+        treeselection = self.widgets['results']['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        if tmp_iter is None:
+            return False
+        f = int(tmp_model.get_value(tmp_iter, 0))
+        self.widgets['results']['window'].hide()
 
-	file_to_copy = tempfile.mktemp(suffix=self.widgets['movie']['number'].get_text(), \
-		dir=self.locations['temp'])
-	file_to_copy += &quot;.jpg&quot;
-	if len(result.Item[f].LargeImage.URL):
-		try:
-			progress = movie.Progress(self.widgets['window'],_(&quot;Fetching poster&quot;),_(&quot;Wait a moment&quot;))
-			retriever = movie.Retriever(result.Item[f].LargeImage.URL, self.widgets['window'], progress, file_to_copy)
-			retriever.start()
-			while retriever.isAlive():
-				progress.pulse()
-				if progress.status:
-					retriever.suspend()
-				while gtk.events_pending():
-					gtk.main_iteration()
-			progress.close()
-			urlcleanup()
-		except:
-			gutils.warning(self, _(&quot;Sorry. A connection error has occurred.&quot;))
+    file_to_copy = tempfile.mktemp(suffix=self.widgets['movie']['number'].get_text(), \
+        dir=self.locations['temp'])
+    file_to_copy += &quot;.jpg&quot;
+    if len(result.Item[f].LargeImage.URL):
+        try:
+            progress = movie.Progress(self.widgets['window'],_(&quot;Fetching poster&quot;),_(&quot;Wait a moment&quot;))
+            retriever = movie.Retriever(result.Item[f].LargeImage.URL, self.widgets['window'], progress, file_to_copy)
+            retriever.start()
+            while retriever.isAlive():
+                progress.pulse()
+                if progress.status:
+                    retriever.suspend()
+                while gtk.events_pending():
+                    gtk.main_iteration()
+            progress.close()
+            urlcleanup()
+        except:
+            gutils.warning(self, _(&quot;Sorry. A connection error has occurred.&quot;))
 
-	if  os.path.isfile(file_to_copy):
-		try:
-			im = Image.open(file_to_copy)
-		except IOError:
-			self.debug.show(&quot;failed to identify %s&quot;%file_to_copy)
+    if  os.path.isfile(file_to_copy):
+        try:
+            im = Image.open(file_to_copy)
+        except IOError:
+            self.debug.show(&quot;failed to identify %s&quot;%file_to_copy)
 
-		if im.size == (1,1):
-			from urllib import FancyURLopener, urlretrieve
-			url = FancyURLopener().open(&quot;<A HREF="http://www.amazon.com/gp/product/images/%s">http://www.amazon.com/gp/product/images/%s</A>&quot; % result.Item[f].ASIN).read()
-			if url.find('no-img-sm._V47056216_.gif') &gt; 0:
-				self.debug.show('No image available')
-				gutils.warning(self, _(&quot;Sorry. This movie is listed but has no poster available at Amazon.com.&quot;))
-				return False
-			url = gutils.after(url, 'id=&quot;imageViewerDiv&quot;&gt;&lt;img src=&quot;')
-			url = gutils.before(url, '&quot; id=&quot;prodImage&quot;')
-			urlretrieve(url, file_to_copy)
-			try:
-				im = Image.open(file_to_copy)
-			except IOError:
-				self.debug.show(&quot;failed to identify %s&quot;%file_to_copy)
+        if im.size == (1,1):
+            from urllib import FancyURLopener, urlretrieve
+            url = FancyURLopener().open(&quot;<A HREF="http://www.amazon.com/gp/product/images/%s">http://www.amazon.com/gp/product/images/%s</A>&quot; % result.Item[f].ASIN).read()
+            if url.find('no-img-sm._V47056216_.gif') &gt; 0:
+                self.debug.show('No image available')
+                gutils.warning(self, _(&quot;Sorry. This movie is listed but has no poster available at Amazon.com.&quot;))
+                return False
+            url = gutils.after(url, 'id=&quot;imageViewerDiv&quot;&gt;&lt;img src=&quot;')
+            url = gutils.before(url, '&quot; id=&quot;prodImage&quot;')
+            urlretrieve(url, file_to_copy)
+            try:
+                im = Image.open(file_to_copy)
+            except IOError:
+                self.debug.show(&quot;failed to identify %s&quot;%file_to_copy)
 
-		if im.mode != 'RGB': # convert GIFs
-			im = im.convert('RGB')
-			im.save(file_to_copy, 'JPEG')
-		
-		handler = self.widgets['big_poster'].set_from_file(file_to_copy)
+        if im.mode != 'RGB': # convert GIFs
+            im = im.convert('RGB')
+            im.save(file_to_copy, 'JPEG')
+        
+        handler = self.widgets['big_poster'].set_from_file(file_to_copy)
 
-		self.widgets['poster_window'].show()
-		self.widgets['poster_window'].move(0,0)
-		response = gutils.question(self, \
-				_(&quot;Do you want to use this poster instead?&quot;), \
-				1, self.widgets['window'])
-		if response == -8:
-			self.debug.show(&quot;Using fetched poster, updating and removing old one from disk.&quot;)
-			update_image(self, self.widgets['movie']['number'].get_text(), file_to_copy)
-		else:
-			self.debug.show(&quot;Reverting to previous poster and deleting new one from disk.&quot;)
-			try:
-				os.remove(file_to_copy)
-			except:
-				self.debug.show(&quot;no permission for %s&quot;%file_to_copy)
+        self.widgets['poster_window'].show()
+        self.widgets['poster_window'].move(0,0)
+        response = gutils.question(self, \
+                _(&quot;Do you want to use this poster instead?&quot;), \
+                1, self.widgets['window'])
+        if response == -8:
+            self.debug.show(&quot;Using fetched poster, updating and removing old one from disk.&quot;)
+            update_image(self, self.widgets['movie']['number'].get_text(), file_to_copy)
+        else:
+            self.debug.show(&quot;Reverting to previous poster and deleting new one from disk.&quot;)
+            try:
+                os.remove(file_to_copy)
+            except:
+                self.debug.show(&quot;no permission for %s&quot;%file_to_copy)
 
-		self.widgets['poster_window'].hide()
-	else:
-		gutils.warning(self, _(&quot;Sorry. This movie is listed but has no poster available at Amazon.com.&quot;))
-	reconnect_add_signals(self)
+        self.widgets['poster_window'].hide()
+    else:
+        gutils.warning(self, _(&quot;Sorry. This movie is listed but has no poster available at Amazon.com.&quot;))
+    reconnect_add_signals(self)
 

Modified: trunk/lib/gconsole.py
===================================================================
--- trunk/lib/gconsole.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/gconsole.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -27,182 +27,182 @@
 import gutils
 
 options = ('hDCo:t:d:c:y:s:', ('help', 'debug', 'sqlecho', 'clean', 'check-dep',
-	'show-dep', 'original_title=', 'title=', 'director=', 'cast=', 'year=',
-	'sort=', 'seen=', 'loaned=', 'number=', 'runtime=', 'rating=', 'home=',
-	'config='))
+    'show-dep', 'original_title=', 'title=', 'director=', 'cast=', 'year=',
+    'sort=', 'seen=', 'loaned=', 'number=', 'runtime=', 'rating=', 'home=',
+    'config='))
 
 def check_args(self):
-	self._tmp_home = None
-	self._tmp_config = 'griffith.cfg'
-	if len(sys.argv)&gt;1:
-		try:
-			opts, args = getopt.getopt(sys.argv[1:], options[0], options[1])
-		except getopt.GetoptError:
-			# print help information and exit:
-			con_usage()
-			sys.exit(2)
-		
-		for o, a in opts:
-			if o in ('-h', '--help'):
-				con_usage()
-				sys.exit()
-			elif o in ('-D', '--debug'):
-				self.debug.set_debug()
-			elif o == '--home':
-				self._tmp_home = a # see initialize.locations()
-			elif o == '--config':
-				self._tmp_config = a # griffith.__init__
-			elif o == '--check-dep':
-				check_dependencies()
-				sys.exit()
-			elif o == '--show-dep':
-				show_dependencies()
-				sys.exit()
+    self._tmp_home = None
+    self._tmp_config = 'griffith.cfg'
+    if len(sys.argv)&gt;1:
+        try:
+            opts, args = getopt.getopt(sys.argv[1:], options[0], options[1])
+        except getopt.GetoptError:
+            # print help information and exit:
+            con_usage()
+            sys.exit(2)
+        
+        for o, a in opts:
+            if o in ('-h', '--help'):
+                con_usage()
+                sys.exit()
+            elif o in ('-D', '--debug'):
+                self.debug.set_debug()
+            elif o == '--home':
+                self._tmp_home = a # see initialize.locations()
+            elif o == '--config':
+                self._tmp_config = a # griffith.__init__
+            elif o == '--check-dep':
+                check_dependencies()
+                sys.exit()
+            elif o == '--show-dep':
+                show_dependencies()
+                sys.exit()
 
 def check_args_with_db(self):
-	if len(sys.argv)&gt;1:
-		try:
-			opts, args = getopt.getopt(sys.argv[1:], options[0], options[1])
-		except getopt.GetoptError:
-			# print help information and exit:
-			con_usage()
-			sys.exit(3)
+    if len(sys.argv)&gt;1:
+        try:
+            opts, args = getopt.getopt(sys.argv[1:], options[0], options[1])
+        except getopt.GetoptError:
+            # print help information and exit:
+            con_usage()
+            sys.exit(3)
 
-		sort = None
-		where = {}
-		for o, a in opts:
-			if o in ('-C', '--clean'):
-				gutils.clean_posters_dir(self)
-				sys.exit()
-			elif o == '--sqlecho':
-				self.db.metadata.engine.echo = True
-			elif o in ('-s', '--sort'):
-				sort = a
-			elif o in ('-o', '--original_title'):
-				where['o_title'] = a
-			elif o in ('-t', '--title'):
-				where['title'] = a
-			elif o in ('-d', '--director'):
-				where['director'] = a
-			elif o in ('-c', '--cast'):
-				where['cast'] = a
-			elif o in ('-y', '--year'):
-				where['year'] = str(int(a))
-			elif o == '--seen':
-				where['seen'] = a
-			elif o == '--loaned':
-				where['loaned'] = a
-			elif o == '--number':
-				where['number'] = a
-			elif o == '--runtime':
-				where['runtime'] = a
-			elif o == '--rating':
-				where['rating'] = a
-		if where:
-			con_search_movie(self, where, sort)
+        sort = None
+        where = {}
+        for o, a in opts:
+            if o in ('-C', '--clean'):
+                gutils.clean_posters_dir(self)
+                sys.exit()
+            elif o == '--sqlecho':
+                self.db.metadata.engine.echo = True
+            elif o in ('-s', '--sort'):
+                sort = a
+            elif o in ('-o', '--original_title'):
+                where['o_title'] = a
+            elif o in ('-t', '--title'):
+                where['title'] = a
+            elif o in ('-d', '--director'):
+                where['director'] = a
+            elif o in ('-c', '--cast'):
+                where['cast'] = a
+            elif o in ('-y', '--year'):
+                where['year'] = str(int(a))
+            elif o == '--seen':
+                where['seen'] = a
+            elif o == '--loaned':
+                where['loaned'] = a
+            elif o == '--number':
+                where['number'] = a
+            elif o == '--runtime':
+                where['runtime'] = a
+            elif o == '--rating':
+                where['rating'] = a
+        if where:
+            con_search_movie(self, where, sort)
 
 def con_search_movie(self, where, sort=None):
-	# for search function
-	from sqlalchemy import select
-	col = lambda x: self.db.Movie.c[x]
-	columns = (col('number'), col('title'), col('o_title'), col('director'), col('year'))
-	
-	sort_columns = []
-	if sort:
-		for i in sort.split(','):
-			if self.db.Movie.c.has_key(i):
-				sort_columns.append(col(i))
-	else:
-		sort_columns = [col('number')]
+    # for search function
+    from sqlalchemy import select
+    col = lambda x: self.db.Movie.c[x]
+    columns = (col('number'), col('title'), col('o_title'), col('director'), col('year'))
+    
+    sort_columns = []
+    if sort:
+        for i in sort.split(','):
+            if self.db.Movie.c.has_key(i):
+                sort_columns.append(col(i))
+    else:
+        sort_columns = [col('number')]
 
-	statement = select(columns=columns, order_by=sort_columns)
+    statement = select(columns=columns, order_by=sort_columns)
 
-	for i in where:
-		if i in ('seen', 'loaned'):	# force boolean
-			if where[i].lower() in ('0', 'no', 'n'):
-				where[i] = False
-			else:
-				where[i] = True
-		if i in ('year', 'number', 'runtime', 'seen', 'loaned', 'rating'):
-			statement.append_whereclause(col(i)==where[i])
-		else:
-			statement.append_whereclause(col(i).like('%' + where[i] + '%' ))
+    for i in where:
+        if i in ('seen', 'loaned'):    # force boolean
+            if where[i].lower() in ('0', 'no', 'n'):
+                where[i] = False
+            else:
+                where[i] = True
+        if i in ('year', 'number', 'runtime', 'seen', 'loaned', 'rating'):
+            statement.append_whereclause(col(i)==where[i])
+        else:
+            statement.append_whereclause(col(i).like('%' + where[i] + '%' ))
 
-	movies = statement.execute().fetchall()
-	if not movies:
-		print _(&quot;No movie found&quot;)
-	else:
-		for movie in movies:
-			print &quot;\033[31;1m[%s]\033[0m\t\033[38m%s\033[0m (\033[35m%s\033[0m), %s - \033[32m%s\033[0m&quot; % \
-				(movie.number, movie.title, movie.o_title, movie.year, movie.director)
-	sys.exit()
+    movies = statement.execute().fetchall()
+    if not movies:
+        print _(&quot;No movie found&quot;)
+    else:
+        for movie in movies:
+            print &quot;\033[31;1m[%s]\033[0m\t\033[38m%s\033[0m (\033[35m%s\033[0m), %s - \033[32m%s\033[0m&quot; % \
+                (movie.number, movie.title, movie.o_title, movie.year, movie.director)
+    sys.exit()
 
 def check_dependencies():
-	ostype = None
-	if sys.version.rfind('Debian'):
-		ostype = 'debian'
+    ostype = None
+    if sys.version.rfind('Debian'):
+        ostype = 'debian'
 
-	(missing, extra) = gutils.get_dependencies()
+    (missing, extra) = gutils.get_dependencies()
 
-	def __print_missing(modules):
-		import string
-		missing = ''
-		for i in modules:
-			if i['version']==False or (not isinstance(i['version'], bool) and i['version'].startswith('-')):
-				tmp = None
-				if ostype is not None:
-					if ostype == 'debian' and i.has_key('debian'):
-						tmp = &quot;\n%s package&quot; % i['debian']
-						if i.has_key('debian_req') and i['debian_req'] is not None:
-							tmp += &quot;\n\tminimum required package version: %s&quot; % i['debian_req']
-				if tmp is None:
-					tmp = &quot;\n%s module&quot; % i['module']
-					if i.has_key('module_req') and i['module_req'] is not None:
-						tmp += &quot;\n\tminimum required module version: %s&quot; % i['module_req']
-					if i.has_key('url'):
-						tmp += &quot;\n\tURL: %s&quot; % i['url']
-				if i['version'] is not False and i['version'].startswith('-'):
-					tmp += &quot;\n\tavailable module version: %s&quot; % i['version'][1:]
-				if tmp is not None:
-					missing += tmp
-		if missing == '':
-			return None
-		else:
-			return missing
+    def __print_missing(modules):
+        import string
+        missing = ''
+        for i in modules:
+            if i['version']==False or (not isinstance(i['version'], bool) and i['version'].startswith('-')):
+                tmp = None
+                if ostype is not None:
+                    if ostype == 'debian' and i.has_key('debian'):
+                        tmp = &quot;\n%s package&quot; % i['debian']
+                        if i.has_key('debian_req') and i['debian_req'] is not None:
+                            tmp += &quot;\n\tminimum required package version: %s&quot; % i['debian_req']
+                if tmp is None:
+                    tmp = &quot;\n%s module&quot; % i['module']
+                    if i.has_key('module_req') and i['module_req'] is not None:
+                        tmp += &quot;\n\tminimum required module version: %s&quot; % i['module_req']
+                    if i.has_key('url'):
+                        tmp += &quot;\n\tURL: %s&quot; % i['url']
+                if i['version'] is not False and i['version'].startswith('-'):
+                    tmp += &quot;\n\tavailable module version: %s&quot; % i['version'][1:]
+                if tmp is not None:
+                    missing += tmp
+        if missing == '':
+            return None
+        else:
+            return missing
 
-	tmp = __print_missing(missing)
-	if tmp is not None:
-		print 'Dependencies missing:'
-		print '===================='
-		print tmp
-	tmp = __print_missing(extra)
-	if tmp is not None:
-		print '\n\nOptional dependencies missing:'
-		print '============================='
-		print tmp, &quot;\n&quot;
+    tmp = __print_missing(missing)
+    if tmp is not None:
+        print 'Dependencies missing:'
+        print '===================='
+        print tmp
+    tmp = __print_missing(extra)
+    if tmp is not None:
+        print '\n\nOptional dependencies missing:'
+        print '============================='
+        print tmp, &quot;\n&quot;
 
 def show_dependencies():
-	(missing, extra) = gutils.get_dependencies()
-	for i in missing:
-		print &quot;%(module)s :: %(version)s&quot; % i
-	for i in extra:
-		print &quot;%(module)s :: %(version)s&quot; % i
+    (missing, extra) = gutils.get_dependencies()
+    for i in missing:
+        print &quot;%(module)s :: %(version)s&quot; % i
+    for i in extra:
+        print &quot;%(module)s :: %(version)s&quot; % i
 
 def con_usage():
-	print &quot;USAGE:&quot;, sys.argv[0], '[OPTIONS]'
-	print &quot;\nOPTIONS:&quot;
-	print &quot;-h, --help\tprints this screen&quot;
-	print &quot;-D, --debug\trun with more debug info&quot;
-	print &quot;-C, --clean\tfind and delete orphan files in posters directory&quot;
-	print &quot;--check-dep\tcheck dependencies&quot;
-	print &quot;--show-dep\tshow dependencies&quot;
-	print &quot;--sqlecho\tprint SQL queries&quot;
-	print &quot;--home DIR \tset Griffith's home directory (instead of the default ~/.griffith)&quot;
-	print &quot;\n printing movie list:&quot;
-	print &quot;-c &lt;expr&gt;, --cast=&lt;expr&gt;&quot;
-	print &quot;-d &lt;expr&gt;, --director=&lt;expr&gt;&quot;
-	print &quot;-o &lt;expr&gt;, --original_title=&lt;expr&gt;&quot;
-	print &quot;-t &lt;expr&gt;, --title=&lt;expr&gt;&quot;
-	print &quot;-y &lt;number&gt;, --year=&lt;number&gt;&quot;
-	print &quot;-s &lt;columns&gt;, --sort=&lt;columns&gt;&quot;
+    print &quot;USAGE:&quot;, sys.argv[0], '[OPTIONS]'
+    print &quot;\nOPTIONS:&quot;
+    print &quot;-h, --help\tprints this screen&quot;
+    print &quot;-D, --debug\trun with more debug info&quot;
+    print &quot;-C, --clean\tfind and delete orphan files in posters directory&quot;
+    print &quot;--check-dep\tcheck dependencies&quot;
+    print &quot;--show-dep\tshow dependencies&quot;
+    print &quot;--sqlecho\tprint SQL queries&quot;
+    print &quot;--home DIR \tset Griffith's home directory (instead of the default ~/.griffith)&quot;
+    print &quot;\n printing movie list:&quot;
+    print &quot;-c &lt;expr&gt;, --cast=&lt;expr&gt;&quot;
+    print &quot;-d &lt;expr&gt;, --director=&lt;expr&gt;&quot;
+    print &quot;-o &lt;expr&gt;, --original_title=&lt;expr&gt;&quot;
+    print &quot;-t &lt;expr&gt;, --title=&lt;expr&gt;&quot;
+    print &quot;-y &lt;number&gt;, --year=&lt;number&gt;&quot;
+    print &quot;-s &lt;columns&gt;, --sort=&lt;columns&gt;&quot;
 

Modified: trunk/lib/gdebug.py
===================================================================
--- trunk/lib/gdebug.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/gdebug.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -22,14 +22,14 @@
 # GNU General Public License, version 2 or later
 
 class GriffithDebug:
-	debug_mode = None
-	
-	def __init__(self, mode=False):
-		self.debug_mode = mode
+    debug_mode = None
+    
+    def __init__(self, mode=False):
+        self.debug_mode = mode
 
-	def set_debug(self, mode=True):
-		self.debug_mode = mode
+    def set_debug(self, mode=True):
+        self.debug_mode = mode
 
-	def show(self, txt):
-		if self.debug_mode:
-			print txt.encode('utf8')
+    def show(self, txt):
+        if self.debug_mode:
+            print txt.encode('utf8')

Modified: trunk/lib/gemail.py
===================================================================
--- trunk/lib/gemail.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/gemail.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -29,58 +29,58 @@
 socket.setdefaulttimeout(10)
 
 def mailto(self, tls, port, server, auth, user, password, sender, to, subject, msg):
-	&quot;&quot;&quot;
-	sends an email
-	&quot;&quot;&quot;
-	try:
-		session = smtplib.SMTP(server, port)
-		session.set_debuglevel(1)
-	except socket.timeout:
-		gutils.error(self, _(&quot;Connection timed out&quot;), \
-			self.widgets['window'])
-		return()
-	if tls == True:
-		session.ehlo()
-		session.starttls()
-		session.ehlo()
-	if auth:
-		try:
-			session.login(user, password)
-		except:
-			gutils.error(self, _(&quot;Error sending e-mail: %s&quot;)%_(&quot;login failure&quot;), \
-				self.widgets['window'])
-			return
-	headers = &quot;From: %s\r\nTo: %s\r\nSubject: %s\r\n\r\n&quot; \
-		% (sender, to, subject)
-	try:
-		smtpresult = session.sendmail(sender, to, headers+msg)
-		gutils.info(self, _(&quot;E-mail sent sucessfuly&quot;), self.widgets['window'])
-		return
-	except:
-		gutils.error(self, _(&quot;Error sending e-mail: %s&quot;)%&quot;&quot;, self.widgets['window'])
-		
-	session.quit()
+    &quot;&quot;&quot;
+    sends an email
+    &quot;&quot;&quot;
+    try:
+        session = smtplib.SMTP(server, port)
+        session.set_debuglevel(1)
+    except socket.timeout:
+        gutils.error(self, _(&quot;Connection timed out&quot;), \
+            self.widgets['window'])
+        return()
+    if tls == True:
+        session.ehlo()
+        session.starttls()
+        session.ehlo()
+    if auth:
+        try:
+            session.login(user, password)
+        except:
+            gutils.error(self, _(&quot;Error sending e-mail: %s&quot;)%_(&quot;login failure&quot;), \
+                self.widgets['window'])
+            return
+    headers = &quot;From: %s\r\nTo: %s\r\nSubject: %s\r\n\r\n&quot; \
+        % (sender, to, subject)
+    try:
+        smtpresult = session.sendmail(sender, to, headers+msg)
+        gutils.info(self, _(&quot;E-mail sent sucessfuly&quot;), self.widgets['window'])
+        return
+    except:
+        gutils.error(self, _(&quot;Error sending e-mail: %s&quot;)%&quot;&quot;, self.widgets['window'])
+        
+    session.quit()
 
 def send_email(self):
-	if len(self.person_email):
-		if self.config.get('use_auth', False, section='mail') == True:
-			use_auth = 1
-		else:
-			use_auth = 0
-		try:
-			mailto(self, self.config.get('mail_use_tls', False, section='mail'), \
-				self.config.get('mail_smtp_port', '25', section='mail'), \
-				self.config.get('smtp_server', 'localhost', section='mail'), \
-				use_auth, self.config.get('username', '', section='mail'), \
-				self.config.get('password', '', section='mail'), \
-				self.config.get('email', 'griffith', section='mail'), self.person_email, \
-				_(&quot;Movie loan reminder&quot;), _(&quot;Hi, %s!\n\nJust to remind you &quot; + \
-				&quot;that I'm really needing the following movie I have loaned to you &quot; + \
-				&quot;recently:\n\n%s (%s)\n\nLoaned on %s&quot;) \
-				%(self.person_name, self.widgets['movie']['o_title'].get_text(), \
-				self.widgets['movie']['title'].get_text(), self.loan_date[:10]))
-		except:
-			gutils.error(self, _(&quot;Mail could not be sent. Please check e-mail preferences.&quot;), self.widgets['window'])
-	else:
-		gutils.info(self, _(&quot;This person has no e-mail address defined.&quot;), \
-			self.widgets['window'])
+    if len(self.person_email):
+        if self.config.get('use_auth', False, section='mail') == True:
+            use_auth = 1
+        else:
+            use_auth = 0
+        try:
+            mailto(self, self.config.get('mail_use_tls', False, section='mail'), \
+                self.config.get('mail_smtp_port', '25', section='mail'), \
+                self.config.get('smtp_server', 'localhost', section='mail'), \
+                use_auth, self.config.get('username', '', section='mail'), \
+                self.config.get('password', '', section='mail'), \
+                self.config.get('email', 'griffith', section='mail'), self.person_email, \
+                _(&quot;Movie loan reminder&quot;), _(&quot;Hi, %s!\n\nJust to remind you &quot; + \
+                &quot;that I'm really needing the following movie I have loaned to you &quot; + \
+                &quot;recently:\n\n%s (%s)\n\nLoaned on %s&quot;) \
+                %(self.person_name, self.widgets['movie']['o_title'].get_text(), \
+                self.widgets['movie']['title'].get_text(), self.loan_date[:10]))
+        except:
+            gutils.error(self, _(&quot;Mail could not be sent. Please check e-mail preferences.&quot;), self.widgets['window'])
+    else:
+        gutils.info(self, _(&quot;This person has no e-mail address defined.&quot;), \
+            self.widgets['window'])

Modified: trunk/lib/gutils.py
===================================================================
--- trunk/lib/gutils.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/gutils.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -25,552 +25,553 @@
 import string
 import os
 try:
-	import gtk
-	import gobject
+    import gtk
+    import gobject
 except:
-	pass
+    pass
 import htmlentitydefs
 import re
 import webbrowser
+import db
 
 url_re = re.compile('^\w+://')
 entity = re.compile(r'\&amp;.\w*?\;')
 html_tags = re.compile(r'\&lt;.*?\&gt;')
 
 def remove_accents(txt, encoding='iso-8859-1'):
-	d = {192: u'A', 193: u'A', 194: u'A', 195: u'A', 196: u'A', 197: u'A',
-			199: u'C', 200: u'E', 201: u'E', 202: u'E', 203: u'E', 204: u'I',
-			205: u'I', 206: u'I', 207: u'I', 209: u'N', 210: u'O', 211: u'O',
-			212: u'O', 213: u'O', 214: u'O', 216: u'O', 217: u'U', 218: u'U',
-			219: u'U', 220: u'U', 221: u'Y', 224: u'a', 225: u'a', 226: u'a',
-			227: u'a', 228: u'a', 229: u'a', 231: u'c', 232: u'e', 233: u'e',
-			234: u'e', 235: u'e', 236: u'i', 237: u'i', 238: u'i', 239: u'i',
-			241: u'n', 242: u'o', 243: u'o', 244: u'o', 245: u'o', 246: u'o',
-			248: u'o', 249: u'u', 250: u'u', 251: u'u', 252: u'u', 253: u'y',
-			255: u'y'}
-	return unicode(txt, encoding).translate(d)
+    d = {192: u'A', 193: u'A', 194: u'A', 195: u'A', 196: u'A', 197: u'A',
+            199: u'C', 200: u'E', 201: u'E', 202: u'E', 203: u'E', 204: u'I',
+            205: u'I', 206: u'I', 207: u'I', 209: u'N', 210: u'O', 211: u'O',
+            212: u'O', 213: u'O', 214: u'O', 216: u'O', 217: u'U', 218: u'U',
+            219: u'U', 220: u'U', 221: u'Y', 224: u'a', 225: u'a', 226: u'a',
+            227: u'a', 228: u'a', 229: u'a', 231: u'c', 232: u'e', 233: u'e',
+            234: u'e', 235: u'e', 236: u'i', 237: u'i', 238: u'i', 239: u'i',
+            241: u'n', 242: u'o', 243: u'o', 244: u'o', 245: u'o', 246: u'o',
+            248: u'o', 249: u'u', 250: u'u', 251: u'u', 252: u'u', 253: u'y',
+            255: u'y'}
+    return unicode(txt, encoding).translate(d)
 
 def is_number(x):
-	return isinstance(x, int)
+    return isinstance(x, int)
 
-def find_next_available(db):
-	&quot;&quot;&quot;
-	finds next available movie number.
-	This is the first empty position.
-	If none is empty then increments the last position.
-	&quot;&quot;&quot;
-	first = 0
+def find_next_available(griffithSql):
+    &quot;&quot;&quot;
+    finds next available movie number.
+    This is the first empty position.
+    If none is empty then increments the last position.
+    &quot;&quot;&quot;
+    first = 0
 
-	movies = db.Movie.query.order_by(db.Movie.c.number.asc()).all()
-	for movie in movies:
-		second = int(movie.number)
-		if second is None:
-			second = 0
-		if (second&gt;first+1):
-			break
-		first = second
+    movies = griffithSql.session.query(db.Movie).order_by(db.movies_table.c.number.asc()).all()
+    for movie in movies:
+        second = int(movie.number)
+        if second is None:
+            second = 0
+        if (second&gt;first+1):
+            break
+        first = second
 
-	if first is None:
-		return 1
-	else:
-		number = first+1
-		return number
+    if first is None:
+        return 1
+    else:
+        number = first+1
+        return number
 
 def trim(text,key1,key2):
-	p1 = string.find(text,key1)
-	if p1 == -1:
-		return &quot;&quot;
-	else:
-		p1 = p1+len(key1)
-	p2 = string.find(text[p1:],key2)
-	if p2 == -1:
-		return &quot;&quot;
-	else:
-		p2 = p1+p2
-	return text[p1:p2]
+    p1 = string.find(text,key1)
+    if p1 == -1:
+        return &quot;&quot;
+    else:
+        p1 = p1+len(key1)
+    p2 = string.find(text[p1:],key2)
+    if p2 == -1:
+        return &quot;&quot;
+    else:
+        p2 = p1+p2
+    return text[p1:p2]
 
 def after(text,key):
-	p1 = string.find(text,key)
-	return text[p1+len(key):]
+    p1 = string.find(text,key)
+    return text[p1+len(key):]
 
 def before(text,key):
-	p1 = string.find(text,key)
-	return text[:p1]
+    p1 = string.find(text,key)
+    return text[:p1]
 
 def gescape(text):
-	text=string.replace(text,&quot;'&quot;, &quot;''&quot;)
-	text=string.replace(text,&quot;--&quot;, &quot;-&quot;)
-	return text
+    text=string.replace(text,&quot;'&quot;, &quot;''&quot;)
+    text=string.replace(text,&quot;--&quot;, &quot;-&quot;)
+    return text
 
 def progress(blocks,size_block,size):
-	transfered = blocks * size_block
-	if size &gt; 0 and transfered &gt; size:
-		transfered = size
-	elif size &lt; 0:
-		size = &quot;?&quot;
-	print transfered, '/', size, 'bytes'
+    transfered = blocks * size_block
+    if size &gt; 0 and transfered &gt; size:
+        transfered = size
+    elif size &lt; 0:
+        size = &quot;?&quot;
+    print transfered, '/', size, 'bytes'
 
 # functions to handle comboboxentry stuff
 
 def set_model_from_list (cb, items):
-	&quot;&quot;&quot;Setup a ComboBox or ComboBoxEntry based on a list of strings.&quot;&quot;&quot;
-	model = gtk.ListStore(str)
-	for i in items:
-		model.append([i])
-	cb.set_model(model)
-	if type(cb) == gtk.ComboBoxEntry:
-		cb.set_text_column(0)
-	elif type(cb) == gtk.ComboBox:
-		cell = gtk.CellRendererText()
-		cb.pack_start(cell, True)
-		cb.add_attribute(cell, 'text', 0)
+    &quot;&quot;&quot;Setup a ComboBox or ComboBoxEntry based on a list of strings.&quot;&quot;&quot;
+    model = gtk.ListStore(str)
+    for i in items:
+        model.append([i])
+    cb.set_model(model)
+    if type(cb) == gtk.ComboBoxEntry:
+        cb.set_text_column(0)
+    elif type(cb) == gtk.ComboBox:
+        cell = gtk.CellRendererText()
+        cb.pack_start(cell, True)
+        cb.add_attribute(cell, 'text', 0)
 
 def on_combo_box_entry_changed(widget):
-	model = widget.get_model()
-	m_iter = widget.get_active_iter()
-	if m_iter:
-		return model.get_value(m_iter, 0)
-	else:
-		return 0
+    model = widget.get_model()
+    m_iter = widget.get_active_iter()
+    if m_iter:
+        return model.get_value(m_iter, 0)
+    else:
+        return 0
 
 def on_combo_box_entry_changed_name(widget):
-	return widget.get_active_text()
+    return widget.get_active_text()
 
 def convert_entities(text):
-	def conv(ents):
-		entities = htmlentitydefs.entitydefs
-		ents = ents.group(0)
-		ent_code = entities.get(ents[1:-1], None)
-		if ent_code:
-			try:
-				ents = unicode(ent_code, 'UTF-8')
-			except UnicodeDecodeError:
-				ents = unicode(ent_code, 'latin-1')
-			except Exception, ex:
-				print(&quot;error occurred while converting entity %s: %s&quot; % (ents, ex))
+    def conv(ents):
+        entities = htmlentitydefs.entitydefs
+        ents = ents.group(0)
+        ent_code = entities.get(ents[1:-1], None)
+        if ent_code:
+            try:
+                ents = unicode(ent_code, 'UTF-8')
+            except UnicodeDecodeError:
+                ents = unicode(ent_code, 'latin-1')
+            except Exception, ex:
+                print(&quot;error occurred while converting entity %s: %s&quot; % (ents, ex))
 
-			# check if it still needs conversion
-			if not entity.search(ents):
-				return ents
+            # check if it still needs conversion
+            if not entity.search(ents):
+                return ents
 
-		if ents[1] == '#':
-			code = ents[2:-1]
-			base = 10
-			if code[0] == 'x':
-				code = code[1:]
-				base = 16
-			return unichr(int(code, base))
-		else:
-			return
+        if ents[1] == '#':
+            code = ents[2:-1]
+            base = 10
+            if code[0] == 'x':
+                code = code[1:]
+                base = 16
+            return unichr(int(code, base))
+        else:
+            return
 
-	in_entity = entity.search(text)
-	if not in_entity:
-		return text
-	else:
-		ctext = in_entity.re.sub(conv, text)
-		return ctext
+    in_entity = entity.search(text)
+    if not in_entity:
+        return text
+    else:
+        ctext = in_entity.re.sub(conv, text)
+        return ctext
 
 def strip_tags(text):
-	if text is None:
-		return ''
-	finished = 0
-	while not finished:
-		finished = 1
-		# check if there is an open tag left
-		start = text.find(&quot;&lt;&quot;)
-		if start &gt;= 0:
-			# if there is, check if the tag gets closed
-			stop = text[start:].find(&quot;&gt;&quot;)
-			if stop &gt;= 0:
-				# if it does, strip it, and continue loop
-				text = text[:start] + text[start+stop+1:]
-				finished = 0
-	return text
+    if text is None:
+        return ''
+    finished = 0
+    while not finished:
+        finished = 1
+        # check if there is an open tag left
+        start = text.find(&quot;&lt;&quot;)
+        if start &gt;= 0:
+            # if there is, check if the tag gets closed
+            stop = text[start:].find(&quot;&gt;&quot;)
+            if stop &gt;= 0:
+                # if it does, strip it, and continue loop
+                text = text[:start] + text[start+stop+1:]
+                finished = 0
+    return text
 
 def save_pixmap(self, pixmap, filename):
-	pixmap.save(filename, &quot;jpeg&quot;, {&quot;quality&quot;:&quot;70&quot;})
+    pixmap.save(filename, &quot;jpeg&quot;, {&quot;quality&quot;:&quot;70&quot;})
 
 def clean(text):
-	t = strip_tags(text)
-	t = string.replace(t, '&nbsp;', ' ')
-	t = string.replace(t, '&#34;', '')
-	t = string.replace(t, '&#160;', ' ')
-	return string.strip(t)
+    t = strip_tags(text)
+    t = string.replace(t, '&nbsp;', ' ')
+    t = string.replace(t, '&#34;', '')
+    t = string.replace(t, '&#160;', ' ')
+    return string.strip(t)
 
 def gdecode(txt, encode):
-	try:
-		return txt.decode(encode)
-	except:
-		return txt
+    try:
+        return txt.decode(encode)
+    except:
+        return txt
 
 # Messages
 
 def error(self, msg, parent=None):
-	dialog = gtk.MessageDialog(parent,
-			gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
-			gtk.MESSAGE_ERROR, gtk.BUTTONS_OK, msg)
-	dialog.set_skip_taskbar_hint(False)
-	dialog.run()
-	dialog.destroy()
+    dialog = gtk.MessageDialog(parent,
+            gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
+            gtk.MESSAGE_ERROR, gtk.BUTTONS_OK, msg)
+    dialog.set_skip_taskbar_hint(False)
+    dialog.run()
+    dialog.destroy()
 
 def urllib_error(msg, parent=None):
-	dialog = gtk.MessageDialog(parent,
-			gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
-			gtk.MESSAGE_ERROR, gtk.BUTTONS_OK, msg)
-	dialog.set_skip_taskbar_hint(False)
-	dialog.run()
-	dialog.destroy()
+    dialog = gtk.MessageDialog(parent,
+            gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
+            gtk.MESSAGE_ERROR, gtk.BUTTONS_OK, msg)
+    dialog.set_skip_taskbar_hint(False)
+    dialog.run()
+    dialog.destroy()
 
 def warning(self, msg, parent=None):
-	dialog = gtk.MessageDialog(parent,
-			gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
-			gtk.MESSAGE_WARNING, gtk.BUTTONS_OK, msg)
-	dialog.set_skip_taskbar_hint(False)
-	dialog.run()
-	dialog.destroy()
+    dialog = gtk.MessageDialog(parent,
+            gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
+            gtk.MESSAGE_WARNING, gtk.BUTTONS_OK, msg)
+    dialog.set_skip_taskbar_hint(False)
+    dialog.run()
+    dialog.destroy()
 
 def info(self, msg, parent=None):
-	dialog = gtk.MessageDialog(parent,
-			gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
-			gtk.MESSAGE_INFO, gtk.BUTTONS_OK, msg)
-	dialog.set_skip_taskbar_hint(False)
-	dialog.run()
-	dialog.destroy()
+    dialog = gtk.MessageDialog(parent,
+            gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
+            gtk.MESSAGE_INFO, gtk.BUTTONS_OK, msg)
+    dialog.set_skip_taskbar_hint(False)
+    dialog.run()
+    dialog.destroy()
 
 def question(self, msg, cancel=1, parent=None):
-	if not parent: parent = self
-	dialog = gtk.MessageDialog(parent,
-			gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
-			gtk.MESSAGE_QUESTION, gtk.BUTTONS_NONE, msg)
-	dialog.add_buttons(gtk.STOCK_YES, gtk.RESPONSE_YES,
-			gtk.STOCK_NO, gtk.RESPONSE_NO)
-	dialog.set_default_response(gtk.RESPONSE_NO)
-	dialog.set_skip_taskbar_hint(False)
-	response = dialog.run()
-	dialog.destroy()
-	return response
+    if not parent: parent = self
+    dialog = gtk.MessageDialog(parent,
+            gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
+            gtk.MESSAGE_QUESTION, gtk.BUTTONS_NONE, msg)
+    dialog.add_buttons(gtk.STOCK_YES, gtk.RESPONSE_YES,
+            gtk.STOCK_NO, gtk.RESPONSE_NO)
+    dialog.set_default_response(gtk.RESPONSE_NO)
+    dialog.set_skip_taskbar_hint(False)
+    response = dialog.run()
+    dialog.destroy()
+    return response
 
 def file_chooser(title, action=None, buttons=None, name=&quot;&quot;, folder=os.path.expanduser(&quot;~&quot;), picture = False):
-	dialog = gtk.FileChooserDialog(title=title, action=action, buttons=buttons)
-	dialog.set_default_response(gtk.RESPONSE_OK)
-	if name:
-		dialog.set_current_name(name)
-	if folder:
-		dialog.set_current_folder(folder)
-	mfilter = gtk.FileFilter()
-	if picture==True:
-		preview = gtk.Image()
-		dialog.set_preview_widget(preview)
-		dialog.connect(&quot;update-preview&quot;, update_preview_cb, preview)
-		mfilter.set_name(_(&quot;Images&quot;))
-		mfilter.add_mime_type(&quot;image/png&quot;)
-		mfilter.add_mime_type(&quot;image/jpeg&quot;)
-		mfilter.add_mime_type(&quot;image/gif&quot;)
-		mfilter.add_pattern(&quot;*.[pP][nN][gG]&quot;)
-		mfilter.add_pattern(&quot;*.[jJ][pP][gG]&quot;)
-		mfilter.add_pattern(&quot;*.[gG][iI][fF]&quot;)
-		mfilter.add_pattern(&quot;*.[tT][iI][fF]&quot;)
-		mfilter.add_pattern(&quot;*.[xX][pP][mM]&quot;)
-		dialog.add_filter(mfilter)
-	mfilter = gtk.FileFilter()
-	mfilter.set_name(_(&quot;All files&quot;))
-	mfilter.add_pattern(&quot;*&quot;)
-	dialog.add_filter(mfilter)
+    dialog = gtk.FileChooserDialog(title=title, action=action, buttons=buttons)
+    dialog.set_default_response(gtk.RESPONSE_OK)
+    if name:
+        dialog.set_current_name(name)
+    if folder:
+        dialog.set_current_folder(folder)
+    mfilter = gtk.FileFilter()
+    if picture==True:
+        preview = gtk.Image()
+        dialog.set_preview_widget(preview)
+        dialog.connect(&quot;update-preview&quot;, update_preview_cb, preview)
+        mfilter.set_name(_(&quot;Images&quot;))
+        mfilter.add_mime_type(&quot;image/png&quot;)
+        mfilter.add_mime_type(&quot;image/jpeg&quot;)
+        mfilter.add_mime_type(&quot;image/gif&quot;)
+        mfilter.add_pattern(&quot;*.[pP][nN][gG]&quot;)
+        mfilter.add_pattern(&quot;*.[jJ][pP][gG]&quot;)
+        mfilter.add_pattern(&quot;*.[gG][iI][fF]&quot;)
+        mfilter.add_pattern(&quot;*.[tT][iI][fF]&quot;)
+        mfilter.add_pattern(&quot;*.[xX][pP][mM]&quot;)
+        dialog.add_filter(mfilter)
+    mfilter = gtk.FileFilter()
+    mfilter.set_name(_(&quot;All files&quot;))
+    mfilter.add_pattern(&quot;*&quot;)
+    dialog.add_filter(mfilter)
 
 
-	response = dialog.run()
-	if response == gtk.RESPONSE_OK:
-		filename = dialog.get_filename()
-	elif response == gtk.RESPONSE_CANCEL:
-		filename = None
-	else:
-		return False
-	path = dialog.get_current_folder()
-	dialog.destroy()
-	return filename, path
+    response = dialog.run()
+    if response == gtk.RESPONSE_OK:
+        filename = dialog.get_filename()
+    elif response == gtk.RESPONSE_CANCEL:
+        filename = None
+    else:
+        return False
+    path = dialog.get_current_folder()
+    dialog.destroy()
+    return filename, path
 
 def update_preview_cb(file_chooser, preview):
-	filename = file_chooser.get_preview_filename()
-	try:
-		pixbuf = gtk.gdk.pixbuf_new_from_file_at_size(filename, 128, 128)
-		preview.set_from_pixbuf(pixbuf)
-		have_preview = True
-	except:
-		have_preview = False
-	file_chooser.set_preview_widget_active(have_preview)
-	return
+    filename = file_chooser.get_preview_filename()
+    try:
+        pixbuf = gtk.gdk.pixbuf_new_from_file_at_size(filename, 128, 128)
+        preview.set_from_pixbuf(pixbuf)
+        have_preview = True
+    except:
+        have_preview = False
+    file_chooser.set_preview_widget_active(have_preview)
+    return
 
 def run_browser(url):
-	webbrowser.register('open', webbrowser.GenericBrowser(&quot;open '%s'&quot;))
-	webbrowser._tryorder.append('open')
-	webbrowser.open(url)
+    webbrowser.register('open', webbrowser.GenericBrowser(&quot;open '%s'&quot;))
+    webbrowser._tryorder.append('open')
+    webbrowser.open(url)
 
 def read_plugins(prefix,directory):
-	&quot;&quot;&quot;returns available plugins&quot;&quot;&quot;
-	import glob
-	return glob.glob(&quot;%s/%s*.py&quot; % (directory,prefix) )
+    &quot;&quot;&quot;returns available plugins&quot;&quot;&quot;
+    import glob
+    return glob.glob(&quot;%s/%s*.py&quot; % (directory,prefix) )
 
 def findKey(val, dict):
-	for key, value in dict.items():
-		if value == val: return key
-	return None
+    for key, value in dict.items():
+        if value == val: return key
+    return None
 
 def garbage(handler):
-	pass
+    pass
 
 def make_thumbnail(self, file_name):
-	source = os.path.join(self.locations['posters'], file_name)
-	if os.path.isfile(source):
-		self.Image.set_from_file(source)
-		pixbuf = self.Image.get_pixbuf()
-		pixbuf = pixbuf.scale_simple(30, 40, 'bilinear')
-		save_pixmap(self, pixbuf, os.path.join(self.locations['posters'], &quot;t_%s&quot;%file_name))
-	else:
-		return 0
+    source = os.path.join(self.locations['posters'], file_name)
+    if os.path.isfile(source):
+        self.Image.set_from_file(source)
+        pixbuf = self.Image.get_pixbuf()
+        pixbuf = pixbuf.scale_simple(30, 40, 'bilinear')
+        save_pixmap(self, pixbuf, os.path.join(self.locations['posters'], &quot;t_%s&quot;%file_name))
+    else:
+        return 0
 
 def make_medium_image(self, file_name):
-	source = os.path.join(self.locations['posters'], file_name)
-	if os.path.isfile(source):
-		self.Image.set_from_file(source)
-		pixbuf = self.Image.get_pixbuf()
-		pixbuf = pixbuf.scale_simple(100, 140, 'bilinear')
-		save_pixmap(self, pixbuf, os.path.join(self.locations['posters'], &quot;m_%s&quot;%file_name))
-	else:
-		return 0
+    source = os.path.join(self.locations['posters'], file_name)
+    if os.path.isfile(source):
+        self.Image.set_from_file(source)
+        pixbuf = self.Image.get_pixbuf()
+        pixbuf = pixbuf.scale_simple(100, 140, 'bilinear')
+        save_pixmap(self, pixbuf, os.path.join(self.locations['posters'], &quot;m_%s&quot;%file_name))
+    else:
+        return 0
 
 def clean_posters_dir(self):
-	posters_dir = self.locations['posters']
+    posters_dir = self.locations['posters']
 
-	counter = 0
+    counter = 0
 
-	for files in os.walk(posters_dir):
-		for names in files:
-			for name in names:
-				if name.startswith('poster'):
-					# lets check if this poster is orphan
-					used = self.db.Movie.query.count_by(image=string.replace(name,&quot;.jpg&quot;,&quot;&quot;))
-					if not used:
-						counter += 1
-						os.unlink(os.path.join(posters_dir, name))
-						m_file = os.path.join(posters_dir, &quot;m_&quot;+name)
-						if os.path.isfile(m_file):
-							os.unlink(m_file)
-						t_file = os.path.join(posters_dir, &quot;t_&quot;+name)
-						if os.path.isfile(t_file):
-							os.unlink(t_file)
+    for files in os.walk(posters_dir):
+        for names in files:
+            for name in names:
+                if name.startswith('poster'):
+                    # lets check if this poster is orphan
+                    used = self.db.session.query(db.Movie).count_by(image=string.replace(name,&quot;.jpg&quot;,&quot;&quot;))
+                    if not used:
+                        counter += 1
+                        os.unlink(os.path.join(posters_dir, name))
+                        m_file = os.path.join(posters_dir, &quot;m_&quot;+name)
+                        if os.path.isfile(m_file):
+                            os.unlink(m_file)
+                        t_file = os.path.join(posters_dir, &quot;t_&quot;+name)
+                        if os.path.isfile(t_file):
+                            os.unlink(t_file)
 
-	if counter:
-		print &quot;%d orphan files cleaned.&quot;%counter
-	else:
-		print &quot;No orphan files found.&quot;
+    if counter:
+        print &quot;%d orphan files cleaned.&quot;%counter
+    else:
+        print &quot;No orphan files found.&quot;
 
 def decompress(data):
-	import gzip, StringIO
-	try:
-		compressedStream = StringIO.StringIO(data)
-		gzipper = gzip.GzipFile(fileobj=compressedStream)
-		data = gzipper.read()
-	except:
-		pass
-	return data
+    import gzip, StringIO
+    try:
+        compressedStream = StringIO.StringIO(data)
+        gzipper = gzip.GzipFile(fileobj=compressedStream)
+        data = gzipper.read()
+    except:
+        pass
+    return data
 
 def get_dependencies():
-	depend = []
-	try:
-		import gtk
-		version	= '.'.join([str(i) for i in gtk.pygtk_version])
-		if gtk.pygtk_version &lt;= (2, 6, 0):
-			version = '-%s' % version
-	except:
-		version = False
-	depend.append({'module': 'gtk',
-		'version'	: version,
-		'module_req'	: '2.6',
-		'url'		: '<A HREF="http://www.pygtk.org/">http://www.pygtk.org/</A>',
-		'debian'	: 'python-gtk2',
-		'debian_req'	: '2.8.6-1'
-		# TODO: 'fedora', 'suse', etc.
-	})
-	try:
-		import gtk.glade
-		# (version == gtk.pygtk_version)
-	except:
-		version = False
-	depend.append({'module': 'gtk.glade',
-		'version'	: version,
-		'module_req'	: '2.6',
-		'url'		: '<A HREF="http://www.pygtk.org/">http://www.pygtk.org/</A>',
-		'debian'	: 'python-glade2',
-		'debian_req'	: '2.8.6-1'
-	})
-	try:
-		import sqlalchemy
-		version = True
-	except:
-		version = False
-	depend.append({'module': 'sqlalchemy',
-		'version'	: version,
-		'module_req'	: '0.4',
-		'url'		: '<A HREF="http://www.sqlalchemy.org/">http://www.sqlalchemy.org/</A>',
-		'debian'	: 'python-sqlalchemy',
-		'debian_req'	: '0.4.0-1'
-	})
-	try:
-		import sqlite3
-		version = sqlite3.version
-	except ImportError:
-		version = False
-	if version is False:
-		try:
-			import pysqlite2
-			version = True
-		except:
-			version = False
-		depend.append({'module': 'pysqlite2',
-			'version'	: version,
-			'url'		: '<A HREF="http://initd.org/tracker/pysqlite">http://initd.org/tracker/pysqlite</A>',
-			'debian'	: 'python-pysqlite2',
-			'debian_req'	: '2.3.0-1'
-		})
-	else:
-		depend.append({'module': 'sqlite3',
-			'version'	: version,
-			'url'		: '<A HREF="http://www.python.org">http://www.python.org</A>',
-			'debian'	: 'python',
-			'debian_req'	: '2.5'
-		})
-	try:
-		import reportlab
-		version = reportlab.Version
-	except:
-		version = False
-	depend.append({'module': 'reportlab',
-		'version'	: version,
-		'url'		: '<A HREF="http://www.reportlab.org/">http://www.reportlab.org/</A>',
-		'debian'	: 'python-reportlab',
-		'debian_req'	: '1.20debian-6'
-	})
-	try:
-		import PIL
-		version = True
-	except:
-		version = False
-	depend.append({'module': 'PIL',
-		'version'	: version,
-		'url'		: '<A HREF="http://www.pythonware.com/products/pil/">http://www.pythonware.com/products/pil/</A>',
-		'debian'	: 'python-imaging',
-		'debian_req'	: '1.1.5-6'
-	})
-	try:
-		import xml
-		version = xml.__version__
-	except:
-		version = False
-	depend.append({'module': 'xml',
-		'version'	: version,
-		'url'		: '<A HREF="http://pyxml.sf.net/">http://pyxml.sf.net/</A>',
-		'debian'	: 'python-xml'
-	})
-	# extra dependencies:
-	optional = []
-	try:
-		import psycopg2
-		version = psycopg2.__version__
-	except:
-		version = False
-	optional.append({'module': 'psycopg2',
-		'version'	: version,
-		'url'		: '<A HREF="http://initd.org/tracker/psycopg/wiki/PsycopgTwo">http://initd.org/tracker/psycopg/wiki/PsycopgTwo</A>',
-		'debian'	: 'python-psycopg2',
-		'debian_req'	: '1.1.21-6'
-	})
-	try:
-		import MySQLdb
-		version	= '.'.join([str(i) for i in MySQLdb.version_info])
-	except:
-		version = False
-	optional.append({'module': 'MySQLdb',
-		'version'	: version,
-		'url'		: '<A HREF="http://sourceforge.net/projects/mysql-python">http://sourceforge.net/projects/mysql-python</A>',
-		'debian'	: 'python-mysqldb',
-		'debian_req'	: '1.2.1-p2-2'
-	})
-	try:
-		import chardet
-		version	= chardet.__version__
-	except:
-		version = False
-	optional.append({'module': 'chardet',
-		'version'	: version,
-		'url'		: '<A HREF="http://chardet.feedparser.org/">http://chardet.feedparser.org/</A>',
-		'debian'	: 'python-chardet'
-	})
-	try:
-		import sqlite
-		version	= sqlite.version
-	except:
-		version = False
-	optional.append({'module': 'sqlite',
-		'version'	: version,
-		'url'		: '<A HREF="http://initd.org/tracker/pysqlite">http://initd.org/tracker/pysqlite</A>',
-		'debian'	: 'python-sqlite'
-	})
-	return depend, optional
+    depend = []
+    try:
+        import gtk
+        version    = '.'.join([str(i) for i in gtk.pygtk_version])
+        if gtk.pygtk_version &lt;= (2, 6, 0):
+            version = '-%s' % version
+    except:
+        version = False
+    depend.append({'module': 'gtk',
+        'version'    : version,
+        'module_req'    : '2.6',
+        'url'        : '<A HREF="http://www.pygtk.org/">http://www.pygtk.org/</A>',
+        'debian'    : 'python-gtk2',
+        'debian_req'    : '2.8.6-1'
+        # TODO: 'fedora', 'suse', etc.
+    })
+    try:
+        import gtk.glade
+        # (version == gtk.pygtk_version)
+    except:
+        version = False
+    depend.append({'module': 'gtk.glade',
+        'version'    : version,
+        'module_req'    : '2.6',
+        'url'        : '<A HREF="http://www.pygtk.org/">http://www.pygtk.org/</A>',
+        'debian'    : 'python-glade2',
+        'debian_req'    : '2.8.6-1'
+    })
+    try:
+        import sqlalchemy
+        version = True
+    except:
+        version = False
+    depend.append({'module': 'sqlalchemy',
+        'version'    : version,
+        'module_req'    : '0.4',
+        'url'        : '<A HREF="http://www.sqlalchemy.org/">http://www.sqlalchemy.org/</A>',
+        'debian'    : 'python-sqlalchemy',
+        'debian_req'    : '0.4.0-1'
+    })
+    try:
+        import sqlite3
+        version = sqlite3.version
+    except ImportError:
+        version = False
+    if version is False:
+        try:
+            import pysqlite2
+            version = True
+        except:
+            version = False
+        depend.append({'module': 'pysqlite2',
+            'version'    : version,
+            'url'        : '<A HREF="http://initd.org/tracker/pysqlite">http://initd.org/tracker/pysqlite</A>',
+            'debian'    : 'python-pysqlite2',
+            'debian_req'    : '2.3.0-1'
+        })
+    else:
+        depend.append({'module': 'sqlite3',
+            'version'    : version,
+            'url'        : '<A HREF="http://www.python.org">http://www.python.org</A>',
+            'debian'    : 'python',
+            'debian_req'    : '2.5'
+        })
+    try:
+        import reportlab
+        version = reportlab.Version
+    except:
+        version = False
+    depend.append({'module': 'reportlab',
+        'version'    : version,
+        'url'        : '<A HREF="http://www.reportlab.org/">http://www.reportlab.org/</A>',
+        'debian'    : 'python-reportlab',
+        'debian_req'    : '1.20debian-6'
+    })
+    try:
+        import PIL
+        version = True
+    except:
+        version = False
+    depend.append({'module': 'PIL',
+        'version'    : version,
+        'url'        : '<A HREF="http://www.pythonware.com/products/pil/">http://www.pythonware.com/products/pil/</A>',
+        'debian'    : 'python-imaging',
+        'debian_req'    : '1.1.5-6'
+    })
+    try:
+        import xml
+        version = xml.__version__
+    except:
+        version = False
+    depend.append({'module': 'xml',
+        'version'    : version,
+        'url'        : '<A HREF="http://pyxml.sf.net/">http://pyxml.sf.net/</A>',
+        'debian'    : 'python-xml'
+    })
+    # extra dependencies:
+    optional = []
+    try:
+        import psycopg2
+        version = psycopg2.__version__
+    except:
+        version = False
+    optional.append({'module': 'psycopg2',
+        'version'    : version,
+        'url'        : '<A HREF="http://initd.org/tracker/psycopg/wiki/PsycopgTwo">http://initd.org/tracker/psycopg/wiki/PsycopgTwo</A>',
+        'debian'    : 'python-psycopg2',
+        'debian_req'    : '1.1.21-6'
+    })
+    try:
+        import MySQLdb
+        version    = '.'.join([str(i) for i in MySQLdb.version_info])
+    except:
+        version = False
+    optional.append({'module': 'MySQLdb',
+        'version'    : version,
+        'url'        : '<A HREF="http://sourceforge.net/projects/mysql-python">http://sourceforge.net/projects/mysql-python</A>',
+        'debian'    : 'python-mysqldb',
+        'debian_req'    : '1.2.1-p2-2'
+    })
+    try:
+        import chardet
+        version    = chardet.__version__
+    except:
+        version = False
+    optional.append({'module': 'chardet',
+        'version'    : version,
+        'url'        : '<A HREF="http://chardet.feedparser.org/">http://chardet.feedparser.org/</A>',
+        'debian'    : 'python-chardet'
+    })
+    try:
+        import sqlite
+        version    = sqlite.version
+    except:
+        version = False
+    optional.append({'module': 'sqlite',
+        'version'    : version,
+        'url'        : '<A HREF="http://initd.org/tracker/pysqlite">http://initd.org/tracker/pysqlite</A>',
+        'debian'    : 'python-sqlite'
+    })
+    return depend, optional
 
 
 def html_encode(s):
-	if not isinstance(s, str):
-		s = str(s)
-	s = s.replace('&amp;', '&amp;')
-	s = s.replace('&lt;', '&lt;')
-	s = s.replace('&gt;', '&gt;')
-	s = s.replace('&quot;', '&quot;')
-	return s
+    if not isinstance(s, str):
+        s = str(s)
+    s = s.replace('&amp;', '&amp;')
+    s = s.replace('&lt;', '&lt;')
+    s = s.replace('&gt;', '&gt;')
+    s = s.replace('&quot;', '&quot;')
+    return s
 
 def digits_only(s, maximum=None):
-	if s is None:
-		return 0
-	import string, re
-	match = re.compile(r&quot;\d+&quot;)
-	a = match.findall(str(s))
-	if len(a):
-		s = int(a[0])
-	else:
-		s = 0
-	if maximum is None:
-		return s
-	else:
-		if s &gt; maximum:
-			return maximum
-		else:
-			return s
+    if s is None:
+        return 0
+    import string, re
+    match = re.compile(r&quot;\d+&quot;)
+    a = match.findall(str(s))
+    if len(a):
+        s = int(a[0])
+    else:
+        s = 0
+    if maximum is None:
+        return s
+    else:
+        if s &gt; maximum:
+            return maximum
+        else:
+            return s
 
 def copytree(src, dst, symlinks=False):
-	&quot;&quot;&quot;Recursively copy a directory tree using copy2().
+    &quot;&quot;&quot;Recursively copy a directory tree using copy2().
 
-	This is shutil's copytree modified version
-	&quot;&quot;&quot;
-	from shutil import copy2
-	names = os.listdir(src)
-	if not os.path.isdir(dst):
-		os.mkdir(dst)
-	errors = []
-	for name in names:
-		srcname = os.path.join(src, name)
-		dstname = os.path.join(dst, name)
-		try:
-			if symlinks and os.path.islink(srcname):
-				linkto = os.readlink(srcname)
-				os.symlink(linkto, dstname)
-			elif os.path.isdir(srcname):
-				copytree(srcname, dstname, symlinks)
-			else:
-				copy2(srcname, dstname)
-		except (IOError, os.error), why:
-			errors.append((srcname, dstname, why))
-		# catch the Error from the recursive copytree so that we can
-		# continue with other files
-		except EnvironmentError, err:
-			errors.extend(err.args[0])
-	if errors:
-		raise EnvironmentError, errors
+    This is shutil's copytree modified version
+    &quot;&quot;&quot;
+    from shutil import copy2
+    names = os.listdir(src)
+    if not os.path.isdir(dst):
+        os.mkdir(dst)
+    errors = []
+    for name in names:
+        srcname = os.path.join(src, name)
+        dstname = os.path.join(dst, name)
+        try:
+            if symlinks and os.path.islink(srcname):
+                linkto = os.readlink(srcname)
+                os.symlink(linkto, dstname)
+            elif os.path.isdir(srcname):
+                copytree(srcname, dstname, symlinks)
+            else:
+                copy2(srcname, dstname)
+        except (IOError, os.error), why:
+            errors.append((srcname, dstname, why))
+        # catch the Error from the recursive copytree so that we can
+        # continue with other files
+        except EnvironmentError, err:
+            errors.extend(err.args[0])
+    if errors:
+        raise EnvironmentError, errors

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/initialize.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -32,900 +32,901 @@
 import re
 from gettext import gettext as _
 from locale import getdefaultlocale
+import db
 
 try:
-	import gtkspell
-	spell_support = 1
+    import gtkspell
+    spell_support = 1
 except:
-	spell_support = 0
+    spell_support = 0
 
 def locations(self):
-	defaultLang, defaultEnc = getdefaultlocale()
-	if defaultEnc is None:
-		defaultEnc = 'UTF-8'
-	locations = {}
-	locations['exec'] = os.path.abspath(os.path.dirname(sys.argv[0])) # deprecated
-	locations['lib']  = os.path.dirname(__file__)
-	
-	if os.name == 'nt' or os.name.startswith('win'): # win32, win64
-		import winshell
-		from win32com.shell import shellcon, shell
-		import shutil
-		
-		mydocs = winshell.my_documents()
-		locations['movie_plugins']  = &quot;%s\\lib\\plugins\\movie&quot; % locations['exec']
-		locations['export_plugins'] = &quot;%s\\lib\\plugins\\export&quot; % locations['exec']
-		locations['images']         = &quot;%s\\images&quot; % locations['exec']
-		locations['share']          = locations['images']
-		locations['glade']          = &quot;%s\\glade\\&quot; % locations['exec']
-		locations['desktop']        = ''
-		locations['i18n']           = &quot;%s\\i18n&quot; % locations['exec']
-		os.environ['PATH'] += &quot;;lib;&quot;
-		
-		# griffith dir location should point to 'Application Data'
-		# this is changed on 0.9.5+svn so we need to make it backward compatible
-		if os.path.exists(os.path.join(mydocs, 'griffith').decode(defaultEnc)):
-			shutil.move(os.path.join(mydocs, 'griffith').decode(defaultEnc),os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc))
-		locations['home']           = os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc)
-		
-		# windows hack for locale setting
-		lang = os.getenv('LANG')
-		if lang is None:
-			if defaultLang:
-				lang = defaultLang
-		if lang:
-			os.environ['LANG'] = lang
+    defaultLang, defaultEnc = getdefaultlocale()
+    if defaultEnc is None:
+        defaultEnc = 'UTF-8'
+    locations = {}
+    locations['exec'] = os.path.abspath(os.path.dirname(sys.argv[0])) # deprecated
+    locations['lib']  = os.path.dirname(__file__)
+    
+    if os.name == 'nt' or os.name.startswith('win'): # win32, win64
+        import winshell
+        from win32com.shell import shellcon, shell
+        import shutil
+        
+        mydocs = winshell.my_documents()
+        locations['movie_plugins']  = &quot;%s\\lib\\plugins\\movie&quot; % locations['exec']
+        locations['export_plugins'] = &quot;%s\\lib\\plugins\\export&quot; % locations['exec']
+        locations['images']         = &quot;%s\\images&quot; % locations['exec']
+        locations['share']          = locations['images']
+        locations['glade']          = &quot;%s\\glade\\&quot; % locations['exec']
+        locations['desktop']        = ''
+        locations['i18n']           = &quot;%s\\i18n&quot; % locations['exec']
+        os.environ['PATH'] += &quot;;lib;&quot;
+        
+        # griffith dir location should point to 'Application Data'
+        # this is changed on 0.9.5+svn so we need to make it backward compatible
+        if os.path.exists(os.path.join(mydocs, 'griffith').decode(defaultEnc)):
+            shutil.move(os.path.join(mydocs, 'griffith').decode(defaultEnc),os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc))
+        locations['home']           = os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc)
+        
+        # windows hack for locale setting
+        lang = os.getenv('LANG')
+        if lang is None:
+            if defaultLang:
+                lang = defaultLang
+        if lang:
+            os.environ['LANG'] = lang
 
-	elif os.name == 'posix':
-		locations['home']  = os.path.join(os.path.expanduser('~'), '.griffith').decode(defaultEnc)
-		locations['share'] = os.path.abspath(os.path.join(locations['lib'], '..'))
-		locations['glade'] = os.path.join(locations['share'], 'glade')
-		locations['i18n']  = os.path.abspath(os.path.join(locations['share'], '..', 'locale'))
-		if not os.path.isdir(locations['i18n']):
-			locations['i18n'] = os.path.join(locations['share'], 'i18n')
-		#some locations
-		locations['movie_plugins']  = os.path.join(locations['lib'], 'plugins', 'movie')
-		locations['export_plugins'] = os.path.join(locations['lib'], 'plugins', 'export')
-		locations['images']  = os.path.join(locations['share'], 'images')
-		locations['desktop'] = os.path.join(os.path.expanduser('~'), 'Desktop').decode(defaultEnc)
-	else:
-		print 'Operating system not supported'
-		sys.exit()
-	
-	from tempfile import gettempdir
-	locations['temp'] = gettempdir()
-	
-	if self._tmp_home is not None: # see gconsole.check_args
-		locations['home'] = self._tmp_home.decode(defaultEnc)
-		del self._tmp_home
+    elif os.name == 'posix':
+        locations['home']  = os.path.join(os.path.expanduser('~'), '.griffith').decode(defaultEnc)
+        locations['share'] = os.path.abspath(os.path.join(locations['lib'], '..'))
+        locations['glade'] = os.path.join(locations['share'], 'glade')
+        locations['i18n']  = os.path.abspath(os.path.join(locations['share'], '..', 'locale'))
+        if not os.path.isdir(locations['i18n']):
+            locations['i18n'] = os.path.join(locations['share'], 'i18n')
+        #some locations
+        locations['movie_plugins']  = os.path.join(locations['lib'], 'plugins', 'movie')
+        locations['export_plugins'] = os.path.join(locations['lib'], 'plugins', 'export')
+        locations['images']  = os.path.join(locations['share'], 'images')
+        locations['desktop'] = os.path.join(os.path.expanduser('~'), 'Desktop').decode(defaultEnc)
+    else:
+        print 'Operating system not supported'
+        sys.exit()
+    
+    from tempfile import gettempdir
+    locations['temp'] = gettempdir()
+    
+    if self._tmp_home is not None: # see gconsole.check_args
+        locations['home'] = self._tmp_home.decode(defaultEnc)
+        del self._tmp_home
 
-	try:
-		if not os.path.exists(locations['home']):
-			self.debug.show('Creating %s' % locations['home'])
-			os.makedirs(locations['home'])
-		else:
-			self.debug.show(&quot;Using Griffith directory: %s&quot; % locations['home'])
-	except OSError:
-		self.debug.show('Unable to create griffith directory.')
-		raise
-		sys.exit()
+    try:
+        if not os.path.exists(locations['home']):
+            self.debug.show('Creating %s' % locations['home'])
+            os.makedirs(locations['home'])
+        else:
+            self.debug.show(&quot;Using Griffith directory: %s&quot; % locations['home'])
+    except OSError:
+        self.debug.show('Unable to create griffith directory.')
+        raise
+        sys.exit()
 
-	if not os.access(locations['home'], os.W_OK):
-		self.debug.show('Cannot write to griffith directory, %s' % locations['home'])
-		sys.exit()
+    if not os.access(locations['home'], os.W_OK):
+        self.debug.show('Cannot write to griffith directory, %s' % locations['home'])
+        sys.exit()
 
-	# includes plugins in system path for easier importing
-	sys.path.append(locations['lib'])
-	sys.path.append(locations['movie_plugins'])
-	sys.path.append(locations['export_plugins'])
-	
-	self.locations = locations
-	return locations
+    # includes plugins in system path for easier importing
+    sys.path.append(locations['lib'])
+    sys.path.append(locations['movie_plugins'])
+    sys.path.append(locations['export_plugins'])
+    
+    self.locations = locations
+    return locations
 
 def location_posters(locations, config):
-	if config.get('posters', None) is not None:
-		locations['posters']  = os.path.join(locations['home'], config.get('posters'))
-	elif config.get('type', 'sqlite', section='database') == 'sqlite':
-		dbname = config.get('name', 'griffith', section='database')
-		if dbname != 'griffith':
-			config['posters'] = 'posters_sqlite_' + dbname
-		else:
-			config['posters'] = 'posters'
-		locations['posters'] = os.path.join(locations['home'], config.get('posters'))
-		config.save()
-	else:
-		config['posters'] = &quot;posters_%(type)s_%(host)s_%(port)s_%(name)s_%(user)s&quot; % config.toDict('database')
-		locations['posters'] = os.path.join(locations['home'], config.get('posters'))
-		config.save()
-	# check if posters dir exists
-	if not os.path.isdir(locations['posters']):
-		os.makedirs(locations['posters'])
+    if config.get('posters', None) is not None:
+        locations['posters']  = os.path.join(locations['home'], config.get('posters'))
+    elif config.get('type', 'sqlite', section='database') == 'sqlite':
+        dbname = config.get('name', 'griffith', section='database')
+        if dbname != 'griffith':
+            config['posters'] = 'posters_sqlite_' + dbname
+        else:
+            config['posters'] = 'posters'
+        locations['posters'] = os.path.join(locations['home'], config.get('posters'))
+        config.save()
+    else:
+        config['posters'] = &quot;posters_%(type)s_%(host)s_%(port)s_%(name)s_%(user)s&quot; % config.toDict('database')
+        locations['posters'] = os.path.join(locations['home'], config.get('posters'))
+        config.save()
+    # check if posters dir exists
+    if not os.path.isdir(locations['posters']):
+        os.makedirs(locations['posters'])
 
 def gui(self):
-	self._ = None
-	self.debug.show(&quot;running on %s - %s&quot; % (os.name, platform.system()))
-	if os.name == 'nt' or os.name.startswith('win'):
-		self.windows = True
-	else:
-		self.windows = False
-		
-	if platform.system() == 'Darwin':
-		self.mac = True
-	else:
-		self.mac = False
-	
-	self.griffith_dir = self.locations['home']	# deprecated
-	
-	if self.windows:
-		gtk.rc_parse('%s\\gtkrc' % self.locations['exec'])
+    self._ = None
+    self.debug.show(&quot;running on %s - %s&quot; % (os.name, platform.system()))
+    if os.name == 'nt' or os.name.startswith('win'):
+        self.windows = True
+    else:
+        self.windows = False
+        
+    if platform.system() == 'Darwin':
+        self.mac = True
+    else:
+        self.mac = False
+    
+    self.griffith_dir = self.locations['home']    # deprecated
+    
+    if self.windows:
+        gtk.rc_parse('%s\\gtkrc' % self.locations['exec'])
 
 
-	gf = os.path.join(self.locations['glade'], 'griffith.glade')
-	from widgets import define_widgets
-	define_widgets(self, gtk.glade.XML(gf))
+    gf = os.path.join(self.locations['glade'], 'griffith.glade')
+    from widgets import define_widgets
+    define_widgets(self, gtk.glade.XML(gf))
 
-	self.pdf_reader = self.config.get('pdf_reader')
+    self.pdf_reader = self.config.get('pdf_reader')
 
 def i18n(self, location):
-	gettext.bindtextdomain('griffith', location)
-	gettext.textdomain('griffith')
-	gtk.glade.bindtextdomain('griffith', location)
-	gtk.glade.textdomain('griffith')
+    gettext.bindtextdomain('griffith', location)
+    gettext.textdomain('griffith')
+    gtk.glade.bindtextdomain('griffith', location)
+    gtk.glade.textdomain('griffith')
 
 def toolbar(self):
-	&quot;&quot;&quot;if toolbar is hide in config lets hide the widget&quot;&quot;&quot;
-	if not self.config.get('view_toolbar', 'True', section='window'):
-		self.widgets['toolbar'].hide()
-		self.widgets['menu']['toolbar'].set_active(False)
+    &quot;&quot;&quot;if toolbar is hide in config lets hide the widget&quot;&quot;&quot;
+    if not self.config.get('view_toolbar', 'True', section='window'):
+        self.widgets['toolbar'].hide()
+        self.widgets['menu']['toolbar'].set_active(False)
 
 def treeview(self):
-	self.treemodel = gtk.TreeStore(str, gtk.gdk.Pixbuf, str, str, str, str, bool, str, str)
-	self.widgets['treeview'].set_model(self.treemodel)
-	self.widgets['treeview'].set_headers_visible(True)
-	# number column
-	renderer=gtk.CellRendererText()
-	self.number_column=gtk.TreeViewColumn(_('N.'), renderer, text=0)
-	self.number_column.set_resizable(True)
-	self.number_column.set_sort_column_id(0)
-	self.number_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.number_column)
-	# pic column
-	renderer=gtk.CellRendererPixbuf()
-	self.image_column=gtk.TreeViewColumn(_('Image'), renderer, pixbuf=1)
-	self.image_column.set_resizable(False)
-	self.image_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.image_column)
-	# original title column
-	renderer=gtk.CellRendererText()
-	self.otitle_column=gtk.TreeViewColumn(_('Original Title'), renderer, text=2)
-	self.otitle_column.set_resizable(True)
-	self.otitle_column.set_sort_column_id(2)
-	self.otitle_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.otitle_column)
-	# title column
-	renderer=gtk.CellRendererText()
-	self.title_column=gtk.TreeViewColumn(_('Title'), renderer, text=3)
-	self.title_column.set_resizable(True)
-	self.title_column.set_sort_column_id(3)
-	self.title_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.title_column)
-	# director column
-	renderer=gtk.CellRendererText()
-	self.director_column=gtk.TreeViewColumn(_('Director'), renderer, text=4)
-	self.director_column.set_sort_column_id(4)
-	self.director_column.set_resizable(True)
-	self.director_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.director_column)
-	# genre column
-	renderer=gtk.CellRendererText()
-	self.genre_column=gtk.TreeViewColumn(_('Genre'), renderer, text=5)
-	self.genre_column.set_sort_column_id(5)
-	self.genre_column.set_resizable(True)
-	self.genre_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.genre_column)
-	# seen column
-	renderer=gtk.CellRendererToggle()
-	self.seen_column=gtk.TreeViewColumn(_('Seen it'), renderer, active=6)
-	self.seen_column.set_sort_column_id(6)
-	self.seen_column.set_resizable(True)
-	self.seen_column.set_reorderable(True)
-	self.widgets['treeview'].insert_column(self.seen_column, 1)
-	# year column
-	renderer=gtk.CellRendererText()
-	renderer.set_property('xalign', 0.5)
-	self.year_column=gtk.TreeViewColumn(_('Year'), renderer, text=7)
-	self.year_column.set_sort_column_id(7)
-	self.year_column.set_resizable(True)
-	self.year_column.set_alignment(0.5)
-	self.year_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.year_column)
-	# runtime column
-	renderer=gtk.CellRendererText()
-	renderer.set_property('xalign', 1)
-	self.runtime_column=gtk.TreeViewColumn(_('Runtime'), renderer, text=8)
-	self.runtime_column.set_sort_column_id(8)
-	self.runtime_column.set_resizable(True)
-	self.runtime_column.set_alignment(1)
-	self.runtime_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.runtime_column)
-	# rating column
-	renderer=gtk.CellRendererText()
-	renderer.set_property('xalign', 0.5)
-	self.rating_column=gtk.TreeViewColumn(_('Rating'), renderer, text=9)
-	self.rating_column.set_sort_column_id(9)
-	self.rating_column.set_resizable(True)
-	self.rating_column.set_alignment(0.5)
-	self.rating_column.set_reorderable(True)
-	self.widgets['treeview'].append_column(self.rating_column)
-	# reflect saved column order
-	columnorder = self.config.get('columnorder', None, section='mainlist')
-	if not columnorder is None:
-		currentcol = None
-		columnordersplitted = re.split('[ \t]*,[ \t]*', columnorder)
-		for col in columnordersplitted:
-			if col == 'number':
-				self.widgets['treeview'].move_column_after(self.number_column, currentcol)
-				currentcol = self.number_column
-			elif col == 'image':
-				self.widgets['treeview'].move_column_after(self.image_column, currentcol)
-				currentcol = self.image_column
-			elif col == 'otitle':
-				self.widgets['treeview'].move_column_after(self.otitle_column, currentcol)
-				currentcol = self.otitle_column
-			elif col == 'title':
-				self.widgets['treeview'].move_column_after(self.title_column, currentcol)
-				currentcol = self.title_column
-			elif col == 'director':
-				self.widgets['treeview'].move_column_after(self.director_column, currentcol)
-				currentcol = self.director_column
-			elif col == 'genre':
-				self.widgets['treeview'].move_column_after(self.genre_column, currentcol)
-				currentcol = self.genre_column
-			elif col == 'seen':
-				self.widgets['treeview'].move_column_after(self.seen_column, currentcol)
-				currentcol = self.seen_column
-			elif col == 'year':
-				self.widgets['treeview'].move_column_after(self.year_column, currentcol)
-				currentcol = self.year_column
-			elif col == 'runtime':
-				self.widgets['treeview'].move_column_after(self.runtime_column, currentcol)
-				currentcol = self.runtime_column
-			elif col == 'rating':
-				self.widgets['treeview'].move_column_after(self.rating_column, currentcol)
-				currentcol = self.rating_column
-	# add data to treeview
-	self.total = int(self.db.Movie.query.count())
-	self.widgets['treeview'].show()
+    self.treemodel = gtk.TreeStore(str, gtk.gdk.Pixbuf, str, str, str, str, bool, str, str)
+    self.widgets['treeview'].set_model(self.treemodel)
+    self.widgets['treeview'].set_headers_visible(True)
+    # number column
+    renderer=gtk.CellRendererText()
+    self.number_column=gtk.TreeViewColumn(_('N.'), renderer, text=0)
+    self.number_column.set_resizable(True)
+    self.number_column.set_sort_column_id(0)
+    self.number_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.number_column)
+    # pic column
+    renderer=gtk.CellRendererPixbuf()
+    self.image_column=gtk.TreeViewColumn(_('Image'), renderer, pixbuf=1)
+    self.image_column.set_resizable(False)
+    self.image_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.image_column)
+    # original title column
+    renderer=gtk.CellRendererText()
+    self.otitle_column=gtk.TreeViewColumn(_('Original Title'), renderer, text=2)
+    self.otitle_column.set_resizable(True)
+    self.otitle_column.set_sort_column_id(2)
+    self.otitle_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.otitle_column)
+    # title column
+    renderer=gtk.CellRendererText()
+    self.title_column=gtk.TreeViewColumn(_('Title'), renderer, text=3)
+    self.title_column.set_resizable(True)
+    self.title_column.set_sort_column_id(3)
+    self.title_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.title_column)
+    # director column
+    renderer=gtk.CellRendererText()
+    self.director_column=gtk.TreeViewColumn(_('Director'), renderer, text=4)
+    self.director_column.set_sort_column_id(4)
+    self.director_column.set_resizable(True)
+    self.director_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.director_column)
+    # genre column
+    renderer=gtk.CellRendererText()
+    self.genre_column=gtk.TreeViewColumn(_('Genre'), renderer, text=5)
+    self.genre_column.set_sort_column_id(5)
+    self.genre_column.set_resizable(True)
+    self.genre_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.genre_column)
+    # seen column
+    renderer=gtk.CellRendererToggle()
+    self.seen_column=gtk.TreeViewColumn(_('Seen it'), renderer, active=6)
+    self.seen_column.set_sort_column_id(6)
+    self.seen_column.set_resizable(True)
+    self.seen_column.set_reorderable(True)
+    self.widgets['treeview'].insert_column(self.seen_column, 1)
+    # year column
+    renderer=gtk.CellRendererText()
+    renderer.set_property('xalign', 0.5)
+    self.year_column=gtk.TreeViewColumn(_('Year'), renderer, text=7)
+    self.year_column.set_sort_column_id(7)
+    self.year_column.set_resizable(True)
+    self.year_column.set_alignment(0.5)
+    self.year_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.year_column)
+    # runtime column
+    renderer=gtk.CellRendererText()
+    renderer.set_property('xalign', 1)
+    self.runtime_column=gtk.TreeViewColumn(_('Runtime'), renderer, text=8)
+    self.runtime_column.set_sort_column_id(8)
+    self.runtime_column.set_resizable(True)
+    self.runtime_column.set_alignment(1)
+    self.runtime_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.runtime_column)
+    # rating column
+    renderer=gtk.CellRendererText()
+    renderer.set_property('xalign', 0.5)
+    self.rating_column=gtk.TreeViewColumn(_('Rating'), renderer, text=9)
+    self.rating_column.set_sort_column_id(9)
+    self.rating_column.set_resizable(True)
+    self.rating_column.set_alignment(0.5)
+    self.rating_column.set_reorderable(True)
+    self.widgets['treeview'].append_column(self.rating_column)
+    # reflect saved column order
+    columnorder = self.config.get('columnorder', None, section='mainlist')
+    if not columnorder is None:
+        currentcol = None
+        columnordersplitted = re.split('[ \t]*,[ \t]*', columnorder)
+        for col in columnordersplitted:
+            if col == 'number':
+                self.widgets['treeview'].move_column_after(self.number_column, currentcol)
+                currentcol = self.number_column
+            elif col == 'image':
+                self.widgets['treeview'].move_column_after(self.image_column, currentcol)
+                currentcol = self.image_column
+            elif col == 'otitle':
+                self.widgets['treeview'].move_column_after(self.otitle_column, currentcol)
+                currentcol = self.otitle_column
+            elif col == 'title':
+                self.widgets['treeview'].move_column_after(self.title_column, currentcol)
+                currentcol = self.title_column
+            elif col == 'director':
+                self.widgets['treeview'].move_column_after(self.director_column, currentcol)
+                currentcol = self.director_column
+            elif col == 'genre':
+                self.widgets['treeview'].move_column_after(self.genre_column, currentcol)
+                currentcol = self.genre_column
+            elif col == 'seen':
+                self.widgets['treeview'].move_column_after(self.seen_column, currentcol)
+                currentcol = self.seen_column
+            elif col == 'year':
+                self.widgets['treeview'].move_column_after(self.year_column, currentcol)
+                currentcol = self.year_column
+            elif col == 'runtime':
+                self.widgets['treeview'].move_column_after(self.runtime_column, currentcol)
+                currentcol = self.runtime_column
+            elif col == 'rating':
+                self.widgets['treeview'].move_column_after(self.rating_column, currentcol)
+                currentcol = self.rating_column
+    # add data to treeview
+    self.total = int(self.db.session.query(db.Movie).count())
+    self.widgets['treeview'].show()
 
 def loans_treeview(self):
-	self.loans_treemodel = gtk.TreeStore(str, str, str) # move to self.widgets
-	self.widgets['movie']['loan_history'].set_model(self.loans_treemodel)
-	self.widgets['movie']['loan_history'].set_headers_visible(True)
-	# loan date
-	renderer=gtk.CellRendererText()
-	self.date_column=gtk.TreeViewColumn(_('Loan Date'), renderer, text=0)
-	self.date_column.set_resizable(True)
-	self.widgets['movie']['loan_history'].append_column(self.date_column)
-	self.date_column.set_sort_column_id(0)
-	# return date
-	renderer=gtk.CellRendererText()
-	self.return_column=gtk.TreeViewColumn(_('Return Date'), renderer, text=1)
-	self.return_column.set_resizable(True)
-	self.widgets['movie']['loan_history'].append_column(self.return_column)
-	# loan to
-	renderer=gtk.CellRendererText()
-	self.loaner_column=gtk.TreeViewColumn(_('Loaned To'), renderer, text=2)
-	self.loaner_column.set_resizable(True)
-	self.widgets['movie']['loan_history'].append_column(self.loaner_column)
+    self.loans_treemodel = gtk.TreeStore(str, str, str) # move to self.widgets
+    self.widgets['movie']['loan_history'].set_model(self.loans_treemodel)
+    self.widgets['movie']['loan_history'].set_headers_visible(True)
+    # loan date
+    renderer=gtk.CellRendererText()
+    self.date_column=gtk.TreeViewColumn(_('Loan Date'), renderer, text=0)
+    self.date_column.set_resizable(True)
+    self.widgets['movie']['loan_history'].append_column(self.date_column)
+    self.date_column.set_sort_column_id(0)
+    # return date
+    renderer=gtk.CellRendererText()
+    self.return_column=gtk.TreeViewColumn(_('Return Date'), renderer, text=1)
+    self.return_column.set_resizable(True)
+    self.widgets['movie']['loan_history'].append_column(self.return_column)
+    # loan to
+    renderer=gtk.CellRendererText()
+    self.loaner_column=gtk.TreeViewColumn(_('Loaned To'), renderer, text=2)
+    self.loaner_column.set_resizable(True)
+    self.widgets['movie']['loan_history'].append_column(self.loaner_column)
 
 def lang_treeview(self):
-	treeview = self.widgets['add']['lang_treeview']
-	self.lang['model'] = gtk.TreeStore(str, str, str, str, str)
-	treeview.set_model(self.lang['model'])
-	treeview.set_headers_visible(True)
+    treeview = self.widgets['add']['lang_treeview']
+    self.lang['model'] = gtk.TreeStore(str, str, str, str, str)
+    treeview.set_model(self.lang['model'])
+    treeview.set_headers_visible(True)
 
-	model = self.lang['lang'] = gtk.ListStore(int, str)
-	for i in self.db.Lang.query.all():
-		model.append([i.lang_id, i.name])
-	combo = gtk.CellRendererCombo()
-	combo.set_property('model', model)
-	combo.set_property('text-column', 1)
-	combo.set_property('editable', True)
-	combo.set_property('has-entry', False)
-	combo.connect('edited', self.on_tv_lang_combo_edited, 0)
-	column=gtk.TreeViewColumn(_('Language'), combo, text=0)
-	column.set_property('min-width', 80)
-	column.set_property('resizable', True)
-	column.set_sort_column_id(0)
-	treeview.append_column(column)
-	
-	model = self.lang['type'] = gtk.ListStore(int, str)
-	#i = 0
-	#for lang_type in self._lang_types:
-	#	model.append([i, lang_type])
-	#	i += 1
-	model.append([0, ''])
-	model.append([1, _('lector')])
-	model.append([2, _('dubbing')])
-	model.append([3, _('subtitles')])
-	model.append([4, _(&quot;commentary&quot;)])
-	combo = gtk.CellRendererCombo()
-	combo.set_property('model', model)
-	combo.set_property('text-column', 1)
-	combo.set_property('editable', True)
-	combo.set_property('has-entry', False)
-	combo.connect('edited', self.on_tv_lang_combo_edited, 1)
-	column=gtk.TreeViewColumn(_('Type'), combo, text=1)
-	column.set_property('min-width', 80)
-	column.set_property('resizable', True)
-	column.set_sort_column_id(1)
-	treeview.append_column(column)
+    model = self.lang['lang'] = gtk.ListStore(int, str)
+    for i in self.db.session.query(db.Lang).all():
+        model.append([i.lang_id, i.name])
+    combo = gtk.CellRendererCombo()
+    combo.set_property('model', model)
+    combo.set_property('text-column', 1)
+    combo.set_property('editable', True)
+    combo.set_property('has-entry', False)
+    combo.connect('edited', self.on_tv_lang_combo_edited, 0)
+    column=gtk.TreeViewColumn(_('Language'), combo, text=0)
+    column.set_property('min-width', 80)
+    column.set_property('resizable', True)
+    column.set_sort_column_id(0)
+    treeview.append_column(column)
+    
+    model = self.lang['type'] = gtk.ListStore(int, str)
+    #i = 0
+    #for lang_type in self._lang_types:
+    #    model.append([i, lang_type])
+    #    i += 1
+    model.append([0, ''])
+    model.append([1, _('lector')])
+    model.append([2, _('dubbing')])
+    model.append([3, _('subtitles')])
+    model.append([4, _(&quot;commentary&quot;)])
+    combo = gtk.CellRendererCombo()
+    combo.set_property('model', model)
+    combo.set_property('text-column', 1)
+    combo.set_property('editable', True)
+    combo.set_property('has-entry', False)
+    combo.connect('edited', self.on_tv_lang_combo_edited, 1)
+    column=gtk.TreeViewColumn(_('Type'), combo, text=1)
+    column.set_property('min-width', 80)
+    column.set_property('resizable', True)
+    column.set_sort_column_id(1)
+    treeview.append_column(column)
 
-	model = self.lang['acodec'] = gtk.ListStore(int, str)
-	for i in self.db.ACodec.query.all():
-		model.append([i.acodec_id, i.name])
-	combo = gtk.CellRendererCombo()
-	combo.set_property('model', model)
-	combo.set_property('text-column', 1)
-	combo.set_property('editable', True)
-	combo.set_property('has-entry', False)
-	combo.connect('edited', self.on_tv_lang_combo_edited, 2)
-	column=gtk.TreeViewColumn(_('Codec'), combo, text=2)
-	column.set_property('min-width', 80)
-	column.set_property('resizable', True)
-	column.set_sort_column_id(2)
-	treeview.append_column(column)
-	
-	model = self.lang['achannel'] = gtk.ListStore(int, str)
-	for i in self.db.AChannel.query.all():
-		model.append([i.achannel_id, i.name])
-	combo = gtk.CellRendererCombo()
-	combo.set_property('model', model)
-	combo.set_property('text-column', 1)
-	combo.set_property('editable', True)
-	combo.set_property('has-entry', False)
-	combo.connect('edited', self.on_tv_lang_combo_edited, 3)
-	column=gtk.TreeViewColumn(_('Channels'), combo, text=3)
-	column.set_property('min-width', 80)
-	column.set_property('resizable', True)
-	column.set_sort_column_id(3)
-	treeview.append_column(column)
-	
-	model = self.lang['subformat'] = gtk.ListStore(int, str)
-	for i in self.db.SubFormat.query.all():
-		model.append([i.subformat_id, i.name])
-	combo = gtk.CellRendererCombo()
-	combo.set_property('model', model)
-	combo.set_property('text-column', 1)
-	combo.set_property('editable', True)
-	combo.set_property('has-entry', False)
-	combo.connect('edited', self.on_tv_lang_combo_edited, 4)
-	column=gtk.TreeViewColumn(_('Subtitle format'), combo, text=4)
-	column.set_property('min-width', 80)
-	column.set_property('resizable', True)
-	column.set_sort_column_id(4)
-	treeview.append_column(column)
-	
-	treeview.show_all()
+    model = self.lang['acodec'] = gtk.ListStore(int, str)
+    for i in self.db.session.query(db.ACodec).all():
+        model.append([i.acodec_id, i.name])
+    combo = gtk.CellRendererCombo()
+    combo.set_property('model', model)
+    combo.set_property('text-column', 1)
+    combo.set_property('editable', True)
+    combo.set_property('has-entry', False)
+    combo.connect('edited', self.on_tv_lang_combo_edited, 2)
+    column=gtk.TreeViewColumn(_('Codec'), combo, text=2)
+    column.set_property('min-width', 80)
+    column.set_property('resizable', True)
+    column.set_sort_column_id(2)
+    treeview.append_column(column)
+    
+    model = self.lang['achannel'] = gtk.ListStore(int, str)
+    for i in self.db.session.query(db.AChannel).all():
+        model.append([i.achannel_id, i.name])
+    combo = gtk.CellRendererCombo()
+    combo.set_property('model', model)
+    combo.set_property('text-column', 1)
+    combo.set_property('editable', True)
+    combo.set_property('has-entry', False)
+    combo.connect('edited', self.on_tv_lang_combo_edited, 3)
+    column=gtk.TreeViewColumn(_('Channels'), combo, text=3)
+    column.set_property('min-width', 80)
+    column.set_property('resizable', True)
+    column.set_sort_column_id(3)
+    treeview.append_column(column)
+    
+    model = self.lang['subformat'] = gtk.ListStore(int, str)
+    for i in self.db.session.query(db.SubFormat).all():
+        model.append([i.subformat_id, i.name])
+    combo = gtk.CellRendererCombo()
+    combo.set_property('model', model)
+    combo.set_property('text-column', 1)
+    combo.set_property('editable', True)
+    combo.set_property('has-entry', False)
+    combo.connect('edited', self.on_tv_lang_combo_edited, 4)
+    column=gtk.TreeViewColumn(_('Subtitle format'), combo, text=4)
+    column.set_property('min-width', 80)
+    column.set_property('resizable', True)
+    column.set_sort_column_id(4)
+    treeview.append_column(column)
+    
+    treeview.show_all()
 
 def movie_plugins(self):
-	&quot;&quot;&quot;
-	dinamically finds the movie source information plugins
-	and fills the plugins drop down list
-	&quot;&quot;&quot;
-	self.plugins = gutils.read_plugins('PluginMovie', \
-		self.locations['movie_plugins'])
-	self.plugins.sort()
-	self.d_plugin = 0
-	mcounter = 0
-	default_plugin = self.config.get('default_movie_plugin')
-	for p in self.plugins:
-		plugin_module = os.path.basename(p).replace('.py','')
-		plugin_name = plugin_module.replace('PluginMovie','')
-		self.widgets['add']['source'].append_text(plugin_name)
-		self.widgets['preferences']['default_plugin'].append_text(plugin_name)
-		if plugin_name == default_plugin:
-			self.widgets['preferences']['default_plugin'].set_active(mcounter)
-			self.d_plugin = mcounter
-		mcounter = mcounter + 1
-	self.widgets['add']['source'].set_active(self.d_plugin)
+    &quot;&quot;&quot;
+    dinamically finds the movie source information plugins
+    and fills the plugins drop down list
+    &quot;&quot;&quot;
+    self.plugins = gutils.read_plugins('PluginMovie', \
+        self.locations['movie_plugins'])
+    self.plugins.sort()
+    self.d_plugin = 0
+    mcounter = 0
+    default_plugin = self.config.get('default_movie_plugin')
+    for p in self.plugins:
+        plugin_module = os.path.basename(p).replace('.py','')
+        plugin_name = plugin_module.replace('PluginMovie','')
+        self.widgets['add']['source'].append_text(plugin_name)
+        self.widgets['preferences']['default_plugin'].append_text(plugin_name)
+        if plugin_name == default_plugin:
+            self.widgets['preferences']['default_plugin'].set_active(mcounter)
+            self.d_plugin = mcounter
+        mcounter = mcounter + 1
+    self.widgets['add']['source'].set_active(self.d_plugin)
 
 def export_plugins(self):
-	&quot;&quot;&quot;
-	dinamically finds the available export plugins
-	and fills the export menu entry
-	&quot;&quot;&quot;
-	plugins = gutils.read_plugins('PluginExport', \
-		self.locations['export_plugins'])
-	plugins.sort()
-	for p in plugins:
-		plugin_module = os.path.basename(p).replace('.py', '')
-		plugin_name = plugin_module.replace('PluginExport', '')
-		menu_items = gtk.MenuItem(plugin_name)
-		self.widgets['menu']['export'].append(menu_items)
-		menu_items.connect('activate', self.on_export_activate, plugin_name)
-		menu_items.show()
-		
+    &quot;&quot;&quot;
+    dinamically finds the available export plugins
+    and fills the export menu entry
+    &quot;&quot;&quot;
+    plugins = gutils.read_plugins('PluginExport', \
+        self.locations['export_plugins'])
+    plugins.sort()
+    for p in plugins:
+        plugin_module = os.path.basename(p).replace('.py', '')
+        plugin_name = plugin_module.replace('PluginExport', '')
+        menu_items = gtk.MenuItem(plugin_name)
+        self.widgets['menu']['export'].append(menu_items)
+        menu_items.connect('activate', self.on_export_activate, plugin_name)
+        menu_items.show()
+        
 def import_plugins(self):
-	&quot;&quot;&quot;
-	dinamically finds the available import plugins
-	and fills the import menu entry
-	&quot;&quot;&quot;
-	
-	import plugins.imp, math
+    &quot;&quot;&quot;
+    dinamically finds the available import plugins
+    and fills the import menu entry
+    &quot;&quot;&quot;
+    
+    import plugins.imp, math
 
-	fields_to_import = ( 'number','title', 'o_title', 'director', 'year', 'runtime', 'country',
-		'seen', 'rating', 'genre', 'studio', 'plot', 'cast', 'notes', 'classification',
-		'site', 'o_site', 'trailer', 'medium_id', 'media_num', 'vcodec_id', 'color', 'cond',
-		'layers', 'region', 'collection_id', 'volume_id', 'image')
+    fields_to_import = ( 'number','title', 'o_title', 'director', 'year', 'runtime', 'country',
+        'seen', 'rating', 'genre', 'studio', 'plot', 'cast', 'notes', 'classification',
+        'site', 'o_site', 'trailer', 'medium_id', 'media_num', 'vcodec_id', 'color', 'cond',
+        'layers', 'region', 'collection_id', 'volume_id', 'image')
 
-	# glade
-	glade_file = gtk.glade.XML(os.path.join(self.locations['glade'], 'import.glade'))
-	get = lambda x: glade_file.get_widget(x)
-	
-	w = self.widgets['import'] = {
-		'window'	: get('dialog_import'),
-		'pwindow'	: get('dialog_progress'),
-		'pabort'	: get('p_abortbutton'),
-		'fcw'		: get('fcw'),
-		'plugin'	: get('combo_plugin'),
-		'author'	: get('l_author'),
-		'email'		: get('l_email'),
-		'version'	: get('l_version'),
-		'description'	: get('l_description'),
-		'box_import_1'	: get('box_import_1'),
-		'box_import_2'	: get('box_import_2'),
-		'box_import_3'	: get('box_import_3'),
-		'progress'	: get('l_progress'),
-		'progressbar'	: get('progressbar'),
-		'fields'	: {},
-	}
-	get('cancel_button').connect('clicked', plugins.imp.on_abort_button_clicked, self)
-	get('import_button').connect('clicked', plugins.imp.on_import_button_clicked, self)
-	w['plugin'].connect('changed', plugins.imp.on_import_plugin_changed, w)
-	w['window'].set_transient_for(self.widgets['window'])
-	w['pwindow'].set_transient_for(self.widgets['window'])
-	
-	for name in plugins.imp.__all__:
-		w['plugin'].append_text(name)
-	w['plugin'].set_active(0)
-	
-	# fields to import
-	j = 0
-	k = math.ceil( len(self.field_names) / float(3) )
-	for i in fields_to_import:
-		j = j + 1
-		w['fields'][i] = gtk.CheckButton(self.field_names[i])
-		w['fields'][i].set_active(True) # TODO: get from config
-		if j &lt;= k:
-			w['box_import_1'].add(w['fields'][i])
-		elif j&lt;= 2*k:
-			w['box_import_2'].add(w['fields'][i])
-		else:
-			w['box_import_3'].add(w['fields'][i])
-	w['box_import_1'].show_all()
-	w['box_import_2'].show_all()
-	w['box_import_3'].show_all()
+    # glade
+    glade_file = gtk.glade.XML(os.path.join(self.locations['glade'], 'import.glade'))
+    get = lambda x: glade_file.get_widget(x)
+    
+    w = self.widgets['import'] = {
+        'window'    : get('dialog_import'),
+        'pwindow'    : get('dialog_progress'),
+        'pabort'    : get('p_abortbutton'),
+        'fcw'        : get('fcw'),
+        'plugin'    : get('combo_plugin'),
+        'author'    : get('l_author'),
+        'email'        : get('l_email'),
+        'version'    : get('l_version'),
+        'description'    : get('l_description'),
+        'box_import_1'    : get('box_import_1'),
+        'box_import_2'    : get('box_import_2'),
+        'box_import_3'    : get('box_import_3'),
+        'progress'    : get('l_progress'),
+        'progressbar'    : get('progressbar'),
+        'fields'    : {},
+    }
+    get('cancel_button').connect('clicked', plugins.imp.on_abort_button_clicked, self)
+    get('import_button').connect('clicked', plugins.imp.on_import_button_clicked, self)
+    w['plugin'].connect('changed', plugins.imp.on_import_plugin_changed, w)
+    w['window'].set_transient_for(self.widgets['window'])
+    w['pwindow'].set_transient_for(self.widgets['window'])
+    
+    for name in plugins.imp.__all__:
+        w['plugin'].append_text(name)
+    w['plugin'].set_active(0)
+    
+    # fields to import
+    j = 0
+    k = math.ceil( len(self.field_names) / float(3) )
+    for i in fields_to_import:
+        j = j + 1
+        w['fields'][i] = gtk.CheckButton(self.field_names[i])
+        w['fields'][i].set_active(True) # TODO: get from config
+        if j &lt;= k:
+            w['box_import_1'].add(w['fields'][i])
+        elif j&lt;= 2*k:
+            w['box_import_2'].add(w['fields'][i])
+        else:
+            w['box_import_3'].add(w['fields'][i])
+    w['box_import_1'].show_all()
+    w['box_import_2'].show_all()
+    w['box_import_3'].show_all()
 
 def people_treeview(self, create=True):
-	row = None
-	self.p_treemodel = gtk.TreeStore(gobject.TYPE_STRING, gobject.TYPE_STRING, gobject.TYPE_STRING, gobject.TYPE_STRING)
-	self.widgets['preferences']['treeview'].set_model(self.p_treemodel)
-	self.widgets['preferences']['treeview'].set_headers_visible(True)
+    row = None
+    self.p_treemodel = gtk.TreeStore(gobject.TYPE_STRING, gobject.TYPE_STRING, gobject.TYPE_STRING, gobject.TYPE_STRING)
+    self.widgets['preferences']['treeview'].set_model(self.p_treemodel)
+    self.widgets['preferences']['treeview'].set_headers_visible(True)
 
-	if create==True:
-		# name column
-		renderer=gtk.CellRendererText()
-		column=gtk.TreeViewColumn(_('Name'), renderer, text=0)
-		column.set_resizable(True)
-		column.set_sort_column_id(0)
-		self.widgets['preferences']['treeview'].append_column(column)
-		# email column
-		renderer=gtk.CellRendererText()
-		column=gtk.TreeViewColumn(_('E-mail'),renderer, text=1)
-		column.set_resizable(True)
-		column.set_sort_column_id(1)
-		self.widgets['preferences']['treeview'].append_column(column)
-	# add data to treeview
-	self.p_treemodel.clear()
-	for person in self.db.Person.query.order_by(self.db.Person.name.asc()):
-		myiter = self.p_treemodel.insert_before(None, None)
-		self.p_treemodel.set_value(myiter, 0, str(person.name))
-		self.p_treemodel.set_value(myiter, 1, str(person.email))
-	self.widgets['preferences']['treeview'].show()
+    if create==True:
+        # name column
+        renderer=gtk.CellRendererText()
+        column=gtk.TreeViewColumn(_('Name'), renderer, text=0)
+        column.set_resizable(True)
+        column.set_sort_column_id(0)
+        self.widgets['preferences']['treeview'].append_column(column)
+        # email column
+        renderer=gtk.CellRendererText()
+        column=gtk.TreeViewColumn(_('E-mail'),renderer, text=1)
+        column.set_resizable(True)
+        column.set_sort_column_id(1)
+        self.widgets['preferences']['treeview'].append_column(column)
+    # add data to treeview
+    self.p_treemodel.clear()
+    for person in self.db.session.query(db.Person).order_by(db.Person.name.asc()):
+        myiter = self.p_treemodel.insert_before(None, None)
+        self.p_treemodel.set_value(myiter, 0, str(person.name))
+        self.p_treemodel.set_value(myiter, 1, str(person.email))
+    self.widgets['preferences']['treeview'].show()
 
 def combos(self):
-	i = 0
-	for cond in self._conditions:
-		self.widgets['preferences']['condition'].insert_text(i, cond)
-		self.widgets['add']['condition'].insert_text(i, cond)
-		i += 1
-	i = 0
-	for color in self._colors:
-		self.widgets['preferences']['color'].insert_text(i, color)
-		self.widgets['add']['color'].insert_text(i, color)
-		i += 1
-	i = 0
-	for region in self._regions:
-		self.widgets['preferences']['region'].insert_text(i, region)
-		self.widgets['add']['region'].insert_text(i, region)
-		i += 1
-	i = 0
-	for layer in self._layers:
-		self.widgets['preferences']['layers'].insert_text(i, layer)
-		self.widgets['add']['layers'].insert_text(i, layer)
-		i += 1
-	i = 0
-	pos_to_activate = 0
-	selected_criteria = self.config.get('criteria', None, section='mainlist')
-	for criteria in self.search_criteria:
-		new_criteria = self.field_names[criteria]
-		self.widgets['filter']['criteria'].insert_text(i, new_criteria)
-		if selected_criteria == new_criteria:
-			pos_to_activate = i
-		i += 1
-	self.widgets['filter']['criteria'].set_active(pos_to_activate)
-	i = 0
-	for field in self.sort_criteria:
-		if field != 'movie_id':
-			self.widgets['preferences']['sortby'].insert_text(i, self.field_names[field])
-		else:
-			self.widgets['preferences']['sortby'].insert_text(i, _('Last added'))
-		i += 1
-	self.widgets['preferences']['sortby'].set_wrap_width(3)
-	self.widgets['preferences']['sortby'].set_active(0) # Number
+    i = 0
+    for cond in self._conditions:
+        self.widgets['preferences']['condition'].insert_text(i, cond)
+        self.widgets['add']['condition'].insert_text(i, cond)
+        i += 1
+    i = 0
+    for color in self._colors:
+        self.widgets['preferences']['color'].insert_text(i, color)
+        self.widgets['add']['color'].insert_text(i, color)
+        i += 1
+    i = 0
+    for region in self._regions:
+        self.widgets['preferences']['region'].insert_text(i, region)
+        self.widgets['add']['region'].insert_text(i, region)
+        i += 1
+    i = 0
+    for layer in self._layers:
+        self.widgets['preferences']['layers'].insert_text(i, layer)
+        self.widgets['add']['layers'].insert_text(i, layer)
+        i += 1
+    i = 0
+    pos_to_activate = 0
+    selected_criteria = self.config.get('criteria', None, section='mainlist')
+    for criteria in self.search_criteria:
+        new_criteria = self.field_names[criteria]
+        self.widgets['filter']['criteria'].insert_text(i, new_criteria)
+        if selected_criteria == new_criteria:
+            pos_to_activate = i
+        i += 1
+    self.widgets['filter']['criteria'].set_active(pos_to_activate)
+    i = 0
+    for field in self.sort_criteria:
+        if field != 'movie_id':
+            self.widgets['preferences']['sortby'].insert_text(i, self.field_names[field])
+        else:
+            self.widgets['preferences']['sortby'].insert_text(i, _('Last added'))
+        i += 1
+    self.widgets['preferences']['sortby'].set_wrap_width(3)
+    self.widgets['preferences']['sortby'].set_active(0) # Number
 
 def dictionaries(self):
-	&quot;&quot;&quot;initializes data filled dynamically by users&quot;&quot;&quot;
-	import update
-	self.am_tags = {} # dictionary for tag CheckBoxes
-	update.update_volume_combo_ids(self)
-	update.update_collection_combo_ids(self)
-	update.update_loanedto_combo_ids(self)
-	update.update_bytag_combo_ids(self)
-	fill_volumes_combo(self)
-	fill_collections_combo(self)
-	fill_loanedto_combo(self)
-	fill_bytag_combo(self)
-	fill_preferences_tags_combo(self)
-	language_combos(self)
-	acodec_combos(self)
-	achannel_combos(self)
-	subformat_combos(self)
-	vcodec_combos(self)
-	media_combos(self)
-	create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
-	self.sort_criteria = [ # &quot;[]&quot; because of index() 
-		'number', 'o_title', 'title', 'director', 'year', 'runtime', 'country',
-		'genre', 'studio', 'media_num', 'rating', 'classification', 'collection_id',
-		'volume_id', 'cond', 'layers', 'region', 'movie_id']
-	self.search_criteria = (
-		'o_title', 'title', 'number', 'director', 'plot', 'cast', 'notes', 'year',
-		'runtime', 'country', 'genre', 'studio', 'media_num', 'rating')
-	self.field_names = {
-		'cast'           : _('Cast'),
-		'classification' : _('Classification'),
-		'collection_id'  : _('Collection'),
-		'color'          : _('Color'),
-		'cond'           : _('Condition'),
-		'country'        : _('Country'),
-		'director'       : _('Director'),
-		'genre'          : _('Genre'),
-		'image'          : _('Image'),
-		'layers'         : _('Layers'),
-		'loaned'         : _('Loaned'),
-		'media_num'      : _('Discs'),
-		'medium_id'      : _('Medium'),
-		'notes'          : _('Notes'),
-		'number'         : _('Number'),
-		'o_site'         : _('Official site'),
-		'o_title'        : _('Original Title'),
-		'plot'           : _('Plot'),
-		'rating'         : _('Rating'),
-		'region'         : _('Region'),
-		'runtime'        : _('Runtime'),
-		'seen'           : _('Seen it'),
-		'site'           : _('Site'),
-		'studio'         : _('Studio'),
-		'title'          : _('Title'),
-		'trailer'        : _('Trailer'),
-		'vcodec_id'      : _('Video codec'),
-		'volume_id'      : _('Volume'),
-		'year'           : _('Year')}
-	self._conditions = (_('N/A'), _('Damaged'), _('Poor'),  _('Fair'), _('Good'), _('Excellent'))
-	self._colors = (_('N/A'), _('Color'), _('Black and White'), _('Mixed'))
-	self._lang_types = ('', _('lector'), _('dubbing'), _('subtitles'), _('commentary'))
-	self._layers = (_('N/A'), _('Single Side, Single Layer'), _('Single Side, Dual Layer'), _('Dual Side, Single Layer'), _('Dual Side, Dual Layer'))
-	self._regions = (
-		_('Region 0 (No Region Coding)'),
-		_('Region 1 (United States of America, Canada)'),
-		_('Region 2 (Europe,including France, Greece, Turkey, Egypt, Arabia, Japan and South Africa)'),
-		_('Region 3 (Korea, Thailand, Vietnam, Borneo and Indonesia)'),
-		_('Region 4 (Australia and New Zealand, Mexico, the Caribbean, and South America)'),
-		_('Region 5 (India, Africa, Russia and former USSR countries)'),
-		_('Region 6 (Popular Republic of China)'),
-		_('Region 7 (Reserved for Unspecified Special Use)'),
-		_('Region 8 (Airlines/Cruise Ships)'),
-	)
+    &quot;&quot;&quot;initializes data filled dynamically by users&quot;&quot;&quot;
+    import update
+    self.am_tags = {} # dictionary for tag CheckBoxes
+    update.update_volume_combo_ids(self)
+    update.update_collection_combo_ids(self)
+    update.update_loanedto_combo_ids(self)
+    update.update_bytag_combo_ids(self)
+    fill_volumes_combo(self)
+    fill_collections_combo(self)
+    fill_loanedto_combo(self)
+    fill_bytag_combo(self)
+    fill_preferences_tags_combo(self)
+    language_combos(self)
+    acodec_combos(self)
+    achannel_combos(self)
+    subformat_combos(self)
+    vcodec_combos(self)
+    media_combos(self)
+    create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
+    self.sort_criteria = [ # &quot;[]&quot; because of index() 
+        'number', 'o_title', 'title', 'director', 'year', 'runtime', 'country',
+        'genre', 'studio', 'media_num', 'rating', 'classification', 'collection_id',
+        'volume_id', 'cond', 'layers', 'region', 'movie_id']
+    self.search_criteria = (
+        'o_title', 'title', 'number', 'director', 'plot', 'cast', 'notes', 'year',
+        'runtime', 'country', 'genre', 'studio', 'media_num', 'rating')
+    self.field_names = {
+        'cast'           : _('Cast'),
+        'classification' : _('Classification'),
+        'collection_id'  : _('Collection'),
+        'color'          : _('Color'),
+        'cond'           : _('Condition'),
+        'country'        : _('Country'),
+        'director'       : _('Director'),
+        'genre'          : _('Genre'),
+        'image'          : _('Image'),
+        'layers'         : _('Layers'),
+        'loaned'         : _('Loaned'),
+        'media_num'      : _('Discs'),
+        'medium_id'      : _('Medium'),
+        'notes'          : _('Notes'),
+        'number'         : _('Number'),
+        'o_site'         : _('Official site'),
+        'o_title'        : _('Original Title'),
+        'plot'           : _('Plot'),
+        'rating'         : _('Rating'),
+        'region'         : _('Region'),
+        'runtime'        : _('Runtime'),
+        'seen'           : _('Seen it'),
+        'site'           : _('Site'),
+        'studio'         : _('Studio'),
+        'title'          : _('Title'),
+        'trailer'        : _('Trailer'),
+        'vcodec_id'      : _('Video codec'),
+        'volume_id'      : _('Volume'),
+        'year'           : _('Year')}
+    self._conditions = (_('N/A'), _('Damaged'), _('Poor'),  _('Fair'), _('Good'), _('Excellent'))
+    self._colors = (_('N/A'), _('Color'), _('Black and White'), _('Mixed'))
+    self._lang_types = ('', _('lector'), _('dubbing'), _('subtitles'), _('commentary'))
+    self._layers = (_('N/A'), _('Single Side, Single Layer'), _('Single Side, Dual Layer'), _('Dual Side, Single Layer'), _('Dual Side, Dual Layer'))
+    self._regions = (
+        _('Region 0 (No Region Coding)'),
+        _('Region 1 (United States of America, Canada)'),
+        _('Region 2 (Europe,including France, Greece, Turkey, Egypt, Arabia, Japan and South Africa)'),
+        _('Region 3 (Korea, Thailand, Vietnam, Borneo and Indonesia)'),
+        _('Region 4 (Australia and New Zealand, Mexico, the Caribbean, and South America)'),
+        _('Region 5 (India, Africa, Russia and former USSR countries)'),
+        _('Region 6 (Popular Republic of China)'),
+        _('Region 7 (Reserved for Unspecified Special Use)'),
+        _('Region 8 (Airlines/Cruise Ships)'),
+    )
 
 def web_results(self):
-	self.treemodel_results = gtk.TreeStore(str, str)
-	self.widgets['results']['treeview'].set_model(self.treemodel_results)
-	self.widgets['results']['treeview'].set_headers_visible(False)
-	# column ids
-	renderer=gtk.CellRendererText()
-	self.column1=gtk.TreeViewColumn(None, renderer, text=0)
-	self.column1.set_visible(False)
-	self.widgets['results']['treeview'].append_column(self.column1)
-	# column titles
-	renderer=gtk.CellRendererText()
-	self.column2=gtk.TreeViewColumn(None, renderer, text=1)
-	self.column2.set_resizable(True)
-	self.column2.set_sort_column_id(1)
-	self.widgets['results']['treeview'].append_column(self.column2)
+    self.treemodel_results = gtk.TreeStore(str, str)
+    self.widgets['results']['treeview'].set_model(self.treemodel_results)
+    self.widgets['results']['treeview'].set_headers_visible(False)
+    # column ids
+    renderer=gtk.CellRendererText()
+    self.column1=gtk.TreeViewColumn(None, renderer, text=0)
+    self.column1.set_visible(False)
+    self.widgets['results']['treeview'].append_column(self.column1)
+    # column titles
+    renderer=gtk.CellRendererText()
+    self.column2=gtk.TreeViewColumn(None, renderer, text=1)
+    self.column2.set_resizable(True)
+    self.column2.set_sort_column_id(1)
+    self.widgets['results']['treeview'].append_column(self.column2)
 
 def gtkspell(self):
-	global spell_support
-	spell_error = False
-	if self.posix and spell_support:
-		if self.config.get('gtkspell', False, section='spell') == True:
-			if self.config.get('notes', True, section='spell') == True and self.config.get('lang', section='spell') != '':
-				try:
-					self.notes_spell = gtkspell.Spell(self.widgets['add']['cast'], self.config.get('lang', section='spell'))
-				except:
-					spell_error = True
-			if self.config.get('plot', True, section='spell')==True and self.config.get('lang', section='spell') != '':
-				try:
-					self.plot_spell = gtkspell.Spell(self.widgets['add']['plot'], self.config.get('lang', section='spell'))
-				except:
-					spell_error = True
-			if spell_error:
-				self.debug.show('Dictionary not available. Spellcheck will be disabled.')
-				if not self.config.get('notified', False, section='spell'):
-					gutils.info(self, _(&quot;Dictionary not available. Spellcheck will be disabled. \n&quot; + \
-						&quot;Please install the aspell-%s package or adjust the spellchekcer preferences.&quot;)%self.config.get('lang', section='spell'), \
-						self.widgets['preferences']['window'])
-					self.config.set('notified', True, section='spell')
-					self.config.save()
-	else:
-		self.debug.show('Spellchecker is not available')
+    global spell_support
+    spell_error = False
+    if self.posix and spell_support:
+        if self.config.get('gtkspell', False, section='spell') == True:
+            if self.config.get('notes', True, section='spell') == True and self.config.get('lang', section='spell') != '':
+                try:
+                    self.notes_spell = gtkspell.Spell(self.widgets['add']['cast'], self.config.get('lang', section='spell'))
+                except:
+                    spell_error = True
+            if self.config.get('plot', True, section='spell')==True and self.config.get('lang', section='spell') != '':
+                try:
+                    self.plot_spell = gtkspell.Spell(self.widgets['add']['plot'], self.config.get('lang', section='spell'))
+                except:
+                    spell_error = True
+            if spell_error:
+                self.debug.show('Dictionary not available. Spellcheck will be disabled.')
+                if not self.config.get('notified', False, section='spell'):
+                    gutils.info(self, _(&quot;Dictionary not available. Spellcheck will be disabled. \n&quot; + \
+                        &quot;Please install the aspell-%s package or adjust the spellchekcer preferences.&quot;)%self.config.get('lang', section='spell'), \
+                        self.widgets['preferences']['window'])
+                    self.config.set('notified', True, section='spell')
+                    self.config.save()
+    else:
+        self.debug.show('Spellchecker is not available')
 
 def preferences(self):
-	self.widgets['preferences']['db_type'].insert_text(0,'SQLite3 (internal)')
-	self.widgets['preferences']['db_type'].insert_text(1,'PostgreSQL')
-	self.widgets['preferences']['db_type'].insert_text(2,'MySQL')
-	self.widgets['preferences']['db_type'].insert_text(3,'Microsoft SQL')
-	self.widgets['preferences']['db_host'].set_text(self.config.get('host', '', section='database'))
-	self.widgets['preferences']['db_port'].set_value(int(self.config.get('port', 0, section='database')))
-	self.widgets['preferences']['db_user'].set_text(self.config.get('user', '', section='database'))
-	self.widgets['preferences']['db_passwd'].set_text(self.config.get('passwd', '', section='database'))
-	self.widgets['preferences']['db_name'].set_text(self.config.get('name', '', section='database'))
-	db_type = self.config.get('type', 'sqlite', section='database')
-	if db_type == 'postgres':
-		self.widgets['preferences']['db_type'].set_active(1)
-	elif db_type == 'mysql':
-		self.widgets['preferences']['db_type'].set_active(2)
-	elif db_type == 'mssql':
-		self.widgets['preferences']['db_type'].set_active(3)
-	else:
-		self.widgets['preferences']['db_type'].set_active(0)
+    self.widgets['preferences']['db_type'].insert_text(0,'SQLite3 (internal)')
+    self.widgets['preferences']['db_type'].insert_text(1,'PostgreSQL')
+    self.widgets['preferences']['db_type'].insert_text(2,'MySQL')
+    self.widgets['preferences']['db_type'].insert_text(3,'Microsoft SQL')
+    self.widgets['preferences']['db_host'].set_text(self.config.get('host', '', section='database'))
+    self.widgets['preferences']['db_port'].set_value(int(self.config.get('port', 0, section='database')))
+    self.widgets['preferences']['db_user'].set_text(self.config.get('user', '', section='database'))
+    self.widgets['preferences']['db_passwd'].set_text(self.config.get('passwd', '', section='database'))
+    self.widgets['preferences']['db_name'].set_text(self.config.get('name', '', section='database'))
+    db_type = self.config.get('type', 'sqlite', section='database')
+    if db_type == 'postgres':
+        self.widgets['preferences']['db_type'].set_active(1)
+    elif db_type == 'mysql':
+        self.widgets['preferences']['db_type'].set_active(2)
+    elif db_type == 'mssql':
+        self.widgets['preferences']['db_type'].set_active(3)
+    else:
+        self.widgets['preferences']['db_type'].set_active(0)
 
 def fill_volumes_combo(self, default=0):
-	self.widgets['add']['volume'].get_model().clear()
-	self.widgets['filter']['volume'].get_model().clear()
-	for i in self.volume_combo_ids:
-		vol_id = self.volume_combo_ids[i]
-		if vol_id&gt;0:
-			name = self.db.Volume.query.filter_by(volume_id=vol_id).first().name
-		else:
-			name = ''
-		# add some white spaces to prevent scrollbar hides parts of the names	
-		self.widgets['add']['volume'].insert_text(int(i), str(name) + '   ')
-		self.widgets['filter']['volume'].insert_text(int(i), str(name) + '   ')
-	self.widgets['add']['volume'].show_all()
-	self.widgets['filter']['volume'].show_all()
-	self.widgets['filter']['volume'].set_active(0)
-	i = gutils.findKey(default, self.volume_combo_ids)
-	if i is not None:
-		self.widgets['add']['volume'].set_active(int(i))
-	self.widgets['add']['volume'].set_wrap_width(3)
+    self.widgets['add']['volume'].get_model().clear()
+    self.widgets['filter']['volume'].get_model().clear()
+    for i in self.volume_combo_ids:
+        vol_id = self.volume_combo_ids[i]
+        if vol_id&gt;0:
+            name = self.db.session.query(db.Volume).filter_by(volume_id=vol_id).first().name
+        else:
+            name = ''
+        # add some white spaces to prevent scrollbar hides parts of the names    
+        self.widgets['add']['volume'].insert_text(int(i), str(name) + '   ')
+        self.widgets['filter']['volume'].insert_text(int(i), str(name) + '   ')
+    self.widgets['add']['volume'].show_all()
+    self.widgets['filter']['volume'].show_all()
+    self.widgets['filter']['volume'].set_active(0)
+    i = gutils.findKey(default, self.volume_combo_ids)
+    if i is not None:
+        self.widgets['add']['volume'].set_active(int(i))
+    self.widgets['add']['volume'].set_wrap_width(3)
 
 def fill_collections_combo(self, default=0):
-	self.widgets['add']['collection'].get_model().clear()
-	self.widgets['filter']['collection'].get_model().clear()
-	for i in self.collection_combo_ids:
-		col_id = self.collection_combo_ids[i]
-		if col_id&gt;0:
-			name = self.db.Collection.query.filter_by(collection_id=col_id).first().name
-		else:
-			name = ''
-		# add some white spaces to prevent scrollbar hides parts of the names	
-		self.widgets['add']['collection'].insert_text(int(i), str(name) + '   ')
-		self.widgets['filter']['collection'].insert_text(int(i), str(name) + '   ')
-	self.widgets['add']['collection'].show_all()
-	self.widgets['filter']['collection'].show_all()
-	self.widgets['filter']['collection'].set_active(0)
-	i = gutils.findKey(default, self.collection_combo_ids)
-	if i is not None:
-		self.widgets['add']['collection'].set_active(int(i))
-	self.widgets['add']['collection'].set_wrap_width(2)
+    self.widgets['add']['collection'].get_model().clear()
+    self.widgets['filter']['collection'].get_model().clear()
+    for i in self.collection_combo_ids:
+        col_id = self.collection_combo_ids[i]
+        if col_id&gt;0:
+            name = self.db.session.query(db.Collection).filter_by(collection_id=col_id).first().name
+        else:
+            name = ''
+        # add some white spaces to prevent scrollbar hides parts of the names    
+        self.widgets['add']['collection'].insert_text(int(i), str(name) + '   ')
+        self.widgets['filter']['collection'].insert_text(int(i), str(name) + '   ')
+    self.widgets['add']['collection'].show_all()
+    self.widgets['filter']['collection'].show_all()
+    self.widgets['filter']['collection'].set_active(0)
+    i = gutils.findKey(default, self.collection_combo_ids)
+    if i is not None:
+        self.widgets['add']['collection'].set_active(int(i))
+    self.widgets['add']['collection'].set_wrap_width(2)
 
 def fill_loanedto_combo(self):
-	self.widgets['filter']['loanedto'].get_model().clear()
-	for i in self.loanedto_combo_ids:
-		per_id = self.loanedto_combo_ids[i]
-		if per_id&gt;0:
-			name = self.db.Person.query.filter_by(person_id=per_id).first().name
-		else:
-			name = ''
-		# add some white spaces to prevent scrollbar hides parts of the names	
-		self.widgets['filter']['loanedto'].insert_text(int(i), str(name) + '   ')
-	self.widgets['filter']['loanedto'].show_all()
-	self.widgets['filter']['loanedto'].set_active(0)
+    self.widgets['filter']['loanedto'].get_model().clear()
+    for i in self.loanedto_combo_ids:
+        per_id = self.loanedto_combo_ids[i]
+        if per_id&gt;0:
+            name = self.db.session.query(db.Person).filter_by(person_id=per_id).first().name
+        else:
+            name = ''
+        # add some white spaces to prevent scrollbar hides parts of the names    
+        self.widgets['filter']['loanedto'].insert_text(int(i), str(name) + '   ')
+    self.widgets['filter']['loanedto'].show_all()
+    self.widgets['filter']['loanedto'].set_active(0)
 
 def fill_bytag_combo(self):
-	self.widgets['filter']['tag'].get_model().clear()
-	for i in self.bytag_combo_ids:
-		id = self.bytag_combo_ids[i]
-		if id&gt;0:
-			name = self.db.Tag.query.filter_by(tag_id=id).first().name
-		else:
-			name = ''
-		# add some white spaces to prevent scrollbar hides parts of the names	
-		self.widgets['filter']['tag'].insert_text(int(i), str(name) + '   ')
-	self.widgets['filter']['tag'].show_all()
-	self.widgets['filter']['tag'].set_active(0)
+    self.widgets['filter']['tag'].get_model().clear()
+    for i in self.bytag_combo_ids:
+        id = self.bytag_combo_ids[i]
+        if id&gt;0:
+            name = self.db.session.query(db.Tag).filter_by(tag_id=id).first().name
+        else:
+            name = ''
+        # add some white spaces to prevent scrollbar hides parts of the names    
+        self.widgets['filter']['tag'].insert_text(int(i), str(name) + '   ')
+    self.widgets['filter']['tag'].show_all()
+    self.widgets['filter']['tag'].set_active(0)
 
 def fill_preferences_tags_combo(self):
-	self.widgets['preferences']['tag_name'].get_model().clear()
-	self.tags_ids = {}
-	i = 0
-	for tag in self.db.Tag.query.all():
-		self.tags_ids[i] = tag.tag_id
-		self.widgets['preferences']['tag_name'].insert_text(int(i), str(tag.name))
-		i += 1
-	self.widgets['preferences']['tag_name'].show_all()
+    self.widgets['preferences']['tag_name'].get_model().clear()
+    self.tags_ids = {}
+    i = 0
+    for tag in self.db.session.query(db.Tag).all():
+        self.tags_ids[i] = tag.tag_id
+        self.widgets['preferences']['tag_name'].insert_text(int(i), str(tag.name))
+        i += 1
+    self.widgets['preferences']['tag_name'].show_all()
 
 def language_combos(self):
-	self.widgets['preferences']['lang_name'].get_model().clear()
-	self.languages_ids = {}
-	self.languages_ids[0] = 0	# empty one
-	self.widgets['preferences']['lang_name'].insert_text(0, '')
-	i = 1
-	for lang in self.db.Lang.query.all():
-		self.languages_ids[i] = lang.lang_id
-		self.widgets['preferences']['lang_name'].insert_text(int(i), str(lang.name))
-		i += 1
-	self.widgets['preferences']['lang_name'].show_all()
-	# add movie languages treeview
-	self.lang['lang'].clear()
-	for i in self.db.Lang.query.all():
-		self.lang['lang'].append([i.lang_id, i.name])
+    self.widgets['preferences']['lang_name'].get_model().clear()
+    self.languages_ids = {}
+    self.languages_ids[0] = 0    # empty one
+    self.widgets['preferences']['lang_name'].insert_text(0, '')
+    i = 1
+    for lang in self.db.session.query(db.Lang).all():
+        self.languages_ids[i] = lang.lang_id
+        self.widgets['preferences']['lang_name'].insert_text(int(i), str(lang.name))
+        i += 1
+    self.widgets['preferences']['lang_name'].show_all()
+    # add movie languages treeview
+    self.lang['lang'].clear()
+    for i in self.db.session.query(db.Lang).all():
+        self.lang['lang'].append([i.lang_id, i.name])
 def acodec_combos(self):
-	self.widgets['preferences']['acodec_name'].get_model().clear()
-	self.acodecs_ids = {}
-	self.acodecs_ids[0] = 0	# empty one
-	self.widgets['preferences']['acodec_name'].insert_text(0, '')
-	i = 1
-	for acodec in self.db.ACodec.query.all():
-		self.acodecs_ids[i] = acodec.acodec_id
-		self.widgets['preferences']['acodec_name'].insert_text(int(i), str(acodec.name))
-		i += 1
-	self.widgets['preferences']['acodec_name'].show_all()
-	# add movie languages treeview
-	self.lang['acodec'].clear()
-	for i in self.db.ACodec.query.all():
-		self.lang['acodec'].append([i.acodec_id, i.name])
+    self.widgets['preferences']['acodec_name'].get_model().clear()
+    self.acodecs_ids = {}
+    self.acodecs_ids[0] = 0    # empty one
+    self.widgets['preferences']['acodec_name'].insert_text(0, '')
+    i = 1
+    for acodec in self.db.session.query(db.ACodec).all():
+        self.acodecs_ids[i] = acodec.acodec_id
+        self.widgets['preferences']['acodec_name'].insert_text(int(i), str(acodec.name))
+        i += 1
+    self.widgets['preferences']['acodec_name'].show_all()
+    # add movie languages treeview
+    self.lang['acodec'].clear()
+    for i in self.db.session.query(db.ACodec).all():
+        self.lang['acodec'].append([i.acodec_id, i.name])
 def achannel_combos(self):
-	self.widgets['preferences']['achannel_name'].get_model().clear()
-	self.achannels_ids = {}
-	self.achannels_ids[0] = 0	# empty one
-	self.widgets['preferences']['achannel_name'].insert_text(0, '')
-	i = 1
-	for achannel in self.db.AChannel.query.all():
-		self.achannels_ids[i] = achannel.achannel_id
-		self.widgets['preferences']['achannel_name'].insert_text(int(i), str(achannel.name))
-		i += 1
-	self.widgets['preferences']['achannel_name'].show_all()
-	# add movie languages treeview
-	self.lang['achannel'].clear()
-	for i in self.db.AChannel.query.all():
-		self.lang['achannel'].append([i.achannel_id, i.name])
+    self.widgets['preferences']['achannel_name'].get_model().clear()
+    self.achannels_ids = {}
+    self.achannels_ids[0] = 0    # empty one
+    self.widgets['preferences']['achannel_name'].insert_text(0, '')
+    i = 1
+    for achannel in self.db.session.query(db.AChannel).all():
+        self.achannels_ids[i] = achannel.achannel_id
+        self.widgets['preferences']['achannel_name'].insert_text(int(i), str(achannel.name))
+        i += 1
+    self.widgets['preferences']['achannel_name'].show_all()
+    # add movie languages treeview
+    self.lang['achannel'].clear()
+    for i in self.db.session.query(db.AChannel).all():
+        self.lang['achannel'].append([i.achannel_id, i.name])
 def subformat_combos(self):
-	self.widgets['preferences']['subformat_name'].get_model().clear()
-	self.subformats_ids = {}
-	self.subformats_ids[0] = 0	# empty one
-	self.widgets['preferences']['subformat_name'].insert_text(0, '')
-	i = 1
-	for subformat in self.db.SubFormat.query.all():
-		self.subformats_ids[i] = subformat.subformat_id
-		self.widgets['preferences']['subformat_name'].insert_text(int(i), str(subformat.name))
-		i += 1
-	self.widgets['preferences']['subformat_name'].show_all()
-	# add movie languages treeview
-	self.lang['subformat'].clear()
-	for i in self.db.SubFormat.query.all():
-		self.lang['subformat'].append([i.subformat_id, i.name])
+    self.widgets['preferences']['subformat_name'].get_model().clear()
+    self.subformats_ids = {}
+    self.subformats_ids[0] = 0    # empty one
+    self.widgets['preferences']['subformat_name'].insert_text(0, '')
+    i = 1
+    for subformat in self.db.session.query(db.SubFormat).all():
+        self.subformats_ids[i] = subformat.subformat_id
+        self.widgets['preferences']['subformat_name'].insert_text(int(i), str(subformat.name))
+        i += 1
+    self.widgets['preferences']['subformat_name'].show_all()
+    # add movie languages treeview
+    self.lang['subformat'].clear()
+    for i in self.db.session.query(db.SubFormat).all():
+        self.lang['subformat'].append([i.subformat_id, i.name])
 
 def media_combos(self):
-	# clear data
-	self.widgets['preferences']['medium_name'].get_model().clear()
-	self.widgets['preferences']['media'].get_model().clear()
-	self.widgets['add']['media'].get_model().clear()
-	
-	self.media_ids = {}
+    # clear data
+    self.widgets['preferences']['medium_name'].get_model().clear()
+    self.widgets['preferences']['media'].get_model().clear()
+    self.widgets['add']['media'].get_model().clear()
+    
+    self.media_ids = {}
 
-	self.media_ids[0] = None
-	self.widgets['preferences']['medium_name'].insert_text(0, '')
-	self.widgets['add']['media'].insert_text(0, _('N/A'))
-	self.widgets['preferences']['media'].insert_text(0, _('N/A'))
-	i = 1
-	for medium in self.db.Medium.query.all():
-		self.media_ids[i] = medium.medium_id
-		self.widgets['preferences']['medium_name'].insert_text(int(i), str(medium.name))
-		self.widgets['add']['media'].insert_text(int(i), str(medium.name))
-		self.widgets['preferences']['media'].insert_text(int(i), str(medium.name))
-		i += 1
+    self.media_ids[0] = None
+    self.widgets['preferences']['medium_name'].insert_text(0, '')
+    self.widgets['add']['media'].insert_text(0, _('N/A'))
+    self.widgets['preferences']['media'].insert_text(0, _('N/A'))
+    i = 1
+    for medium in self.db.session.query(db.Medium).all():
+        self.media_ids[i] = medium.medium_id
+        self.widgets['preferences']['medium_name'].insert_text(int(i), str(medium.name))
+        self.widgets['add']['media'].insert_text(int(i), str(medium.name))
+        self.widgets['preferences']['media'].insert_text(int(i), str(medium.name))
+        i += 1
 
-	self.widgets['preferences']['medium_name'].show_all()
-	self.widgets['add']['media'].show_all()
-	self.widgets['preferences']['media'].show_all()
-	if self.config.has_key('media', section='defaults'):
-		pos = gutils.findKey(self.config.get('media', section='defaults'), self.media_ids)
-		if pos  is not None:
-			self.widgets['preferences']['media'].set_active(int(pos))
-		else:
-			self.widgets['preferences']['media'].set_active(0)
-	else:
-		self.widgets['preferences']['media'].set_active(0)
+    self.widgets['preferences']['medium_name'].show_all()
+    self.widgets['add']['media'].show_all()
+    self.widgets['preferences']['media'].show_all()
+    if self.config.has_key('media', section='defaults'):
+        pos = gutils.findKey(self.config.get('media', section='defaults'), self.media_ids)
+        if pos  is not None:
+            self.widgets['preferences']['media'].set_active(int(pos))
+        else:
+            self.widgets['preferences']['media'].set_active(0)
+    else:
+        self.widgets['preferences']['media'].set_active(0)
 
 def vcodec_combos(self):
-	# clear data
-	self.widgets['preferences']['vcodec_name'].get_model().clear()
-	self.widgets['preferences']['vcodec'].get_model().clear()
-	self.widgets['add']['vcodec'].get_model().clear()
-	
-	self.vcodecs_ids = {}
-	
-	self.vcodecs_ids[0] = None
-	self.widgets['preferences']['vcodec_name'].insert_text(0, '')
-	self.widgets['add']['vcodec'].insert_text(0, _('N/A'))
-	self.widgets['preferences']['vcodec'].insert_text(0, _('N/A'))
-	i = 1
-	for vcodec in self.db.VCodec.query.all():
-		self.vcodecs_ids[i] = vcodec.vcodec_id
-		self.widgets['preferences']['vcodec_name'].insert_text(int(i), str(vcodec.name))
-		self.widgets['add']['vcodec'].insert_text(int(i), str(vcodec.name))
-		self.widgets['preferences']['vcodec'].insert_text(int(i), str(vcodec.name))
-		i += 1
+    # clear data
+    self.widgets['preferences']['vcodec_name'].get_model().clear()
+    self.widgets['preferences']['vcodec'].get_model().clear()
+    self.widgets['add']['vcodec'].get_model().clear()
+    
+    self.vcodecs_ids = {}
+    
+    self.vcodecs_ids[0] = None
+    self.widgets['preferences']['vcodec_name'].insert_text(0, '')
+    self.widgets['add']['vcodec'].insert_text(0, _('N/A'))
+    self.widgets['preferences']['vcodec'].insert_text(0, _('N/A'))
+    i = 1
+    for vcodec in self.db.session.query(db.VCodec).all():
+        self.vcodecs_ids[i] = vcodec.vcodec_id
+        self.widgets['preferences']['vcodec_name'].insert_text(int(i), str(vcodec.name))
+        self.widgets['add']['vcodec'].insert_text(int(i), str(vcodec.name))
+        self.widgets['preferences']['vcodec'].insert_text(int(i), str(vcodec.name))
+        i += 1
 
-	self.widgets['preferences']['vcodec_name'].show_all()
-	self.widgets['add']['vcodec'].show_all()
-	self.widgets['preferences']['vcodec'].show_all()
-	
-	pos = gutils.findKey(self.config.get('vcodec', 0, section='defaults'), self.vcodecs_ids)
-	if pos is not None:
-		self.widgets['preferences']['vcodec'].set_active(int(pos))
-	else:
-		self.widgets['preferences']['vcodec'].set_active(0)
+    self.widgets['preferences']['vcodec_name'].show_all()
+    self.widgets['add']['vcodec'].show_all()
+    self.widgets['preferences']['vcodec'].show_all()
+    
+    pos = gutils.findKey(self.config.get('vcodec', 0, section='defaults'), self.vcodecs_ids)
+    if pos is not None:
+        self.widgets['preferences']['vcodec'].set_active(int(pos))
+    else:
+        self.widgets['preferences']['vcodec'].set_active(0)
 
 def create_tag_vbox(self, widget, tab):
-	for i in widget.get_children():
-		i.destroy()
-	for i in self.tags_ids:
-		tag_id = self.tags_ids[i]
-		tag_name = self.db.Tag.query.filter_by(tag_id=tag_id).first().name
-		tab[i] = gtk.CheckButton(str(tag_name))
-		tab[i].set_active(False)
-		widget.pack_start(tab[i])
-	widget.show_all()
+    for i in widget.get_children():
+        i.destroy()
+    for i in self.tags_ids:
+        tag_id = self.tags_ids[i]
+        tag_name = self.db.session.query(db.Tag).filter_by(tag_id=tag_id).first().name
+        tab[i] = gtk.CheckButton(str(tag_name))
+        tab[i].set_active(False)
+        widget.pack_start(tab[i])
+    widget.show_all()
 
 def remove_hbox(self, widget, tab):
-	number = len(widget.get_children())-1	# last box number
-	try:
-		tab.pop()
-		widget.remove(widget.get_children().pop())
-	except:
-		self.debug.show('List is empty')
-	widget.show_all()
+    number = len(widget.get_children())-1    # last box number
+    try:
+        tab.pop()
+        widget.remove(widget.get_children().pop())
+    except:
+        self.debug.show('List is empty')
+    widget.show_all()
 

Modified: trunk/lib/loan.py
===================================================================
--- trunk/lib/loan.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/loan.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -25,120 +25,121 @@
 import gutils
 import gtk
 import datetime
+import db
 
 def loan_movie(self):
-	people = self.db.Person.query.order_by(self.db.Person.name.asc()).all()
-	model = gtk.ListStore(str)
-	if len(people)&gt;0:
-		for person in people:
-			model.append([person.name])
-		self.widgets['movie']['loan_to'].set_model(model)
-		self.widgets['movie']['loan_to'].set_text_column(0)
-		self.widgets['movie']['loan_to'].set_active(0)
-		self.widgets['w_loan_to'].show()
-	else:
-		gutils.info(self, _(&quot;No person is defined yet.&quot;), self.widgets['window'])
+    people = self.db.session.query(db.Person).order_by(db.people_table.c.name.asc()).all()
+    model = gtk.ListStore(str)
+    if len(people)&gt;0:
+        for person in people:
+            model.append([person.name])
+        self.widgets['movie']['loan_to'].set_model(model)
+        self.widgets['movie']['loan_to'].set_text_column(0)
+        self.widgets['movie']['loan_to'].set_active(0)
+        self.widgets['w_loan_to'].show()
+    else:
+        gutils.info(self, _(&quot;No person is defined yet.&quot;), self.widgets['window'])
 
 def cancel_loan(self):
-	self.widgets['w_loan_to'].hide()
+    self.widgets['w_loan_to'].hide()
 
 def commit_loan(self):
-	person_name = gutils.on_combo_box_entry_changed(self.widgets['movie']['loan_to'])
-	if person_name == '' or person_name is None:
-		return False
-	self.widgets['w_loan_to'].hide()
+    person_name = gutils.on_combo_box_entry_changed(self.widgets['movie']['loan_to'])
+    if person_name == '' or person_name is None:
+        return False
+    self.widgets['w_loan_to'].hide()
 
-	person = self.db.Person.query.filter_by(name=person_name).first()
-	if person is None:
-		self.debug.show(&quot;commit_loan: person doesn't exist&quot;)
-		return False
-	if self._movie_id:
-		movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).first()
-		if not movie:
-			self.debug.show(&quot;commit_loan: wrong movie_id&quot;)
-			return False
-	else:
-		self.debug.show(&quot;commit_loan: movie not selected&quot;)
-		return False
+    person = self.db.session.query(db.Person).filter_by(name=person_name).first()
+    if person is None:
+        self.debug.show(&quot;commit_loan: person doesn't exist&quot;)
+        return False
+    if self._movie_id:
+        movie = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).first()
+        if not movie:
+            self.debug.show(&quot;commit_loan: wrong movie_id&quot;)
+            return False
+    else:
+        self.debug.show(&quot;commit_loan: movie not selected&quot;)
+        return False
 
-	# ask if user wants to loan whole collection
-	loan_whole_collection = False
-	if movie.collection_id&gt;0:
-		response = gutils.question(self, msg=_(&quot;Do you want to loan whole collection?&quot;), parent=self.widgets['window'])
-		if response == gtk.RESPONSE_YES:
-			loan_whole_collection = True
-		elif response == gtk.RESPONSE_CANCEL:
-			return False
-	
-	loan = self.db.Loan(movie_id=movie.movie_id, person_id=person.person_id)
-	if loan_whole_collection:
-		loan.collection_id = movie.collection_id
-	if movie.volume_id&gt;0:
-		loan.volume_id = movie.volume_id
-	if loan.set_loaned():
-		self.update_statusbar(_(&quot;Movie loaned&quot;))
-		self.treeview_clicked()
+    # ask if user wants to loan whole collection
+    loan_whole_collection = False
+    if movie.collection_id&gt;0:
+        response = gutils.question(self, msg=_(&quot;Do you want to loan whole collection?&quot;), parent=self.widgets['window'])
+        if response == gtk.RESPONSE_YES:
+            loan_whole_collection = True
+        elif response == gtk.RESPONSE_CANCEL:
+            return False
+    
+    loan = db.Loan(movie_id=movie.movie_id, person_id=person.person_id)
+    if loan_whole_collection:
+        loan.collection_id = movie.collection_id
+    if movie.volume_id&gt;0:
+        loan.volume_id = movie.volume_id
+    if loan.set_loaned():
+        self.update_statusbar(_(&quot;Movie loaned&quot;))
+        self.treeview_clicked()
 
 def return_loan(self):
-	if self._movie_id:
-		loan = self.db.Loan.query.filter_by(movie_id=self._movie_id, return_date=None).first()
-		if loan is None:
-			movie = self.db.Movie.query.filter_by(movie_id=self._movie_id).first()
-			if movie.collection is not None and movie.collection.loaned:
-				#print len(movie.loans) # FIXME: why it's == 0? (mappers problem?)
-				loan = self.db.Loan.query.filter_by(collection_id=movie.collection.collection_id, return_date=None).first()
-			if movie.volume is not None and movie.volume.loaned:
-				loan = self.db.Loan.query.filter_by(volume_id=movie.volume.volume_id, return_date=None).first()
-		if loan and loan.set_returned():
-			self.treeview_clicked()
+    if self._movie_id:
+        loan = self.db.session.query(db.Loan).filter_by(movie_id=self._movie_id, return_date=None).first()
+        if loan is None:
+            movie = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).first()
+            if movie.collection is not None and movie.collection.loaned:
+                #print len(movie.loans) # FIXME: why it's == 0? (mappers problem?)
+                loan = self.db.session.query(db.Loan).filter_by(collection_id=movie.collection.collection_id, return_date=None).first()
+            if movie.volume is not None and movie.volume.loaned:
+                loan = self.db.session.query(db.Loan).filter_by(volume_id=movie.volume.volume_id, return_date=None).first()
+        if loan and loan.set_returned():
+            self.treeview_clicked()
 
-def get_loan_info(db, movie_id, volume_id=None, collection_id=None):
-	&quot;&quot;&quot;Returns current collection/volume/movie loan data&quot;&quot;&quot;
-	from sqlalchemy import and_, or_
-	movie = db.Movie.query.filter_by(movie_id=movie_id).first()
-	if movie is None:
-		return False
-	
-	# fix or add volume/collection data:
-	if movie.collection_id is not None:
-		collection_id = movie.collection_id
-	if movie.volume_id is not None:
-		volume_id = movie.volume_id
-	
-	if collection_id&gt;0 and volume_id&gt;0:
-		return db.Loan.query.filter(
-				and_(or_(db.Loan.c.collection_id==collection_id,
-						db.Loan.c.volume_id==volume_id,
-						db.Loan.c.movie_id==movie_id),
-					db.Loan.c.return_date==None)).first()
-	elif collection_id&gt;0:
-		return db.Loan.query.filter(
-				and_(or_(db.Loan.c.collection_id==collection_id,
-						db.Loan.c.movie_id==movie_id)),
-					db.Loan.c.return_date==None).first()
-	elif volume_id&gt;0:
-		return db.Loan.query.filter(and_(or_(db.Loan.c.volume_id==volume_id,
-							db.Loan.c.movie_id==movie_id)),
-						db.Loan.c.return_date==None).first()
-	else:
-		return db.Loan.query.filter(db.Loan.c.movie_id==movie_id).filter(db.Loan.c.return_date==None).first()
+def get_loan_info(griffithSql, movie_id, volume_id=None, collection_id=None):
+    &quot;&quot;&quot;Returns current collection/volume/movie loan data&quot;&quot;&quot;
+    from sqlalchemy import and_, or_
+    movie = griffithSql.session.query(db.Movie).filter_by(movie_id=movie_id).first()
+    if movie is None:
+        return False
+    
+    # fix or add volume/collection data:
+    if movie.collection_id is not None:
+        collection_id = movie.collection_id
+    if movie.volume_id is not None:
+        volume_id = movie.volume_id
+    
+    if collection_id&gt;0 and volume_id&gt;0:
+        return griffithSql.session.query(db.Loan).filter(
+                and_(or_(db.loans_table.c.collection_id==collection_id,
+                        db.loans_table.c.volume_id==volume_id,
+                        db.loans_table.c.movie_id==movie_id),
+                    db.loans_table.c.return_date==None)).first()
+    elif collection_id&gt;0:
+        return griffithSql.session.query(db.Loan).filter(
+                and_(or_(db.loans_table.c.collection_id==collection_id,
+                        db.loans_table.c.movie_id==movie_id)),
+                    db.loans_table.c.return_date==None).first()
+    elif volume_id&gt;0:
+        return griffithSql.session.query(db.Loan).filter(and_(or_(db.loans_table.c.volume_id==volume_id,
+                            db.loans_table.c.movie_id==movie_id)),
+                        db.loans_table.c.return_date==None).first()
+    else:
+        return griffithSql.session.query(db.Loan).filter(db.loans_table.c.movie_id==movie_id).filter(db.loans_table.c.return_date==None).first()
 
-def get_loan_history(db, movie_id, volume_id=None, collection_id=None):
-	&quot;&quot;&quot;Returns collection/volume/movie loan history&quot;&quot;&quot;
-	from sqlalchemy import and_, or_, not_
-	if collection_id&gt;0 and volume_id&gt;0:
-		return db.Loan.query.filter(and_(or_(db.Loan.c.collection_id==collection_id,
-							db.Loan.c.volume_id==volume_id,
-							db.Loan.c.movie_id==movie_id),
-						not_(db.Loan.c.return_date==None))).all()
-	elif collection_id&gt;0:
-		return db.Loan.query.filter(and_(or_(db.Loan.c.collection_id==collection_id,
-							db.Loan.c.movie_id==movie_id),
-						not_(db.Loan.c.return_date==None))).all()
-	elif volume_id&gt;0:
-		return db.Loan.query.filter(and_(or_(db.Loan.c.volume_id==volume_id,
-							db.Loan.c.movie_id==movie_id),
-						not_(db.Loan.c.return_date==None))).all()
-	else:
-		return db.Loan.query.filter(db.Loan.c.movie_id==movie_id).filter(~(db.Loan.c.return_date==None)).all()
+def get_loan_history(griffithSql, movie_id, volume_id=None, collection_id=None):
+    &quot;&quot;&quot;Returns collection/volume/movie loan history&quot;&quot;&quot;
+    from sqlalchemy import and_, or_, not_
+    if collection_id&gt;0 and volume_id&gt;0:
+        return griffithSql.session.query(db.Loan).filter(and_(or_(db.loans_table.c.collection_id==collection_id,
+                            db.loans_table.c.volume_id==volume_id,
+                            db.loans_table.c.movie_id==movie_id),
+                        not_(db.loans_table.c.return_date==None))).all()
+    elif collection_id&gt;0:
+        return griffithSql.session.query(db.Loan).filter(and_(or_(db.loans_table.c.collection_id==collection_id,
+                            db.loans_table.c.movie_id==movie_id),
+                        not_(db.loans_table.c.return_date==None))).all()
+    elif volume_id&gt;0:
+        return griffithSql.session.query(db.Loan).filter(and_(or_(db.loans_table.c.volume_id==volume_id,
+                            db.loans_table.c.movie_id==movie_id),
+                        not_(db.loans_table.c.return_date==None))).all()
+    else:
+        return griffithSql.session.query(db.Loan).filter(db.loans_table.c.movie_id==movie_id).filter(~(db.loans_table.c.return_date==None)).all()
 

Modified: trunk/lib/main_treeview.py
===================================================================
--- trunk/lib/main_treeview.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/main_treeview.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -21,494 +21,498 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
+from sqlalchemy import select, desc
+from sqlalchemy.sql.expression import Select
 from gettext import gettext as _
 import gutils
 import os
 import gtk
+import db
 
 def treeview_clicked(self):
-	if self.initialized is False:
-		return False
-	if self.total:
-		treeselection = self.widgets['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		if tmp_iter is None:
-			self.debug.show('Treeview: no selection')
-			return False
-		number = tmp_model.get_value(tmp_iter,0)
-		movie = self.db.Movie.query.filter_by(number=number).first()
+    if self.initialized is False:
+        return False
+    if self.total:
+        treeselection = self.widgets['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        if tmp_iter is None:
+            self.debug.show('Treeview: no selection')
+            return False
+        number = tmp_model.get_value(tmp_iter,0)
+        movie = self.db.session.query(db.Movie).filter_by(number=number).first()
         # FIXME
-		#movie.refresh() # loan data can be obsolete in cache
-		if movie is None:
-			self.debug.show(&quot;Treeview: movie doesn't exists (number=%s)&quot;%number)
-		set_details(self, movie)
-	else:
-		set_details(self, {})
+        #movie.refresh() # loan data can be obsolete in cache
+        if movie is None:
+            self.debug.show(&quot;Treeview: movie doesn't exists (number=%s)&quot;%number)
+        set_details(self, movie)
+    else:
+        set_details(self, {})
 
 def set_details(self, item=None):#{{{
-	from loan import get_loan_info, get_loan_history
-	if item is None:
-		item = {}
-	if item.has_key('movie_id') and item['movie_id']:
-		self._movie_id = item['movie_id']
-	else:
-		self._movie_id = None
-	w = self.widgets['movie']
+    from loan import get_loan_info, get_loan_history
+    if item is None:
+        item = {}
+    if 'movie_id' in item and item['movie_id']:
+        self._movie_id = item['movie_id']
+    else:
+        self._movie_id = None
+    w = self.widgets['movie']
 
-	if item.has_key('number') and item['number']:
-		w['number'].set_text(str(int(item['number'])))
-	else:
-		w['number'].set_text('')
-	if item.has_key('title') and item['title']:
-		w['title'].set_markup(&quot;&lt;b&gt;&lt;span size='large'&gt;%s&lt;/span&gt;&lt;/b&gt;&quot; % gutils.html_encode(item['title']))
-	else:
-		w['title'].set_text('')
-	if item.has_key('o_title') and item['o_title']:
-		w['o_title'].set_markup(&quot;&lt;span size='medium'&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/span&gt;&quot; % gutils.html_encode(item['o_title']))
-	else:
-		w['o_title'].set_text('')
-	if item.has_key('director') and item['director']:
-		w['director'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['director']))
-	else:
-		w['director'].set_text('')
-	if item.has_key('plot') and item['plot']:
-		w['plot'].set_text(str(item['plot']))
-	else:
-		w['plot'].set_text('')
-	if item.has_key('year') and item['year']:
-		w['year'].set_text(str(item['year']))
-	else:
-		w['year'].set_text('')
-	if item.has_key('runtime') and item['runtime']:
-		w['runtime'].set_text(str(int(item['runtime'])))
-	else:
-		w['runtime'].set_text('x')
-	if item.has_key('cast') and item['cast']:
-		w['cast'].set_text(str(item['cast']))
-	else:
-		w['cast'].set_text('')
-	if item.has_key('country') and item['country']:
-		w['country'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['country']))
-	else:
-		w['country'].set_text('')
-	if item.has_key('genre') and item['genre']:
-		w['genre'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['genre']))
-	else:
-		w['genre'].set_text('')
-	if item.has_key('cond') and item['cond']:
-		if str(item['cond']) in [ str(i) for i in range(len(self._conditions)) ]:
-			w['condition'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self._conditions[item['cond']])
-		else:
-			w['condition'].set_text('')
-			self.debug.show(&quot;Wrong value in 'condition' field (movie_id=%s, cond=%s)&quot; % (item['movie_id'], item['cond']))
-	else:
-		w['condition'].set_text('')
-	if item.has_key('region') and item['region']:
-		if str(item['region']) in [ str(i) for i in range(len(self._regions)) ]:
-			w['region'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['region']))
-			if int(item['region']) &lt; 9:
-				self.widgets['tooltips'].set_tip(w['region'], self._regions[int(item['region'])])
-		else:
-			self.debug.show(&quot;Wrong value in 'region' field (movie_id=%s, region=%s)&quot; % (item['movie_id'], item['region']))
-			w['region'].set_text('')
-			self.widgets['tooltips'].set_tip(w['region'], self._regions[0]) # N/A
-	else:
-		w['region'].set_text('')
-		self.widgets['tooltips'].set_tip(w['region'], self._regions[0]) # N/A
-	if item.has_key('layers') and item['layers']:
-		if str(item['layers']) in [ str(i) for i in range(len(self._layers)) ]:
-			w['layers'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self._layers[item['layers']])
-		else:
-			self.debug.show(&quot;Wrong value in 'layers' field (movie_id=%s, layers=%s)&quot; % (item['movie_id'], item['layers']))
-			w['layers'].set_text('')
-	else:
-		w['layers'].set_text('')
-	if item.has_key('color') and item['color']:
-		if str(item['color']) in [ str(i) for i in range(len(self._colors)) ]:
-			w['color'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self._colors[item['color']])
-		else:
-			self.debug.show(&quot;Wrong value in 'color' field (movie_id=%s, color=%s)&quot; % (item['movie_id'], item['color']))
-			w['color'].set_markup('')
-	else:
-		w['color'].set_markup('')
-	if item.has_key('classification') and item['classification']:
-		w['classification'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['classification']))
-	else:
-		w['classification'].set_text('')
-	if item.has_key('studio') and item['studio']:
-		w['studio'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['studio']))
-	else:
-		w['studio'].set_text('')
-	if item.has_key('o_site') and item['o_site']:
-		self._o_site_url = str(item['o_site'])
-		w['go_o_site_button'].set_sensitive(True)
-	else:
-		self._o_site_url = None
-		w['go_o_site_button'].set_sensitive(False)
-	if item.has_key('site') and item['site']:
-		self._site_url = str(item['site'])
-		w['go_site_button'].set_sensitive(True)
-	else:
-		self._site_url = None
-		w['go_site_button'].set_sensitive(False)
-	if item.has_key('trailer') and item['trailer']:
-		self._trailer_url = str(item.trailer)
-		w['go_trailer_button'].set_sensitive(True)
-	else:
-		self._trailer_url = None
-		w['go_trailer_button'].set_sensitive(False)
-	if item.has_key('seen') and item['seen'] == True:
-		w['seen_icon'].set_from_file(os.path.join(self.locations['images'], 'seen.png'))
-	else:
-		w['seen_icon'].set_from_file(os.path.join(self.locations['images'], 'unseen.png'))
-	if item.has_key('notes') and item['notes']:
-		w['notes'].set_text(str(item.notes))
-	else:
-		w['notes'].set_text('')
-	tmp = ''
-	if item.has_key('media_num') and item['media_num']:
-		tmp = str(item.media_num)
-	else:
-		tmp = '0'
-	if item.has_key('medium_id') and item['medium_id']:
-		if item.medium is not None:
-			tmp += ' x ' + item.medium.name
-		else:
-			pass
-	w['medium'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(tmp))
-	if item.has_key('vcodec_id'):
-		if item.vcodec is not None:
-			w['vcodec'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item.vcodec.name))
-		else:
-			w['vcodec'].set_text('')
-	else:
-		w['vcodec'].set_text('')
+    if 'number' in item and item['number']:
+        w['number'].set_text(str(int(item['number'])))
+    else:
+        w['number'].set_text('')
+    if 'title' in item and item['title']:
+        w['title'].set_markup(&quot;&lt;b&gt;&lt;span size='large'&gt;%s&lt;/span&gt;&lt;/b&gt;&quot; % gutils.html_encode(item['title']))
+    else:
+        w['title'].set_text('')
+    if 'o_title' in item and item['o_title']:
+        w['o_title'].set_markup(&quot;&lt;span size='medium'&gt;&lt;i&gt;%s&lt;/i&gt;&lt;/span&gt;&quot; % gutils.html_encode(item['o_title']))
+    else:
+        w['o_title'].set_text('')
+    if 'director' in item and item['director']:
+        w['director'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['director']))
+    else:
+        w['director'].set_text('')
+    if 'plot' in item and item['plot']:
+        w['plot'].set_text(str(item['plot']))
+    else:
+        w['plot'].set_text('')
+    if 'year' in item and item['year']:
+        w['year'].set_text(str(item['year']))
+    else:
+        w['year'].set_text('')
+    if 'runtime' in item and item['runtime']:
+        w['runtime'].set_text(str(int(item['runtime'])))
+    else:
+        w['runtime'].set_text('x')
+    if 'cast' in item and item['cast']:
+        w['cast'].set_text(str(item['cast']))
+    else:
+        w['cast'].set_text('')
+    if 'country' in item and item['country']:
+        w['country'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['country']))
+    else:
+        w['country'].set_text('')
+    if 'genre' in item and item['genre']:
+        w['genre'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['genre']))
+    else:
+        w['genre'].set_text('')
+    if 'cond' in item and item['cond']:
+        if str(item['cond']) in [ str(i) for i in range(len(self._conditions)) ]:
+            w['condition'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self._conditions[item['cond']])
+        else:
+            w['condition'].set_text('')
+            self.debug.show(&quot;Wrong value in 'condition' field (movie_id=%s, cond=%s)&quot; % (item['movie_id'], item['cond']))
+    else:
+        w['condition'].set_text('')
+    if 'region' in item and item['region']:
+        if str(item['region']) in [ str(i) for i in range(len(self._regions)) ]:
+            w['region'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['region']))
+            if int(item['region']) &lt; 9:
+                self.widgets['tooltips'].set_tip(w['region'], self._regions[int(item['region'])])
+        else:
+            self.debug.show(&quot;Wrong value in 'region' field (movie_id=%s, region=%s)&quot; % (item['movie_id'], item['region']))
+            w['region'].set_text('')
+            self.widgets['tooltips'].set_tip(w['region'], self._regions[0]) # N/A
+    else:
+        w['region'].set_text('')
+        self.widgets['tooltips'].set_tip(w['region'], self._regions[0]) # N/A
+    if 'layers' in item and item['layers']:
+        if str(item['layers']) in [ str(i) for i in range(len(self._layers)) ]:
+            w['layers'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self._layers[item['layers']])
+        else:
+            self.debug.show(&quot;Wrong value in 'layers' field (movie_id=%s, layers=%s)&quot; % (item['movie_id'], item['layers']))
+            w['layers'].set_text('')
+    else:
+        w['layers'].set_text('')
+    if 'color' in item and item['color']:
+        if str(item['color']) in [ str(i) for i in range(len(self._colors)) ]:
+            w['color'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self._colors[item['color']])
+        else:
+            self.debug.show(&quot;Wrong value in 'color' field (movie_id=%s, color=%s)&quot; % (item['movie_id'], item['color']))
+            w['color'].set_markup('')
+    else:
+        w['color'].set_markup('')
+    if 'classification' in item and item['classification']:
+        w['classification'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['classification']))
+    else:
+        w['classification'].set_text('')
+    if 'studio' in item and item['studio']:
+        w['studio'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item['studio']))
+    else:
+        w['studio'].set_text('')
+    if 'o_site' in item and item['o_site']:
+        self._o_site_url = str(item['o_site'])
+        w['go_o_site_button'].set_sensitive(True)
+    else:
+        self._o_site_url = None
+        w['go_o_site_button'].set_sensitive(False)
+    if 'site' in item and item['site']:
+        self._site_url = str(item['site'])
+        w['go_site_button'].set_sensitive(True)
+    else:
+        self._site_url = None
+        w['go_site_button'].set_sensitive(False)
+    if 'trailer' in item and item['trailer']:
+        self._trailer_url = str(item.trailer)
+        w['go_trailer_button'].set_sensitive(True)
+    else:
+        self._trailer_url = None
+        w['go_trailer_button'].set_sensitive(False)
+    if 'seen' in item and item['seen'] == True:
+        w['seen_icon'].set_from_file(os.path.join(self.locations['images'], 'seen.png'))
+    else:
+        w['seen_icon'].set_from_file(os.path.join(self.locations['images'], 'unseen.png'))
+    if 'notes' in item and item['notes']:
+        w['notes'].set_text(str(item.notes))
+    else:
+        w['notes'].set_text('')
+    tmp = ''
+    if 'media_num' in item and item['media_num']:
+        tmp = str(item.media_num)
+    else:
+        tmp = '0'
+    if 'medium_id' in item and item['medium_id']:
+        if item.medium is not None:
+            tmp += ' x ' + item.medium.name
+        else:
+            pass
+    w['medium'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(tmp))
+    if 'vcodec_id' in item:
+        if item.vcodec is not None:
+            w['vcodec'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % gutils.html_encode(item.vcodec.name))
+        else:
+            w['vcodec'].set_text('')
+    else:
+        w['vcodec'].set_text('')
 
-	# poster
-	if item.has_key('image') and item['image']:
-		tmp_dest = self.locations['posters']
-		tmp_img = os.path.join(tmp_dest, &quot;m_%s.jpg&quot;%item['image'])
-		tmp_img2 = os.path.join(tmp_dest, &quot;%s.jpg&quot;%item['image'])
-		if os.path.isfile(tmp_img2):
-			image_path = tmp_img
-			self.widgets['add']['delete_poster'].set_sensitive(True)
-			self.widgets['menu']['delete_poster'].set_sensitive(True)
-			w['picture_button'].set_sensitive(True)
-		else:
-			image_path = os.path.join(self.locations['images'], 'default.png')
-			self.widgets['add']['delete_poster'].set_sensitive(False)
-			self.widgets['menu']['delete_poster'].set_sensitive(False)
-			w['picture_button'].set_sensitive(False)
-		# lets see if we have a scaled down medium image already created
-		if not os.path.isfile(image_path):
-			# if not, lets make one for future use :D
-			original_image = os.path.join(tmp_dest, &quot;%s.jpg&quot;%item.image)
-			if os.path.isfile(original_image):
-				gutils.make_medium_image(self, &quot;%s.jpg&quot;%item.image)
-	else:
-		image_path = os.path.join(self.locations['images'], 'default.png')
-		w['picture_button'].set_sensitive(False)
-	w['picture'].set_from_file(image_path)
-	# ratig
-	rimage = int(self.config.get('rating_image', 0))
-	if rimage:
-		prefix = ''
-	else:
-		prefix = 'meter'
-	if item.has_key('rating') and item['rating']:
-		rating_file = &quot;%s/%s0%d.png&quot; % (self.locations['images'], prefix, item['rating'])
-	else:
-		rating_file = &quot;%s/%s0%d.png&quot; % (self.locations['images'], prefix, 0)
-	handler = w['image_rating'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(rating_file))
-	gutils.garbage(handler)
+    # poster
+    if 'image' in item and item['image']:
+        tmp_dest = self.locations['posters']
+        tmp_img = os.path.join(tmp_dest, &quot;m_%s.jpg&quot;%item['image'])
+        tmp_img2 = os.path.join(tmp_dest, &quot;%s.jpg&quot;%item['image'])
+        if os.path.isfile(tmp_img2):
+            image_path = tmp_img
+            self.widgets['add']['delete_poster'].set_sensitive(True)
+            self.widgets['menu']['delete_poster'].set_sensitive(True)
+            w['picture_button'].set_sensitive(True)
+        else:
+            image_path = os.path.join(self.locations['images'], 'default.png')
+            self.widgets['add']['delete_poster'].set_sensitive(False)
+            self.widgets['menu']['delete_poster'].set_sensitive(False)
+            w['picture_button'].set_sensitive(False)
+        # lets see if we have a scaled down medium image already created
+        if not os.path.isfile(image_path):
+            # if not, lets make one for future use :D
+            original_image = os.path.join(tmp_dest, &quot;%s.jpg&quot;%item.image)
+            if os.path.isfile(original_image):
+                gutils.make_medium_image(self, &quot;%s.jpg&quot;%item.image)
+    else:
+        image_path = os.path.join(self.locations['images'], 'default.png')
+        w['picture_button'].set_sensitive(False)
+    w['picture'].set_from_file(image_path)
+    # ratig
+    rimage = int(self.config.get('rating_image', 0))
+    if rimage:
+        prefix = ''
+    else:
+        prefix = 'meter'
+    if 'rating' in item and item['rating']:
+        rating_file = &quot;%s/%s0%d.png&quot; % (self.locations['images'], prefix, item['rating'])
+    else:
+        rating_file = &quot;%s/%s0%d.png&quot; % (self.locations['images'], prefix, 0)
+    handler = w['image_rating'].set_from_pixbuf(gtk.gdk.pixbuf_new_from_file(rating_file))
+    gutils.garbage(handler)
 
-	# check loan status and adjust buttons and history box
-	if item.has_key('loaned') and item['loaned'] == True:
-		self.widgets['popups']['loan'].set_sensitive(False)
-		self.widgets['popups']['email'].set_sensitive(True)
-		self.widgets['popups']['return'].set_sensitive(True)
-		self.widgets['menu']['loan'].set_sensitive(False)
-		self.widgets['menu']['email'].set_sensitive(True)
-		self.widgets['menu']['return'].set_sensitive(True)
-		w['loan_button'].set_sensitive(False)
-		w['email_reminder_button'].set_sensitive(True)
-		w['return_button'].set_sensitive(True)
-		
-		data_loan = get_loan_info(self.db, collection_id=item['collection_id'], volume_id=item['volume_id'], movie_id=item['movie_id'])
-		if data_loan is None:
-			item.loaned = False
-		else:
-			data_person = self.db.Person.query.filter_by(person_id=data_loan.person.person_id).first()
-			self.person_name = str(data_person.name)
-			self.person_email = str(data_person.email)
-			self.loan_date = str(data_loan.date)
-			w['loan_info'].set_use_markup(False)
-			w['loan_info'].set_label(_(&quot;This movie has been loaned to &quot;) + self.person_name + _(&quot; on &quot;) + self.loan_date[:10])
-	if item.has_key('loaned') and item['loaned'] != True: # &quot;loaned&quot; status can be changed above, so don't use &quot;else:&quot; in this line
-		self.widgets['popups']['loan'].set_sensitive(True)
-		self.widgets['popups']['email'].set_sensitive(False)
-		self.widgets['popups']['return'].set_sensitive(False)
-		self.widgets['menu']['loan'].set_sensitive(True)
-		self.widgets['menu']['email'].set_sensitive(False)
-		self.widgets['menu']['return'].set_sensitive(False)
-		w['return_button'].set_sensitive(False)
-		w['email_reminder_button'].set_sensitive(False)
-		w['loan_button'].set_sensitive(True)
-		w['loan_info'].set_markup(&quot;&lt;b&gt;%s&lt;/b&gt;&quot; % _(&quot;Movie not loaned&quot;))
+    # check loan status and adjust buttons and history box
+    if 'loaned' in item and item['loaned'] == True:
+        self.widgets['popups']['loan'].set_sensitive(False)
+        self.widgets['popups']['email'].set_sensitive(True)
+        self.widgets['popups']['return'].set_sensitive(True)
+        self.widgets['menu']['loan'].set_sensitive(False)
+        self.widgets['menu']['email'].set_sensitive(True)
+        self.widgets['menu']['return'].set_sensitive(True)
+        w['loan_button'].set_sensitive(False)
+        w['email_reminder_button'].set_sensitive(True)
+        w['return_button'].set_sensitive(True)
+        
+        data_loan = get_loan_info(self.db, collection_id=item['collection_id'], volume_id=item['volume_id'], movie_id=item['movie_id'])
+        if data_loan is None:
+            item.loaned = False
+        else:
+            data_person = self.db.session.query(db.Person).filter_by(person_id=data_loan.person.person_id).first()
+            self.person_name = str(data_person.name)
+            self.person_email = str(data_person.email)
+            self.loan_date = str(data_loan.date)
+            w['loan_info'].set_use_markup(False)
+            w['loan_info'].set_label(_(&quot;This movie has been loaned to &quot;) + self.person_name + _(&quot; on &quot;) + self.loan_date[:10])
+    if 'loaned' in item and item['loaned'] != True: # &quot;loaned&quot; status can be changed above, so don't use &quot;else:&quot; in this line
+        self.widgets['popups']['loan'].set_sensitive(True)
+        self.widgets['popups']['email'].set_sensitive(False)
+        self.widgets['popups']['return'].set_sensitive(False)
+        self.widgets['menu']['loan'].set_sensitive(True)
+        self.widgets['menu']['email'].set_sensitive(False)
+        self.widgets['menu']['return'].set_sensitive(False)
+        w['return_button'].set_sensitive(False)
+        w['email_reminder_button'].set_sensitive(False)
+        w['loan_button'].set_sensitive(True)
+        w['loan_info'].set_markup(&quot;&lt;b&gt;%s&lt;/b&gt;&quot; % _(&quot;Movie not loaned&quot;))
 
-	# loan history	
-	self.loans_treemodel.clear()
-	if item.has_key('collection_id') or item.has_key('volume_id') or item.has_key('movie_id'):
-		loans = get_loan_history(self.db, collection_id=item['collection_id'], volume_id=item['volume_id'], movie_id=item['movie_id'])
-		for loan in loans:
-			myiter = self.loans_treemodel.append(None)
-			self.loans_treemodel.set_value(myiter, 0,'%s' % str(loan.date)[:10])
-			if loan.return_date and  loan.return_date != '':
-				self.loans_treemodel.set_value(myiter, 1, str(loan.return_date)[:10])
-			else:
-				self.loans_treemodel.set_value(myiter, 1, &quot;---&quot;)
-			person = self.db.Person.query.filter_by(person_id=loan.person.person_id).first()
-			self.loans_treemodel.set_value(myiter, 2, person.name)
+    # loan history    
+    self.loans_treemodel.clear()
+    if 'collection_id' in item or 'volume_id' in item or 'movie_id' in item:
+        loans = get_loan_history(self.db, collection_id=item['collection_id'], volume_id=item['volume_id'], movie_id=item['movie_id'])
+        for loan in loans:
+            myiter = self.loans_treemodel.append(None)
+            self.loans_treemodel.set_value(myiter, 0,'%s' % str(loan.date)[:10])
+            if loan.return_date and  loan.return_date != '':
+                self.loans_treemodel.set_value(myiter, 1, str(loan.return_date)[:10])
+            else:
+                self.loans_treemodel.set_value(myiter, 1, &quot;---&quot;)
+            person = self.db.session.query(db.Person).filter_by(person_id=loan.person.person_id).first()
+            self.loans_treemodel.set_value(myiter, 2, person.name)
 
-	# volumes/collections
-	if item.has_key('volume_id') and item['volume_id']&gt;0:
-		if item.has_key('volume') and item['volume']:
-			w['volume'].set_markup(&quot;&lt;b&gt;%s&lt;/b&gt;&quot; % gutils.html_encode(item['volume'].name))
-			w['show_volume_button'].set_sensitive(True)
-		else:
-			w['volume'].set_text('')
-			w['show_volume_button'].set_sensitive(False)
-	else:
-			w['volume'].set_text('')
-			w['show_volume_button'].set_sensitive(False)
-	if item.has_key('collection_id') and item['collection_id']&gt;0:
-		if item.has_key('collection') and item['collection']:
-			w['collection'].set_markup(&quot;&lt;b&gt;%s&lt;/b&gt;&quot; % gutils.html_encode(item['collection'].name))
-			w['show_collection_button'].set_sensitive(True)
-		else:
-			w['collection'].set_text('')
-			w['show_collection_button'].set_sensitive(False)
-	else:
-		w['collection'].set_text('')
-		w['show_collection_button'].set_sensitive(False)
+    # volumes/collections
+    if 'volume_id' in item and item['volume_id']&gt;0:
+        if 'volume' in item and item['volume']:
+            w['volume'].set_markup(&quot;&lt;b&gt;%s&lt;/b&gt;&quot; % gutils.html_encode(item['volume'].name))
+            w['show_volume_button'].set_sensitive(True)
+        else:
+            w['volume'].set_text('')
+            w['show_volume_button'].set_sensitive(False)
+    else:
+            w['volume'].set_text('')
+            w['show_volume_button'].set_sensitive(False)
+    if 'collection_id' in item and item['collection_id']&gt;0:
+        if 'collection' in item and item['collection']:
+            w['collection'].set_markup(&quot;&lt;b&gt;%s&lt;/b&gt;&quot; % gutils.html_encode(item['collection'].name))
+            w['show_collection_button'].set_sensitive(True)
+        else:
+            w['collection'].set_text('')
+            w['show_collection_button'].set_sensitive(False)
+    else:
+        w['collection'].set_text('')
+        w['show_collection_button'].set_sensitive(False)
 
-	# languages
-	for i in w['audio_vbox'].get_children():
-		i.destroy()
-	for i in w['subtitle_vbox'].get_children():
-		i.destroy()
-	if item.has_key('languages') and len(item['languages'])&gt;0:
-		for i in item['languages']:
-			if i.type == 3: # subtitles
-				if i.subformat:
-					tmp = &quot;%s - %s&quot; % (i.language.name, i.subformat.name)
-				else:
-					tmp = &quot;%s&quot; % i.language.name
-				w['subtitle_vbox'].pack_start(gtk.Label(tmp))
-			else:
-				language = i.language.name
-				if i.type is not None and len(self._lang_types[i.type])&gt;0:
-					language += &quot; &lt;i&gt;%s&lt;/i&gt;&quot; % self._lang_types[i.type]
-				tmp = ''
-				if i.achannel:
-					tmp = i.achannel.name
-				if i.acodec:
-					if len(tmp)&gt;0:
-						tmp += &quot;, %s&quot; % i.acodec.name
-					else:
-						tmp = i.acodec.name
-				if len(tmp)&gt;0:
-					tmp = &quot;%s (%s)&quot; % (language, tmp)
-				else:
-					tmp = language
-				widget = gtk.Label(tmp)
-				widget.set_use_markup(True)
-				w['audio_vbox'].pack_start(widget)
-	w['audio_vbox'].show_all()
-	w['subtitle_vbox'].show_all()
-	#tags
-	if item.has_key('tags'):
-		tmp = ''
-		for tag in item['tags']:
-			tmp += &quot;%s, &quot; % tag.name
-		tmp = tmp[:-2] # cut last comma
-		w['tags'].set_text(tmp)
-	#}}}
-	
+    # languages
+    for i in w['audio_vbox'].get_children():
+        i.destroy()
+    for i in w['subtitle_vbox'].get_children():
+        i.destroy()
+    if 'languages' in item and len(item['languages'])&gt;0:
+        for i in item['languages']:
+            if i.type == 3: # subtitles
+                if i.subformat:
+                    tmp = &quot;%s - %s&quot; % (i.language.name, i.subformat.name)
+                else:
+                    tmp = &quot;%s&quot; % i.language.name
+                w['subtitle_vbox'].pack_start(gtk.Label(tmp))
+            else:
+                language = i.language.name
+                if i.type is not None and len(self._lang_types[i.type])&gt;0:
+                    language += &quot; &lt;i&gt;%s&lt;/i&gt;&quot; % self._lang_types[i.type]
+                tmp = ''
+                if i.achannel:
+                    tmp = i.achannel.name
+                if i.acodec:
+                    if len(tmp)&gt;0:
+                        tmp += &quot;, %s&quot; % i.acodec.name
+                    else:
+                        tmp = i.acodec.name
+                if len(tmp)&gt;0:
+                    tmp = &quot;%s (%s)&quot; % (language, tmp)
+                else:
+                    tmp = language
+                widget = gtk.Label(tmp)
+                widget.set_use_markup(True)
+                w['audio_vbox'].pack_start(widget)
+    w['audio_vbox'].show_all()
+    w['subtitle_vbox'].show_all()
+    #tags
+    if 'tags' in item:
+        tmp = ''
+        for tag in item['tags']:
+            tmp += &quot;%s, &quot; % tag.name
+        tmp = tmp[:-2] # cut last comma
+        w['tags'].set_text(tmp)
+    #}}}
+    
 def populate(self, movies=None, where=None):#{{{
-	if self.initialized is False:
-		return False
-	from sqlalchemy import select, desc
-	
-	if movies is None:
-		movies = select([self.db.Movie.c.number,
-			self.db.Movie.c.o_title, self.db.Movie.c.title,
-			self.db.Movie.c.director, self.db.Movie.c.image,
-			self.db.Movie.c.genre, self.db.Movie.c.seen,
-			self.db.Movie.c.year, self.db.Movie.c.runtime,
-			self.db.Movie.c.rating])
-	#if isinstance(movies, Select):
-	if 1==1: # FIXME
-		if not where: # because of possible 'seen', 'loaned', 'collection_id' in where
-			# seen / loaned
-			loaned_only = self.widgets['menu']['loaned_movies'].get_active()
-			not_seen_only = self.widgets['menu']['not_seen_movies'].get_active()
-			if loaned_only:
-				movies.append_whereclause(self.db.Movie.c.loaned==True)
-			if not_seen_only:
-				movies.append_whereclause(self.db.Movie.c.seen==False)
-			# collection
-			pos = self.widgets['filter']['collection'].get_active()
-			if pos &gt;= 0:
-				col_id = self.collection_combo_ids[pos]
-				if col_id &gt; 0:
-					movies.append_whereclause(self.db.Movie.c.collection_id==col_id)
-			# volume
-			pos = self.widgets['filter']['volume'].get_active()
-			if pos &gt;= 0:
-				vol_id = self.volume_combo_ids[pos]
-				if vol_id &gt; 0:
-					movies.append_whereclause(self.db.Movie.c.volume_id==vol_id)
-			# loaned to
-			pos = self.widgets['filter']['loanedto'].get_active()
-			if pos &gt;= 0:
-				per_id = self.loanedto_combo_ids[pos]
-				if per_id &gt; 0:
-					from sqlalchemy import join, exists, and_
-					loan_exists = exists([self.db.Loan.c.movie_id], \
-						and_(self.db.Movie.c.movie_id==self.db.Loan.c.movie_id, self.db.Loan.c.person_id==per_id, self.db.Loan.c.return_date==None))
-					movies.append_whereclause(loan_exists)
-					#loan_join = join(self.db.metadata.tables['movies'], \
-					#	self.db.metadata.tables['loans'], \
-					#	self.db.metadata.tables['movies'].c.movie_id==self.db.metadata.tables['loans'].c.movie_id)
-					#movies = movies.select_from(loan_join)
-			# tag
-			pos = self.widgets['filter']['tag'].get_active()
-			if pos &gt;= 0:
-				tag_id = self.bytag_combo_ids[pos]
-				if tag_id &gt; 0:
-					from sqlalchemy import join, exists, and_
-					tag_exists = exists([self.db.MovieTag.c.movie_id], \
-						and_(self.db.Movie.c.movie_id==self.db.MovieTag.c.movie_id, self.db.MovieTag.c.tag_id==tag_id))
-					movies.append_whereclause(tag_exists)
-		
-		# select sort column
-		sort_column_name = self.config.get('sortby', 'number', section='mainlist')
-		sort_reverse = self.config.get('sortby_reverse', False, section='mainlist')
-		for i in sort_column_name.split(','):
-			if self.db.Movie.c.has_key(i):
-				if sort_reverse:
-					movies.append_order_by(desc(self.db.Movie.c[i]))
-				else:
-					movies.append_order_by(self.db.Movie.c[i])
-		
-		# additional whereclause (volume_id, collection_id, ...)
-		if where:
-			for i in where:
-				if self.db.Movie.c.has_key(i):
-					movies.append_whereclause(self.db.Movie.c[i]==where[i])
-		movies = movies.execute().fetchall()
+    if self.initialized is False:
+        return False
+    
+    if movies is None:
+        movies = select([db.Movie.number,
+                 db.Movie.o_title, db.Movie.title,
+                 db.Movie.director, db.Movie.image,
+                 db.Movie.genre, db.Movie.seen,
+                 db.Movie.year, db.Movie.runtime,
+                 db.Movie.rating], bind=self.db.session.bind)
+    if isinstance(movies, Select):
+        if not where: # because of possible 'seen', 'loaned', 'collection_id' in where
+            # seen / loaned
+            loaned_only = self.widgets['menu']['loaned_movies'].get_active()
+            not_seen_only = self.widgets['menu']['not_seen_movies'].get_active()
+            if loaned_only:
+                movies.append_whereclause(db.Movie.loaned==True)
+            if not_seen_only:
+                movies.append_whereclause(db.Movie.seen==False)
+            # collection
+            pos = self.widgets['filter']['collection'].get_active()
+            if pos &gt;= 0:
+                col_id = self.collection_combo_ids[pos]
+                if col_id &gt; 0:
+                    movies.append_whereclause(db.Movie.collection_id==col_id)
+            # volume
+            pos = self.widgets['filter']['volume'].get_active()
+            if pos &gt;= 0:
+                vol_id = self.volume_combo_ids[pos]
+                if vol_id &gt; 0:
+                    movies.append_whereclause(db.Movie.volume_id==vol_id)
+            # loaned to
+            pos = self.widgets['filter']['loanedto'].get_active()
+            if pos &gt;= 0:
+                per_id = self.loanedto_combo_ids[pos]
+                if per_id &gt; 0:
+                    from sqlalchemy import join, exists, and_
+                    loan_exists = exists([db.loans_table.c.movie_id], \
+                        and_(db.Movie.movie_id==db.loans_table.c.movie_id, db.loans_table.c.person_id==per_id, db.loans_table.c.return_date==None))
+                    movies.append_whereclause(loan_exists)
+                    #loan_join = join(self.db.metadata.tables['movies'], \
+                    #    self.db.metadata.tables['loans'], \
+                    #    self.db.metadata.tables['movies'].movie_id==self.db.metadata.tables['loans'].movie_id)
+                    #movies = movies.select_from(loan_join)
+            # tag
+            pos = self.widgets['filter']['tag'].get_active()
+            if pos &gt;= 0:
+                tag_id = self.bytag_combo_ids[pos]
+                if tag_id &gt; 0:
+                    from sqlalchemy import join, exists, and_
+                    tag_exists = exists([db.MovieTag.movie_id], \
+                        and_(db.Movie.movie_id==db.MovieTag.movie_id, db.MovieTag.tag_id==tag_id))
+                    movies.append_whereclause(tag_exists)
+        
+        # select sort column
+        sort_column_name = self.config.get('sortby', 'number', section='mainlist')
+        sort_reverse = self.config.get('sortby_reverse', False, section='mainlist')
+        
+        from sqlalchemy.orm.util import class_mapper, object_mapper
+        for i in sort_column_name.split(','):
+            #if db.Movie.has_key(i):
+            if db.movies_table.columns.has_key(i):
+                if sort_reverse:
+                    movies.append_order_by(desc(db.movies_table.columns[i]))
+                else:
+                    movies.append_order_by(db.movies_table.columns[i])
+        
+        # additional whereclause (volume_id, collection_id, ...)
+        if where:
+            for i in where:
+                if i in db.Movie:
+                    movies.append_whereclause(db.Movie[i]==where[i])
+        movies = movies.execute().fetchall()
 
-	self.total = len(movies)
-	# disable refreshing while inserting
-	self.widgets['treeview'].freeze_child_notify()
-	self.widgets['treeview'].set_model(None)
+    self.total = len(movies)
+    # disable refreshing while inserting
+    self.widgets['treeview'].freeze_child_notify()
+    self.widgets['treeview'].set_model(None)
 
-	# save user sort column
-	sort_column_id, order = self.treemodel.get_sort_column_id()
+    # save user sort column
+    sort_column_id, order = self.treemodel.get_sort_column_id()
 
-	# new treemodel (faster and prevents some problems)
-	self.treemodel = gtk.TreeStore(str, gtk.gdk.Pixbuf, str, str, str, str, bool, str, str, int)
+    # new treemodel (faster and prevents some problems)
+    self.treemodel = gtk.TreeStore(str, gtk.gdk.Pixbuf, str, str, str, str, bool, str, str, int)
 
-	# check preferences to hide or show columns
-	if self.config.get('number', True, 'mainlist') == True:
-		self.number_column.set_visible(True)
-	else:
-		self.number_column.set_visible(False)
-	if self.config.get('otitle', True, 'mainlist') == True:
-		self.otitle_column.set_visible(True)
-	else:
-		self.otitle_column.set_visible(False)
-	if self.config.get('title', True, 'mainlist') == True:
-		self.title_column.set_visible(True)
-	else:
-		self.title_column.set_visible(False)
-	if self.config.get('director', True, 'mainlist') == True:
-		self.director_column.set_visible(True)
-	else:
-		self.director_column.set_visible(False)
-	if self.config.get('image', True, 'mainlist') == True:
-		self.image_column.set_visible(True)
-	else:
-		self.image_column.set_visible(False)
-	if self.config.get('genre', True, 'mainlist') == True:
-		self.genre_column.set_visible(True)
-	else:
-		self.genre_column.set_visible(False)
-	if self.config.get('seen', True, 'mainlist') == True:
-		self.seen_column.set_visible(True)
-	else:
-		self.seen_column.set_visible(False)
-	if self.config.get('year', True, 'mainlist') == True:
-		self.year_column.set_visible(True)
-	else:
-		self.year_column.set_visible(False)
-	if self.config.get('runtime', True, 'mainlist') == True:
-		self.runtime_column.set_visible(True)
-	else:
-		self.runtime_column.set_visible(False)
-	if self.config.get('rating', True, 'mainlist') == True:
-		self.rating_column.set_visible(True)
-	else:
-		self.rating_column.set_visible(False)
-		
-	for movie in movies:
-		myiter = self.treemodel.append(None)
-		
-		self.treemodel.set_value(myiter,0,'%004d' % int(movie.number))
+    # check preferences to hide or show columns
+    if self.config.get('number', True, 'mainlist') == True:
+        self.number_column.set_visible(True)
+    else:
+        self.number_column.set_visible(False)
+    if self.config.get('otitle', True, 'mainlist') == True:
+        self.otitle_column.set_visible(True)
+    else:
+        self.otitle_column.set_visible(False)
+    if self.config.get('title', True, 'mainlist') == True:
+        self.title_column.set_visible(True)
+    else:
+        self.title_column.set_visible(False)
+    if self.config.get('director', True, 'mainlist') == True:
+        self.director_column.set_visible(True)
+    else:
+        self.director_column.set_visible(False)
+    if self.config.get('image', True, 'mainlist') == True:
+        self.image_column.set_visible(True)
+    else:
+        self.image_column.set_visible(False)
+    if self.config.get('genre', True, 'mainlist') == True:
+        self.genre_column.set_visible(True)
+    else:
+        self.genre_column.set_visible(False)
+    if self.config.get('seen', True, 'mainlist') == True:
+        self.seen_column.set_visible(True)
+    else:
+        self.seen_column.set_visible(False)
+    if self.config.get('year', True, 'mainlist') == True:
+        self.year_column.set_visible(True)
+    else:
+        self.year_column.set_visible(False)
+    if self.config.get('runtime', True, 'mainlist') == True:
+        self.runtime_column.set_visible(True)
+    else:
+        self.runtime_column.set_visible(False)
+    if self.config.get('rating', True, 'mainlist') == True:
+        self.rating_column.set_visible(True)
+    else:
+        self.rating_column.set_visible(False)
+        
+    for movie in movies:
+        myiter = self.treemodel.append(None)
+        
+        self.treemodel.set_value(myiter,0,'%004d' % int(movie.number))
 
-		if self.config.get('image', True, section='mainlist') == True:
-			tmp_dest = self.locations['posters']
-			tmp_img = os.path.join(tmp_dest, &quot;t_%s.jpg&quot; % str(movie.image))
-			if movie.image and os.path.isfile(tmp_img):
-				image_path = tmp_img
-			else:
-				image_path = os.path.join(self.locations['images'], 'default_thumbnail.png')
-			# lets see if we have a scaled down thumbnail already created
-			if os.path.isfile(os.path.join(tmp_dest, &quot;t_%s.jpg&quot; % str(movie.image))):
-				pass
-			else:
-				# if not, lets make one for future use :D
-				original_image = os.path.join(tmp_dest, &quot;%s.jpg&quot; % movie.image)
-				if os.path.isfile(original_image):
-					gutils.make_thumbnail(self, &quot;%s.jpg&quot; % movie.image)
-				else:
-					self.Image.set_from_file(&quot;%s/default_thumbnail.png&quot; % self.locations['images'])
-					pixbuf = self.Image.get_pixbuf()
-			self.Image.set_from_file(image_path)
-			pixbuf = self.Image.get_pixbuf()
-			self.treemodel.set_value(myiter, 1, pixbuf)
-		self.treemodel.set_value(myiter,2,movie.o_title)
-		self.treemodel.set_value(myiter,3,movie.title)
-		self.treemodel.set_value(myiter,4,movie.director)
-		self.treemodel.set_value(myiter,5,movie.genre)
-		self.treemodel.set_value(myiter,6,movie.seen)
-		if movie.year is not None and movie.year is int:
-			self.treemodel.set_value(myiter,7,movie.year)
-		if movie.runtime is not None and movie.runtime is int:
-			self.treemodel.set_value(myiter,8, '%003d' % movie.runtime + _(' min'))
-		if movie.rating is not None and movie.rating is int:
-			self.treemodel.set_value(myiter,9,movie.rating)
+        if self.config.get('image', True, section='mainlist') == True:
+            tmp_dest = self.locations['posters']
+            tmp_img = os.path.join(tmp_dest, &quot;t_%s.jpg&quot; % str(movie.image))
+            if movie.image and os.path.isfile(tmp_img):
+                image_path = tmp_img
+            else:
+                image_path = os.path.join(self.locations['images'], 'default_thumbnail.png')
+            # lets see if we have a scaled down thumbnail already created
+            if os.path.isfile(os.path.join(tmp_dest, &quot;t_%s.jpg&quot; % str(movie.image))):
+                pass
+            else:
+                # if not, lets make one for future use :D
+                original_image = os.path.join(tmp_dest, &quot;%s.jpg&quot; % movie.image)
+                if os.path.isfile(original_image):
+                    gutils.make_thumbnail(self, &quot;%s.jpg&quot; % movie.image)
+                else:
+                    self.Image.set_from_file(&quot;%s/default_thumbnail.png&quot; % self.locations['images'])
+                    pixbuf = self.Image.get_pixbuf()
+            self.Image.set_from_file(image_path)
+            pixbuf = self.Image.get_pixbuf()
+            self.treemodel.set_value(myiter, 1, pixbuf)
+        self.treemodel.set_value(myiter,2,movie.o_title)
+        self.treemodel.set_value(myiter,3,movie.title)
+        self.treemodel.set_value(myiter,4,movie.director)
+        self.treemodel.set_value(myiter,5,movie.genre)
+        self.treemodel.set_value(myiter,6,movie.seen)
+        if movie.year is not None and movie.year is int:
+            self.treemodel.set_value(myiter,7,movie.year)
+        if movie.runtime is not None and movie.runtime is int:
+            self.treemodel.set_value(myiter,8, '%003d' % movie.runtime + _(' min'))
+        if movie.rating is not None and movie.rating is int:
+            self.treemodel.set_value(myiter,9,movie.rating)
 
-	# restore user sort column
-	if sort_column_id is not None:
-		self.treemodel.set_sort_column_id(sort_column_id, gtk.SORT_ASCENDING)
-	
-	# add new treemodel and allow refreshs again
-	self.widgets['treeview'].set_model(self.treemodel)
-	self.widgets['treeview'].thaw_child_notify()
-	self.widgets['treeview'].set_cursor_on_cell(0)
-	self.count_statusbar()
+    # restore user sort column
+    if sort_column_id is not None:
+        self.treemodel.set_sort_column_id(sort_column_id, gtk.SORT_ASCENDING)
+    
+    # add new treemodel and allow refreshs again
+    self.widgets['treeview'].set_model(self.treemodel)
+    self.widgets['treeview'].thaw_child_notify()
+    self.widgets['treeview'].set_cursor_on_cell(0)
+    self.count_statusbar()
 #}}}
 
 # vim: fdm=marker

Modified: trunk/lib/movie.py
===================================================================
--- trunk/lib/movie.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/movie.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -34,262 +34,262 @@
 import tempfile
 
 class Movie:
-	cast = None
-	classification = None
-	country = None
-	director = None
-	genre = None
-	image = None
-	notes = None
-	number = None
-	o_site = None
-	o_title = None
-	plot = None
-	rating = None
-	runtime = None
-	site = None
-	studio = None
-	title = None
-	trailer = None
-	year = None
-	
-	movie_id = None
-	debug = False
-	locations = None
-	engine_author = None
-	engine_description = None
-	engine_language = None
-	engine_name = None
-	engine_version = None
-	page = None
-	url = None
-	image_url = None
-	encode = 'iso-8859-1'
-	fields_to_fetch = []
-	
-	# functions that plugin should implement: {{{
-	def initialize(self):
-		pass
-	def get_cast(self):
-		pass
-	def get_classification(self):
-		pass
-	def get_country(self):
-		pass
-	def get_director(self):
-		pass
-	def get_genre(self):
-		pass
-	def get_image(self):
-		pass
-	def get_notes(self):
-		pass
-	def get_o_site(self):
-		pass
-	def get_o_title(self):
-		pass
-	def get_plot(self):
-		pass
-	def get_rating(self):
-		pass
-	def get_runtime(self):
-		pass
-	def get_site(self):
-		pass
-	def get_studio(self):
-		pass
-	def get_title(self):
-		pass
-	def get_trailer(self):
-		pass
-	def get_year(self):
-		pass
-	#}}}
+    cast = None
+    classification = None
+    country = None
+    director = None
+    genre = None
+    image = None
+    notes = None
+    number = None
+    o_site = None
+    o_title = None
+    plot = None
+    rating = None
+    runtime = None
+    site = None
+    studio = None
+    title = None
+    trailer = None
+    year = None
+    
+    movie_id = None
+    debug = False
+    locations = None
+    engine_author = None
+    engine_description = None
+    engine_language = None
+    engine_name = None
+    engine_version = None
+    page = None
+    url = None
+    image_url = None
+    encode = 'iso-8859-1'
+    fields_to_fetch = []
+    
+    # functions that plugin should implement: {{{
+    def initialize(self):
+        pass
+    def get_cast(self):
+        pass
+    def get_classification(self):
+        pass
+    def get_country(self):
+        pass
+    def get_director(self):
+        pass
+    def get_genre(self):
+        pass
+    def get_image(self):
+        pass
+    def get_notes(self):
+        pass
+    def get_o_site(self):
+        pass
+    def get_o_title(self):
+        pass
+    def get_plot(self):
+        pass
+    def get_rating(self):
+        pass
+    def get_runtime(self):
+        pass
+    def get_site(self):
+        pass
+    def get_studio(self):
+        pass
+    def get_title(self):
+        pass
+    def get_trailer(self):
+        pass
+    def get_year(self):
+        pass
+    #}}}
 
-	def __getitem__(self, key):
-		return getattr(self,key)
-	def __setitem__(self, key, value):
-		setattr(self,key,value)
-	
-	def open_page(self, parent_window=None, url=None):
-		if url is None:
-			url_to_fetch = self.url
-		else:
-			url_to_fetch = url
-		if parent_window is not None:
-			self.parent_window = parent_window
-		progress = Progress(self.parent_window,_(&quot;Fetching data&quot;),_(&quot;Wait a moment&quot;))
-		retriever = Retriever(url_to_fetch, self.parent_window,progress)
-		retriever.start()
-		while retriever.isAlive():
-			progress.pulse()
-			if progress.status:
-				retriever.suspend()
-			while gtk.events_pending():
-				gtk.main_iteration()
-		progress.close()
-		try:
-			ifile = file(retriever.html[0], &quot;rb&quot;)
-			data = ifile.read()
-		except IOError:
-			pass
-		if url is None:
-			self.page = data
-		return data
-		urlcleanup()
+    def __getitem__(self, key):
+        return getattr(self,key)
+    def __setitem__(self, key, value):
+        setattr(self,key,value)
+    
+    def open_page(self, parent_window=None, url=None):
+        if url is None:
+            url_to_fetch = self.url
+        else:
+            url_to_fetch = url
+        if parent_window is not None:
+            self.parent_window = parent_window
+        progress = Progress(self.parent_window,_(&quot;Fetching data&quot;),_(&quot;Wait a moment&quot;))
+        retriever = Retriever(url_to_fetch, self.parent_window,progress)
+        retriever.start()
+        while retriever.isAlive():
+            progress.pulse()
+            if progress.status:
+                retriever.suspend()
+            while gtk.events_pending():
+                gtk.main_iteration()
+        progress.close()
+        try:
+            ifile = file(retriever.html[0], &quot;rb&quot;)
+            data = ifile.read()
+        except IOError:
+            pass
+        if url is None:
+            self.page = data
+        return data
+        urlcleanup()
 
-	def fetch_picture(self):
-		if self.image_url:
-			tmp_dest = tempfile.mktemp(prefix='poster_', dir=self.locations['temp'])
-			self.image = tmp_dest.split('poster_', 1)[1]
-			dest = &quot;%s.jpg&quot; % tmp_dest
-			try:
-				progress = Progress(self.parent_window,_(&quot;Fetching poster&quot;),_(&quot;Wait a moment&quot;))
-				retriever = Retriever(self.image_url,self.parent_window,progress,dest)
-				retriever.start()
-				while retriever.isAlive():
-					progress.pulse()
-					if progress.status:
-						retriever.suspend()
-					while gtk.events_pending():
-						gtk.main_iteration()
-				progress.close()
-				urlcleanup()
-			except:
-				self.image = &quot;&quot;
-				try:
-					os.remove(&quot;%s.jpg&quot; % tmp_dest )
-				except:
-					print &quot;Can't remove %s file&quot; % tmp_dest # FIXME: use debug.show()
-		else:
-			self.image = &quot;&quot;
+    def fetch_picture(self):
+        if self.image_url:
+            tmp_dest = tempfile.mktemp(prefix='poster_', dir=self.locations['temp'])
+            self.image = tmp_dest.split('poster_', 1)[1]
+            dest = &quot;%s.jpg&quot; % tmp_dest
+            try:
+                progress = Progress(self.parent_window,_(&quot;Fetching poster&quot;),_(&quot;Wait a moment&quot;))
+                retriever = Retriever(self.image_url,self.parent_window,progress,dest)
+                retriever.start()
+                while retriever.isAlive():
+                    progress.pulse()
+                    if progress.status:
+                        retriever.suspend()
+                    while gtk.events_pending():
+                        gtk.main_iteration()
+                progress.close()
+                urlcleanup()
+            except:
+                self.image = &quot;&quot;
+                try:
+                    os.remove(&quot;%s.jpg&quot; % tmp_dest )
+                except:
+                    print &quot;Can't remove %s file&quot; % tmp_dest # FIXME: use debug.show()
+        else:
+            self.image = &quot;&quot;
 
-	def parse_movie(self):
-		from copy import deepcopy
-		fields = deepcopy(self.fields_to_fetch)
+    def parse_movie(self):
+        from copy import deepcopy
+        fields = deepcopy(self.fields_to_fetch)
 
-		self.initialize()
+        self.initialize()
 
-		if 'year' in fields:
-			self.get_year()
-			self.year = gutils.digits_only(self.year, 2100)
-			fields.pop(fields.index('year'))
-		if 'runtime' in fields:
-			self.get_runtime()
-			self.runtime = gutils.digits_only(self.runtime)
-			fields.pop(fields.index('runtime'))
-		if 'rating' in fields:
-			self.get_rating()
-			self.rating = gutils.digits_only(self.rating, 10)
-			fields.pop(fields.index('rating'))
-		if 'cast' in fields:
-			self.get_cast()
-			self.cast = gutils.clean(self.cast)
-			self.cast = gutils.gdecode(self.cast, self.encode)
-			fields.pop(fields.index('cast'))
-		if 'plot' in fields:
-			self.get_plot()
-			self.plot = gutils.clean(self.plot)
-			self.plot = gutils.gdecode(self.plot, self.encode)
-			fields.pop(fields.index('plot'))
-		if 'notes' in fields:
-			self.get_notes()
-			self.notes = gutils.clean(self.notes)
-			self.notes = gutils.gdecode(self.notes, self.encode)
-			fields.pop(fields.index('notes'))
-		if 'image' in fields:
-			self.get_image()
-			self.fetch_picture()
-			fields.pop(fields.index('image'))
+        if 'year' in fields:
+            self.get_year()
+            self.year = gutils.digits_only(self.year, 2100)
+            fields.pop(fields.index('year'))
+        if 'runtime' in fields:
+            self.get_runtime()
+            self.runtime = gutils.digits_only(self.runtime)
+            fields.pop(fields.index('runtime'))
+        if 'rating' in fields:
+            self.get_rating()
+            self.rating = gutils.digits_only(self.rating, 10)
+            fields.pop(fields.index('rating'))
+        if 'cast' in fields:
+            self.get_cast()
+            self.cast = gutils.clean(self.cast)
+            self.cast = gutils.gdecode(self.cast, self.encode)
+            fields.pop(fields.index('cast'))
+        if 'plot' in fields:
+            self.get_plot()
+            self.plot = gutils.clean(self.plot)
+            self.plot = gutils.gdecode(self.plot, self.encode)
+            fields.pop(fields.index('plot'))
+        if 'notes' in fields:
+            self.get_notes()
+            self.notes = gutils.clean(self.notes)
+            self.notes = gutils.gdecode(self.notes, self.encode)
+            fields.pop(fields.index('notes'))
+        if 'image' in fields:
+            self.get_image()
+            self.fetch_picture()
+            fields.pop(fields.index('image'))
 
-		for i in fields:
-			getattr(self, &quot;get_%s&quot; % i)()
-			self[i] = gutils.clean(self[i])
-			self[i] = gutils.gdecode(self[i], self.encode)
-		
-		if 'o_title' in self.fields_to_fetch and self.o_title is not None:
-			if self.o_title[:4] == 'The ':
-				self.o_title = self.o_title[4:] + ', The'
-		if 'title' in self.fields_to_fetch and self.title is not None:
-			if self.title[:4] == 'The ':
-				self.title = self.title[4:] + ', The'
+        for i in fields:
+            getattr(self, &quot;get_%s&quot; % i)()
+            self[i] = gutils.clean(self[i])
+            self[i] = gutils.gdecode(self[i], self.encode)
+        
+        if 'o_title' in self.fields_to_fetch and self.o_title is not None:
+            if self.o_title[:4] == 'The ':
+                self.o_title = self.o_title[4:] + ', The'
+        if 'title' in self.fields_to_fetch and self.title is not None:
+            if self.title[:4] == 'The ':
+                self.title = self.title[4:] + ', The'
 
 class SearchMovie:
-	page = None
-	number_results = None
-	titles = [&quot;&quot;]
-	ids = [&quot;&quot;]
-	url = None
-	encode = 'utf-8'
-	original_url_search = None
-	translated_url_search = None
-	elements = None
-	title = None
-	remove_accents = True
+    page = None
+    number_results = None
+    titles = [&quot;&quot;]
+    ids = [&quot;&quot;]
+    url = None
+    encode = 'utf-8'
+    original_url_search = None
+    translated_url_search = None
+    elements = None
+    title = None
+    remove_accents = True
 
-	def __init__(self):
-		pass
+    def __init__(self):
+        pass
 
-	def open_search(self,parent_window):
-		self.titles = [&quot;&quot;]
-		self.ids = [&quot;&quot;]
-		if self.url.find('%s') &gt; 0:
-			self.url = self.url % self.title
-			self.url = string.replace(self.url, ' ', '%20')
-		else:
-			self.url = string.replace(self.url+self.title,' ','%20')
-		progress = Progress(parent_window,_(&quot;Searching&quot;),_(&quot;Wait a moment&quot;))
-		try:
-			url = self.url.encode(self.encode)
-		except UnicodeEncodeError:
-			url = self.url.encode('utf-8')
-		retriever = Retriever(url, parent_window, progress)
-		retriever.start()
-		while retriever.isAlive():
-			progress.pulse()
-			if progress.status:
-				retriever.suspend()
-			while gtk.events_pending():
-				gtk.main_iteration()
-		progress.close()
-		try:
-			ifile = file(retriever.html[0], &quot;rb&quot;)
-			self.page = ifile.read()
-		except IOError:
-			pass
-		urlcleanup()
+    def open_search(self,parent_window):
+        self.titles = [&quot;&quot;]
+        self.ids = [&quot;&quot;]
+        if self.url.find('%s') &gt; 0:
+            self.url = self.url % self.title
+            self.url = string.replace(self.url, ' ', '%20')
+        else:
+            self.url = string.replace(self.url+self.title,' ','%20')
+        progress = Progress(parent_window,_(&quot;Searching&quot;),_(&quot;Wait a moment&quot;))
+        try:
+            url = self.url.encode(self.encode)
+        except UnicodeEncodeError:
+            url = self.url.encode('utf-8')
+        retriever = Retriever(url, parent_window, progress)
+        retriever.start()
+        while retriever.isAlive():
+            progress.pulse()
+            if progress.status:
+                retriever.suspend()
+            while gtk.events_pending():
+                gtk.main_iteration()
+        progress.close()
+        try:
+            ifile = file(retriever.html[0], &quot;rb&quot;)
+            self.page = ifile.read()
+        except IOError:
+            pass
+        urlcleanup()
 
 class Retriever(threading.Thread):
-	def __init__(self, URL, parent_window, progress, destination=None):
-		self.URL = URL
-		self.html = None
-		self.destination = destination
-		self.parent_window = parent_window
-		self.progress = progress
-		self._stopevent = threading.Event()
-		self._sleepperiod = 1.0
-		threading.Thread.__init__(self, name=&quot;Retriever&quot;)
-	def run(self):
-		try:
-			self.html = urlretrieve(self.URL, self.destination, self.hook)
-			#self.html = urlretrieve(self.URL.encode('utf-8'), self.destination, self.hook)
-			if self.progress.status:
-				self.html = []
-		except IOError:
-			self.progress.dialog.hide()
-			gutils.urllib_error(_(&quot;Connection error&quot;), self.parent_window)
-			self.suspend()
-	def hook(self,count, blockSize, totalSize):
-		if totalSize ==-1:
-			pass
-		else:
-			try:
-				downloaded_percentage = min((count*blockSize*100)/totalSize, 100)
-			except:
-				downloaded_percentage = 100
-			if count != 0:
-				downloaded_kbyte = int(count * blockSize/1024.0)
-				filesize_kbyte = int(totalSize/1024.0)
+    def __init__(self, URL, parent_window, progress, destination=None):
+        self.URL = URL
+        self.html = None
+        self.destination = destination
+        self.parent_window = parent_window
+        self.progress = progress
+        self._stopevent = threading.Event()
+        self._sleepperiod = 1.0
+        threading.Thread.__init__(self, name=&quot;Retriever&quot;)
+    def run(self):
+        try:
+            self.html = urlretrieve(self.URL, self.destination, self.hook)
+            #self.html = urlretrieve(self.URL.encode('utf-8'), self.destination, self.hook)
+            if self.progress.status:
+                self.html = []
+        except IOError:
+            self.progress.dialog.hide()
+            gutils.urllib_error(_(&quot;Connection error&quot;), self.parent_window)
+            self.suspend()
+    def hook(self,count, blockSize, totalSize):
+        if totalSize ==-1:
+            pass
+        else:
+            try:
+                downloaded_percentage = min((count*blockSize*100)/totalSize, 100)
+            except:
+                downloaded_percentage = 100
+            if count != 0:
+                downloaded_kbyte = int(count * blockSize/1024.0)
+                filesize_kbyte = int(totalSize/1024.0)
 
 #
 # use own derived URLopener class because we need to set a correct User-Agent
@@ -304,29 +304,29 @@
     return _uaurlopener.retrieve(url, filename, reporthook, data)
 
 class UAFancyURLopener(FancyURLopener):
-	# use Firefox 3.0 User-Agent string from Windows XP
-	version = 'Mozilla/5.0 (Windows; U; Windows NT 6.0) Gecko/2008052906 Firefox/3.0'
-	
+    # use Firefox 3.0 User-Agent string from Windows XP
+    version = 'Mozilla/5.0 (Windows; U; Windows NT 6.0) Gecko/2008052906 Firefox/3.0'
+    
 class Progress:
-	def __init__(self, window, title, message):
-		self.status = False
-		self.dialog = gtk.Dialog(title, window, gtk.DIALOG_MODAL, ())
-		self.label = gtk.Label()
-		self.label.set_markup(message)
-		self.dialog.vbox.pack_start(self.label)
-		self.progress = gtk.ProgressBar()
-		self.progress.set_pulse_step(0.01)
-		self.dialog.vbox.pack_start(self.progress, False, False)
-		self.button = gtk.Button(_(&quot;Cancel&quot;), gtk.STOCK_CANCEL)
-		self.button.connect(&quot;clicked&quot;, self.callback)
-		self.dialog.vbox.pack_start(self.button, False, False)
-		self.dialog.show_all()
-	def callback(self, widget):
-		self.dialog.hide()
-		self.status = True
-	def pulse(self):
-		self.progress.pulse()
-		time.sleep(0.01)
-	def close(self):
-		self.dialog.destroy()
+    def __init__(self, window, title, message):
+        self.status = False
+        self.dialog = gtk.Dialog(title, window, gtk.DIALOG_MODAL, ())
+        self.label = gtk.Label()
+        self.label.set_markup(message)
+        self.dialog.vbox.pack_start(self.label)
+        self.progress = gtk.ProgressBar()
+        self.progress.set_pulse_step(0.01)
+        self.dialog.vbox.pack_start(self.progress, False, False)
+        self.button = gtk.Button(_(&quot;Cancel&quot;), gtk.STOCK_CANCEL)
+        self.button.connect(&quot;clicked&quot;, self.callback)
+        self.dialog.vbox.pack_start(self.button, False, False)
+        self.dialog.show_all()
+    def callback(self, widget):
+        self.dialog.hide()
+        self.status = True
+    def pulse(self):
+        self.progress.pulse()
+        time.sleep(0.01)
+    def close(self):
+        self.dialog.destroy()
 # vim: fdm=marker

Modified: trunk/lib/people.py
===================================================================
--- trunk/lib/people.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/people.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -23,105 +23,106 @@
 
 from gettext import gettext as _
 import gutils
+import db
 
 def show_people_window(self):
-	self.widgets['people']['window'].show()
+    self.widgets['people']['window'].show()
 
 def hide_people_window(self):
-	self.widgets['people']['window'].hide()
+    self.widgets['people']['window'].hide()
 
 def add_person(self):
-	clear_person(self)
-	self.widgets['person']['window'].show()
+    clear_person(self)
+    self.widgets['person']['window'].show()
 
 def add_person_cancel(self):
-	self.widgets['person']['window'].hide()
-	self.widgets['people']['window'].present()
+    self.widgets['person']['window'].hide()
+    self.widgets['people']['window'].present()
 
 def clear_person(self):
-	self.widgets['person']['name'].set_text(&quot;&quot;)
-	self.widgets['person']['email'].set_text(&quot;&quot;)
-	self.widgets['person']['phone'].set_text(&quot;&quot;)
+    self.widgets['person']['name'].set_text(&quot;&quot;)
+    self.widgets['person']['email'].set_text(&quot;&quot;)
+    self.widgets['person']['phone'].set_text(&quot;&quot;)
 
 def add_person_db(self):
-	if (self.widgets['person']['name'].get_text()&lt;&gt;''):
-		p = self.db.Person()
-		p.name = self.widgets['person']['name'].get_text()
-		p.email = self.widgets['person']['email'].get_text()
-		p.phone = self.widgets['person']['phone'].get_text()
-		self.widgets['person']['window'].hide()
-		if p.add_to_db():
-			myiter = self.p_treemodel.insert_after(None, None)
-			self.p_treemodel.set_value(myiter,0,str(self.widgets['person']['name'].get_text()))
-			self.p_treemodel.set_value(myiter,1,str(self.widgets['person']['email'].get_text()))
-		self.widgets['people']['window'].present()
-	else:
-		gutils.error(self.widgets['results']['window'],_(&quot;You should fill the person name&quot;))
+    if (self.widgets['person']['name'].get_text()&lt;&gt;''):
+        p = self.db.Person()
+        p.name = self.widgets['person']['name'].get_text()
+        p.email = self.widgets['person']['email'].get_text()
+        p.phone = self.widgets['person']['phone'].get_text()
+        self.widgets['person']['window'].hide()
+        if p.add_to_db():
+            myiter = self.p_treemodel.insert_after(None, None)
+            self.p_treemodel.set_value(myiter,0,str(self.widgets['person']['name'].get_text()))
+            self.p_treemodel.set_value(myiter,1,str(self.widgets['person']['email'].get_text()))
+        self.widgets['people']['window'].present()
+    else:
+        gutils.error(self.widgets['results']['window'],_(&quot;You should fill the person name&quot;))
 
 def edit_person(self):
-	try:
-		treeselection = self.widgets['people']['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		name = tmp_model.get_value(tmp_iter,0)
-	except:
-		return
-	p = self.db.Person.query.filter_by(name=name).first()
-	if p is not None:
-		self.widgets['person']['e_name'].set_text(str(p.name))
-		self.widgets['person']['e_email'].set_text(str(p.email))
-		self.widgets['person']['e_phone'].set_text(str(p.phone))
-		self.widgets['person']['e_id'].set_text(str(p.person_id))
-	self.widgets['person']['e_window'].show()
+    try:
+        treeselection = self.widgets['people']['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        name = tmp_model.get_value(tmp_iter,0)
+    except:
+        return
+    p = self.db.session.query(db.Person).filter_by(name=name).first()
+    if p is not None:
+        self.widgets['person']['e_name'].set_text(str(p.name))
+        self.widgets['person']['e_email'].set_text(str(p.email))
+        self.widgets['person']['e_phone'].set_text(str(p.phone))
+        self.widgets['person']['e_id'].set_text(str(p.person_id))
+    self.widgets['person']['e_window'].show()
 
 def edit_person_cancel(self):
-	self.widgets['person']['e_window'].hide()
-	self.widgets['people']['window'].present()
+    self.widgets['person']['e_window'].hide()
+    self.widgets['people']['window'].present()
 
 def update_person(self):
-	p = self.db.Person.query.filter_by(person_id=self.widgets['person']['e_id'].get_text()).first()
-	if p is None:
-		return False
-	p.name = self.widgets['person']['e_name'].get_text()
-	p.email = self.widgets['person']['e_email'].get_text()
-	p.phone = self.widgets['person']['e_phone'].get_text()
-	if p.update_in_db():
-		self.update_statusbar(_(&quot;Record updated&quot;))
-		edit_person_cancel(self)
-		self.p_treemodel.clear()
-		for p in self.db.Person.query.order_by(self.db.Person.c.name.asc()).all():
-			myiter = self.p_treemodel.insert_before(None, None)
-			self.p_treemodel.set_value(myiter, 0, str(p.name))
-			self.p_treemodel.set_value(myiter, 1, str(p.email))
+    p = self.db.session.query(db.Person).filter_by(person_id=self.widgets['person']['e_id'].get_text()).first()
+    if p is None:
+        return False
+    p.name = self.widgets['person']['e_name'].get_text()
+    p.email = self.widgets['person']['e_email'].get_text()
+    p.phone = self.widgets['person']['e_phone'].get_text()
+    if p.update_in_db():
+        self.update_statusbar(_(&quot;Record updated&quot;))
+        edit_person_cancel(self)
+        self.p_treemodel.clear()
+        for p in self.db.session.query(db.Person).order_by(self.db.Person.c.name.asc()).all():
+            myiter = self.p_treemodel.insert_before(None, None)
+            self.p_treemodel.set_value(myiter, 0, str(p.name))
+            self.p_treemodel.set_value(myiter, 1, str(p.email))
 
 def delete_person(self):
-	response = None
-	has_history = False
-	has_history_msg = ''
-	try:
-		treeselection = self.widgets['people']['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		person = tmp_model.get_value(tmp_iter,0)
-	except:
-		return
-	person = self.db.Person.query.filter_by(name=person).first()
-	if not person:
-		return False
-	data = self.db.Loan.query.filter_by(person_id=person.person_id, return_date=None).all()
-	if len(data)&gt;0:
-		gutils.info(self, _(&quot;This person has loaned films from you. Return them first.&quot;), self.widgets['people']['window'])
-		return False
-	data = self.db.Loan.query.filter_by(person_id=person.person_id).all()
-	if len(data)&gt;0:
-		has_history = True
-		has_history_msg = _(&quot;This person has data in the loan history. This data will be erased if you continue.&quot;)
-	response = gutils.question(self,_(&quot;%s\nAre you sure you want to delete this person?&quot; % has_history_msg), \
-		1, self.widgets['people']['window'])
+    response = None
+    has_history = False
+    has_history_msg = ''
+    try:
+        treeselection = self.widgets['people']['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        person = tmp_model.get_value(tmp_iter,0)
+    except:
+        return
+    person = self.db.session.query(db.Person).filter_by(name=person).first()
+    if not person:
+        return False
+    data = self.db.session.query(db.Loan).filter_by(person_id=person.person_id, return_date=None).all()
+    if len(data)&gt;0:
+        gutils.info(self, _(&quot;This person has loaned films from you. Return them first.&quot;), self.widgets['people']['window'])
+        return False
+    data = self.db.session.query(db.Loan).filter_by(person_id=person.person_id).all()
+    if len(data)&gt;0:
+        has_history = True
+        has_history_msg = _(&quot;This person has data in the loan history. This data will be erased if you continue.&quot;)
+    response = gutils.question(self,_(&quot;%s\nAre you sure you want to delete this person?&quot; % has_history_msg), \
+        1, self.widgets['people']['window'])
 
-	if response == -8:
-		treeselection = self.widgets['people']['treeview'].get_selection()
-		(tmp_model, tmp_iter) = treeselection.get_selected()
-		if person.remove_from_db():
-			self.p_treemodel.remove(tmp_iter)
-			self.treeview_clicked()
-	self.widgets['people']['window'].present()
+    if response == -8:
+        treeselection = self.widgets['people']['treeview'].get_selection()
+        (tmp_model, tmp_iter) = treeselection.get_selected()
+        if person.remove_from_db():
+            self.p_treemodel.remove(tmp_iter)
+            self.treeview_clicked()
+    self.widgets['people']['window'].present()
 

Modified: trunk/lib/plugins/export/PluginExportHTML.py
===================================================================
--- trunk/lib/plugins/export/PluginExportHTML.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/export/PluginExportHTML.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -39,849 +39,849 @@
 plugin_version      = '3.8'
 
 class ExportPlugin(gtk.Window):
-	#==[ configuration - default values ]==========={{{
-	config = {
-		'sorting'           : 'movies_title',
-		'sorting2'          : 'ASC',
-		'exported_dir'      : 'griffith_movies',
-		'template'          : 0,
-		'title'             : _(&quot;Griffith's movies list&quot;),
-		'style'             : 0,
-		'custom_style'      : False,
-		'custom_style_file' : None,
-		'split_num'         : 50,		# split into x files/pages
-		'split_by'          : 1,		# 0==files, 1==movies
-		'seen_only'         : 0,		# 0==all movies; 1==seen only;   2==unseen only
-		'loaned_only'       : 0,		# 0==all movies; 1==loaned only; 2==not loaned only
-		'poster_convert'    : False,		# dont convert
-		'poster_height'     : 200,
-		'poster_width'      : 150,
-		'poster_mode'       : 'RGB',		# RGB == color, L == black and white
-		'poster_format'     : 'jpg'
-	}
-	fields = {
-		'movies_cast'           : False,
-		'movies_classification' : False,
-		'movies_country'        : True,
-		'movies_genre'          : True,
-		'movies_director'       : True,
-		'movies_image'          : True,
-		'movies_o_site'         : True,
-		'movies_site'           : True,
-		'movies_trailer'        : True,
-		'movies_loaned'         : False,
-		'movies_media_num'      : True,
-		'movies_number'         : True,
-		'movies_o_title'        : True,
-		'movies_plot'           : False,
-		'movies_rating'         : True,
-		'movies_runtime'        : True,
-		'movies_studio'         : False,
-		'movies_seen'           : True,
-		'movies_title'          : True,
-		'movies_year'           : True,
-		'movies_notes'          : False,
-#		'movies_region'         : False,
-#		'movies_layers'         : False,
-#		'movies_condition'      : False,
-#		'movies_color'          : False,
-#		'movies_volume_id'      : False,
-#		'movies_collection_id'  : False,
-		'media_name'            : True,
-		'collections_name'      : True,
-		'volumes_name'          : True,
-#		'acodecs_name'          : True,
-		'vcodecs_name'          : True,
-	}
-	
-	fields_as_columns = {
-		'movies_cast'           : 'cast',
-		'movies_classification' : 'classification',
-		'movies_country'        : 'country',
-		'movies_genre'          : 'genre',
-		'movies_director'       : 'director',
-		'movies_image'          : 'image',
-		'movies_o_site'         : 'o_site',
-		'movies_site'           : 'site',
-		'movies_trailer'        : 'trailer',
-		'movies_loaned'         : 'loaned',
-		'movies_media_num'      : 'media_num',
-		'movies_number'         : 'number',
-		'movies_o_title'        : 'o_title',
-		'movies_plot'           : 'plot',
-		'movies_rating'         : 'rating',
-		'movies_runtime'        : 'runtime',
-		'movies_studio'         : 'studio',
-		'movies_seen'           : 'seen',
-		'movies_title'          : 'title',
-		'movies_year'           : 'year',
-		'movies_notes'          : 'notes',
-#		'movies_region'         : 'region',
-#		'movies_layers'         : 'layers',
-#		'movies_condition'      : 'condition',
-#		'movies_color'          : 'color',
-#		'movies_volume_id'      : 'volume_id',
-#		'movies_collection_id'  : 'collection_id',
-		'media_name'            : 'name',
-		'collections_name'      : 'name',
-		'volumes_name'          : 'name',
-#		'acodecs_name'          : 'name',
-		'vcodecs_name'          : 'name',
-	}
-	
-	names = {
-		_('Cast')           : 'movies_cast',
-		_('Classification') : 'movies_classification',
-		_('Country')        : 'movies_country',
-		_('Director')       : 'movies_director',
-		_('Genre')          : 'movies_genre',
-		_('Image')          : 'movies_image',
-		_('Official site')  : 'movies_o_site',
-		_('Site')           : 'movies_site',
-		_('Trailer')        : 'movies_trailer',
-		_('Loaned')         : 'movies_loaned',
-		_('Discs')          : 'movies_media_num',
-		_('Number')         : 'movies_number',
-		_('Original Title') : 'movies_o_title',
-		_('Plot')           : 'movies_plot',
-		_('Rating')         : 'movies_rating',
-		_('Runtime')        : 'movies_runtime',
-		_('Studio')         : 'movies_studio',
-		_('Seen it')        : 'movies_seen',
-		_('Title')          : 'movies_title',
-		_('Year')           : 'movies_year',
-		_('Notes')          : 'movies_notes',
-#		_('Region')         : 'movies_region',
-#		_('Layers')         : 'movies_layers',
-#		_('Condition')      : 'movies_condition',
-#		_('Color')          : 'movies_color',
-#		_('Volume')         : 'movies_volume_id',
-#		_('Collection')     : 'movies_collection_id',
-		_('Media')          : 'media_name',
-		_('Collection')     : 'collections_name',
-		_('Volume')         : 'volumes_name',
-#		_('Audio codecs')   : 'acodecs_name',
-		_('Video codec')    : 'vcodecs_name',
-	}
-	#}}}
+    #==[ configuration - default values ]==========={{{
+    config = {
+        'sorting'           : 'movies_title',
+        'sorting2'          : 'ASC',
+        'exported_dir'      : 'griffith_movies',
+        'template'          : 0,
+        'title'             : _(&quot;Griffith's movies list&quot;),
+        'style'             : 0,
+        'custom_style'      : False,
+        'custom_style_file' : None,
+        'split_num'         : 50,        # split into x files/pages
+        'split_by'          : 1,        # 0==files, 1==movies
+        'seen_only'         : 0,        # 0==all movies; 1==seen only;   2==unseen only
+        'loaned_only'       : 0,        # 0==all movies; 1==loaned only; 2==not loaned only
+        'poster_convert'    : False,        # dont convert
+        'poster_height'     : 200,
+        'poster_width'      : 150,
+        'poster_mode'       : 'RGB',        # RGB == color, L == black and white
+        'poster_format'     : 'jpg'
+    }
+    fields = {
+        'movies_cast'           : False,
+        'movies_classification' : False,
+        'movies_country'        : True,
+        'movies_genre'          : True,
+        'movies_director'       : True,
+        'movies_image'          : True,
+        'movies_o_site'         : True,
+        'movies_site'           : True,
+        'movies_trailer'        : True,
+        'movies_loaned'         : False,
+        'movies_media_num'      : True,
+        'movies_number'         : True,
+        'movies_o_title'        : True,
+        'movies_plot'           : False,
+        'movies_rating'         : True,
+        'movies_runtime'        : True,
+        'movies_studio'         : False,
+        'movies_seen'           : True,
+        'movies_title'          : True,
+        'movies_year'           : True,
+        'movies_notes'          : False,
+#        'movies_region'         : False,
+#        'movies_layers'         : False,
+#        'movies_condition'      : False,
+#        'movies_color'          : False,
+#        'movies_volume_id'      : False,
+#        'movies_collection_id'  : False,
+        'media_name'            : True,
+        'collections_name'      : True,
+        'volumes_name'          : True,
+#        'acodecs_name'          : True,
+        'vcodecs_name'          : True,
+    }
+    
+    fields_as_columns = {
+        'movies_cast'           : 'cast',
+        'movies_classification' : 'classification',
+        'movies_country'        : 'country',
+        'movies_genre'          : 'genre',
+        'movies_director'       : 'director',
+        'movies_image'          : 'image',
+        'movies_o_site'         : 'o_site',
+        'movies_site'           : 'site',
+        'movies_trailer'        : 'trailer',
+        'movies_loaned'         : 'loaned',
+        'movies_media_num'      : 'media_num',
+        'movies_number'         : 'number',
+        'movies_o_title'        : 'o_title',
+        'movies_plot'           : 'plot',
+        'movies_rating'         : 'rating',
+        'movies_runtime'        : 'runtime',
+        'movies_studio'         : 'studio',
+        'movies_seen'           : 'seen',
+        'movies_title'          : 'title',
+        'movies_year'           : 'year',
+        'movies_notes'          : 'notes',
+#        'movies_region'         : 'region',
+#        'movies_layers'         : 'layers',
+#        'movies_condition'      : 'condition',
+#        'movies_color'          : 'color',
+#        'movies_volume_id'      : 'volume_id',
+#        'movies_collection_id'  : 'collection_id',
+        'media_name'            : 'name',
+        'collections_name'      : 'name',
+        'volumes_name'          : 'name',
+#        'acodecs_name'          : 'name',
+        'vcodecs_name'          : 'name',
+    }
+    
+    names = {
+        _('Cast')           : 'movies_cast',
+        _('Classification') : 'movies_classification',
+        _('Country')        : 'movies_country',
+        _('Director')       : 'movies_director',
+        _('Genre')          : 'movies_genre',
+        _('Image')          : 'movies_image',
+        _('Official site')  : 'movies_o_site',
+        _('Site')           : 'movies_site',
+        _('Trailer')        : 'movies_trailer',
+        _('Loaned')         : 'movies_loaned',
+        _('Discs')          : 'movies_media_num',
+        _('Number')         : 'movies_number',
+        _('Original Title') : 'movies_o_title',
+        _('Plot')           : 'movies_plot',
+        _('Rating')         : 'movies_rating',
+        _('Runtime')        : 'movies_runtime',
+        _('Studio')         : 'movies_studio',
+        _('Seen it')        : 'movies_seen',
+        _('Title')          : 'movies_title',
+        _('Year')           : 'movies_year',
+        _('Notes')          : 'movies_notes',
+#        _('Region')         : 'movies_region',
+#        _('Layers')         : 'movies_layers',
+#        _('Condition')      : 'movies_condition',
+#        _('Color')          : 'movies_color',
+#        _('Volume')         : 'movies_volume_id',
+#        _('Collection')     : 'movies_collection_id',
+        _('Media')          : 'media_name',
+        _('Collection')     : 'collections_name',
+        _('Volume')         : 'volumes_name',
+#        _('Audio codecs')   : 'acodecs_name',
+        _('Video codec')    : 'vcodecs_name',
+    }
+    #}}}
 
-	def __init__(self, database, locations, parent_window, debug, **kwargs):#{{{
-		self.db = database
-		self.debug = debug
-		self.locations = locations
-		if kwargs.has_key('config'):
-			self.persistent_config = kwargs['config']
-		else:
-			self.persistent_config = None
-		self.widgets = {}
-		self.style_list = {}
-		self.templates = self.make_template_list()
-		# glade
-		gf = os.path.join(locations['glade'], 'exporthtml.glade')
-		self.define_widgets(gtk.glade.XML(gf))
-		self.fill_widgets()
-	#}}}
+    def __init__(self, database, locations, parent_window, debug, **kwargs):#{{{
+        self.db = database
+        self.debug = debug
+        self.locations = locations
+        if kwargs.has_key('config'):
+            self.persistent_config = kwargs['config']
+        else:
+            self.persistent_config = None
+        self.widgets = {}
+        self.style_list = {}
+        self.templates = self.make_template_list()
+        # glade
+        gf = os.path.join(locations['glade'], 'exporthtml.glade')
+        self.define_widgets(gtk.glade.XML(gf))
+        self.fill_widgets()
+    #}}}
 
-	def get_node_value_by_language(self, parent, name, language='en'):#{{{
-		nodes = parent.getElementsByTagName(name)
-		for node in nodes:
-			if node.parentNode != parent:
-				continue
-			elif node.attributes.get('xml:lang') is not None:
-				if node.attributes.get('xml:lang').value == language:
-					return node.firstChild.nodeValue
-			else:	# set default value in case node has no xml:lang attribute
-				value = node.firstChild.nodeValue
-		return value
-	#}}}		
-		
-	def make_template_list(self):#{{{
-		language = 'en'
-		if os.environ.has_key('LANG'):
-			language = os.environ['LANG'][:2]
-		templates = {}
-		j=0 # number of templates
-		dirName = os.path.join(self.locations['share'], 'export_templates')
-		items = os.listdir(dirName)
-		items.sort()
-		for i in items:
-			fileName = os.path.join(dirName, i)
-			if not os.path.islink(fileName) and os.path.isdir(fileName):
-				# clear previous data
-				doc = None; styles = {};
-				tpl_name=None; tpl_author=None; tpl_email=None; tpl_version=None; tpl_ext=None; tpl_desc=None
-				try:
-					doc = minidom.parse(os.path.join(fileName, 'config.xml'))
-				except:
-					self.debug.show(&quot;Can't parse configuration file for template: %s&quot;%fileName)
-					continue
-				for template in doc.getElementsByTagName('template'):
-					tpl_name    = self.get_node_value_by_language(template, 'name', language)
-					tpl_author  = template.getElementsByTagName('author')[0].firstChild.nodeValue
-					tpl_email   = template.getElementsByTagName('email')[0].firstChild.nodeValue
-					tpl_version = template.getElementsByTagName('version')[0].firstChild.nodeValue
-					tpl_ext     = template.getElementsByTagName('extension')[0].firstChild.nodeValue
-					tpl_desc    = self.get_node_value_by_language(template, 'description', language)
-					k=0	# number of styles
-					try:
-						styles_list = template.getElementsByTagName('styles')[0].getElementsByTagName('style')
-						for style in styles_list:
-							tpl_style_name = self.get_node_value_by_language( style, 'name', language )
-							tpl_style_file = style.getElementsByTagName('file')[0].firstChild.nodeValue
-							# get preview if available
-							try:
-								tpl_style_preview = style.getElementsByTagName('preview')[0].firstChild.nodeValue
-							except:
-								tpl_style_preview = None
-							styles[k] = {
-								'name': tpl_style_name,
-								'file': tpl_style_file,
-								'preview': tpl_style_preview
-							}
-							k=k+1
-					except:
-						styles = None
-				if tpl_name=='':
-					continue
-				templates[j]= {
-					'dir'     : i,
-					'name'    : tpl_name,
-					'author'  : tpl_author,
-					'email'   : tpl_email,
-					'version' : tpl_version,
-					'ext'     : tpl_ext,
-					'desc'    : tpl_desc,
-					'styles'  : styles
-				}
-				j=j+1
-		return templates
-	#}}}
+    def get_node_value_by_language(self, parent, name, language='en'):#{{{
+        nodes = parent.getElementsByTagName(name)
+        for node in nodes:
+            if node.parentNode != parent:
+                continue
+            elif node.attributes.get('xml:lang') is not None:
+                if node.attributes.get('xml:lang').value == language:
+                    return node.firstChild.nodeValue
+            else:    # set default value in case node has no xml:lang attribute
+                value = node.firstChild.nodeValue
+        return value
+    #}}}        
+        
+    def make_template_list(self):#{{{
+        language = 'en'
+        if os.environ.has_key('LANG'):
+            language = os.environ['LANG'][:2]
+        templates = {}
+        j=0 # number of templates
+        dirName = os.path.join(self.locations['share'], 'export_templates')
+        items = os.listdir(dirName)
+        items.sort()
+        for i in items:
+            fileName = os.path.join(dirName, i)
+            if not os.path.islink(fileName) and os.path.isdir(fileName):
+                # clear previous data
+                doc = None; styles = {};
+                tpl_name=None; tpl_author=None; tpl_email=None; tpl_version=None; tpl_ext=None; tpl_desc=None
+                try:
+                    doc = minidom.parse(os.path.join(fileName, 'config.xml'))
+                except:
+                    self.debug.show(&quot;Can't parse configuration file for template: %s&quot;%fileName)
+                    continue
+                for template in doc.getElementsByTagName('template'):
+                    tpl_name    = self.get_node_value_by_language(template, 'name', language)
+                    tpl_author  = template.getElementsByTagName('author')[0].firstChild.nodeValue
+                    tpl_email   = template.getElementsByTagName('email')[0].firstChild.nodeValue
+                    tpl_version = template.getElementsByTagName('version')[0].firstChild.nodeValue
+                    tpl_ext     = template.getElementsByTagName('extension')[0].firstChild.nodeValue
+                    tpl_desc    = self.get_node_value_by_language(template, 'description', language)
+                    k=0    # number of styles
+                    try:
+                        styles_list = template.getElementsByTagName('styles')[0].getElementsByTagName('style')
+                        for style in styles_list:
+                            tpl_style_name = self.get_node_value_by_language( style, 'name', language )
+                            tpl_style_file = style.getElementsByTagName('file')[0].firstChild.nodeValue
+                            # get preview if available
+                            try:
+                                tpl_style_preview = style.getElementsByTagName('preview')[0].firstChild.nodeValue
+                            except:
+                                tpl_style_preview = None
+                            styles[k] = {
+                                'name': tpl_style_name,
+                                'file': tpl_style_file,
+                                'preview': tpl_style_preview
+                            }
+                            k=k+1
+                    except:
+                        styles = None
+                if tpl_name=='':
+                    continue
+                templates[j]= {
+                    'dir'     : i,
+                    'name'    : tpl_name,
+                    'author'  : tpl_author,
+                    'email'   : tpl_email,
+                    'version' : tpl_version,
+                    'ext'     : tpl_ext,
+                    'desc'    : tpl_desc,
+                    'styles'  : styles
+                }
+                j=j+1
+        return templates
+    #}}}
 
-	#==[ widgets ]=================================={{{
-	def define_widgets(self, glade_file):
-		get = lambda x: glade_file.get_widget(x)
-		self.widgets = {
-			'window'                : get('w_eh'),
-			'fcw'                   : get('fcw'),
-			'box_include_1'         : get('box_include_1'),
-			'box_include_2'         : get('box_include_2'),
-			'box_include_3'         : get('box_include_3'),
-			'sb_split_num'          : get('sb_split_num'),
-			'rb_split_files'        : get('rb_split_files'),
-			'rb_split_movies'       : get('rb_split_movies'),
-			'rb_seen'               : get('rb_seen'),
-			'rb_seen_only'          : get('rb_seen_only'),
-			'rb_seen_only_n'        : get('rb_seen_only_n'),
-			'rb_loaned'             : get('rb_loaned'),
-			'rb_loaned_only'        : get('rb_loaned_only'),
-			'rb_loaned_only_n'      : get('rb_loaned_only_n'),
-			'entry_header'          : get('entry_header'),
-			'cb_custom_style'       : get('cb_custom_style'),
-			'cb_reverse'            : get('cb_reverse'),
-			'combo_style'           : get('combo_style'),
-			'combo_sortby'          : get('combo_sortby'),
-			'combo_theme'           : get('combo_theme'),
-			'fcb_custom_style_file' : get('fcb_custom_style_file'),
-			'l_tpl_author'          : get('l_tpl_author'),
-			'l_tpl_email'           : get('l_tpl_email'),
-			'l_tpl_version'         : get('l_tpl_version'),
-			'l_tpl_desc'            : get('l_tpl_desc'),
-			'image_preview'         : get('image_preview'),
-			'vb_posters'            : get('vb_posters'),
-			'sb_height'             : get('sb_height'),
-			'sb_width'              : get('sb_width'),
-			'cb_black'              : get('cb_black'),
-			'combo_format'          : get('combo_format'),
-			'cb_convert'            : get('cb_convert'),
-		}
+    #==[ widgets ]=================================={{{
+    def define_widgets(self, glade_file):
+        get = lambda x: glade_file.get_widget(x)
+        self.widgets = {
+            'window'                : get('w_eh'),
+            'fcw'                   : get('fcw'),
+            'box_include_1'         : get('box_include_1'),
+            'box_include_2'         : get('box_include_2'),
+            'box_include_3'         : get('box_include_3'),
+            'sb_split_num'          : get('sb_split_num'),
+            'rb_split_files'        : get('rb_split_files'),
+            'rb_split_movies'       : get('rb_split_movies'),
+            'rb_seen'               : get('rb_seen'),
+            'rb_seen_only'          : get('rb_seen_only'),
+            'rb_seen_only_n'        : get('rb_seen_only_n'),
+            'rb_loaned'             : get('rb_loaned'),
+            'rb_loaned_only'        : get('rb_loaned_only'),
+            'rb_loaned_only_n'      : get('rb_loaned_only_n'),
+            'entry_header'          : get('entry_header'),
+            'cb_custom_style'       : get('cb_custom_style'),
+            'cb_reverse'            : get('cb_reverse'),
+            'combo_style'           : get('combo_style'),
+            'combo_sortby'          : get('combo_sortby'),
+            'combo_theme'           : get('combo_theme'),
+            'fcb_custom_style_file' : get('fcb_custom_style_file'),
+            'l_tpl_author'          : get('l_tpl_author'),
+            'l_tpl_email'           : get('l_tpl_email'),
+            'l_tpl_version'         : get('l_tpl_version'),
+            'l_tpl_desc'            : get('l_tpl_desc'),
+            'image_preview'         : get('image_preview'),
+            'vb_posters'            : get('vb_posters'),
+            'sb_height'             : get('sb_height'),
+            'sb_width'              : get('sb_width'),
+            'cb_black'              : get('cb_black'),
+            'combo_format'          : get('combo_format'),
+            'cb_convert'            : get('cb_convert'),
+        }
 
-		# define handlers for general events
-		glade_file.signal_autoconnect({
-			'on_export_button_clicked'           : self.export_data,
-			'on_rb_split_files_toggled'          : self.on_rb_split_files_toggled,
-			'on_rb_split_movies_toggled'         : self.on_rb_split_movies_toggled,
-			'on_rb_seen_toggled'                 : self.on_rb_seen_toggled,
-			'on_rb_seen_only_toggled'            : self.on_rb_seen_only_toggled,
-			'on_rb_seen_only_n_toggled'          : self.on_rb_seen_only_n_toggled,
-			'on_rb_loaned_toggled'               : self.on_rb_loaned_toggled,
-			'on_rb_loaned_only_toggled'          : self.on_rb_loaned_only_toggled,
-			'on_rb_loaned_only_n_toggled'        : self.on_rb_loaned_only_n_toggled,
-			'on_cancel_button_clicked'           : self.on_quit,
-			'on_cb_data_toggled'                 : self.on_cb_data_toggled,
-			'on_cb_custom_style_toggled'         : self.on_cb_custom_style_toggled,
-			'on_fcb_custom_style_file_activated' : self.on_fcb_custom_style_file_activated,
-			'on_combo_style_changed'             : self.on_combo_style_changed,
-			'on_combo_theme_changed'             : self.on_combo_theme_changed,
-			'on_cb_convert_toggled'              : self.on_cb_convert_toggled,
-		})
+        # define handlers for general events
+        glade_file.signal_autoconnect({
+            'on_export_button_clicked'           : self.export_data,
+            'on_rb_split_files_toggled'          : self.on_rb_split_files_toggled,
+            'on_rb_split_movies_toggled'         : self.on_rb_split_movies_toggled,
+            'on_rb_seen_toggled'                 : self.on_rb_seen_toggled,
+            'on_rb_seen_only_toggled'            : self.on_rb_seen_only_toggled,
+            'on_rb_seen_only_n_toggled'          : self.on_rb_seen_only_n_toggled,
+            'on_rb_loaned_toggled'               : self.on_rb_loaned_toggled,
+            'on_rb_loaned_only_toggled'          : self.on_rb_loaned_only_toggled,
+            'on_rb_loaned_only_n_toggled'        : self.on_rb_loaned_only_n_toggled,
+            'on_cancel_button_clicked'           : self.on_quit,
+            'on_cb_data_toggled'                 : self.on_cb_data_toggled,
+            'on_cb_custom_style_toggled'         : self.on_cb_custom_style_toggled,
+            'on_fcb_custom_style_file_activated' : self.on_fcb_custom_style_file_activated,
+            'on_combo_style_changed'             : self.on_combo_style_changed,
+            'on_combo_theme_changed'             : self.on_combo_theme_changed,
+            'on_cb_convert_toggled'              : self.on_cb_convert_toggled,
+        })
 
-	def fill_widgets(self):
-		# themes
-		for i in self.templates:
-			self.widgets['combo_theme'].insert_text(i, self.templates[i]['name'])
+    def fill_widgets(self):
+        # themes
+        for i in self.templates:
+            self.widgets['combo_theme'].insert_text(i, self.templates[i]['name'])
 
-		# sortby combo
-		keys = self.names.keys()
-		keys.sort()
-		j = 0
-		pos_o_title = 0
-		for i in keys:
-			self.widgets['combo_sortby'].append_text(i)
-			if i == _('Original Title'):
-				pos_o_title = j
-			j = j + 1
-		self.widgets['combo_sortby'].set_wrap_width(3)
+        # sortby combo
+        keys = self.names.keys()
+        keys.sort()
+        j = 0
+        pos_o_title = 0
+        for i in keys:
+            self.widgets['combo_sortby'].append_text(i)
+            if i == _('Original Title'):
+                pos_o_title = j
+            j = j + 1
+        self.widgets['combo_sortby'].set_wrap_width(3)
 
-		# include data
-		j = 0
-		k = math.ceil( len(self.names) / float(3) )
-		for i in keys:
-			j = j + 1
-			field = self.names[i]
-			self.widgets['cb_'+field] = gtk.CheckButton(i)
-			self.widgets['cb_'+field].set_name(&quot;cb_%s&quot; % field)
-			self.widgets['cb_'+field].connect('toggled', self.on_cb_data_toggled)
-			self.widgets['cb_'+field].set_active(self.fields[field])
-			if j &lt;= k:
-				self.widgets['box_include_1'].add(self.widgets[&quot;cb_%s&quot; % field])
-			elif j&lt;= 2*k:
-				self.widgets['box_include_2'].add(self.widgets[&quot;cb_%s&quot; % field])
-			else:
-				self.widgets['box_include_3'].add(self.widgets[&quot;cb_%s&quot; % field])
-		self.widgets['box_include_1'].show_all()
-		self.widgets['box_include_2'].show_all()
-		self.widgets['box_include_3'].show_all()
+        # include data
+        j = 0
+        k = math.ceil( len(self.names) / float(3) )
+        for i in keys:
+            j = j + 1
+            field = self.names[i]
+            self.widgets['cb_'+field] = gtk.CheckButton(i)
+            self.widgets['cb_'+field].set_name(&quot;cb_%s&quot; % field)
+            self.widgets['cb_'+field].connect('toggled', self.on_cb_data_toggled)
+            self.widgets['cb_'+field].set_active(self.fields[field])
+            if j &lt;= k:
+                self.widgets['box_include_1'].add(self.widgets[&quot;cb_%s&quot; % field])
+            elif j&lt;= 2*k:
+                self.widgets['box_include_2'].add(self.widgets[&quot;cb_%s&quot; % field])
+            else:
+                self.widgets['box_include_3'].add(self.widgets[&quot;cb_%s&quot; % field])
+        self.widgets['box_include_1'].show_all()
+        self.widgets['box_include_2'].show_all()
+        self.widgets['box_include_3'].show_all()
 
-		# set defaults --------------------------------
-		self.widgets['entry_header'].set_text(self.config['title'])
-		self.widgets['combo_theme'].set_active(2)	# html_tables
-		self.widgets['combo_sortby'].set_active(pos_o_title)	# orginal title
-		# spliting
-		self.widgets['sb_split_num'].set_value(self.config['split_num'])
-		if self.config['split_by'] == 0:
-			self.widgets['rb_split_files'].set_active(True)
-		else:
-			self.widgets['rb_split_movies'].set_active(True)
-		# limiting
-		if self.config['seen_only'] == 2:
-			self.widgets['rb_seen_only_n'].set_active(True)
-		elif self.config['seen_only'] == 1:
-			self.widgets['rb_seen_only'].set_active(True)
-		else:
-			self.widgets['rb_seen'].set_active(True)
-		if self.config['loaned_only'] == 2:
-			self.widgets['rb_loaned_only_n'].set_active(True)
-		elif self.config['loaned_only'] == 1:
-			self.widgets['rb_loaned_only'].set_active(True)
-		else:
-			self.widgets['rb_loaned'].set_active(True)
-		# posters
-		self.widgets['combo_format'].set_active(0)
-		if self.config['poster_convert'] and self.config['poster_convert'] == True:
-			self.widgets['cb_convert'].set_active(True)
-			self.widgets['vb_posters'].set_sensitive(True)
-		else:
-			self.widgets['cb_convert'].set_active(False)
-			self.widgets['vb_posters'].set_sensitive(False)
-		# persistent config
-		if not self.persistent_config is None:
-			tmp = self.persistent_config.get('export_dir', None, section='export-html')
-			if not tmp is None:
-				self.widgets['fcw'].set_current_folder(tmp)
-	#}}}
+        # set defaults --------------------------------
+        self.widgets['entry_header'].set_text(self.config['title'])
+        self.widgets['combo_theme'].set_active(2)    # html_tables
+        self.widgets['combo_sortby'].set_active(pos_o_title)    # orginal title
+        # spliting
+        self.widgets['sb_split_num'].set_value(self.config['split_num'])
+        if self.config['split_by'] == 0:
+            self.widgets['rb_split_files'].set_active(True)
+        else:
+            self.widgets['rb_split_movies'].set_active(True)
+        # limiting
+        if self.config['seen_only'] == 2:
+            self.widgets['rb_seen_only_n'].set_active(True)
+        elif self.config['seen_only'] == 1:
+            self.widgets['rb_seen_only'].set_active(True)
+        else:
+            self.widgets['rb_seen'].set_active(True)
+        if self.config['loaned_only'] == 2:
+            self.widgets['rb_loaned_only_n'].set_active(True)
+        elif self.config['loaned_only'] == 1:
+            self.widgets['rb_loaned_only'].set_active(True)
+        else:
+            self.widgets['rb_loaned'].set_active(True)
+        # posters
+        self.widgets['combo_format'].set_active(0)
+        if self.config['poster_convert'] and self.config['poster_convert'] == True:
+            self.widgets['cb_convert'].set_active(True)
+            self.widgets['vb_posters'].set_sensitive(True)
+        else:
+            self.widgets['cb_convert'].set_active(False)
+            self.widgets['vb_posters'].set_sensitive(False)
+        # persistent config
+        if not self.persistent_config is None:
+            tmp = self.persistent_config.get('export_dir', None, section='export-html')
+            if not tmp is None:
+                self.widgets['fcw'].set_current_folder(tmp)
+    #}}}
 
-	#==[ callbacks ]================================{{{
-	# buttons:
-	def on_quit(self, widget=None):
-		self.widgets['window'].destroy()
+    #==[ callbacks ]================================{{{
+    # buttons:
+    def on_quit(self, widget=None):
+        self.widgets['window'].destroy()
 
-	# data tab -------------------------------------#{{{
-	def on_rb_split_files_toggled(self, widget):
-		self.config['split_by'] = 0	# files
+    # data tab -------------------------------------#{{{
+    def on_rb_split_files_toggled(self, widget):
+        self.config['split_by'] = 0    # files
 
-	def on_rb_split_movies_toggled(self, widget):
-		self.config['split_by'] = 1	# movies
-	
-	# export frame
-	def on_cb_data_toggled(self, widget):
-		self.fields[gutils.after(widget.get_name(), 'cb_')] = widget.get_active()
+    def on_rb_split_movies_toggled(self, widget):
+        self.config['split_by'] = 1    # movies
+    
+    # export frame
+    def on_cb_data_toggled(self, widget):
+        self.fields[gutils.after(widget.get_name(), 'cb_')] = widget.get_active()
 
-	# limit frame
-	def on_rb_seen_toggled(self, widget):
-		if widget.get_active():
-			self.config['seen_only'] = 0	# export all movies
+    # limit frame
+    def on_rb_seen_toggled(self, widget):
+        if widget.get_active():
+            self.config['seen_only'] = 0    # export all movies
 
-	def on_rb_seen_only_toggled(self, widget):
-		if widget.get_active():
-			self.config['seen_only'] = 1	# export only seen movies
-	
-	def on_rb_seen_only_n_toggled(self, widget):
-		if widget.get_active():
-			self.config['seen_only'] = 2	# export only unseen movies
-	
-	def on_rb_loaned_toggled(self, widget):
-		if widget.get_active():
-			self.config['loaned_only'] = 0	# export all movies
+    def on_rb_seen_only_toggled(self, widget):
+        if widget.get_active():
+            self.config['seen_only'] = 1    # export only seen movies
+    
+    def on_rb_seen_only_n_toggled(self, widget):
+        if widget.get_active():
+            self.config['seen_only'] = 2    # export only unseen movies
+    
+    def on_rb_loaned_toggled(self, widget):
+        if widget.get_active():
+            self.config['loaned_only'] = 0  # export all movies
 
-	def on_rb_loaned_only_toggled(self, widget):
-		if widget.get_active():
-			self.config['loaned_only'] = 1	# export only loaned movies
-	
-	def on_rb_loaned_only_n_toggled(self, widget):
-		if widget.get_active():
-			self.config['loaned_only'] = 2	# export only not loaned movies
-	
-	# posters frame
-	def on_cb_convert_toggled(self, widget):
-		active = widget.get_active()
-		self.config['poster_convert'] = active
-		if not active:
-			self.widgets['vb_posters'].set_sensitive(False)
-		else:
-			self.widgets['vb_posters'].set_sensitive(True)
-	#}}}
+    def on_rb_loaned_only_toggled(self, widget):
+        if widget.get_active():
+            self.config['loaned_only'] = 1  # export only loaned movies
+    
+    def on_rb_loaned_only_n_toggled(self, widget):
+        if widget.get_active():
+            self.config['loaned_only'] = 2  # export only not loaned movies
+    
+    # posters frame
+    def on_cb_convert_toggled(self, widget):
+        active = widget.get_active()
+        self.config['poster_convert'] = active
+        if not active:
+            self.widgets['vb_posters'].set_sensitive(False)
+        else:
+            self.widgets['vb_posters'].set_sensitive(True)
+    #}}}
 
-	# template tab ---------------------------------#{{{
-	def on_combo_theme_changed(self, widget):
-		old_id = self.config['template']
-		tpl_id = widget.get_active()
-		self.config['template'] = tpl_id
-		# fill authors data
-		self.widgets['l_tpl_author'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['author'])
-		self.widgets['l_tpl_email'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['email'])
-		self.widgets['l_tpl_email'].set_selectable(True)
-		self.widgets['l_tpl_version'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['version'])
-		self.widgets['l_tpl_desc'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['desc'])
-		# remove old style list
-		self.widgets['combo_style'].get_model().clear()
-		# ... and add new
-		if self.templates[tpl_id]['styles'] is not None:
-			for i in self.templates[tpl_id]['styles']:
-				self.widgets['combo_style'].insert_text(i, self.templates[tpl_id]['styles'][i]['name'])	# template name
-			self.widgets['combo_style'].set_active(0)
-		else:
-			self.config['style'] = None
-			self.widgets['image_preview'].set_from_stock(gtk.STOCK_MISSING_IMAGE, gtk.ICON_SIZE_LARGE_TOOLBAR)
+    # template tab ---------------------------------#{{{
+    def on_combo_theme_changed(self, widget):
+        old_id = self.config['template']
+        tpl_id = widget.get_active()
+        self.config['template'] = tpl_id
+        # fill authors data
+        self.widgets['l_tpl_author'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['author'])
+        self.widgets['l_tpl_email'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['email'])
+        self.widgets['l_tpl_email'].set_selectable(True)
+        self.widgets['l_tpl_version'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['version'])
+        self.widgets['l_tpl_desc'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % self.templates[tpl_id]['desc'])
+        # remove old style list
+        self.widgets['combo_style'].get_model().clear()
+        # ... and add new
+        if self.templates[tpl_id]['styles'] is not None:
+            for i in self.templates[tpl_id]['styles']:
+                self.widgets['combo_style'].insert_text(i, self.templates[tpl_id]['styles'][i]['name'])    # template name
+            self.widgets['combo_style'].set_active(0)
+        else:
+            self.config['style'] = None
+            self.widgets['image_preview'].set_from_stock(gtk.STOCK_MISSING_IMAGE, gtk.ICON_SIZE_LARGE_TOOLBAR)
 
-	def on_combo_style_changed(self, widget):
-		self.config['style'] = widget.get_active()
-		self.widgets['cb_custom_style'].set_active(False)
+    def on_combo_style_changed(self, widget):
+        self.config['style'] = widget.get_active()
+        self.widgets['cb_custom_style'].set_active(False)
 
-		tpl_id = self.config['template']
-		template_dir = os.path.join(self.locations['share'], 'export_templates', self.templates[tpl_id]['dir'])
-		preview_file = self.templates[self.config['template']]['styles'][self.config['style']]['preview']
-		if preview_file is not None:
-			preview_file = os.path.join(template_dir, preview_file)
-		if preview_file is not None and not os.path.isfile(preview_file):
-			preview_file = os.path.join(template_dir, 'preview.jpg')	# try default preview image
-			if not os.path.isfile(preview_file):
-				preview_file = None
-		if preview_file is not None:
-			self.widgets['image_preview'].set_from_file(preview_file)
-		else:
-			self.widgets['image_preview'].set_from_stock(gtk.STOCK_MISSING_IMAGE, gtk.ICON_SIZE_LARGE_TOOLBAR)
-		self.widgets['image_preview'].show()
+        tpl_id = self.config['template']
+        template_dir = os.path.join(self.locations['share'], 'export_templates', self.templates[tpl_id]['dir'])
+        preview_file = self.templates[self.config['template']]['styles'][self.config['style']]['preview']
+        if preview_file is not None:
+            preview_file = os.path.join(template_dir, preview_file)
+        if preview_file is not None and not os.path.isfile(preview_file):
+            preview_file = os.path.join(template_dir, 'preview.jpg')    # try default preview image
+            if not os.path.isfile(preview_file):
+                preview_file = None
+        if preview_file is not None:
+            self.widgets['image_preview'].set_from_file(preview_file)
+        else:
+            self.widgets['image_preview'].set_from_stock(gtk.STOCK_MISSING_IMAGE, gtk.ICON_SIZE_LARGE_TOOLBAR)
+        self.widgets['image_preview'].show()
 
-	def on_cb_custom_style_toggled(self, widget):
-		if widget.get_active():
-			self.config['custom_style'] = True
-			self.widgets['image_preview'].hide()
-		else:
-			self.config['custom_style'] = False
-			self.widgets['image_preview'].show()
+    def on_cb_custom_style_toggled(self, widget):
+        if widget.get_active():
+            self.config['custom_style'] = True
+            self.widgets['image_preview'].hide()
+        else:
+            self.config['custom_style'] = False
+            self.widgets['image_preview'].show()
 
-	def on_fcb_custom_style_file_activated(self, widget):
-		self.config['custom_style_file'] = widget.get_filename()
-		self.widgets['cb_custom_style'].set_active(True)
-	#}}} }}}
+    def on_fcb_custom_style_file_activated(self, widget):
+        self.config['custom_style_file'] = widget.get_filename()
+        self.widgets['cb_custom_style'].set_active(True)
+    #}}} }}}
 
-	def make_navigation(self, pages, current):#{{{
-		if pages &gt; 1:	# navigation needed
-			tpl_id = self.config['template']
-			t = '&lt;div class=&quot;navi&quot;&gt;\n\t&lt;p id=&quot;prev&quot;&gt;'
-			if current &gt; 1:
-				t += '&lt;a href=&quot;./page_%s.%s&quot;&gt;%s&lt;/a&gt;' % \
-					(str(current-1), self.templates[tpl_id]['ext'], _('previous'))
-			else:	# first page
-				t += _('previous')
-			t += &quot;&lt;/p&gt;\n&quot;
-			for i in range(1, pages+1):
-				if i == current:
-					t +='\t&lt;p id=&quot;current&quot;&gt;%s&lt;/p&gt;\n' % str(i)
-				else:
-					t +='\t&lt;p&gt;&lt;a href=&quot;./page_%s.%s&quot;&gt;%s&lt;/a&gt;&lt;/p&gt;\n' % \
-						(str(i), self.templates[tpl_id]['ext'], str(i))
-			t += '\t&lt;p id=&quot;next&quot;&gt;'
-			if pages &gt; current:
-				t +='&lt;a href=&quot;./page_%s.%s&quot;&gt;%s&lt;/a&gt;' % \
-						(str(current+1), self.templates[tpl_id]['ext'], _('next'))
-			else:	# last page
-				t += _('next')
-			t += &quot;&lt;/p&gt;\n&lt;/div&gt;&quot;
-			return t
-		else:
-			return ''
-	#}}}
+    def make_navigation(self, pages, current):#{{{
+        if pages &gt; 1:    # navigation needed
+            tpl_id = self.config['template']
+            t = '&lt;div class=&quot;navi&quot;&gt;\n\t&lt;p id=&quot;prev&quot;&gt;'
+            if current &gt; 1:
+                t += '&lt;a href=&quot;./page_%s.%s&quot;&gt;%s&lt;/a&gt;' % \
+                    (str(current-1), self.templates[tpl_id]['ext'], _('previous'))
+            else:    # first page
+                t += _('previous')
+            t += &quot;&lt;/p&gt;\n&quot;
+            for i in range(1, pages+1):
+                if i == current:
+                    t +='\t&lt;p id=&quot;current&quot;&gt;%s&lt;/p&gt;\n' % str(i)
+                else:
+                    t +='\t&lt;p&gt;&lt;a href=&quot;./page_%s.%s&quot;&gt;%s&lt;/a&gt;&lt;/p&gt;\n' % \
+                        (str(i), self.templates[tpl_id]['ext'], str(i))
+            t += '\t&lt;p id=&quot;next&quot;&gt;'
+            if pages &gt; current:
+                t +='&lt;a href=&quot;./page_%s.%s&quot;&gt;%s&lt;/a&gt;' % \
+                        (str(current+1), self.templates[tpl_id]['ext'], _('next'))
+            else:    # last page
+                t += _('next')
+            t += &quot;&lt;/p&gt;\n&lt;/div&gt;&quot;
+            return t
+        else:
+            return ''
+    #}}}
 
-	def fill_template(self, template, field, data='', title='', remove=False):	#{{{
-		start = template.find('&lt;@'+ field +'&gt;')
-		end = template.find('&lt;/@'+ field +'&gt;', start+1)
-		if start &gt; -1 and end &gt; -1:
-			if remove == True:
-				return template[:start] + template[end+4+len(field):]
-			else:
-				tmp = gutils.trim(template,'&lt;@'+field+'&gt;', '&lt;/@'+field+'&gt;')
-				tmp = tmp.replace(&quot;@DATA@&quot;, data)
-				tmp = tmp.replace(&quot;@TITLE@&quot;, title)
-				tmp = template[:start] + tmp + template[end+4+len(field):]
-				if tmp.find('&lt;@'+ field +'&gt;') != -1:
-					tmp = self.fill_template(tmp, field, data, title, remove)
-				return tmp
-		else:
-			return template
-	#}}}
+    def fill_template(self, template, field, data='', title='', remove=False):    #{{{
+        start = template.find('&lt;@'+ field +'&gt;')
+        end = template.find('&lt;/@'+ field +'&gt;', start+1)
+        if start &gt; -1 and end &gt; -1:
+            if remove == True:
+                return template[:start] + template[end+4+len(field):]
+            else:
+                tmp = gutils.trim(template,'&lt;@'+field+'&gt;', '&lt;/@'+field+'&gt;')
+                tmp = tmp.replace(&quot;@DATA@&quot;, data)
+                tmp = tmp.replace(&quot;@TITLE@&quot;, title)
+                tmp = template[:start] + tmp + template[end+4+len(field):]
+                if tmp.find('&lt;@'+ field +'&gt;') != -1:
+                    tmp = self.fill_template(tmp, field, data, title, remove)
+                return tmp
+        else:
+            return template
+    #}}}
 
-	def select(self):	#{{{
-		from sqlalchemy import select
-		config = self.config
-		
-		# columns to select
-		columns = []
-		for i in self.fields_as_columns:
-			try:
-				columns.append(self.db.Movie.c[self.fields_as_columns[i]])
-			except:
-				pass
-		# use outer join to media table to get the name of the media
-		from sqlalchemy import outerjoin
-		columns.append(self.db.Medium.c['name'])
-		media_join = outerjoin(self.db.metadata.tables['movies'], \
-			self.db.metadata.tables['media'], \
-			self.db.metadata.tables['movies'].c.medium_id==self.db.metadata.tables['media'].c.medium_id)
-		# use outer join to collections table to get the name of the collection
-		columns.append(self.db.Collection.c['name'])
-		collection_join = media_join.outerjoin( \
-			self.db.metadata.tables['collections'], \
-			self.db.metadata.tables['movies'].c.collection_id==self.db.metadata.tables['collections'].c.collection_id)
-		# use outer join to volumes table to get the name of the volume
-		columns.append(self.db.Volume.c['name'])
-		volume_join = collection_join.outerjoin( \
-			self.db.metadata.tables['volumes'], \
-			self.db.metadata.tables['movies'].c.volume_id==self.db.metadata.tables['volumes'].c.volume_id)
-		# use outer join to volumes table to get the name of the volume
-		columns.append(self.db.VCodec.c['name'])
-		vcodec_join = volume_join.outerjoin( \
-			self.db.metadata.tables['vcodecs'], \
-			self.db.metadata.tables['movies'].c.vcodec_id==self.db.metadata.tables['vcodecs'].c.vcodec_id)
-		#
-		# selecting the audio codec doesn't work with joins because if more than one codec per movie is
-		# added it would duplicate the movie in the result set as many as audio codecs are added to the movie
-		#
-		# use outer join to language and acodec table to get the name of the audio codec
-		#movie_lang_join = vcodec_join.outerjoin( \
-		#	self.db.metadata.tables['movie_lang'], \
-		#	self.db.metadata.tables['movies'].c.movie_id==self.db.metadata.tables['movie_lang'].c.movie_id)
-		#columns.append(self.db.ACodec.c['name'])
-		#acodec_join = movie_lang_join.outerjoin( \
-		#	self.db.metadata.tables['acodec'], \
-		#	self.db.metadata.tables['movie_lang'].c.acodec_id==self.db.metadata.tables['acodec'].c.acodec_id)
-		
-		# sort order	TODO: more than one sort column
-		sort_columns = []
-		sorting_parts = config['sorting'].split('_')
-		if config['sorting2'] == 'ASC':
-			from sqlalchemy import asc
-			sort_columns.append(asc(self.db.metadata.tables[sorting_parts[0]].c['_'.join(sorting_parts[1:])]))
-		elif config['sorting2'] == 'DESC':
-			from sqlalchemy import desc
-			sort_columns.append(desc(self.db.metadata.tables[sorting_parts[0]].c['_'.join(sorting_parts[1:])]))
+    def select(self):    #{{{
+        from sqlalchemy import select
+        config = self.config
+        
+        # columns to select
+        columns = []
+        for i in self.fields_as_columns:
+            try:
+                columns.append(self.db.Movie.c[self.fields_as_columns[i]])
+            except:
+                pass
+        # use outer join to media table to get the name of the media
+        from sqlalchemy import outerjoin
+        columns.append(self.db.Medium.c['name'])
+        media_join = outerjoin(self.db.metadata.tables['movies'], \
+            self.db.metadata.tables['media'], \
+            self.db.metadata.tables['movies'].c.medium_id==self.db.metadata.tables['media'].c.medium_id)
+        # use outer join to collections table to get the name of the collection
+        columns.append(self.db.Collection.c['name'])
+        collection_join = media_join.outerjoin( \
+            self.db.metadata.tables['collections'], \
+            self.db.metadata.tables['movies'].c.collection_id==self.db.metadata.tables['collections'].c.collection_id)
+        # use outer join to volumes table to get the name of the volume
+        columns.append(self.db.Volume.c['name'])
+        volume_join = collection_join.outerjoin( \
+            self.db.metadata.tables['volumes'], \
+            self.db.metadata.tables['movies'].c.volume_id==self.db.metadata.tables['volumes'].c.volume_id)
+        # use outer join to volumes table to get the name of the volume
+        columns.append(self.db.VCodec.c['name'])
+        vcodec_join = volume_join.outerjoin( \
+            self.db.metadata.tables['vcodecs'], \
+            self.db.metadata.tables['movies'].c.vcodec_id==self.db.metadata.tables['vcodecs'].c.vcodec_id)
+        #
+        # selecting the audio codec doesn't work with joins because if more than one codec per movie is
+        # added it would duplicate the movie in the result set as many as audio codecs are added to the movie
+        #
+        # use outer join to language and acodec table to get the name of the audio codec
+        #movie_lang_join = vcodec_join.outerjoin( \
+        #    self.db.metadata.tables['movie_lang'], \
+        #    self.db.metadata.tables['movies'].c.movie_id==self.db.metadata.tables['movie_lang'].c.movie_id)
+        #columns.append(self.db.ACodec.c['name'])
+        #acodec_join = movie_lang_join.outerjoin( \
+        #    self.db.metadata.tables['acodec'], \
+        #    self.db.metadata.tables['movie_lang'].c.acodec_id==self.db.metadata.tables['acodec'].c.acodec_id)
+        
+        # sort order    TODO: more than one sort column
+        sort_columns = []
+        sorting_parts = config['sorting'].split('_')
+        if config['sorting2'] == 'ASC':
+            from sqlalchemy import asc
+            sort_columns.append(asc(self.db.metadata.tables[sorting_parts[0]].c['_'.join(sorting_parts[1:])]))
+        elif config['sorting2'] == 'DESC':
+            from sqlalchemy import desc
+            sort_columns.append(desc(self.db.metadata.tables[sorting_parts[0]].c['_'.join(sorting_parts[1:])]))
 
-		statement = select(columns=columns, order_by=sort_columns, from_obj=[media_join, collection_join, volume_join, vcodec_join], use_labels = True)
+        statement = select(columns=columns, order_by=sort_columns, from_obj=[media_join, collection_join, volume_join, vcodec_join], use_labels = True)
 
-		# where clause
-		if config['seen_only'] == 1:
-			statement.append_whereclause(self.db.Movie.c.seen==True)
-		elif config['seen_only'] == 2:
-			statement.append_whereclause(self.db.Movie.c.seen!=True)
-		if config['loaned_only'] == 1:
-			statement.append_whereclause(self.db.Movie.c.loaned==True)
-		elif config['loaned_only'] == 2:
-			statement.append_whereclause(self.db.Movie.c.loaned!=True)
-		
-		return statement.execute()
-	#}}}
+        # where clause
+        if config['seen_only'] == 1:
+            statement.append_whereclause(self.db.Movie.c.seen==True)
+        elif config['seen_only'] == 2:
+            statement.append_whereclause(self.db.Movie.c.seen!=True)
+        if config['loaned_only'] == 1:
+            statement.append_whereclause(self.db.Movie.c.loaned==True)
+        elif config['loaned_only'] == 2:
+            statement.append_whereclause(self.db.Movie.c.loaned!=True)
+        
+        return statement.execute()
+    #}}}
 
-	#==[ main function ]============================{{{
-	def export_data(self, widget):
-		&quot;&quot;&quot;Main exporting function&quot;&quot;&quot;
+    #==[ main function ]============================{{{
+    def export_data(self, widget):
+        &quot;&quot;&quot;Main exporting function&quot;&quot;&quot;
 
-		config = self.config
-		fields = self.fields
-		tid = config['template']
-		
-		# get data from widgets
-		self.config['exported_dir'] = self.widgets['fcw'].get_filename()
-		self.config['title']        = self.widgets['entry_header'].get_text()
-		self.config['sorting']      = self.names[self.widgets['combo_sortby'].get_active_text()]
-		if self.widgets['cb_reverse'].get_active():
-			self.config['sorting2'] = 'DESC'
-		else:
-			self.config['sorting2'] = 'ASC'
-		self.config['split_num']     = self.widgets['sb_split_num'].get_value_as_int()
-		self.config['poster_height'] = self.widgets['sb_height'].get_value_as_int()
-		self.config['poster_width']  = self.widgets['sb_width'].get_value_as_int()
-		if self.widgets['cb_black'].get_active():
-			self.config['poster_mode'] = 'L'
-		else:
-			self.config['poster_mode'] = 'RGB'
-		self.config['poster_format'] = self.widgets['combo_format'].get_active_text()
+        config = self.config
+        fields = self.fields
+        tid = config['template']
+        
+        # get data from widgets
+        self.config['exported_dir'] = self.widgets['fcw'].get_filename()
+        self.config['title']        = self.widgets['entry_header'].get_text()
+        self.config['sorting']      = self.names[self.widgets['combo_sortby'].get_active_text()]
+        if self.widgets['cb_reverse'].get_active():
+            self.config['sorting2'] = 'DESC'
+        else:
+            self.config['sorting2'] = 'ASC'
+        self.config['split_num']     = self.widgets['sb_split_num'].get_value_as_int()
+        self.config['poster_height'] = self.widgets['sb_height'].get_value_as_int()
+        self.config['poster_width']  = self.widgets['sb_width'].get_value_as_int()
+        if self.widgets['cb_black'].get_active():
+            self.config['poster_mode'] = 'L'
+        else:
+            self.config['poster_mode'] = 'RGB'
+        self.config['poster_format'] = self.widgets['combo_format'].get_active_text()
 
-		# create directories
-		if not config['exported_dir']:
-			self.debug.show(&quot;Error: Folder name not set!&quot;)
-			return 1
-		
-		if not os.path.isdir(config['exported_dir']):
-			try:
-				os.mkdir(config['exported_dir'])
-			except:
-				gutils.error(self,_(&quot;Can't create %s!&quot;) % config['exported_dir'])
-				return 2
-			
-		data_path = os.path.join(self.locations['share'], 'export_templates', self.templates[tid]['dir'], 'data')
-		if os.path.isdir(data_path):
-			try:
-				gutils.copytree(data_path, config['exported_dir'])
-			except Exception, err:
-				gutils.warning(self, str(err))
-		
-		# persist config
-		if not self.persistent_config is None:
-			self.persistent_config.set('export_dir', config['exported_dir'], section='export-html')
-			self.persistent_config.save()
+        # create directories
+        if not config['exported_dir']:
+            self.debug.show(&quot;Error: Folder name not set!&quot;)
+            return 1
+        
+        if not os.path.isdir(config['exported_dir']):
+            try:
+                os.mkdir(config['exported_dir'])
+            except:
+                gutils.error(self,_(&quot;Can't create %s!&quot;) % config['exported_dir'])
+                return 2
+            
+        data_path = os.path.join(self.locations['share'], 'export_templates', self.templates[tid]['dir'], 'data')
+        if os.path.isdir(data_path):
+            try:
+                gutils.copytree(data_path, config['exported_dir'])
+            except Exception, err:
+                gutils.warning(self, str(err))
+        
+        # persist config
+        if not self.persistent_config is None:
+            self.persistent_config.set('export_dir', config['exported_dir'], section='export-html')
+            self.persistent_config.save()
 
-		if fields['movies_image']:
-			# import modules needed later
-			# modules are needed at least to convert griffith.png to nopic.(gif|jpeg|png)
-			from PIL import Image
-			# py2exe problem workaround:
-			# if self.windows:
-			from PIL import PngImagePlugin
-			from PIL import GifImagePlugin
-			from PIL import JpegImagePlugin
-			Image._initialized=2
-			# end if
-			if not config['poster_convert']:
-				config['poster_format'] = 'jpeg' # replace 'jpeg'
-			
-			posters_dir = os.path.join(config['exported_dir'], 'posters')
-			if os.path.isdir(posters_dir):
-				if gutils.question(self, _(&quot;Directory %s already exists.\nDo you want to overwrite it?&quot;) % posters_dir,1,self) == gtk.RESPONSE_YES:
-					try:
-						shutil.rmtree(posters_dir)
-					except:
-						gutils.error(self,_(&quot;Can't remove %s!&quot;) % config['exported_dir'])
-						return 3
-				else:
-					return 4
-			try:
-				os.mkdir(posters_dir)
-			except:
-				gutils.error(self,_(&quot;Can't create %s!&quot;) % posters_dir)
-				return 5
+        if fields['movies_image']:
+            # import modules needed later
+            # modules are needed at least to convert griffith.png to nopic.(gif|jpeg|png)
+            from PIL import Image
+            # py2exe problem workaround:
+            # if self.windows:
+            from PIL import PngImagePlugin
+            from PIL import GifImagePlugin
+            from PIL import JpegImagePlugin
+            Image._initialized=2
+            # end if
+            if not config['poster_convert']:
+                config['poster_format'] = 'jpeg' # replace 'jpeg'
+            
+            posters_dir = os.path.join(config['exported_dir'], 'posters')
+            if os.path.isdir(posters_dir):
+                if gutils.question(self, _(&quot;Directory %s already exists.\nDo you want to overwrite it?&quot;) % posters_dir,1,self) == gtk.RESPONSE_YES:
+                    try:
+                        shutil.rmtree(posters_dir)
+                    except:
+                        gutils.error(self,_(&quot;Can't remove %s!&quot;) % config['exported_dir'])
+                        return 3
+                else:
+                    return 4
+            try:
+                os.mkdir(posters_dir)
+            except:
+                gutils.error(self,_(&quot;Can't create %s!&quot;) % posters_dir)
+                return 5
 
-		if config['custom_style']:
-			if config['custom_style_file'] is not None and os.path.isfile(config['custom_style_file']):
-				try:
-					shutil.copy(config['custom_style_file'],config['exported_dir'])
-				except:
-					gutils.warning(self,_(&quot;Can't copy %s!&quot;)%style_file)
-					config['custom_style'] = False
-				style = os.path.split(self.config['custom_style_file'])[1]
-			else:
-				config['custom_style'] = False
+        if config['custom_style']:
+            if config['custom_style_file'] is not None and os.path.isfile(config['custom_style_file']):
+                try:
+                    shutil.copy(config['custom_style_file'],config['exported_dir'])
+                except:
+                    gutils.warning(self,_(&quot;Can't copy %s!&quot;)%style_file)
+                    config['custom_style'] = False
+                style = os.path.split(self.config['custom_style_file'])[1]
+            else:
+                config['custom_style'] = False
 
 
-		if config['style'] is not None and config['custom_style']==False:
-			style = self.templates[tid]['styles'][config['style']]['file']
-			style_path = os.path.join(self.locations['share'], 'export_templates', self.templates[tid]['dir'], style)
-			try:
-				shutil.copy(style_path,config['exported_dir'])
-			except:
-				gutils.warning(self,_(&quot;Can't copy %s!&quot;)%style_path)
+        if config['style'] is not None and config['custom_style']==False:
+            style = self.templates[tid]['styles'][config['style']]['file']
+            style_path = os.path.join(self.locations['share'], 'export_templates', self.templates[tid]['dir'], style)
+            try:
+                shutil.copy(style_path,config['exported_dir'])
+            except:
+                gutils.warning(self,_(&quot;Can't copy %s!&quot;)%style_path)
 
-		# select exported movies
-		exported_movies = self.select().fetchall()
-		number_of_exported_movies = len(exported_movies)
+        # select exported movies
+        exported_movies = self.select().fetchall()
+        number_of_exported_movies = len(exported_movies)
 
-		if config['split_by'] == 1:	# split by number of movies per page
-			self.entries_per_page = config['split_num']
-		else:				# split by number of pagess
-			if number_of_exported_movies &lt; config['split_num']:
-				self.entries_per_page = 1
-			else:
-				self.entries_per_page = int(number_of_exported_movies / config['split_num'])
+        if config['split_by'] == 1:    # split by number of movies per page
+            self.entries_per_page = config['split_num']
+        else:                # split by number of pagess
+            if number_of_exported_movies &lt; config['split_num']:
+                self.entries_per_page = 1
+            else:
+                self.entries_per_page = int(number_of_exported_movies / config['split_num'])
 
-		# calculate number of files to be created (pages)
-		self.pages = int(math.ceil(float(number_of_exported_movies) / self.entries_per_page))
+        # calculate number of files to be created (pages)
+        self.pages = int(math.ceil(float(number_of_exported_movies) / self.entries_per_page))
 
-		template_dir = os.path.join(self.locations['share'], 'export_templates', self.templates[tid]['dir'])
-		try:
-			filename = 'page.tpl'
-			tpl_header = file(os.path.join(template_dir,filename), &quot;r&quot;).read()
-		except:
-			gutils.error(self,_(&quot;Can't open %s!&quot;)%filename)
-			return False
+        template_dir = os.path.join(self.locations['share'], 'export_templates', self.templates[tid]['dir'])
+        try:
+            filename = 'page.tpl'
+            tpl_header = file(os.path.join(template_dir,filename), &quot;r&quot;).read()
+        except:
+            gutils.error(self,_(&quot;Can't open %s!&quot;)%filename)
+            return False
 
-		tpl_header = self.fill_template(tpl_header, 'header', config['title'])
-		try:
-			tpl_header = self.fill_template(tpl_header, 'style', style)
-		except:
-			pass
-		tmp = _('Document generated by Griffith v') + version.pversion + \
-				' - Copyright (C) ' + version.pyear + ' ' + version.pauthor + ' - ' + \
-				_('Released Under the GNU/GPL License')
-		tmp = gutils.html_encode(tmp)
-		tmp = tmp.replace('@', ' at ')	# prevent spam
-		tpl_header = self.fill_template(tpl_header, 'copyright', tmp)
-		tmp = None
-		
-		tpl_header = self.fill_template(tpl_header, 'pages', self.pages)
-		
-		# count exported fields
-		rowspan = 0
-		for i in fields:
-			if fields[i] == True:
-				rowspan = rowspan + 1
-		rowspan = str(rowspan)
-		tpl_header = self.fill_template(tpl_header, 'rowspan', rowspan)
+        tpl_header = self.fill_template(tpl_header, 'header', config['title'])
+        try:
+            tpl_header = self.fill_template(tpl_header, 'style', style)
+        except:
+            pass
+        tmp = _('Document generated by Griffith v') + version.pversion + \
+                ' - Copyright (C) ' + version.pyear + ' ' + version.pauthor + ' - ' + \
+                _('Released Under the GNU/GPL License')
+        tmp = gutils.html_encode(tmp)
+        tmp = tmp.replace('@', ' at ')    # prevent spam
+        tpl_header = self.fill_template(tpl_header, 'copyright', tmp)
+        tmp = None
+        
+        tpl_header = self.fill_template(tpl_header, 'pages', self.pages)
+        
+        # count exported fields
+        rowspan = 0
+        for i in fields:
+            if fields[i] == True:
+                rowspan = rowspan + 1
+        rowspan = str(rowspan)
+        tpl_header = self.fill_template(tpl_header, 'rowspan', rowspan)
 
-		# split template
-		tpl_tail = gutils.after(tpl_header, '&lt;!-- /ITEMS --&gt;')
-		tpl_item = gutils.trim(tpl_header, '&lt;!-- ITEMS --&gt;','&lt;!-- /ITEMS --&gt;')
-		tpl_header = gutils.before(tpl_header, '&lt;!-- ITEMS --&gt;')
+        # split template
+        tpl_tail = gutils.after(tpl_header, '&lt;!-- /ITEMS --&gt;')
+        tpl_item = gutils.trim(tpl_header, '&lt;!-- ITEMS --&gt;','&lt;!-- /ITEMS --&gt;')
+        tpl_header = gutils.before(tpl_header, '&lt;!-- ITEMS --&gt;')
 
-		# fill header
-		for j in self.names:
-			if self.fields[self.names[j]] == True:
-				tpl_header = self.fill_template(tpl_header, self.names[j], '', j)
-			else:
-				tpl_header = self.fill_template(tpl_header, self.names[j], remove=True)
+        # fill header
+        for j in self.names:
+            if self.fields[self.names[j]] == True:
+                tpl_header = self.fill_template(tpl_header, self.names[j], '', j)
+            else:
+                tpl_header = self.fill_template(tpl_header, self.names[j], remove=True)
 
-		# check if line break needs conversion
-		if tpl_header.upper().find('XHTML 1.0') &gt; -1:
-			linebreak_replacement = '&lt;br /&gt;'
-		else:
-			linebreak_replacement = None
+        # check if line break needs conversion
+        if tpl_header.upper().find('XHTML 1.0') &gt; -1:
+            linebreak_replacement = '&lt;br /&gt;'
+        else:
+            linebreak_replacement = None
 
-		item=1	# item's position on page (1 - first, ...)
-		i = 1
-		page=1	# page number
-		for row in exported_movies:	# fill items {{{
-			# check if new file has to be created
-			if item==1:
-				filename = os.path.join(config['exported_dir'],'page_%s.' % page + self.templates[tid]['ext'])
-				try:
-					exported_file = file(filename, 'w')
-				except:
-					gutils.error(self,_(&quot;Can't create %s!&quot;)%filename)
-					return False
-				tmp2 = tpl_header + ''
-				exported_file.write(self.fill_template(tmp2, 'page', str(page)))
-				tmp2 = None
+        item=1    # item's position on page (1 - first, ...)
+        i = 1
+        page=1    # page number
+        for row in exported_movies:    # fill items {{{
+            # check if new file has to be created
+            if item==1:
+                filename = os.path.join(config['exported_dir'],'page_%s.' % page + self.templates[tid]['ext'])
+                try:
+                    exported_file = file(filename, 'w')
+                except:
+                    gutils.error(self,_(&quot;Can't create %s!&quot;)%filename)
+                    return False
+                tmp2 = tpl_header + ''
+                exported_file.write(self.fill_template(tmp2, 'page', str(page)))
+                tmp2 = None
 
-			# ---------------------------------------------
-			tmp = tpl_item + '' # a copy (not a reference!)
-			tmp = self.fill_template(tmp, 'id', str(item))
-			tmp = self.fill_template(tmp, 'item', str(i))
-			for j in self.names:
-				if self.fields[self.names[j]] == True:
-					if self.names[j] == 'movies_image':
-						if row['movies_image']:
-							#image = row['movies_image'] + '.' + config['poster_format'].lower()
-							image = '%d' % row['movies_number'] + '.' + config['poster_format'].lower()
-							tmp = self.fill_template(tmp, self.names[j], image, j)
-						else:
-							tmp = self.fill_template(tmp, self.names[j], 'nopic.' + config['poster_format'].lower(), j)
-					elif row[self.names[j]] is None:
-						tmp = self.fill_template(tmp, self.names[j], '', j)
-					elif row[self.names[j]] is True:
-						tmp = self.fill_template(tmp, self.names[j], _('Yes'), j)
-					elif row[self.names[j]] is False:
-						tmp = self.fill_template(tmp, self.names[j], _('No'), j)
-					else:
-						try:
-							data = str(row[self.names[j]]).encode('utf-8')
-							if linebreak_replacement is not None:
-								data = data.replace('\r\n', linebreak_replacement)
-								data = data.replace('\n', linebreak_replacement)
-							tmp = self.fill_template(tmp, self.names[j], data, j)
-						except UnicodeDecodeError:
-							self.debug.show(&quot;Unicode Decode Error occurred while decoding %s (movie number: %s)&quot; % (self.names[j], row['movies_number']))
-							data = str(row[self.names[j]])
-							if linebreak_replacement is not None:
-								data = data.replace('\r\n', linebreak_replacement)
-								data = data.replace('\n', linebreak_replacement)
-							tmp = self.fill_template(tmp, self.names[j], data, j)
-						except Exception, ex:
-							self.debug.show(&quot;Error occurred while decoding %s (movie number: %s)&quot; % (self.names[j], row['movies_number']))
-				else:
-					tmp = self.fill_template(tmp, self.names[j], remove=True)
-				tmp = gutils.convert_entities(tmp)
-			exported_file.write(tmp)
-			tmp = None
-			# ---------------------------------------------
-			
-			# copy poster
-			if fields['movies_image']:
-				if row['movies_image'] is not None:
-					image_file_src = os.path.join(self.locations['posters'], str(row['movies_image']) + '.jpg')
-					image_file_dst = os.path.join(posters_dir, '%d' % row['movies_number']) + '.' + config['poster_format'].lower()
-					if not config['poster_convert']:	# copy file
-						try:
-							shutil.copy(image_file_src,	image_file_dst)
-						except:
-							self.debug.show(&quot;Can't copy %s&quot; % image_file_src)
-					else:	# convert posters
-						try:
-							im = Image.open(image_file_src, 'r').convert(config['poster_mode'])
-							im.thumbnail((config['poster_width'], config['poster_height']), Image.ANTIALIAS)
-							im.save(image_file_dst, config['poster_format'])
-						except:
-							self.debug.show(&quot;Can't convert %s&quot; % image_file_src)
+            # ---------------------------------------------
+            tmp = tpl_item + '' # a copy (not a reference!)
+            tmp = self.fill_template(tmp, 'id', str(item))
+            tmp = self.fill_template(tmp, 'item', str(i))
+            for j in self.names:
+                if self.fields[self.names[j]] == True:
+                    if self.names[j] == 'movies_image':
+                        if row['movies_image']:
+                            #image = row['movies_image'] + '.' + config['poster_format'].lower()
+                            image = '%d' % row['movies_number'] + '.' + config['poster_format'].lower()
+                            tmp = self.fill_template(tmp, self.names[j], image, j)
+                        else:
+                            tmp = self.fill_template(tmp, self.names[j], 'nopic.' + config['poster_format'].lower(), j)
+                    elif row[self.names[j]] is None:
+                        tmp = self.fill_template(tmp, self.names[j], '', j)
+                    elif row[self.names[j]] is True:
+                        tmp = self.fill_template(tmp, self.names[j], _('Yes'), j)
+                    elif row[self.names[j]] is False:
+                        tmp = self.fill_template(tmp, self.names[j], _('No'), j)
+                    else:
+                        try:
+                            data = str(row[self.names[j]]).encode('utf-8')
+                            if linebreak_replacement is not None:
+                                data = data.replace('\r\n', linebreak_replacement)
+                                data = data.replace('\n', linebreak_replacement)
+                            tmp = self.fill_template(tmp, self.names[j], data, j)
+                        except UnicodeDecodeError:
+                            self.debug.show(&quot;Unicode Decode Error occurred while decoding %s (movie number: %s)&quot; % (self.names[j], row['movies_number']))
+                            data = str(row[self.names[j]])
+                            if linebreak_replacement is not None:
+                                data = data.replace('\r\n', linebreak_replacement)
+                                data = data.replace('\n', linebreak_replacement)
+                            tmp = self.fill_template(tmp, self.names[j], data, j)
+                        except Exception, ex:
+                            self.debug.show(&quot;Error occurred while decoding %s (movie number: %s)&quot; % (self.names[j], row['movies_number']))
+                else:
+                    tmp = self.fill_template(tmp, self.names[j], remove=True)
+                tmp = gutils.convert_entities(tmp)
+            exported_file.write(tmp)
+            tmp = None
+            # ---------------------------------------------
+            
+            # copy poster
+            if fields['movies_image']:
+                if row['movies_image'] is not None:
+                    image_file_src = os.path.join(self.locations['posters'], str(row['movies_image']) + '.jpg')
+                    image_file_dst = os.path.join(posters_dir, '%d' % row['movies_number']) + '.' + config['poster_format'].lower()
+                    if not config['poster_convert']:    # copy file
+                        try:
+                            shutil.copy(image_file_src,    image_file_dst)
+                        except:
+                            self.debug.show(&quot;Can't copy %s&quot; % image_file_src)
+                    else:    # convert posters
+                        try:
+                            im = Image.open(image_file_src, 'r').convert(config['poster_mode'])
+                            im.thumbnail((config['poster_width'], config['poster_height']), Image.ANTIALIAS)
+                            im.save(image_file_dst, config['poster_format'])
+                        except:
+                            self.debug.show(&quot;Can't convert %s&quot; % image_file_src)
 
-			# close file if last item
-			if ((page-1)*self.entries_per_page)+item == number_of_exported_movies:
-				tmp2 = tpl_tail + ''
-				exported_file.write(self.fill_template(tmp2, 'navigation', self.make_navigation(self.pages, page)))
-				exported_file.close()
-				tmp2 = None
-			
-			# close file if last item in page
-			elif item == self.entries_per_page:
-				tmp2 = tpl_tail + ''
-				exported_file.write(self.fill_template(tmp2, 'navigation', self.make_navigation(self.pages, page)))
-				exported_file.close()
-				page = page+1
-				item=1
-				tmp2 = None
-			else:
-				item=item+1
-			i=i+1
-		#}}}
-		# convert/copy the griffith picture for movies without a poster
-		image_file_src = os.path.join(self.locations['images'], 'griffith.png')
-		image_file_dst = os.path.join(posters_dir, 'nopic.' + config['poster_format'].lower())
-		try:
-			if config['poster_convert']:
-				im = Image.open(image_file_src, 'r').convert(config['poster_mode'])
-				im.thumbnail((config['poster_width'], config['poster_height']), Image.ANTIALIAS)
-			else:
-				im = Image.open(image_file_src, 'r')
-			im.save(image_file_dst, config['poster_format'])
-		except:
-			self.debug.show(&quot;Can't convert %s&quot; % image_file_src)
-		gutils.info(self, _(&quot;Document has been generated.&quot;), self)
-		self.on_quit()
-	#}}}
+            # close file if last item
+            if ((page-1)*self.entries_per_page)+item == number_of_exported_movies:
+                tmp2 = tpl_tail + ''
+                exported_file.write(self.fill_template(tmp2, 'navigation', self.make_navigation(self.pages, page)))
+                exported_file.close()
+                tmp2 = None
+            
+            # close file if last item in page
+            elif item == self.entries_per_page:
+                tmp2 = tpl_tail + ''
+                exported_file.write(self.fill_template(tmp2, 'navigation', self.make_navigation(self.pages, page)))
+                exported_file.close()
+                page = page+1
+                item=1
+                tmp2 = None
+            else:
+                item=item+1
+            i=i+1
+        #}}}
+        # convert/copy the griffith picture for movies without a poster
+        image_file_src = os.path.join(self.locations['images'], 'griffith.png')
+        image_file_dst = os.path.join(posters_dir, 'nopic.' + config['poster_format'].lower())
+        try:
+            if config['poster_convert']:
+                im = Image.open(image_file_src, 'r').convert(config['poster_mode'])
+                im.thumbnail((config['poster_width'], config['poster_height']), Image.ANTIALIAS)
+            else:
+                im = Image.open(image_file_src, 'r')
+            im.save(image_file_dst, config['poster_format'])
+        except:
+            self.debug.show(&quot;Can't convert %s&quot; % image_file_src)
+        gutils.info(self, _(&quot;Document has been generated.&quot;), self)
+        self.on_quit()
+    #}}}
 

Modified: trunk/lib/plugins/export/PluginExportXML.py
===================================================================
--- trunk/lib/plugins/export/PluginExportXML.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/export/PluginExportXML.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -36,62 +36,62 @@
 
 class ExportPlugin:
 
-	def __init__(self, database, locations, parent_window, debug, **kwargs):
-		self.db = database
-		self.locations = locations
-		self.parent = parent_window
-		if kwargs.has_key('config'):
-			self.persistent_config = kwargs['config']
-		else:
-			self.persistent_config = None
-		self.export_xml()
+    def __init__(self, database, locations, parent_window, debug, **kwargs):
+        self.db = database
+        self.locations = locations
+        self.parent = parent_window
+        if kwargs.has_key('config'):
+            self.persistent_config = kwargs['config']
+        else:
+            self.persistent_config = None
+        self.export_xml()
 
-	def export_xml(self):
-		basedir = None
-		if not self.persistent_config is None:
-			basedir = self.persistent_config.get('export_dir', None, section='export-xml')
-		if basedir is None:
-			filename = gutils.file_chooser(_(&quot;Export a %s document&quot;)%&quot;XML&quot;, action=gtk.FILE_CHOOSER_ACTION_SAVE, \
-				buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.xml')
-		else:
-			filename = gutils.file_chooser(_(&quot;Export a %s document&quot;)%&quot;XML&quot;, action=gtk.FILE_CHOOSER_ACTION_SAVE, \
-				buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.xml',folder=basedir)
-		if filename[0]:
-			if not self.persistent_config is None and filename[1]:
-				self.persistent_config.set('export_dir', filename[1], section='export-xml')
-				self.persistent_config.save()
-			overwrite = None
-			if os.path.isfile(filename[0]):
-				response = gutils.question(self, _(&quot;File exists. Do you want to overwrite it?&quot;), 1, self.parent)
-				if response==-8:
-					overwrite = True
-				else:
-					overwrite = False
-					
-			if overwrite == True or overwrite is None:
-				# create document
-				impl = xml.dom.minidom.getDOMImplementation()
-				doc  = impl.createDocument(None, &quot;root&quot;, None)
-				root = doc.documentElement
-				
-				# create object
-				for movie in self.db.Movie.all():
-					e = doc.createElement('movie')
-					root.appendChild(e)
-					for key in movie.c.keys():
-						e2 = doc.createElement(key)
-						if movie[key] is None:
-							value = ''
-						elif movie[key] in (True, False):
-							value = str(int(movie[key]))
-						else:
-							value = str(movie[key])
-						t = doc.createTextNode(value)
-						e2.appendChild(t)
-						e.appendChild(e2)
-					
-				# write XML to file
-				fp = open(filename[0], &quot;w&quot;)
-				xml.dom.ext.PrettyPrint(doc, fp)
-				fp.close()
-				gutils.info(self, _(&quot;%s file has been created.&quot;)%&quot;XML&quot;, self.parent)
+    def export_xml(self):
+        basedir = None
+        if not self.persistent_config is None:
+            basedir = self.persistent_config.get('export_dir', None, section='export-xml')
+        if basedir is None:
+            filename = gutils.file_chooser(_(&quot;Export a %s document&quot;)%&quot;XML&quot;, action=gtk.FILE_CHOOSER_ACTION_SAVE, \
+                buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.xml')
+        else:
+            filename = gutils.file_chooser(_(&quot;Export a %s document&quot;)%&quot;XML&quot;, action=gtk.FILE_CHOOSER_ACTION_SAVE, \
+                buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.xml',folder=basedir)
+        if filename[0]:
+            if not self.persistent_config is None and filename[1]:
+                self.persistent_config.set('export_dir', filename[1], section='export-xml')
+                self.persistent_config.save()
+            overwrite = None
+            if os.path.isfile(filename[0]):
+                response = gutils.question(self, _(&quot;File exists. Do you want to overwrite it?&quot;), 1, self.parent)
+                if response==-8:
+                    overwrite = True
+                else:
+                    overwrite = False
+                    
+            if overwrite == True or overwrite is None:
+                # create document
+                impl = xml.dom.minidom.getDOMImplementation()
+                doc  = impl.createDocument(None, &quot;root&quot;, None)
+                root = doc.documentElement
+                
+                # create object
+                for movie in self.db.Movie.all():
+                    e = doc.createElement('movie')
+                    root.appendChild(e)
+                    for key in movie.c.keys():
+                        e2 = doc.createElement(key)
+                        if movie[key] is None:
+                            value = ''
+                        elif movie[key] in (True, False):
+                            value = str(int(movie[key]))
+                        else:
+                            value = str(movie[key])
+                        t = doc.createTextNode(value)
+                        e2.appendChild(t)
+                        e.appendChild(e2)
+                    
+                # write XML to file
+                fp = open(filename[0], &quot;w&quot;)
+                xml.dom.ext.PrettyPrint(doc, fp)
+                fp.close()
+                gutils.info(self, _(&quot;%s file has been created.&quot;)%&quot;XML&quot;, self.parent)

Modified: trunk/lib/plugins/export/PluginExportiPod.py
===================================================================
--- trunk/lib/plugins/export/PluginExportiPod.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/export/PluginExportiPod.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -71,48 +71,48 @@
         self.parent = parent_window
         self.export_iPod()
 
-	def split_file(self, filename):
-		pass
+    def split_file(self, filename):
+        pass
 
     def export_iPod(self):
-		tmp_dir = mkdtemp()
-		griffith_list = open(os.path.join(tmp_dir,&quot;movies&quot;),&quot;w&quot;)
-		t = []
-		
-		for movie in self.db.Movie.all():
-			t.append(&quot;%s | %s | %s | %s&quot;%(movie['number'],movie['o_title'],movie['title'],movie['director']))
-	
-		griffith_list.write(&quot;&lt;title&gt;%s&lt;/title&gt;&lt;br&gt;&lt;br&gt;&quot;%_(&quot;My Movies List&quot;))
-		
-		for movie in t:
-			griffith_list.write(str(movie))
-			griffith_list.write(&quot;&lt;br&gt;&quot;)
-			
-		griffith_list.close()
-		
-		# this is a mac, lets export to iPod's notes folder
-		# TODO: windows and linux iPod autodetection
-		if platform.system() == 'Darwin':
-			thisPod=Path2iPod()
-			thisPath=thisPod.returnPath()
-		
-			if thisPath:
-				commands.getoutput('mv '+os.path.join(tmp_dir,&quot;movies&quot;)+' &quot;'+thisPath+'/Notes/&quot;')
-				gutils.info(self, _(&quot;List was successful exported to iPod.&quot;), self.parent)		
-			else:
-				gutils.info(self, _(&quot;iPod is not connected.&quot;), self.parent)
-		# this is not a mac, lets save the file
-		else:
-			filename = gutils.file_chooser(_(&quot;Export a %s document&quot;)%&quot;CSV&quot;, action=gtk.FILE_CHOOSER_ACTION_SAVE, \
-				buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='ipod_griffith_list')
-			if filename[0]:
-				overwrite = None
-				if os.path.isfile(filename[0]):
-					response = gutils.question(self, _(&quot;File exists. Do you want to overwrite it?&quot;), 1, self.parent)
-					if response==-8:
-						overwrite = True
-					else:
-						overwrite = False
-				if overwrite == True or overwrite is None:
-					shutil.copyfile(os.path.join(tmp_dir,&quot;movies&quot;), filename[0])
-					gutils.info(self, _(&quot;List was successful exported. Now you should move it to the 'Notes' folder on your iPod.&quot;), self.parent)
+        tmp_dir = mkdtemp()
+        griffith_list = open(os.path.join(tmp_dir,&quot;movies&quot;),&quot;w&quot;)
+        t = []
+        
+        for movie in self.db.Movie.all():
+            t.append(&quot;%s | %s | %s | %s&quot;%(movie['number'],movie['o_title'],movie['title'],movie['director']))
+    
+        griffith_list.write(&quot;&lt;title&gt;%s&lt;/title&gt;&lt;br&gt;&lt;br&gt;&quot;%_(&quot;My Movies List&quot;))
+        
+        for movie in t:
+            griffith_list.write(str(movie))
+            griffith_list.write(&quot;&lt;br&gt;&quot;)
+            
+        griffith_list.close()
+        
+        # this is a mac, lets export to iPod's notes folder
+        # TODO: windows and linux iPod autodetection
+        if platform.system() == 'Darwin':
+            thisPod=Path2iPod()
+            thisPath=thisPod.returnPath()
+        
+            if thisPath:
+                commands.getoutput('mv '+os.path.join(tmp_dir,&quot;movies&quot;)+' &quot;'+thisPath+'/Notes/&quot;')
+                gutils.info(self, _(&quot;List was successful exported to iPod.&quot;), self.parent)        
+            else:
+                gutils.info(self, _(&quot;iPod is not connected.&quot;), self.parent)
+        # this is not a mac, lets save the file
+        else:
+            filename = gutils.file_chooser(_(&quot;Export a %s document&quot;)%&quot;CSV&quot;, action=gtk.FILE_CHOOSER_ACTION_SAVE, \
+                buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='ipod_griffith_list')
+            if filename[0]:
+                overwrite = None
+                if os.path.isfile(filename[0]):
+                    response = gutils.question(self, _(&quot;File exists. Do you want to overwrite it?&quot;), 1, self.parent)
+                    if response==-8:
+                        overwrite = True
+                    else:
+                        overwrite = False
+                if overwrite == True or overwrite is None:
+                    shutil.copyfile(os.path.join(tmp_dir,&quot;movies&quot;), filename[0])
+                    gutils.info(self, _(&quot;List was successful exported. Now you should move it to the 'Notes' folder on your iPod.&quot;), self.parent)

Modified: trunk/lib/plugins/imp/CSV.py
===================================================================
--- trunk/lib/plugins/imp/CSV.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/imp/CSV.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -22,394 +22,394 @@
 
 
 def digits_only(s):
-	import string, re
-	_match = re.compile(r&quot;\d+&quot;)
-	try:
-		s = reduce( string.join, _match.findall(s) )
-	except:
-		s = '0'
-	return s
-	
+    import string, re
+    _match = re.compile(r&quot;\d+&quot;)
+    try:
+        s = reduce( string.join, _match.findall(s) )
+    except:
+        s = '0'
+    return s
+    
 def letters_only(s):
-	import string, re
-	_match = re.compile(r&quot;\D+&quot;)
-	try:
-		s = reduce( string.join, _match.findall(s) )
-	except:
-		s = s
-	return s
-	
+    import string, re
+    _match = re.compile(r&quot;\D+&quot;)
+    try:
+        s = reduce( string.join, _match.findall(s) )
+    except:
+        s = s
+    return s
+    
 class ImportPlugin(IP):
-	description	= _(&quot;Full CSV list import plugin&quot;)
-	author		= &quot;Jessica Katharina Parth&quot;
-	email		= &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">Jessica.K.P at women-at-work.org</A>&quot;
-	version		= &quot;0.3&quot;
-	file_filters	= '*.[cC][sS][vV]'
-	mime_types	= ('text/comma-separated-values', 'text/csv', 'application/csv')
+    description    = _(&quot;Full CSV list import plugin&quot;)
+    author        = &quot;Jessica Katharina Parth&quot;
+    email        = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">Jessica.K.P at women-at-work.org</A>&quot;
+    version        = &quot;0.3&quot;
+    file_filters    = '*.[cC][sS][vV]'
+    mime_types    = ('text/comma-separated-values', 'text/csv', 'application/csv')
 
-	def initialize(self):
-		if not IP.initialize(self):
-			return False
-		# glade
-		gf = os.path.join(self.locations['glade'], 'importcsv.glade')
-		# try to open the glade file
-		try:
-			self.gtk = gtk.glade.XML(gf)
-		except:
-			self.debug.show(&quot;Glade-file %s can not be loaded.&quot; % gf)
-			return False
-		# open gtk window
-		self.gtk.get_widget('d_import').set_transient_for( self.widgets['window'] )
-		
-		# simple string lists
-		self.tv_csv = self.gtk.get_widget('tv_csv')
-		self.tv_assigned = self.gtk.get_widget('tv_assigned')
-		self.tv_griffith = self.gtk.get_widget('tv_griffith')
-		
-		# 1st list
-		self.ls_csv = gtk.ListStore(str)
-		self.tv_csv.set_model(self.ls_csv)
-		renderer = gtk.CellRendererText()
-		column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=0)
-		self.tv_csv.append_column(column)
-		
-		# 2nd list 
-		self.ls_griffith = gtk.ListStore(str,str)
-		self.tv_griffith.set_model(self.ls_griffith)
-		renderer = gtk.CellRendererText()
-		column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=0)
-		column.set_visible(False)
-		self.tv_griffith.append_column(column)
-		column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=1)
-		self.tv_griffith.append_column(column)
-		self.set_griffith_fields()
-		
-		# 3rd list
-		self.ls_assigned = gtk.ListStore(str,str,str)
-		self.tv_assigned.set_model(self.ls_assigned)
-		renderer = gtk.CellRendererText()
-		column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=0)
-		self.tv_assigned.append_column(column)
-		# add the columns for internal information handling and hide them
-		column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=1)
-		column.set_visible(False)
-		self.tv_assigned.append_column(column)
-		column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=2)
-		column.set_visible(False)
-		self.tv_assigned.append_column(column)
-	
-		# hide tabs
-		self.nb_pages = self.gtk.get_widget('nb_pages')
-		self.nb_pages.get_nth_page(1).hide()
-		self.nb_pages.connect(&quot;switch-page&quot;, self._on_page_changed)
-		
-		# Events
-		# Buttons
-		self.b_cancel = self.gtk.get_widget(&quot;b_cancel&quot;)
-		self.b_cancel.connect(&quot;clicked&quot;, self._clicked)
-		
-		self.b_next = self.gtk.get_widget(&quot;b_next&quot;)
-		self.b_next.connect(&quot;clicked&quot;, self._clicked)
-		
-		self.b_back = self.gtk.get_widget(&quot;b_back&quot;)
-		self.b_back.connect(&quot;clicked&quot;, self._clicked)
-		
-		self.b_add = self.gtk.get_widget(&quot;b_add&quot;)
-		self.b_add.connect(&quot;clicked&quot;, self._clicked)
-		
-		self.b_del = self.gtk.get_widget(&quot;b_del&quot;)
-		self.b_del.connect(&quot;clicked&quot;, self._clicked)
-		
-		# Treeviews
-		self.tv_griffith.connect(&quot;row_activated&quot;, self._on_row_activated)
-		self.tv_griffith.connect(&quot;cursor_changed&quot;, self._on_cursor_changed)
-		self.tv_csv.connect(&quot;row_activated&quot;, self._on_row_activated)
-		self.tv_csv.connect(&quot;cursor_changed&quot;, self._on_cursor_changed)
-		self.tv_assigned.connect(&quot;cursor_changed&quot;, self._on_cursor_changed)
-		
-		self.gtk.get_widget('e_lineterminator').set_active(0)
-		
-		self.selected_griffith = None
-		self.selected_csv = None
-		self.current_csv_row = 0
-		self.csv_header = None
-		return True
-	
-	def set_griffith_fields(self):
-		# 2nd list
-		sorted_list = ( &quot;number&quot;, &quot;title&quot;, &quot;o_title&quot;, &quot;director&quot;, &quot;year&quot;, &quot;country&quot;,
-				&quot;cast&quot;, &quot;studio&quot;, &quot;plot&quot;, &quot;runtime&quot;, &quot;genre&quot;, &quot;classification&quot;,
-				&quot;site&quot;, &quot;o_site&quot;, &quot;trailer&quot;, &quot;image&quot;, &quot;seen&quot;, &quot;loaned&quot;, &quot;notes&quot;,
-				&quot;rating&quot;, &quot;movie_id&quot;, &quot;collection_id&quot;, &quot;volume_id&quot;, &quot;medium_id&quot;,
-				&quot;vcodec_id&quot;, &quot;color&quot;, &quot;cond&quot;, &quot;layers&quot;, &quot;region&quot;, &quot;media_num&quot; )
-		# sort the list and add field and translated field-name
-		for sorted in sorted_list:
-			for name in self.fields_to_import:
-				if sorted == name:
-					iterator = self.ls_griffith.append()
-					self.ls_griffith.set_value(iterator, 0, name)
-					self.ls_griffith.set_value(iterator, 1, self.fields[name])
+    def initialize(self):
+        if not IP.initialize(self):
+            return False
+        # glade
+        gf = os.path.join(self.locations['glade'], 'importcsv.glade')
+        # try to open the glade file
+        try:
+            self.gtk = gtk.glade.XML(gf)
+        except:
+            self.debug.show(&quot;Glade-file %s can not be loaded.&quot; % gf)
+            return False
+        # open gtk window
+        self.gtk.get_widget('d_import').set_transient_for( self.widgets['window'] )
+        
+        # simple string lists
+        self.tv_csv = self.gtk.get_widget('tv_csv')
+        self.tv_assigned = self.gtk.get_widget('tv_assigned')
+        self.tv_griffith = self.gtk.get_widget('tv_griffith')
+        
+        # 1st list
+        self.ls_csv = gtk.ListStore(str)
+        self.tv_csv.set_model(self.ls_csv)
+        renderer = gtk.CellRendererText()
+        column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=0)
+        self.tv_csv.append_column(column)
+        
+        # 2nd list 
+        self.ls_griffith = gtk.ListStore(str,str)
+        self.tv_griffith.set_model(self.ls_griffith)
+        renderer = gtk.CellRendererText()
+        column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=0)
+        column.set_visible(False)
+        self.tv_griffith.append_column(column)
+        column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=1)
+        self.tv_griffith.append_column(column)
+        self.set_griffith_fields()
+        
+        # 3rd list
+        self.ls_assigned = gtk.ListStore(str,str,str)
+        self.tv_assigned.set_model(self.ls_assigned)
+        renderer = gtk.CellRendererText()
+        column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=0)
+        self.tv_assigned.append_column(column)
+        # add the columns for internal information handling and hide them
+        column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=1)
+        column.set_visible(False)
+        self.tv_assigned.append_column(column)
+        column = gtk.TreeViewColumn(&quot;none&quot;, renderer, text=2)
+        column.set_visible(False)
+        self.tv_assigned.append_column(column)
+    
+        # hide tabs
+        self.nb_pages = self.gtk.get_widget('nb_pages')
+        self.nb_pages.get_nth_page(1).hide()
+        self.nb_pages.connect(&quot;switch-page&quot;, self._on_page_changed)
+        
+        # Events
+        # Buttons
+        self.b_cancel = self.gtk.get_widget(&quot;b_cancel&quot;)
+        self.b_cancel.connect(&quot;clicked&quot;, self._clicked)
+        
+        self.b_next = self.gtk.get_widget(&quot;b_next&quot;)
+        self.b_next.connect(&quot;clicked&quot;, self._clicked)
+        
+        self.b_back = self.gtk.get_widget(&quot;b_back&quot;)
+        self.b_back.connect(&quot;clicked&quot;, self._clicked)
+        
+        self.b_add = self.gtk.get_widget(&quot;b_add&quot;)
+        self.b_add.connect(&quot;clicked&quot;, self._clicked)
+        
+        self.b_del = self.gtk.get_widget(&quot;b_del&quot;)
+        self.b_del.connect(&quot;clicked&quot;, self._clicked)
+        
+        # Treeviews
+        self.tv_griffith.connect(&quot;row_activated&quot;, self._on_row_activated)
+        self.tv_griffith.connect(&quot;cursor_changed&quot;, self._on_cursor_changed)
+        self.tv_csv.connect(&quot;row_activated&quot;, self._on_row_activated)
+        self.tv_csv.connect(&quot;cursor_changed&quot;, self._on_cursor_changed)
+        self.tv_assigned.connect(&quot;cursor_changed&quot;, self._on_cursor_changed)
+        
+        self.gtk.get_widget('e_lineterminator').set_active(0)
+        
+        self.selected_griffith = None
+        self.selected_csv = None
+        self.current_csv_row = 0
+        self.csv_header = None
+        return True
+    
+    def set_griffith_fields(self):
+        # 2nd list
+        sorted_list = ( &quot;number&quot;, &quot;title&quot;, &quot;o_title&quot;, &quot;director&quot;, &quot;year&quot;, &quot;country&quot;,
+                &quot;cast&quot;, &quot;studio&quot;, &quot;plot&quot;, &quot;runtime&quot;, &quot;genre&quot;, &quot;classification&quot;,
+                &quot;site&quot;, &quot;o_site&quot;, &quot;trailer&quot;, &quot;image&quot;, &quot;seen&quot;, &quot;loaned&quot;, &quot;notes&quot;,
+                &quot;rating&quot;, &quot;movie_id&quot;, &quot;collection_id&quot;, &quot;volume_id&quot;, &quot;medium_id&quot;,
+                &quot;vcodec_id&quot;, &quot;color&quot;, &quot;cond&quot;, &quot;layers&quot;, &quot;region&quot;, &quot;media_num&quot; )
+        # sort the list and add field and translated field-name
+        for sorted in sorted_list:
+            for name in self.fields_to_import:
+                if sorted == name:
+                    iterator = self.ls_griffith.append()
+                    self.ls_griffith.set_value(iterator, 0, name)
+                    self.ls_griffith.set_value(iterator, 1, self.fields[name])
 
-	def create_import_table(self):
-		self.import_table = {}
-		item = self.ls_assigned.get_iter_first()
-		while item is not None:
-			self.import_table[self.ls_assigned.get_value(item,1)] = self.ls_assigned.get_value(item,2)
-			item = self.ls_assigned.iter_next(item)
-			
-	def _on_page_changed(self, notebook, page, page_num):
-		if page_num == 0:
-			self.b_back.set_sensitive(False)
-		if page_num == 1:
-			self.b_back.set_sensitive(True)
-			self.open_source()
-			
-		
-	def _clicked(self, widget, event=None, data=None):
-		if widget == self.b_cancel:
-			self.gtk.get_widget('d_import').hide()
-			self.gtk.get_widget('d_import').response(gtk.RESPONSE_CANCEL)
-			
-		if widget == self.b_back:
-			if self.nb_pages.get_current_page() == 1:
-				self.nb_pages.prev_page()
+    def create_import_table(self):
+        self.import_table = {}
+        item = self.ls_assigned.get_iter_first()
+        while item is not None:
+            self.import_table[self.ls_assigned.get_value(item,1)] = self.ls_assigned.get_value(item,2)
+            item = self.ls_assigned.iter_next(item)
+            
+    def _on_page_changed(self, notebook, page, page_num):
+        if page_num == 0:
+            self.b_back.set_sensitive(False)
+        if page_num == 1:
+            self.b_back.set_sensitive(True)
+            self.open_source()
+            
+        
+    def _clicked(self, widget, event=None, data=None):
+        if widget == self.b_cancel:
+            self.gtk.get_widget('d_import').hide()
+            self.gtk.get_widget('d_import').response(gtk.RESPONSE_CANCEL)
+            
+        if widget == self.b_back:
+            if self.nb_pages.get_current_page() == 1:
+                self.nb_pages.prev_page()
 
-		if widget == self.b_next:
-			if self.nb_pages.get_current_page() == 0:
-				self.nb_pages.get_nth_page(1).show()
-				self.nb_pages.next_page()
-			else:
-				if self.nb_pages.get_current_page() == 1:
-					# test if at least one field is assigned
-					if self.ls_assigned.get_iter_first() is not None:
-						# prepare tabelle for import
-						self.create_import_table()
-							
-						# hide everything
-						self.gtk.get_widget('d_import').hide()
-						self.gtk.get_widget('d_import').response(gtk.RESPONSE_OK)
-					else:
-						gutils.info(self.gtk, _(&quot;Please assign at least one field first!&quot;), self.gtk.get_widget('d_import') )
-						
-		if widget == self.b_add:
-			iterator = self.ls_assigned.append()
-			self.ls_assigned.set_value(iterator, 0, &quot;%s &gt; %s&quot; % (self.selected_csv, self.fields[self.selected_griffith]) )
-			# add information for the import tabelle
-			self.ls_assigned.set_value(iterator, 1, self.selected_griffith )
-			self.ls_assigned.set_value(iterator, 2, str(self.csv_header.index(self.selected_csv)) )
-			self.ls_griffith.remove(self.iter_griffith)
-			self.selected_griffith = None
-			
-			self.b_add.set_sensitive(False)
-		
-		if widget == self.b_del:
-			# re-add field to griffith
-			field_name = self.ls_assigned.get_value(self.iter_assigned,1)
+        if widget == self.b_next:
+            if self.nb_pages.get_current_page() == 0:
+                self.nb_pages.get_nth_page(1).show()
+                self.nb_pages.next_page()
+            else:
+                if self.nb_pages.get_current_page() == 1:
+                    # test if at least one field is assigned
+                    if self.ls_assigned.get_iter_first() is not None:
+                        # prepare tabelle for import
+                        self.create_import_table()
+                            
+                        # hide everything
+                        self.gtk.get_widget('d_import').hide()
+                        self.gtk.get_widget('d_import').response(gtk.RESPONSE_OK)
+                    else:
+                        gutils.info(self.gtk, _(&quot;Please assign at least one field first!&quot;), self.gtk.get_widget('d_import') )
+                        
+        if widget == self.b_add:
+            iterator = self.ls_assigned.append()
+            self.ls_assigned.set_value(iterator, 0, &quot;%s &gt; %s&quot; % (self.selected_csv, self.fields[self.selected_griffith]) )
+            # add information for the import tabelle
+            self.ls_assigned.set_value(iterator, 1, self.selected_griffith )
+            self.ls_assigned.set_value(iterator, 2, str(self.csv_header.index(self.selected_csv)) )
+            self.ls_griffith.remove(self.iter_griffith)
+            self.selected_griffith = None
+            
+            self.b_add.set_sensitive(False)
+        
+        if widget == self.b_del:
+            # re-add field to griffith
+            field_name = self.ls_assigned.get_value(self.iter_assigned,1)
 
-			iterator = self.ls_griffith.append()
-			self.ls_griffith.set_value(iterator, 0, field_name)
-			self.ls_griffith.set_value(iterator, 1, self.fields[field_name])
-			
-			# remove assigned row
-			self.ls_assigned.remove(self.iter_assigned)
-			
-			self.b_del.set_sensitive(False)
-			
-					
-	def _on_row_activated(self, treeview, path, view_column, data = None):
-		# get selected rows from both treeviews/lists
-		if treeview == self.tv_griffith:
-			self.iter_griffith = self.ls_griffith.get_iter(path)
-		
-			if self.iter_griffith:
-				self.selected_griffith = self.ls_griffith.get_value(self.iter_griffith,0)
-		
-		if treeview == self.tv_csv:
-			iter = self.ls_csv.get_iter(path)
-		
-			if iter:
-				self.selected_csv = self.ls_csv.get_value(iter,0)
-				
-		# enable add button if both lists have a selected item
-		if self.selected_griffith is not None and self.selected_csv is not None:
-			self.b_add.set_sensitive(True)
-		else:
-			self.b_add.set_sensitive(False)
-		
-	def _on_cursor_changed(self, widget, data1 = None, data2 = None):
-		# get selected rows from both treeviews/lists
-		selection = widget.get_selection()
-		(model,iter) = selection.get_selected()
-			
-		if widget == self.tv_griffith:
-			self.iter_griffith = iter
-			if self.iter_griffith:
-				self.selected_griffith = str(model.get_value(self.iter_griffith, 0))
-			else:
-				self.selected_griffith = None
-		
-		if widget == self.tv_csv:
-			if iter:
-				self.selected_csv = str(model.get_value(iter, 0))
-			else:
-				self.selected_csv = None
-				
-		if widget == self.tv_assigned:
-			self.iter_assigned = iter
-			if self.iter_assigned:
-				self.b_del.set_sensitive(True)
-			else:
-				self.b_del.set_sensitive(False)
-				
-		# enable add button if both lists have a selected item
-		if self.selected_griffith is not None and self.selected_csv is not None:
-			self.b_add.set_sensitive(True)
-		else:
-			self.b_add.set_sensitive(False)
-			
-	def open_source(self):
-		import csv, codecs, os
-		# get user values for converting/opening the csv-file
-		self.start_row = int(digits_only( self.gtk.get_widget('e_startrow').get_text() ))
-		encoding = self.gtk.get_widget('e_encoding').get_active_text()
-		encoding = encoding[:string.find( encoding, ' ' )]
-		delimiter = self.gtk.get_widget('e_delimiter').get_text()
-		if delimiter == '':
-			delimiter = &quot;,&quot;
-		# quotechar
-		quotechar =  self.gtk.get_widget('e_quotechar').get_text()
-		if quotechar == '':
-			quotechar == '&quot;'
-		# lineterminator
-		active = self.gtk.get_widget('e_lineterminator').get_active()
-		# default for none selected and the same for linux and macintosh
-		lineterminator = '\r'
-		# windows lineterminator
-		if active == 1:
-			lineterminator = '\r\n'
-		
-		# open file
-		try:
-			self.data = csv.reader(codecs.open(self.__source_name, 'r', encoding), dialect='excel', quotechar=quotechar, delimiter=delimiter, lineterminator = lineterminator)
+            iterator = self.ls_griffith.append()
+            self.ls_griffith.set_value(iterator, 0, field_name)
+            self.ls_griffith.set_value(iterator, 1, self.fields[field_name])
+            
+            # remove assigned row
+            self.ls_assigned.remove(self.iter_assigned)
+            
+            self.b_del.set_sensitive(False)
+            
+                    
+    def _on_row_activated(self, treeview, path, view_column, data = None):
+        # get selected rows from both treeviews/lists
+        if treeview == self.tv_griffith:
+            self.iter_griffith = self.ls_griffith.get_iter(path)
+        
+            if self.iter_griffith:
+                self.selected_griffith = self.ls_griffith.get_value(self.iter_griffith,0)
+        
+        if treeview == self.tv_csv:
+            iter = self.ls_csv.get_iter(path)
+        
+            if iter:
+                self.selected_csv = self.ls_csv.get_value(iter,0)
+                
+        # enable add button if both lists have a selected item
+        if self.selected_griffith is not None and self.selected_csv is not None:
+            self.b_add.set_sensitive(True)
+        else:
+            self.b_add.set_sensitive(False)
+        
+    def _on_cursor_changed(self, widget, data1 = None, data2 = None):
+        # get selected rows from both treeviews/lists
+        selection = widget.get_selection()
+        (model,iter) = selection.get_selected()
+            
+        if widget == self.tv_griffith:
+            self.iter_griffith = iter
+            if self.iter_griffith:
+                self.selected_griffith = str(model.get_value(self.iter_griffith, 0))
+            else:
+                self.selected_griffith = None
+        
+        if widget == self.tv_csv:
+            if iter:
+                self.selected_csv = str(model.get_value(iter, 0))
+            else:
+                self.selected_csv = None
+                
+        if widget == self.tv_assigned:
+            self.iter_assigned = iter
+            if self.iter_assigned:
+                self.b_del.set_sensitive(True)
+            else:
+                self.b_del.set_sensitive(False)
+                
+        # enable add button if both lists have a selected item
+        if self.selected_griffith is not None and self.selected_csv is not None:
+            self.b_add.set_sensitive(True)
+        else:
+            self.b_add.set_sensitive(False)
+            
+    def open_source(self):
+        import csv, codecs, os
+        # get user values for converting/opening the csv-file
+        self.start_row = int(digits_only( self.gtk.get_widget('e_startrow').get_text() ))
+        encoding = self.gtk.get_widget('e_encoding').get_active_text()
+        encoding = encoding[:string.find( encoding, ' ' )]
+        delimiter = self.gtk.get_widget('e_delimiter').get_text()
+        if delimiter == '':
+            delimiter = &quot;,&quot;
+        # quotechar
+        quotechar =  self.gtk.get_widget('e_quotechar').get_text()
+        if quotechar == '':
+            quotechar == '&quot;'
+        # lineterminator
+        active = self.gtk.get_widget('e_lineterminator').get_active()
+        # default for none selected and the same for linux and macintosh
+        lineterminator = '\r'
+        # windows lineterminator
+        if active == 1:
+            lineterminator = '\r\n'
+        
+        # open file
+        try:
+            self.data = csv.reader(codecs.open(self.__source_name, 'r', encoding), dialect='excel', quotechar=quotechar, delimiter=delimiter, lineterminator = lineterminator)
 
-			# get the first line in csv file for the field names
-			self.csv_header = self.data.next()
-			
-			# if the user wants to import line 0 then we have to open it again 
-			if self.start_row == 0:
-				self.data = csv.reader(codecs.open(self.__source_name, 'r', encoding), dialect='excel', quotechar=quotechar, delimiter=delimiter, lineterminator = lineterminator)
-			
-		
-			# fill the found csv-headers in the simple string list
-			self.ls_csv.clear()
-			for name in self.csv_header:
-				iterator = self.ls_csv.append()
-				self.ls_csv.set_value(iterator, 0, name)
-			return True
-		except:
-			gutils.info(self.gtk, _(&quot;Can't open the file %s&quot;) % self.__source_name, self.gtk.get_widget('d_import') )
-			return False
-			
+            # get the first line in csv file for the field names
+            self.csv_header = self.data.next()
+            
+            # if the user wants to import line 0 then we have to open it again 
+            if self.start_row == 0:
+                self.data = csv.reader(codecs.open(self.__source_name, 'r', encoding), dialect='excel', quotechar=quotechar, delimiter=delimiter, lineterminator = lineterminator)
+            
+        
+            # fill the found csv-headers in the simple string list
+            self.ls_csv.clear()
+            for name in self.csv_header:
+                iterator = self.ls_csv.append()
+                self.ls_csv.set_value(iterator, 0, name)
+            return True
+        except:
+            gutils.info(self.gtk, _(&quot;Can't open the file %s&quot;) % self.__source_name, self.gtk.get_widget('d_import') )
+            return False
+            
 
-	def set_source(self, name):
-		import os
-		# source _dependent_ initialization goes here
-		if name is None or not os.path.isfile(name):
-			return False
-		self.__source_name = name
-		# auto-detect file-encoding (optional)
-		try:
-			from chardet.universaldetector import UniversalDetector
-			detector = UniversalDetector()
-			detector.reset()
-			lines = 0
-			for line in file(self.__source_name, 'rb'):
-				detector.feed(line)
-				lines += 1
-				if detector.done or lines == 50:
-					break
-			detector.close()
-			encoding = string.replace( string.lower( detector.result['encoding'] ), '-', '' )
-		except:
-			encoding = 'utf_8'
-		# remove - and _ for better detection
-		encoding = string.replace( encoding, '_', '' )
-		
-		model	= self.gtk.get_widget('e_encoding').get_model()
-		itempos	= 0
-		for item in model:
-			pos1 = string.find( string.replace( string.lower(str(item[0])), '_', '' ) , encoding )
-			if pos1 == 0:
-				break
-			itempos += 1
-		self.gtk.get_widget('e_encoding').set_active(itempos)
-		
-		# run dialog
-		response = self.gtk.get_widget('d_import').run()
-		if response == gtk.RESPONSE_OK:
-			return True
-		else:
-			return False
+    def set_source(self, name):
+        import os
+        # source _dependent_ initialization goes here
+        if name is None or not os.path.isfile(name):
+            return False
+        self.__source_name = name
+        # auto-detect file-encoding (optional)
+        try:
+            from chardet.universaldetector import UniversalDetector
+            detector = UniversalDetector()
+            detector.reset()
+            lines = 0
+            for line in file(self.__source_name, 'rb'):
+                detector.feed(line)
+                lines += 1
+                if detector.done or lines == 50:
+                    break
+            detector.close()
+            encoding = string.replace( string.lower( detector.result['encoding'] ), '-', '' )
+        except:
+            encoding = 'utf_8'
+        # remove - and _ for better detection
+        encoding = string.replace( encoding, '_', '' )
+        
+        model    = self.gtk.get_widget('e_encoding').get_model()
+        itempos    = 0
+        for item in model:
+            pos1 = string.find( string.replace( string.lower(str(item[0])), '_', '' ) , encoding )
+            if pos1 == 0:
+                break
+            itempos += 1
+        self.gtk.get_widget('e_encoding').set_active(itempos)
+        
+        # run dialog
+        response = self.gtk.get_widget('d_import').run()
+        if response == gtk.RESPONSE_OK:
+            return True
+        else:
+            return False
 
-	def count_movies(self):
-		i = 0
-		try:
-			import csv
-			data = csv.reader(open(self.__source_name))
-			while data.next():
-				i += 1
-		except:
-			return i
-	
-	def get_movie_details(self):
-		try:
-			item = self.data.next()
-		except:
-			return None
-		if item is None:
-			return None
-		import copy
-		# start with the right line
-		self.current_csv_row += 1
-		if (self.current_csv_row ) &lt; self.start_row:
-			return None
-		
-		# assign the keys
-		t_movies = copy.deepcopy(self.import_table)
+    def count_movies(self):
+        i = 0
+        try:
+            import csv
+            data = csv.reader(open(self.__source_name))
+            while data.next():
+                i += 1
+        except:
+            return i
+    
+    def get_movie_details(self):
+        try:
+            item = self.data.next()
+        except:
+            return None
+        if item is None:
+            return None
+        import copy
+        # start with the right line
+        self.current_csv_row += 1
+        if (self.current_csv_row ) &lt; self.start_row:
+            return None
+        
+        # assign the keys
+        t_movies = copy.deepcopy(self.import_table)
 
-		# values are overwritten here with the imports
-		for field in self.import_table:
-			try:
-				# some minor fixes to the import so it fits the griffith variable types
-				if field == 'year' or field == 'runtime' or field == 'media_num' or field == 'number'  or field == 'volume_id':
-					t_movies[field] = int( digits_only( item[ int(self.import_table[field]) ] ) )
-				elif field == 'seen' or field == 'loaned':
-					t_movies[field] = bool( item[ int(self.import_table[field]) ] )
-				elif field == 'country':
-					t_movies[field] = letters_only( item[ int(self.import_table[field]) ] )
-				elif field == 'cast':
-					try:
-						if item[ int(self.import_table[field]) ].index(&quot;, &quot;) != -1:
-							t_movies[field] = string.replace( item[ int(self.import_table[field]) ], &quot;, &quot;, &quot;\n&quot; )
-					except:
-						t_movies[field] = string.replace( item[ int(self.import_table[field]) ], &quot;,&quot;, &quot;\n&quot; )
-				else:
-					# 1:1 import
-					t_movies[field] = item[ int(self.import_table[field]) ]
-			except:
-				# error field can't be imported
-				t_movies.pop(field)
-		
-		return t_movies
+        # values are overwritten here with the imports
+        for field in self.import_table:
+            try:
+                # some minor fixes to the import so it fits the griffith variable types
+                if field == 'year' or field == 'runtime' or field == 'media_num' or field == 'number'  or field == 'volume_id':
+                    t_movies[field] = int( digits_only( item[ int(self.import_table[field]) ] ) )
+                elif field == 'seen' or field == 'loaned':
+                    t_movies[field] = bool( item[ int(self.import_table[field]) ] )
+                elif field == 'country':
+                    t_movies[field] = letters_only( item[ int(self.import_table[field]) ] )
+                elif field == 'cast':
+                    try:
+                        if item[ int(self.import_table[field]) ].index(&quot;, &quot;) != -1:
+                            t_movies[field] = string.replace( item[ int(self.import_table[field]) ], &quot;, &quot;, &quot;\n&quot; )
+                    except:
+                        t_movies[field] = string.replace( item[ int(self.import_table[field]) ], &quot;,&quot;, &quot;\n&quot; )
+                else:
+                    # 1:1 import
+                    t_movies[field] = item[ int(self.import_table[field]) ]
+            except:
+                # error field can't be imported
+                t_movies.pop(field)
+        
+        return t_movies
 
-	def clear(self):
-		IP.clear(self)
-		self.nb_pages.get_nth_page(1).hide()
-		self.csv_header = None
-		self.ls_assigned.clear()
-		self.ls_griffith.clear()
-		# add default griffith fields again
-		self.set_griffith_fields()
+    def clear(self):
+        IP.clear(self)
+        self.nb_pages.get_nth_page(1).hide()
+        self.csv_header = None
+        self.ls_assigned.clear()
+        self.ls_griffith.clear()
+        # add default griffith fields again
+        self.set_griffith_fields()
 
-	def destroy(self):
-		self.gtk.get_widget('d_import').destroy()
+    def destroy(self):
+        self.gtk.get_widget('d_import').destroy()

Modified: trunk/lib/plugins/imp/__init__.py
===================================================================
--- trunk/lib/plugins/imp/__init__.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/imp/__init__.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -29,211 +29,211 @@
 __all__.remove('__init__')
 
 class ImportPlugin:
-	description = None
-	author = None
-	email = None
-	version = None
-	# file chooser:
-	file_filters = None
-	mime_types = None
+    description = None
+    author = None
+    email = None
+    version = None
+    # file chooser:
+    file_filters = None
+    mime_types = None
 
-	edit = False		# open add window for every movie?
+    edit = False        # open add window for every movie?
 
-	imported = 0
-	data = None
+    imported = 0
+    data = None
 
-	def __init__(self, parent, fields_to_import):
-		self.db		= parent.db
-		self.debug	= parent.debug
-		self.locations	= parent.locations
-		self.fields	= parent.field_names
-		self.conditions	= parent._conditions
-		self.colors	= parent._colors
-		self.lang_types	= parent._lang_types
-		self.layers	= parent._layers
-		self.regions	= parent._regions
-		self.widgets	= parent.widgets['import']
-		self.fields_to_import = fields_to_import
-		self._abort	= False
+    def __init__(self, parent, fields_to_import):
+        self.db        = parent.db
+        self.debug    = parent.debug
+        self.locations    = parent.locations
+        self.fields    = parent.field_names
+        self.conditions    = parent._conditions
+        self.colors    = parent._colors
+        self.lang_types    = parent._lang_types
+        self.layers    = parent._layers
+        self.regions    = parent._regions
+        self.widgets    = parent.widgets['import']
+        self.fields_to_import = fields_to_import
+        self._abort    = False
 
-	def initialize(self):
-		&quot;&quot;&quot;Initializes plugin (get all parameters from user, etc.)&quot;&quot;&quot;
-		self.imported = 0
-		return True
+    def initialize(self):
+        &quot;&quot;&quot;Initializes plugin (get all parameters from user, etc.)&quot;&quot;&quot;
+        self.imported = 0
+        return True
 
-	def abort(self, *args):
-		&quot;&quot;&quot;called after abort button clicked&quot;&quot;&quot;
-		self._abort = True
+    def abort(self, *args):
+        &quot;&quot;&quot;called after abort button clicked&quot;&quot;&quot;
+        self._abort = True
 
-	def set_source(self, name):
-		&quot;&quot;&quot;Prepare source (open file, etc.)&quot;&quot;&quot;
+    def set_source(self, name):
+        &quot;&quot;&quot;Prepare source (open file, etc.)&quot;&quot;&quot;
 
-	def count_movies(self):
-		&quot;&quot;&quot;Returns number of movies in file which is about to be imported&quot;&quot;&quot;
-		pass
+    def count_movies(self):
+        &quot;&quot;&quot;Returns number of movies in file which is about to be imported&quot;&quot;&quot;
+        pass
 
-	def get_movie_details(self):
-		&quot;&quot;&quot;Returns dictionary with movie details&quot;&quot;&quot;
-		pass
+    def get_movie_details(self):
+        &quot;&quot;&quot;Returns dictionary with movie details&quot;&quot;&quot;
+        pass
 
-	def run(self, name):
-		&quot;&quot;&quot;Import movies, function called in a loop over source files&quot;&quot;&quot;
-		from add import validate_details, edit_movie
-		from gutils import find_next_available
-		from sqlalchemy import Select, func
-		import gtk
-		
-		if not self.set_source(name):
-			self.debug.show(&quot;Can't read data from file %s&quot; % name)
-			return False
-		
-		self.widgets['pwindow'].show()
-		while gtk.events_pending():	# give GTK some time for updates
-			gtk.main_iteration()
+    def run(self, name):
+        &quot;&quot;&quot;Import movies, function called in a loop over source files&quot;&quot;&quot;
+        from add import validate_details, edit_movie
+        from gutils import find_next_available
+        from sqlalchemy import Select, func
+        import gtk
+        
+        if not self.set_source(name):
+            self.debug.show(&quot;Can't read data from file %s&quot; % name)
+            return False
+        
+        self.widgets['pwindow'].show()
+        while gtk.events_pending():    # give GTK some time for updates
+            gtk.main_iteration()
 
-		# progressbar
-		update_on = []
-		count = self.count_movies()
-		if count &gt; 0:
-			for i in range(0,100):
-				update_on.append(int(float(i)/100*count))
+        # progressbar
+        update_on = []
+        count = self.count_movies()
+        if count &gt; 0:
+            for i in range(0,100):
+                update_on.append(int(float(i)/100*count))
 
-		statement = Select( [ func.max(self.db.Movie.c.number) ] )
-		number = statement.execute().fetchone()[0]
-		if number is None:
-			number = 1
-		else:
-			number += 1
+        statement = Select( [ func.max(self.db.Movie.c.number) ] )
+        number = statement.execute().fetchone()[0]
+        if number is None:
+            number = 1
+        else:
+            number += 1
 
-		statement = Select([self.db.Movie.c.number])
+        statement = Select([self.db.Movie.c.number])
 
-		processed = 0
-		while self._abort is False:
-			details = self.get_movie_details()
-			if details is None:
-				break
+        processed = 0
+        while self._abort is False:
+            details = self.get_movie_details()
+            if details is None:
+                break
 
-			processed += 1
-			if processed in update_on:
-				self.widgets['progressbar'].set_fraction(float(processed)/float(count))
-				gtk.main_iteration()
-				self.widgets['progressbar'].set_text(&quot;%s (%s/%s)&quot; % (str(self.imported), str(processed), str(count)))
-				gtk.main_iteration()
-				gtk.main_iteration() # extra iteration for abort button
+            processed += 1
+            if processed in update_on:
+                self.widgets['progressbar'].set_fraction(float(processed)/float(count))
+                gtk.main_iteration()
+                self.widgets['progressbar'].set_text(&quot;%s (%s/%s)&quot; % (str(self.imported), str(processed), str(count)))
+                gtk.main_iteration()
+                gtk.main_iteration() # extra iteration for abort button
 
-			if (details.has_key('o_title') and details['o_title']) or (details.has_key('title') and details['title']):
-				if details.has_key('o_title') and details['o_title']:
-					statement.whereclause = func.lower(self.db.Movie.c.o_title)==details['o_title'].lower()
-					if details.has_key('title') and details['title']:
-						statement.append_whereclause( func.lower(self.db.Movie.c.title)==details['title'].lower() )
-					tmp = statement.execute().fetchone()
-					if tmp is not None:
-						self.debug.show(&quot;movie already exists (number=%s, o_title=%s)&quot; % (tmp.number, details['o_title']))
-						continue
-				elif details.has_key('title') and details['title']:
-					statement.whereclause = func.lower(self.db.Movie.c.title)==details['title'].lower()
-					tmp = statement.execute().fetchone()
-					if tmp is not None:
-						self.debug.show(&quot;movie already exists (number=%s, title=%s)&quot; % (tmp.number, details['title']))
-						continue
-				validate_details(details, self.fields_to_import)
-				if self.edit is True:
-					response = edit_movie(self.parent, details)	# FIXME: wait until save or cancel button pressed
-					if response == 1:
-						self.imported += 1
-				else:
-					if not details.has_key('number') or (details.has_key('number') and details['number'] is None):
-						#details['number'] = find_next_available(self.db)
-						details['number'] = number
-						number += 1
-					#movie = self.db.Movie()
-					#movie.add_to_db(details)
-					try:
-						self.db.Movie.mapper.mapped_table.insert().execute(details)
-						self.imported += 1
-					except Exception, e:
-						self.debug.show(&quot;movie details are not unique, skipping: %s&quot; % str(e))
-			else:
-				self.debug.show('skipping movie without title or original title')
-		self.widgets['pwindow'].hide()
-		return True
+            if (details.has_key('o_title') and details['o_title']) or (details.has_key('title') and details['title']):
+                if details.has_key('o_title') and details['o_title']:
+                    statement.whereclause = func.lower(self.db.Movie.c.o_title)==details['o_title'].lower()
+                    if details.has_key('title') and details['title']:
+                        statement.append_whereclause( func.lower(self.db.Movie.c.title)==details['title'].lower() )
+                    tmp = statement.execute().fetchone()
+                    if tmp is not None:
+                        self.debug.show(&quot;movie already exists (number=%s, o_title=%s)&quot; % (tmp.number, details['o_title']))
+                        continue
+                elif details.has_key('title') and details['title']:
+                    statement.whereclause = func.lower(self.db.Movie.c.title)==details['title'].lower()
+                    tmp = statement.execute().fetchone()
+                    if tmp is not None:
+                        self.debug.show(&quot;movie already exists (number=%s, title=%s)&quot; % (tmp.number, details['title']))
+                        continue
+                validate_details(details, self.fields_to_import)
+                if self.edit is True:
+                    response = edit_movie(self.parent, details)    # FIXME: wait until save or cancel button pressed
+                    if response == 1:
+                        self.imported += 1
+                else:
+                    if not details.has_key('number') or (details.has_key('number') and details['number'] is None):
+                        #details['number'] = find_next_available(self.db)
+                        details['number'] = number
+                        number += 1
+                    #movie = self.db.Movie()
+                    #movie.add_to_db(details)
+                    try:
+                        self.db.Movie.mapper.mapped_table.insert().execute(details)
+                        self.imported += 1
+                    except Exception, e:
+                        self.debug.show(&quot;movie details are not unique, skipping: %s&quot; % str(e))
+            else:
+                self.debug.show('skipping movie without title or original title')
+        self.widgets['pwindow'].hide()
+        return True
 
-	def clear(self):
-		&quot;&quot;&quot;clear plugin before next source file&quot;&quot;&quot;
-		self.data = None
-		self.imported = 0
-		self.__source_name = None
-		self._abort = False
-	
-	def destroy(self):
-		&quot;&quot;&quot;close all resources&quot;&quot;&quot;
-		pass
+    def clear(self):
+        &quot;&quot;&quot;clear plugin before next source file&quot;&quot;&quot;
+        self.data = None
+        self.imported = 0
+        self.__source_name = None
+        self._abort = False
+    
+    def destroy(self):
+        &quot;&quot;&quot;close all resources&quot;&quot;&quot;
+        pass
 
 
 def on_import_plugin_changed(combobox, widgets, *args):
-	from gtk import FileFilter
-	import plugins.imp
-	plugin_name = widgets['plugin'].get_active_text()
-	__import__(&quot;plugins.imp.%s&quot; % plugin_name)
-	ip = eval(&quot;plugins.imp.%s.ImportPlugin&quot; % plugin_name)
-	widgets['author'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % ip.author)
-	widgets['email'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % ip.email)
-	widgets['version'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; %ip.version)
-	widgets['description'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; %ip.description)
-	# file filters
-	for i in widgets['fcw'].list_filters():
-		widgets['fcw'].remove_filter(i)
-	f = FileFilter()
-	f.set_name(plugin_name)
-	if ip.file_filters is not None:
-		if isinstance(ip.file_filters, tuple) or isinstance(ip.file_filters, list):
-			for i in ip.file_filters:
-				f.add_pattern(i)
-		else:
-			f.add_pattern(ip.file_filters)
-	if ip.mime_types is not None:
-		if isinstance(ip.mime_types, tuple) or isinstance(ip.mime_types, list):
-			for i in ip.mime_types:
-				f.add_mime_type(i)
-		else:
-			f.add_mime_type(ip.mime_types)
-	widgets['fcw'].add_filter(f)
-	f = FileFilter()
-	f.set_name(_(&quot;All files&quot;))
-	f.add_pattern(&quot;*&quot;)
-	widgets['fcw'].add_filter(f)
+    from gtk import FileFilter
+    import plugins.imp
+    plugin_name = widgets['plugin'].get_active_text()
+    __import__(&quot;plugins.imp.%s&quot; % plugin_name)
+    ip = eval(&quot;plugins.imp.%s.ImportPlugin&quot; % plugin_name)
+    widgets['author'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % ip.author)
+    widgets['email'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; % ip.email)
+    widgets['version'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; %ip.version)
+    widgets['description'].set_markup(&quot;&lt;i&gt;%s&lt;/i&gt;&quot; %ip.description)
+    # file filters
+    for i in widgets['fcw'].list_filters():
+        widgets['fcw'].remove_filter(i)
+    f = FileFilter()
+    f.set_name(plugin_name)
+    if ip.file_filters is not None:
+        if isinstance(ip.file_filters, tuple) or isinstance(ip.file_filters, list):
+            for i in ip.file_filters:
+                f.add_pattern(i)
+        else:
+            f.add_pattern(ip.file_filters)
+    if ip.mime_types is not None:
+        if isinstance(ip.mime_types, tuple) or isinstance(ip.mime_types, list):
+            for i in ip.mime_types:
+                f.add_mime_type(i)
+        else:
+            f.add_mime_type(ip.mime_types)
+    widgets['fcw'].add_filter(f)
+    f = FileFilter()
+    f.set_name(_(&quot;All files&quot;))
+    f.add_pattern(&quot;*&quot;)
+    widgets['fcw'].add_filter(f)
 
 def on_import_button_clicked(button, self, *args):
-	import plugins.imp, gutils
-	plugin_name = self.widgets['import']['plugin'].get_active_text()
-	filenames = self.widgets['import']['fcw'].get_filenames()
-	
-	fields = []
-	w = self.widgets['import']['fields']
-	for i in w:
-		if w[i].get_active():
-			fields.append(i)
+    import plugins.imp, gutils
+    plugin_name = self.widgets['import']['plugin'].get_active_text()
+    filenames = self.widgets['import']['fcw'].get_filenames()
+    
+    fields = []
+    w = self.widgets['import']['fields']
+    for i in w:
+        if w[i].get_active():
+            fields.append(i)
 
-	__import__(&quot;plugins.imp.%s&quot; % plugin_name)
-	ip = eval(&quot;plugins.imp.%s.ImportPlugin(self, fields)&quot; % plugin_name)
-	if ip.initialize():
-		self.widgets['window'].set_sensitive(False)
-		self.widgets['import']['window'].hide()
-		self.widgets['import']['pabort'].connect('clicked', ip.abort, ip)
-		for filename in filenames:
-			self.widgets['import']['progressbar'].set_fraction(0)
-			self.widgets['import']['progressbar'].set_text('')
-			if ip.run(filename):
-				gutils.info(self, _(&quot;%s file has been imported. %s movies added.&quot;) \
-					% (plugin_name, ip.imported), self.widgets['window'])
-				self.populate_treeview()
-			ip.clear()
-		ip.destroy()
-		self.widgets['import']['pwindow'].hide()
-		self.widgets['window'].set_sensitive(True)
+    __import__(&quot;plugins.imp.%s&quot; % plugin_name)
+    ip = eval(&quot;plugins.imp.%s.ImportPlugin(self, fields)&quot; % plugin_name)
+    if ip.initialize():
+        self.widgets['window'].set_sensitive(False)
+        self.widgets['import']['window'].hide()
+        self.widgets['import']['pabort'].connect('clicked', ip.abort, ip)
+        for filename in filenames:
+            self.widgets['import']['progressbar'].set_fraction(0)
+            self.widgets['import']['progressbar'].set_text('')
+            if ip.run(filename):
+                gutils.info(self, _(&quot;%s file has been imported. %s movies added.&quot;) \
+                    % (plugin_name, ip.imported), self.widgets['window'])
+                self.populate_treeview()
+            ip.clear()
+        ip.destroy()
+        self.widgets['import']['pwindow'].hide()
+        self.widgets['window'].set_sensitive(True)
 
 def on_abort_button_clicked(button, self, *args):
-	self.widgets['import']['window'].hide()
-	self.widgets['import']['pwindow'].hide()
-	self.widgets['window'].set_sensitive(True)
+    self.widgets['import']['window'].hide()
+    self.widgets['import']['pwindow'].hide()
+    self.widgets['window'].set_sensitive(True)
 

Modified: trunk/lib/plugins/movie/PluginMovie7arte.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovie7arte.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovie7arte.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -35,119 +35,119 @@
 plugin_version = &quot;0.6&quot;
 
 class Plugin(movie.Movie):
-	&quot;&quot;&quot;A movie plugin object&quot;&quot;&quot;
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://7arte.net/cgi-bin/filme.pl?codigo=">http://7arte.net/cgi-bin/filme.pl?codigo=</A>&quot; + str(self.movie_id)
+    &quot;&quot;&quot;A movie plugin object&quot;&quot;&quot;
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://7arte.net/cgi-bin/filme.pl?codigo=">http://7arte.net/cgi-bin/filme.pl?codigo=</A>&quot; + str(self.movie_id)
 
-	def get_image(self):
-		&quot;&quot;&quot;Finds the film's poster image&quot;&quot;&quot;
-		self.image_url = &quot;<A HREF="http://7arte.net/imagens/filmes/">http://7arte.net/imagens/filmes/</A>&quot; + str(self.movie_id) + &quot;.jpg&quot;
+    def get_image(self):
+        &quot;&quot;&quot;Finds the film's poster image&quot;&quot;&quot;
+        self.image_url = &quot;<A HREF="http://7arte.net/imagens/filmes/">http://7arte.net/imagens/filmes/</A>&quot; + str(self.movie_id) + &quot;.jpg&quot;
 
-	def get_o_title(self):
-		&quot;&quot;&quot;Finds the film's original title&quot;&quot;&quot;
-		self.o_title = string.capwords(gutils.trim(self.page, &quot;&lt;/B&gt;&lt;/FONT&gt;&lt;BR&gt;&quot;, &quot;&lt;BR&gt;&quot;))
+    def get_o_title(self):
+        &quot;&quot;&quot;Finds the film's original title&quot;&quot;&quot;
+        self.o_title = string.capwords(gutils.trim(self.page, &quot;&lt;/B&gt;&lt;/FONT&gt;&lt;BR&gt;&quot;, &quot;&lt;BR&gt;&quot;))
 
-	def get_title(self):
-		&quot;&quot;&quot;Finds the film's local title.
-		Probably the original title translation&quot;&quot;&quot;
-		self.title = string.capwords(gutils.trim(self.page, &quot;&lt;FONT SIZE=+1&gt;&lt;B&gt;&quot;, &quot;&lt;/B&gt;&quot;))
+    def get_title(self):
+        &quot;&quot;&quot;Finds the film's local title.
+        Probably the original title translation&quot;&quot;&quot;
+        self.title = string.capwords(gutils.trim(self.page, &quot;&lt;FONT SIZE=+1&gt;&lt;B&gt;&quot;, &quot;&lt;/B&gt;&quot;))
 
-	def get_director(self):
-		&quot;&quot;&quot;Finds the film's director&quot;&quot;&quot;
-		self.director = gutils.trim(self.page, &quot;&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&lt;TABLE&gt;&lt;TR&gt;&quot;)
-		self.director = gutils.strip_tags(self.director)
+    def get_director(self):
+        &quot;&quot;&quot;Finds the film's director&quot;&quot;&quot;
+        self.director = gutils.trim(self.page, &quot;&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&lt;TABLE&gt;&lt;TR&gt;&quot;)
+        self.director = gutils.strip_tags(self.director)
 
-	def get_plot(self):
-		&quot;&quot;&quot;Finds the film's plot&quot;&quot;&quot;
-		self.plot = gutils.trim(self.page, &quot;&lt;B&gt;Sinopse:&lt;/B&gt;&lt;BR&gt;&quot;, &quot;&lt;Font Size=-2&gt;[ www.7arte.net ]&lt;/font&gt;&lt;/FONT&gt;&lt;/P&gt;&quot;)
+    def get_plot(self):
+        &quot;&quot;&quot;Finds the film's plot&quot;&quot;&quot;
+        self.plot = gutils.trim(self.page, &quot;&lt;B&gt;Sinopse:&lt;/B&gt;&lt;BR&gt;&quot;, &quot;&lt;Font Size=-2&gt;[ www.7arte.net ]&lt;/font&gt;&lt;/FONT&gt;&lt;/P&gt;&quot;)
 
-	def get_year(self):
-		&quot;&quot;&quot;Finds the film's year&quot;&quot;&quot;
-		self.year = gutils.trim(self.page, &quot;&lt;B&gt;Ano:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&quot;)
+    def get_year(self):
+        &quot;&quot;&quot;Finds the film's year&quot;&quot;&quot;
+        self.year = gutils.trim(self.page, &quot;&lt;B&gt;Ano:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&quot;)
 
-	def get_runtime(self):
-		&quot;&quot;&quot;Finds the film's running time&quot;&quot;&quot;
-		self.runtime = gutils.trim(self.page, &quot;&lt;B&gt;Dura&quot;, &quot; minutos&quot;)
-		self.runtime = gutils.after(self.runtime, &quot;-1&gt;&quot;)
+    def get_runtime(self):
+        &quot;&quot;&quot;Finds the film's running time&quot;&quot;&quot;
+        self.runtime = gutils.trim(self.page, &quot;&lt;B&gt;Dura&quot;, &quot; minutos&quot;)
+        self.runtime = gutils.after(self.runtime, &quot;-1&gt;&quot;)
 
-	def get_genre(self):
-		&quot;&quot;&quot;Finds the film's genre&quot;&quot;&quot;
-		self.genre = gutils.trim(self.page, &quot;nero:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&lt;BR&gt;&quot;)
+    def get_genre(self):
+        &quot;&quot;&quot;Finds the film's genre&quot;&quot;&quot;
+        self.genre = gutils.trim(self.page, &quot;nero:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&lt;BR&gt;&quot;)
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page, &quot;&lt;B&gt;Actores:&lt;/B&gt;&quot;, &quot;&lt;/FONT&gt;&lt;/TD&gt;&quot;)
-		self.cast = string.replace(self.cast, &quot;&lt;B&gt;&#187;&lt;/B&gt; &quot;, &quot;&quot;)
+    def get_cast(self):
+        self.cast = gutils.trim(self.page, &quot;&lt;B&gt;Actores:&lt;/B&gt;&quot;, &quot;&lt;/FONT&gt;&lt;/TD&gt;&quot;)
+        self.cast = string.replace(self.cast, &quot;&lt;B&gt;&#187;&lt;/B&gt; &quot;, &quot;&quot;)
 
-	def get_classification(self):
-		&quot;&quot;&quot;Find the film's classification&quot;&quot;&quot;
-		self.classification = gutils.trim(self.page, &quot;&lt;B&gt;Idade:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&quot;)
+    def get_classification(self):
+        &quot;&quot;&quot;Find the film's classification&quot;&quot;&quot;
+        self.classification = gutils.trim(self.page, &quot;&lt;B&gt;Idade:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&quot;)
 
-	def get_studio(self):
-		&quot;&quot;&quot;Find the studio&quot;&quot;&quot;
-		self.studio = gutils.trim(self.page, &quot;&lt;B&gt;Distribuidora:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&quot;)
+    def get_studio(self):
+        &quot;&quot;&quot;Find the studio&quot;&quot;&quot;
+        self.studio = gutils.trim(self.page, &quot;&lt;B&gt;Distribuidora:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&quot;)
 
-	def get_o_site(self):
-		&quot;&quot;&quot;Find the film's oficial site&quot;&quot;&quot;
-		self.o_site = gutils.trim(self.page, \
-			&quot;&lt;A HREF='&quot;, \
-			&quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_siteoficial.gif'&quot;)
+    def get_o_site(self):
+        &quot;&quot;&quot;Find the film's oficial site&quot;&quot;&quot;
+        self.o_site = gutils.trim(self.page, \
+            &quot;&lt;A HREF='&quot;, \
+            &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_siteoficial.gif'&quot;)
 
-	def get_site(self):
-		&quot;&quot;&quot;Find the film's imdb details page&quot;&quot;&quot;
-		self.site = gutils.trim(self.page, \
-			&quot;/imagens/bf_siteoficial.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, \
-			&quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_imdb.gif'&quot;)
-		self.site = gutils.after(self.site, &quot;&lt;A HREF='&quot;)
-		self.site = string.replace(self.site, &quot;'&quot;, &quot;&quot;)
+    def get_site(self):
+        &quot;&quot;&quot;Find the film's imdb details page&quot;&quot;&quot;
+        self.site = gutils.trim(self.page, \
+            &quot;/imagens/bf_siteoficial.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, \
+            &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_imdb.gif'&quot;)
+        self.site = gutils.after(self.site, &quot;&lt;A HREF='&quot;)
+        self.site = string.replace(self.site, &quot;'&quot;, &quot;&quot;)
 
-	def get_trailer(self):
-		&quot;&quot;&quot;Find the film's trailer page or location&quot;&quot;&quot;
-		self.trailer = gutils.trim(self.page, \
-			&quot;/imagens/bf_imdb.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, \
-			&quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_trailer.gif'&quot;)
-		self.trailer = gutils.after(self.trailer, &quot;&lt;A HREF='&quot;)
+    def get_trailer(self):
+        &quot;&quot;&quot;Find the film's trailer page or location&quot;&quot;&quot;
+        self.trailer = gutils.trim(self.page, \
+            &quot;/imagens/bf_imdb.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, \
+            &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_trailer.gif'&quot;)
+        self.trailer = gutils.after(self.trailer, &quot;&lt;A HREF='&quot;)
 
-	def get_country(self):
-		&quot;&quot;&quot;Find the film's country&quot;&quot;&quot;
-		self.country = gutils.trim(self.page, &quot;s de Origem:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&lt;BR&gt;&quot;)
+    def get_country(self):
+        &quot;&quot;&quot;Find the film's country&quot;&quot;&quot;
+        self.country = gutils.trim(self.page, &quot;s de Origem:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;, &quot;&lt;/FONT&gt;&lt;BR&gt;&quot;)
 
-	def get_rating(self):
-		&quot;&quot;&quot;Find the film's rating. From 0 to 10.
-		Convert if needed when assigning.&quot;&quot;&quot;
-		tmp_rating = gutils.trim(self.page, &quot;ticas por:&lt;/B&gt;&lt;/Center&gt;&quot;, &quot;c_critica.pl?id=&quot;)
-		if tmp_rating:
-			self.rating = str(float(string.count(tmp_rating, 'estrela.gif'))*2)
+    def get_rating(self):
+        &quot;&quot;&quot;Find the film's rating. From 0 to 10.
+        Convert if needed when assigning.&quot;&quot;&quot;
+        tmp_rating = gutils.trim(self.page, &quot;ticas por:&lt;/B&gt;&lt;/Center&gt;&quot;, &quot;c_critica.pl?id=&quot;)
+        if tmp_rating:
+            self.rating = str(float(string.count(tmp_rating, 'estrela.gif'))*2)
 
 class SearchPlugin(movie.SearchMovie):
-	&quot;&quot;&quot;A movie search object&quot;&quot;&quot;
-	def __init__(self):
-		self.original_url_search = &quot;<A HREF="http://7arte.net/cgi-bin/arq_search_orig.pl?proc=">http://7arte.net/cgi-bin/arq_search_orig.pl?proc=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://7arte.net/cgi-bin/arq_search.pl?proc=">http://7arte.net/cgi-bin/arq_search.pl?proc=</A>&quot;
-		self.encode='iso-8859-1'
+    &quot;&quot;&quot;A movie search object&quot;&quot;&quot;
+    def __init__(self):
+        self.original_url_search = &quot;<A HREF="http://7arte.net/cgi-bin/arq_search_orig.pl?proc=">http://7arte.net/cgi-bin/arq_search_orig.pl?proc=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://7arte.net/cgi-bin/arq_search.pl?proc=">http://7arte.net/cgi-bin/arq_search.pl?proc=</A>&quot;
+        self.encode='iso-8859-1'
 
-	def search(self, parent_window):
-		&quot;&quot;&quot;Perform the web search&quot;&quot;&quot;
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self, parent_window):
+        &quot;&quot;&quot;Perform the web search&quot;&quot;&quot;
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		&quot;&quot;&quot;Isolating just a portion (with the data we want) of the results&quot;&quot;&quot;
-		self.page = gutils.trim(self.page, \
-			&quot;Resultados Encontrados&lt;/I&gt;&lt;/B&gt;&lt;/FONT&gt;&quot;, &quot;&lt;/DIR&gt;&lt;/FONT&gt;&quot;)
+    def sub_search(self):
+        &quot;&quot;&quot;Isolating just a portion (with the data we want) of the results&quot;&quot;&quot;
+        self.page = gutils.trim(self.page, \
+            &quot;Resultados Encontrados&lt;/I&gt;&lt;/B&gt;&lt;/FONT&gt;&quot;, &quot;&lt;/DIR&gt;&lt;/FONT&gt;&quot;)
 
-	def get_searches(self):
-		&quot;&quot;&quot;Try to find both id and film title for each search result&quot;&quot;&quot;
-		elements = string.split(self.page, &quot;&lt;/A&gt;&lt;BR&gt;&quot;)
-		self.number_results = elements[-1]
+    def get_searches(self):
+        &quot;&quot;&quot;Try to find both id and film title for each search result&quot;&quot;&quot;
+        elements = string.split(self.page, &quot;&lt;/A&gt;&lt;BR&gt;&quot;)
+        self.number_results = elements[-1]
 
-		if (len(elements[0])):
-			for element in elements:
-				self.ids.append(gutils.trim(element, &quot;codigo=&quot;, &quot;')&quot;))
-				self.titles.append(gutils.convert_entities \
-					(gutils.trim(element, &quot;')\&quot;&gt;&quot;, &quot; )&quot;)) + &quot; )&quot;)
-		else:
-			self.number_results = 0
+        if (len(elements[0])):
+            for element in elements:
+                self.ids.append(gutils.trim(element, &quot;codigo=&quot;, &quot;')&quot;))
+                self.titles.append(gutils.convert_entities \
+                    (gutils.trim(element, &quot;')\&quot;&gt;&quot;, &quot; )&quot;)) + &quot; )&quot;)
+        else:
+            self.number_results = 0
 

Modified: trunk/lib/plugins/movie/PluginMovieAllocine.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAllocine.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieAllocine.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -35,91 +35,91 @@
 plugin_version = &quot;0.6&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html">http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html">http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html</A>&quot; % str(self.movie_id)
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page,&quot;Poster&quot;,&quot;Date de sor&quot;)
-		self.image_url = gutils.after(self.image_url,&quot;activerlientexte.inc&quot;)
-		self.image_url = gutils.trim(self.image_url,&quot;&lt;img src=\&quot;&quot;,&quot;\&quot;&quot;)
+    def get_image(self):
+        self.image_url = gutils.trim(self.page,&quot;Poster&quot;,&quot;Date de sor&quot;)
+        self.image_url = gutils.after(self.image_url,&quot;activerlientexte.inc&quot;)
+        self.image_url = gutils.trim(self.image_url,&quot;&lt;img src=\&quot;&quot;,&quot;\&quot;&quot;)
 
-	def get_o_title(self):
-		self.o_title = &quot;&quot;
-		self.o_title = gutils.trim(self.page,&quot;Titre original : &lt;i&gt;&quot;,&quot;&lt;/i&gt;&quot;)
-		if (self.o_title==''):
-			self.o_title = gutils.trim(self.page,&quot;&lt;title&gt;&quot;,&quot;&lt;/title&gt;&quot;)
+    def get_o_title(self):
+        self.o_title = &quot;&quot;
+        self.o_title = gutils.trim(self.page,&quot;Titre original : &lt;i&gt;&quot;,&quot;&lt;/i&gt;&quot;)
+        if (self.o_title==''):
+            self.o_title = gutils.trim(self.page,&quot;&lt;title&gt;&quot;,&quot;&lt;/title&gt;&quot;)
 
-	def get_title(self):
-		self.title = gutils.trim(self.page,&quot;&lt;title&gt;&quot;,&quot;&lt;/title&gt;&quot;)
+    def get_title(self):
+        self.title = gutils.trim(self.page,&quot;&lt;title&gt;&quot;,&quot;&lt;/title&gt;&quot;)
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,&quot;&lt;h4&gt;R&#233;alis&#233; par &quot;,&quot;&lt;/a&gt;&lt;/h4&gt;&quot;)
+    def get_director(self):
+        self.director = gutils.trim(self.page,&quot;&lt;h4&gt;R&#233;alis&#233; par &quot;,&quot;&lt;/a&gt;&lt;/h4&gt;&quot;)
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,&quot;Synopsis&lt;/b&gt;&lt;/h3&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;,&quot;&lt;/h4&gt;&quot;)
-		self.plot = gutils.after(self.plot,&quot;&lt;h4&gt;&quot;)
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,&quot;Synopsis&lt;/b&gt;&lt;/h3&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;,&quot;&lt;/h4&gt;&quot;)
+        self.plot = gutils.after(self.plot,&quot;&lt;h4&gt;&quot;)
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,&quot;Ann&#233;e de production : &quot;,&quot;&lt;/h4&gt;&quot;)
+    def get_year(self):
+        self.year = gutils.trim(self.page,&quot;Ann&#233;e de production : &quot;,&quot;&lt;/h4&gt;&quot;)
 
-	def get_runtime(self):
-		self.runtime = &quot;&quot;
-		self.runtime = gutils.trim(self.page,&quot;&lt;h4&gt;Dur&#233;e : &quot;,&quot;min.&lt;/h4&gt;&nbsp;&quot;)
-		if self.runtime:
-			self.runtime = str (int(gutils.before(self.runtime,&quot;h&quot;))*60 + int(gutils.after(self.runtime,&quot;h&quot;)))
+    def get_runtime(self):
+        self.runtime = &quot;&quot;
+        self.runtime = gutils.trim(self.page,&quot;&lt;h4&gt;Dur&#233;e : &quot;,&quot;min.&lt;/h4&gt;&nbsp;&quot;)
+        if self.runtime:
+            self.runtime = str (int(gutils.before(self.runtime,&quot;h&quot;))*60 + int(gutils.after(self.runtime,&quot;h&quot;)))
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,&quot;&lt;h4&gt;Genre : &quot;,&quot;&lt;/h4&gt;&quot;)
-		self.genre = gutils.strip_tags(self.genre)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,&quot;&lt;h4&gt;Genre : &quot;,&quot;&lt;/h4&gt;&quot;)
+        self.genre = gutils.strip_tags(self.genre)
 
-	def get_cast(self):
-		self.cast = &quot;&quot;
-		self.cast = gutils.trim(self.page,&quot;&lt;h4&gt;Avec &quot;,&quot;&lt;/h4&gt;&quot;)
-		self.cast = gutils.strip_tags(self.cast)
-		self.cast = string.replace(self.cast,&quot;, &quot;, &quot;\n&quot;)
+    def get_cast(self):
+        self.cast = &quot;&quot;
+        self.cast = gutils.trim(self.page,&quot;&lt;h4&gt;Avec &quot;,&quot;&lt;/h4&gt;&quot;)
+        self.cast = gutils.strip_tags(self.cast)
+        self.cast = string.replace(self.cast,&quot;, &quot;, &quot;\n&quot;)
 
-	def get_image(self):
-		self.classification = &quot;&quot;
+    def get_image(self):
+        self.classification = &quot;&quot;
 
-	def get_studio(self):
-		self.studio = &quot;&quot;
+    def get_studio(self):
+        self.studio = &quot;&quot;
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html">http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html</A>&quot; % self.movie_id
+    def get_site(self):
+        self.site = &quot;<A HREF="http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html">http://www.allocine.fr/film/fichefilm_gen_cfilm=%s.html</A>&quot; % self.movie_id
 
-	def get_trailer(self):
-		self.trailer = &quot;<A HREF="http://www.allocine.fr/film/video_gen_cfilm=%s.html">http://www.allocine.fr/film/video_gen_cfilm=%s.html</A>&quot; % self.movie_id
+    def get_trailer(self):
+        self.trailer = &quot;<A HREF="http://www.allocine.fr/film/video_gen_cfilm=%s.html">http://www.allocine.fr/film/video_gen_cfilm=%s.html</A>&quot; % self.movie_id
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,&quot;&lt;h4&gt;Film &quot;,&quot;.&lt;/h4&gt;&nbsp;&quot;)
+    def get_country(self):
+        self.country = gutils.trim(self.page,&quot;&lt;h4&gt;Film &quot;,&quot;.&lt;/h4&gt;&nbsp;&quot;)
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, &quot;Spectateurs&lt;/a&gt; &quot;, &quot;&lt;/h4&gt;&quot;)
-		self.rating = gutils.trim(self.rating, &quot;etoile_&quot;, &quot;.gif&quot;)
-		if self.rating:
-			self.rating = str(float(int(self.rating)*2.25))
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, &quot;Spectateurs&lt;/a&gt; &quot;, &quot;&lt;/h4&gt;&quot;)
+        self.rating = gutils.trim(self.rating, &quot;etoile_&quot;, &quot;.gif&quot;)
+        if self.rating:
+            self.rating = str(float(int(self.rating)*2.25))
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search	= &quot;<A HREF="http://www.allocine.fr/recherche/?motcle=">http://www.allocine.fr/recherche/?motcle=</A>&quot;
-		self.translated_url_search	= &quot;<A HREF="http://www.allocine.fr/recherche/?motcle=">http://www.allocine.fr/recherche/?motcle=</A>&quot;
+    def __init__(self):
+        self.original_url_search    = &quot;<A HREF="http://www.allocine.fr/recherche/?motcle=">http://www.allocine.fr/recherche/?motcle=</A>&quot;
+        self.translated_url_search    = &quot;<A HREF="http://www.allocine.fr/recherche/?motcle=">http://www.allocine.fr/recherche/?motcle=</A>&quot;
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page,&quot;Recherche : &lt;b&gt;&quot;, &quot;&lt;h3&gt;&lt;b&gt;Articles &lt;h4&gt;&quot;);
+    def sub_search(self):
+        self.page = gutils.trim(self.page,&quot;Recherche : &lt;b&gt;&quot;, &quot;&lt;h3&gt;&lt;b&gt;Articles &lt;h4&gt;&quot;);
 
-	def get_searches(self):
-		elements = string.split(self.page,&quot;&lt;td colspan=\&quot;2\&quot; height=\&quot;1\&quot; valign=\&quot;top\&quot;&gt;&lt;hr /&gt;&lt;/td&gt;&quot;)
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				self.ids.append(gutils.trim(element,&quot;/film/fichefilm_gen_cfilm=&quot;,&quot;.html&quot;))
-				self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.trim(element,&quot;link1\&quot;&gt;&quot;,&quot;&lt;/a&gt;&quot;))))
+    def get_searches(self):
+        elements = string.split(self.page,&quot;&lt;td colspan=\&quot;2\&quot; height=\&quot;1\&quot; valign=\&quot;top\&quot;&gt;&lt;hr /&gt;&lt;/td&gt;&quot;)
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                self.ids.append(gutils.trim(element,&quot;/film/fichefilm_gen_cfilm=&quot;,&quot;.html&quot;))
+                self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.trim(element,&quot;link1\&quot;&gt;&quot;,&quot;&lt;/a&gt;&quot;))))

Modified: trunk/lib/plugins/movie/PluginMovieAniDB.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAniDB.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieAniDB.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -37,148 +37,148 @@
 aid_pattern = re.compile('[?&amp;;]aid=(\d+)')
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode = 'utf-8'
-		if string.find(id, '<A HREF="http://">http://</A>') != -1:
-			self.url = str(id)
-			self.movie_id = 'anidb'
-		else:
-			self.movie_id = str(id)
-			self.url = &quot;<A HREF="http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s">http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s</A>&quot; % self.movie_id
+    def __init__(self, id):
+        self.encode = 'utf-8'
+        if string.find(id, '<A HREF="http://">http://</A>') != -1:
+            self.url = str(id)
+            self.movie_id = 'anidb'
+        else:
+            self.movie_id = str(id)
+            self.url = &quot;<A HREF="http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s">http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s</A>&quot; % self.movie_id
 
-	def initialize(self):
-		self.page = decompress(self.page)
-		if self.movie_id == 'anidb':
-			aid =  aid_pattern.search(self.page)
-			if aid:
-				self.movie_id = aid.groups()[0]
-				self.url = &quot;<A HREF="http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s">http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s</A>&quot; % self.movie_id
-			else:
-				return False
-		self.page = gutils.after(self.page, 'id=&quot;layout-content&quot;')
-		pos = string.find(self.page, 'class=&quot;g_section anime_episodes&quot;&gt;')
-		if pos &gt;0:
-			self.page = self.page[:pos]
+    def initialize(self):
+        self.page = decompress(self.page)
+        if self.movie_id == 'anidb':
+            aid =  aid_pattern.search(self.page)
+            if aid:
+                self.movie_id = aid.groups()[0]
+                self.url = &quot;<A HREF="http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s">http://anidb.net/perl-bin/animedb.pl?show=anime&amp;aid=%s</A>&quot; % self.movie_id
+            else:
+                return False
+        self.page = gutils.after(self.page, 'id=&quot;layout-content&quot;')
+        pos = string.find(self.page, 'class=&quot;g_section anime_episodes&quot;&gt;')
+        if pos &gt;0:
+            self.page = self.page[:pos]
 
-	def get_image(self):
-		match = re.search('<A HREF="http://img\d*.anidb.net/pics/anime/\d*.jpg">http://img\d*.anidb.net/pics/anime/\d*.jpg</A>', self.page)
-		if match is not None:
-			self.image_url = match.group()
-		else:
-			self.image_url = ''
+    def get_image(self):
+        match = re.search('<A HREF="http://img\d*.anidb.net/pics/anime/\d*.jpg">http://img\d*.anidb.net/pics/anime/\d*.jpg</A>', self.page)
+        if match is not None:
+            self.image_url = match.group()
+        else:
+            self.image_url = ''
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;h1&gt;Anime: ', '&lt;/h1&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;h1&gt;Anime: ', '&lt;/h1&gt;')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&quot;field&quot;&gt;Official Title', '&lt;/td&gt;')
-		self.title = gutils.trim(self.title, '&lt;span&gt;', '&lt;/span&gt;')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&quot;field&quot;&gt;Official Title', '&lt;/td&gt;')
+        self.title = gutils.trim(self.title, '&lt;span&gt;', '&lt;/span&gt;')
 
-	def get_director(self):
-		self.director = ''
+    def get_director(self):
+        self.director = ''
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, 'class=&quot;desc&quot;&gt;', '&lt;/div&gt;')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, 'class=&quot;desc&quot;&gt;', '&lt;/div&gt;')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&quot;field&quot;&gt;Year', '&lt;/td&gt;')
-		self.year = gutils.after(self.year, '&quot;value&quot;&gt;')[-4:]
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&quot;field&quot;&gt;Year', '&lt;/td&gt;')
+        self.year = gutils.after(self.year, '&quot;value&quot;&gt;')[-4:]
 
-	def get_runtime(self):
-		self.runtime = ''
+    def get_runtime(self):
+        self.runtime = ''
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '&gt;Categories&lt;', '&lt;/td&gt;')
-		self.genre = gutils.after(self.genre, 'value&quot;&gt;')
-		self.genre = gutils.strip_tags(self.genre)
-		if len(self.genre) and self.genre.endswith('- similar'):
-			self.genre =  self.genre[:-9]
-		elif self.genre == '-':
-			self.genre = ''
-		self.genre = string.replace(self.genre, '\n', '')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, '&gt;Categories&lt;', '&lt;/td&gt;')
+        self.genre = gutils.after(self.genre, 'value&quot;&gt;')
+        self.genre = gutils.strip_tags(self.genre)
+        if len(self.genre) and self.genre.endswith('- similar'):
+            self.genre =  self.genre[:-9]
+        elif self.genre == '-':
+            self.genre = ''
+        self.genre = string.replace(self.genre, '\n', '')
 
-	def get_cast(self):
-		self.cast = ''
+    def get_cast(self):
+        self.cast = ''
 
-	def get_classification(self):
-		self.classification = ''
+    def get_classification(self):
+        self.classification = ''
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page, '&quot;field&quot;&gt;Producers', '&lt;/td&gt;')
-		self.studio = gutils.strip_tags(self.studio)
-		if len(self.studio) and self.studio[:2] == &quot; (&quot;:
-			self.studio = self.studio[2:]
-			if self.studio[len(self.studio)-1:] == ')':
-				self.studio = self.studio[:len(self.studio)-1]
-		self.studio = string.replace(self.studio, '\n', '')
+    def get_studio(self):
+        self.studio = gutils.trim(self.page, '&quot;field&quot;&gt;Producers', '&lt;/td&gt;')
+        self.studio = gutils.strip_tags(self.studio)
+        if len(self.studio) and self.studio[:2] == &quot; (&quot;:
+            self.studio = self.studio[2:]
+            if self.studio[len(self.studio)-1:] == ')':
+                self.studio = self.studio[:len(self.studio)-1]
+        self.studio = string.replace(self.studio, '\n', '')
 
-	def get_o_site(self):
-		self.o_site = gutils.trim(self.page, '&quot;field&quot;&gt;URL', '&lt;/td&gt;')
-		self.o_site = gutils.trim(self.o_site, 'href=&quot;', '&quot;')
+    def get_o_site(self):
+        self.o_site = gutils.trim(self.page, '&quot;field&quot;&gt;URL', '&lt;/td&gt;')
+        self.o_site = gutils.trim(self.o_site, 'href=&quot;', '&quot;')
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = ''
+    def get_trailer(self):
+        self.trailer = ''
 
-	def get_country(self):
-		self.country = ''
+    def get_country(self):
+        self.country = ''
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '&quot;field&quot;&gt;Rating', '&lt;/td&gt;')
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '&quot;field&quot;&gt;Rating', '&lt;/td&gt;')
 
-	def get_notes(self):
-		self.notes = ''
-		# ...type
-		atype = gutils.trim(self.page, '&quot;field&quot;&gt;Type', '&lt;/td&gt;')
-		atype = gutils.clean(atype)
-		if atype != '':
-			self.notes += &quot;Type: %s\n&quot; % atype
-		# ...number of episodes
-		episodes = gutils.trim(self.page, '&quot;field&quot;&gt;Episodes', '&lt;/td&gt;')
-		episodes = gutils.clean(episodes)
-		if episodes != '':
-			self.notes += &quot;Episodes: %s\n&quot; % episodes
+    def get_notes(self):
+        self.notes = ''
+        # ...type
+        atype = gutils.trim(self.page, '&quot;field&quot;&gt;Type', '&lt;/td&gt;')
+        atype = gutils.clean(atype)
+        if atype != '':
+            self.notes += &quot;Type: %s\n&quot; % atype
+        # ...number of episodes
+        episodes = gutils.trim(self.page, '&quot;field&quot;&gt;Episodes', '&lt;/td&gt;')
+        episodes = gutils.clean(episodes)
+        if episodes != '':
+            self.notes += &quot;Episodes: %s\n&quot; % episodes
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode = 'utf-8'
-		self.original_url_search	= '<A HREF="http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=">http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=</A>'
-		self.translated_url_search	= '<A HREF="http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=">http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=</A>'
+    def __init__(self):
+        self.encode = 'utf-8'
+        self.original_url_search    = '<A HREF="http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=">http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=</A>'
+        self.translated_url_search    = '<A HREF="http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=">http://anidb.net/perl-bin/animedb.pl?show=animelist&amp;do.search=search&amp;adb.search=</A>'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = decompress(self.page)
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = decompress(self.page)
 
-		tmp = string.find(self.page, '&lt;h1&gt;Anime List - Search for: ')
-		if tmp == -1:		# already a movie page
-			self.page = ''
-		else:			# multiple matches
-			self.page = gutils.trim(self.page, 'class=&quot;anime_list&quot;', '&lt;/table&gt;');
-			self.page = gutils.after(self.page, '&lt;/tr&gt;');
+        tmp = string.find(self.page, '&lt;h1&gt;Anime List - Search for: ')
+        if tmp == -1:        # already a movie page
+            self.page = ''
+        else:            # multiple matches
+            self.page = gutils.trim(self.page, 'class=&quot;anime_list&quot;', '&lt;/table&gt;');
+            self.page = gutils.after(self.page, '&lt;/tr&gt;');
 
-		return self.page
+        return self.page
 
-	def get_searches(self):
-		if self.page == '':	# already a movie page
-			self.number_results = 1
-			self.ids.append(self.url)
-			self.titles.append(self.title)
-		else:			# multiple matches
-			elements = string.split(self.page,&quot;&lt;/tr&gt;&quot;)
-			self.number_results = elements[-1]
+    def get_searches(self):
+        if self.page == '':    # already a movie page
+            self.number_results = 1
+            self.ids.append(self.url)
+            self.titles.append(self.title)
+        else:            # multiple matches
+            elements = string.split(self.page,&quot;&lt;/tr&gt;&quot;)
+            self.number_results = elements[-1]
 
-			if len(elements[0]):
-				for element in elements:
-					element = gutils.trim(element, '&lt;td', '&lt;/td&gt;')
-					aid = aid_pattern.search(element)
-					if not aid:
-						continue
-					self.ids.append(aid.groups()[0])
-					element = gutils.after(element, '&quot;&gt;')
-					element = gutils.strip_tags(element)
-					self.titles.append(element)
-			else:
-				self.number_results = 0
+            if len(elements[0]):
+                for element in elements:
+                    element = gutils.trim(element, '&lt;td', '&lt;/td&gt;')
+                    aid = aid_pattern.search(element)
+                    if not aid:
+                        continue
+                    self.ids.append(aid.groups()[0])
+                    element = gutils.after(element, '&quot;&gt;')
+                    element = gutils.strip_tags(element)
+                    self.titles.append(element)
+            else:
+                self.number_results = 0
 

Modified: trunk/lib/plugins/movie/PluginMovieCSFD.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCSFD.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieCSFD.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -33,141 +33,141 @@
 plugin_version = &quot;0.8&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.movie_id = id
-		self.encode = &quot;cp1250&quot;
-		self.url = &quot;<A HREF="http://www.csfd.cz/">http://www.csfd.cz/</A>&quot;+str(id)
+    def __init__(self, id):
+        self.movie_id = id
+        self.encode = &quot;cp1250&quot;
+        self.url = &quot;<A HREF="http://www.csfd.cz/">http://www.csfd.cz/</A>&quot;+str(id)
 
-	def get_image(self):
-		self.image_url = re.search(r&quot;background=\&quot;<A HREF="http://img.csfd.cz/posters/([^\">http://img.csfd.cz/posters/([^\</A>&quot;]*)\&quot;&quot;,self.page)
-		if self.image_url:
-			self.image_url = &quot;<A HREF="http://img.csfd.cz/posters/">http://img.csfd.cz/posters/</A>&quot; + gutils.strip_tags(self.image_url.group(1))
-		else:
-			self.image_url = &quot;&quot;
+    def get_image(self):
+        self.image_url = re.search(r&quot;background=\&quot;<A HREF="http://img.csfd.cz/posters/([^\">http://img.csfd.cz/posters/([^\</A>&quot;]*)\&quot;&quot;,self.page)
+        if self.image_url:
+            self.image_url = &quot;<A HREF="http://img.csfd.cz/posters/">http://img.csfd.cz/posters/</A>&quot; + gutils.strip_tags(self.image_url.group(1))
+        else:
+            self.image_url = &quot;&quot;
 
-	def get_o_title(self):
-		self.o_title = re.findall(r&quot;/images/flag_[\d]+\.gif'[^&gt;]*&gt;&lt;/td&gt;&lt;td&gt;([^&lt;]*)&quot;,self.page)
-		if len(self.o_title)&gt;0:
-			self.o_title = self.o_title[len(self.o_title)-1]
-		else:
-			self.o_title = &quot;&quot;
-		if self.o_title == &quot;&quot;:
-			self.o_title = self.get_title(True)
+    def get_o_title(self):
+        self.o_title = re.findall(r&quot;/images/flag_[\d]+\.gif'[^&gt;]*&gt;&lt;/td&gt;&lt;td&gt;([^&lt;]*)&quot;,self.page)
+        if len(self.o_title)&gt;0:
+            self.o_title = self.o_title[len(self.o_title)-1]
+        else:
+            self.o_title = &quot;&quot;
+        if self.o_title == &quot;&quot;:
+            self.o_title = self.get_title(True)
 
-	def get_title(self, ret=False):
-		data = re.search(r&quot;&lt;title&gt;([^,]*), &quot;,self.page)
-		if data:
-			data = data.group(1)
-		else:
-			data = &quot;&quot;
-		if ret is True:
-			return data
-		else:
-			self.title = data
+    def get_title(self, ret=False):
+        data = re.search(r&quot;&lt;title&gt;([^,]*), &quot;,self.page)
+        if data:
+            data = data.group(1)
+        else:
+            data = &quot;&quot;
+        if ret is True:
+            return data
+        else:
+            self.title = data
 
-	def get_director(self):
-		self.director = re.search(r&quot;Re&#158;ie:(.*)&lt;br&gt;&lt;b&gt;Hraj&#237;:&quot;,self.page)
-		if self.director:
-			self.director = gutils.strip_tags(self.director.group(1))
-		else:
-			self.director = &quot;&quot;
+    def get_director(self):
+        self.director = re.search(r&quot;Re&#158;ie:(.*)&lt;br&gt;&lt;b&gt;Hraj&#237;:&quot;,self.page)
+        if self.director:
+            self.director = gutils.strip_tags(self.director.group(1))
+        else:
+            self.director = &quot;&quot;
 
-	def get_year(self):
-		self.year = re.search(r&quot;&lt;title&gt;.*\(([\d]+)\)&quot;,self.page)
-		if self.year:
-			self.year = self.year.group(1)
-		else:
-			self.year = &quot;&quot;
+    def get_year(self):
+        self.year = re.search(r&quot;&lt;title&gt;.*\(([\d]+)\)&quot;,self.page)
+        if self.year:
+            self.year = self.year.group(1)
+        else:
+            self.year = &quot;&quot;
 
-	def get_runtime(self):
-		self.runtime = re.search(r&quot;([\d]+) min&lt;/b&gt;&lt;BR&gt;&lt;BR&gt;&lt;b&gt;Re&#158;ie:&quot;,self.page)
-		if self.runtime:
-			self.runtime = gutils.strip_tags(self.runtime.group(1))
-		else:
-			self.runtime = &quot;&quot;
+    def get_runtime(self):
+        self.runtime = re.search(r&quot;([\d]+) min&lt;/b&gt;&lt;BR&gt;&lt;BR&gt;&lt;b&gt;Re&#158;ie:&quot;,self.page)
+        if self.runtime:
+            self.runtime = gutils.strip_tags(self.runtime.group(1))
+        else:
+            self.runtime = &quot;&quot;
 
-	def get_genre(self):
-		self.genre = re.search(r&quot;/images/flag_[\d]+.gif.*&lt;/table&gt;[\s]*&lt;br&gt;[\s]*&lt;b&gt;([^&amp;:]*)&nbsp;&lt;br&gt;&quot;,self.page)
-		if self.genre:
-			self.genre = gutils.strip_tags(self.genre.group(1))
-		else:
-			self.genre = &quot;&quot;
+    def get_genre(self):
+        self.genre = re.search(r&quot;/images/flag_[\d]+.gif.*&lt;/table&gt;[\s]*&lt;br&gt;[\s]*&lt;b&gt;([^&amp;:]*)&nbsp;&lt;br&gt;&quot;,self.page)
+        if self.genre:
+            self.genre = gutils.strip_tags(self.genre.group(1))
+        else:
+            self.genre = &quot;&quot;
 
-	def get_country(self):
-		self.country = re.search(r&quot;/images/flag_[\d]+.gif.*&lt;/table&gt;[\s]*&lt;br&gt;[\s]*&lt;b&gt;[^&amp;:]*&nbsp;&lt;br&gt;(.*), [\d]{4}, &quot;,self.page)
-		if self.country:
-			self.country = gutils.strip_tags(self.country.group(1))
-		else:
-			self.country = &quot;&quot;
+    def get_country(self):
+        self.country = re.search(r&quot;/images/flag_[\d]+.gif.*&lt;/table&gt;[\s]*&lt;br&gt;[\s]*&lt;b&gt;[^&amp;:]*&nbsp;&lt;br&gt;(.*), [\d]{4}, &quot;,self.page)
+        if self.country:
+            self.country = gutils.strip_tags(self.country.group(1))
+        else:
+            self.country = &quot;&quot;
 
-	def get_cast(self):
-		self.cast = re.search(r&quot;Hraj&#237;: (.*)&lt;/div&gt;&lt;br&gt;&quot;,self.page)
-		if self.cast:
-			self.cast = gutils.strip_tags(self.cast.group(1))
-		else:
-			self.cast = &quot;&quot;
+    def get_cast(self):
+        self.cast = re.search(r&quot;Hraj&#237;: (.*)&lt;/div&gt;&lt;br&gt;&quot;,self.page)
+        if self.cast:
+            self.cast = gutils.strip_tags(self.cast.group(1))
+        else:
+            self.cast = &quot;&quot;
 
-	def get_plot(self):
-		self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,&quot;Obsah / Info:&quot;,&quot;&lt;/td&gt;&quot;),&quot;(ofici&#225;ln&#237; text distributora)&quot;,&quot;&quot;))
+    def get_plot(self):
+        self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,&quot;Obsah / Info:&quot;,&quot;&lt;/td&gt;&quot;),&quot;(ofici&#225;ln&#237; text distributora)&quot;,&quot;&quot;))
 
-	def get_site(self):
-		self.site = re.search(r&quot;href=[\&quot;'](<A HREF="http://.*imdb\.com/title/[^\">http://.*imdb\.com/title/[^\</A>&quot;']*)&quot;,self.page)
-		if self.site:
-			self.site = gutils.strip_tags(self.site.group(1))
-		else:
-			self.site = &quot;&quot;
+    def get_site(self):
+        self.site = re.search(r&quot;href=[\&quot;'](<A HREF="http://.*imdb\.com/title/[^\">http://.*imdb\.com/title/[^\</A>&quot;']*)&quot;,self.page)
+        if self.site:
+            self.site = gutils.strip_tags(self.site.group(1))
+        else:
+            self.site = &quot;&quot;
 
-	def get_trailer(self):
-		self.trailer = re.search(r&quot;&lt;a href=\&quot;([^\&quot;]*)\&quot;[^&gt;]*&gt;trailer&lt;br&gt;&lt;img src=\&quot;<A HREF="http://img.csfd.cz/images/new/film/ikona_trailer">http://img.csfd.cz/images/new/film/ikona_trailer</A>&quot;,self.page)
-		if self.trailer:
-			self.trailer = &quot;<A HREF="http://www.csfd.cz/">http://www.csfd.cz/</A>&quot;+gutils.strip_tags(self.trailer.group(1))
+    def get_trailer(self):
+        self.trailer = re.search(r&quot;&lt;a href=\&quot;([^\&quot;]*)\&quot;[^&gt;]*&gt;trailer&lt;br&gt;&lt;img src=\&quot;<A HREF="http://img.csfd.cz/images/new/film/ikona_trailer">http://img.csfd.cz/images/new/film/ikona_trailer</A>&quot;,self.page)
+        if self.trailer:
+            self.trailer = &quot;<A HREF="http://www.csfd.cz/">http://www.csfd.cz/</A>&quot;+gutils.strip_tags(self.trailer.group(1))
 
-		else:
-			self.trailer = &quot;&quot;
+        else:
+            self.trailer = &quot;&quot;
 
-	def get_rating(self):
-		self.rating = re.search(r&quot;[\s]*([\d]+)%[\s]*&lt;/td&gt;&quot;,self.page)
-		if self.rating:
-			self.rating = str(float(self.rating.group(1))/10)
-		else:
-			self.rating = &quot;&quot;
+    def get_rating(self):
+        self.rating = re.search(r&quot;[\s]*([\d]+)%[\s]*&lt;/td&gt;&quot;,self.page)
+        if self.rating:
+            self.rating = str(float(self.rating.group(1))/10)
+        else:
+            self.rating = &quot;&quot;
 
-	def get_o_site(self):
-		self.o_site = re.search(r&quot;href=\&quot;([^\&quot;]*)\&quot;[^&gt;]*&gt;www&lt;br&gt;&lt;img src=\&quot;<A HREF="http://img.csfd.cz/images/new/film/ikona_www">http://img.csfd.cz/images/new/film/ikona_www</A>&quot;,self.page)
-		if self.o_site:
-			self.o_site = gutils.strip_tags(self.o_site.group(1))
-		else:
-			self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = re.search(r&quot;href=\&quot;([^\&quot;]*)\&quot;[^&gt;]*&gt;www&lt;br&gt;&lt;img src=\&quot;<A HREF="http://img.csfd.cz/images/new/film/ikona_www">http://img.csfd.cz/images/new/film/ikona_www</A>&quot;,self.page)
+        if self.o_site:
+            self.o_site = gutils.strip_tags(self.o_site.group(1))
+        else:
+            self.o_site = &quot;&quot;
 
-	def get_notes(self):
-		self.notes = &quot;&quot;
+    def get_notes(self):
+        self.notes = &quot;&quot;
 
-	def get_studio(self):
-		self.studio = &quot;&quot;
+    def get_studio(self):
+        self.studio = &quot;&quot;
 
-	def get_classification(self):
-		self.classification = &quot;&quot;
+    def get_classification(self):
+        self.classification = &quot;&quot;
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode = &quot;cp1250&quot;
-		self.original_url_search   = &quot;<A HREF="http://www.csfd.cz/search_pg.php?search=">http://www.csfd.cz/search_pg.php?search=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.csfd.cz/search_pg.php?search=">http://www.csfd.cz/search_pg.php?search=</A>&quot;
+    def __init__(self):
+        self.encode = &quot;cp1250&quot;
+        self.original_url_search   = &quot;<A HREF="http://www.csfd.cz/search_pg.php?search=">http://www.csfd.cz/search_pg.php?search=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.csfd.cz/search_pg.php?search=">http://www.csfd.cz/search_pg.php?search=</A>&quot;
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        return self.page
 
-	def get_searches(self):
-		tmp_id = self.re_items=re.search(r&quot;window.location.href='<A HREF="http://www.csfd.cz/(/film/[^">http://www.csfd.cz/(/film/[^</A>']*)'&quot;,self.page)
-		if tmp_id:
-			self.ids.append(tmp_id.group(1))
-		else:
-			self.re_items=re.findall(r&quot;href=\&quot;(/film/[^\&quot;]+)[^&gt;]*&gt;([^&lt;]+)&lt;/a&gt;([^&lt;]*)&quot;,self.page)
-			self.number_results = len(self.re_items)
-			if (self.number_results &gt; 0):
-				for item in self.re_items:
-					self.ids.append(item[0])
-#					self.titles.append(gutils.convert_entities(item[1])+' '+item[2])
-					self.titles.append(item[1]+' '+item[2])
+    def get_searches(self):
+        tmp_id = self.re_items=re.search(r&quot;window.location.href='<A HREF="http://www.csfd.cz/(/film/[^">http://www.csfd.cz/(/film/[^</A>']*)'&quot;,self.page)
+        if tmp_id:
+            self.ids.append(tmp_id.group(1))
+        else:
+            self.re_items=re.findall(r&quot;href=\&quot;(/film/[^\&quot;]+)[^&gt;]*&gt;([^&lt;]+)&lt;/a&gt;([^&lt;]*)&quot;,self.page)
+            self.number_results = len(self.re_items)
+            if (self.number_results &gt; 0):
+                for item in self.re_items:
+                    self.ids.append(item[0])
+#                    self.titles.append(gutils.convert_entities(item[1])+' '+item[2])
+                    self.titles.append(item[1]+' '+item[2])
 

Modified: trunk/lib/plugins/movie/PluginMovieCineMovies.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCineMovies.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieCineMovies.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -34,89 +34,89 @@
 plugin_version = &quot;0.2&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.cinemovies.fr/fiche_film.php?IDfilm=">http://www.cinemovies.fr/fiche_film.php?IDfilm=</A>&quot; + str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.cinemovies.fr/fiche_film.php?IDfilm=">http://www.cinemovies.fr/fiche_film.php?IDfilm=</A>&quot; + str(self.movie_id)
 
-	def get_image(self):
-		self.image_url = &quot;<A HREF="http://www.cinemovies.fr/images/data/films/Pfilm">http://www.cinemovies.fr/images/data/films/Pfilm</A>&quot;
-		self.image_url = self.image_url + string.strip(gutils.trim(self.page,&quot;data/films/Pfilm&quot;,&quot;.jpg&quot;)) + &quot;.jpg&quot;
+    def get_image(self):
+        self.image_url = &quot;<A HREF="http://www.cinemovies.fr/images/data/films/Pfilm">http://www.cinemovies.fr/images/data/films/Pfilm</A>&quot;
+        self.image_url = self.image_url + string.strip(gutils.trim(self.page,&quot;data/films/Pfilm&quot;,&quot;.jpg&quot;)) + &quot;.jpg&quot;
 
-	def get_o_title(self):
-		self.o_title = string.capwords(gutils.trim(self.page,&quot;Titre original&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/td&gt;&quot;))
+    def get_o_title(self):
+        self.o_title = string.capwords(gutils.trim(self.page,&quot;Titre original&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/td&gt;&quot;))
 
-	def get_title(self):
-		self.title = string.capwords(gutils.trim(self.page,&quot;&lt;TR&gt;&lt;TD class=\&quot;arial12blacknews\&quot;&gt;&quot;,&quot; :&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&quot;))
+    def get_title(self):
+        self.title = string.capwords(gutils.trim(self.page,&quot;&lt;TR&gt;&lt;TD class=\&quot;arial12blacknews\&quot;&gt;&quot;,&quot; :&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&quot;))
 
-	def get_director(self):
-		self.director = string.strip(gutils.trim(self.page,&quot; par:&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/a&gt;&quot;))
+    def get_director(self):
+        self.director = string.strip(gutils.trim(self.page,&quot; par:&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/a&gt;&quot;))
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,&quot;L'histoire&lt;/font&gt;&lt;/td&gt;&quot;,&quot;&lt;/p&gt;&lt;br&gt;&quot;)
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,&quot;L'histoire&lt;/font&gt;&lt;/td&gt;&quot;,&quot;&lt;/p&gt;&lt;br&gt;&quot;)
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,&quot;&lt;B&gt;Ano:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;,&quot;&lt;/FONT&gt;&quot;)
+    def get_year(self):
+        self.year = gutils.trim(self.page,&quot;&lt;B&gt;Ano:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;,&quot;&lt;/FONT&gt;&quot;)
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page,&quot;height=\&quot;12\&quot;&gt;Dur&#195;&#169;e: &quot;,&quot;&lt;/td&gt;&quot;)
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page,&quot;height=\&quot;12\&quot;&gt;Dur&#195;&#169;e: &quot;,&quot;&lt;/td&gt;&quot;)
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,&quot;Genre: &quot;,&quot;&lt;/b&gt;&lt;/a&gt;&quot;)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,&quot;Genre: &quot;,&quot;&lt;/b&gt;&lt;/a&gt;&quot;)
 
-	def get_cast(self):
-		self.cast = &quot;&quot;
-		self.cast = gutils.trim(self.page,&quot;&lt;b&gt;Avec:&lt;/b&gt;&quot;,&quot;&lt;/tr&gt;&quot;)
+    def get_cast(self):
+        self.cast = &quot;&quot;
+        self.cast = gutils.trim(self.page,&quot;&lt;b&gt;Avec:&lt;/b&gt;&quot;,&quot;&lt;/tr&gt;&quot;)
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page,&quot;&lt;B&gt;Idade:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;,&quot;&lt;/FONT&gt;&quot;)
+    def get_classification(self):
+        self.classification = gutils.trim(self.page,&quot;&lt;B&gt;Idade:&lt;/B&gt; &lt;FONT SIze=-1&gt;&quot;,&quot;&lt;/FONT&gt;&quot;)
 
-	def get_studio(self):
-		self.studio = string.strip(gutils.trim(self.page,&quot;&nbsp;Studio/Distributeur&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/td&gt;&quot;))
+    def get_studio(self):
+        self.studio = string.strip(gutils.trim(self.page,&quot;&nbsp;Studio/Distributeur&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/td&gt;&quot;))
 
-	def get_o_site(self):
-		self.o_site = gutils.trim(self.page,&quot;&lt;A HREF='&quot;, &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_siteoficial.gif'&quot;)
+    def get_o_site(self):
+        self.o_site = gutils.trim(self.page,&quot;&lt;A HREF='&quot;, &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_siteoficial.gif'&quot;)
 
-	def get_site(self):
-		self.site = gutils.trim(self.page,&quot;/imagens/bf_siteoficial.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_imdb.gif'&quot;)
-		self.site = gutils.after(self.site,&quot;&lt;A HREF='&quot;)
-		self.site = string.replace(self.site,&quot;'&quot;,&quot;&quot;)
+    def get_site(self):
+        self.site = gutils.trim(self.page,&quot;/imagens/bf_siteoficial.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_imdb.gif'&quot;)
+        self.site = gutils.after(self.site,&quot;&lt;A HREF='&quot;)
+        self.site = string.replace(self.site,&quot;'&quot;,&quot;&quot;)
 
-	def get_trailer(self):
-		self.trailer = gutils.trim(self.page,&quot;/imagens/bf_imdb.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_trailer.gif'&quot;)
-		self.trailer = gutils.after(self.trailer,&quot;&lt;A HREF='&quot;)
+    def get_trailer(self):
+        self.trailer = gutils.trim(self.page,&quot;/imagens/bf_imdb.gif' WIDTH=89 HEIGHT=18 BORDER=0 ALT=''&gt;&quot;, &quot;' TARGET=_blank&gt;&lt;IMG SRC='/imagens/bf_trailer.gif'&quot;)
+        self.trailer = gutils.after(self.trailer,&quot;&lt;A HREF='&quot;)
 
-	def get_country(self):
-		self.country = string.strip(gutils.trim(self.page,&quot;&nbsp;Pays&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/td&gt;&quot;))
+    def get_country(self):
+        self.country = string.strip(gutils.trim(self.page,&quot;&nbsp;Pays&lt;/b&gt;&lt;/td&gt;&quot;,&quot;&lt;/td&gt;&quot;))
 
-	def get_rating(self):
-		tmp_rating = gutils.trim(self.page,&quot;&lt;td width=\&quot;100%\&quot; class=\&quot;arial12blacknews\&quot;&gt;&lt;p align=\&quot;center\&quot;&gt;&lt;font size=\&quot;5\&quot;&gt;&quot;,&quot;/5&lt;/font&gt;&lt;/td&gt;&quot;)
-		if tmp_rating != &quot;&quot;:
-			self.rating = str(float(tmp_rating)*2)
-		else:
-			self.rating = &quot;&quot;
+    def get_rating(self):
+        tmp_rating = gutils.trim(self.page,&quot;&lt;td width=\&quot;100%\&quot; class=\&quot;arial12blacknews\&quot;&gt;&lt;p align=\&quot;center\&quot;&gt;&lt;font size=\&quot;5\&quot;&gt;&quot;,&quot;/5&lt;/font&gt;&lt;/td&gt;&quot;)
+        if tmp_rating != &quot;&quot;:
+            self.rating = str(float(tmp_rating)*2)
+        else:
+            self.rating = &quot;&quot;
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode='iso-8859-1'
-		self.original_url_search	= &quot;<A HREF="http://www.cinemovies.fr/resultat_recherche.php?cherche=">http://www.cinemovies.fr/resultat_recherche.php?cherche=</A>&quot;
-		self.translated_url_search	= &quot;<A HREF="http://www.cinemovies.fr/resultat_recherche.php?cherche=">http://www.cinemovies.fr/resultat_recherche.php?cherche=</A>&quot;
+    def __init__(self):
+        self.encode='iso-8859-1'
+        self.original_url_search    = &quot;<A HREF="http://www.cinemovies.fr/resultat_recherche.php?cherche=">http://www.cinemovies.fr/resultat_recherche.php?cherche=</A>&quot;
+        self.translated_url_search    = &quot;<A HREF="http://www.cinemovies.fr/resultat_recherche.php?cherche=">http://www.cinemovies.fr/resultat_recherche.php?cherche=</A>&quot;
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page,&quot;height=\&quot;6\&quot;&gt;Films&lt;/td&gt;&quot;, &quot;height=\&quot;6\&quot;&gt;News&lt;/td&gt;&quot;)
+    def sub_search(self):
+        self.page = gutils.trim(self.page,&quot;height=\&quot;6\&quot;&gt;Films&lt;/td&gt;&quot;, &quot;height=\&quot;6\&quot;&gt;News&lt;/td&gt;&quot;)
 
-	def get_searches(self):
-		elements = string.split(self.page,&quot;&lt;/tr&gt;  &lt;tr&gt;&quot;)
-		self.number_results = elements[-1]
+    def get_searches(self):
+        elements = string.split(self.page,&quot;&lt;/tr&gt;  &lt;tr&gt;&quot;)
+        self.number_results = elements[-1]
 
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				self.ids.append(gutils.trim(element,&quot;?IDfilm=&quot;,&quot;\&quot; class=\&quot;arial&quot;))
-				self.titles.append(gutils.convert_entities(gutils.strip_tags(gutils.trim(element,&quot;12black3\&quot;&gt;&quot;,&quot;&lt;/font&gt;&lt;br&gt;&quot;))))
-		else:
-			self.number_results = 0
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                self.ids.append(gutils.trim(element,&quot;?IDfilm=&quot;,&quot;\&quot; class=\&quot;arial&quot;))
+                self.titles.append(gutils.convert_entities(gutils.strip_tags(gutils.trim(element,&quot;12black3\&quot;&gt;&quot;,&quot;&lt;/font&gt;&lt;br&gt;&quot;))))
+        else:
+            self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieCinematografo.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCinematografo.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieCinematografo.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -33,121 +33,121 @@
 plugin_version = &quot;1.1&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.cinematografo.it/bancadati/consultazione/schedafilm.jsp?codice=%s">http://www.cinematografo.it/bancadati/consultazione/schedafilm.jsp?codice=%s</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.cinematografo.it/bancadati/consultazione/schedafilm.jsp?codice=%s">http://www.cinematografo.it/bancadati/consultazione/schedafilm.jsp?codice=%s</A>&quot; % str(self.movie_id)
 
-	def get_image(self):
-		&quot;Find the film's poster image&quot;
-		tmp_poster = gutils.trim(self.page, &quot;../images_locandine/%s/&quot;%self.movie_id, &quot;.JPG\&quot;&quot;)
-		if tmp_poster != &quot;&quot;:
-			self.image_url = &quot;<A HREF="http://www.cinematografo.it/bancadati/images_locandine/%s/%s.JPG">http://www.cinematografo.it/bancadati/images_locandine/%s/%s.JPG</A>&quot; % (self.movie_id, tmp_poster)
-		else:
-			self.image_url=&quot;&quot;
+    def get_image(self):
+        &quot;Find the film's poster image&quot;
+        tmp_poster = gutils.trim(self.page, &quot;../images_locandine/%s/&quot;%self.movie_id, &quot;.JPG\&quot;&quot;)
+        if tmp_poster != &quot;&quot;:
+            self.image_url = &quot;<A HREF="http://www.cinematografo.it/bancadati/images_locandine/%s/%s.JPG">http://www.cinematografo.it/bancadati/images_locandine/%s/%s.JPG</A>&quot; % (self.movie_id, tmp_poster)
+        else:
+            self.image_url=&quot;&quot;
 
-	def get_o_title(self):
-		&quot;Find the film's original title&quot;
-		self.o_title = gutils.trim(self.page, &quot;&gt;Titolo Originale&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
-		self.o_title = string.capwords(self.o_title)
+    def get_o_title(self):
+        &quot;Find the film's original title&quot;
+        self.o_title = gutils.trim(self.page, &quot;&gt;Titolo Originale&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
+        self.o_title = string.capwords(self.o_title)
 
-	def get_title(self):
-		&quot;&quot;&quot;Find the film's local title.
-		Probably the original title translation&quot;&quot;&quot;
-		self.title = gutils.trim(self.page, &quot;&lt;!--TITOLO--&gt;&quot;, &quot;&lt;!--FINE TITOLO--&gt;&quot;)
-		self.title = gutils.trim(self.title, &quot;&lt;b&gt;&quot;, &quot;&lt;/b&gt;&quot;)
-		self.title = string.capwords(self.title)
+    def get_title(self):
+        &quot;&quot;&quot;Find the film's local title.
+        Probably the original title translation&quot;&quot;&quot;
+        self.title = gutils.trim(self.page, &quot;&lt;!--TITOLO--&gt;&quot;, &quot;&lt;!--FINE TITOLO--&gt;&quot;)
+        self.title = gutils.trim(self.title, &quot;&lt;b&gt;&quot;, &quot;&lt;/b&gt;&quot;)
+        self.title = string.capwords(self.title)
 
-	def get_director(self):
-		&quot;Find the film's director&quot;
-		self.director = gutils.trim(self.page, &quot;&gt;Regia&quot;, &quot;Attori&lt;&quot;)
-		self.director = self.director.replace(&quot;&nbsp;&nbsp;&quot;, &quot;&nbsp;&quot;)
-		self.director = gutils.strip_tags(self.director)
-		self.director = string.strip(self.director)
+    def get_director(self):
+        &quot;Find the film's director&quot;
+        self.director = gutils.trim(self.page, &quot;&gt;Regia&quot;, &quot;Attori&lt;&quot;)
+        self.director = self.director.replace(&quot;&nbsp;&nbsp;&quot;, &quot;&nbsp;&quot;)
+        self.director = gutils.strip_tags(self.director)
+        self.director = string.strip(self.director)
 
-	def get_plot(self):
-		&quot;Find the film's plot&quot;
-		self.plot = gutils.trim(self.page, &quot;\&quot;fontYellowB\&quot;&gt;Trama&lt;/font&gt;&quot;, &quot;\n&quot;)
+    def get_plot(self):
+        &quot;Find the film's plot&quot;
+        self.plot = gutils.trim(self.page, &quot;\&quot;fontYellowB\&quot;&gt;Trama&lt;/font&gt;&quot;, &quot;\n&quot;)
 
-	def get_year(self):
-		&quot;Find the film's year&quot;
-		self.year = gutils.trim(self.page, &quot;&gt;Anno&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
-		self.year = gutils.after(self.year, &quot;\n                  &quot;)
-		self.year = gutils.before(self.year, &quot;\n&quot;)
+    def get_year(self):
+        &quot;Find the film's year&quot;
+        self.year = gutils.trim(self.page, &quot;&gt;Anno&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
+        self.year = gutils.after(self.year, &quot;\n                  &quot;)
+        self.year = gutils.before(self.year, &quot;\n&quot;)
 
-	def get_runtime(self):
-		&quot;Find the film's running time&quot;
-		self.runtime = gutils.trim(self.page, &quot;&gt;Durata&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
-		self.runtime = gutils.after(self.runtime, &quot;\n                  &quot;)
-		self.runtime = gutils.before(self.runtime, &quot;\n&quot;)
+    def get_runtime(self):
+        &quot;Find the film's running time&quot;
+        self.runtime = gutils.trim(self.page, &quot;&gt;Durata&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
+        self.runtime = gutils.after(self.runtime, &quot;\n                  &quot;)
+        self.runtime = gutils.before(self.runtime, &quot;\n&quot;)
 
-	def get_genre(self):
-		&quot;Find the film's genre&quot;
-		self.genre = gutils.trim(self.page, &quot;&gt;Genere&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;).lower()
+    def get_genre(self):
+        &quot;Find the film's genre&quot;
+        self.genre = gutils.trim(self.page, &quot;&gt;Genere&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;).lower()
 
-	def get_cast(self):
-		&quot;Find the actors. Try to make it comma separated.&quot;
-		self.cast = gutils.trim(self.page, &quot;&gt;Attori&lt;/font&gt;&quot;, &quot;\n&quot;)
-		self.cast = string.replace(self.cast, &quot;target='_self'&gt;&quot;, &quot;\n&gt;&quot;)
-		self.cast = string.replace(self.cast, &quot;&nbsp;&nbsp;&quot;, ' ')
-		self.cast = string.replace(self.cast, &quot;&lt;a&gt;&quot;,_(&quot; as &quot;))
-		self.cast = string.replace(self.cast, &quot;&lt;/tr&gt;&lt;tr&gt;&quot;, '\n')
-		self.cast = string.replace(self.cast, &quot;...vedi il resto del cast&quot;, '')
+    def get_cast(self):
+        &quot;Find the actors. Try to make it comma separated.&quot;
+        self.cast = gutils.trim(self.page, &quot;&gt;Attori&lt;/font&gt;&quot;, &quot;\n&quot;)
+        self.cast = string.replace(self.cast, &quot;target='_self'&gt;&quot;, &quot;\n&gt;&quot;)
+        self.cast = string.replace(self.cast, &quot;&nbsp;&nbsp;&quot;, ' ')
+        self.cast = string.replace(self.cast, &quot;&lt;a&gt;&quot;,_(&quot; as &quot;))
+        self.cast = string.replace(self.cast, &quot;&lt;/tr&gt;&lt;tr&gt;&quot;, '\n')
+        self.cast = string.replace(self.cast, &quot;...vedi il resto del cast&quot;, '')
 
-	def get_classification(self):
-		&quot;Find the film's classification&quot;
-		self.classification = &quot;&quot;
+    def get_classification(self):
+        &quot;Find the film's classification&quot;
+        self.classification = &quot;&quot;
 
-	def get_studio(self):
-		&quot;Find the studio&quot;
-		self.studio = string.capwords(gutils.trim(self.page, &quot;&gt;Distribuzione&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;))
+    def get_studio(self):
+        &quot;Find the studio&quot;
+        self.studio = string.capwords(gutils.trim(self.page, &quot;&gt;Distribuzione&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;))
 
-	def get_o_site(self):
-		&quot;Find the film's oficial site&quot;
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        &quot;Find the film's oficial site&quot;
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		&quot;Find the film's imdb details page&quot;
-		self.site = self.url
+    def get_site(self):
+        &quot;Find the film's imdb details page&quot;
+        self.site = self.url
 
-	def get_trailer(self):
-		&quot;Find the film's trailer page or location&quot;
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        &quot;Find the film's trailer page or location&quot;
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		&quot;Find the film's country&quot;
-		self.country = gutils.trim(self.page, &quot;&gt;Origine&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
+    def get_country(self):
+        &quot;Find the film's country&quot;
+        self.country = gutils.trim(self.page, &quot;&gt;Origine&lt;/font&gt;&quot;, &quot;&lt;/tr&gt;&quot;)
 
-	def get_rating(self):
-		&quot;&quot;&quot;Find the film's rating. From 0 to 10.
-		Convert if needed when assigning.&quot;&quot;&quot;
-		self.rating = 0
+    def get_rating(self):
+        &quot;&quot;&quot;Find the film's rating. From 0 to 10.
+        Convert if needed when assigning.&quot;&quot;&quot;
+        self.rating = 0
 
 class SearchPlugin(movie.SearchMovie):
-	&quot;A movie search object&quot;
-	def __init__(self):
-		self.encode='iso-8859-1'
-		self.original_url_search = &quot;<A HREF="http://www.cinematografo.it/bancadati/consultazione/trovatitoli.jsp?tipo=CONTIENEPAROLE&amp;word=">http://www.cinematografo.it/bancadati/consultazione/trovatitoli.jsp?tipo=CONTIENEPAROLE&amp;word=</A>&quot;
-		self.translated_url_search = self.original_url_search
+    &quot;A movie search object&quot;
+    def __init__(self):
+        self.encode='iso-8859-1'
+        self.original_url_search = &quot;<A HREF="http://www.cinematografo.it/bancadati/consultazione/trovatitoli.jsp?tipo=CONTIENEPAROLE&amp;word=">http://www.cinematografo.it/bancadati/consultazione/trovatitoli.jsp?tipo=CONTIENEPAROLE&amp;word=</A>&quot;
+        self.translated_url_search = self.original_url_search
 
-	def search(self, parent_window):
-		&quot;Perform the web search&quot;
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self, parent_window):
+        &quot;Perform the web search&quot;
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		&quot;Isolating just a portion (with the data we want) of the results&quot;
-		self.page = gutils.trim(self.page, &quot;&lt;td valign=\&quot;top\&quot; width=\&quot;73%\&quot; bgcolor=\&quot;#4d4d4d\&quot;&gt;&quot;, &quot;&lt;/td&gt;&quot;)
+    def sub_search(self):
+        &quot;Isolating just a portion (with the data we want) of the results&quot;
+        self.page = gutils.trim(self.page, &quot;&lt;td valign=\&quot;top\&quot; width=\&quot;73%\&quot; bgcolor=\&quot;#4d4d4d\&quot;&gt;&quot;, &quot;&lt;/td&gt;&quot;)
 
-	def get_searches(self):
-		&quot;Try to find both id and film title for each search result&quot;
-		elements = string.split(self.page, &quot;&lt;li&gt;&quot;)
-		self.number_results = elements[-1]
+    def get_searches(self):
+        &quot;Try to find both id and film title for each search result&quot;
+        elements = string.split(self.page, &quot;&lt;li&gt;&quot;)
+        self.number_results = elements[-1]
 
-		if (elements[0] != ''):
-			for element in elements:
-				self.ids.append(gutils.trim(element, &quot;?codice=&quot;, &quot;\&quot;&gt;&quot;))
-				self.titles.append(gutils.convert_entities(gutils.trim(element, &quot;&lt;b&gt;&quot;, &quot;&lt;/b&gt;&quot;)))
-		else:
-			self.number_results = 0
+        if (elements[0] != ''):
+            for element in elements:
+                self.ids.append(gutils.trim(element, &quot;?codice=&quot;, &quot;\&quot;&gt;&quot;))
+                self.titles.append(gutils.convert_entities(gutils.trim(element, &quot;&lt;b&gt;&quot;, &quot;&lt;/b&gt;&quot;)))
+        else:
+            self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieCineteka.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCineteka.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieCineteka.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -35,118 +35,118 @@
 plugin_version = &quot;0.3&quot;
 
 class Plugin(movie.Movie):
-	&quot;&quot;&quot;A movie plugin object&quot;&quot;&quot;
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.cineteka.com/index.php?op=Movie&amp;id=">http://www.cineteka.com/index.php?op=Movie&amp;id=</A>&quot; + str(self.movie_id)
+    &quot;&quot;&quot;A movie plugin object&quot;&quot;&quot;
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.cineteka.com/index.php?op=Movie&amp;id=">http://www.cineteka.com/index.php?op=Movie&amp;id=</A>&quot; + str(self.movie_id)
 
-	def get_image(self):
-		&quot;&quot;&quot;Finds the film's poster image&quot;&quot;&quot;
-		self.image_url = &quot;<A HREF="http://www.cineteka.com/img/filmes/">http://www.cineteka.com/img/filmes/</A>&quot; + str(self.movie_id) + &quot;_big.jpg&quot;
+    def get_image(self):
+        &quot;&quot;&quot;Finds the film's poster image&quot;&quot;&quot;
+        self.image_url = &quot;<A HREF="http://www.cineteka.com/img/filmes/">http://www.cineteka.com/img/filmes/</A>&quot; + str(self.movie_id) + &quot;_big.jpg&quot;
 
-	def get_o_title(self):
-		&quot;&quot;&quot;Finds the film's original title&quot;&quot;&quot;
-		self.o_title = string.capwords(gutils.trim(self.page, &quot;&quot;&quot;&lt;nobr&gt;&lt;span class=&quot;txt11&quot;&gt;(&quot;&quot;&quot;, &quot;)&quot;))
+    def get_o_title(self):
+        &quot;&quot;&quot;Finds the film's original title&quot;&quot;&quot;
+        self.o_title = string.capwords(gutils.trim(self.page, &quot;&quot;&quot;&lt;nobr&gt;&lt;span class=&quot;txt11&quot;&gt;(&quot;&quot;&quot;, &quot;)&quot;))
 
-	def get_title(self):
-		&quot;&quot;&quot;Finds the film's local title.
-		Probably the original title translation&quot;&quot;&quot;
-		self.title = string.capwords(gutils.trim(self.page, &quot;&quot;&quot;&lt;td class=&quot;txt12&quot;&gt;&lt;b&gt;&quot;&quot;&quot;, &quot;&lt;/b&gt;&quot;))
+    def get_title(self):
+        &quot;&quot;&quot;Finds the film's local title.
+        Probably the original title translation&quot;&quot;&quot;
+        self.title = string.capwords(gutils.trim(self.page, &quot;&quot;&quot;&lt;td class=&quot;txt12&quot;&gt;&lt;b&gt;&quot;&quot;&quot;, &quot;&lt;/b&gt;&quot;))
 
-	def get_director(self):
-		&quot;&quot;&quot;Finds the film's director&quot;&quot;&quot;
-		self.director = gutils.strip_tags(gutils.trim(self.page, &quot;&lt;div&gt;&lt;b&gt;Realiza&#231;&#227;o:&lt;/b&gt;&lt;br&gt;&quot;, &quot;&lt;/div&gt;&quot;))
-		self.director = string.replace(self.director,&quot;&lt;br&gt;&quot;, &quot;, &quot;)
-		self.director = gutils.strip_tags(self.director)
+    def get_director(self):
+        &quot;&quot;&quot;Finds the film's director&quot;&quot;&quot;
+        self.director = gutils.strip_tags(gutils.trim(self.page, &quot;&lt;div&gt;&lt;b&gt;Realiza&#231;&#227;o:&lt;/b&gt;&lt;br&gt;&quot;, &quot;&lt;/div&gt;&quot;))
+        self.director = string.replace(self.director,&quot;&lt;br&gt;&quot;, &quot;, &quot;)
+        self.director = gutils.strip_tags(self.director)
 
-	def get_plot(self):
-		&quot;&quot;&quot;Finds the film's plot&quot;&quot;&quot;
-		self.plot = gutils.trim(self.page, &quot;&quot;&quot;&lt;div class=&quot;txt-normal&quot; style=&quot;margin-top: 10px;&quot;&gt;&quot;&quot;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;)
+    def get_plot(self):
+        &quot;&quot;&quot;Finds the film's plot&quot;&quot;&quot;
+        self.plot = gutils.trim(self.page, &quot;&quot;&quot;&lt;div class=&quot;txt-normal&quot; style=&quot;margin-top: 10px;&quot;&gt;&quot;&quot;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;)
 
-	def get_year(self):
-		&quot;&quot;&quot;Finds the film's year&quot;&quot;&quot;
-		self.year = gutils.trim(self.page, &quot;&lt;b&gt;Ano:&lt;/b&gt; &quot;, &quot;&lt;/div&gt;&quot;)
+    def get_year(self):
+        &quot;&quot;&quot;Finds the film's year&quot;&quot;&quot;
+        self.year = gutils.trim(self.page, &quot;&lt;b&gt;Ano:&lt;/b&gt; &quot;, &quot;&lt;/div&gt;&quot;)
 
-	def get_runtime(self):
-		&quot;&quot;&quot;Finds the film's running time&quot;&quot;&quot;
-		self.runtime = gutils.trim(self.page, &quot;&lt;td&gt;&lt;b&gt;Dura&#231;&#227;o:&lt;/b&gt; &quot;, &quot; min.&lt;/td&gt;&quot;)
+    def get_runtime(self):
+        &quot;&quot;&quot;Finds the film's running time&quot;&quot;&quot;
+        self.runtime = gutils.trim(self.page, &quot;&lt;td&gt;&lt;b&gt;Dura&#231;&#227;o:&lt;/b&gt; &quot;, &quot; min.&lt;/td&gt;&quot;)
 
-	def get_genre(self):
-		&quot;&quot;&quot;Finds the film's genre&quot;&quot;&quot;
-		self.genre = gutils.strip_tags(gutils.trim(self.page, &quot;&lt;b&gt;G&#233;nero:&lt;/b&gt;&lt;br&gt;&quot;, &quot;&lt;/div&gt;&quot;))
-		self.genre = string.replace(self.genre,&quot;&lt;br&gt;&quot;, &quot;, &quot;)
-		self.genre = gutils.strip_tags(self.genre)
+    def get_genre(self):
+        &quot;&quot;&quot;Finds the film's genre&quot;&quot;&quot;
+        self.genre = gutils.strip_tags(gutils.trim(self.page, &quot;&lt;b&gt;G&#233;nero:&lt;/b&gt;&lt;br&gt;&quot;, &quot;&lt;/div&gt;&quot;))
+        self.genre = string.replace(self.genre,&quot;&lt;br&gt;&quot;, &quot;, &quot;)
+        self.genre = gutils.strip_tags(self.genre)
 
-	def get_cast(self):
-		self.cast = gutils.strip_tags(gutils.trim(self.page, &quot;&lt;b&gt;Elenco:&lt;/b&gt; &quot;, &quot;&lt;/td&gt;&quot;))
-		self.cast = string.replace(self.cast, &quot;, &quot;, &quot;&quot;)
-		self.cast = string.replace(self.cast, &quot;\t&quot;, &quot;&quot;)
-		self.cast = string.replace(self.cast, &quot;\n &quot;, &quot;\n&quot;)
+    def get_cast(self):
+        self.cast = gutils.strip_tags(gutils.trim(self.page, &quot;&lt;b&gt;Elenco:&lt;/b&gt; &quot;, &quot;&lt;/td&gt;&quot;))
+        self.cast = string.replace(self.cast, &quot;, &quot;, &quot;&quot;)
+        self.cast = string.replace(self.cast, &quot;\t&quot;, &quot;&quot;)
+        self.cast = string.replace(self.cast, &quot;\n &quot;, &quot;\n&quot;)
 
-	def get_classification(self):
-		&quot;&quot;&quot;Find the film's classification&quot;&quot;&quot;
-		self.classification = gutils.trim(self.page, &quot;&lt;b&gt;Idade:&lt;/b&gt; &quot;, &quot;&lt;/div&gt;&quot;)
+    def get_classification(self):
+        &quot;&quot;&quot;Find the film's classification&quot;&quot;&quot;
+        self.classification = gutils.trim(self.page, &quot;&lt;b&gt;Idade:&lt;/b&gt; &quot;, &quot;&lt;/div&gt;&quot;)
 
-	def get_studio(self):
-		&quot;&quot;&quot;Find the studio&quot;&quot;&quot;
-		self.studio = &quot;&quot;
+    def get_studio(self):
+        &quot;&quot;&quot;Find the studio&quot;&quot;&quot;
+        self.studio = &quot;&quot;
 
-	def get_o_site(self):
-		&quot;&quot;&quot;Find the film's oficial site&quot;&quot;&quot;
-		self.o_site = gutils.trim(self.page, \
-			&quot;&lt;a class=\&quot;button\&quot; href=\&quot;&quot;, \
-			&quot; title=\&quot;Consultar t&#237;tulo no Internet Movie Data Base\&quot;&quot;)
+    def get_o_site(self):
+        &quot;&quot;&quot;Find the film's oficial site&quot;&quot;&quot;
+        self.o_site = gutils.trim(self.page, \
+            &quot;&lt;a class=\&quot;button\&quot; href=\&quot;&quot;, \
+            &quot; title=\&quot;Consultar t&#237;tulo no Internet Movie Data Base\&quot;&quot;)
 
-	def get_site(self):
-		&quot;&quot;&quot;Find the film's imdb details page&quot;&quot;&quot;
-		self.site = gutils.trim(self.page, \
-			&quot;&lt;/td&gt;&lt;td&gt;&lt;a class=\&quot;button\&quot; href=\&quot;&quot;, \
-			&quot;&quot;&quot;&quot; title=&quot;Consultar t&#195;&#173;tulo&quot;&quot;&quot;)
+    def get_site(self):
+        &quot;&quot;&quot;Find the film's imdb details page&quot;&quot;&quot;
+        self.site = gutils.trim(self.page, \
+            &quot;&lt;/td&gt;&lt;td&gt;&lt;a class=\&quot;button\&quot; href=\&quot;&quot;, \
+            &quot;&quot;&quot;&quot; title=&quot;Consultar t&#195;&#173;tulo&quot;&quot;&quot;)
 
-	def get_trailer(self):
-		&quot;&quot;&quot;Find the film's trailer page or location&quot;&quot;&quot;
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        &quot;&quot;&quot;Find the film's trailer page or location&quot;&quot;&quot;
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		&quot;&quot;&quot;Find the film's country&quot;&quot;&quot;
-		self.country = gutils.trim(self.page, &quot;&lt;b&gt;Pa&#237;s:&lt;/b&gt;&lt;br&gt;&quot;, &quot;&lt;/div&gt;&quot;)
-		self.country = string.replace(self.country,&quot;&lt;br&gt;&quot;, &quot;, &quot;)
-		self.country = gutils.strip_tags(self.country)
+    def get_country(self):
+        &quot;&quot;&quot;Find the film's country&quot;&quot;&quot;
+        self.country = gutils.trim(self.page, &quot;&lt;b&gt;Pa&#237;s:&lt;/b&gt;&lt;br&gt;&quot;, &quot;&lt;/div&gt;&quot;)
+        self.country = string.replace(self.country,&quot;&lt;br&gt;&quot;, &quot;, &quot;)
+        self.country = gutils.strip_tags(self.country)
 
-	def get_rating(self):
-		&quot;&quot;&quot;Find the film's rating. From 0 to 10.
-		Convert if needed when assigning.&quot;&quot;&quot;
-		self.rating = 0
+    def get_rating(self):
+        &quot;&quot;&quot;Find the film's rating. From 0 to 10.
+        Convert if needed when assigning.&quot;&quot;&quot;
+        self.rating = 0
 
 class SearchPlugin(movie.SearchMovie):
-	&quot;&quot;&quot;A movie search object&quot;&quot;&quot;
-	def __init__(self):
-		self.original_url_search = &quot;<A HREF="http://www.cineteka.com/index.php?op=MovieSearch&amp;s=">http://www.cineteka.com/index.php?op=MovieSearch&amp;s=</A>&quot;
-		self.translated_url_search = self.original_url_search
-		self.encode='iso-8859-1'
+    &quot;&quot;&quot;A movie search object&quot;&quot;&quot;
+    def __init__(self):
+        self.original_url_search = &quot;<A HREF="http://www.cineteka.com/index.php?op=MovieSearch&amp;s=">http://www.cineteka.com/index.php?op=MovieSearch&amp;s=</A>&quot;
+        self.translated_url_search = self.original_url_search
+        self.encode='iso-8859-1'
 
-	def search(self, parent_window):
-		&quot;&quot;&quot;Perform the web search&quot;&quot;&quot;
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self, parent_window):
+        &quot;&quot;&quot;Perform the web search&quot;&quot;&quot;
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		&quot;&quot;&quot;Isolating just a portion (with the data we want) of the results&quot;&quot;&quot;
-		self.page = gutils.trim(self.page, \
-			&quot;&quot;&quot;o:&lt;/div&gt;&quot;&quot;&quot;, &quot;&quot;&quot;&lt;div style=&quot;margin-top: 10px; text-align: center;&quot;&gt;&lt;/div&gt;&quot;&quot;&quot;)
+    def sub_search(self):
+        &quot;&quot;&quot;Isolating just a portion (with the data we want) of the results&quot;&quot;&quot;
+        self.page = gutils.trim(self.page, \
+            &quot;&quot;&quot;o:&lt;/div&gt;&quot;&quot;&quot;, &quot;&quot;&quot;&lt;div style=&quot;margin-top: 10px; text-align: center;&quot;&gt;&lt;/div&gt;&quot;&quot;&quot;)
 
-	def get_searches(self):
-		&quot;&quot;&quot;Try to find both id and film title for each search result&quot;&quot;&quot;
-		elements = string.split(self.page, &quot;&lt;/a&gt;]&lt;/td&gt;&quot;)
-		self.number_results = elements[-1]
+    def get_searches(self):
+        &quot;&quot;&quot;Try to find both id and film title for each search result&quot;&quot;&quot;
+        elements = string.split(self.page, &quot;&lt;/a&gt;]&lt;/td&gt;&quot;)
+        self.number_results = elements[-1]
 
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				self.ids.append(gutils.trim(element, &quot;?op=Movie&amp;id=&quot;, &quot;\&quot;&quot;))
-				self.titles.append(gutils.strip_tags(gutils.convert_entities \
-					(gutils.trim(element, &quot;&quot;&quot;&lt;td class=&quot;txt12&quot;&gt;&lt;b&gt;&quot;&quot;&quot;, &quot;&lt;/span&gt;&lt;/nobr&gt;&lt;/td&gt;&quot;))))
-		else:
-			self.number_results = 0
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                self.ids.append(gutils.trim(element, &quot;?op=Movie&amp;id=&quot;, &quot;\&quot;&quot;))
+                self.titles.append(gutils.strip_tags(gutils.convert_entities \
+                    (gutils.trim(element, &quot;&quot;&quot;&lt;td class=&quot;txt12&quot;&gt;&lt;b&gt;&quot;&quot;&quot;, &quot;&lt;/span&gt;&lt;/nobr&gt;&lt;/td&gt;&quot;))))
+        else:
+            self.number_results = 0
 

Modified: trunk/lib/plugins/movie/PluginMovieCulturalia.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCulturalia.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieCulturalia.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -26,106 +26,106 @@
 import movie
 import string
 
-plugin_name		= 'Culturalia'
-plugin_description	= 'Base de Datos de Peliculas'
-plugin_url		= 'www.culturalianet.com'
-plugin_language		= _('Spanish')
-plugin_author		= 'Pedro D. S&#225;nchez'
-plugin_author_email	= '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
-plugin_version		= '0.2'
+plugin_name        = 'Culturalia'
+plugin_description    = 'Base de Datos de Peliculas'
+plugin_url        = 'www.culturalianet.com'
+plugin_language        = _('Spanish')
+plugin_author        = 'Pedro D. S&#225;nchez'
+plugin_author_email    = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
+plugin_version        = '0.2'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-15'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.culturalianet.com/art/ver.php?art=%s">http://www.culturalianet.com/art/ver.php?art=%s</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-15'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.culturalianet.com/art/ver.php?art=%s">http://www.culturalianet.com/art/ver.php?art=%s</A>&quot; % str(self.movie_id)
 
-	def get_image(self):
-		tmp = string.find(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;)
-		if tmp == -1:
-			self.image_url = ''
-		else:
-			self.image_url = '<A HREF="http://www.culturalianet.com/art/">http://www.culturalianet.com/art/</A>'+gutils.trim(self.page[tmp:], '&lt;img src = &quot;', '&quot;')
+    def get_image(self):
+        tmp = string.find(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;)
+        if tmp == -1:
+            self.image_url = ''
+        else:
+            self.image_url = '<A HREF="http://www.culturalianet.com/art/">http://www.culturalianet.com/art/</A>'+gutils.trim(self.page[tmp:], '&lt;img src = &quot;', '&quot;')
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;, '&lt;/i&gt;')
-		self.o_title = gutils.after(self.o_title, '&lt;i&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;, '&lt;/i&gt;')
+        self.o_title = gutils.after(self.o_title, '&lt;i&gt;')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;, '. (')
+    def get_title(self):
+        self.title = gutils.trim(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;, '. (')
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,&quot;&lt;font class = 'titulo3'&gt;Director:&quot;, '&lt;br&gt;&lt;br&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page,&quot;&lt;font class = 'titulo3'&gt;Director:&quot;, '&lt;br&gt;&lt;br&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '&lt;b&gt;Sinopsis:&lt;/b&gt;&lt;br&gt;', '&lt;br&gt;&lt;br&gt;')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '&lt;b&gt;Sinopsis:&lt;/b&gt;&lt;br&gt;', '&lt;br&gt;&lt;br&gt;')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;, ')&lt;/font&gt;')
-		self.year = gutils.after(self.year, '. (')
+    def get_year(self):
+        self.year = gutils.trim(self.page, &quot;&lt;font class = 'titulo2'&gt;&quot;, ')&lt;/font&gt;')
+        self.year = gutils.after(self.year, '. (')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Duraci&#243;n:&lt;/font&gt; &quot;, ' minutos')
-		if self.runtime == '':
-			self.runtime = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Duraci&oacute;n:&lt;/font&gt; &quot;, ' minutos')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Duraci&#243;n:&lt;/font&gt; &quot;, ' minutos')
+        if self.runtime == '':
+            self.runtime = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Duraci&oacute;n:&lt;/font&gt; &quot;, ' minutos')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;G&#233;nero:&lt;/font&gt;&lt;br&gt;&quot;, '&lt;br&gt;&lt;br&gt;')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;G&#233;nero:&lt;/font&gt;&lt;br&gt;&quot;, '&lt;br&gt;&lt;br&gt;')
 
-	def get_cast(self):
-		self.cast = ''
-		self.cast = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Actores:&lt;/font&gt;&lt;br&gt;&quot;, '&lt;br&gt;&lt;br&gt;')
-		self.cast = string.replace(self.cast, '&lt;br&gt;', &quot;\n&quot;)
-		self.cast = string.strip(gutils.strip_tags(self.cast))
+    def get_cast(self):
+        self.cast = ''
+        self.cast = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Actores:&lt;/font&gt;&lt;br&gt;&quot;, '&lt;br&gt;&lt;br&gt;')
+        self.cast = string.replace(self.cast, '&lt;br&gt;', &quot;\n&quot;)
+        self.cast = string.strip(gutils.strip_tags(self.cast))
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Calificaci&#243;n moral:&lt;/font&gt; &quot;, '&lt;br&gt;')
-		if self.classification == '':
-			self.classification = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Calificaci&oacute;n moral:&lt;/font&gt; &quot;, '&lt;br&gt;')
+    def get_classification(self):
+        self.classification = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Calificaci&#243;n moral:&lt;/font&gt; &quot;, '&lt;br&gt;')
+        if self.classification == '':
+            self.classification = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Calificaci&oacute;n moral:&lt;/font&gt; &quot;, '&lt;br&gt;')
 
-	def get_studio(self):
-		self.studio = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://www.culturalianet.com/art/ver.php?art=%s">http://www.culturalianet.com/art/ver.php?art=%s</A>&quot; % str(self.movie_id)
+    def get_site(self):
+        self.site = &quot;<A HREF="http://www.culturalianet.com/art/ver.php?art=%s">http://www.culturalianet.com/art/ver.php?art=%s</A>&quot; % str(self.movie_id)
 
-	def get_trailer(self):
-		self.trailer = ''
+    def get_trailer(self):
+        self.trailer = ''
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Nacionalidad:&lt;/font&gt;&lt;br&gt;&quot;, '&lt;br&gt;')
+    def get_country(self):
+        self.country = gutils.trim(self.page, &quot;&lt;font class = 'titulo3'&gt;Nacionalidad:&lt;/font&gt;&lt;br&gt;&quot;, '&lt;br&gt;')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, &quot;Puntuaci&#243;n: &lt;font class = 'titulo3'&gt;&quot;, '&lt;/font&gt;')
-		if self.rating == '':
-			self.rating = gutils.trim(self.page, &quot;Puntuaci&oacute;n: &lt;font class = 'titulo3'&gt;&quot;, '&lt;/font&gt;')
-		if self.rating:
-			self.rating = str(float(gutils.clean(self.rating)))
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, &quot;Puntuaci&#243;n: &lt;font class = 'titulo3'&gt;&quot;, '&lt;/font&gt;')
+        if self.rating == '':
+            self.rating = gutils.trim(self.page, &quot;Puntuaci&oacute;n: &lt;font class = 'titulo3'&gt;&quot;, '&lt;/font&gt;')
+        if self.rating:
+            self.rating = str(float(gutils.clean(self.rating)))
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search	= '<A HREF="http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=">http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=</A>'
-		self.translated_url_search	= '<A HREF="http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=">http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=</A>'
-		self.encode = 'iso-8859-15'
+    def __init__(self):
+        self.original_url_search    = '<A HREF="http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=">http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=</A>'
+        self.translated_url_search    = '<A HREF="http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=">http://www.culturalianet.com/bus/resu.php?donde=1&amp;texto=</A>'
+        self.encode = 'iso-8859-15'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page, '&lt;b&gt;ARTICULOS ENCONTRADOS:&lt;/b&gt;', '&lt;/table&gt;')
-		self.page = gutils.after(self.page, '&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;b&gt;')
-		#self.page = self.page.decode('iso-8859-15')
+    def sub_search(self):
+        self.page = gutils.trim(self.page, '&lt;b&gt;ARTICULOS ENCONTRADOS:&lt;/b&gt;', '&lt;/table&gt;')
+        self.page = gutils.after(self.page, '&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;b&gt;')
+        #self.page = self.page.decode('iso-8859-15')
 
-	def get_searches(self):
-		elements = string.split(self.page, '&lt;td&gt;&lt;b&gt;')
+    def get_searches(self):
+        elements = string.split(self.page, '&lt;td&gt;&lt;b&gt;')
 
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				self.ids.append(gutils.trim(element, 'ver.php?art=',&quot;'&quot;))
-				self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.trim(element, &quot;target='_top'&gt;&quot;, '&lt;/a&gt;'))))
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                self.ids.append(gutils.trim(element, 'ver.php?art=',&quot;'&quot;))
+                self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.trim(element, &quot;target='_top'&gt;&quot;, '&lt;/a&gt;'))))

Modified: trunk/lib/plugins/movie/PluginMovieDVDEmpire.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -35,145 +35,145 @@
 plugin_version = &quot;1.1&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.dvdempire.com/Exec/v4_item.asp?item_id=">http://www.dvdempire.com/Exec/v4_item.asp?item_id=</A>&quot; + str(self.movie_id)
-	
-	def get_image(self):
-		tmp_page = gutils.trim(self.page, '&lt;td align=&quot;center&quot; valign=&quot;top&quot; class=&quot;fontsmall&quot;&gt;', '&lt;/td&gt;')
-		self.image_url = gutils.trim(tmp_page, '&lt;img src=\'', '\' ')
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.dvdempire.com/Exec/v4_item.asp?item_id=">http://www.dvdempire.com/Exec/v4_item.asp?item_id=</A>&quot; + str(self.movie_id)
+    
+    def get_image(self):
+        tmp_page = gutils.trim(self.page, '&lt;td align=&quot;center&quot; valign=&quot;top&quot; class=&quot;fontsmall&quot;&gt;', '&lt;/td&gt;')
+        self.image_url = gutils.trim(tmp_page, '&lt;img src=\'', '\' ')
 
-	def get_o_title(self):
-		self.o_title = gutils.strip_tags(gutils.trim(self.page,'&lt;td class=&quot;fontxlarge&quot; valign=&quot;top&quot; align=&quot;left&quot;&gt;', '&lt;nobr&gt;'))
+    def get_o_title(self):
+        self.o_title = gutils.strip_tags(gutils.trim(self.page,'&lt;td class=&quot;fontxlarge&quot; valign=&quot;top&quot; align=&quot;left&quot;&gt;', '&lt;nobr&gt;'))
 
-	def get_title(self):
-		self.title = gutils.strip_tags(gutils.trim(self.page,'&lt;td class=&quot;fontxlarge&quot; valign=&quot;top&quot; align=&quot;left&quot;&gt;', '&lt;nobr&gt;'))
+    def get_title(self):
+        self.title = gutils.strip_tags(gutils.trim(self.page,'&lt;td class=&quot;fontxlarge&quot; valign=&quot;top&quot; align=&quot;left&quot;&gt;', '&lt;nobr&gt;'))
 
-	def get_director(self):
-		self.director = gutils.strip_tags(gutils.trim(self.page,&quot;&gt;Directors:&quot;,&quot;&lt;/a&gt;&quot;))
-		self.director = self.director.replace('&nbsp;', '')
-		self.director = self.director.replace('&#149;', '')
+    def get_director(self):
+        self.director = gutils.strip_tags(gutils.trim(self.page,&quot;&gt;Directors:&quot;,&quot;&lt;/a&gt;&quot;))
+        self.director = self.director.replace('&nbsp;', '')
+        self.director = self.director.replace('&#149;', '')
 
-	def get_plot(self):
-		self.plot = gutils.strip_tags(gutils.trim(self.page, '&lt;td width=&quot;100%&quot; valign=&quot;top&quot; class=&quot;fontsmall3&quot;&gt;', '&lt;/td&gt;'))
-		self.plot = self.plot.replace('\x93', '&quot;')
+    def get_plot(self):
+        self.plot = gutils.strip_tags(gutils.trim(self.page, '&lt;td width=&quot;100%&quot; valign=&quot;top&quot; class=&quot;fontsmall3&quot;&gt;', '&lt;/td&gt;'))
+        self.plot = self.plot.replace('\x93', '&quot;')
 
-	def get_year(self):
-		self.year = gutils.strip_tags(gutils.trim(self.page, '&gt;Production Year:', '&lt;br /&gt;'))
+    def get_year(self):
+        self.year = gutils.strip_tags(gutils.trim(self.page, '&gt;Production Year:', '&lt;br /&gt;'))
 
-	def get_runtime(self):
-		self.runtime = gutils.strip_tags(gutils.trim(self.page, '&gt;Length:', '&lt;br /&gt;'))
+    def get_runtime(self):
+        self.runtime = gutils.strip_tags(gutils.trim(self.page, '&gt;Length:', '&lt;br /&gt;'))
 
-	def get_genre(self):
-		self.genre = gutils.strip_tags(gutils.trim(self.page, '&gt;Genre&lt;/b&gt;:', '&lt;/tr&gt;'))
+    def get_genre(self):
+        self.genre = gutils.strip_tags(gutils.trim(self.page, '&gt;Genre&lt;/b&gt;:', '&lt;/tr&gt;'))
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page, '&gt;Actors:', '&lt;/td&gt;&lt;td')
-		self.cast = self.cast.replace('&lt;br&gt;', '\n')
-		self.cast = self.cast.replace('&lt;br /&gt;', '\n')
-		self.cast = self.cast.replace('&nbsp;', '')
-		self.cast = self.cast.replace('&#8226;', '')
-		self.cast = self.cast.replace('&#149;', '')
-		self.cast = gutils.strip_tags(self.cast)
+    def get_cast(self):
+        self.cast = gutils.trim(self.page, '&gt;Actors:', '&lt;/td&gt;&lt;td')
+        self.cast = self.cast.replace('&lt;br&gt;', '\n')
+        self.cast = self.cast.replace('&lt;br /&gt;', '\n')
+        self.cast = self.cast.replace('&nbsp;', '')
+        self.cast = self.cast.replace('&#8226;', '')
+        self.cast = self.cast.replace('&#149;', '')
+        self.cast = gutils.strip_tags(self.cast)
 
-	def get_classification(self):
-		self.classification = gutils.strip_tags(gutils.trim(self.page, '&gt;Rating:', '&lt;br /&gt;'))
+    def get_classification(self):
+        self.classification = gutils.strip_tags(gutils.trim(self.page, '&gt;Rating:', '&lt;br /&gt;'))
 
-	def get_studio(self):
-		self.studio = gutils.strip_tags(gutils.trim(self.page, '&gt;Studio:', '&lt;br /&gt;'))
+    def get_studio(self):
+        self.studio = gutils.strip_tags(gutils.trim(self.page, '&gt;Studio:', '&lt;br /&gt;'))
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		self.country = &quot;&quot;
+    def get_country(self):
+        self.country = &quot;&quot;
 
-	def get_rating(self):
-		self.rating = gutils.clean(gutils.trim(self.page, '&gt;Overall Rating:', ' out of'))
-		try:
-			tmp_float = float(self.rating)
-			tmp_float = round(2 * tmp_float, 0)
-			self.rating = str(tmp_float)
-		except:
-			self.rating = '0'
+    def get_rating(self):
+        self.rating = gutils.clean(gutils.trim(self.page, '&gt;Overall Rating:', ' out of'))
+        try:
+            tmp_float = float(self.rating)
+            tmp_float = round(2 * tmp_float, 0)
+            self.rating = str(tmp_float)
+        except:
+            self.rating = '0'
 
-	def get_notes(self):
-		self.notes = ''
-		tmp_page = gutils.trim(self.page, 'Features:', '&lt;b&gt;')
-		tmp_page = tmp_page.replace('&lt;br&gt;', '\n')
-		tmp_page = tmp_page.replace('&lt;br /&gt;', '\n')
-		tmp_page = gutils.strip_tags(tmp_page)
-		if tmp_page &lt;&gt; '':
-			self.notes = self.notes + '\nFeatures:' + tmp_page + '\n'
-		tmp_page = gutils.trim(self.page, 'Video:', '&lt;b&gt;')
-		tmp_page = tmp_page.replace('&lt;br&gt;', '\n')
-		tmp_page = tmp_page.replace('&lt;br /&gt;', '\n')
-		tmp_page = gutils.strip_tags(tmp_page)
-		if tmp_page &lt;&gt; '':
-			self.notes = self.notes + '\nVideo:' + tmp_page + '\n'
-		tmp_page = gutils.trim(self.page, 'Audio:', '&lt;b&gt;')
-		tmp_page = tmp_page.replace('&lt;br&gt;', '\n')
-		tmp_page = tmp_page.replace('&lt;br /&gt;', '\n')
-		tmp_page = gutils.strip_tags(tmp_page)
-		if tmp_page &lt;&gt; '':
-			self.notes = self.notes + '\nAudio:' + tmp_page
-		tmp_page = gutils.trim(self.page, 'Subtitles:', '&lt;b&gt;')
-		tmp_page = gutils.strip_tags(tmp_page)
-		if tmp_page &lt;&gt; '':
-			self.notes = self.notes + '\nSubtitles:\n' + tmp_page + '\n'
+    def get_notes(self):
+        self.notes = ''
+        tmp_page = gutils.trim(self.page, 'Features:', '&lt;b&gt;')
+        tmp_page = tmp_page.replace('&lt;br&gt;', '\n')
+        tmp_page = tmp_page.replace('&lt;br /&gt;', '\n')
+        tmp_page = gutils.strip_tags(tmp_page)
+        if tmp_page &lt;&gt; '':
+            self.notes = self.notes + '\nFeatures:' + tmp_page + '\n'
+        tmp_page = gutils.trim(self.page, 'Video:', '&lt;b&gt;')
+        tmp_page = tmp_page.replace('&lt;br&gt;', '\n')
+        tmp_page = tmp_page.replace('&lt;br /&gt;', '\n')
+        tmp_page = gutils.strip_tags(tmp_page)
+        if tmp_page &lt;&gt; '':
+            self.notes = self.notes + '\nVideo:' + tmp_page + '\n'
+        tmp_page = gutils.trim(self.page, 'Audio:', '&lt;b&gt;')
+        tmp_page = tmp_page.replace('&lt;br&gt;', '\n')
+        tmp_page = tmp_page.replace('&lt;br /&gt;', '\n')
+        tmp_page = gutils.strip_tags(tmp_page)
+        if tmp_page &lt;&gt; '':
+            self.notes = self.notes + '\nAudio:' + tmp_page
+        tmp_page = gutils.trim(self.page, 'Subtitles:', '&lt;b&gt;')
+        tmp_page = gutils.strip_tags(tmp_page)
+        if tmp_page &lt;&gt; '':
+            self.notes = self.notes + '\nSubtitles:\n' + tmp_page + '\n'
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.original_url_search   = &quot;<A HREF="http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=">http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=">http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=</A>&quot;
-		self.encode = 'iso-8859-1'
+    def __init__(self):
+        self.original_url_search   = &quot;<A HREF="http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=">http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=">http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;string=</A>&quot;
+        self.encode = 'iso-8859-1'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		# short the content
-		tmp_page = gutils.trim(self.page,'&lt;select name=&quot;sort&quot;', 'Click Here to make a Suggestion&lt;/a&gt;')
-		#
-		# try to get all result pages (not so nice, but it works)
-		#
-		tmp_pagecount = gutils.trim(self.page, '&lt;div id=&quot;Search_Container&quot; name=&quot;Search_Container&quot;&gt;', '&lt;/table&gt;')
-		tmp_pagecountintuse = 1
-		elements = tmp_pagecount.split(&quot;&amp;page=&quot;)
-		for element in elements:
-			try:
-				tmp_pagecountint = int(gutils.before(element, '\''))
-			except:
-				tmp_pagecountint = 0
-			if tmp_pagecountint &gt; tmp_pagecountintuse:
-				tmp_pagecountintuse = tmp_pagecountint
-		tmp_pagecountintcurrent = 1
-		while tmp_pagecountintuse &gt; tmp_pagecountintcurrent and tmp_pagecountintuse &lt; 4:
-			tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-			self.url = &quot;<A HREF="http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;page=">http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;page=</A>&quot; + str(tmp_pagecountintcurrent) + &quot;&amp;string=&quot;
-			self.open_search(parent_window)
-			tmp_page2 = gutils.trim(self.page,'&lt;select name=&quot;sort&quot;', 'Click Here to make a Suggestion&lt;/a&gt;')
-			tmp_page = tmp_page + tmp_page2
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        # short the content
+        tmp_page = gutils.trim(self.page,'&lt;select name=&quot;sort&quot;', 'Click Here to make a Suggestion&lt;/a&gt;')
+        #
+        # try to get all result pages (not so nice, but it works)
+        #
+        tmp_pagecount = gutils.trim(self.page, '&lt;div id=&quot;Search_Container&quot; name=&quot;Search_Container&quot;&gt;', '&lt;/table&gt;')
+        tmp_pagecountintuse = 1
+        elements = tmp_pagecount.split(&quot;&amp;page=&quot;)
+        for element in elements:
+            try:
+                tmp_pagecountint = int(gutils.before(element, '\''))
+            except:
+                tmp_pagecountint = 0
+            if tmp_pagecountint &gt; tmp_pagecountintuse:
+                tmp_pagecountintuse = tmp_pagecountint
+        tmp_pagecountintcurrent = 1
+        while tmp_pagecountintuse &gt; tmp_pagecountintcurrent and tmp_pagecountintuse &lt; 4:
+            tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
+            self.url = &quot;<A HREF="http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;page=">http://www.dvdempire.com/Exec/v1_search_all.asp?&amp;site_media_id=0&amp;pp=&amp;search_refined=32&amp;used=0&amp;page=</A>&quot; + str(tmp_pagecountintcurrent) + &quot;&amp;string=&quot;
+            self.open_search(parent_window)
+            tmp_page2 = gutils.trim(self.page,'&lt;select name=&quot;sort&quot;', 'Click Here to make a Suggestion&lt;/a&gt;')
+            tmp_page = tmp_page + tmp_page2
 
-		self.page = tmp_page
-		return self.page
+        self.page = tmp_page
+        return self.page
 
-	def get_searches(self):
-		split_pattern = re.compile('&lt;a[\t ]+href=[&quot;\']/Exec/v4_item[.]asp[?]userid=[-0-9]+[&amp;]amp;item_id=')
-		check_pattern = re.compile('[0-9]+[&amp;]amp;searchID=[0-9]+[&quot;\']&gt;')
-		elements = split_pattern.split(self.page)
-		elements[0] = ''
-		for element in elements:
-			if element &lt;&gt; '':
-				is_an_item = check_pattern.search(element)
-				if is_an_item:
-					tmp_title = gutils.strip_tags(gutils.trim(element, &quot;&gt;&quot;, &quot;&lt;/a&gt;&quot;))
-					if tmp_title &lt;&gt; '':
-						tmp_id = gutils.before(element,'&amp;')
-						self.ids.append(tmp_id)
-						self.titles.append(tmp_title)
+    def get_searches(self):
+        split_pattern = re.compile('&lt;a[\t ]+href=[&quot;\']/Exec/v4_item[.]asp[?]userid=[-0-9]+[&amp;]amp;item_id=')
+        check_pattern = re.compile('[0-9]+[&amp;]amp;searchID=[0-9]+[&quot;\']&gt;')
+        elements = split_pattern.split(self.page)
+        elements[0] = ''
+        for element in elements:
+            if element &lt;&gt; '':
+                is_an_item = check_pattern.search(element)
+                if is_an_item:
+                    tmp_title = gutils.strip_tags(gutils.trim(element, &quot;&gt;&quot;, &quot;&lt;/a&gt;&quot;))
+                    if tmp_title &lt;&gt; '':
+                        tmp_id = gutils.before(element,'&amp;')
+                        self.ids.append(tmp_id)
+                        self.titles.append(tmp_title)

Modified: trunk/lib/plugins/movie/PluginMovieDVDPalace.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieDVDPalace.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieDVDPalace.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -37,173 +37,173 @@
 
 class Plugin(movie.Movie):
 
-	def __init__(self, id):
-		self.encode   = 'iso-8859-1'
-		self.movie_id = id
-		self.url      = '<A HREF="http://www.dvd-palace.de/dvd-datenbank/">http://www.dvd-palace.de/dvd-datenbank/</A>' + self.movie_id
+    def __init__(self, id):
+        self.encode   = 'iso-8859-1'
+        self.movie_id = id
+        self.url      = '<A HREF="http://www.dvd-palace.de/dvd-datenbank/">http://www.dvd-palace.de/dvd-datenbank/</A>' + self.movie_id
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page, 'src=&quot;/showcover.php?', '&quot;')
-		if self.image_url &lt;&gt; '':
-			self.image_url = '<A HREF="http://www.dvd-palace.de/showcover.php?">http://www.dvd-palace.de/showcover.php?</A>' + self.image_url
+    def get_image(self):
+        self.image_url = gutils.trim(self.page, 'src=&quot;/showcover.php?', '&quot;')
+        if self.image_url &lt;&gt; '':
+            self.image_url = '<A HREF="http://www.dvd-palace.de/showcover.php?">http://www.dvd-palace.de/showcover.php?</A>' + self.image_url
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, 'Originaltitel', '&lt;/b&gt;')
-		if self.o_title == '':
-			self.o_title = gutils.trim(self.page, '&lt;TITLE&gt;', ' - DVD Details')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, 'Originaltitel', '&lt;/b&gt;')
+        if self.o_title == '':
+            self.o_title = gutils.trim(self.page, '&lt;TITLE&gt;', ' - DVD Details')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;TITLE&gt;', ' - DVD Details')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;TITLE&gt;', ' - DVD Details')
 
-	def get_director(self):
-		self.director = gutils.trim(self.page, 'Regisseur(e)', '&lt;/TR&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page, 'Regisseur(e)', '&lt;/TR&gt;')
 
-	def get_plot(self):
-		self.plot = re.sub(
-			'[0-9 ]+Views', '',
-			re.sub(
-				'[&#194;&#150;]', '-',
-				re.sub(
-					'[\x93&#194;&#132;]', '&quot;', self.regextrim(self.page, 'showcover.php[^&gt;]*&gt;', '&lt;/td&gt;'))))
+    def get_plot(self):
+        self.plot = re.sub(
+            '[0-9 ]+Views', '',
+            re.sub(
+                '[&#194;&#150;]', '-',
+                re.sub(
+                    '[\x93&#194;&#132;]', '&quot;', self.regextrim(self.page, 'showcover.php[^&gt;]*&gt;', '&lt;/td&gt;'))))
 
-	def get_year(self):
-		self.year = gutils.after(gutils.trim(gutils.trim(self.page, 'Originaltitel', '&lt;/TR&gt;'), '(', ')'), ' ')
+    def get_year(self):
+        self.year = gutils.after(gutils.trim(gutils.trim(self.page, 'Originaltitel', '&lt;/TR&gt;'), '(', ')'), ' ')
 
-	def get_runtime(self):
-		self.runtime = gutils.strip_tags(string.replace(gutils.trim(self.page, 'Laufzeit', ' min'), 'ca. ', ''))
+    def get_runtime(self):
+        self.runtime = gutils.strip_tags(string.replace(gutils.trim(self.page, 'Laufzeit', ' min'), 'ca. ', ''))
 
-	def get_genre(self):
-		self.genre = string.replace(string.replace(gutils.trim(self.page, 'Genre(s)', '&lt;/TR&gt;'), '&nbsp;', ''), '&lt;br&gt;', ', ')
+    def get_genre(self):
+        self.genre = string.replace(string.replace(gutils.trim(self.page, 'Genre(s)', '&lt;/TR&gt;'), '&nbsp;', ''), '&lt;br&gt;', ', ')
 
-	def get_cast(self):
-		self.cast = string.replace(
-			re.sub('&lt;em&gt;[^&lt;]*&lt;/em&gt;', ' ',
-				re.sub(',[ ]*', '\n',
-					gutils.trim(self.page, 'Darsteller / Sprecher', '&lt;/TR&gt;')
-				)
-			),
-			'\n ', '\n')
+    def get_cast(self):
+        self.cast = string.replace(
+            re.sub('&lt;em&gt;[^&lt;]*&lt;/em&gt;', ' ',
+                re.sub(',[ ]*', '\n',
+                    gutils.trim(self.page, 'Darsteller / Sprecher', '&lt;/TR&gt;')
+                )
+            ),
+            '\n ', '\n')
 
-	def get_classification(self):
-		self.classification = string.replace(gutils.trim(self.page, 'Altersfreigabe (FSK)', '&lt;/TR&gt;'), '&nbsp;', '')
+    def get_classification(self):
+        self.classification = string.replace(gutils.trim(self.page, 'Altersfreigabe (FSK)', '&lt;/TR&gt;'), '&nbsp;', '')
 
-	def get_studio(self):
-		self.studio = string.replace(string.replace(gutils.trim(self.page, 'Label', '&lt;/td&gt;'), '&nbsp;', ''), ':', '')
+    def get_studio(self):
+        self.studio = string.replace(string.replace(gutils.trim(self.page, 'Label', '&lt;/td&gt;'), '&nbsp;', ''), ':', '')
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = ''
+    def get_trailer(self):
+        self.trailer = ''
 
-	def get_country(self):
-		self.country = gutils.before(gutils.trim(gutils.trim(self.page, 'Originaltitel', '&lt;/TR&gt;'), '(', ')'), ' ')
+    def get_country(self):
+        self.country = gutils.before(gutils.trim(gutils.trim(self.page, 'Originaltitel', '&lt;/TR&gt;'), '(', ')'), ' ')
 
-	def get_rating(self):
-		self.rating = &quot;0&quot;
+    def get_rating(self):
+        self.rating = &quot;0&quot;
 
-	def get_notes(self):
-		self.notes = &quot;&quot;
-		tmp_notes = re.sub('^[ \t]+', '',
-			gutils.strip_tags(
-			re.sub('(&lt;br&gt;|&lt;br /&gt;)', '\r\n',
-			re.sub('[\r\n]+', '',
-			re.sub('[ \t][ \t\r\n]+', ' ',
-			gutils.trim(self.page, 'Bildformat(e)', '&lt;/TR&gt;')))))
-		)
-		if (tmp_notes != &quot;&quot;):
-			self.notes = self.notes + &quot;Bildformat(e):\n&quot; + tmp_notes + &quot;\n&quot;
-		tmp_notes = re.sub('^[ \t]+', '',
-			gutils.strip_tags(
-			re.sub('(&lt;br&gt;|&lt;br /&gt;)', '\r\n',
-			re.sub('[\r\n]+', '',
-			re.sub('[ \t][ \t\r\n]+', ' ',
-			gutils.trim(self.page, 'Tonformat(e)', '&lt;/TR&gt;')))))
-		)
-		if (tmp_notes != &quot;&quot;):
-			self.notes = self.notes + &quot;Tonformat(e):\n&quot; + tmp_notes + &quot;\n\n&quot;
-		tmp_notes = re.sub('^[ \t]+', '',
-			gutils.strip_tags(
-			re.sub('(&lt;br&gt;|&lt;br /&gt;)', '\r\n',
-			re.sub('[\r\n]+', '',
-			re.sub('[ \t][ \t\r\n]+', ' ',
-			gutils.trim(self.page, 'Untertitel', '&lt;/TR&gt;')))))
-		)
-		if (tmp_notes != &quot;&quot;):
-			self.notes = self.notes + &quot;Untertitel:&quot; + tmp_notes + &quot;\n\n&quot;
-			
-	def regextrim(self,text,key1,key2):
-		obj = re.search(key1, text)
-		if obj is None:
-			return ''
-		else:
-			p1 = obj.end()
-		obj = re.search(key2, text[p1:])
-		if obj is None:
-			return ''
-		else:
-			p2 = p1 + obj.end()
-		return text[p1:p2]
+    def get_notes(self):
+        self.notes = &quot;&quot;
+        tmp_notes = re.sub('^[ \t]+', '',
+            gutils.strip_tags(
+            re.sub('(&lt;br&gt;|&lt;br /&gt;)', '\r\n',
+            re.sub('[\r\n]+', '',
+            re.sub('[ \t][ \t\r\n]+', ' ',
+            gutils.trim(self.page, 'Bildformat(e)', '&lt;/TR&gt;')))))
+        )
+        if (tmp_notes != &quot;&quot;):
+            self.notes = self.notes + &quot;Bildformat(e):\n&quot; + tmp_notes + &quot;\n&quot;
+        tmp_notes = re.sub('^[ \t]+', '',
+            gutils.strip_tags(
+            re.sub('(&lt;br&gt;|&lt;br /&gt;)', '\r\n',
+            re.sub('[\r\n]+', '',
+            re.sub('[ \t][ \t\r\n]+', ' ',
+            gutils.trim(self.page, 'Tonformat(e)', '&lt;/TR&gt;')))))
+        )
+        if (tmp_notes != &quot;&quot;):
+            self.notes = self.notes + &quot;Tonformat(e):\n&quot; + tmp_notes + &quot;\n\n&quot;
+        tmp_notes = re.sub('^[ \t]+', '',
+            gutils.strip_tags(
+            re.sub('(&lt;br&gt;|&lt;br /&gt;)', '\r\n',
+            re.sub('[\r\n]+', '',
+            re.sub('[ \t][ \t\r\n]+', ' ',
+            gutils.trim(self.page, 'Untertitel', '&lt;/TR&gt;')))))
+        )
+        if (tmp_notes != &quot;&quot;):
+            self.notes = self.notes + &quot;Untertitel:&quot; + tmp_notes + &quot;\n\n&quot;
+            
+    def regextrim(self,text,key1,key2):
+        obj = re.search(key1, text)
+        if obj is None:
+            return ''
+        else:
+            p1 = obj.end()
+        obj = re.search(key2, text[p1:])
+        if obj is None:
+            return ''
+        else:
+            p2 = p1 + obj.end()
+        return text[p1:p2]
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search   = &quot;<A HREF="http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=">http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=">http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=</A>&quot;
-		self.encode='iso-8859-1'
+    def __init__(self):
+        self.original_url_search   = &quot;<A HREF="http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=">http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=">http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;suchbegriff=</A>&quot;
+        self.encode='iso-8859-1'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		tmp_pagemovie = self.page
-		#
-		# try to get all result pages (not so nice, but it works)
-		#
-		tmp_pagecount = gutils.trim(tmp_pagemovie, 'Seiten (&lt;b&gt;', '&lt;/b&gt;)')
-		try:
-			tmp_pagecountint = int(tmp_pagecount)
-		except:
-			tmp_pagecountint = 1
-		tmp_pagecountintcurrent = 1
-		while (tmp_pagecountint &gt; tmp_pagecountintcurrent and tmp_pagecountintcurrent &lt; 5):
-			self.url = &quot;<A HREF="http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;start=">http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;start=</A>&quot; + str(tmp_pagecountintcurrent * 20) + &quot;&amp;suchbegriff=&quot;
-			self.open_search(parent_window)
-			tmp_pagemovie = tmp_pagemovie + self.page
-			tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-		self.page = tmp_pagemovie
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        tmp_pagemovie = self.page
+        #
+        # try to get all result pages (not so nice, but it works)
+        #
+        tmp_pagecount = gutils.trim(tmp_pagemovie, 'Seiten (&lt;b&gt;', '&lt;/b&gt;)')
+        try:
+            tmp_pagecountint = int(tmp_pagecount)
+        except:
+            tmp_pagecountint = 1
+        tmp_pagecountintcurrent = 1
+        while (tmp_pagecountint &gt; tmp_pagecountintcurrent and tmp_pagecountintcurrent &lt; 5):
+            self.url = &quot;<A HREF="http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;start=">http://www.dvd-palace.de/dvddatabase/dbsearch.php?action=1&amp;start=</A>&quot; + str(tmp_pagecountintcurrent * 20) + &quot;&amp;suchbegriff=&quot;
+            self.open_search(parent_window)
+            tmp_pagemovie = tmp_pagemovie + self.page
+            tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
+        self.page = tmp_pagemovie
+        return self.page
 
-	def get_searches(self):
-		elements1 = re.split('&nbsp;&lt;a title=&quot;[^&quot;]+&quot; href=&quot;/dvd-datenbank/', self.page)
-		elements1[0] = None
-		for element in elements1:
-			if element &lt;&gt; None:
-				self.ids.append(gutils.before(element,'&quot;'))
-				self.titles.append(
-					gutils.trim(element, '&gt;', '&lt;/a&gt;') +
-					gutils.strip_tags(
-						' (' +
-						re.sub('[ \t\n][ \t\n]+', ' ',
-						string.replace(
-						string.replace(
-							self.regextrim(element, '&lt;div [^&gt;]*&gt;', '&lt;/div&gt;'),
-							'&lt;br&gt;', ' - '),
-							'&nbsp;', ''))
-						+ ')'
-					)
-				)
-			
-	def regextrim(self,text,key1,key2):
-		obj = re.search(key1, text)
-		if obj is None:
-			return ''
-		else:
-			p1 = obj.end()
-		obj = re.search(key2, text[p1:])
-		if obj is None:
-			return ''
-		else:
-			p2 = p1 + obj.end()
-		return text[p1:p2]
+    def get_searches(self):
+        elements1 = re.split('&nbsp;&lt;a title=&quot;[^&quot;]+&quot; href=&quot;/dvd-datenbank/', self.page)
+        elements1[0] = None
+        for element in elements1:
+            if element &lt;&gt; None:
+                self.ids.append(gutils.before(element,'&quot;'))
+                self.titles.append(
+                    gutils.trim(element, '&gt;', '&lt;/a&gt;') +
+                    gutils.strip_tags(
+                        ' (' +
+                        re.sub('[ \t\n][ \t\n]+', ' ',
+                        string.replace(
+                        string.replace(
+                            self.regextrim(element, '&lt;div [^&gt;]*&gt;', '&lt;/div&gt;'),
+                            '&lt;br&gt;', ' - '),
+                            '&nbsp;', ''))
+                        + ')'
+                    )
+                )
+            
+    def regextrim(self,text,key1,key2):
+        obj = re.search(key1, text)
+        if obj is None:
+            return ''
+        else:
+            p1 = obj.end()
+        obj = re.search(key2, text[p1:])
+        if obj is None:
+            return ''
+        else:
+            p2 = p1 + obj.end()
+        return text[p1:p2]

Modified: trunk/lib/plugins/movie/PluginMovieE-Pipoca.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -37,118 +37,118 @@
 plugin_version = &quot;0.5&quot;
 
 class Plugin(movie.Movie):
-	&quot;A movie plugin object&quot;
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://epipoca.uol.com.br/filmes_detalhes.php?idf=">http://epipoca.uol.com.br/filmes_detalhes.php?idf=</A>&quot; + str(self.movie_id)
+    &quot;A movie plugin object&quot;
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://epipoca.uol.com.br/filmes_detalhes.php?idf=">http://epipoca.uol.com.br/filmes_detalhes.php?idf=</A>&quot; + str(self.movie_id)
 
-	def get_image(self):
-		&quot;Find the film's poster image&quot;
-		tmp_pic = gutils.trim(self.page, &quot;images/filmes/poster/poster_&quot;, &quot;\&quot;&quot;)
-		self.image_url = \
-			&quot;<A HREF="http://epipoca.uol.com.br/images/filmes/poster/poster_">http://epipoca.uol.com.br/images/filmes/poster/poster_</A>&quot; + tmp_pic
+    def get_image(self):
+        &quot;Find the film's poster image&quot;
+        tmp_pic = gutils.trim(self.page, &quot;images/filmes/poster/poster_&quot;, &quot;\&quot;&quot;)
+        self.image_url = \
+            &quot;<A HREF="http://epipoca.uol.com.br/images/filmes/poster/poster_">http://epipoca.uol.com.br/images/filmes/poster/poster_</A>&quot; + tmp_pic
 
-	def get_o_title(self):
-		&quot;Find the film's original title&quot;
-		self.o_title = string.capwords(gutils.trim(self.page, &quot;&lt;/font&gt;&lt;br&gt;(&quot;, &quot;, &quot;))
+    def get_o_title(self):
+        &quot;Find the film's original title&quot;
+        self.o_title = string.capwords(gutils.trim(self.page, &quot;&lt;/font&gt;&lt;br&gt;(&quot;, &quot;, &quot;))
 
-	def get_title(self):
-		&quot;&quot;&quot;Find the film's local title.
-		Probably the original title translation&quot;&quot;&quot;
-		self.title = gutils.trim(self.page, &quot;&lt;TITLE&gt;&quot;, &quot; (&quot;)
+    def get_title(self):
+        &quot;&quot;&quot;Find the film's local title.
+        Probably the original title translation&quot;&quot;&quot;
+        self.title = gutils.trim(self.page, &quot;&lt;TITLE&gt;&quot;, &quot; (&quot;)
 
-	def get_director(self):
-		&quot;Find the film's director&quot;
-		self.director = gutils.trim(self.page, &quot;&lt;b&gt;Diretor(es): &lt;/b&gt;&quot;, &quot;&lt;/a&gt;&lt;/td&gt;&quot;)
+    def get_director(self):
+        &quot;Find the film's director&quot;
+        self.director = gutils.trim(self.page, &quot;&lt;b&gt;Diretor(es): &lt;/b&gt;&quot;, &quot;&lt;/a&gt;&lt;/td&gt;&quot;)
 
-	def get_plot(self):
-		&quot;Find the film's plot&quot;
-		self.plot = gutils.trim(self.page, &quot;&lt;b&gt;SINOPSE&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;br&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)
+    def get_plot(self):
+        &quot;Find the film's plot&quot;
+        self.plot = gutils.trim(self.page, &quot;&lt;b&gt;SINOPSE&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;br&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)
 
-	def get_year(self):
-		&quot;Find the film's year&quot;
-		self.year = gutils.trim(self.page, &quot;&lt;a href=\&quot;busca_mais.php?opc=ano&amp;busca=&quot;, &quot;\&quot;&gt;&quot;)
+    def get_year(self):
+        &quot;Find the film's year&quot;
+        self.year = gutils.trim(self.page, &quot;&lt;a href=\&quot;busca_mais.php?opc=ano&amp;busca=&quot;, &quot;\&quot;&gt;&quot;)
 
-	def get_runtime(self):
-		&quot;Find the film's running time&quot;
-		self.runtime = gutils.trim(self.page, &quot;&lt;td&gt;&lt;b&gt;Dura&quot;, &quot; min.&lt;/td&gt;&quot;)
-		self.runtime = self.runtime[9:]
+    def get_runtime(self):
+        &quot;Find the film's running time&quot;
+        self.runtime = gutils.trim(self.page, &quot;&lt;td&gt;&lt;b&gt;Dura&quot;, &quot; min.&lt;/td&gt;&quot;)
+        self.runtime = self.runtime[9:]
 
-	def get_genre(self):
-		&quot;Find the film's genre&quot;
-		self.genre = gutils.trim(self.page, &quot;&lt;a href=\&quot;busca_mais.php?opc=genero&amp;busca=&quot;, &quot;\&quot;&gt;&quot;)
+    def get_genre(self):
+        &quot;Find the film's genre&quot;
+        self.genre = gutils.trim(self.page, &quot;&lt;a href=\&quot;busca_mais.php?opc=genero&amp;busca=&quot;, &quot;\&quot;&gt;&quot;)
 
-	def get_cast(self):
-		&quot;Find the actors. Try to make it line separated.&quot;
-		self.cast = &quot;&quot;
-		self.cast = gutils.trim(self.page, &quot;&lt;b&gt;Elenco: &lt;/b&gt;&quot;, &quot;&lt;b&gt;mais...&lt;/b&gt;&quot;)
-		self.cast = gutils.strip_tags(self.cast)
-		self.cast = self.cast[:-2]
+    def get_cast(self):
+        &quot;Find the actors. Try to make it line separated.&quot;
+        self.cast = &quot;&quot;
+        self.cast = gutils.trim(self.page, &quot;&lt;b&gt;Elenco: &lt;/b&gt;&quot;, &quot;&lt;b&gt;mais...&lt;/b&gt;&quot;)
+        self.cast = gutils.strip_tags(self.cast)
+        self.cast = self.cast[:-2]
 
-	def get_classification(self):
-		&quot;Find the film's classification&quot;
-		self.classification = &quot;&quot;
+    def get_classification(self):
+        &quot;Find the film's classification&quot;
+        self.classification = &quot;&quot;
 
-	def get_studio(self):
-		&quot;Find the studio&quot;
-		self.studio = gutils.trim(self.page, &quot;&lt;b&gt;Distribuidora(s): &lt;/b&gt;&quot;, &quot;&lt;/a&gt;&lt;/td&gt;&quot;)
+    def get_studio(self):
+        &quot;Find the studio&quot;
+        self.studio = gutils.trim(self.page, &quot;&lt;b&gt;Distribuidora(s): &lt;/b&gt;&quot;, &quot;&lt;/a&gt;&lt;/td&gt;&quot;)
 
-	def get_o_site(self):
-		&quot;Find the film's oficial site&quot;
-		self.o_site = &quot;<A HREF="http://epipoca.uol.com.br/filmes_web.php?idf=">http://epipoca.uol.com.br/filmes_web.php?idf=</A>&quot; + str(self.movie_id)
+    def get_o_site(self):
+        &quot;Find the film's oficial site&quot;
+        self.o_site = &quot;<A HREF="http://epipoca.uol.com.br/filmes_web.php?idf=">http://epipoca.uol.com.br/filmes_web.php?idf=</A>&quot; + str(self.movie_id)
 
-	def get_site(self):
-		&quot;Find the film's imdb details page&quot;
-		self.site = &quot;<A HREF="http://epipoca.uol.com.br/filmes_ficha.php?idf=">http://epipoca.uol.com.br/filmes_ficha.php?idf=</A>&quot; + str(self.movie_id)
+    def get_site(self):
+        &quot;Find the film's imdb details page&quot;
+        self.site = &quot;<A HREF="http://epipoca.uol.com.br/filmes_ficha.php?idf=">http://epipoca.uol.com.br/filmes_ficha.php?idf=</A>&quot; + str(self.movie_id)
 
-	def get_trailer(self):
-		&quot;Find the film's trailer page or location&quot;
-		self.trailer = &quot;<A HREF="http://epipoca.uol.com.br/filmes_trailer.php?idf=">http://epipoca.uol.com.br/filmes_trailer.php?idf=</A>&quot; + str(self.movie_id)
-			
-	def get_country(self):
-		&quot;Find the film's country&quot;
-		self.country = gutils.trim(self.page, &quot;&lt;a href=\&quot;busca_mais.php?opc=pais&amp;busca=&quot;, &quot;\&quot;&gt;&quot;)
+    def get_trailer(self):
+        &quot;Find the film's trailer page or location&quot;
+        self.trailer = &quot;<A HREF="http://epipoca.uol.com.br/filmes_trailer.php?idf=">http://epipoca.uol.com.br/filmes_trailer.php?idf=</A>&quot; + str(self.movie_id)
+            
+    def get_country(self):
+        &quot;Find the film's country&quot;
+        self.country = gutils.trim(self.page, &quot;&lt;a href=\&quot;busca_mais.php?opc=pais&amp;busca=&quot;, &quot;\&quot;&gt;&quot;)
 
-	def get_rating(self):
-		&quot;&quot;&quot;Find the film's rating. From 0 to 10.
-		Convert if needed when assigning.&quot;&quot;&quot;
-		tmp_rating = gutils.trim(self.page, &quot;&lt;br&gt;&lt;b&gt;Cota&quot;, &quot; (&quot;)
-		tmp_rating = gutils.after(tmp_rating, &quot;&lt;/b&gt;&quot;)
-		if tmp_rating &lt;&gt; &quot;&quot;:
-			tmp_rating = string.replace(tmp_rating,',','.')
-			self.rating = str( float(string.strip(tmp_rating)) )
-		else:
-			self.rating = &quot;&quot;
+    def get_rating(self):
+        &quot;&quot;&quot;Find the film's rating. From 0 to 10.
+        Convert if needed when assigning.&quot;&quot;&quot;
+        tmp_rating = gutils.trim(self.page, &quot;&lt;br&gt;&lt;b&gt;Cota&quot;, &quot; (&quot;)
+        tmp_rating = gutils.after(tmp_rating, &quot;&lt;/b&gt;&quot;)
+        if tmp_rating &lt;&gt; &quot;&quot;:
+            tmp_rating = string.replace(tmp_rating,',','.')
+            self.rating = str( float(string.strip(tmp_rating)) )
+        else:
+            self.rating = &quot;&quot;
 
 class SearchPlugin(movie.SearchMovie):
-	&quot;A movie search object&quot;
-	def __init__(self):
-		self.original_url_search = \
-			&quot;<A HREF="http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=">http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=</A>&quot;
-		self.translated_url_search = \
-			&quot;<A HREF="http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=">http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=</A>&quot;
-		self.encode='iso-8859-1'
+    &quot;A movie search object&quot;
+    def __init__(self):
+        self.original_url_search = \
+            &quot;<A HREF="http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=">http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=</A>&quot;
+        self.translated_url_search = \
+            &quot;<A HREF="http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=">http://epipoca.uol.com.br/busca.php?opc=todos&amp;busca=</A>&quot;
+        self.encode='iso-8859-1'
 
-	def search(self, parent_window):
-		&quot;Perform the web search&quot;
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self, parent_window):
+        &quot;Perform the web search&quot;
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		&quot;Isolating just a portion (with the data we want) of the results&quot;
-		self.page = gutils.trim(self.page, \
-			&quot;&nbsp;Resul&quot;,&quot;&gt;&lt;b&gt;Not&quot;) 
+    def sub_search(self):
+        &quot;Isolating just a portion (with the data we want) of the results&quot;
+        self.page = gutils.trim(self.page, \
+            &quot;&nbsp;Resul&quot;,&quot;&gt;&lt;b&gt;Not&quot;) 
 
-	def get_searches(self):
-		&quot;Try to find both id and film title for each search result&quot;
-		elements = string.split(self.page, &quot;&lt;td width=\&quot;55\&quot; align=\&quot;center\&quot; bgcolor=&quot;)
-		self.number_results = elements[-1]
+    def get_searches(self):
+        &quot;Try to find both id and film title for each search result&quot;
+        elements = string.split(self.page, &quot;&lt;td width=\&quot;55\&quot; align=\&quot;center\&quot; bgcolor=&quot;)
+        self.number_results = elements[-1]
 
-		if (elements[0] != ''):
-			for element in elements:
-				self.ids.append(gutils.trim(element, &quot;&lt;a href=\&quot;filmes_detalhes.php?idf=&quot;, &quot;\&quot;&gt;&quot;))
-				self.titles.append(gutils.strip_tags(gutils.trim(element, &quot;&lt;font class=\&quot;titulo\&quot;&gt;&quot;, &quot;&lt;b&gt;Adicionar aos meus filmes favoritos&lt;/b&gt;&quot;) ))
-		else:
-			self.number_results = 0
+        if (elements[0] != ''):
+            for element in elements:
+                self.ids.append(gutils.trim(element, &quot;&lt;a href=\&quot;filmes_detalhes.php?idf=&quot;, &quot;\&quot;&gt;&quot;))
+                self.titles.append(gutils.strip_tags(gutils.trim(element, &quot;&lt;font class=\&quot;titulo\&quot;&gt;&quot;, &quot;&lt;b&gt;Adicionar aos meus filmes favoritos&lt;/b&gt;&quot;) ))
+        else:
+            self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieFDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFDb.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieFDb.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -27,145 +27,145 @@
 import string
 import re
 
-plugin_name		= 'FDb'
-plugin_description	= 'Internetowa baza filmowa'
-plugin_url		= 'fdb.pl'
-plugin_language		= _('Polish')
-plugin_author		= 'Piotr O&#197;&#188;arowski'
-plugin_author_email	= '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">ozarow+griffith at gmail.com</A>&gt;'
-plugin_version		= '1.8'
+plugin_name        = 'FDb'
+plugin_description    = 'Internetowa baza filmowa'
+plugin_url        = 'fdb.pl'
+plugin_language        = _('Polish')
+plugin_author        = 'Piotr O&#197;&#188;arowski'
+plugin_author_email    = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">ozarow+griffith at gmail.com</A>&gt;'
+plugin_version        = '1.8'
 
 class Plugin(movie.Movie):
-	TRAILER_PATTERN = re.compile('\s*&lt;a\shref=[\'&quot;](.*?)[&quot;\'].*?&gt;\(zobacz\szwiastun\)&lt;/a&gt;')
-	
-	def __init__(self, movie_id):
-		from md5 import md5
-		self.movie_id = md5(movie_id).hexdigest()
-		self.encode   = 'utf-8'
-		if string.find(movie_id, '<A HREF="http://">http://</A>') != -1:
-			self.url = str(movie_id)
-		else:
-			self.url = &quot;<A HREF="http://fdb.pl/%s">http://fdb.pl/%s</A>&quot; % str(movie_id)
+    TRAILER_PATTERN = re.compile('\s*&lt;a\shref=[\'&quot;](.*?)[&quot;\'].*?&gt;\(zobacz\szwiastun\)&lt;/a&gt;')
+    
+    def __init__(self, movie_id):
+        from md5 import md5
+        self.movie_id = md5(movie_id).hexdigest()
+        self.encode   = 'utf-8'
+        if string.find(movie_id, '<A HREF="http://">http://</A>') != -1:
+            self.url = str(movie_id)
+        else:
+            self.url = &quot;<A HREF="http://fdb.pl/%s">http://fdb.pl/%s</A>&quot; % str(movie_id)
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page, 'class=&quot;moviePosterTable&quot;', '&lt;/td&gt;');
-		self.image_url = gutils.trim(self.image_url,' src=&quot;',&quot;\&quot;\n&quot;)
-		if self.image_url.endswith('no_picture.png'):
-			self.image_url = ''
-		else:
-			self.image_url = &quot;<A HREF="http://fdb.pl%s">http://fdb.pl%s</A>&quot; % self.image_url
+    def get_image(self):
+        self.image_url = gutils.trim(self.page, 'class=&quot;moviePosterTable&quot;', '&lt;/td&gt;');
+        self.image_url = gutils.trim(self.image_url,' src=&quot;',&quot;\&quot;\n&quot;)
+        if self.image_url.endswith('no_picture.png'):
+            self.image_url = ''
+        else:
+            self.image_url = &quot;<A HREF="http://fdb.pl%s">http://fdb.pl%s</A>&quot; % self.image_url
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;h2&gt;', '&lt;/h2&gt;')
-		self.o_title = gutils.strip_tags(self.o_title)
-		if self.o_title == '':
-			self.o_title = self.get_title(True)
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;h2&gt;', '&lt;/h2&gt;')
+        self.o_title = gutils.strip_tags(self.o_title)
+        if self.o_title == '':
+            self.o_title = self.get_title(True)
 
-	def get_title(self, extra=False):
-		data = gutils.trim(self.page,'&lt;title&gt;', '&lt;/title&gt;')
-		tmp = string.find(data, '(')
-		if tmp != -1:
-			data = data[:tmp]
-		if extra is False:
-			self.title = data
-		else:
-			return data
+    def get_title(self, extra=False):
+        data = gutils.trim(self.page,'&lt;title&gt;', '&lt;/title&gt;')
+        tmp = string.find(data, '(')
+        if tmp != -1:
+            data = data[:tmp]
+        if extra is False:
+            self.title = data
+        else:
+            return data
 
-	def get_director(self):
-		self.director = ''
-		elements = gutils.trim(self.page,'&gt;Re&#197;&#188;yseria&lt;/div&gt;','&lt;br /&gt;')
-		elements = string.split(elements, '&lt;div&gt;')
-		if elements[0] != '':
-			for element in elements:
-				element = gutils.trim(element, '&gt;', '&lt;/a')
-				if element != '':
-					self.director += ', ' + element
-			self.director = string.replace(self.director[2:], ', &nbsp;&nbsp;&nbsp;(wi&#196;&#153;cej)', '')
+    def get_director(self):
+        self.director = ''
+        elements = gutils.trim(self.page,'&gt;Re&#197;&#188;yseria&lt;/div&gt;','&lt;br /&gt;')
+        elements = string.split(elements, '&lt;div&gt;')
+        if elements[0] != '':
+            for element in elements:
+                element = gutils.trim(element, '&gt;', '&lt;/a')
+                if element != '':
+                    self.director += ', ' + element
+            self.director = string.replace(self.director[2:], ', &nbsp;&nbsp;&nbsp;(wi&#196;&#153;cej)', '')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,'&gt;Opis filmu:&lt;/div&gt;','&lt;/div&gt;')
-		self.plot = self.TRAILER_PATTERN.sub('', self.plot)
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,'&gt;Opis filmu:&lt;/div&gt;','&lt;/div&gt;')
+        self.plot = self.TRAILER_PATTERN.sub('', self.plot)
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,' class=&quot;movieYear&quot;&gt;(', ')&lt;/span&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page,' class=&quot;movieYear&quot;&gt;(', ')&lt;/span&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page,&quot;&gt;Czas trwania:&lt;/span&gt;\n        &quot;,' min')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page,&quot;&gt;Czas trwania:&lt;/span&gt;\n        &quot;,' min')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,'&gt;Gatunek:&lt;/span&gt;','&lt;/div&gt;')
-		self.genre = string.replace(self.genre, '   ', '')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,'&gt;Gatunek:&lt;/span&gt;','&lt;/div&gt;')
+        self.genre = string.replace(self.genre, '   ', '')
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page,'&gt;Obsada:&lt;/div&gt;', &quot;&quot;&quot;&lt;tr&gt;
+    def get_cast(self):
+        self.cast = gutils.trim(self.page,'&gt;Obsada:&lt;/div&gt;', &quot;&quot;&quot;&lt;tr&gt;
             &lt;td colspan&quot;&quot;&quot;)
-		if self.cast != '':
-			self.cast = self.cast.replace('....',_(' as '))
-			self.cast = self.cast.replace('  ', '')
-			self.cast = self.cast.replace(&quot;\n&quot;, '')
-			self.cast = self.cast.replace('&lt;/tr&gt;', &quot;\n&quot;)
+        if self.cast != '':
+            self.cast = self.cast.replace('....',_(' as '))
+            self.cast = self.cast.replace('  ', '')
+            self.cast = self.cast.replace(&quot;\n&quot;, '')
+            self.cast = self.cast.replace('&lt;/tr&gt;', &quot;\n&quot;)
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page,&quot;&gt;Od lat:&lt;/span&gt;\n&quot;,&quot;\n&quot;)
+    def get_classification(self):
+        self.classification = gutils.trim(self.page,&quot;&gt;Od lat:&lt;/span&gt;\n&quot;,&quot;\n&quot;)
 
-	def get_studio(self):
-		self.studio = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		trailer_url = self.TRAILER_PATTERN.findall(self.page)
-		if trailer_url:
-			self.trailer = trailer_url[0]
+    def get_trailer(self):
+        trailer_url = self.TRAILER_PATTERN.findall(self.page)
+        if trailer_url:
+            self.trailer = trailer_url[0]
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,&quot;&gt;Kraj:&lt;/span&gt;\n&quot;,'&lt;/div&gt;')
-		self.country = string.replace(self.country, &quot;   &quot;, '')
+    def get_country(self):
+        self.country = gutils.trim(self.page,&quot;&gt;Kraj:&lt;/span&gt;\n&quot;,'&lt;/div&gt;')
+        self.country = string.replace(self.country, &quot;   &quot;, '')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '&gt;Ocena:&lt;/span&gt;','/10&lt;/span&gt;')
-		self.rating = gutils.after(self.rating, 'bold&quot;&gt;')
-		if self.rating:
-			self.rating = str(float(gutils.clean(self.rating)))
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '&gt;Ocena:&lt;/span&gt;','/10&lt;/span&gt;')
+        self.rating = gutils.after(self.rating, 'bold&quot;&gt;')
+        if self.rating:
+            self.rating = str(float(gutils.clean(self.rating)))
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode = 'utf-8'
-		self.original_url_search	= '<A HREF="http://fdb.pl/szukaj.php?t=f&amp;s=">http://fdb.pl/szukaj.php?t=f&amp;s=</A>'
-		self.translated_url_search	= '<A HREF="http://fdb.pl/szukaj.php?t=f&amp;s=">http://fdb.pl/szukaj.php?t=f&amp;s=</A>'
+    def __init__(self):
+        self.encode = 'utf-8'
+        self.original_url_search    = '<A HREF="http://fdb.pl/szukaj.php?t=f&amp;s=">http://fdb.pl/szukaj.php?t=f&amp;s=</A>'
+        self.translated_url_search    = '<A HREF="http://fdb.pl/szukaj.php?t=f&amp;s=">http://fdb.pl/szukaj.php?t=f&amp;s=</A>'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		tmp = string.find(self.page,'&lt;div&gt;Wyniki wyszukiwania dla')
-		if tmp == -1:		# already a movie page
-			self.page = ''
-		else:			# multiple matches
-			self.page = gutils.before(self.page[tmp:],'&lt;div id=&quot;mapaSerwisu&quot;&gt;');
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        tmp = string.find(self.page,'&lt;div&gt;Wyniki wyszukiwania dla')
+        if tmp == -1:        # already a movie page
+            self.page = ''
+        else:            # multiple matches
+            self.page = gutils.before(self.page[tmp:],'&lt;div id=&quot;mapaSerwisu&quot;&gt;');
+        return self.page
 
-	def get_searches(self):
-		if self.page == '':	# movie page already
-			self.number_results = 1
-			self.ids.append(self.url)
-			self.titles.append(self.title)
-		else:			# multiple matches
-			elements = string.split(self.page,'&lt;div class=&quot;searchItem&quot;&gt;')
-			if len(elements)&gt;0:
-				for element in elements:
-					tmpId = gutils.trim(element, '&lt;a href=&quot;', '&quot;')
-					if tmpId.endswith('dodajNowy.php'):
-						continue
-					self.ids.append(tmpId)
-					element = gutils.strip_tags(
-						gutils.trim(element, '&quot;&gt;', '&lt;/div&gt;'))
-					element = element.replace(&quot;\n&quot;, '')
-					element = element.replace('   ', '')
-					element = element.replace('aka ', ' aka ')
-					element = element.replace(' - Oryginalny', '')
-					self.titles.append(element)
-			else:
-				self.number_results = 0
+    def get_searches(self):
+        if self.page == '':    # movie page already
+            self.number_results = 1
+            self.ids.append(self.url)
+            self.titles.append(self.title)
+        else:            # multiple matches
+            elements = string.split(self.page,'&lt;div class=&quot;searchItem&quot;&gt;')
+            if len(elements)&gt;0:
+                for element in elements:
+                    tmpId = gutils.trim(element, '&lt;a href=&quot;', '&quot;')
+                    if tmpId.endswith('dodajNowy.php'):
+                        continue
+                    self.ids.append(tmpId)
+                    element = gutils.strip_tags(
+                        gutils.trim(element, '&quot;&gt;', '&lt;/div&gt;'))
+                    element = element.replace(&quot;\n&quot;, '')
+                    element = element.replace('   ', '')
+                    element = element.replace('aka ', ' aka ')
+                    element = element.replace(' - Oryginalny', '')
+                    self.titles.append(element)
+            else:
+                self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -26,132 +26,132 @@
 import movie
 import string
 
-plugin_name		= 'FilmAffinity'
-plugin_description	= 'Base de Datos de Peliculas'
-plugin_url		= 'www.filmaffinity.com'
-plugin_language		= _('Spanish')
-plugin_author		= 'Pedro D. S&#225;nchez'
-plugin_author_email	= '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
-plugin_version		= '0.2'
+plugin_name        = 'FilmAffinity'
+plugin_description    = 'Base de Datos de Peliculas'
+plugin_url        = 'www.filmaffinity.com'
+plugin_language        = _('Spanish')
+plugin_author        = 'Pedro D. S&#225;nchez'
+plugin_author_email    = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
+plugin_version        = '0.2'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-15'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.filmaffinity.com/es/film%s.html">http://www.filmaffinity.com/es/film%s.html</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-15'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.filmaffinity.com/es/film%s.html">http://www.filmaffinity.com/es/film%s.html</A>&quot; % str(self.movie_id)
 
-	def get_image(self):
-		tmp = string.find(self.page, '&lt;img src=&quot;<A HREF="http://www.filmaffinity.com/imgs/movies/">http://www.filmaffinity.com/imgs/movies/</A>')
-		if tmp == -1:
-			self.image_url = ''
-		else:
-			self.image_url = gutils.trim(self.page[tmp-1:], 'src=&quot;', '&quot;')
+    def get_image(self):
+        tmp = string.find(self.page, '&lt;img src=&quot;<A HREF="http://www.filmaffinity.com/imgs/movies/">http://www.filmaffinity.com/imgs/movies/</A>')
+        if tmp == -1:
+            self.image_url = ''
+        else:
+            self.image_url = gutils.trim(self.page[tmp-1:], 'src=&quot;', '&quot;')
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;b&gt;TITULO ORIGINAL&lt;/b&gt;&lt;/td&gt;', '&lt;/b&gt;&lt;/td&gt;')
-		self.o_title = gutils.after(self.o_title, '&lt;b&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;b&gt;TITULO ORIGINAL&lt;/b&gt;&lt;/td&gt;', '&lt;/b&gt;&lt;/td&gt;')
+        self.o_title = gutils.after(self.o_title, '&lt;b&gt;')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;img src=&quot;<A HREF="http://www.filmaffinity.com/images/movie.gif">http://www.filmaffinity.com/images/movie.gif</A>&quot; border=&quot;0&quot;&gt; ', '&lt;/span&gt;')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;img src=&quot;<A HREF="http://www.filmaffinity.com/images/movie.gif">http://www.filmaffinity.com/images/movie.gif</A>&quot; border=&quot;0&quot;&gt; ', '&lt;/span&gt;')
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,'&lt;b&gt;DIRECTOR&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page,'&lt;b&gt;DIRECTOR&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '&lt;b&gt;G&#201;NERO Y CR&#205;TICA&lt;/b&gt;', '&lt;br /&gt;')
-		if self.plot == '':
-			self.plot = gutils.trim(self.page, '&lt;b&gt;G&Eacute;NERO Y CR&Iacute;TICA&lt;/b&gt;', '&lt;br /&gt;')
-		self.plot = gutils.after(self.plot, '&lt;td valign=&quot;top&quot;&gt;')
-		self.plot = gutils.after(self.plot, '/')
-		self.plot = string.replace(self.plot, ' SINOPSIS: ', '')
-		self.plot = string.replace(self.plot, ' SINOPSIS:', '')
-		self.plot = string.replace(self.plot, 'SINOPSIS: ', '')
-		self.plot = string.replace(self.plot, 'SINOPSIS:', '')
-		self.plot = string.replace(self.plot, ' (FILMAFFINITY)', '')
-		self.plot = string.replace(self.plot, '(FILMAFFINITY)', '')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '&lt;b&gt;G&#201;NERO Y CR&#205;TICA&lt;/b&gt;', '&lt;br /&gt;')
+        if self.plot == '':
+            self.plot = gutils.trim(self.page, '&lt;b&gt;G&Eacute;NERO Y CR&Iacute;TICA&lt;/b&gt;', '&lt;br /&gt;')
+        self.plot = gutils.after(self.plot, '&lt;td valign=&quot;top&quot;&gt;')
+        self.plot = gutils.after(self.plot, '/')
+        self.plot = string.replace(self.plot, ' SINOPSIS: ', '')
+        self.plot = string.replace(self.plot, ' SINOPSIS:', '')
+        self.plot = string.replace(self.plot, 'SINOPSIS: ', '')
+        self.plot = string.replace(self.plot, 'SINOPSIS:', '')
+        self.plot = string.replace(self.plot, ' (FILMAFFINITY)', '')
+        self.plot = string.replace(self.plot, '(FILMAFFINITY)', '')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&lt;b&gt;A&#209;O&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
-		self.year = gutils.after(self.year, '&lt;td &gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&lt;b&gt;A&#209;O&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
+        self.year = gutils.after(self.year, '&lt;td &gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, '&lt;b&gt;DURACI&#211;N&lt;/b&gt;&lt;/td&gt;', ' min.&lt;/td&gt;')
-		if self.runtime == '':
-			self.runtime = gutils.trim(self.page, '&lt;b&gt;DURACI&Oacute;N&lt;/b&gt;&lt;/td&gt;', ' min.&lt;/td&gt;')
-		self.runtime = gutils.after(self.runtime[-10:], '&lt;td&gt;')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, '&lt;b&gt;DURACI&#211;N&lt;/b&gt;&lt;/td&gt;', ' min.&lt;/td&gt;')
+        if self.runtime == '':
+            self.runtime = gutils.trim(self.page, '&lt;b&gt;DURACI&Oacute;N&lt;/b&gt;&lt;/td&gt;', ' min.&lt;/td&gt;')
+        self.runtime = gutils.after(self.runtime[-10:], '&lt;td&gt;')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '&lt;b&gt;G&#201;NERO Y CR&#205;TICA&lt;/b&gt;', '&lt;br /&gt;')
-		if self.genre == '':
-			self.genre = gutils.trim(self.page, '&lt;b&gt;G&Eacute;NERO Y CR&Iacute;TICA&lt;/b&gt;', '&lt;br /&gt;')
-		self.genre = gutils.trim(self.genre, '&lt;td valign=&quot;top&quot;&gt;', '/')
-		self.genre = string.replace(self.genre, '.', &quot; /&quot;)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, '&lt;b&gt;G&#201;NERO Y CR&#205;TICA&lt;/b&gt;', '&lt;br /&gt;')
+        if self.genre == '':
+            self.genre = gutils.trim(self.page, '&lt;b&gt;G&Eacute;NERO Y CR&Iacute;TICA&lt;/b&gt;', '&lt;br /&gt;')
+        self.genre = gutils.trim(self.genre, '&lt;td valign=&quot;top&quot;&gt;', '/')
+        self.genre = string.replace(self.genre, '.', &quot; /&quot;)
 
-	def get_cast(self):
-		self.cast = ''
-		self.cast = gutils.trim(self.page, '&lt;b&gt;REPARTO&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
-		self.cast = string.replace(self.cast, '&lt;/a&gt;,', '\n')
-		self.cast = string.strip(gutils.strip_tags(self.cast))
-		self.cast = string.replace(self.cast, '  ', '')
+    def get_cast(self):
+        self.cast = ''
+        self.cast = gutils.trim(self.page, '&lt;b&gt;REPARTO&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
+        self.cast = string.replace(self.cast, '&lt;/a&gt;,', '\n')
+        self.cast = string.strip(gutils.strip_tags(self.cast))
+        self.cast = string.replace(self.cast, '  ', '')
 
-	def get_classification(self):
-		self.classification = ''
+    def get_classification(self):
+        self.classification = ''
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page, '&lt;b&gt;PRODUCTORA&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
-		self.studio = gutils.after(self.studio, '&lt;td  &gt;')
+    def get_studio(self):
+        self.studio = gutils.trim(self.page, '&lt;b&gt;PRODUCTORA&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
+        self.studio = gutils.after(self.studio, '&lt;td  &gt;')
 
-	def get_o_site(self):
-		self.o_site = gutils.trim(self.page, '&lt;b&gt;WEB OFICIAL&lt;/b&gt;&lt;/td&gt;', '&lt;/a&gt;')
-		self.o_site = gutils.after(self.o_site, '&quot;&gt;')
+    def get_o_site(self):
+        self.o_site = gutils.trim(self.page, '&lt;b&gt;WEB OFICIAL&lt;/b&gt;&lt;/td&gt;', '&lt;/a&gt;')
+        self.o_site = gutils.after(self.o_site, '&quot;&gt;')
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://www.filmaffinity.com/es/film%s.html">http://www.filmaffinity.com/es/film%s.html</A>&quot; % str(self.movie_id)
+    def get_site(self):
+        self.site = &quot;<A HREF="http://www.filmaffinity.com/es/film%s.html">http://www.filmaffinity.com/es/film%s.html</A>&quot; % str(self.movie_id)
 
-	def get_trailer(self):
-		self.trailer = ''
+    def get_trailer(self):
+        self.trailer = ''
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, '&lt;b&gt;PA&#205;S&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
-		self.country = gutils.trim(self.country, 'alt=&quot;', '&quot;')
+    def get_country(self):
+        self.country = gutils.trim(self.page, '&lt;b&gt;PA&#205;S&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
+        self.country = gutils.trim(self.country, 'alt=&quot;', '&quot;')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '&lt;tr&gt;&lt;td align=&quot;center&quot; style=&quot;color:#990000; font-size:22px; font-weight: bold;&quot;&gt;', '&lt;/td&gt;&lt;/tr&gt;')
-		if self.rating:
-			self.rating = str(float(gutils.clean(string.replace(self.rating, ',', '.'))))
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '&lt;tr&gt;&lt;td align=&quot;center&quot; style=&quot;color:#990000; font-size:22px; font-weight: bold;&quot;&gt;', '&lt;/td&gt;&lt;/tr&gt;')
+        if self.rating:
+            self.rating = str(float(gutils.clean(string.replace(self.rating, ',', '.'))))
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search	= '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
-		self.translated_url_search	= '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
-		self.encode = 'iso-8859-15'
+    def __init__(self):
+        self.original_url_search    = '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
+        self.translated_url_search    = '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
+        self.encode = 'iso-8859-15'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		auxPage = self.page
-		self.sub_search()
-		if self.page &lt;&gt; '':
-			return self.page
-		auxPage = gutils.trim(auxPage, '&lt;b&gt;TU CR&#205;TICA&lt;/b&gt;&lt;/div&gt;', '&lt;/a&gt;')
-		self.page = gutils.trim(auxPage, 'movie_id=', '&quot;&gt;')
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        auxPage = self.page
+        self.sub_search()
+        if self.page &lt;&gt; '':
+            return self.page
+        auxPage = gutils.trim(auxPage, '&lt;b&gt;TU CR&#205;TICA&lt;/b&gt;&lt;/div&gt;', '&lt;/a&gt;')
+        self.page = gutils.trim(auxPage, 'movie_id=', '&quot;&gt;')
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page, 'Resultados por t&#237;tulo&lt;/span&gt;', '&lt;br&gt;')
-		#self.page = gutils.after(self.page, '&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;b&gt;')
-		#self.page = self.page.decode('iso-8859-15')
+    def sub_search(self):
+        self.page = gutils.trim(self.page, 'Resultados por t&#237;tulo&lt;/span&gt;', '&lt;br&gt;')
+        #self.page = gutils.after(self.page, '&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;b&gt;')
+        #self.page = self.page.decode('iso-8859-15')
 
-	def get_searches(self):
-		if len(self.page) &lt; 20:	# immidietly redirection to movie page
-			self.number_results = 1
-			self.ids.append(self.page)
-			self.titles.append(self.url)
-		else:			# multiple matches
-			elements = string.split(self.page, '&lt;/a&gt;&lt;/b&gt;')
+    def get_searches(self):
+        if len(self.page) &lt; 20:    # immidietly redirection to movie page
+            self.number_results = 1
+            self.ids.append(self.page)
+            self.titles.append(self.url)
+        else:            # multiple matches
+            elements = string.split(self.page, '&lt;/a&gt;&lt;/b&gt;')
 
-			if (elements[0]&lt;&gt;''):
-				for element in elements[:-1]:
-					self.ids.append(gutils.trim(element, '&lt;b&gt;&lt;a href=&quot;/es/film','.html'))
-					title = gutils.after(element, '&lt;b&gt;&lt;a href=&quot;/es/film')
-					self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.after(title, '&gt;'))))
+            if (elements[0]&lt;&gt;''):
+                for element in elements[:-1]:
+                    self.ids.append(gutils.trim(element, '&lt;b&gt;&lt;a href=&quot;/es/film','.html'))
+                    title = gutils.after(element, '&lt;b&gt;&lt;a href=&quot;/es/film')
+                    self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.after(title, '&gt;'))))

Modified: trunk/lib/plugins/movie/PluginMovieFilmDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmDb.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieFilmDb.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -26,120 +26,120 @@
 import movie
 import string
 
-plugin_name		= 'FilmDb.de'
-plugin_description	= 'FILMDB.DE'
-plugin_url		= 'www.filmdb.de'
-plugin_language		= _('German')
-plugin_author		= 'Michael Jahn'
-plugin_author_email	= '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;'
-plugin_version		= '1.0'
+plugin_name        = 'FilmDb.de'
+plugin_description    = 'FILMDB.DE'
+plugin_url        = 'www.filmdb.de'
+plugin_language        = _('German')
+plugin_author        = 'Michael Jahn'
+plugin_author_email    = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;'
+plugin_version        = '1.0'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.filmdb.de/filmanzeige.php?alle=1&amp;filmid=">http://www.filmdb.de/filmanzeige.php?alle=1&amp;filmid=</A>&quot; + self.movie_id
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.filmdb.de/filmanzeige.php?alle=1&amp;filmid=">http://www.filmdb.de/filmanzeige.php?alle=1&amp;filmid=</A>&quot; + self.movie_id
 
-	def initialize(self):
-		self.tmp_page = gutils.trim(self.page, &quot;&lt;h1&gt;Filmdatenbank - &quot;, &quot;Kommentare&lt;/a&gt;&quot;)
-	
-	def get_image(self):
-		self.image_url = gutils.trim(self.tmp_page, '&lt;td background=&quot;', '&quot;');
+    def initialize(self):
+        self.tmp_page = gutils.trim(self.page, &quot;&lt;h1&gt;Filmdatenbank - &quot;, &quot;Kommentare&lt;/a&gt;&quot;)
+    
+    def get_image(self):
+        self.image_url = gutils.trim(self.tmp_page, '&lt;td background=&quot;', '&quot;');
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;h1&gt;Filmdatenbank - ', '&lt;/h1&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;h1&gt;Filmdatenbank - ', '&lt;/h1&gt;')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;h1&gt;Filmdatenbank - ', '&lt;/h1&gt;')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;h1&gt;Filmdatenbank - ', '&lt;/h1&gt;')
 
-	def get_director(self):
-		self.director = gutils.after(gutils.trim(self.tmp_page, 'regisseursuche.php', '&lt;/a&gt;'), '&gt;')
+    def get_director(self):
+        self.director = gutils.after(gutils.trim(self.tmp_page, 'regisseursuche.php', '&lt;/a&gt;'), '&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.tmp_page, '&gt;Inhalt&lt;/strong&gt;', '&lt;td width=&quot;150&quot; valign=&quot;top&quot;&gt;')
-		self.plot = self.plot.replace('\t', '')
-		self.plot = self.plot.replace('\n', '')
-		self.plot = self.plot.replace('&#132;', '&quot;')
-		self.plot = self.plot.replace('&#147;', '&quot;')
+    def get_plot(self):
+        self.plot = gutils.trim(self.tmp_page, '&gt;Inhalt&lt;/strong&gt;', '&lt;td width=&quot;150&quot; valign=&quot;top&quot;&gt;')
+        self.plot = self.plot.replace('\t', '')
+        self.plot = self.plot.replace('\n', '')
+        self.plot = self.plot.replace('&#132;', '&quot;')
+        self.plot = self.plot.replace('&#147;', '&quot;')
 
-	def get_year(self):
-		elements = string.split(self.tmp_page, 'landjahrsuche.php')
-		self.year = gutils.trim(elements[2], '&gt;', '&lt;/a&gt;') + '\n'
+    def get_year(self):
+        elements = string.split(self.tmp_page, 'landjahrsuche.php')
+        self.year = gutils.trim(elements[2], '&gt;', '&lt;/a&gt;') + '\n'
 
-	def get_runtime(self):
-		self.runtime = &quot;&quot;
-		tmp = gutils.trim(self.tmp_page, '&lt;/a&gt;  &#150; ', ' Stunden')
-		if tmp &lt;&gt; '':
-			elements = string.split(tmp, ':')
-			try:
-				hours = int(elements[0])
-				mins = int(elements[1])
-				self.runtime = str(hours * 60 + mins)
-			except:
-				self.runtime = &quot;&quot;
+    def get_runtime(self):
+        self.runtime = &quot;&quot;
+        tmp = gutils.trim(self.tmp_page, '&lt;/a&gt;  &#150; ', ' Stunden')
+        if tmp &lt;&gt; '':
+            elements = string.split(tmp, ':')
+            try:
+                hours = int(elements[0])
+                mins = int(elements[1])
+                self.runtime = str(hours * 60 + mins)
+            except:
+                self.runtime = &quot;&quot;
 
-	def get_genre(self):
-		self.genre = gutils.after(gutils.trim(self.tmp_page, 'genresuche.php', '&lt;/a&gt;'), '&gt;')
+    def get_genre(self):
+        self.genre = gutils.after(gutils.trim(self.tmp_page, 'genresuche.php', '&lt;/a&gt;'), '&gt;')
 
-	def get_cast(self):
-		self.cast = &quot;&quot;
-		elements = string.split(self.tmp_page, 'schauspielersuche.php')
-		elements[0] = ''
-		for element in elements:
-			if element &lt;&gt; '':
-				self.cast = self.cast + gutils.trim(element, '&gt;', '&lt;/a&gt;') + '\n'
+    def get_cast(self):
+        self.cast = &quot;&quot;
+        elements = string.split(self.tmp_page, 'schauspielersuche.php')
+        elements[0] = ''
+        for element in elements:
+            if element &lt;&gt; '':
+                self.cast = self.cast + gutils.trim(element, '&gt;', '&lt;/a&gt;') + '\n'
 
-	def get_classification(self):
-		self.classification = &quot;&quot;
+    def get_classification(self):
+        self.classification = &quot;&quot;
 
-	def get_studio(self):
-		self.studio = &quot;&quot;
+    def get_studio(self):
+        self.studio = &quot;&quot;
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://www.filmdb.de/filmanzeige.php?filmid=">http://www.filmdb.de/filmanzeige.php?filmid=</A>&quot; + self.movie_id
+    def get_site(self):
+        self.site = &quot;<A HREF="http://www.filmdb.de/filmanzeige.php?filmid=">http://www.filmdb.de/filmanzeige.php?filmid=</A>&quot; + self.movie_id
 
-	def get_trailer(self):
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		elements = string.split(self.tmp_page, 'landjahrsuche.php')
-		self.country = gutils.trim(elements[1], '&gt;', '&lt;/a&gt;') + '\n'
+    def get_country(self):
+        elements = string.split(self.tmp_page, 'landjahrsuche.php')
+        self.country = gutils.trim(elements[1], '&gt;', '&lt;/a&gt;') + '\n'
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.tmp_page, 'Unsere User haben diesen Film mit ', ' bewertet.')
-		self.rating = self.rating.replace('%', '')
-		self.rating = gutils.strip_tags(self.rating)
-		elements = self.rating.split('.')
-		try:
-			tmprating = int(elements[0])
-			self.rating = str(tmprating / 10)
-		except:
-			self.rating = '0'
+    def get_rating(self):
+        self.rating = gutils.trim(self.tmp_page, 'Unsere User haben diesen Film mit ', ' bewertet.')
+        self.rating = self.rating.replace('%', '')
+        self.rating = gutils.strip_tags(self.rating)
+        elements = self.rating.split('.')
+        try:
+            tmprating = int(elements[0])
+            self.rating = str(tmprating / 10)
+        except:
+            self.rating = '0'
 
-	def get_notes(self):
-		self.notes = &quot;&quot;
+    def get_notes(self):
+        self.notes = &quot;&quot;
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search   = &quot;<A HREF="http://www.filmdb.de/globalsuche.php?name=">http://www.filmdb.de/globalsuche.php?name=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.filmdb.de/globalsuche.php?name=">http://www.filmdb.de/globalsuche.php?name=</A>&quot;
-		self.encode='iso-8859-1'
+    def __init__(self):
+        self.original_url_search   = &quot;<A HREF="http://www.filmdb.de/globalsuche.php?name=">http://www.filmdb.de/globalsuche.php?name=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.filmdb.de/globalsuche.php?name=">http://www.filmdb.de/globalsuche.php?name=</A>&quot;
+        self.encode='iso-8859-1'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		return gutils.trim(self.page, &quot;&lt;span class=font_normal&gt;&quot;, &quot;&lt;table width=590&quot;)
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        return gutils.trim(self.page, &quot;&lt;span class=font_normal&gt;&quot;, &quot;&lt;table width=590&quot;)
 
-	def get_searches(self):
-		elements = string.split(self.page, &quot;&lt;!--&quot;)
-		elements[0] = ''
-		for element in elements:
-			if element &lt;&gt; '':
-				self.ids.append(gutils.trim(element, &quot;filmid=&quot;, &quot;&gt;&quot;))
-				self.titles.append(gutils.trim(
-					gutils.after(element, &quot;filmid=&quot;), &quot;&gt;&quot;, &quot;&lt;&quot;) + &quot; - &quot; +
-					gutils.trim(gutils.after(element, &quot;&lt;/a&gt;&quot;), &quot;&lt;td&gt;&quot;, &quot;&lt;/td&gt;&quot;) + &quot; - &quot; +
-					gutils.trim(gutils.after(gutils.after(element, &quot;&lt;td&gt;&quot;), &quot;&lt;td&gt;&quot;), &quot;&lt;td&gt;&quot;, &quot;&lt;/td&gt;&quot;))
+    def get_searches(self):
+        elements = string.split(self.page, &quot;&lt;!--&quot;)
+        elements[0] = ''
+        for element in elements:
+            if element &lt;&gt; '':
+                self.ids.append(gutils.trim(element, &quot;filmid=&quot;, &quot;&gt;&quot;))
+                self.titles.append(gutils.trim(
+                    gutils.after(element, &quot;filmid=&quot;), &quot;&gt;&quot;, &quot;&lt;&quot;) + &quot; - &quot; +
+                    gutils.trim(gutils.after(element, &quot;&lt;/a&gt;&quot;), &quot;&lt;td&gt;&quot;, &quot;&lt;/td&gt;&quot;) + &quot; - &quot; +
+                    gutils.trim(gutils.after(gutils.after(element, &quot;&lt;td&gt;&quot;), &quot;&lt;td&gt;&quot;), &quot;&lt;td&gt;&quot;, &quot;&lt;/td&gt;&quot;))

Modified: trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -36,190 +36,190 @@
 plugin_version = &quot;1.3&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='utf-8'
-		self.movie_id = id
-		self.url = '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>' + str(self.movie_id)
+    def __init__(self, id):
+        self.encode='utf-8'
+        self.movie_id = id
+        self.url = '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>' + str(self.movie_id)
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page, 'ProductCover=', '&quot;')
-		if not self.image_url == '':
-			self.image_url = &quot;<A HREF="http://www.filmevona-z.de/">http://www.filmevona-z.de/</A>&quot; + self.image_url
+    def get_image(self):
+        self.image_url = gutils.trim(self.page, 'ProductCover=', '&quot;')
+        if not self.image_url == '':
+            self.image_url = &quot;<A HREF="http://www.filmevona-z.de/">http://www.filmevona-z.de/</A>&quot; + self.image_url
 
-	def get_o_title(self):
-		self.o_title = string.capwords(
-			gutils.clean(gutils.after(
-			self.regextrim(self.page, '&quot;[ \t]+class=&quot;text_ergebniss_titel&quot;', '[ \t]+[(]Originaltitel[)]'), '&lt;/a&gt;')))
-		if self.o_title == '':
-			self.o_title = gutils.after(gutils.trim(self.page, 'sucheNach=titel', '&lt;/a&gt;'), '&gt;')
+    def get_o_title(self):
+        self.o_title = string.capwords(
+            gutils.clean(gutils.after(
+            self.regextrim(self.page, '&quot;[ \t]+class=&quot;text_ergebniss_titel&quot;', '[ \t]+[(]Originaltitel[)]'), '&lt;/a&gt;')))
+        if self.o_title == '':
+            self.o_title = gutils.after(gutils.trim(self.page, 'sucheNach=titel', '&lt;/a&gt;'), '&gt;')
 
-	def get_title(self):
-		self.title = gutils.after(gutils.trim(self.page, 'sucheNach=titel', '&lt;/a&gt;'), '&gt;')
+    def get_title(self):
+        self.title = gutils.after(gutils.trim(self.page, 'sucheNach=titel', '&lt;/a&gt;'), '&gt;')
 
-	def get_director(self):
-		self.director = gutils.after(gutils.trim(self.page, '(Regie)', '&lt;/a&gt;'), '&gt;')
+    def get_director(self):
+        self.director = gutils.after(gutils.trim(self.page, '(Regie)', '&lt;/a&gt;'), '&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.after(self.regextrim(self.page, '[(]Darsteller[)]', '&lt;/[pP]&gt;'), '&lt;p&gt;')
+    def get_plot(self):
+        self.plot = gutils.after(self.regextrim(self.page, '[(]Darsteller[)]', '&lt;/[pP]&gt;'), '&lt;p&gt;')
 
-	def get_year(self):
-		self.year = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsjahr', '&lt;/a&gt;'), '&gt;')
+    def get_year(self):
+        self.year = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsjahr', '&lt;/a&gt;'), '&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, 'L&auml;nge: ', ' Minuten')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, 'L&auml;nge: ', ' Minuten')
 
-	def get_genre(self):
-		elements = string.split(self.page, 'sucheNach=genre')
-		if (elements[0]&lt;&gt;''):
-			elements[0] = ''
-			self.delimiter = ''
-			self.genre = ''
-			for element in elements:
-				if (element &lt;&gt; ''):
-					self.genre += self.delimiter + gutils.trim(element, '&gt;', '&lt;/a&gt;')
-					self.delimiter = &quot;, &quot;
+    def get_genre(self):
+        elements = string.split(self.page, 'sucheNach=genre')
+        if (elements[0]&lt;&gt;''):
+            elements[0] = ''
+            self.delimiter = ''
+            self.genre = ''
+            for element in elements:
+                if (element &lt;&gt; ''):
+                    self.genre += self.delimiter + gutils.trim(element, '&gt;', '&lt;/a&gt;')
+                    self.delimiter = &quot;, &quot;
 
-	def get_cast(self):
-		self.cast = self.regextrim(self.page, '[(]Darsteller[)]', '&lt;[pP]&gt;')
-		self.cast = gutils.clean(self.cast)
-		self.cast = self.cast.replace(' als ', _(' as '))
-		self.cast = re.sub('( \t|\t|\r|\n)', '', self.cast)
-		self.cast = self.cast.replace(', ', '\n')
-		self.cast = self.cast.replace(',', '')
+    def get_cast(self):
+        self.cast = self.regextrim(self.page, '[(]Darsteller[)]', '&lt;[pP]&gt;')
+        self.cast = gutils.clean(self.cast)
+        self.cast = self.cast.replace(' als ', _(' as '))
+        self.cast = re.sub('( \t|\t|\r|\n)', '', self.cast)
+        self.cast = self.cast.replace(', ', '\n')
+        self.cast = self.cast.replace(',', '')
 
-	def get_classification(self):
-		self.classification = self.regextrim(self.page, 'FSK:[ ]+', '[,;]')
+    def get_classification(self):
+        self.classification = self.regextrim(self.page, 'FSK:[ ]+', '[,;]')
 
-	def get_studio(self):
-		self.studio = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsfirma', '&lt;/a&gt;'), '&gt;')
+    def get_studio(self):
+        self.studio = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsfirma', '&lt;/a&gt;'), '&gt;')
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>' + self.movie_id;
+    def get_site(self):
+        self.site = '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>' + self.movie_id;
 
-	def get_trailer(self):
-		self.trailer = ''
+    def get_trailer(self):
+        self.trailer = ''
 
-	def get_country(self):
-		self.country = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsland', '&lt;/a&gt;'), '&gt;')
+    def get_country(self):
+        self.country = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsland', '&lt;/a&gt;'), '&gt;')
 
-	def get_rating(self):
-		self.rating = 0
-		
-	def regextrim(self,text,key1,key2):
-		obj = re.search(key1, text)
-		if obj is None:
-			return ''
-		else:
-			p1 = obj.end()
-		obj = re.search(key2, text[p1:])
-		if obj is None:
-			return ''
-		else:
-			p2 = p1 + obj.start()
-		return text[p1:p2]
+    def get_rating(self):
+        self.rating = 0
+        
+    def regextrim(self,text,key1,key2):
+        obj = re.search(key1, text)
+        if obj is None:
+            return ''
+        else:
+            p1 = obj.end()
+        obj = re.search(key2, text[p1:])
+        if obj is None:
+            return ''
+        else:
+            p2 = p1 + obj.start()
+        return text[p1:p2]
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.original_url_search	= &quot;<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>&quot;
-		self.translated_url_search	= &quot;<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>&quot;
-		self.encode='utf-8'
+    def __init__(self):
+        self.original_url_search    = &quot;<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>&quot;
+        self.translated_url_search    = &quot;<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=</A>&quot;
+        self.encode='utf-8'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		# used for looking for subpages
-		tmp_page = gutils.trim(self.page, &quot;Treffer-Seite&quot;, &quot;chste Seite&quot;)
-		elements = string.split(tmp_page, '&quot; class=&quot;text_navi&quot;&gt;')
-		# first results
-		tmp_page = gutils.after(gutils.trim(self.page,&quot;Alle Treffer aus der Kategorie&quot;, &quot;Treffer-Seite&quot;), &quot;Titel:&quot;)
-		# look for subpages
-		for element in elements:
-			element = gutils.before(element, &quot;&lt;/a&gt;&quot;)
-			try:
-				tmp_element = int(element)
-			except:
-				tmp_element = 1
-			if (tmp_element &lt;&gt; 1):
-				self.url = &quot;<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;currentPage=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;currentPage=</A>&quot; + str(tmp_element) + &quot;&amp;wert=&quot;
-				self.open_search(parent_window)
-				tmp_page2 = gutils.trim(self.page,&quot;Alle Treffer aus der Kategorie&quot;, &quot;Treffer-Seite&quot;)
-				tmp_page = tmp_page + tmp_page2
-		self.page = tmp_page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        # used for looking for subpages
+        tmp_page = gutils.trim(self.page, &quot;Treffer-Seite&quot;, &quot;chste Seite&quot;)
+        elements = string.split(tmp_page, '&quot; class=&quot;text_navi&quot;&gt;')
+        # first results
+        tmp_page = gutils.after(gutils.trim(self.page,&quot;Alle Treffer aus der Kategorie&quot;, &quot;Treffer-Seite&quot;), &quot;Titel:&quot;)
+        # look for subpages
+        for element in elements:
+            element = gutils.before(element, &quot;&lt;/a&gt;&quot;)
+            try:
+                tmp_element = int(element)
+            except:
+                tmp_element = 1
+            if (tmp_element &lt;&gt; 1):
+                self.url = &quot;<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;currentPage=">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;currentPage=</A>&quot; + str(tmp_element) + &quot;&amp;wert=&quot;
+                self.open_search(parent_window)
+                tmp_page2 = gutils.trim(self.page,&quot;Alle Treffer aus der Kategorie&quot;, &quot;Treffer-Seite&quot;)
+                tmp_page = tmp_page + tmp_page2
+        self.page = tmp_page
 
-		return self.page
+        return self.page
 
-	def get_searches(self):
-		elements = string.split(self.page,'class=&quot;text_ergebniss_titel&quot;')
-		i = 0
-		while i &lt; len(elements) - 1:
-			id_part = elements[i]
-			i = i + 1
-			text_part = elements[i]
-			i = i + 1
-			self.ids.append(gutils.trim(id_part, 'filmsuche.cfm?wert=', '&amp;'))
-			self.titles.append(gutils.strip_tags(
-						gutils.trim(text_part, '&gt;', '&lt;/a&gt;') + ' (' +
-						string.capwords(gutils.trim(text_part, '&lt;/a&gt;', '(Originaltitel)')) + ', ' +
-						gutils.after(gutils.trim(text_part, 'sucheNach=produktionsland', '&lt;/a&gt;'), '&gt;') + ', ' +
-						gutils.after(gutils.trim(text_part, 'sucheNach=produktionsjahr', '&lt;/a&gt;'), '&gt;') +
-						')'))
+    def get_searches(self):
+        elements = string.split(self.page,'class=&quot;text_ergebniss_titel&quot;')
+        i = 0
+        while i &lt; len(elements) - 1:
+            id_part = elements[i]
+            i = i + 1
+            text_part = elements[i]
+            i = i + 1
+            self.ids.append(gutils.trim(id_part, 'filmsuche.cfm?wert=', '&amp;'))
+            self.titles.append(gutils.strip_tags(
+                        gutils.trim(text_part, '&gt;', '&lt;/a&gt;') + ' (' +
+                        string.capwords(gutils.trim(text_part, '&lt;/a&gt;', '(Originaltitel)')) + ', ' +
+                        gutils.after(gutils.trim(text_part, 'sucheNach=produktionsland', '&lt;/a&gt;'), '&gt;') + ', ' +
+                        gutils.after(gutils.trim(text_part, 'sucheNach=produktionsjahr', '&lt;/a&gt;'), '&gt;') +
+                        ')'))
 
 #
 # Plugin Test
 #
 class SearchPluginTest(SearchPlugin):
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; expected result count }
-	#
-	test_configuration = {
-		'Rocky Balboa'			: 1,
-		'Arahan'				: 1,
-		'Ein gl&#195;&#188;ckliches Jahr'	: 0
-	}
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; expected result count }
+    #
+    test_configuration = {
+        'Rocky Balboa'            : 1,
+        'Arahan'                : 1,
+        'Ein gl&#195;&#188;ckliches Jahr'    : 0
+    }
 
 class PluginTest:
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; dict { arribute -&gt; value } }
-	#
-	# value: * True/False if attribute should only be tested for any value
-	#        * or the expected value
-	#
-	test_configuration = {
-		'528267' : { 
-			'title' 			: 'Rocky Balboa',
-			'o_title' 			: 'Rocky Balboa',
-			'director'			: 'Sylvester Stallone',
-			'plot' 				: True,
-			'cast'				: 'A.J. Benza' + _(' as ') + 'L.C.\n\
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute should only be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        '528267' : { 
+            'title'             : 'Rocky Balboa',
+            'o_title'             : 'Rocky Balboa',
+            'director'            : 'Sylvester Stallone',
+            'plot'                 : True,
+            'cast'                : 'A.J. Benza' + _(' as ') + 'L.C.\n\
 Milo Ventimiglia' + _(' as ') + 'Rocky jr.\n\
 Antonio Tarver' + _(' as ') + 'Mason \'The Line\' Dixon\n\
 Geraldine Hughes' + _(' as ') + 'Marie\n\
 Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
 Burt Young' + _(' as ') + 'Paulie\n\
 Tony Burton' + _(' as ') + 'Duke',
-			'country'			: 'USA',
-			'genre'				: 'Boxerfilm',
-			'classification'	: 'ab 12',
-			'studio'			: 'Columbia Pic./ MGM/ Rogue Marble/ Revolution Studios/ Chartoff-Winkler Prod.',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=528267">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=528267</A>',
-			'trailer'			: False,
-			'year'				: 2006,
-			'notes'				: False,
-			'runtime'			: 102,
-			'image'				: False,
-			'rating'			: False
-		},
-		'26956' : { 
-			'title' 			: 'B&#195;&#188;rgschaft f&#195;&#188;r ein Jahr',
-			'o_title' 			: 'B&#195;&#188;rgschaft f&#195;&#188;r ein Jahr',
-			'director'			: 'Herrmann Zschoche',
-			'plot' 				: True,
-			'cast'				: 'Heide Kipp' + _(' as ') + 'Frau Braun\n\
+            'country'            : 'USA',
+            'genre'                : 'Boxerfilm',
+            'classification'    : 'ab 12',
+            'studio'            : 'Columbia Pic./ MGM/ Rogue Marble/ Revolution Studios/ Chartoff-Winkler Prod.',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=528267">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=528267</A>',
+            'trailer'            : False,
+            'year'                : 2006,
+            'notes'                : False,
+            'runtime'            : 102,
+            'image'                : False,
+            'rating'            : False
+        },
+        '26956' : { 
+            'title'             : 'B&#195;&#188;rgschaft f&#195;&#188;r ein Jahr',
+            'o_title'             : 'B&#195;&#188;rgschaft f&#195;&#188;r ein Jahr',
+            'director'            : 'Herrmann Zschoche',
+            'plot'                 : True,
+            'cast'                : 'Heide Kipp' + _(' as ') + 'Frau Braun\n\
 Jan Spitzer' + _(' as ') + 'Werner Horn\n\
 Monika Lennartz' + _(' as ') + 'Irmgard Behrend\n\
 Katrin Sa&#195;&#159;' + _(' as ') + 'Nina\n\
@@ -227,40 +227,40 @@
 Christian Steyer' + _(' as ') + 'Heiner Menk\n\
 Jaecki Schwarz' + _(' as ') + 'Peter M&#195;&#188;ller\n\
 Barbara Dittus' + _(' as ') + 'Heimleiterin',
-			'country'			: 'DDR',
-			'genre'				: 'Arbeiterfilm, Frauenfilm, Literaturverfilmung',
-			'classification'	: 'ab 6',
-			'studio'			: 'DEFA, Gruppe &quot;Berlin&quot;',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=26956">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=26956</A>',
-			'trailer'			: False,
-			'year'				: 1981,
-			'notes'				: False,
-			'runtime'			: 93,
-			'image'				: False,
-			'rating'			: False
-		},
-		'524017' : { 
-			'title' 			: 'Arahan',
-			'o_title' 			: 'Arahan Jangpung Daejakjeon',
-			'director'			: 'Ryoo Seung-wan',
-			'plot' 				: True,
-			'cast'				: 'Yoon So-yi' + _(' as ') + 'Wi-jin\n\
+            'country'            : 'DDR',
+            'genre'                : 'Arbeiterfilm, Frauenfilm, Literaturverfilmung',
+            'classification'    : 'ab 6',
+            'studio'            : 'DEFA, Gruppe &quot;Berlin&quot;',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=26956">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=26956</A>',
+            'trailer'            : False,
+            'year'                : 1981,
+            'notes'                : False,
+            'runtime'            : 93,
+            'image'                : False,
+            'rating'            : False
+        },
+        '524017' : { 
+            'title'             : 'Arahan',
+            'o_title'             : 'Arahan Jangpung Daejakjeon',
+            'director'            : 'Ryoo Seung-wan',
+            'plot'                 : True,
+            'cast'                : 'Yoon So-yi' + _(' as ') + 'Wi-jin\n\
 Yun Ju-sang' + _(' as ') + 'Mu-woon\n\
 Ahn Sung-kee' + _(' as ') + 'Ja-woon\n\
 Jung Doo-hong' + _(' as ') + 'Heukwoon\n\
 Ryu Seung-beom' + _(' as ') + 'Sang-hwan',
-			'country'			: 'S&#195;&#188;dkorea',
-			'genre'				: False,
-			'classification'	: 'ab 16',
-			'studio'			: 'Fun and Happiness/ Good Movie',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=524017">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=524017</A>',
-			'trailer'			: False,
-			'year'				: 2004,
-			'notes'				: False,
-			'runtime'			: 108,
-			'image'				: False,
-			'rating'			: False
-		}
-	}
+            'country'            : 'S&#195;&#188;dkorea',
+            'genre'                : False,
+            'classification'    : 'ab 16',
+            'studio'            : 'Fun and Happiness/ Good Movie',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=524017">http://www.filmevona-z.de/filmsuche.cfm?sucheNach=Titel&amp;wert=524017</A>',
+            'trailer'            : False,
+            'year'                : 2004,
+            'notes'                : False,
+            'runtime'            : 108,
+            'image'                : False,
+            'rating'            : False
+        }
+    }

Modified: trunk/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -37,115 +37,115 @@
 
 class Plugin(movie.Movie):
 
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = '<A HREF="http://www.filmtipset.se/film/">http://www.filmtipset.se/film/</A>' + str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = '<A HREF="http://www.filmtipset.se/film/">http://www.filmtipset.se/film/</A>' + str(self.movie_id)
 
-	def get_image(self):
-		self.image_url = ''
-		tmp = gutils.trim(self.page, 'src=&quot;<A HREF="http://images.filmtipset.se/posters/">http://images.filmtipset.se/posters/</A>', '&quot;')
-		if tmp != '':
-			self.image_url = '<A HREF="http://images.filmtipset.se/posters/">http://images.filmtipset.se/posters/</A>' + tmp
+    def get_image(self):
+        self.image_url = ''
+        tmp = gutils.trim(self.page, 'src=&quot;<A HREF="http://images.filmtipset.se/posters/">http://images.filmtipset.se/posters/</A>', '&quot;')
+        if tmp != '':
+            self.image_url = '<A HREF="http://images.filmtipset.se/posters/">http://images.filmtipset.se/posters/</A>' + tmp
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, 'Originaltitel:', '&lt;/tr&gt;')
-		if self.o_title == '':
-			self.o_title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, 'Originaltitel:', '&lt;/tr&gt;')
+        if self.o_title == '':
+            self.o_title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
 
-	def get_director(self):
-		self.director = gutils.trim(self.page, 'Regiss&ouml;r:', '&lt;/tr&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page, 'Regiss&ouml;r:', '&lt;/tr&gt;')
 
-	def get_plot(self):
-		self.plot = self.regextrim(self.page, '&lt;h2&gt;Om [^&gt;]*[&gt;]', '&lt;/tr&gt;')
+    def get_plot(self):
+        self.plot = self.regextrim(self.page, '&lt;h2&gt;Om [^&gt;]*[&gt;]', '&lt;/tr&gt;')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, 'Utgivnings&aring;r:', '&lt;/tr&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page, 'Utgivnings&aring;r:', '&lt;/tr&gt;')
 
-	def get_runtime(self):
-		self.runtime = string.strip(gutils.trim(self.page, 'L&auml;ngd:', ' min'))
+    def get_runtime(self):
+        self.runtime = string.strip(gutils.trim(self.page, 'L&auml;ngd:', ' min'))
 
-	def get_genre(self):
-		self.genre = string.strip(gutils.trim(self.page, 'Nyckelord:', '&lt;/tr&gt;'))
-		if self.genre == '':
-			self.genre = string.strip(gutils.trim(self.page, 'Genre:', '&lt;/tr&gt;'))
+    def get_genre(self):
+        self.genre = string.strip(gutils.trim(self.page, 'Nyckelord:', '&lt;/tr&gt;'))
+        if self.genre == '':
+            self.genre = string.strip(gutils.trim(self.page, 'Genre:', '&lt;/tr&gt;'))
 
-	def get_cast(self):
-		self.cast = self.regextrim(self.page, 'Sk&aring;despelare [^:]*[:]', '&lt;/tr&gt;')
-		self.cast = string.replace(self.cast, ', ', '\n')
+    def get_cast(self):
+        self.cast = self.regextrim(self.page, 'Sk&aring;despelare [^:]*[:]', '&lt;/tr&gt;')
+        self.cast = string.replace(self.cast, ', ', '\n')
 
-	def get_classification(self):
-		self.classification = ''
+    def get_classification(self):
+        self.classification = ''
 
-	def get_studio(self):
-		self.studio = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_o_site(self):
-		self.o_site = ''
-		tmp = gutils.trim(self.page, '<A HREF="http://www.imdb.com">http://www.imdb.com</A>', '&quot;')
-		if tmp != '':
-			self.o_site = '<A HREF="http://www.imdb.com">http://www.imdb.com</A>' + tmp
+    def get_o_site(self):
+        self.o_site = ''
+        tmp = gutils.trim(self.page, '<A HREF="http://www.imdb.com">http://www.imdb.com</A>', '&quot;')
+        if tmp != '':
+            self.o_site = '<A HREF="http://www.imdb.com">http://www.imdb.com</A>' + tmp
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		self.country = string.strip(gutils.trim(self.page, 'Produktionsland:', '&lt;/span&gt;'))
+    def get_country(self):
+        self.country = string.strip(gutils.trim(self.page, 'Produktionsland:', '&lt;/span&gt;'))
 
-	def get_rating(self):
-		self.rating = &quot;0&quot;
+    def get_rating(self):
+        self.rating = &quot;0&quot;
 
-	def get_notes(self):
-		self.notes = ''
-		tmp = gutils.trim(self.page, 'Alt. titel:', '&lt;/span&gt;')
-		if tmp != '':
-			self.notes = self.notes + 'Alt. titel:' + string.strip(gutils.strip_tags(tmp))
+    def get_notes(self):
+        self.notes = ''
+        tmp = gutils.trim(self.page, 'Alt. titel:', '&lt;/span&gt;')
+        if tmp != '':
+            self.notes = self.notes + 'Alt. titel:' + string.strip(gutils.strip_tags(tmp))
 
-	def regextrim(self,text,key1,key2):
-		obj = re.search(key1, text)
-		if obj is None:
-			return ''
-		else:
-			p1 = obj.end()
-		obj = re.search(key2, text[p1:])
-		if obj is None:
-			return ''
-		else:
-			p2 = p1 + obj.start()
-		return text[p1:p2]
+    def regextrim(self,text,key1,key2):
+        obj = re.search(key1, text)
+        if obj is None:
+            return ''
+        else:
+            p1 = obj.end()
+        obj = re.search(key2, text[p1:])
+        if obj is None:
+            return ''
+        else:
+            p2 = p1 + obj.start()
+        return text[p1:p2]
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search   = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
-		self.encode='iso-8859-1'
+    def __init__(self):
+        self.original_url_search   = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
+        self.encode='iso-8859-1'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		tmp_page = gutils.trim(self.page, 'Matchning', 'Hittade')
-		if tmp_page == '':
-			tmp_page = gutils.trim(self.page, 'Matchning', 'Visa fler')
-		self.page = tmp_page
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        tmp_page = gutils.trim(self.page, 'Matchning', 'Hittade')
+        if tmp_page == '':
+            tmp_page = gutils.trim(self.page, 'Matchning', 'Visa fler')
+        self.page = tmp_page
+        return self.page
 
-	def get_searches(self):
-		elements1 = re.split('href=&quot;film/', self.page)
-		elements1[0] = None
-		for element in elements1:
-			if element &lt;&gt; None:
-				searchResult = re.search('[&quot;&amp;?]', element)
-				if searchResult is None:
-					self.ids.append(gutils.before(element, '&quot;'))
-				else:
-					self.ids.append(element[:searchResult.end() - 1])
-				self.titles.append(
-					gutils.strip_tags(gutils.trim(element, '&gt;', '&lt;/a&gt;')) + ' / ' +
-					string.replace(gutils.trim(element, 'title=&quot;', '&quot;'), '&nbsp;', ' ')
-				)
+    def get_searches(self):
+        elements1 = re.split('href=&quot;film/', self.page)
+        elements1[0] = None
+        for element in elements1:
+            if element &lt;&gt; None:
+                searchResult = re.search('[&quot;&amp;?]', element)
+                if searchResult is None:
+                    self.ids.append(gutils.before(element, '&quot;'))
+                else:
+                    self.ids.append(element[:searchResult.end() - 1])
+                self.titles.append(
+                    gutils.strip_tags(gutils.trim(element, '&gt;', '&lt;/a&gt;')) + ' / ' +
+                    string.replace(gutils.trim(element, 'title=&quot;', '&quot;'), '&nbsp;', ' ')
+                )

Modified: trunk/lib/plugins/movie/PluginMovieFilmweb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmweb.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieFilmweb.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -25,157 +25,157 @@
 import gutils, movie
 import re,string
 
-plugin_name		= 'Filmweb'
-plugin_description	= 'Web pe&#197;&#130;en film&#195;&#179;w'
-plugin_url		= 'www.filmweb.pl'
-plugin_language		= _('Polish')
-plugin_author		= 'Piotr O&#197;&#188;arowski'
-plugin_author_email	= '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">ozarow+griffith at gmail.com</A>&gt;'
-plugin_version		= '1.12'
+plugin_name        = 'Filmweb'
+plugin_description    = 'Web pe&#197;&#130;en film&#195;&#179;w'
+plugin_url        = 'www.filmweb.pl'
+plugin_language        = _('Polish')
+plugin_author        = 'Piotr O&#197;&#188;arowski'
+plugin_author_email    = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">ozarow+griffith at gmail.com</A>&gt;'
+plugin_version        = '1.12'
 
 class Plugin(movie.Movie):
-	TRAILER_PATTERN     = re.compile(&quot;&quot;&quot;&lt;a class=[&quot;']notSelected[&quot;'].*?href=[&quot;'](.*?)[&quot;']&gt;zwiastuny&lt;/a&gt;\s*\[\d+\]\s*&raquo;&quot;&quot;&quot;)
-	DIRECTOR_PATTERN    = re.compile('yseria\s+(.*)\s+scenariusz', re.MULTILINE)
-	O_TITLE_AKA_PATTERN = re.compile('\(AKA\s+(.*?)\)')
+    TRAILER_PATTERN     = re.compile(&quot;&quot;&quot;&lt;a class=[&quot;']notSelected[&quot;'].*?href=[&quot;'](.*?)[&quot;']&gt;zwiastuny&lt;/a&gt;\s*\[\d+\]\s*&raquo;&quot;&quot;&quot;)
+    DIRECTOR_PATTERN    = re.compile('yseria\s+(.*)\s+scenariusz', re.MULTILINE)
+    O_TITLE_AKA_PATTERN = re.compile('\(AKA\s+(.*?)\)')
 
-	def __init__(self, id):
-		self.movie_id = 'filmweb'
-		self.url      = str(id)
-		self.encode   = 'utf-8'
+    def __init__(self, id):
+        self.movie_id = 'filmweb'
+        self.url      = str(id)
+        self.encode   = 'utf-8'
 
-	def get_image(self):
-		if string.find(self.page,'&lt;div class=&quot;film-poster&quot;&gt;') &gt; -1:
-			self.image_url = gutils.trim(self.page, 'rel=&quot;artshow&quot; href=&quot;', '&quot;&gt;')
-		else:
-			self.image_url = ''
+    def get_image(self):
+        if string.find(self.page,'&lt;div class=&quot;film-poster&quot;&gt;') &gt; -1:
+            self.image_url = gutils.trim(self.page, 'rel=&quot;artshow&quot; href=&quot;', '&quot;&gt;')
+        else:
+            self.image_url = ''
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;title&gt;', '&lt;/title&gt;')
-		if string.find(self.o_title, '/') &gt; -1:
-			self.o_title = gutils.trim(self.o_title, '/', '(')
-		if string.find(self.o_title, '(') &gt; -1:
-			self.o_title = gutils.before(self.o_title, '(')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;title&gt;', '&lt;/title&gt;')
+        if string.find(self.o_title, '/') &gt; -1:
+            self.o_title = gutils.trim(self.o_title, '/', '(')
+        if string.find(self.o_title, '(') &gt; -1:
+            self.o_title = gutils.before(self.o_title, '(')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;title&gt;', '&lt;/title&gt;')
-		if string.find(self.title, '(') &gt; -1:
-			self.title = gutils.before(self.title, '(')
-		if string.find(self.title, '/') &gt; -1:
-			self.title = gutils.before(self.title, '/')
-			
-	def get_director(self):
-		director = self.DIRECTOR_PATTERN.findall(self.page)
-		if len(director)&gt;0:
-			self.director = director[0]
-			self.director = string.replace(self.director, &quot;\t&quot;,'')
-			self.director = re.sub('\s+', ' ', self.director)
-			self.director = string.replace(self.director, &quot;,&quot;,&quot;, &quot;)
-			self.director = string.replace(self.director, &quot;  &quot;,&quot; &quot;)
-			self.director = string.replace(self.director, &quot; ,  &quot;,&quot;, &quot;)
-			self.director = string.replace(self.director, &quot;,  (wi\xeacej&#160;...)&quot;,'')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;title&gt;', '&lt;/title&gt;')
+        if string.find(self.title, '(') &gt; -1:
+            self.title = gutils.before(self.title, '(')
+        if string.find(self.title, '/') &gt; -1:
+            self.title = gutils.before(self.title, '/')
+            
+    def get_director(self):
+        director = self.DIRECTOR_PATTERN.findall(self.page)
+        if len(director)&gt;0:
+            self.director = director[0]
+            self.director = string.replace(self.director, &quot;\t&quot;,'')
+            self.director = re.sub('\s+', ' ', self.director)
+            self.director = string.replace(self.director, &quot;,&quot;,&quot;, &quot;)
+            self.director = string.replace(self.director, &quot;  &quot;,&quot; &quot;)
+            self.director = string.replace(self.director, &quot; ,  &quot;,&quot;, &quot;)
+            self.director = string.replace(self.director, &quot;,  (wi\xeacej&#160;...)&quot;,'')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,'&lt;h2 id=&quot;o-filmie-header&quot; class=&quot;replace&quot;&gt;','&lt;/div&gt;')
-		self.plot = gutils.after(self.plot, '&lt;p&gt;')
-		url = gutils.trim(self.plot,&quot;\t...&quot;,&quot;&lt;/a&gt;&quot;)
-		url = gutils.trim(url, 'href=&quot;','&quot;')
-		self.plot = gutils.strip_tags(self.plot)
-		if url != '':
-			plot_page = self.open_page(url=url)
-			self.plot = gutils.trim(plot_page, '&lt;div class=&quot;filmContent&quot;&gt;', '&lt;/ul&gt;')
-			self.plot = gutils.after(self.plot, 'zg&#197;&#130;o&#197;&#155; poprawk&#196;&#153;')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,'&lt;h2 id=&quot;o-filmie-header&quot; class=&quot;replace&quot;&gt;','&lt;/div&gt;')
+        self.plot = gutils.after(self.plot, '&lt;p&gt;')
+        url = gutils.trim(self.plot,&quot;\t...&quot;,&quot;&lt;/a&gt;&quot;)
+        url = gutils.trim(url, 'href=&quot;','&quot;')
+        self.plot = gutils.strip_tags(self.plot)
+        if url != '':
+            plot_page = self.open_page(url=url)
+            self.plot = gutils.trim(plot_page, '&lt;div class=&quot;filmContent&quot;&gt;', '&lt;/ul&gt;')
+            self.plot = gutils.after(self.plot, 'zg&#197;&#130;o&#197;&#155; poprawk&#196;&#153;')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&lt;span class=&quot;year&quot;&gt;', '&lt;/a&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&lt;span class=&quot;year&quot;&gt;', '&lt;/a&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page,&quot;\tczas trwania: &quot;,&quot;\n&quot;)
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page,&quot;\tczas trwania: &quot;,&quot;\n&quot;)
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,&quot;\tgatunek:&quot;, '&lt;/p&gt;')
-		self.genre = string.replace(self.genre, &quot;\t&quot;,'')
-		self.genre = string.replace(self.genre, &quot;\n&quot;,'')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,&quot;\tgatunek:&quot;, '&lt;/p&gt;')
+        self.genre = string.replace(self.genre, &quot;\t&quot;,'')
+        self.genre = string.replace(self.genre, &quot;\n&quot;,'')
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page, '&lt;td class=&quot;film-actor&quot;&gt;',&quot;zobacz wi&#196;&#153;cej&quot;)
-		self.cast = string.replace(self.cast, chr(13),&quot;&quot;)
-		self.cast = string.replace(self.cast, chr(10),&quot;&quot;)
-#		self.cast = string.replace(self.cast, &quot;\n&quot;,&quot;&quot;)
-		self.cast = string.replace(self.cast, &quot;\t&quot;,'')
-		self.cast = string.replace(self.cast, &quot;  &quot;,'')
-		self.cast = string.replace(self.cast, '&lt;td class=&quot;film-protagonist&quot;&gt;', _(&quot; as &quot;))
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;',&quot;\n&quot;)
-		self.cast = gutils.strip_tags(self.cast)
+    def get_cast(self):
+        self.cast = gutils.trim(self.page, '&lt;td class=&quot;film-actor&quot;&gt;',&quot;zobacz wi&#196;&#153;cej&quot;)
+        self.cast = string.replace(self.cast, chr(13),&quot;&quot;)
+        self.cast = string.replace(self.cast, chr(10),&quot;&quot;)
+#        self.cast = string.replace(self.cast, &quot;\n&quot;,&quot;&quot;)
+        self.cast = string.replace(self.cast, &quot;\t&quot;,'')
+        self.cast = string.replace(self.cast, &quot;  &quot;,'')
+        self.cast = string.replace(self.cast, '&lt;td class=&quot;film-protagonist&quot;&gt;', _(&quot; as &quot;))
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;',&quot;\n&quot;)
+        self.cast = gutils.strip_tags(self.cast)
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page,&quot;\tod lat: &quot;,&quot;\t&quot;)
-		self.classification = string.replace(self.classification, &quot;\t&quot;,'')
-		self.classification = string.replace(self.classification, &quot;\n&quot;,'')
+    def get_classification(self):
+        self.classification = gutils.trim(self.page,&quot;\tod lat: &quot;,&quot;\t&quot;)
+        self.classification = string.replace(self.classification, &quot;\t&quot;,'')
+        self.classification = string.replace(self.classification, &quot;\n&quot;,'')
 
-	def get_studio(self):
-		self.studio = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		trailer = self.TRAILER_PATTERN.findall(self.page)
-		if trailer:
-			self.trailer = trailer[0]
+    def get_trailer(self):
+        trailer = self.TRAILER_PATTERN.findall(self.page)
+        if trailer:
+            self.trailer = trailer[0]
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,&quot;\tprodukcja:&quot;, '&lt;/strong&gt;')
-		self.country = string.replace(self.country, &quot;\t&quot;,'')
+    def get_country(self):
+        self.country = gutils.trim(self.page,&quot;\tprodukcja:&quot;, '&lt;/strong&gt;')
+        self.country = string.replace(self.country, &quot;\t&quot;,'')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '\t&lt;span&gt;&lt;strong class=&quot;value&quot;&gt;', '&lt;/strong&gt;')
-		if self.rating != '':
-			self.rating = string.replace(self.rating, ',', '.')
-			self.rating = str( float(string.strip(self.rating)) )
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '\t&lt;span&gt;&lt;strong class=&quot;value&quot;&gt;', '&lt;/strong&gt;')
+        if self.rating != '':
+            self.rating = string.replace(self.rating, ',', '.')
+            self.rating = str( float(string.strip(self.rating)) )
 
-	def get_notes(self):
-		self.notes = ''
+    def get_notes(self):
+        self.notes = ''
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode='utf-8'
-		self.original_url_search   = &quot;<A HREF="http://www.filmweb.pl/szukaj?c=film&amp;q=">http://www.filmweb.pl/szukaj?c=film&amp;q=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.filmweb.pl/szukaj?c=film&amp;q=">http://www.filmweb.pl/szukaj?c=film&amp;q=</A>&quot;
+    def __init__(self):
+        self.encode='utf-8'
+        self.original_url_search   = &quot;<A HREF="http://www.filmweb.pl/szukaj?c=film&amp;q=">http://www.filmweb.pl/szukaj?c=film&amp;q=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.filmweb.pl/szukaj?c=film&amp;q=">http://www.filmweb.pl/szukaj?c=film&amp;q=</A>&quot;
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		pos = string.find(self.page, 'Znaleziono &lt;b&gt;')
-		if pos == -1:	# movie page
-			self.page = None
-		else:		# search results
-			items = gutils.trim(self.page[pos:], '&lt;b&gt;', '&lt;/b&gt;')
-			if items == '0':
-				self.page = False
-			else:
-				self.page = gutils.before(self.page[pos:], 'id=&quot;sitemap&quot;')
-				self.page = gutils.after(self.page, '&lt;li ')
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        pos = string.find(self.page, 'Znaleziono &lt;b&gt;')
+        if pos == -1:    # movie page
+            self.page = None
+        else:        # search results
+            items = gutils.trim(self.page[pos:], '&lt;b&gt;', '&lt;/b&gt;')
+            if items == '0':
+                self.page = False
+            else:
+                self.page = gutils.before(self.page[pos:], 'id=&quot;sitemap&quot;')
+                self.page = gutils.after(self.page, '&lt;li ')
+        return self.page
 
-	def get_searches(self):
-		if self.page is None:	# movie page
-			self.number_results = 1
-			self.ids.append(self.url)
-			self.titles.append(gutils.convert_entities(self.title))
-		elif self.page is False: # no movie found
-			self.number_results = 0
-		else:			# multiple matches
-			elements = string.split(self.page, '&lt;li ')
-			self.number_results = elements[-1]
-			if (elements[0]&lt;&gt;''):
-				for element in elements:
-					element = gutils.after(element, '&lt;a class=&quot;searchResultTitle&quot; href=&quot;')
-					self.ids.append(gutils.before(element, '&quot;&gt;'))
-					element = gutils.trim(element, '&quot;&gt;', '&lt;/a&gt;')
-					element = gutils.convert_entities(element)
-					element = gutils.strip_tags(element)
-					self.titles.append(element)
-			else:
-				self.number_results = 0
+    def get_searches(self):
+        if self.page is None:    # movie page
+            self.number_results = 1
+            self.ids.append(self.url)
+            self.titles.append(gutils.convert_entities(self.title))
+        elif self.page is False: # no movie found
+            self.number_results = 0
+        else:            # multiple matches
+            elements = string.split(self.page, '&lt;li ')
+            self.number_results = elements[-1]
+            if (elements[0]&lt;&gt;''):
+                for element in elements:
+                    element = gutils.after(element, '&lt;a class=&quot;searchResultTitle&quot; href=&quot;')
+                    self.ids.append(gutils.before(element, '&quot;&gt;'))
+                    element = gutils.trim(element, '&quot;&gt;', '&lt;/a&gt;')
+                    element = gutils.convert_entities(element)
+                    element = gutils.strip_tags(element)
+                    self.titles.append(element)
+            else:
+                self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -34,148 +34,148 @@
 plugin_version      = '1.2'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode = 'iso8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://german.imdb.com/title/tt%s">http://german.imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode = 'iso8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://german.imdb.com/title/tt%s">http://german.imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
 
-	def initialize(self):
-		self.cast_page = self.open_page(url=self.url + '/fullcredits')
-		self.plot_page = self.open_page(url=self.url + '/plotsummary')
+    def initialize(self):
+        self.cast_page = self.open_page(url=self.url + '/fullcredits')
+        self.plot_page = self.open_page(url=self.url + '/plotsummary')
 
-	def get_image(self):
-		tmp = string.find(self.page, 'a name=&quot;poster&quot;')
-		if tmp == -1:		# poster not available
-			self.image_url = ''
-		else:
-			self.image_url = gutils.trim(self.page[tmp:], 'src=&quot;', '&quot;')
+    def get_image(self):
+        tmp = string.find(self.page, 'a name=&quot;poster&quot;')
+        if tmp == -1:        # poster not available
+            self.image_url = ''
+        else:
+            self.image_url = gutils.trim(self.page[tmp:], 'src=&quot;', '&quot;')
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
-		elements = string.split(gutils.trim(self.page, '&lt;h5&gt;Alternativ:', '&lt;/div&gt;'), '&lt;i class=&quot;transl&quot;')
-		if len(elements) &gt; 1:
-			for element in elements:
-				tmp = gutils.before(gutils.trim(element, '&gt;', '[de]'), '(')
-				if tmp &lt;&gt; '':
-					self.title = tmp
-					break
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
+        elements = string.split(gutils.trim(self.page, '&lt;h5&gt;Alternativ:', '&lt;/div&gt;'), '&lt;i class=&quot;transl&quot;')
+        if len(elements) &gt; 1:
+            for element in elements:
+                tmp = gutils.before(gutils.trim(element, '&gt;', '[de]'), '(')
+                if tmp &lt;&gt; '':
+                    self.title = tmp
+                    break
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,'&lt;h5&gt;Regie&lt;/h5&gt;', '&lt;br/&gt;')
-		if self.director == '':
-			self.director = gutils.trim(self.page,'&lt;h5&gt;Regisseur:&lt;/h5&gt;', '&lt;/div&gt;')
-		self.director = self.__before_more(self.director)
-		self.director = self.director.replace('&lt;br/&gt;', ', ')
+    def get_director(self):
+        self.director = gutils.trim(self.page,'&lt;h5&gt;Regie&lt;/h5&gt;', '&lt;br/&gt;')
+        if self.director == '':
+            self.director = gutils.trim(self.page,'&lt;h5&gt;Regisseur:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.director = self.__before_more(self.director)
+        self.director = self.director.replace('&lt;br/&gt;', ', ')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '&lt;h5&gt;Kurzbeschreibung:&lt;/h5&gt;', '&lt;/div&gt;')
-		self.plot = self.__before_more(self.plot)
-		elements = string.split(self.plot_page, '&lt;p class=&quot;plotpar&quot;&gt;')
-		if len(elements) &gt; 1:
-			self.plot = self.plot + '\n\n'
-			elements[0] = ''
-			for element in elements:
-				if element != '':
-					self.plot = self.plot + gutils.strip_tags(gutils.before(element, '&lt;/a&gt;')) + '\n'
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '&lt;h5&gt;Kurzbeschreibung:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.plot = self.__before_more(self.plot)
+        elements = string.split(self.plot_page, '&lt;p class=&quot;plotpar&quot;&gt;')
+        if len(elements) &gt; 1:
+            self.plot = self.plot + '\n\n'
+            elements[0] = ''
+            for element in elements:
+                if element != '':
+                    self.plot = self.plot + gutils.strip_tags(gutils.before(element, '&lt;/a&gt;')) + '\n'
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Years/', '&lt;/a&gt;')
-		self.year = gutils.after(self.year, '&quot;&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Years/', '&lt;/a&gt;')
+        self.year = gutils.after(self.year, '&quot;&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, '&lt;h5&gt;L&auml;nge:&lt;/h5&gt;', ' min')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, '&lt;h5&gt;L&auml;nge:&lt;/h5&gt;', ' min')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '&lt;h5&gt;Genre:&lt;/h5&gt;', '&lt;/div&gt;')
-		self.genre = self.__before_more(self.genre)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, '&lt;h5&gt;Genre:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.genre = self.__before_more(self.genre)
 
-	def get_cast(self):
-		self.cast = ''
-		self.cast = gutils.trim(self.cast_page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
-		if self.cast == '':
-			self.cast = gutils.trim(self.page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
-		self.cast = string.replace(self.cast, ' ... ', _(' as '))
-		self.cast = string.replace(self.cast, '...', _(' as '))
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr&gt;', &quot;\n&quot;)
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;', &quot;\n&quot;)
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;', &quot;\n&quot;)
-		self.cast = self.__before_more(self.cast)
+    def get_cast(self):
+        self.cast = ''
+        self.cast = gutils.trim(self.cast_page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
+        if self.cast == '':
+            self.cast = gutils.trim(self.page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
+        self.cast = string.replace(self.cast, ' ... ', _(' as '))
+        self.cast = string.replace(self.cast, '...', _(' as '))
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr&gt;', &quot;\n&quot;)
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;', &quot;\n&quot;)
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;', &quot;\n&quot;)
+        self.cast = self.__before_more(self.cast)
 
-	def get_classification(self):
-		self.classification = gutils.trim(gutils.trim(self.page, 'Altersfreigabe:', '&lt;/div&gt;'), 'Germany:', '&amp;')
+    def get_classification(self):
+        self.classification = gutils.trim(gutils.trim(self.page, 'Altersfreigabe:', '&lt;/div&gt;'), 'Germany:', '&amp;')
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page, '&lt;h5&gt;Company:&lt;/h5&gt;', '&lt;/a&gt;')
+    def get_studio(self):
+        self.studio = gutils.trim(self.page, '&lt;h5&gt;Company:&lt;/h5&gt;', '&lt;/a&gt;')
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://german.imdb.com/title/tt%s">http://german.imdb.com/title/tt%s</A>&quot; % self.movie_id
+    def get_site(self):
+        self.site = &quot;<A HREF="http://german.imdb.com/title/tt%s">http://german.imdb.com/title/tt%s</A>&quot; % self.movie_id
 
-	def get_trailer(self):
-		self.trailer = &quot;<A HREF="http://german.imdb.com/title/tt%s/trailers">http://german.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
+    def get_trailer(self):
+        self.trailer = &quot;<A HREF="http://german.imdb.com/title/tt%s/trailers">http://german.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, '&lt;h5&gt;Produktionsland:&lt;/h5&gt;', '&lt;/div&gt;')
+    def get_country(self):
+        self.country = gutils.trim(self.page, '&lt;h5&gt;Produktionsland:&lt;/h5&gt;', '&lt;/div&gt;')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '&lt;b&gt;Nutzer-Bewertung:&lt;/b&gt;', '/10')
-		if self.rating:
-			try:
-				self.rating = str(float(gutils.clean(self.rating)))
-			except:
-				self.rating = ''
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '&lt;b&gt;Nutzer-Bewertung:&lt;/b&gt;', '/10')
+        if self.rating:
+            try:
+                self.rating = str(float(gutils.clean(self.rating)))
+            except:
+                self.rating = ''
 
-	def get_notes(self):
-		self.notes = ''
-		language = gutils.trim(self.page, '&lt;h5&gt;Sprache:&lt;/h5&gt;', '&lt;/div&gt;')
-		language = gutils.strip_tags(language)
-		color = gutils.trim(self.page, '&lt;h5&gt;Farbe:&lt;/h5&gt;', '&lt;/div&gt;')
-		color = gutils.strip_tags(color)
-		sound = gutils.trim(self.page, '&lt;h5&gt;Tonverfahren:&lt;/h5&gt;', '&lt;/div&gt;')
-		sound = gutils.strip_tags(sound)
-		tagline = gutils.trim(self.page, '&lt;h5&gt;Werbezeile:&lt;/h5&gt;', '&lt;/div&gt;')
-		tagline = self.__before_more(tagline)
-		tagline = gutils.strip_tags(tagline)
-		if len(language)&gt;0:
-			self.notes = &quot;%s: %s\n&quot; %(_('Language'), language)
-		if len(sound)&gt;0:
-			self.notes += &quot;%s: %s\n&quot; %(gutils.strip_tags(_('&lt;b&gt;Audio&lt;/b&gt;')), sound)
-		if len(color)&gt;0:
-			self.notes += &quot;%s: %s\n&quot; %(_('Color'), color)
-		if len(tagline)&gt;0:
-			self.notes += &quot;%s: %s\n&quot; %('Tagline', tagline)
-	
-	def __before_more(self, data):
-		tmp = string.find(data, '&gt;mehr...&lt;')
-		if tmp&gt;0:
-			data = data[:tmp] + '&gt;'
-		return data
+    def get_notes(self):
+        self.notes = ''
+        language = gutils.trim(self.page, '&lt;h5&gt;Sprache:&lt;/h5&gt;', '&lt;/div&gt;')
+        language = gutils.strip_tags(language)
+        color = gutils.trim(self.page, '&lt;h5&gt;Farbe:&lt;/h5&gt;', '&lt;/div&gt;')
+        color = gutils.strip_tags(color)
+        sound = gutils.trim(self.page, '&lt;h5&gt;Tonverfahren:&lt;/h5&gt;', '&lt;/div&gt;')
+        sound = gutils.strip_tags(sound)
+        tagline = gutils.trim(self.page, '&lt;h5&gt;Werbezeile:&lt;/h5&gt;', '&lt;/div&gt;')
+        tagline = self.__before_more(tagline)
+        tagline = gutils.strip_tags(tagline)
+        if len(language)&gt;0:
+            self.notes = &quot;%s: %s\n&quot; %(_('Language'), language)
+        if len(sound)&gt;0:
+            self.notes += &quot;%s: %s\n&quot; %(gutils.strip_tags(_('&lt;b&gt;Audio&lt;/b&gt;')), sound)
+        if len(color)&gt;0:
+            self.notes += &quot;%s: %s\n&quot; %(_('Color'), color)
+        if len(tagline)&gt;0:
+            self.notes += &quot;%s: %s\n&quot; %('Tagline', tagline)
+    
+    def __before_more(self, data):
+        tmp = string.find(data, '&gt;mehr...&lt;')
+        if tmp&gt;0:
+            data = data[:tmp] + '&gt;'
+        return data
 
 class SearchPlugin(movie.SearchMovie):
-	PATTERN = re.compile(r&quot;&quot;&quot;&lt;a href=['&quot;]/title/tt([0-9]+)/[&quot;']&gt;(.*?)&lt;/td&gt;&quot;&quot;&quot;)
-	def __init__(self):
-		self.original_url_search	= '<A HREF="http://german.imdb.com/find?more=tt&amp;q=">http://german.imdb.com/find?more=tt&amp;q=</A>'
-		self.translated_url_search	= '<A HREF="http://german.imdb.com/find?more=tt&amp;q=">http://german.imdb.com/find?more=tt&amp;q=</A>'
-		self.encode = 'iso8859-1'
+    PATTERN = re.compile(r&quot;&quot;&quot;&lt;a href=['&quot;]/title/tt([0-9]+)/[&quot;']&gt;(.*?)&lt;/td&gt;&quot;&quot;&quot;)
+    def __init__(self):
+        self.original_url_search    = '<A HREF="http://german.imdb.com/find?more=tt&amp;q=">http://german.imdb.com/find?more=tt&amp;q=</A>'
+        self.translated_url_search    = '<A HREF="http://german.imdb.com/find?more=tt&amp;q=">http://german.imdb.com/find?more=tt&amp;q=</A>'
+        self.encode = 'iso8859-1'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = gutils.trim(self.page, ' angezeigt)', ' Treffergenauigkeit');
-		self.page = self.page.decode('iso-8859-1')
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = gutils.trim(self.page, ' angezeigt)', ' Treffergenauigkeit');
+        self.page = self.page.decode('iso-8859-1')
+        return self.page
 
-	def get_searches(self):
-		elements = string.split(self.page, '&lt;tr&gt;')
+    def get_searches(self):
+        elements = string.split(self.page, '&lt;tr&gt;')
 
-		if len(elements):
-			for element in elements[1:]:
-				match = self.PATTERN.findall(element)
-				if len(match):
-					tmp  = gutils.clean(match[0][1])
-					self.ids.append(match[0][0])
-					self.titles.append(tmp)
+        if len(elements):
+            for element in elements[1:]:
+                match = self.PATTERN.findall(element)
+                if len(match):
+                    tmp  = gutils.clean(match[0][1])
+                    self.ids.append(match[0][0])
+                    self.titles.append(tmp)

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-es.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-es.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-es.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -26,135 +26,135 @@
 import movie
 import string
 
-plugin_name		= 'IMDb-es'
-plugin_description	= 'Internet Movie Database Spanish'
-plugin_url		= 'spanish.imdb.com'
-plugin_language		= _('Spanish')
-plugin_author		= 'Pedro D. S&#225;nchez'
-plugin_author_email	= '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
-plugin_version		= '0.2'
+plugin_name        = 'IMDb-es'
+plugin_description    = 'Internet Movie Database Spanish'
+plugin_url        = 'spanish.imdb.com'
+plugin_language        = _('Spanish')
+plugin_author        = 'Pedro D. S&#225;nchez'
+plugin_author_email    = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
+plugin_version        = '0.2'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-15'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://spanish.imdb.com/title/tt%s">http://spanish.imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-15'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://spanish.imdb.com/title/tt%s">http://spanish.imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
 
-	def get_image(self):
-		tmp = string.find(self.page, 'a name=&quot;poster&quot;')
-		if tmp == -1:		# poster not available
-			self.image_url = ''
-		else:
-			self.image_url = gutils.trim(self.page[tmp:], 'src=&quot;', '&quot;')
+    def get_image(self):
+        tmp = string.find(self.page, 'a name=&quot;poster&quot;')
+        if tmp == -1:        # poster not available
+            self.image_url = ''
+        else:
+            self.image_url = gutils.trim(self.page[tmp:], 'src=&quot;', '&quot;')
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;strong class=&quot;title&quot;&gt;', ' &lt;small&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;strong class=&quot;title&quot;&gt;', ' &lt;small&gt;')
 
-	def get_title(self):
-		tmp = 0
-		tmpTot = 0
-		while (tmp &lt;&gt; -1):
-			auxTitle = ''
-			tmp = string.find(self.page[tmpTot:], '&lt;i class=&quot;transl&quot;&gt;')
-			if tmp &lt;&gt; -1:
-				auxTitle = gutils.trim(self.page[tmpTot:], '&lt;i class=&quot;transl&quot;&gt;', '&lt;/i&gt;')
-				if string.find(auxTitle, '(Spain)') &lt;&gt; -1:
-					auxTitle = string.replace(auxTitle, '&#32;', ' ')
-					auxTitle = string.replace(auxTitle, ' (Argentina) ', '')
-					auxTitle = string.replace(auxTitle, ' (Spain) ', '')
-					auxTitle = string.replace(auxTitle, ' (Mexico) ', '')
-					auxTitle = string.replace(auxTitle, '  [es]', '')
-					tmp = -1
-				tmpTot = tmpTot + tmp + 1
-		if auxTitle &lt;&gt; '':
-			self.title = auxTitle
-		else:
-			self.title = self.o_title
+    def get_title(self):
+        tmp = 0
+        tmpTot = 0
+        while (tmp &lt;&gt; -1):
+            auxTitle = ''
+            tmp = string.find(self.page[tmpTot:], '&lt;i class=&quot;transl&quot;&gt;')
+            if tmp &lt;&gt; -1:
+                auxTitle = gutils.trim(self.page[tmpTot:], '&lt;i class=&quot;transl&quot;&gt;', '&lt;/i&gt;')
+                if string.find(auxTitle, '(Spain)') &lt;&gt; -1:
+                    auxTitle = string.replace(auxTitle, '&#32;', ' ')
+                    auxTitle = string.replace(auxTitle, ' (Argentina) ', '')
+                    auxTitle = string.replace(auxTitle, ' (Spain) ', '')
+                    auxTitle = string.replace(auxTitle, ' (Mexico) ', '')
+                    auxTitle = string.replace(auxTitle, '  [es]', '')
+                    tmp = -1
+                tmpTot = tmpTot + tmp + 1
+        if auxTitle &lt;&gt; '':
+            self.title = auxTitle
+        else:
+            self.title = self.o_title
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,'Dirigida por&lt;/b&gt;&lt;br&gt;', '&lt;br&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page,'Dirigida por&lt;/b&gt;&lt;br&gt;', '&lt;br&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Resumen', '&lt;a href=&quot;/rg/title-tease/plot')
-		self.plot = gutils.after(self.plot, ':&lt;/b&gt; ')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Resumen', '&lt;a href=&quot;/rg/title-tease/plot')
+        self.plot = gutils.after(self.plot, ':&lt;/b&gt; ')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Years/', '&lt;/a&gt;)&lt;/small&gt;')
-		self.year = gutils.after(self.year, '&quot;&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Years/', '&lt;/a&gt;)&lt;/small&gt;')
+        self.year = gutils.after(self.year, '&quot;&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Duraci&#243;n:&lt;/b&gt;', ' min')
-		if self.runtime == '':
-			self.runtime = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Duraci&oacute;n:&lt;/b&gt;', ' min')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Duraci&#243;n:&lt;/b&gt;', ' min')
+        if self.runtime == '':
+            self.runtime = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Duraci&oacute;n:&lt;/b&gt;', ' min')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Genres/', '&lt;br&gt;')
-		self.genre = gutils.after(self.genre, '/&quot;&gt;')
-		self.genre = string.replace(self.genre, '(m&#225;s)', '')
-		self.genre = string.replace(self.genre, '(m&aacute;s)', '')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Genres/', '&lt;br&gt;')
+        self.genre = gutils.after(self.genre, '/&quot;&gt;')
+        self.genre = string.replace(self.genre, '(m&#225;s)', '')
+        self.genre = string.replace(self.genre, '(m&aacute;s)', '')
 
-	def get_cast(self):
-		self.cast = ''
-		self.cast = gutils.trim(self.page, 'Cast overview, first billed only:', '&lt;a href=&quot;fullcredits&quot;&gt;')
-		if (self.cast==''):
-			self.cast = gutils.trim(self.page, 'cast: ','&lt;a href=&quot;fullcredits&quot;&gt;')
-		self.cast = string.replace(self.cast, ' .... ', _(' as '))
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr&gt;', &quot;\n&quot;)
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr bgcolor=&quot;#FFFFFF&quot;&gt;', &quot;\n&quot;)
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr bgcolor=&quot;#F0F0F0&quot;&gt;', &quot;\n&quot;)
-		self.cast = string.strip(gutils.strip_tags(self.cast))
+    def get_cast(self):
+        self.cast = ''
+        self.cast = gutils.trim(self.page, 'Cast overview, first billed only:', '&lt;a href=&quot;fullcredits&quot;&gt;')
+        if (self.cast==''):
+            self.cast = gutils.trim(self.page, 'cast: ','&lt;a href=&quot;fullcredits&quot;&gt;')
+        self.cast = string.replace(self.cast, ' .... ', _(' as '))
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr&gt;', &quot;\n&quot;)
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr bgcolor=&quot;#FFFFFF&quot;&gt;', &quot;\n&quot;)
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr bgcolor=&quot;#F0F0F0&quot;&gt;', &quot;\n&quot;)
+        self.cast = string.strip(gutils.strip_tags(self.cast))
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page, '&lt;a href=&quot;/List?certificates=Spain:', '&lt;/a&gt;')
-		self.classification = gutils.after(self.classification, '&quot;&gt;Spain:')
-		#self.classification = gutils.trim(self.page, 'MPAA&lt;/a&gt;:&lt;/b&gt; ', '&lt;br&gt;')
-		#self.classification = ''
+    def get_classification(self):
+        self.classification = gutils.trim(self.page, '&lt;a href=&quot;/List?certificates=Spain:', '&lt;/a&gt;')
+        self.classification = gutils.after(self.classification, '&quot;&gt;Spain:')
+        #self.classification = gutils.trim(self.page, 'MPAA&lt;/a&gt;:&lt;/b&gt; ', '&lt;br&gt;')
+        #self.classification = ''
 
-	def get_studio(self):
-		self.studio = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://spanish.imdb.com/title/tt%s">http://spanish.imdb.com/title/tt%s</A>&quot; % self.movie_id
+    def get_site(self):
+        self.site = &quot;<A HREF="http://spanish.imdb.com/title/tt%s">http://spanish.imdb.com/title/tt%s</A>&quot; % self.movie_id
 
-	def get_trailer(self):
-		self.trailer = &quot;<A HREF="http://spanish.imdb.com/title/tt%s/trailers">http://spanish.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
+    def get_trailer(self):
+        self.trailer = &quot;<A HREF="http://spanish.imdb.com/title/tt%s/trailers">http://spanish.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Pa&#237;s:&lt;/b&gt;', '&lt;/a&gt;')
-		if self.country == '':
-			self.country = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Pa&iacute;s:&lt;/b&gt;', '&lt;/a&gt;')
-		self.country = gutils.after(self.country, '/&quot;&gt;')
+    def get_country(self):
+        self.country = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Pa&#237;s:&lt;/b&gt;', '&lt;/a&gt;')
+        if self.country == '':
+            self.country = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Pa&iacute;s:&lt;/b&gt;', '&lt;/a&gt;')
+        self.country = gutils.after(self.country, '/&quot;&gt;')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Calificaci&#243;n de los usuarios:&lt;/b&gt;', '/10&lt;/b&gt; (')
-		if self.rating == '':
-			self.rating = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Calificaci&oacute;n de los usuarios:&lt;/b&gt;', '/10&lt;/b&gt; (')
-		if self.rating:
-			self.rating = str(float(gutils.clean(self.rating)))
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Calificaci&#243;n de los usuarios:&lt;/b&gt;', '/10&lt;/b&gt; (')
+        if self.rating == '':
+            self.rating = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Calificaci&oacute;n de los usuarios:&lt;/b&gt;', '/10&lt;/b&gt; (')
+        if self.rating:
+            self.rating = str(float(gutils.clean(self.rating)))
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search	= '<A HREF="http://spanish.imdb.com/find?more=tt;q=">http://spanish.imdb.com/find?more=tt;q=</A>'
-		self.translated_url_search	= '<A HREF="http://spanish.imdb.com/find?more=tt;q=">http://spanish.imdb.com/find?more=tt;q=</A>'
-		self.encode = 'iso-8859-15'
+    def __init__(self):
+        self.original_url_search    = '<A HREF="http://spanish.imdb.com/find?more=tt;q=">http://spanish.imdb.com/find?more=tt;q=</A>'
+        self.translated_url_search    = '<A HREF="http://spanish.imdb.com/find?more=tt;q=">http://spanish.imdb.com/find?more=tt;q=</A>'
+        self.encode = 'iso-8859-15'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page, '&lt;/b&gt; found the following results:', '&lt;b&gt;Suggestions For Improving Your Results&lt;/b&gt;');
-		self.page = self.page.decode('iso-8859-15')
+    def sub_search(self):
+        self.page = gutils.trim(self.page, '&lt;/b&gt; found the following results:', '&lt;b&gt;Suggestions For Improving Your Results&lt;/b&gt;');
+        self.page = self.page.decode('iso-8859-15')
 
-	def get_searches(self):
-		elements = string.split(self.page, '&lt;li&gt;')
+    def get_searches(self):
+        elements = string.split(self.page, '&lt;li&gt;')
 
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				self.ids.append(gutils.trim(element, '/title/tt','/?fr='))
-				self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.trim(element, ';fm=1&quot;&gt;', '&lt;/li&gt;'))))
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                self.ids.append(gutils.trim(element, '/title/tt','/?fr='))
+                self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.trim(element, ';fm=1&quot;&gt;', '&lt;/li&gt;'))))

Modified: trunk/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -25,152 +25,152 @@
 import gutils, movie
 import string, re
 
-plugin_name		= 'IMDb'
-plugin_description	= 'Internet Movie Database'
-plugin_url		= 'www.imdb.com'
-plugin_language		= _('English')
-plugin_author		= 'Vasco Nunes, Piotr O&#197;&#188;arowski'
-plugin_author_email	= '<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">griffith-private at lists.berlios.de</A>'
-plugin_version		= '1.5'
+plugin_name        = 'IMDb'
+plugin_description    = 'Internet Movie Database'
+plugin_url        = 'www.imdb.com'
+plugin_language        = _('English')
+plugin_author        = 'Vasco Nunes, Piotr O&#197;&#188;arowski'
+plugin_author_email    = '<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">griffith-private at lists.berlios.de</A>'
+plugin_version        = '1.5'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode = 'utf-8'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://imdb.com/title/tt%s">http://imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode = 'utf-8'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://imdb.com/title/tt%s">http://imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
 
-	def initialize(self):
-		self.cast_page = self.open_page(url=self.url + '/fullcredits')
-		self.plot_page = self.open_page(url=self.url + '/plotsummary')
+    def initialize(self):
+        self.cast_page = self.open_page(url=self.url + '/fullcredits')
+        self.plot_page = self.open_page(url=self.url + '/plotsummary')
 
-	def get_image(self):
-		tmp = string.find(self.page, 'a name=&quot;poster&quot;')
-		if tmp == -1:		# poster not available
-			self.image_url = ''
-		else:
-			self.image_url = gutils.trim(self.page[tmp:], 'src=&quot;', '&quot;')
+    def get_image(self):
+        tmp = string.find(self.page, 'a name=&quot;poster&quot;')
+        if tmp == -1:        # poster not available
+            self.image_url = ''
+        else:
+            self.image_url = gutils.trim(self.page[tmp:], 'src=&quot;', '&quot;')
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
 
-	def get_title(self):	# same as get_o_title()
-		self.title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
+    def get_title(self):    # same as get_o_title()
+        self.title = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span')
 
-	def get_director(self):
-		pattern = re.compile('&lt;h5&gt;Directors?:&lt;/h5&gt;[\n\s\r]*(.*?)(?:&lt;br/&gt;)?(?:&lt;a[^&gt;]+&gt;more&lt;/a&gt;)?\n&lt;/div')
-		result = pattern.search(self.page)
-		if result:
-			self.director = result.groups()[0]
-			self.director = self.director.replace('&lt;br/&gt;', ', ')
+    def get_director(self):
+        pattern = re.compile('&lt;h5&gt;Directors?:&lt;/h5&gt;[\n\s\r]*(.*?)(?:&lt;br/&gt;)?(?:&lt;a[^&gt;]+&gt;more&lt;/a&gt;)?\n&lt;/div')
+        result = pattern.search(self.page)
+        if result:
+            self.director = result.groups()[0]
+            self.director = self.director.replace('&lt;br/&gt;', ', ')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '&lt;h5&gt;Plot Outline:&lt;/h5&gt;', '&lt;/div&gt;')
-		self.plot = self.__before_more(self.plot)
-		elements = string.split(self.plot_page, '&lt;p class=&quot;plotpar&quot;&gt;')
-		if len(elements) &gt; 1:
-			self.plot = self.plot + '\n\n'
-			elements[0] = ''
-			for element in elements:
-				if element &lt;&gt; '':
-					self.plot = self.plot + gutils.strip_tags(gutils.before(element, '&lt;/a&gt;')) + '\n'
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '&lt;h5&gt;Plot Outline:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.plot = self.__before_more(self.plot)
+        elements = string.split(self.plot_page, '&lt;p class=&quot;plotpar&quot;&gt;')
+        if len(elements) &gt; 1:
+            self.plot = self.plot + '\n\n'
+            elements[0] = ''
+            for element in elements:
+                if element &lt;&gt; '':
+                    self.plot = self.plot + gutils.strip_tags(gutils.before(element, '&lt;/a&gt;')) + '\n'
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Years/', '&lt;/a&gt;')
-		self.year = gutils.after(self.year, '&quot;&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Years/', '&lt;/a&gt;')
+        self.year = gutils.after(self.year, '&quot;&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, '&lt;h5&gt;Runtime:&lt;/h5&gt;', ' min')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, '&lt;h5&gt;Runtime:&lt;/h5&gt;', ' min')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '&lt;h5&gt;Genre:&lt;/h5&gt;', '&lt;/div&gt;')
-		self.genre = self.__before_more(self.genre)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, '&lt;h5&gt;Genre:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.genre = self.__before_more(self.genre)
 
-	def get_cast(self):
-		self.cast = ''
-		self.cast = gutils.trim(self.cast_page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
-		if self.cast == '':
-			self.cast = gutils.trim(self.page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
-		self.cast = string.replace(self.cast, ' ... ', _(' as '))
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr&gt;', &quot;\n&quot;)
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;', &quot;\n&quot;)
-		self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;', &quot;\n&quot;)
-		self.cast = self.__before_more(self.cast)
+    def get_cast(self):
+        self.cast = ''
+        self.cast = gutils.trim(self.cast_page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
+        if self.cast == '':
+            self.cast = gutils.trim(self.page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
+        self.cast = string.replace(self.cast, ' ... ', _(' as '))
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr&gt;', &quot;\n&quot;)
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;', &quot;\n&quot;)
+        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;', &quot;\n&quot;)
+        self.cast = self.__before_more(self.cast)
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page, '&lt;h5&gt;&lt;a href=&quot;/mpaa&quot;&gt;MPAA&lt;/a&gt;:&lt;/h5&gt;', '&lt;/div&gt;')
-		self.classification = gutils.trim(self.classification, 'Rated ', ' ')
+    def get_classification(self):
+        self.classification = gutils.trim(self.page, '&lt;h5&gt;&lt;a href=&quot;/mpaa&quot;&gt;MPAA&lt;/a&gt;:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.classification = gutils.trim(self.classification, 'Rated ', ' ')
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page, '&lt;h5&gt;Company:&lt;/h5&gt;', '&lt;/a&gt;')
+    def get_studio(self):
+        self.studio = gutils.trim(self.page, '&lt;h5&gt;Company:&lt;/h5&gt;', '&lt;/a&gt;')
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://www.imdb.com/title/tt%s">http://www.imdb.com/title/tt%s</A>&quot; % self.movie_id
+    def get_site(self):
+        self.site = &quot;<A HREF="http://www.imdb.com/title/tt%s">http://www.imdb.com/title/tt%s</A>&quot; % self.movie_id
 
-	def get_trailer(self):
-		self.trailer = &quot;<A HREF="http://www.imdb.com/title/tt%s/trailers">http://www.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
+    def get_trailer(self):
+        self.trailer = &quot;<A HREF="http://www.imdb.com/title/tt%s/trailers">http://www.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, '&lt;h5&gt;Country:&lt;/h5&gt;', '&lt;/div&gt;')
+    def get_country(self):
+        self.country = gutils.trim(self.page, '&lt;h5&gt;Country:&lt;/h5&gt;', '&lt;/div&gt;')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '&lt;b&gt;User Rating:&lt;/b&gt; \n&lt;b&gt;', '/10')
-		if self.rating and self.rating.find('awaiting') == -1:
-			try:
-				self.rating = float(self.rating)
-			except Exception, e:
-				self.rating = 0
-		else:
-			self.rating = 0
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '&lt;b&gt;User Rating:&lt;/b&gt; \n&lt;b&gt;', '/10')
+        if self.rating and self.rating.find('awaiting') == -1:
+            try:
+                self.rating = float(self.rating)
+            except Exception, e:
+                self.rating = 0
+        else:
+            self.rating = 0
 
-	def get_notes(self):
-		self.notes = ''
-		language = gutils.trim(self.page, '&lt;h5&gt;Language:&lt;/h5&gt;', '&lt;/div&gt;')
-		language = gutils.strip_tags(language)
-		color = gutils.trim(self.page, '&lt;h5&gt;Color:&lt;/h5&gt;', '&lt;/div&gt;')
-		color = gutils.strip_tags(color)
-		sound = gutils.trim(self.page, '&lt;h5&gt;Sound Mix:&lt;/h5&gt;', '&lt;/div&gt;')
-		sound = gutils.strip_tags(sound)
-		tagline = gutils.trim(self.page, '&lt;h5&gt;Tagline:&lt;/h5&gt;', '&lt;/div&gt;')
-		tagline = self.__before_more(tagline)
-		tagline = gutils.strip_tags(tagline)
-		if len(language)&gt;0:
-			self.notes = &quot;%s: %s\n&quot; %(_('Language'), language)
-		if len(sound)&gt;0:
-			self.notes += &quot;%s: %s\n&quot; %(gutils.strip_tags(_('&lt;b&gt;Audio&lt;/b&gt;')), sound)
-		if len(color)&gt;0:
-			self.notes += &quot;%s: %s\n&quot; %(_('Color'), color)
-		if len(tagline)&gt;0:
-			self.notes += &quot;%s: %s\n&quot; %('Tagline', tagline)
-	
-	def __before_more(self, data):
-		tmp = string.find(data, '&gt;more&lt;')
-		if tmp&gt;0:
-			data = data[:tmp] + '&gt;'
-		return data
+    def get_notes(self):
+        self.notes = ''
+        language = gutils.trim(self.page, '&lt;h5&gt;Language:&lt;/h5&gt;', '&lt;/div&gt;')
+        language = gutils.strip_tags(language)
+        color = gutils.trim(self.page, '&lt;h5&gt;Color:&lt;/h5&gt;', '&lt;/div&gt;')
+        color = gutils.strip_tags(color)
+        sound = gutils.trim(self.page, '&lt;h5&gt;Sound Mix:&lt;/h5&gt;', '&lt;/div&gt;')
+        sound = gutils.strip_tags(sound)
+        tagline = gutils.trim(self.page, '&lt;h5&gt;Tagline:&lt;/h5&gt;', '&lt;/div&gt;')
+        tagline = self.__before_more(tagline)
+        tagline = gutils.strip_tags(tagline)
+        if len(language)&gt;0:
+            self.notes = &quot;%s: %s\n&quot; %(_('Language'), language)
+        if len(sound)&gt;0:
+            self.notes += &quot;%s: %s\n&quot; %(gutils.strip_tags(_('&lt;b&gt;Audio&lt;/b&gt;')), sound)
+        if len(color)&gt;0:
+            self.notes += &quot;%s: %s\n&quot; %(_('Color'), color)
+        if len(tagline)&gt;0:
+            self.notes += &quot;%s: %s\n&quot; %('Tagline', tagline)
+    
+    def __before_more(self, data):
+        tmp = string.find(data, '&gt;more&lt;')
+        if tmp&gt;0:
+            data = data[:tmp] + '&gt;'
+        return data
 
 class SearchPlugin(movie.SearchMovie):
-	PATTERN = re.compile(r&quot;&quot;&quot;&lt;a href=['&quot;]/title/tt([0-9]+)/[&quot;']&gt;(.*?)&lt;/td&gt;&quot;&quot;&quot;)
-	def __init__(self):
-		self.original_url_search	= '<A HREF="http://imdb.com/find?more=tt;q=">http://imdb.com/find?more=tt;q=</A>'
-		self.translated_url_search	= '<A HREF="http://imdb.com/find?more=tt;q=">http://imdb.com/find?more=tt;q=</A>'
-		self.encode = 'utf-8'
+    PATTERN = re.compile(r&quot;&quot;&quot;&lt;a href=['&quot;]/title/tt([0-9]+)/[&quot;']&gt;(.*?)&lt;/td&gt;&quot;&quot;&quot;)
+    def __init__(self):
+        self.original_url_search    = '<A HREF="http://imdb.com/find?more=tt;q=">http://imdb.com/find?more=tt;q=</A>'
+        self.translated_url_search    = '<A HREF="http://imdb.com/find?more=tt;q=">http://imdb.com/find?more=tt;q=</A>'
+        self.encode = 'utf-8'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = gutils.trim(self.page, '(Displaying', '&lt;b&gt;Suggestions For Improving Your Results&lt;/b&gt;');
-		self.page = self.page.decode('iso-8859-1')
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = gutils.trim(self.page, '(Displaying', '&lt;b&gt;Suggestions For Improving Your Results&lt;/b&gt;');
+        self.page = self.page.decode('iso-8859-1')
+        return self.page
 
-	def get_searches(self):
-		elements = string.split(self.page, '&lt;tr&gt;')
+    def get_searches(self):
+        elements = string.split(self.page, '&lt;tr&gt;')
 
-		if len(elements):
-			for element in elements[1:]:
-				match = self.PATTERN.findall(element)
-				if len(match):
-					tmp  = gutils.clean(match[0][1])
-					self.ids.append(match[0][0])
-					self.titles.append(tmp)
+        if len(elements):
+            for element in elements[1:]:
+                match = self.PATTERN.findall(element)
+                if len(match):
+                    tmp  = gutils.clean(match[0][1])
+                    self.ids.append(match[0][0])
+                    self.titles.append(tmp)

Modified: trunk/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -36,179 +36,179 @@
 plugin_version = &quot;1.11&quot;
 
 class Plugin(movie.Movie):
-	url_to_use = &quot;<A HREF="http://www.kino.de/kinofilm/">http://www.kino.de/kinofilm/</A>&quot;
-	url_type = &quot;K&quot;
+    url_to_use = &quot;<A HREF="http://www.kino.de/kinofilm/">http://www.kino.de/kinofilm/</A>&quot;
+    url_type = &quot;K&quot;
 
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		elements = string.split(id, &quot;_&quot;)
-		self.movie_id = elements[1]
-		if (elements[0] == &quot;V&quot;):
-			self.url_to_use = &quot;<A HREF="http://www.kino.de/videofilm/">http://www.kino.de/videofilm/</A>&quot;
-			self.url_type = &quot;V&quot;
-		else:
-			self.url_to_use = &quot;<A HREF="http://www.kino.de/kinofilm/">http://www.kino.de/kinofilm/</A>&quot;
-			self.url_type = &quot;K&quot;
-		self.url = self.url_to_use + str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        elements = string.split(id, &quot;_&quot;)
+        self.movie_id = elements[1]
+        if (elements[0] == &quot;V&quot;):
+            self.url_to_use = &quot;<A HREF="http://www.kino.de/videofilm/">http://www.kino.de/videofilm/</A>&quot;
+            self.url_type = &quot;V&quot;
+        else:
+            self.url_to_use = &quot;<A HREF="http://www.kino.de/kinofilm/">http://www.kino.de/kinofilm/</A>&quot;
+            self.url_type = &quot;K&quot;
+        self.url = self.url_to_use + str(self.movie_id)
 
-	def initialize(self):
-		self.tmp_page = gutils.before(self.page, 'kinode_navi1')
-		self.url = self.url_to_use + string.replace(str(self.movie_id), '/', '/credits/')
-		self.open_page(self.parent_window)
-		self.tmp_creditspage = gutils.before(self.page, 'kinode_navi1')
-		self.url = self.url_to_use + string.replace(str(self.movie_id), &quot;/&quot;, &quot;/features/&quot;)
-		self.open_page(self.parent_window)
-		self.tmp_dvdfeaturespage = gutils.before(self.page, 'kinode_navi1')
+    def initialize(self):
+        self.tmp_page = gutils.before(self.page, 'kinode_navi1')
+        self.url = self.url_to_use + string.replace(str(self.movie_id), '/', '/credits/')
+        self.open_page(self.parent_window)
+        self.tmp_creditspage = gutils.before(self.page, 'kinode_navi1')
+        self.url = self.url_to_use + string.replace(str(self.movie_id), &quot;/&quot;, &quot;/features/&quot;)
+        self.open_page(self.parent_window)
+        self.tmp_dvdfeaturespage = gutils.before(self.page, 'kinode_navi1')
 
-	def get_image(self):
-		self.image_url = ''
-		tmpdata = self.regextrim(self.tmp_page, '(PRINT[-]CONTENT[-]START|&lt;td class=&quot;content&quot;&gt;)', '(Dieser Film wurde |&gt;FOTOSHOW&lt;|&gt;KRITIK&lt;)')
-		tmpdatasplit = re.split('src=&quot;<A HREF="http://images.kino.de/flbilder">http://images.kino.de/flbilder</A>', tmpdata)
-		if len(tmpdatasplit) &gt; 2:
-			tmpdata = gutils.before(tmpdatasplit[2], '.jpg')
-			if tmpdata &lt;&gt; '':
-				self.image_url = '<A HREF="http://images.kino.de/flbilder">http://images.kino.de/flbilder</A>' + tmpdata + '.jpg'
-		elif len(tmpdatasplit) &gt; 1:
-			tmpdata = gutils.before(tmpdatasplit[1], '.jpg')
-			if tmpdata &lt;&gt; '':
-				self.image_url = '<A HREF="http://images.kino.de/flbilder">http://images.kino.de/flbilder</A>' + tmpdata + '.jpg'
+    def get_image(self):
+        self.image_url = ''
+        tmpdata = self.regextrim(self.tmp_page, '(PRINT[-]CONTENT[-]START|&lt;td class=&quot;content&quot;&gt;)', '(Dieser Film wurde |&gt;FOTOSHOW&lt;|&gt;KRITIK&lt;)')
+        tmpdatasplit = re.split('src=&quot;<A HREF="http://images.kino.de/flbilder">http://images.kino.de/flbilder</A>', tmpdata)
+        if len(tmpdatasplit) &gt; 2:
+            tmpdata = gutils.before(tmpdatasplit[2], '.jpg')
+            if tmpdata &lt;&gt; '':
+                self.image_url = '<A HREF="http://images.kino.de/flbilder">http://images.kino.de/flbilder</A>' + tmpdata + '.jpg'
+        elif len(tmpdatasplit) &gt; 1:
+            tmpdata = gutils.before(tmpdatasplit[1], '.jpg')
+            if tmpdata &lt;&gt; '':
+                self.image_url = '<A HREF="http://images.kino.de/flbilder">http://images.kino.de/flbilder</A>' + tmpdata + '.jpg'
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.tmp_page, 'span class=&quot;standardsmall&quot;&gt;(', ')&lt;')
-		if self.o_title == '':
-			if self.url_type == 'V':
-				self.o_title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/videofilm', '&lt;/a&gt;'), '&gt;')
-			else:
-				self.o_title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/kinofilm', '&lt;/a&gt;'), '&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.tmp_page, 'span class=&quot;standardsmall&quot;&gt;(', ')&lt;')
+        if self.o_title == '':
+            if self.url_type == 'V':
+                self.o_title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/videofilm', '&lt;/a&gt;'), '&gt;')
+            else:
+                self.o_title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/kinofilm', '&lt;/a&gt;'), '&gt;')
 
-	def get_title(self):
-		if self.url_type == &quot;V&quot;:
-			self.title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/videofilm', '&lt;/a&gt;'), '&gt;')
-		else:
-			self.title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/kinofilm', '&lt;/a&gt;'), '&gt;')
+    def get_title(self):
+        if self.url_type == &quot;V&quot;:
+            self.title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/videofilm', '&lt;/a&gt;'), '&gt;')
+        else:
+            self.title = gutils.after(self.regextrim(self.tmp_page, 'headline2&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;/kinofilm', '&lt;/a&gt;'), '&gt;')
 
-	def get_director(self):
-		self.director = gutils.trim(self.tmp_creditspage,&quot;Regie&quot;,&quot;&lt;/a&gt;&quot;)
-		self.director = gutils.after(self.director,&quot;/star/&quot;)
-		self.director = gutils.after(self.director,&quot;&gt;&quot;)
+    def get_director(self):
+        self.director = gutils.trim(self.tmp_creditspage,&quot;Regie&quot;,&quot;&lt;/a&gt;&quot;)
+        self.director = gutils.after(self.director,&quot;/star/&quot;)
+        self.director = gutils.after(self.director,&quot;&gt;&quot;)
 
-	def get_plot(self):
-		# little steps to perfect plot (I hope ... it's a terrible structured content ... )
-		self.plot = gutils.before(self.tmp_page, '&lt;!-- PRINT-CONTENT-ENDE--&gt;')
-		self.plot = self.regextrim(self.plot, 'Kurzinfo', '&lt;/td&gt;&lt;/tr&gt;[ \t\r\n]*&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;')
-		if self.plot != '':
-			lastpos = self.plot.rfind('&lt;/table&gt;')
-			if lastpos == -1:
-				self.plot = ''
-			else:
-				self.plot = self.plot[lastpos:]
-		else:
-			self.plot = gutils.trim(self.tmp_page, '&lt;span style=&quot;line-height:', '&lt;/spa')
-			if self.plot == '':
-				self.plot = gutils.trim(self.tmp_page,&quot;Kurzinfo&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&quot;)
-				if (self.plot == ''):
-					self.plot = gutils.trim(self.tmp_page,&quot;Kurzinfo&quot;, '&lt;script ')
-					self.plot = gutils.after(self.plot, '&gt;')
-				while len(self.plot) and string.find(self.plot, '&lt;/A&gt;') &gt; -1:
-					self.plot = gutils.after(self.plot, '&lt;/A&gt;');
-				self.plot = gutils.after(gutils.after(self.plot, '&lt;/table&gt;'), '&gt;')
-			else:
-				self.plot = gutils.after(self.plot, '&gt;')
+    def get_plot(self):
+        # little steps to perfect plot (I hope ... it's a terrible structured content ... )
+        self.plot = gutils.before(self.tmp_page, '&lt;!-- PRINT-CONTENT-ENDE--&gt;')
+        self.plot = self.regextrim(self.plot, 'Kurzinfo', '&lt;/td&gt;&lt;/tr&gt;[ \t\r\n]*&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;')
+        if self.plot != '':
+            lastpos = self.plot.rfind('&lt;/table&gt;')
+            if lastpos == -1:
+                self.plot = ''
+            else:
+                self.plot = self.plot[lastpos:]
+        else:
+            self.plot = gutils.trim(self.tmp_page, '&lt;span style=&quot;line-height:', '&lt;/spa')
+            if self.plot == '':
+                self.plot = gutils.trim(self.tmp_page,&quot;Kurzinfo&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&quot;)
+                if (self.plot == ''):
+                    self.plot = gutils.trim(self.tmp_page,&quot;Kurzinfo&quot;, '&lt;script ')
+                    self.plot = gutils.after(self.plot, '&gt;')
+                while len(self.plot) and string.find(self.plot, '&lt;/A&gt;') &gt; -1:
+                    self.plot = gutils.after(self.plot, '&lt;/A&gt;');
+                self.plot = gutils.after(gutils.after(self.plot, '&lt;/table&gt;'), '&gt;')
+            else:
+                self.plot = gutils.after(self.plot, '&gt;')
 
-	def get_year(self):
-		self.year = ''
-		tmp = self.regextrim(self.tmp_page, 'span class=&quot;standardsmall&quot;[^&gt;]*&gt;&lt;strong&gt;', '&lt;/span&gt;')
-		if tmp &lt;&gt; None:
-			srchresult = re.search('[0-9][0-9][0-9][0-9]&lt;/strong&gt;', tmp)
-			if srchresult &lt;&gt; None:
-				self.year = srchresult.string[srchresult.start():srchresult.end()]
+    def get_year(self):
+        self.year = ''
+        tmp = self.regextrim(self.tmp_page, 'span class=&quot;standardsmall&quot;[^&gt;]*&gt;&lt;strong&gt;', '&lt;/span&gt;')
+        if tmp &lt;&gt; None:
+            srchresult = re.search('[0-9][0-9][0-9][0-9]&lt;/strong&gt;', tmp)
+            if srchresult &lt;&gt; None:
+                self.year = srchresult.string[srchresult.start():srchresult.end()]
 
-	def get_runtime(self):
-		self.runtime = ''
-		srchresult = re.search('&gt;[0-9]+[ \t]Min[.]&lt;', self.tmp_page)
-		if srchresult &lt;&gt; None:
-			self.runtime = self.regextrim(srchresult.string[srchresult.start():srchresult.end()], '&gt;', '[^0-9]')
+    def get_runtime(self):
+        self.runtime = ''
+        srchresult = re.search('&gt;[0-9]+[ \t]Min[.]&lt;', self.tmp_page)
+        if srchresult &lt;&gt; None:
+            self.runtime = self.regextrim(srchresult.string[srchresult.start():srchresult.end()], '&gt;', '[^0-9]')
 
-	def get_genre(self):
-		self.genre = self.regextrim(self.tmp_page,'span class=&quot;standardsmall&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;strong&gt;((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)&lt;/strong&gt;[ \t]-[ \t]&lt;strong&gt;)*', '&lt;/strong&gt;[ \t]-[ \t]&lt;strong&gt;')
+    def get_genre(self):
+        self.genre = self.regextrim(self.tmp_page,'span class=&quot;standardsmall&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;strong&gt;((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)&lt;/strong&gt;[ \t]-[ \t]&lt;strong&gt;)*', '&lt;/strong&gt;[ \t]-[ \t]&lt;strong&gt;')
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.tmp_creditspage,'&gt;Cast&lt;', '&lt;/table&gt;&lt;br')
-		if len(self.cast):
-			if self.cast.find('&gt;mehr&lt;') &gt; 0:
-				self.cast = gutils.after(self.cast, '&gt;mehr&lt;')
-			self.cast = gutils.after(self.cast, '&gt;')
-			self.cast = re.sub('&lt;tr[ ]+class=&quot;(dbtrefferlight|dbtrefferdark)&quot;&gt;', &quot;\n&quot;, self.cast)
-			self.cast = self.cast.replace(&quot;&nbsp;&quot;, &quot;--flip--&quot;)
-			self.cast = gutils.clean(self.cast)
-			elements = self.cast.split(&quot;\n&quot;)
-			self.cast = ''
-			for element in elements:
-				elements2 = element.split(&quot;--flip--&quot;)
-				if len(elements2) &gt; 1:
-					if elements2[0] &lt;&gt; '':
-						self.cast += elements2[1] + &quot;--flip--&quot; + elements2[0] + &quot;\n&quot;
-					else:
-						self.cast += elements2[1] + &quot;\n&quot;
-				else:
-					self.cast = element
-			self.cast = string.replace(self.cast, &quot;--flip--&quot;, _(&quot; as &quot;))
+    def get_cast(self):
+        self.cast = gutils.trim(self.tmp_creditspage,'&gt;Cast&lt;', '&lt;/table&gt;&lt;br')
+        if len(self.cast):
+            if self.cast.find('&gt;mehr&lt;') &gt; 0:
+                self.cast = gutils.after(self.cast, '&gt;mehr&lt;')
+            self.cast = gutils.after(self.cast, '&gt;')
+            self.cast = re.sub('&lt;tr[ ]+class=&quot;(dbtrefferlight|dbtrefferdark)&quot;&gt;', &quot;\n&quot;, self.cast)
+            self.cast = self.cast.replace(&quot;&nbsp;&quot;, &quot;--flip--&quot;)
+            self.cast = gutils.clean(self.cast)
+            elements = self.cast.split(&quot;\n&quot;)
+            self.cast = ''
+            for element in elements:
+                elements2 = element.split(&quot;--flip--&quot;)
+                if len(elements2) &gt; 1:
+                    if elements2[0] &lt;&gt; '':
+                        self.cast += elements2[1] + &quot;--flip--&quot; + elements2[0] + &quot;\n&quot;
+                    else:
+                        self.cast += elements2[1] + &quot;\n&quot;
+                else:
+                    self.cast = element
+            self.cast = string.replace(self.cast, &quot;--flip--&quot;, _(&quot; as &quot;))
 
-	def get_classification(self):
-		self.classification = self.regextrim(self.tmp_page,'FSK:( |&nbsp;)+', '&lt;/strong&gt;')
+    def get_classification(self):
+        self.classification = self.regextrim(self.tmp_page,'FSK:( |&nbsp;)+', '&lt;/strong&gt;')
 
-	def get_studio(self):
-		self.studio = self.regextrim(self.tmp_page, 'Verleih:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*&lt;/strong&gt;')
-		if (self.studio == &quot;&quot;):
-			self.studio = self.regextrim(self.tmp_page, 'Anbieter:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*&lt;/strong&gt;')
+    def get_studio(self):
+        self.studio = self.regextrim(self.tmp_page, 'Verleih:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*&lt;/strong&gt;')
+        if (self.studio == &quot;&quot;):
+            self.studio = self.regextrim(self.tmp_page, 'Anbieter:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*&lt;/strong&gt;')
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = self.url_to_use + self.movie_id;
+    def get_site(self):
+        self.site = self.url_to_use + self.movie_id;
 
-	def get_trailer(self):
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		self.country = self.regextrim(self.tmp_page, 'span class=&quot;standardsmall&quot;[^&gt;]*&gt;&lt;strong&gt;((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)&lt;/strong&gt;[ \t]-[ \t]&lt;strong&gt;)*', '&lt;/span&gt;')
-		if self.country &lt;&gt; None:
-			self.country = self.regextrim(self.country, '-[ \t]&lt;strong&gt;', '&lt;/strong&gt;')
-			self.country = re.sub('[0-9]+$', '', self.country)
-		else:
-			self.country = ''
+    def get_country(self):
+        self.country = self.regextrim(self.tmp_page, 'span class=&quot;standardsmall&quot;[^&gt;]*&gt;&lt;strong&gt;((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)&lt;/strong&gt;[ \t]-[ \t]&lt;strong&gt;)*', '&lt;/span&gt;')
+        if self.country &lt;&gt; None:
+            self.country = self.regextrim(self.country, '-[ \t]&lt;strong&gt;', '&lt;/strong&gt;')
+            self.country = re.sub('[0-9]+$', '', self.country)
+        else:
+            self.country = ''
 
-	def get_rating(self):
-		self.rating = &quot;0&quot;
+    def get_rating(self):
+        self.rating = &quot;0&quot;
 
-	def get_notes(self):
-		self.notes = &quot;&quot;
-		tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;Sprache&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
-		if (tmp_notes != &quot;&quot;):
-			self.notes = self.notes + &quot;Sprachen:\n&quot; + tmp_notes + &quot;\n\n&quot;
-		tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;Untertitel&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
-		if (tmp_notes != &quot;&quot;):
-			self.notes = self.notes + &quot;Untertitel:\n&quot; + tmp_notes + &quot;\n\n&quot;
-		tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;Mehrkanalton&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
-		if (tmp_notes != &quot;&quot;):
-			self.notes = self.notes + &quot;Mehrkanalton:\n&quot; + tmp_notes + &quot;\n\n&quot;
-		tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;EAN&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
-		if (tmp_notes != &quot;&quot;):
-			self.notes = self.notes + &quot;EAN:\n&quot; + tmp_notes + &quot;\n\n&quot;
-			
-	def regextrim(self,text,key1,key2):
-		obj = re.search(key1, text)
-		if obj is None:
-			return ''
-		else:
-			p1 = obj.end()
-		obj = re.search(key2, text[p1:])
-		if obj is None:
-			return ''
-		else:
-			p2 = p1 + obj.start()
-		return text[p1:p2]
+    def get_notes(self):
+        self.notes = &quot;&quot;
+        tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;Sprache&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
+        if (tmp_notes != &quot;&quot;):
+            self.notes = self.notes + &quot;Sprachen:\n&quot; + tmp_notes + &quot;\n\n&quot;
+        tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;Untertitel&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
+        if (tmp_notes != &quot;&quot;):
+            self.notes = self.notes + &quot;Untertitel:\n&quot; + tmp_notes + &quot;\n\n&quot;
+        tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;Mehrkanalton&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
+        if (tmp_notes != &quot;&quot;):
+            self.notes = self.notes + &quot;Mehrkanalton:\n&quot; + tmp_notes + &quot;\n\n&quot;
+        tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, &quot;&lt;b&gt;EAN&lt;/b&gt;&quot;, &quot;&lt;/td&gt;&lt;/tr&gt;&quot;)), &quot;&nbsp;&quot;, &quot;&quot;)
+        if (tmp_notes != &quot;&quot;):
+            self.notes = self.notes + &quot;EAN:\n&quot; + tmp_notes + &quot;\n\n&quot;
+            
+    def regextrim(self,text,key1,key2):
+        obj = re.search(key1, text)
+        if obj is None:
+            return ''
+        else:
+            p1 = obj.end()
+        obj = re.search(key2, text[p1:])
+        if obj is None:
+            return ''
+        else:
+            p2 = p1 + obj.start()
+        return text[p1:p2]
 
 #
 # kino.de use iso-8859-1
@@ -219,115 +219,115 @@
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search    = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=filme&amp;wort=">http://www.kino.de/megasuche.php4?typ=filme&amp;wort=</A>&quot;
-		self.translated_url_search    = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=filme&amp;wort=">http://www.kino.de/megasuche.php4?typ=filme&amp;wort=</A>&quot;
-#		self.encode='utf-8'
-		self.encode='iso-8859-1'
+    def __init__(self):
+        self.original_url_search    = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=filme&amp;wort=">http://www.kino.de/megasuche.php4?typ=filme&amp;wort=</A>&quot;
+        self.translated_url_search    = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=filme&amp;wort=">http://www.kino.de/megasuche.php4?typ=filme&amp;wort=</A>&quot;
+#        self.encode='utf-8'
+        self.encode='iso-8859-1'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		tmp_pagemovie = self.page
-		#
-		# try to get all result pages (not so nice, but it works)
-		#
-		tmp_pagecount = gutils.trim(tmp_pagemovie, &quot;&nbsp;von &quot;, &quot;&lt;/SPAN&gt;&quot;)
-		try:
-			tmp_pagecountint = int(tmp_pagecount)
-		except:
-			tmp_pagecountint = 1
-		tmp_pagecountintcurrent = 1
-		while (tmp_pagecountint &gt; tmp_pagecountintcurrent and tmp_pagecountintcurrent &lt; 5):
-			tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-			self.url = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=filme&amp;page=">http://www.kino.de/megasuche.php4?typ=filme&amp;page=</A>&quot; + str(tmp_pagecountintcurrent) + &quot;&amp;wort=&quot;
-			self.open_search(parent_window)
-			tmp_pagemovie = tmp_pagemovie + self.page
-		#
-		# Look for DVD and VHS
-		#
-		self.url = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=video&amp;wort=">http://www.kino.de/megasuche.php4?typ=video&amp;wort=</A>&quot;
-		self.open_search(parent_window)
-		tmp_pagevideo = tmp_pagemovie + self.page
-		#
-		# try to get all result pages (not so nice, but it works)
-		#
-		tmp_pagecount = gutils.trim(self.page, &quot;&nbsp;von &quot;, &quot;&lt;/SPAN&gt;&quot;)
-		try:
-			tmp_pagecountint = int(tmp_pagecount)
-		except:
-			tmp_pagecountint = 1
-		tmp_pagecountintcurrent = 1
-		while (tmp_pagecountint &gt; tmp_pagecountintcurrent and tmp_pagecountintcurrent &lt; 5):
-			tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-			self.url = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=video&amp;page=">http://www.kino.de/megasuche.php4?typ=video&amp;page=</A>&quot; + str(tmp_pagecountintcurrent) + &quot;&amp;wort=&quot;
-			self.open_search(parent_window)
-			tmp_pagevideo = tmp_pagevideo + self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        tmp_pagemovie = self.page
+        #
+        # try to get all result pages (not so nice, but it works)
+        #
+        tmp_pagecount = gutils.trim(tmp_pagemovie, &quot;&nbsp;von &quot;, &quot;&lt;/SPAN&gt;&quot;)
+        try:
+            tmp_pagecountint = int(tmp_pagecount)
+        except:
+            tmp_pagecountint = 1
+        tmp_pagecountintcurrent = 1
+        while (tmp_pagecountint &gt; tmp_pagecountintcurrent and tmp_pagecountintcurrent &lt; 5):
+            tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
+            self.url = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=filme&amp;page=">http://www.kino.de/megasuche.php4?typ=filme&amp;page=</A>&quot; + str(tmp_pagecountintcurrent) + &quot;&amp;wort=&quot;
+            self.open_search(parent_window)
+            tmp_pagemovie = tmp_pagemovie + self.page
+        #
+        # Look for DVD and VHS
+        #
+        self.url = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=video&amp;wort=">http://www.kino.de/megasuche.php4?typ=video&amp;wort=</A>&quot;
+        self.open_search(parent_window)
+        tmp_pagevideo = tmp_pagemovie + self.page
+        #
+        # try to get all result pages (not so nice, but it works)
+        #
+        tmp_pagecount = gutils.trim(self.page, &quot;&nbsp;von &quot;, &quot;&lt;/SPAN&gt;&quot;)
+        try:
+            tmp_pagecountint = int(tmp_pagecount)
+        except:
+            tmp_pagecountint = 1
+        tmp_pagecountintcurrent = 1
+        while (tmp_pagecountint &gt; tmp_pagecountintcurrent and tmp_pagecountintcurrent &lt; 5):
+            tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
+            self.url = &quot;<A HREF="http://www.kino.de/megasuche.php4?typ=video&amp;page=">http://www.kino.de/megasuche.php4?typ=video&amp;page=</A>&quot; + str(tmp_pagecountintcurrent) + &quot;&amp;wort=&quot;
+            self.open_search(parent_window)
+            tmp_pagevideo = tmp_pagevideo + self.page
 
-		self.page = tmp_pagevideo
-		return self.page
+        self.page = tmp_pagevideo
+        return self.page
 
-	def get_searches(self):
-		elements1 = re.split('headline3&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;(<A HREF="http://www.kino.de">http://www.kino.de</A>)*/kinofilm/', self.page)
-		elements1[0] = None
-		for element in elements1:
-			if element &lt;&gt; None:
-				self.ids.append(&quot;K_&quot; + re.sub('[?].*', '', gutils.before(element,'&quot;')))
-				self.titles.append('Kino: ' + string.replace(string.replace(
-					gutils.strip_tags(
-						gutils.trim(element,'&gt;','&lt;/a&gt;') + ' (' +
-						string.replace(
-							gutils.trim(element, '&lt;span class=&quot;standardsmall&quot;&gt;', &quot;&lt;/span&gt;&quot;),
-							'&lt;br /&gt;', ' - ')
-						+ ')'
-					),
-					'( - (', '('), '))', ')')
-				)
+    def get_searches(self):
+        elements1 = re.split('headline3&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;(<A HREF="http://www.kino.de">http://www.kino.de</A>)*/kinofilm/', self.page)
+        elements1[0] = None
+        for element in elements1:
+            if element &lt;&gt; None:
+                self.ids.append(&quot;K_&quot; + re.sub('[?].*', '', gutils.before(element,'&quot;')))
+                self.titles.append('Kino: ' + string.replace(string.replace(
+                    gutils.strip_tags(
+                        gutils.trim(element,'&gt;','&lt;/a&gt;') + ' (' +
+                        string.replace(
+                            gutils.trim(element, '&lt;span class=&quot;standardsmall&quot;&gt;', &quot;&lt;/span&gt;&quot;),
+                            '&lt;br /&gt;', ' - ')
+                        + ')'
+                    ),
+                    '( - (', '('), '))', ')')
+                )
 
-		elements2 = re.split('headline3&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;(<A HREF="http://www.kino.de">http://www.kino.de</A>)*/videofilm/', self.page)
-		elements2[0] = None
-		for element in elements2:
-			if element &lt;&gt; None:
-				self.ids.append(&quot;V_&quot; + re.sub('[?].*', '', gutils.before(element,'&quot;')))
-				self.titles.append('Video: ' + string.replace(string.replace(
-					gutils.strip_tags(
-						gutils.trim(element,'&gt;','&lt;/a&gt;') + ' (' +
-						string.replace(
-							gutils.trim(element, '&lt;span class=&quot;standardsmall&quot;&gt;', '&lt;/span&gt;'),
-							'&lt;br /&gt;', ' - ')
-						+ ')'
-					),
-					'( - (', '('), '))', ')')
-				)
+        elements2 = re.split('headline3&quot;[^&gt;]*&gt;[ \t\r\n]*&lt;a href=&quot;(<A HREF="http://www.kino.de">http://www.kino.de</A>)*/videofilm/', self.page)
+        elements2[0] = None
+        for element in elements2:
+            if element &lt;&gt; None:
+                self.ids.append(&quot;V_&quot; + re.sub('[?].*', '', gutils.before(element,'&quot;')))
+                self.titles.append('Video: ' + string.replace(string.replace(
+                    gutils.strip_tags(
+                        gutils.trim(element,'&gt;','&lt;/a&gt;') + ' (' +
+                        string.replace(
+                            gutils.trim(element, '&lt;span class=&quot;standardsmall&quot;&gt;', '&lt;/span&gt;'),
+                            '&lt;br /&gt;', ' - ')
+                        + ')'
+                    ),
+                    '( - (', '('), '))', ')')
+                )
 
 #
 # Plugin Test
 #
 class SearchPluginTest(SearchPlugin):
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; expected result count }
-	#
-	test_configuration = {
-		'Rocky Balboa'			: 6,
-		'Arahan'				: 6,
-		'Ein gl&#195;&#188;ckliches Jahr'	: 3
-	}
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; expected result count }
+    #
+    test_configuration = {
+        'Rocky Balboa'            : 6,
+        'Arahan'                : 6,
+        'Ein gl&#195;&#188;ckliches Jahr'    : 3
+    }
 
 class PluginTest:
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; dict { arribute -&gt; value } }
-	#
-	# value: * True/False if attribute only should be tested for any value
-	#        * or the expected value
-	#
-	test_configuration = {
-		'K_rocky-balboa/96132.html' : { 
-			'title' 			: 'Rocky Balboa',
-			'o_title' 			: 'Rocky Balboa',
-			'director'			: 'Sylvester Stallone',
-			'plot' 				: True,
-			'cast'				: 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute only should be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        'K_rocky-balboa/96132.html' : { 
+            'title'             : 'Rocky Balboa',
+            'o_title'             : 'Rocky Balboa',
+            'director'            : 'Sylvester Stallone',
+            'plot'                 : True,
+            'cast'                : 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
 Antonio Traver' + _(' as ') + 'Mason &quot;The Line&quot; Dixon\n\
 Burt Young' + _(' as ') + 'Paulie\n\
 Geraldine Hughes' + _(' as ') + 'Marie\n\
@@ -335,59 +335,59 @@
 James Francis Kelly III' + _(' as ') + 'Steps\n\
 Tony Burton' + _(' as ') + 'Duke\n\
 A.J. Benza' + _(' as ') + 'L.C.',
-			'country'			: 'USA',
-			'genre'				: 'Drama',
-			'classification'	: 'Freigegeben ab 12 Jahren',
-			'studio'			: 'Fox',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.kino.de/kinofilm/rocky-balboa/96132.html">http://www.kino.de/kinofilm/rocky-balboa/96132.html</A>',
-			'trailer'			: False,
-			'year'				: 2006,
-			'notes'				: False,
-			'runtime'			: 102,
-			'image'				: True,
-			'rating'			: False
-		},
-		'K_ein-glueckliches-jahr/28675.html' : { 
-			'title' 			: 'Ein gl&#195;&#188;ckliches Jahr',
-			'o_title' 			: 'La bonne ann&#195;&#169;e',
-			'director'			: 'Claude Lelouch',
-			'plot' 				: True,
-			'cast'				: 'Lino Ventura\n\
+            'country'            : 'USA',
+            'genre'                : 'Drama',
+            'classification'    : 'Freigegeben ab 12 Jahren',
+            'studio'            : 'Fox',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.kino.de/kinofilm/rocky-balboa/96132.html">http://www.kino.de/kinofilm/rocky-balboa/96132.html</A>',
+            'trailer'            : False,
+            'year'                : 2006,
+            'notes'                : False,
+            'runtime'            : 102,
+            'image'                : True,
+            'rating'            : False
+        },
+        'K_ein-glueckliches-jahr/28675.html' : { 
+            'title'             : 'Ein gl&#195;&#188;ckliches Jahr',
+            'o_title'             : 'La bonne ann&#195;&#169;e',
+            'director'            : 'Claude Lelouch',
+            'plot'                 : True,
+            'cast'                : 'Lino Ventura\n\
 Fran&#195;&#167;oise Fabian\n\
 Charles G&#195;&#169;rard\n\
 Andr&#195;&#169; Falcon',
-			'country'			: 'Frankreich/Italien',
-			'genre'				: 'Drama',
-			'classification'	: 'Freigegeben ab 12 Jahren',
-			'studio'			: 'Columbia TriStar',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.kino.de/kinofilm/ein-glueckliches-jahr/28675.html">http://www.kino.de/kinofilm/ein-glueckliches-jahr/28675.html</A>',
-			'trailer'			: False,
-			'year'				: 1973,
-			'notes'				: False,
-			'runtime'			: 115,
-			'image'				: False,
-			'rating'			: False
-		},
-		'V_ein-glueckliches-jahr-dvd/85546.html' : { 
-			'title' 			: 'Ein gl&#195;&#188;ckliches Jahr',
-			'o_title' 			: 'La bonne ann&#195;&#169;e',
-			'director'			: 'Claude Lelouch',
-			'plot' 				: True,
-			'cast'				: 'Lino Ventura\n\
+            'country'            : 'Frankreich/Italien',
+            'genre'                : 'Drama',
+            'classification'    : 'Freigegeben ab 12 Jahren',
+            'studio'            : 'Columbia TriStar',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.kino.de/kinofilm/ein-glueckliches-jahr/28675.html">http://www.kino.de/kinofilm/ein-glueckliches-jahr/28675.html</A>',
+            'trailer'            : False,
+            'year'                : 1973,
+            'notes'                : False,
+            'runtime'            : 115,
+            'image'                : False,
+            'rating'            : False
+        },
+        'V_ein-glueckliches-jahr-dvd/85546.html' : { 
+            'title'             : 'Ein gl&#195;&#188;ckliches Jahr',
+            'o_title'             : 'La bonne ann&#195;&#169;e',
+            'director'            : 'Claude Lelouch',
+            'plot'                 : True,
+            'cast'                : 'Lino Ventura\n\
 Fran&#195;&#167;oise Fabian\n\
 Charles G&#195;&#169;rard\n\
 Andr&#195;&#169; Falcon',
-			'country'			: 'Frankreich/Italien',
-			'genre'				: 'Drama',
-			'classification'	: 'Freigegeben ab 12 Jahren',
-			'studio'			: 'Black Hill Pictures',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.kino.de/videofilm/ein-glueckliches-jahr-dvd/85546.html">http://www.kino.de/videofilm/ein-glueckliches-jahr-dvd/85546.html</A>',
-			'trailer'			: False,
-			'year'				: 1973,
-			'notes'				: 'Sprachen:\n\
+            'country'            : 'Frankreich/Italien',
+            'genre'                : 'Drama',
+            'classification'    : 'Freigegeben ab 12 Jahren',
+            'studio'            : 'Black Hill Pictures',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.kino.de/videofilm/ein-glueckliches-jahr-dvd/85546.html">http://www.kino.de/videofilm/ein-glueckliches-jahr-dvd/85546.html</A>',
+            'trailer'            : False,
+            'year'                : 1973,
+            'notes'                : 'Sprachen:\n\
 Deutsch DD 2.0, Franz&#195;&#182;sisch DD 2.0\n\
 \n\
 Mehrkanalton:\n\
@@ -395,29 +395,29 @@
 \n\
 EAN:\n\
 7321921998843',
-			'runtime'			: 110,
-			'image'				: True,
-			'rating'			: False
-		},
-		'V_arahan-vanilla-dvd/90405.html' : { 
-			'title' 			: 'Arahan (Vanilla-DVD)',
-			'o_title' 			: 'Arahan jangpung dae jakjeon',
-			'director'			: 'Ryoo Seung-wan',
-			'plot' 				: True,
-			'cast'				: 'Ryu Seung-beom' + _(' as ') + 'Sang-hwan\n\
+            'runtime'            : 110,
+            'image'                : True,
+            'rating'            : False
+        },
+        'V_arahan-vanilla-dvd/90405.html' : { 
+            'title'             : 'Arahan (Vanilla-DVD)',
+            'o_title'             : 'Arahan jangpung dae jakjeon',
+            'director'            : 'Ryoo Seung-wan',
+            'plot'                 : True,
+            'cast'                : 'Ryu Seung-beom' + _(' as ') + 'Sang-hwan\n\
 Yoon So-yi' + _(' as ') + 'Wi-jin\n\
 Ahn Sung-kee' + _(' as ') + 'Ja-woon\n\
 Jung Doo-hong' + _(' as ') + 'Heuk-woon\n\
 Yun Ju-sang' + _(' as ') + 'Mu-woon',
-			'country'			: 'S&#195;&#188;dkorea',
-			'genre'				: 'Action/Kom&#195;&#182;die',
-			'classification'	: 'Freigegeben ab 16 Jahren',
-			'studio'			: 'Splendid',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.kino.de/videofilm/arahan-vanilla-dvd/90405.html">http://www.kino.de/videofilm/arahan-vanilla-dvd/90405.html</A>',
-			'trailer'			: False,
-			'year'				: 2004,
-			'notes'				: 'Sprachen:\n\
+            'country'            : 'S&#195;&#188;dkorea',
+            'genre'                : 'Action/Kom&#195;&#182;die',
+            'classification'    : 'Freigegeben ab 16 Jahren',
+            'studio'            : 'Splendid',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.kino.de/videofilm/arahan-vanilla-dvd/90405.html">http://www.kino.de/videofilm/arahan-vanilla-dvd/90405.html</A>',
+            'trailer'            : False,
+            'year'                : 2004,
+            'notes'                : 'Sprachen:\n\
 Deutsch DD 5.1\n\
 \n\
 Mehrkanalton:\n\
@@ -425,8 +425,8 @@
 \n\
 EAN:\n\
 4013549871105',
-			'runtime'			: 108,
-			'image'				: True,
-			'rating'			: False
-		}
-	}
+            'runtime'            : 108,
+            'image'                : True,
+            'rating'            : False
+        }
+    }

Modified: trunk/lib/plugins/movie/PluginMovieMediadis.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieMediadis.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieMediadis.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -18,95 +18,95 @@
 plugin_version = &quot;0.2&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.mediadis.com/dvd/detail.asp?id=">http://www.mediadis.com/dvd/detail.asp?id=</A>&quot; + str(self.movie_id)
+    def __init__(self, id):
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.mediadis.com/dvd/detail.asp?id=">http://www.mediadis.com/dvd/detail.asp?id=</A>&quot; + str(self.movie_id)
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page,&quot;&lt;img src=\&quot;<A HREF="http://www.mediadis.com/pictures/big/">http://www.mediadis.com/pictures/big/</A>&quot;, &quot;.jpg\&quot; border=\&quot;0\&quot;&quot;)
-		self.image_url = &quot;<A HREF="http://www.mediadis.com/pictures/big/">http://www.mediadis.com/pictures/big/</A>&quot; + self.image_url + &quot;.jpg&quot;
+    def get_image(self):
+        self.image_url = gutils.trim(self.page,&quot;&lt;img src=\&quot;<A HREF="http://www.mediadis.com/pictures/big/">http://www.mediadis.com/pictures/big/</A>&quot;, &quot;.jpg\&quot; border=\&quot;0\&quot;&quot;)
+        self.image_url = &quot;<A HREF="http://www.mediadis.com/pictures/big/">http://www.mediadis.com/pictures/big/</A>&quot; + self.image_url + &quot;.jpg&quot;
 
-	def get_o_title(self):
-		self.o_title = string.capwords(gutils.trim(self.page,&quot;&lt;b&gt;Original title&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;) )
+    def get_o_title(self):
+        self.o_title = string.capwords(gutils.trim(self.page,&quot;&lt;b&gt;Original title&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;) )
 
-	def get_title(self):
-		self.title = self.o_title
+    def get_title(self):
+        self.title = self.o_title
 
-	def get_director(self):
+    def get_director(self):
 
-		self.director = gutils.trim(self.page,&quot;&lt;b&gt;Director(s)&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
-		self.director = string.replace(self.director, &quot;&nbsp;-&nbsp;&quot;, &quot;, &quot;)
-		self.director = gutils.strip_tags(self.director)
+        self.director = gutils.trim(self.page,&quot;&lt;b&gt;Director(s)&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
+        self.director = string.replace(self.director, &quot;&nbsp;-&nbsp;&quot;, &quot;, &quot;)
+        self.director = gutils.strip_tags(self.director)
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,&quot;&lt;td valign=\&quot;top\&quot; align=\&quot;left\&quot;&gt;&quot;,&quot;&lt;/td&gt;&quot;)
-		self.plot = string.strip(self.plot.decode('latin-1'))
-		self.plot = string.replace(self.plot,&quot;&lt;br&gt;&quot;, &quot; &quot;)
-		self.plot = string.replace(self.plot,&quot;&lt;p&gt;&quot;, &quot; &quot;)
-		self.plot = string.replace(self.plot,&quot;'&quot;,&quot;_&quot;)
-		self.plot = string.strip(gutils.strip_tags(self.plot))
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,&quot;&lt;td valign=\&quot;top\&quot; align=\&quot;left\&quot;&gt;&quot;,&quot;&lt;/td&gt;&quot;)
+        self.plot = string.strip(self.plot.decode('latin-1'))
+        self.plot = string.replace(self.plot,&quot;&lt;br&gt;&quot;, &quot; &quot;)
+        self.plot = string.replace(self.plot,&quot;&lt;p&gt;&quot;, &quot; &quot;)
+        self.plot = string.replace(self.plot,&quot;'&quot;,&quot;_&quot;)
+        self.plot = string.strip(gutils.strip_tags(self.plot))
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,&quot;&lt;b&gt;Year&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
+    def get_year(self):
+        self.year = gutils.trim(self.page,&quot;&lt;b&gt;Year&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page,&quot;&lt;b&gt;Duration&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&nbsp;min&quot;)
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page,&quot;&lt;b&gt;Duration&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&nbsp;min&quot;)
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,&quot;&lt;b&gt;Genres&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
-		self.genre = string.replace(self.genre,&quot;&nbsp;-&nbsp;&quot;,&quot;, &quot;)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,&quot;&lt;b&gt;Genres&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
+        self.genre = string.replace(self.genre,&quot;&nbsp;-&nbsp;&quot;,&quot;, &quot;)
 
-	def get_cast(self):
-		self.cast = &quot;&quot;
-		self.cast = gutils.trim(self.page,&quot;&lt;b&gt;Actors&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
-		self.cast = string.replace(self.cast,&quot;&nbsp;-&nbsp;&quot;, &quot;\n&quot;)
-		self.cast = string.strip(gutils.strip_tags(self.cast))
+    def get_cast(self):
+        self.cast = &quot;&quot;
+        self.cast = gutils.trim(self.page,&quot;&lt;b&gt;Actors&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
+        self.cast = string.replace(self.cast,&quot;&nbsp;-&nbsp;&quot;, &quot;\n&quot;)
+        self.cast = string.strip(gutils.strip_tags(self.cast))
 
-	def get_classification(self):
-		self.classification = &quot;&quot;
+    def get_classification(self):
+        self.classification = &quot;&quot;
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page,&quot;&lt;b&gt;Studio&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
+    def get_studio(self):
+        self.studio = gutils.trim(self.page,&quot;&lt;b&gt;Studio&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = &quot;&quot;
+    def get_site(self):
+        self.site = &quot;&quot;
 
-	def get_trailer(self):
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,&quot;&lt;b&gt;Country&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
+    def get_country(self):
+        self.country = gutils.trim(self.page,&quot;&lt;b&gt;Country&lt;/b&gt;&nbsp;:&nbsp;&quot;,&quot;&lt;br&gt;&quot;)
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, &quot;Global rating :&nbsp;&lt;b&gt;&quot;,&quot;/10&lt;/b&gt;&nbsp;&quot;)
-		if self.rating:
-			self.rating = string.replace(self.rating, &quot;,&quot;, &quot;.&quot;)
-		self.rating = str(float(gutils.clean(self.rating)))
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, &quot;Global rating :&nbsp;&lt;b&gt;&quot;,&quot;/10&lt;/b&gt;&nbsp;&quot;)
+        if self.rating:
+            self.rating = string.replace(self.rating, &quot;,&quot;, &quot;.&quot;)
+        self.rating = str(float(gutils.clean(self.rating)))
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search	= &quot;<A HREF="http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=">http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=</A>&quot;;
-		self.translated_url_search	= &quot;<A HREF="http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=">http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=</A>&quot;;
+    def __init__(self):
+        self.original_url_search    = &quot;<A HREF="http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=">http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=</A>&quot;;
+        self.translated_url_search    = &quot;<A HREF="http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=">http://www.mediadis.com/dvd/search.asp?t=1&amp;kw=</A>&quot;;
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page,&quot;Click to sort out&quot;, &quot;Result of your research on the criteria&quot;)
+    def sub_search(self):
+        self.page = gutils.trim(self.page,&quot;Click to sort out&quot;, &quot;Result of your research on the criteria&quot;)
 
-	def get_searches(self):
-		elements = string.split(self.page,&quot;&lt;td rowspan=\&quot;4\&quot; align=\&quot;center\&quot; valign=\&quot;top\&quot; style=\&quot;padding:4px;\&quot;&gt;&quot;)
-		self.number_results = elements[-1]
+    def get_searches(self):
+        elements = string.split(self.page,&quot;&lt;td rowspan=\&quot;4\&quot; align=\&quot;center\&quot; valign=\&quot;top\&quot; style=\&quot;padding:4px;\&quot;&gt;&quot;)
+        self.number_results = elements[-1]
 
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				self.ids.append(gutils.trim(element,&quot;/dvd/detail.asp?id=&quot;,&quot;\&quot;&gt;&quot;))
-				self.titles.append(gutils.convert_entities(gutils.trim(element,&quot;\&quot; class=\&quot;dvd-search-title\&quot;&gt;&quot;,&quot;&lt;/a&gt;&quot;)))	
-		else:
-			self.number_results = 0
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                self.ids.append(gutils.trim(element,&quot;/dvd/detail.asp?id=&quot;,&quot;\&quot;&gt;&quot;))
+                self.titles.append(gutils.convert_entities(gutils.trim(element,&quot;\&quot; class=\&quot;dvd-search-title\&quot;&gt;&quot;,&quot;&lt;/a&gt;&quot;)))    
+        else:
+            self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieMoviefone.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieMoviefone.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieMoviefone.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -18,83 +18,83 @@
 plugin_version = &quot;0.3&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://movies.aol.com/movie/main.adp?_pgtyp=pdct&amp;mid=">http://movies.aol.com/movie/main.adp?_pgtyp=pdct&amp;mid=</A>&quot; + str(self.movie_id)
+    def __init__(self, id):
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://movies.aol.com/movie/main.adp?_pgtyp=pdct&amp;mid=">http://movies.aol.com/movie/main.adp?_pgtyp=pdct&amp;mid=</A>&quot; + str(self.movie_id)
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page,&quot;<A HREF="http://cdn.channel.aol.com/amgvideo/dvd/cov150/">http://cdn.channel.aol.com/amgvideo/dvd/cov150/</A>&quot;,&quot;.jpg&quot;)
-		self.image_url = &quot;<A HREF="http://cdn.channel.aol.com/amgvideo/dvd/cov150/">http://cdn.channel.aol.com/amgvideo/dvd/cov150/</A>&quot; + self.image_url + &quot;.jpg&quot;
+    def get_image(self):
+        self.image_url = gutils.trim(self.page,&quot;<A HREF="http://cdn.channel.aol.com/amgvideo/dvd/cov150/">http://cdn.channel.aol.com/amgvideo/dvd/cov150/</A>&quot;,&quot;.jpg&quot;)
+        self.image_url = &quot;<A HREF="http://cdn.channel.aol.com/amgvideo/dvd/cov150/">http://cdn.channel.aol.com/amgvideo/dvd/cov150/</A>&quot; + self.image_url + &quot;.jpg&quot;
 
-	def get_o_title(self):
-		self.o_title = string.capwords(gutils.trim(self.page,&quot;&lt;title&gt;&quot;,&quot; - Moviefone&lt;/title&gt;&quot;) )
+    def get_o_title(self):
+        self.o_title = string.capwords(gutils.trim(self.page,&quot;&lt;title&gt;&quot;,&quot; - Moviefone&lt;/title&gt;&quot;) )
 
-	def get_title(self):
-		self.title = self.o_title
+    def get_title(self):
+        self.title = self.o_title
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,&quot;&lt;strong&gt;Directed By:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
-		self.director = string.strip(gutils.strip_tags(self.director))
+    def get_director(self):
+        self.director = gutils.trim(self.page,&quot;&lt;strong&gt;Directed By:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
+        self.director = string.strip(gutils.strip_tags(self.director))
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,&quot;&lt;strong&gt;Synopsis:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
-		self.plot = string.strip(gutils.strip_tags(self.plot))
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,&quot;&lt;strong&gt;Synopsis:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
+        self.plot = string.strip(gutils.strip_tags(self.plot))
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,&quot;&lt;strong&gt;DVD Release Date:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
-		self.year = self.year[-4:]
+    def get_year(self):
+        self.year = gutils.trim(self.page,&quot;&lt;strong&gt;DVD Release Date:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
+        self.year = self.year[-4:]
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page,&quot;&lt;strong&gt;Run Time:&lt;/strong&gt; &quot;,&quot; min.&lt;br /&gt;&quot;)
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page,&quot;&lt;strong&gt;Run Time:&lt;/strong&gt; &quot;,&quot; min.&lt;br /&gt;&quot;)
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,&quot;&lt;strong&gt;Genre:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,&quot;&lt;strong&gt;Genre:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page,&quot;&lt;strong&gt;Starring:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
-		self.cast = string.strip(gutils.strip_tags(self.cast))
+    def get_cast(self):
+        self.cast = gutils.trim(self.page,&quot;&lt;strong&gt;Starring:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
+        self.cast = string.strip(gutils.strip_tags(self.cast))
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page,&quot;&lt;strong&gt;Rating:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
+    def get_classification(self):
+        self.classification = gutils.trim(self.page,&quot;&lt;strong&gt;Rating:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page,&quot;&lt;strong&gt;Released By:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
+    def get_studio(self):
+        self.studio = gutils.trim(self.page,&quot;&lt;strong&gt;Released By:&lt;/strong&gt; &quot;,&quot;&lt;br /&gt;&quot;)
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = &quot;&quot;
+    def get_site(self):
+        self.site = &quot;&quot;
 
-	def get_trailer(self):
-		self.trailer = gutils.trim(self.page,&quot;&quot;&quot;onclick=&quot;setTrailerOmni();window.open('&quot;&quot;&quot;, \
-			&quot;','_dlplayer'&quot;)
+    def get_trailer(self):
+        self.trailer = gutils.trim(self.page,&quot;&quot;&quot;onclick=&quot;setTrailerOmni();window.open('&quot;&quot;&quot;, \
+            &quot;','_dlplayer'&quot;)
 
-	def get_country(self):
-		self.country = &quot;&quot;
+    def get_country(self):
+        self.country = &quot;&quot;
 
-	def get_rating(self):
-		self.rating = &quot;0&quot;
+    def get_rating(self):
+        self.rating = &quot;0&quot;
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.original_url_search	= &quot;<A HREF="http://movies.aol.com/search/encyresults.adp?query=">http://movies.aol.com/search/encyresults.adp?query=</A>&quot;;
-		self.translated_url_search	= &quot;<A HREF="http://movies.aol.com/search/encyresults.adp?query=">http://movies.aol.com/search/encyresults.adp?query=</A>&quot;;
+    def __init__(self):
+        self.original_url_search    = &quot;<A HREF="http://movies.aol.com/search/encyresults.adp?query=">http://movies.aol.com/search/encyresults.adp?query=</A>&quot;;
+        self.translated_url_search    = &quot;<A HREF="http://movies.aol.com/search/encyresults.adp?query=">http://movies.aol.com/search/encyresults.adp?query=</A>&quot;;
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page,&quot;--start LT_MultiColumn_1.0 module--&gt;&quot;, 'pagnationleft&quot;&gt;Results   ')
+    def sub_search(self):
+        self.page = gutils.trim(self.page,&quot;--start LT_MultiColumn_1.0 module--&gt;&quot;, 'pagnationleft&quot;&gt;Results   ')
 
-	def get_searches(self):
-		elements = string.split(self.page,'class=&quot;dvdtitle&quot;&gt;')
-		elements[0] = ''
+    def get_searches(self):
+        elements = string.split(self.page,'class=&quot;dvdtitle&quot;&gt;')
+        elements[0] = ''
 
-		for element in elements:
-			element = gutils.trim( element, '&lt;a href=&quot;', '&lt;br/&gt;' )
-			if element != '':
-				self.ids.append( gutils.after( gutils.trim( element, 'movie/','/main') , '/' ) )
-				self.titles.append( string.replace( gutils.after( element, '&quot;&gt;' ), '&lt;/a&gt;&lt;/span&gt;', '' ) )
+        for element in elements:
+            element = gutils.trim( element, '&lt;a href=&quot;', '&lt;br/&gt;' )
+            if element != '':
+                self.ids.append( gutils.after( gutils.trim( element, 'movie/','/main') , '/' ) )
+                self.titles.append( string.replace( gutils.after( element, '&quot;&gt;' ), '&lt;/a&gt;&lt;/span&gt;', '' ) )

Modified: trunk/lib/plugins/movie/PluginMovieOFDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieOFDb.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieOFDb.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -20,166 +20,166 @@
 plugin_version = &quot;0.9&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='utf-8'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.ofdb.de/%s">http://www.ofdb.de/%s</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode='utf-8'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.ofdb.de/%s">http://www.ofdb.de/%s</A>&quot; % str(self.movie_id)
 
-	def initialize(self):
-		# OFDb didn't provide the runtime, studio and classification but it provide a link to the german imdb entry
-		# lets use the imdb page, why not
-		imdb_nr = gutils.trim(self.page, '<A HREF="http://german.imdb.com/Title?">http://german.imdb.com/Title?</A>', '&quot;')
-		if imdb_nr != '':
-			self.imdb_page = self.open_page(url='<A HREF="http://german.imdb.com/Title?">http://german.imdb.com/Title?</A>' + imdb_nr)
-		else:
-			self.imdb_page = ''
+    def initialize(self):
+        # OFDb didn't provide the runtime, studio and classification but it provide a link to the german imdb entry
+        # lets use the imdb page, why not
+        imdb_nr = gutils.trim(self.page, '<A HREF="http://german.imdb.com/Title?">http://german.imdb.com/Title?</A>', '&quot;')
+        if imdb_nr != '':
+            self.imdb_page = self.open_page(url='<A HREF="http://german.imdb.com/Title?">http://german.imdb.com/Title?</A>' + imdb_nr)
+        else:
+            self.imdb_page = ''
 
-	def get_image(self):
-		self.image_url = &quot;<A HREF="http://img.ofdb.de/film/">http://img.ofdb.de/film/</A>&quot; + gutils.trim(self.page, 'img src=&quot;<A HREF="http://img.ofdb.de/film/">http://img.ofdb.de/film/</A>', '&quot;' )
-		
-	def get_o_title(self):
-		self.o_title = gutils.clean(gutils.trim(self.page, 'Originaltitel:', '&lt;/tr&gt;'))
-		if self.o_title == '':
-			self.o_title = string.replace(self.o_title, '&nbsp;', '' )
+    def get_image(self):
+        self.image_url = &quot;<A HREF="http://img.ofdb.de/film/">http://img.ofdb.de/film/</A>&quot; + gutils.trim(self.page, 'img src=&quot;<A HREF="http://img.ofdb.de/film/">http://img.ofdb.de/film/</A>', '&quot;' )
+        
+    def get_o_title(self):
+        self.o_title = gutils.clean(gutils.trim(self.page, 'Originaltitel:', '&lt;/tr&gt;'))
+        if self.o_title == '':
+            self.o_title = string.replace(self.o_title, '&nbsp;', '' )
 
-	def get_title(self):
-		self.title = gutils.trim(self.page,'size=&quot;3&quot;&gt;&lt;b&gt;','&lt;')
+    def get_title(self):
+        self.title = gutils.trim(self.page,'size=&quot;3&quot;&gt;&lt;b&gt;','&lt;')
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,&quot;Regie:&quot;,&quot;&lt;/a&gt;&lt;br&gt;&quot;)
+    def get_director(self):
+        self.director = gutils.trim(self.page,&quot;Regie:&quot;,&quot;&lt;/a&gt;&lt;br&gt;&quot;)
 
-	def get_plot(self):
-		storyid = self.regextrim(self.page, '&lt;a href=&quot;plot/', '(&quot;&gt;|[&amp;])')
-		if not storyid is None:
-			story_page = self.open_page(url=&quot;<A HREF="http://www.ofdb.de/plot/%s">http://www.ofdb.de/plot/%s</A>&quot; % (storyid))
-		self.plot = gutils.trim(story_page, &quot;&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot;,&quot;&lt;/&quot;)
+    def get_plot(self):
+        storyid = self.regextrim(self.page, '&lt;a href=&quot;plot/', '(&quot;&gt;|[&amp;])')
+        if not storyid is None:
+            story_page = self.open_page(url=&quot;<A HREF="http://www.ofdb.de/plot/%s">http://www.ofdb.de/plot/%s</A>&quot; % (storyid))
+        self.plot = gutils.trim(story_page, &quot;&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot;,&quot;&lt;/&quot;)
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,&quot;Erscheinungsjahr:&quot;,&quot;&lt;/a&gt;&quot;)
-		self.year = gutils.strip_tags(self.year)
+    def get_year(self):
+        self.year = gutils.trim(self.page,&quot;Erscheinungsjahr:&quot;,&quot;&lt;/a&gt;&quot;)
+        self.year = gutils.strip_tags(self.year)
 
-	def get_runtime(self):
-		# from imdb
-		self.runtime = gutils.trim(self.imdb_page, '&lt;h5&gt;L&auml;nge:&lt;/h5&gt;', ' Min')
+    def get_runtime(self):
+        # from imdb
+        self.runtime = gutils.trim(self.imdb_page, '&lt;h5&gt;L&auml;nge:&lt;/h5&gt;', ' Min')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,&quot;Genre(s):&quot;,&quot;&lt;/table&gt;&quot;)
-		self.genre = string.replace(self.genre, &quot;&lt;br&gt;&quot;, &quot;, &quot;)
-		self.genre = gutils.strip_tags(self.genre)
-		self.genre = string.replace(self.genre, &quot;/&quot;, &quot;, &quot;)
-		self.genre = gutils.clean(self.genre)
-		self.genre = self.genre[0:-1]
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,&quot;Genre(s):&quot;,&quot;&lt;/table&gt;&quot;)
+        self.genre = string.replace(self.genre, &quot;&lt;br&gt;&quot;, &quot;, &quot;)
+        self.genre = gutils.strip_tags(self.genre)
+        self.genre = string.replace(self.genre, &quot;/&quot;, &quot;, &quot;)
+        self.genre = gutils.clean(self.genre)
+        self.genre = self.genre[0:-1]
 
-	def get_cast(self):
-		self.cast = ''
-		movie_id_elements = string.split(self.movie_id, ',')
-		movie_id_elements[0] = string.replace(movie_id_elements[0], &quot;film/&quot;, &quot;&quot;)
-		cast_page = self.open_page(url=&quot;<A HREF="http://www.ofdb.de/view.php?page=film_detail&amp;fid=%s">http://www.ofdb.de/view.php?page=film_detail&amp;fid=%s</A>&quot; % str(movie_id_elements[0]) )
-		self.cast = gutils.trim(cast_page, 'Darsteller&lt;/i&gt;', '&lt;/table&gt;')
-		self.cast = re.sub('(\n|\t|&nbsp;)', '', self.cast)
-		self.cast = string.replace(self.cast, '\t', '')
-		self.cast = string.replace(self.cast, 'class=&quot;Daten&quot;&gt;', '&gt;\n')
-		self.cast = string.strip(gutils.strip_tags(self.cast))
-		self.cast = string.replace(self.cast, '... ', _(' as '))
-		self.cast = gutils.clean(self.cast)
+    def get_cast(self):
+        self.cast = ''
+        movie_id_elements = string.split(self.movie_id, ',')
+        movie_id_elements[0] = string.replace(movie_id_elements[0], &quot;film/&quot;, &quot;&quot;)
+        cast_page = self.open_page(url=&quot;<A HREF="http://www.ofdb.de/view.php?page=film_detail&amp;fid=%s">http://www.ofdb.de/view.php?page=film_detail&amp;fid=%s</A>&quot; % str(movie_id_elements[0]) )
+        self.cast = gutils.trim(cast_page, 'Darsteller&lt;/i&gt;', '&lt;/table&gt;')
+        self.cast = re.sub('(\n|\t|&nbsp;)', '', self.cast)
+        self.cast = string.replace(self.cast, '\t', '')
+        self.cast = string.replace(self.cast, 'class=&quot;Daten&quot;&gt;', '&gt;\n')
+        self.cast = string.strip(gutils.strip_tags(self.cast))
+        self.cast = string.replace(self.cast, '... ', _(' as '))
+        self.cast = gutils.clean(self.cast)
 
-	def get_classification(self):
-		# from imdb
-		self.classification = gutils.trim(gutils.trim(self.imdb_page, 'Altersfreigabe:', '&lt;/div&gt;'), 'Germany:', '&amp;')
+    def get_classification(self):
+        # from imdb
+        self.classification = gutils.trim(gutils.trim(self.imdb_page, 'Altersfreigabe:', '&lt;/div&gt;'), 'Germany:', '&amp;')
 
-	def get_studio(self):
-		# from imdb
-		self.studio = gutils.trim(self.imdb_page, '&lt;h5&gt;Firma:&lt;/h5&gt;', '&lt;/a&gt;')
+    def get_studio(self):
+        # from imdb
+        self.studio = gutils.trim(self.imdb_page, '&lt;h5&gt;Firma:&lt;/h5&gt;', '&lt;/a&gt;')
 
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,&quot;Herstellungsland:&quot;,&quot;&lt;/a&gt;&quot;)
+    def get_country(self):
+        self.country = gutils.trim(self.page,&quot;Herstellungsland:&quot;,&quot;&lt;/a&gt;&quot;)
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page,&quot;&lt;br&gt;Note: &quot;,&quot;&nbsp;&quot;)
-		if self.rating == '':
-			self.rating = &quot;0&quot;
-		self.rating = str(round(float(self.rating)))
+    def get_rating(self):
+        self.rating = gutils.trim(self.page,&quot;&lt;br&gt;Note: &quot;,&quot;&nbsp;&quot;)
+        if self.rating == '':
+            self.rating = &quot;0&quot;
+        self.rating = str(round(float(self.rating)))
 
-	def regextrim(self,text,key1,key2):
-		obj = re.search(key1, text)
-		if obj is None:
-			return ''
-		else:
-			p1 = obj.end()
-		obj = re.search(key2, text[p1:])
-		if obj is None:
-			return ''
-		else:
-			p2 = p1 + obj.start()
-		return text[p1:p2]
+    def regextrim(self,text,key1,key2):
+        obj = re.search(key1, text)
+        if obj is None:
+            return ''
+        else:
+            p1 = obj.end()
+        obj = re.search(key2, text[p1:])
+        if obj is None:
+            return ''
+        else:
+            p2 = p1 + obj.start()
+        return text[p1:p2]
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.original_url_search   = &quot;<A HREF="http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=OTitel&amp;SText=">http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=OTitel&amp;SText=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=DTitel&amp;SText=">http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=DTitel&amp;SText=</A>&quot;
-		self.encode='utf-8'
+    def __init__(self):
+        self.original_url_search   = &quot;<A HREF="http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=OTitel&amp;SText=">http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=OTitel&amp;SText=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=DTitel&amp;SText=">http://www.ofdb.de/view.php?page=suchergebnis&amp;Kat=DTitel&amp;SText=</A>&quot;
+        self.encode='utf-8'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = gutils.trim(self.page,&quot;&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot;, &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;);
-		self.page = string.replace( self.page, &quot;'&quot;, '&quot;' )
-		self.page = string.replace( self.page, '&lt;font size=&quot;1&quot;&gt;', '' )
-		self.page = string.replace( self.page, '&lt;/font&gt;', '' )
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = gutils.trim(self.page,&quot;&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot;, &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;);
+        self.page = string.replace( self.page, &quot;'&quot;, '&quot;' )
+        self.page = string.replace( self.page, '&lt;font size=&quot;1&quot;&gt;', '' )
+        self.page = string.replace( self.page, '&lt;/font&gt;', '' )
+        return self.page
 
-	def get_searches(self):
-		elements = string.split(self.page,&quot;&lt;br&gt;&quot;)
+    def get_searches(self):
+        elements = string.split(self.page,&quot;&lt;br&gt;&quot;)
 
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				elementid = gutils.trim(element,'&lt;a href=&quot;','&quot;')
-				if not elementid is None and not elementid == '':
-					self.ids.append(elementid)
-					elementname = gutils.clean(element)
-					p1 = string.find(elementname, '&gt;')
-					if p1 == -1:
-						self.titles.append(elementname)
-					else:
-						self.titles.append(elementname[p1+1:])
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                elementid = gutils.trim(element,'&lt;a href=&quot;','&quot;')
+                if not elementid is None and not elementid == '':
+                    self.ids.append(elementid)
+                    elementname = gutils.clean(element)
+                    p1 = string.find(elementname, '&gt;')
+                    if p1 == -1:
+                        self.titles.append(elementname)
+                    else:
+                        self.titles.append(elementname[p1+1:])
 
 #
 # Plugin Test
 #
 class SearchPluginTest(SearchPlugin):
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; expected result count }
-	#
-	test_configuration = {
-		'Rocky Balboa'			: 1,
-		'Arahan'				: 3,
-		'gl&#195;&#188;ckliches'			: 2
-	}
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; expected result count }
+    #
+    test_configuration = {
+        'Rocky Balboa'            : 1,
+        'Arahan'                : 3,
+        'gl&#195;&#188;ckliches'            : 2
+    }
 
 class PluginTest:
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; dict { arribute -&gt; value } }
-	#
-	# value: * True/False if attribute only should be tested for any value
-	#        * or the expected value
-	#
-	test_configuration = {
-		'film/103013,Rocky%20Balboa' : { 
-			'title' 			: 'Rocky Balboa',
-			'o_title' 			: 'Rocky Balboa',
-			'director'			: 'Sylvester Stallone',
-			'plot' 				: True,
-			'cast'				: 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute only should be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        'film/103013,Rocky%20Balboa' : { 
+            'title'             : 'Rocky Balboa',
+            'o_title'             : 'Rocky Balboa',
+            'director'            : 'Sylvester Stallone',
+            'plot'                 : True,
+            'cast'                : 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
 Burt Young' + _(' as ') + 'Paulie\n\
 Milo Ventimiglia' + _(' as ') + 'Robert Jr.\n\
 Geraldine Hughes' + (' as ') + 'Marie\n\
@@ -235,25 +235,25 @@
 Lou DiBella\n\
 Joe Cortez\n\
 Ricky Cavazos',
-			'country'			: 'USA',
-			'genre'				: 'Action, Drama, Sportfilm',
-			'classification'	: False,
-			'studio'			: 'Metro-Goldwyn-Mayer (MGM)',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.ofdb.de/film/103013,Rocky%20Balboa">http://www.ofdb.de/film/103013,Rocky%20Balboa</A>',
-			'trailer'			: False,
-			'year'				: 2006,
-			'notes'				: False,
-			'runtime'			: 102,
-			'image'				: True,
-			'rating'			: 8
-		},
-		'film/22489,Ein-Gl%C3%BCckliches-Jahr' : { 
-			'title' 			: 'Gl&#195;&#188;ckliches Jahr, Ein',
-			'o_title' 			: 'Bonne ann&#195;&#169;e, La',
-			'director'			: 'Claude Lelouch',
-			'plot' 				: False,
-			'cast'				: 'Lino Ventura\n\
+            'country'            : 'USA',
+            'genre'                : 'Action, Drama, Sportfilm',
+            'classification'    : False,
+            'studio'            : 'Metro-Goldwyn-Mayer (MGM)',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.ofdb.de/film/103013,Rocky%20Balboa">http://www.ofdb.de/film/103013,Rocky%20Balboa</A>',
+            'trailer'            : False,
+            'year'                : 2006,
+            'notes'                : False,
+            'runtime'            : 102,
+            'image'                : True,
+            'rating'            : 8
+        },
+        'film/22489,Ein-Gl%C3%BCckliches-Jahr' : { 
+            'title'             : 'Gl&#195;&#188;ckliches Jahr, Ein',
+            'o_title'             : 'Bonne ann&#195;&#169;e, La',
+            'director'            : 'Claude Lelouch',
+            'plot'                 : False,
+            'cast'                : 'Lino Ventura\n\
 Fran&#195;&#167;oise Fabian\n\
 Charles G&#195;&#169;rard\n\
 Andr&#195;&#169; Falcon as Le bijoutier\n\
@@ -275,25 +275,25 @@
 Jacques Villedieu\n\
 Harry Walter\n\
 Elie Chouraqui',
-			'country'			: 'Frankreich',
-			'genre'				: 'Kom&#195;&#182;die, Krimi',
-			'classification'	: False,
-			'studio'			: 'Les Films 13',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.ofdb.de/film/22489,Ein-Gl%C3%BCckliches-Jahr">http://www.ofdb.de/film/22489,Ein-Gl%C3%BCckliches-Jahr</A>',
-			'trailer'			: False,
-			'year'				: 1973,
-			'notes'				: False,
-			'runtime'			: 90,
-			'image'				: True,
-			'rating'			: 6
-		},
-		'film/54088,Arahan' : { 
-			'title' 			: 'Arahan',
-			'o_title' 			: 'Arahan jangpung daejakjeon',
-			'director'			: 'Ryoo Seung-wan',
-			'plot' 				: True,
-			'cast'				: 'Ryoo Seung-beom\n\
+            'country'            : 'Frankreich',
+            'genre'                : 'Kom&#195;&#182;die, Krimi',
+            'classification'    : False,
+            'studio'            : 'Les Films 13',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.ofdb.de/film/22489,Ein-Gl%C3%BCckliches-Jahr">http://www.ofdb.de/film/22489,Ein-Gl%C3%BCckliches-Jahr</A>',
+            'trailer'            : False,
+            'year'                : 1973,
+            'notes'                : False,
+            'runtime'            : 90,
+            'image'                : True,
+            'rating'            : 6
+        },
+        'film/54088,Arahan' : { 
+            'title'             : 'Arahan',
+            'o_title'             : 'Arahan jangpung daejakjeon',
+            'director'            : 'Ryoo Seung-wan',
+            'plot'                 : True,
+            'cast'                : 'Ryoo Seung-beom\n\
 Yoon Soy' + _(' as ') + 'Wi-jin\n\
 Ahn Sung-kee' + _(' as ') + 'Ja-woon\n\
 Jung Doo-hong' + _(' as ') + 'Heuk-Woon\n\
@@ -311,17 +311,17 @@
 Im Ha-ryong\n\
 Yoon Do-hyeon\n\
 Lee Choon-yeon',
-			'country'			: 'S&#195;&#188;dkorea',
-			'genre'				: 'Action, Fantasy, Kom&#195;&#182;die',
-			'classification'	: '16',
-			'studio'			: 'Fun and Happiness',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.ofdb.de/film/54088,Arahan">http://www.ofdb.de/film/54088,Arahan</A>',
-			'trailer'			: False,
-			'year'				: 2004,
-			'notes'				: False,
-			'runtime'			: 114,
-			'image'				: True,
-			'rating'			: 7
-		}
-	}
+            'country'            : 'S&#195;&#188;dkorea',
+            'genre'                : 'Action, Fantasy, Kom&#195;&#182;die',
+            'classification'    : '16',
+            'studio'            : 'Fun and Happiness',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.ofdb.de/film/54088,Arahan">http://www.ofdb.de/film/54088,Arahan</A>',
+            'trailer'            : False,
+            'year'                : 2004,
+            'notes'                : False,
+            'runtime'            : 114,
+            'image'                : True,
+            'rating'            : 7
+        }
+    }

Modified: trunk/lib/plugins/movie/PluginMovieOnet.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieOnet.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieOnet.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -34,129 +34,129 @@
 plugin_version      = '1.7'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode = 'iso-8859-2'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://film.onet.pl/%s">http://film.onet.pl/%s</A>&quot; % str(self.movie_id)
+    def __init__(self, id):
+        self.encode = 'iso-8859-2'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://film.onet.pl/%s">http://film.onet.pl/%s</A>&quot; % str(self.movie_id)
 
-	def get_image(self):
-		self.movie_id = '' # problems with decoding polish characters in UTF8 =&gt; forget ID
+    def get_image(self):
+        self.movie_id = '' # problems with decoding polish characters in UTF8 =&gt; forget ID
 
-		self.image_url = ''
-		pos = string.find(self.page, 'alt=&quot;Galeria&quot; border=1 src=&quot;')
-		if pos &gt; 0:
-			self.image_url = &quot;<A HREF="http://film.onet.pl/%s">http://film.onet.pl/%s</A>&quot; % gutils.trim(self.page[pos:], 'src=&quot;', '&quot;')
-			return
-		pos = string.find(self.page, 'IMG class=pic alt=\&quot;Plakat&quot;')
-		if pos &gt; 0:
-			self.image_url = &quot;<A HREF="http://film.onet.pl/%s">http://film.onet.pl/%s</A>&quot; % gutils.trim(self.page[pos:], 'src=&quot;', '&quot;&gt;')
+        self.image_url = ''
+        pos = string.find(self.page, 'alt=&quot;Galeria&quot; border=1 src=&quot;')
+        if pos &gt; 0:
+            self.image_url = &quot;<A HREF="http://film.onet.pl/%s">http://film.onet.pl/%s</A>&quot; % gutils.trim(self.page[pos:], 'src=&quot;', '&quot;')
+            return
+        pos = string.find(self.page, 'IMG class=pic alt=\&quot;Plakat&quot;')
+        if pos &gt; 0:
+            self.image_url = &quot;<A HREF="http://film.onet.pl/%s">http://film.onet.pl/%s</A>&quot; % gutils.trim(self.page[pos:], 'src=&quot;', '&quot;&gt;')
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;&lt;B&gt;', '&lt;/B&gt;')
-		if self.o_title == '':
-			self.o_title = self.get_title(True)
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;&lt;B&gt;', '&lt;/B&gt;')
+        if self.o_title == '':
+            self.o_title = self.get_title(True)
 
-	def get_title(self, ret=False):
-		data = gutils.trim(self.page, '&lt;TITLE&gt;', ' - Onet.pl Film&lt;/TITLE&gt;')
-		if ret is True:
-			return data
-		else:
-			self.title = data
+    def get_title(self, ret=False):
+        data = gutils.trim(self.page, '&lt;TITLE&gt;', ' - Onet.pl Film&lt;/TITLE&gt;')
+        if ret is True:
+            return data
+        else:
+            self.title = data
 
-	def get_director(self):
-		self.director = gutils.trim(self.page, '&lt;BR&gt;Re\xbfyseria:&nbsp;&nbsp;', '&lt;BR&gt;')
-		if string.find(self.director, '--&gt;') &lt;&gt; -1:
-			self.director = gutils.after(self.director, '--&gt;')
-			self.director = gutils.before(self.director,&quot;&lt;!--&quot;)
-		else:
-			self.director = gutils.after(self.director, '&lt;B&gt;')
-			self.director = gutils.before(self.director, '&lt;/B&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page, '&lt;BR&gt;Re\xbfyseria:&nbsp;&nbsp;', '&lt;BR&gt;')
+        if string.find(self.director, '--&gt;') &lt;&gt; -1:
+            self.director = gutils.after(self.director, '--&gt;')
+            self.director = gutils.before(self.director,&quot;&lt;!--&quot;)
+        else:
+            self.director = gutils.after(self.director, '&lt;B&gt;')
+            self.director = gutils.before(self.director, '&lt;/B&gt;')
 
-	def get_plot(self):
-		pos = string.find(self.page, '&lt;TD class=tym&gt;Tre\xb7\xe6&lt;/TD&gt;')
-		if pos &gt; 0:
-			self.plot = self.page[pos:]
-			self.plot = gutils.trim(self.plot, '&lt;DIV class=a2&gt;', '&lt;/DIV&gt;')
-			return
-		pos = string.find(self.page, '&gt;Recenzje&lt;/FONT&gt;&nbsp;')
-		if pos &gt; 0:
-			self.plot = self.page[pos:]
-			self.plot = gutils.trim(self.plot, '&lt;TD class=a1 colspan=3&gt;', '&lt;A class=&quot;ar&quot; ')
-		else:
-			self.plot = ''
+    def get_plot(self):
+        pos = string.find(self.page, '&lt;TD class=tym&gt;Tre\xb7\xe6&lt;/TD&gt;')
+        if pos &gt; 0:
+            self.plot = self.page[pos:]
+            self.plot = gutils.trim(self.plot, '&lt;DIV class=a2&gt;', '&lt;/DIV&gt;')
+            return
+        pos = string.find(self.page, '&gt;Recenzje&lt;/FONT&gt;&nbsp;')
+        if pos &gt; 0:
+            self.plot = self.page[pos:]
+            self.plot = gutils.trim(self.plot, '&lt;TD class=a1 colspan=3&gt;', '&lt;A class=&quot;ar&quot; ')
+        else:
+            self.plot = ''
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;',')&lt;BR&gt;')
-		self.year = gutils.after(self.year, '&lt;/B&gt; (')
-		self.year = gutils.after(self.year, ', ')
+    def get_year(self):
+        self.year = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;',')&lt;BR&gt;')
+        self.year = gutils.after(self.year, '&lt;/B&gt; (')
+        self.year = gutils.after(self.year, ', ')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, 'color=&quot;#666666&quot;&gt;czas ',' min.')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, 'color=&quot;#666666&quot;&gt;czas ',' min.')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;', '&lt;BR&gt;&lt;SPAN class=a1&gt;')
-		self.genre = gutils.after(self.genre, '&lt;BR&gt;')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;', '&lt;BR&gt;&lt;SPAN class=a1&gt;')
+        self.genre = gutils.after(self.genre, '&lt;BR&gt;')
 
-	def get_cast(self):
-		self.cast = &quot;&lt;%s&quot; % gutils.trim(self.page,'#FF7902&quot;&gt;Obsada&lt;', '&lt;DIV ')
-		self.cast = string.replace(self.cast, '&lt;/A&gt; - ', _(' as '))
-		self.cast = string.replace(self.cast, '&lt;A class=u ', &quot;\n&lt;a &quot;)
-		self.cast = string.strip(gutils.strip_tags(self.cast))
-		self.cast = self.cast[18:]
+    def get_cast(self):
+        self.cast = &quot;&lt;%s&quot; % gutils.trim(self.page,'#FF7902&quot;&gt;Obsada&lt;', '&lt;DIV ')
+        self.cast = string.replace(self.cast, '&lt;/A&gt; - ', _(' as '))
+        self.cast = string.replace(self.cast, '&lt;A class=u ', &quot;\n&lt;a &quot;)
+        self.cast = string.strip(gutils.strip_tags(self.cast))
+        self.cast = self.cast[18:]
 
-	def get_classification(self):
-		self.classification = ''
+    def get_classification(self):
+        self.classification = ''
 
-	def get_studio(self):
-		self.studio = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = ''
+    def get_trailer(self):
+        self.trailer = ''
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;', ')&lt;BR&gt;')
-		self.country = gutils.after(self.country,&quot;(&quot;)
-		self.country = gutils.before(self.country,&quot;,&quot;)
+    def get_country(self):
+        self.country = gutils.trim(self.page, 'class=a2 valign=top width=&quot;100%&quot;&gt;', ')&lt;BR&gt;')
+        self.country = gutils.after(self.country,&quot;(&quot;)
+        self.country = gutils.before(self.country,&quot;,&quot;)
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '&gt;Ocena filmu&lt;/TD&gt;', 'g\xb3os\xf3w)')
-		self.rating = gutils.after(self.rating, '&lt;BR&gt;&lt;B&gt;')
-		self.rating = gutils.before(self.rating, '/5&lt;/B&gt;')
-		if self.rating != '':
-			self.rating = str( float(self.rating)*2 )
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '&gt;Ocena filmu&lt;/TD&gt;', 'g\xb3os\xf3w)')
+        self.rating = gutils.after(self.rating, '&lt;BR&gt;&lt;B&gt;')
+        self.rating = gutils.before(self.rating, '/5&lt;/B&gt;')
+        if self.rating != '':
+            self.rating = str( float(self.rating)*2 )
 
-	def get_notes(self):
-		self.notes = ''
+    def get_notes(self):
+        self.notes = ''
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode = 'iso-8859-2'
-		self.original_url_search	= '<A HREF="http://film.onet.pl/filmoteka.html?O=0&amp;S=">http://film.onet.pl/filmoteka.html?O=0&amp;S=</A>'
-		self.translated_url_search	= '<A HREF="http://film.onet.pl/filmoteka.html?O=1&amp;S=">http://film.onet.pl/filmoteka.html?O=1&amp;S=</A>'
+    def __init__(self):
+        self.encode = 'iso-8859-2'
+        self.original_url_search    = '<A HREF="http://film.onet.pl/filmoteka.html?O=0&amp;S=">http://film.onet.pl/filmoteka.html?O=0&amp;S=</A>'
+        self.translated_url_search    = '<A HREF="http://film.onet.pl/filmoteka.html?O=1&amp;S=">http://film.onet.pl/filmoteka.html?O=1&amp;S=</A>'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = gutils.trim(self.page, '&gt;Wynik wyszukiwania&lt;', '&lt;TABLE border=0 cellpadding=0');
-		self.page = gutils.after(self.page, '&lt;/SPAN&gt;&lt;/DIV&gt;&lt;BR&gt;');
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = gutils.trim(self.page, '&gt;Wynik wyszukiwania&lt;', '&lt;TABLE border=0 cellpadding=0');
+        self.page = gutils.after(self.page, '&lt;/SPAN&gt;&lt;/DIV&gt;&lt;BR&gt;');
+        return self.page
 
-	def get_searches(self):
-		elements = string.split(self.page, ' class=pic')
-		self.number_results = elements[-1]
+    def get_searches(self):
+        elements = string.split(self.page, ' class=pic')
+        self.number_results = elements[-1]
 
-		if (elements[0]&lt;&gt;''):
-			for element in elements:
-				self.ids.append(gutils.trim(element, 'class=a2 width=&quot;100%&quot;&gt;&lt;A href=&quot;','&quot; class=u'))
-				element = gutils.trim(element, 'class=u&gt;&lt;B&gt;', '&lt;/B&gt;')
-				element = gutils.strip_tags(element)
-				self.titles.append(element)
-		else:
-			self.number_results = 0
+        if (elements[0]&lt;&gt;''):
+            for element in elements:
+                self.ids.append(gutils.trim(element, 'class=a2 width=&quot;100%&quot;&gt;&lt;A href=&quot;','&quot; class=u'))
+                element = gutils.trim(element, 'class=u&gt;&lt;B&gt;', '&lt;/B&gt;')
+                element = gutils.strip_tags(element)
+                self.titles.append(element)
+        else:
+            self.number_results = 0
 
 # vim: fenc=iso-8859-2

Modified: trunk/lib/plugins/movie/PluginMoviePTGate.py
===================================================================
--- trunk/lib/plugins/movie/PluginMoviePTGate.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMoviePTGate.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -35,99 +35,99 @@
 plugin_version = &quot;0.4.1&quot;
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://cinema.ptgate.pt/filme.php?code=">http://cinema.ptgate.pt/filme.php?code=</A>&quot; + str(self.movie_id)
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://cinema.ptgate.pt/filme.php?code=">http://cinema.ptgate.pt/filme.php?code=</A>&quot; + str(self.movie_id)
 
-	def get_image(self):
-		self.image_url = &quot;<A HREF="http://cinema.ptgate.pt/Movies/">http://cinema.ptgate.pt/Movies/</A>&quot; + str(self.movie_id)+&quot;.jpg&quot;
+    def get_image(self):
+        self.image_url = &quot;<A HREF="http://cinema.ptgate.pt/Movies/">http://cinema.ptgate.pt/Movies/</A>&quot; + str(self.movie_id)+&quot;.jpg&quot;
 
-	def get_o_title(self):
-		self.o_title = string.capwords(gutils.trim(self.page,&quot;&lt;b class=title&gt;&quot;,&quot;&lt;/b&gt;&lt;br&gt;&quot;) )
+    def get_o_title(self):
+        self.o_title = string.capwords(gutils.trim(self.page,&quot;&lt;b class=title&gt;&quot;,&quot;&lt;/b&gt;&lt;br&gt;&quot;) )
 
-	def get_title(self):
-		self.title = string.capwords(gutils.trim(self.page,&quot;class=subtitle&gt;&quot;,&quot;&lt;/b&gt;&lt;br&gt;&quot;) )
+    def get_title(self):
+        self.title = string.capwords(gutils.trim(self.page,&quot;class=subtitle&gt;&quot;,&quot;&lt;/b&gt;&lt;br&gt;&quot;) )
 
-	def get_director(self):
-		self.director = gutils.trim(self.page,&quot;&lt;b&gt;realiza&#231;&#227;o&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;)
+    def get_director(self):
+        self.director = gutils.trim(self.page,&quot;&lt;b&gt;realiza&#231;&#227;o&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;&quot;)
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,&quot;&lt;b&gt;sinopse&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&quot;)
-		self.plot = string.replace(self.plot,&quot;'&quot;,&quot;\&quot;&quot;)
-		self.plot = string.replace(self.plot,&quot;'&quot;,&quot;\&quot;&quot;)
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,&quot;&lt;b&gt;sinopse&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&quot;)
+        self.plot = string.replace(self.plot,&quot;'&quot;,&quot;\&quot;&quot;)
+        self.plot = string.replace(self.plot,&quot;'&quot;,&quot;\&quot;&quot;)
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,&quot;&lt;br&gt;&lt;b&gt;ano&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;pa&quot;)
+    def get_year(self):
+        self.year = gutils.trim(self.page,&quot;&lt;br&gt;&lt;b&gt;ano&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;pa&quot;)
 
-	def get_runtime(self):
-		self.runtime = &quot;&quot;
+    def get_runtime(self):
+        self.runtime = &quot;&quot;
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,&quot;nero&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;realiza&quot;)
-		self.genre = string.replace(self.genre,&quot; | &quot;,&quot;, &quot;)
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,&quot;nero&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;realiza&quot;)
+        self.genre = string.replace(self.genre,&quot; | &quot;,&quot;, &quot;)
 
-	def get_cast(self):
-		self.cast = &quot;&quot;
-		self.cast = gutils.trim(self.page,&quot;pretes&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;data de estreia&lt;/b&gt;&lt;br&gt;&quot;)
-		self.cast = string.replace(self.cast,&quot;&lt;br&gt; &quot;,&quot;\n&quot;)
-		self.cast = string.replace(self.cast,&quot;&lt;br&gt;&quot;, &quot;\n&quot;)
-		self.cast = gutils.strip_tags(self.cast)
+    def get_cast(self):
+        self.cast = &quot;&quot;
+        self.cast = gutils.trim(self.page,&quot;pretes&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;data de estreia&lt;/b&gt;&lt;br&gt;&quot;)
+        self.cast = string.replace(self.cast,&quot;&lt;br&gt; &quot;,&quot;\n&quot;)
+        self.cast = string.replace(self.cast,&quot;&lt;br&gt;&quot;, &quot;\n&quot;)
+        self.cast = gutils.strip_tags(self.cast)
 
-	def get_classification(self):
-		self.classification = &quot;&quot;
+    def get_classification(self):
+        self.classification = &quot;&quot;
 
-	def get_studio(self):
-		self.studio = &quot;&quot;
+    def get_studio(self):
+        self.studio = &quot;&quot;
 
-	def get_o_site(self):
-		self.o_site = gutils.trim(self.page,&quot;tio oficial&lt;/b&gt;&lt;br&gt;&lt;a class=external href='&quot;, &quot;'&gt;&quot;)
+    def get_o_site(self):
+        self.o_site = gutils.trim(self.page,&quot;tio oficial&lt;/b&gt;&lt;br&gt;&lt;a class=external href='&quot;, &quot;'&gt;&quot;)
 
-	def get_site(self):
-		self.site = gutils.trim(self.page,&quot;&lt;br&gt;&lt;b&gt;imdb&lt;/b&gt;&lt;br&gt;&lt;a class=external href='&quot;, &quot;'&gt;www.imdb.com&quot;)
+    def get_site(self):
+        self.site = gutils.trim(self.page,&quot;&lt;br&gt;&lt;b&gt;imdb&lt;/b&gt;&lt;br&gt;&lt;a class=external href='&quot;, &quot;'&gt;www.imdb.com&quot;)
 
-	def get_trailer(self):
-		self.trailer = gutils.trim(self.page,&quot;trailer&lt;/b&gt;&lt;br&gt;&lt;a class=external href='&quot;, &quot;'&gt;visionar&quot;)
+    def get_trailer(self):
+        self.trailer = gutils.trim(self.page,&quot;trailer&lt;/b&gt;&lt;br&gt;&lt;a class=external href='&quot;, &quot;'&gt;visionar&quot;)
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,&quot;s&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;g&quot;)
-		
-	def get_notes(self):
-		self.notes = gutils.trim(self.page,&quot;pr&#233;mios e nomea&#231;&#245;es&lt;/b&gt;&lt;br&gt;&lt;b&gt;&quot;, &quot;&lt;td width=6 background='Images/group_r.gif'&quot;)
-		self.notes = gutils.strip_tags(self.notes)
+    def get_country(self):
+        self.country = gutils.trim(self.page,&quot;s&lt;/b&gt;&lt;br&gt;&quot;,&quot;&lt;br&gt;&lt;br&gt;&lt;b&gt;g&quot;)
+        
+    def get_notes(self):
+        self.notes = gutils.trim(self.page,&quot;pr&#233;mios e nomea&#231;&#245;es&lt;/b&gt;&lt;br&gt;&lt;b&gt;&quot;, &quot;&lt;td width=6 background='Images/group_r.gif'&quot;)
+        self.notes = gutils.strip_tags(self.notes)
 
-	def get_rating(self):
-		tmp=gutils.trim(self.page,&quot;'Images/mstar&quot;,&quot;.gif&quot;)
-		if(tmp):
-			self.rating = float(tmp)
-			if (self.rating&gt;10):
-				self.rating = int(self.rating/10)
-				self.rating = self.rating*2
-		else:
-			self.rating=&quot;&quot;
+    def get_rating(self):
+        tmp=gutils.trim(self.page,&quot;'Images/mstar&quot;,&quot;.gif&quot;)
+        if(tmp):
+            self.rating = float(tmp)
+            if (self.rating&gt;10):
+                self.rating = int(self.rating/10)
+                self.rating = self.rating*2
+        else:
+            self.rating=&quot;&quot;
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.original_url_search	= &quot;<A HREF="http://cinema.ptgate.pt/pesquisa-filme.php?titulo=">http://cinema.ptgate.pt/pesquisa-filme.php?titulo=</A>&quot;
-		self.translated_url_search	= &quot;<A HREF="http://cinema.ptgate.pt/pesquisa-filme.php?titulo=">http://cinema.ptgate.pt/pesquisa-filme.php?titulo=</A>&quot;
-		self.encode='iso-8859-1'
+    def __init__(self):
+        self.original_url_search    = &quot;<A HREF="http://cinema.ptgate.pt/pesquisa-filme.php?titulo=">http://cinema.ptgate.pt/pesquisa-filme.php?titulo=</A>&quot;
+        self.translated_url_search    = &quot;<A HREF="http://cinema.ptgate.pt/pesquisa-filme.php?titulo=">http://cinema.ptgate.pt/pesquisa-filme.php?titulo=</A>&quot;
+        self.encode='iso-8859-1'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.sub_search()
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.sub_search()
+        return self.page
 
-	def sub_search(self):
-		self.page = gutils.trim(self.page,&quot;&lt;!-- DISPLAY RESULTS --&gt;&quot;, &quot;&lt;!-- /DISPLAY RESULTS --&gt;&quot;)
+    def sub_search(self):
+        self.page = gutils.trim(self.page,&quot;&lt;!-- DISPLAY RESULTS --&gt;&quot;, &quot;&lt;!-- /DISPLAY RESULTS --&gt;&quot;)
 
-	def get_searches(self):
-		elements = string.split(self.page,&quot;&lt;/td&gt;&lt;td&gt;&quot;)
-		self.number_results = elements[-1]
+    def get_searches(self):
+        elements = string.split(self.page,&quot;&lt;/td&gt;&lt;td&gt;&quot;)
+        self.number_results = elements[-1]
 
-		if (len(elements[0])):
-			for element in elements:
-				element = string.replace(element,&quot;&lt;/a&gt;&quot;,&quot;&quot;)
-				self.ids.append(gutils.trim(element,&quot;?code=&quot;,&quot;'&gt;&quot;))
-				self.titles.append(gutils.convert_entities(gutils.trim(element,&quot;'&gt;&quot;,&quot;&lt;/td&gt;&lt;td width=6&quot;)))
-		else:
-			self.number_results = 0
+        if (len(elements[0])):
+            for element in elements:
+                element = string.replace(element,&quot;&lt;/a&gt;&quot;,&quot;&quot;)
+                self.ids.append(gutils.trim(element,&quot;?code=&quot;,&quot;'&gt;&quot;))
+                self.titles.append(gutils.convert_entities(gutils.trim(element,&quot;'&gt;&quot;,&quot;&lt;/td&gt;&lt;td width=6&quot;)))
+        else:
+            self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieStopklatka.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieStopklatka.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieStopklatka.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -34,103 +34,103 @@
 plugin_version      = '1.9'
 
 class Plugin(movie.Movie):
-	IMAGE_PATTERN = re.compile('(<A HREF="http://img.stopklatka.pl/film/.*?">http://img.stopklatka.pl/film/.*?</A>)&quot;')
+    IMAGE_PATTERN = re.compile('(<A HREF="http://img.stopklatka.pl/film/.*?">http://img.stopklatka.pl/film/.*?</A>)&quot;')
 
-	def __init__(self, id):
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.stopklatka.pl/film/film.asp?fi=%s">http://www.stopklatka.pl/film/film.asp?fi=%s</A>&quot; % str(self.movie_id)
-		self.encode = 'iso-8859-2' # with some cp-1250 data (sic!)
+    def __init__(self, id):
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.stopklatka.pl/film/film.asp?fi=%s">http://www.stopklatka.pl/film/film.asp?fi=%s</A>&quot; % str(self.movie_id)
+        self.encode = 'iso-8859-2' # with some cp-1250 data (sic!)
 
-	def initialize(self):
-		self.page = self.page.replace('\x9c','&#197;&#155;')
-		self.page = self.page.replace('&#197;&#161;','&#196;&#133;')
+    def initialize(self):
+        self.page = self.page.replace('\x9c','&#197;&#155;')
+        self.page = self.page.replace('&#197;&#161;','&#196;&#133;')
 
-	def get_image(self):
-		image = self.IMAGE_PATTERN.findall(self.page)
-		if len(image):
-			self.image_url = image[0]
+    def get_image(self):
+        image = self.IMAGE_PATTERN.findall(self.page)
+        if len(image):
+            self.image_url = image[0]
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;h2&gt; (', ')&lt;/h2&gt;')
-		if self.o_title == '':
-			self.o_title = self.get_title(True)
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;h2&gt; (', ')&lt;/h2&gt;')
+        if self.o_title == '':
+            self.o_title = self.get_title(True)
 
-	def get_title(self, ret=False):
-		data = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
-		if ret is True:
-			return data
-		else:
-			self.title = data
+    def get_title(self, ret=False):
+        data = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
+        if ret is True:
+            return data
+        else:
+            self.title = data
 
-	def get_director(self):
-		self.director = gutils.trim(self.page, '&gt;re\xbfyseria:&lt;', '&lt;/td&gt;&lt;/tr&gt;')
-		self.director = gutils.after(self.director, '&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page, '&gt;re\xbfyseria:&lt;', '&lt;/td&gt;&lt;/tr&gt;')
+        self.director = gutils.after(self.director, '&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '&lt;p&gt;', '&lt;/p&gt;')
-		self.plot = gutils.before(self.plot, '&lt;b&gt;Wi\xEAcej ')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '&lt;p&gt;', '&lt;/p&gt;')
+        self.plot = gutils.before(self.plot, '&lt;b&gt;Wi\xEAcej ')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&gt;rok produkcji:&lt;', '&lt;/span&gt;')
-		self.year = gutils.after(self.year, '&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&gt;rok produkcji:&lt;', '&lt;/span&gt;')
+        self.year = gutils.after(self.year, '&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, 'trwania:&lt;', ' min&lt;')
-		self.runtime = gutils.after(self.runtime, '&gt;')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, 'trwania:&lt;', ' min&lt;')
+        self.runtime = gutils.after(self.runtime, '&gt;')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '&gt;gatunek:&lt;', '&lt;/span&gt;')
-		self.genre = gutils.after(self.genre, '&gt;')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, '&gt;gatunek:&lt;', '&lt;/span&gt;')
+        self.genre = gutils.after(self.genre, '&gt;')
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page, '&gt;obsada:&lt;', '&lt;/td&gt;&lt;/tr&gt;')
-		self.cast = gutils.after(self.cast, '&gt;')
-		self.cast = string.replace(self.cast, ', ', &quot;\n&quot;)
-		self.cast = gutils.before(self.cast, '&lt;b&gt;Wi\xEAcej ')
+    def get_cast(self):
+        self.cast = gutils.trim(self.page, '&gt;obsada:&lt;', '&lt;/td&gt;&lt;/tr&gt;')
+        self.cast = gutils.after(self.cast, '&gt;')
+        self.cast = string.replace(self.cast, ', ', &quot;\n&quot;)
+        self.cast = gutils.before(self.cast, '&lt;b&gt;Wi\xEAcej ')
 
-	def get_classification(self):
-		self.classification = ''
+    def get_classification(self):
+        self.classification = ''
 
-	def get_studio(self):
-		self.studio = &quot;&quot;
+    def get_studio(self):
+        self.studio = &quot;&quot;
 
-	def get_o_site(self):
-		self.o_site = gutils.trim(self.page,&quot;&gt;strona oficjalna:&lt;&quot;,&quot; target=_blank&quot;)
-		self.o_site = gutils.after(self.o_site,&quot;href=&quot;)
+    def get_o_site(self):
+        self.o_site = gutils.trim(self.page,&quot;&gt;strona oficjalna:&lt;&quot;,&quot; target=_blank&quot;)
+        self.o_site = gutils.after(self.o_site,&quot;href=&quot;)
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = &quot;<A HREF="http://www.stopklatka.pl/film/film.asp?fi=">http://www.stopklatka.pl/film/film.asp?fi=</A>&quot; + self.movie_id + &quot;&amp;sekcja=mmedia&quot;
+    def get_trailer(self):
+        self.trailer = &quot;<A HREF="http://www.stopklatka.pl/film/film.asp?fi=">http://www.stopklatka.pl/film/film.asp?fi=</A>&quot; + self.movie_id + &quot;&amp;sekcja=mmedia&quot;
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, '&gt;kraj:&lt;', '&lt;/span&gt;')
-		self.country = gutils.after(self.country, '&gt;')
+    def get_country(self):
+        self.country = gutils.trim(self.page, '&gt;kraj:&lt;', '&lt;/span&gt;')
+        self.country = gutils.after(self.country, '&gt;')
 
-	def get_rating(self):
-		self.rating = '0'
+    def get_rating(self):
+        self.rating = '0'
 
-	def get_notes(self):
-		self.notes = ''
+    def get_notes(self):
+        self.notes = ''
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode='iso-8859-2'
-		self.original_url_search	= &quot;<A HREF="http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=">http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=</A>&quot;
-		self.translated_url_search	= &quot;<A HREF="http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=">http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=</A>&quot;
+    def __init__(self):
+        self.encode='iso-8859-2'
+        self.original_url_search    = &quot;<A HREF="http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=">http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=</A>&quot;
+        self.translated_url_search    = &quot;<A HREF="http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=">http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&amp;szukaj=</A>&quot;
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = gutils.trim(self.page, '&gt;Wyniki poszukiwania frazy:', '&lt;/div&gt;');
-		self.page = self.page.replace('\x9c','&#197;&#155;')
-		self.page = self.page.replace('&#197;&#161;','&#196;&#133;')
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = gutils.trim(self.page, '&gt;Wyniki poszukiwania frazy:', '&lt;/div&gt;');
+        self.page = self.page.replace('\x9c','&#197;&#155;')
+        self.page = self.page.replace('&#197;&#161;','&#196;&#133;')
+        return self.page
 
-	def get_searches(self):
-		elements = re.findall(&quot;&quot;&quot;/film/film.asp\?fi=(\d+)&quot;&gt;.*?searchTitle\s*textB&quot;&gt;(.*?)&lt;/span&quot;&quot;&quot;, self.page)
-		self.number_results = len(elements)
+    def get_searches(self):
+        elements = re.findall(&quot;&quot;&quot;/film/film.asp\?fi=(\d+)&quot;&gt;.*?searchTitle\s*textB&quot;&gt;(.*?)&lt;/span&quot;&quot;&quot;, self.page)
+        self.number_results = len(elements)
 
-		for element in elements:
-			self.ids.append(element[0])
-			self.titles.append(element[1])
+        for element in elements:
+            self.ids.append(element[0])
+            self.titles.append(element[1])

Modified: trunk/lib/plugins/movie/PluginMovieTanukiAnime.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -34,132 +34,132 @@
 plugin_version      = '1.3'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		if str(id).find('<A HREF="http://">http://</A>') != -1:
-			self.movie_id = 'TA'
-			self.url = str(id)
-		else:
-			self.movie_id = str(id)
-			self.url = &quot;<A HREF="http://anime.tanuki.pl/strony/anime/%s">http://anime.tanuki.pl/strony/anime/%s</A>&quot; % str(id)
-		self.encode='UTF-8'
-	
-	def initialize(self):
-		if self.movie_id == 'TA':
-			self.movie_id = gutils.trim(self.page, '&quot;&gt;&lt;a href=&quot;/strony/anime/', '/oceny')
-			self.url = &quot;<A HREF="http://anime.tanuki.pl/strony/anime/%s">http://anime.tanuki.pl/strony/anime/%s</A>&quot; % self.movie_id
+    def __init__(self, id):
+        if str(id).find('<A HREF="http://">http://</A>') != -1:
+            self.movie_id = 'TA'
+            self.url = str(id)
+        else:
+            self.movie_id = str(id)
+            self.url = &quot;<A HREF="http://anime.tanuki.pl/strony/anime/%s">http://anime.tanuki.pl/strony/anime/%s</A>&quot; % str(id)
+        self.encode='UTF-8'
+    
+    def initialize(self):
+        if self.movie_id == 'TA':
+            self.movie_id = gutils.trim(self.page, '&quot;&gt;&lt;a href=&quot;/strony/anime/', '/oceny')
+            self.url = &quot;<A HREF="http://anime.tanuki.pl/strony/anime/%s">http://anime.tanuki.pl/strony/anime/%s</A>&quot; % self.movie_id
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page, '&lt;img src=&quot;/screens/', '&lt;br /&gt;')
-		self.image_url = gutils.before(self.image_url, '&quot;')
-		self.image_url = &quot;<A HREF="http://anime.tanuki.pl/screens/%s">http://anime.tanuki.pl/screens/%s</A>&quot; % self.image_url
+    def get_image(self):
+        self.image_url = gutils.trim(self.page, '&lt;img src=&quot;/screens/', '&lt;br /&gt;')
+        self.image_url = gutils.before(self.image_url, '&quot;')
+        self.image_url = &quot;<A HREF="http://anime.tanuki.pl/screens/%s">http://anime.tanuki.pl/screens/%s</A>&quot; % self.image_url
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;h3 class=&quot;animename&quot;', '&lt;/h3&gt;')
-		self.o_title = gutils.after(self.o_title, '&gt;')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;h3 class=&quot;animename&quot;', '&lt;/h3&gt;')
+        self.o_title = gutils.after(self.o_title, '&gt;')
 
-	def get_title(self):
-		self.title = self.o_title
+    def get_title(self):
+        self.title = self.o_title
 
-	def get_director(self):
-		self.director = gutils.trim(self.page, &quot;&lt;th scope=\&quot;row\&quot;&gt;Re&#197;&#188;yser:&lt;/th&gt;\n\t&lt;td&gt;&quot;, '&lt;/td&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.page, &quot;&lt;th scope=\&quot;row\&quot;&gt;Re&#197;&#188;yser:&lt;/th&gt;\n\t&lt;td&gt;&quot;, '&lt;/td&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, &quot;&lt;div class=\&quot;copycat\&quot;&gt;\n&quot;, '&lt;/div&gt;')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, &quot;&lt;div class=\&quot;copycat\&quot;&gt;\n&quot;, '&lt;/div&gt;')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,'&lt;div class=\&quot;sitem\&quot;&gt;Rok wydania: &lt;', '&lt;/a&gt;')
-		self.year = gutils.after(self.year, '&gt;')
+    def get_year(self):
+        self.year = gutils.trim(self.page,'&lt;div class=\&quot;sitem\&quot;&gt;Rok wydania: &lt;', '&lt;/a&gt;')
+        self.year = gutils.after(self.year, '&gt;')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, &quot;&lt;div class=\&quot;sitem\&quot;&gt;Czas trwania: &lt;b&gt;\n\t\t&quot;, '\n&lt;/b&gt;')
-		if self.runtime.find('?') != -1:
-			self.runtime = ''
-		else:
-			self.runtime = gutils.after(self.runtime, '&#195;&#151;')
-			self.runtime = gutils.before(self.runtime, ' min')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, &quot;&lt;div class=\&quot;sitem\&quot;&gt;Czas trwania: &lt;b&gt;\n\t\t&quot;, '\n&lt;/b&gt;')
+        if self.runtime.find('?') != -1:
+            self.runtime = ''
+        else:
+            self.runtime = gutils.after(self.runtime, '&#195;&#151;')
+            self.runtime = gutils.before(self.runtime, ' min')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, &quot;&lt;div class=\&quot;sitem\&quot;&gt;Gatunki:\n\t\t&quot;, '&lt;/div&gt;')
-		self.genre = string.replace(self.genre, &quot;\t\t&quot;, ' ')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, &quot;&lt;div class=\&quot;sitem\&quot;&gt;Gatunki:\n\t\t&quot;, '&lt;/div&gt;')
+        self.genre = string.replace(self.genre, &quot;\t\t&quot;, ' ')
 
-	def get_cast(self):
-		self.cast = ''
+    def get_cast(self):
+        self.cast = ''
 
-	def get_classification(self):
-		self.classification = ''
+    def get_classification(self):
+        self.classification = ''
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page, &quot;&lt;th scope=\&quot;row\&quot;&gt;Studio:&lt;/th&gt;\n\t&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
+    def get_studio(self):
+        self.studio = gutils.trim(self.page, &quot;&lt;th scope=\&quot;row\&quot;&gt;Studio:&lt;/th&gt;\n\t&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = ''
+    def get_trailer(self):
+        self.trailer = ''
 
-	def get_country(self):
-		self.country = ''
+    def get_country(self):
+        self.country = ''
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, ' alt=&quot;Ocena ', '/10')
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, ' alt=&quot;Ocena ', '/10')
 
-	def get_notes(self):
-		self.notes = &quot;Czas trwania: &quot; + gutils.trim(self.page,&quot;&lt;div class=\&quot;sitem\&quot;&gt;Czas trwania: &lt;b&gt;\n\t\t&quot;,&quot;\n&lt;/b&gt;&quot;) + '\n'
+    def get_notes(self):
+        self.notes = &quot;Czas trwania: &quot; + gutils.trim(self.page,&quot;&lt;div class=\&quot;sitem\&quot;&gt;Czas trwania: &lt;b&gt;\n\t\t&quot;,&quot;\n&lt;/b&gt;&quot;) + '\n'
 
-		t = self.page.find(&quot;&lt;tr&gt;&lt;th scope=\&quot;row\&quot;&gt;Autor:&lt;/th&gt;&quot;)
-		if t != -1:
-			self.notes += &quot;Autor: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
+        t = self.page.find(&quot;&lt;tr&gt;&lt;th scope=\&quot;row\&quot;&gt;Autor:&lt;/th&gt;&quot;)
+        if t != -1:
+            self.notes += &quot;Autor: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
 
-		t = self.page.find(&quot;&lt;th scope=\&quot;row\&quot;&gt;Projekt:&lt;/th&gt;&quot;)
-		if t != -1:
-			self.notes += &quot;Projekt: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
+        t = self.page.find(&quot;&lt;th scope=\&quot;row\&quot;&gt;Projekt:&lt;/th&gt;&quot;)
+        if t != -1:
+            self.notes += &quot;Projekt: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
 
-		t = self.page.find(&quot;&lt;tr&gt;&lt;th scope=\&quot;row\&quot;&gt;Scenariusz:&lt;/th&gt;&quot;)
-		if t != -1:
-			self.notes += &quot;Scenariusz: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
+        t = self.page.find(&quot;&lt;tr&gt;&lt;th scope=\&quot;row\&quot;&gt;Scenariusz:&lt;/th&gt;&quot;)
+        if t != -1:
+            self.notes += &quot;Scenariusz: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
 
-		t = self.page.find(&quot;&lt;th scope=\&quot;row\&quot;&gt;Muzyka:&lt;/th&gt;&quot;)
-		if t != -1:
-			self.notes += &quot;Muzyka: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
+        t = self.page.find(&quot;&lt;th scope=\&quot;row\&quot;&gt;Muzyka:&lt;/th&gt;&quot;)
+        if t != -1:
+            self.notes += &quot;Muzyka: %s\n&quot; % gutils.trim(self.page[t:], &quot;&lt;td&gt;\n&quot;, &quot;\t&lt;/td&gt;&quot;)
 
-		self.notes += &quot;\n%s&quot;  % gutils.trim(self.page,&quot;&lt;p class=\&quot;dwazdania\&quot;&gt;\n\t\t&quot;, &quot;\n&lt;/p&gt;&quot;)
+        self.notes += &quot;\n%s&quot;  % gutils.trim(self.page,&quot;&lt;p class=\&quot;dwazdania\&quot;&gt;\n\t\t&quot;, &quot;\n&lt;/p&gt;&quot;)
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode='UTF-8'
-		self.original_url_search   = '<A HREF="http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=">http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=</A>'
-		self.translated_url_search = '<A HREF="http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=">http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=</A>'
+    def __init__(self):
+        self.encode='UTF-8'
+        self.original_url_search   = '<A HREF="http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=">http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=</A>'
+        self.translated_url_search = '<A HREF="http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=">http://anime.tanuki.pl/strony/anime/lista/title/1/?&amp;title=</A>'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		tmp = string.find(self.page, &quot;&lt;table class=\&quot;animelist strippedlist\&quot;&quot;)
-		if tmp == -1:	# only one match!
-			self.page = ''
-		else:		# multiple matches
-			self.page = gutils.trim(self.page,&quot;&lt;table class=\&quot;animelist strippedlist\&quot;&quot;, &quot;&lt;/tbody&gt;&quot;);
-			self.page = gutils.after(self.page, &quot;&lt;tbody&gt;&quot;)
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        tmp = string.find(self.page, &quot;&lt;table class=\&quot;animelist strippedlist\&quot;&quot;)
+        if tmp == -1:    # only one match!
+            self.page = ''
+        else:        # multiple matches
+            self.page = gutils.trim(self.page,&quot;&lt;table class=\&quot;animelist strippedlist\&quot;&quot;, &quot;&lt;/tbody&gt;&quot;);
+            self.page = gutils.after(self.page, &quot;&lt;tbody&gt;&quot;)
+        return self.page
 
-	def get_searches(self):
-		if self.page == '':	# immediately redirection to movie page
-			self.number_results = 1
-			self.ids.append(self.url)
-			self.titles.append(gutils.convert_entities(self.title))
-		else:			# multiple matches
-			elements = string.split(self.page,&quot;&lt;tr&quot;)
-			self.number_results = elements[-1]
-			if (elements[0]&lt;&gt;''):
-				for element in elements:
-					self.ids.append(gutils.trim(element, 'href=&quot;/strony/anime/', '&quot; &gt;'))
-					element = gutils.after(element,&quot; &gt;\n\t&quot;)
-					element = element.replace(&quot;&lt;/a&gt;\n\t&lt;/td&gt;\n&quot;, &quot; (&quot;)
-					element = element.replace(&quot;\t&lt;td&gt;&quot;, &quot;&quot;)
-					element = element.replace(&quot;&lt;/td&gt;\n&quot;, &quot;; &quot;)
-					element = element.replace(&quot;&lt;/tr&gt;&quot;, &quot;&quot;)
-					element = element[:len(element)-3] + ')'
-					self.titles.append(element)
-			else:
-				self.number_results = 0
+    def get_searches(self):
+        if self.page == '':    # immediately redirection to movie page
+            self.number_results = 1
+            self.ids.append(self.url)
+            self.titles.append(gutils.convert_entities(self.title))
+        else:            # multiple matches
+            elements = string.split(self.page,&quot;&lt;tr&quot;)
+            self.number_results = elements[-1]
+            if (elements[0]&lt;&gt;''):
+                for element in elements:
+                    self.ids.append(gutils.trim(element, 'href=&quot;/strony/anime/', '&quot; &gt;'))
+                    element = gutils.after(element,&quot; &gt;\n\t&quot;)
+                    element = element.replace(&quot;&lt;/a&gt;\n\t&lt;/td&gt;\n&quot;, &quot; (&quot;)
+                    element = element.replace(&quot;\t&lt;td&gt;&quot;, &quot;&quot;)
+                    element = element.replace(&quot;&lt;/td&gt;\n&quot;, &quot;; &quot;)
+                    element = element.replace(&quot;&lt;/tr&gt;&quot;, &quot;&quot;)
+                    element = element[:len(element)-3] + ')'
+                    self.titles.append(element)
+            else:
+                self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieWP.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieWP.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieWP.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -35,117 +35,117 @@
 plugin_version      = '2.3'
 
 class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://film.wp.pl/id,%s,film_szczegoly.html">http://film.wp.pl/id,%s,film_szczegoly.html</A>&quot; % self.movie_id
-		self.encode='iso-8859-2'
+    def __init__(self, id):
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://film.wp.pl/id,%s,film_szczegoly.html">http://film.wp.pl/id,%s,film_szczegoly.html</A>&quot; % self.movie_id
+        self.encode='iso-8859-2'
 
-	def initialize(self):
-		self.page = gutils.trim(self.page, '&lt;h1 class=&quot;mp0&quot;&gt;', '&lt;/div&gt;\n&lt;/div&gt;')
-		self.cast_page = self.open_page(url=&quot;<A HREF="http://film.wp.pl/id,%s,film_obsada_i_tworcy.html">http://film.wp.pl/id,%s,film_obsada_i_tworcy.html</A>&quot; % self.movie_id)
-		self.cast_page = gutils.trim(self.cast_page, '&lt;h1 class=&quot;mp0&quot;&gt;', &quot;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&quot;)
+    def initialize(self):
+        self.page = gutils.trim(self.page, '&lt;h1 class=&quot;mp0&quot;&gt;', '&lt;/div&gt;\n&lt;/div&gt;')
+        self.cast_page = self.open_page(url=&quot;<A HREF="http://film.wp.pl/id,%s,film_obsada_i_tworcy.html">http://film.wp.pl/id,%s,film_obsada_i_tworcy.html</A>&quot; % self.movie_id)
+        self.cast_page = gutils.trim(self.cast_page, '&lt;h1 class=&quot;mp0&quot;&gt;', &quot;&lt;/div&gt;\r\n&lt;/div&gt;\r\n&quot;)
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page, '&lt;img src=&quot;', '&quot; name=&quot;o')
+    def get_image(self):
+        self.image_url = gutils.trim(self.page, '&lt;img src=&quot;', '&quot; name=&quot;o')
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '&lt;b&gt;Tytu\xB3 orygina\xB3u:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
-		self.o_title = gutils.clean(self.o_title)
-		if self.o_title == '':
-			self.o_title = gutils.trim(self.page, '&lt;/h1&gt;', '&lt;div')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '&lt;b&gt;Tytu\xB3 orygina\xB3u:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
+        self.o_title = gutils.clean(self.o_title)
+        if self.o_title == '':
+            self.o_title = gutils.trim(self.page, '&lt;/h1&gt;', '&lt;div')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;b&gt;Tytu\xB3 polski:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
-		if self.title == '':
-			self.title = gutils.before(self.page, '&lt;/h1&gt;')
-			pos = string.find(self.title, '(')
-			if pos &gt; -1:
-				self.title = self.title[:pos]
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;b&gt;Tytu\xB3 polski:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
+        if self.title == '':
+            self.title = gutils.before(self.page, '&lt;/h1&gt;')
+            pos = string.find(self.title, '(')
+            if pos &gt; -1:
+                self.title = self.title[:pos]
 
-	def get_director(self):
-		self.director = gutils.trim(self.cast_page, '&gt;re\xBFyser\t&lt;/div&gt;', '&lt;/div&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.cast_page, '&gt;re\xBFyser\t&lt;/div&gt;', '&lt;/div&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, ' /&gt;', '\t\t&lt;div class=&quot;clr&quot;&gt;')
-		pos = string.find(self.plot, &quot;&lt;br&gt;Zobacz tak\xBFe:&lt;br&gt;&quot;)
-		if pos &gt; 0:
-			self.plot = self.plot[:pos]
-		self.plot = string.replace(self.plot,&quot;\r\n\r\n&quot;, '')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, ' /&gt;', '\t\t&lt;div class=&quot;clr&quot;&gt;')
+        pos = string.find(self.plot, &quot;&lt;br&gt;Zobacz tak\xBFe:&lt;br&gt;&quot;)
+        if pos &gt; 0:
+            self.plot = self.plot[:pos]
+        self.plot = string.replace(self.plot,&quot;\r\n\r\n&quot;, '')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '&lt;b&gt;Rok produkcji:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
-		year = re.findall(r'\d+', self.year)
-		if len(year)&gt;0:
-			self.year = year[0]
+    def get_year(self):
+        self.year = gutils.trim(self.page, '&lt;b&gt;Rok produkcji:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
+        year = re.findall(r'\d+', self.year)
+        if len(year)&gt;0:
+            self.year = year[0]
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, '&lt;b&gt;Czas trwania:&lt;/b&gt;', 'min')
-		runtime =  re.findall(r'\d+', self.runtime)
-		if len(runtime)&gt;0:
-			self.runtime = runtime
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page, '&lt;b&gt;Czas trwania:&lt;/b&gt;', 'min')
+        runtime =  re.findall(r'\d+', self.runtime)
+        if len(runtime)&gt;0:
+            self.runtime = runtime
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '&lt;b&gt;Gatunek:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
-		self.genre = string.replace(self.genre, '&lt;br /&gt;	', '')
-		self.genre = string.replace(self.genre, '&lt;br /&gt;', ' / ')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page, '&lt;b&gt;Gatunek:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
+        self.genre = string.replace(self.genre, '&lt;br /&gt;    ', '')
+        self.genre = string.replace(self.genre, '&lt;br /&gt;', ' / ')
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.cast_page, '&lt;h2&gt;OBSADA:&lt;/h2&gt;', '&lt;div class=&quot;b')
-		self.cast = gutils.after(self.cast, '&lt;div class=&quot;clr&quot;&gt;&lt;/div&gt;')
-		self.cast = string.replace(self.cast, '\t', '')
-		self.cast = string.replace(self.cast, '\n&lt;/div&gt;\n&lt;', _(' as ')+'&lt;')
-		self.cast = gutils.strip_tags(self.cast)
-		self.cast = string.replace(self.cast,  &quot;%s\n&quot; % _(' as '), &quot;\n&quot;)
+    def get_cast(self):
+        self.cast = gutils.trim(self.cast_page, '&lt;h2&gt;OBSADA:&lt;/h2&gt;', '&lt;div class=&quot;b')
+        self.cast = gutils.after(self.cast, '&lt;div class=&quot;clr&quot;&gt;&lt;/div&gt;')
+        self.cast = string.replace(self.cast, '\t', '')
+        self.cast = string.replace(self.cast, '\n&lt;/div&gt;\n&lt;', _(' as ')+'&lt;')
+        self.cast = gutils.strip_tags(self.cast)
+        self.cast = string.replace(self.cast,  &quot;%s\n&quot; % _(' as '), &quot;\n&quot;)
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page, '&lt;b&gt;Przedzia\xB3 wiekowy:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
-		self.classification = gutils.trim(self.classification, 'od ', ' ')
+    def get_classification(self):
+        self.classification = gutils.trim(self.page, '&lt;b&gt;Przedzia\xB3 wiekowy:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
+        self.classification = gutils.trim(self.classification, 'od ', ' ')
 
-	def get_studio(self):
-		self.studio = gutils.trim(self.page, '&lt;b&gt;Wytw\xF3rnia:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
+    def get_studio(self):
+        self.studio = gutils.trim(self.page, '&lt;b&gt;Wytw\xF3rnia:&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://film.wp.pl/id,%s,film.html">http://film.wp.pl/id,%s,film.html</A>&quot; % self.movie_id
+    def get_site(self):
+        self.site = &quot;<A HREF="http://film.wp.pl/id,%s,film.html">http://film.wp.pl/id,%s,film.html</A>&quot; % self.movie_id
 
-	def get_trailer(self):
-		self.trailer = &quot;<A HREF="http://film.wp.pl/id,%s,film_trailer.html">http://film.wp.pl/id,%s,film_trailer.html</A>&quot; % self.movie_id
+    def get_trailer(self):
+        self.trailer = &quot;<A HREF="http://film.wp.pl/id,%s,film_trailer.html">http://film.wp.pl/id,%s,film_trailer.html</A>&quot; % self.movie_id
 
-	def get_country(self):
-		pos = self.page.find('&lt;b&gt;Kraj produkcji:&lt;/b&gt;')
-		if pos == -1:
-			pos = self.page.find('&lt;b&gt;Kraje produkcji:&lt;/b&gt;')
-		if pos &gt; -1:
-			self.country = gutils.trim(self.page[pos:], '&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
+    def get_country(self):
+        pos = self.page.find('&lt;b&gt;Kraj produkcji:&lt;/b&gt;')
+        if pos == -1:
+            pos = self.page.find('&lt;b&gt;Kraje produkcji:&lt;/b&gt;')
+        if pos &gt; -1:
+            self.country = gutils.trim(self.page[pos:], '&lt;/b&gt;', &quot;\t\t&lt;/div&gt;&lt;div&quot;)
 
-	def get_rating(self):
-		self.rating = None
+    def get_rating(self):
+        self.rating = None
 
-	def get_notes(self):
-		self.notes = ''
+    def get_notes(self):
+        self.notes = ''
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode='iso-8859-2'
-		self.original_url_search	= '<A HREF="http://film.wp.pl/szukaj,%s,type,f,szukaj.html">http://film.wp.pl/szukaj,%s,type,f,szukaj.html</A>'
-		self.translated_url_search	= '<A HREF="http://film.wp.pl/szukaj,%s,type,f,szukaj.html">http://film.wp.pl/szukaj,%s,type,f,szukaj.html</A>'
+    def __init__(self):
+        self.encode='iso-8859-2'
+        self.original_url_search    = '<A HREF="http://film.wp.pl/szukaj,%s,type,f,szukaj.html">http://film.wp.pl/szukaj,%s,type,f,szukaj.html</A>'
+        self.translated_url_search    = '<A HREF="http://film.wp.pl/szukaj,%s,type,f,szukaj.html">http://film.wp.pl/szukaj,%s,type,f,szukaj.html</A>'
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = gutils.trim(self.page, '&lt;div id=&quot;filmUS&quot;', '&lt;div id=');
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = gutils.trim(self.page, '&lt;div id=&quot;filmUS&quot;', '&lt;div id=');
+        return self.page
 
-	def get_searches(self):
-		elements = string.split(self.page, '&lt;/div&gt;&lt;br /&gt;')
-		self.number_results = elements[-1]
+    def get_searches(self):
+        elements = string.split(self.page, '&lt;/div&gt;&lt;br /&gt;')
+        self.number_results = elements[-1]
 
-		if elements[0] != '':
-			for element in elements:
-				tmp_id = gutils.trim(element,'&lt;div class=&quot;rgt&quot;&gt;&lt;a href=&quot;id,', ',')
-				self.ids.append(tmp_id)
-				tmp_title = gutils.trim(element, 'html&quot;&gt;&lt;b&gt;', '&lt;/b&gt;')
-				self.titles.append(tmp_title)
-		else:
-			self.number_results = 0
+        if elements[0] != '':
+            for element in elements:
+                tmp_id = gutils.trim(element,'&lt;div class=&quot;rgt&quot;&gt;&lt;a href=&quot;id,', ',')
+                self.ids.append(tmp_id)
+                tmp_title = gutils.trim(element, 'html&quot;&gt;&lt;b&gt;', '&lt;/b&gt;')
+                self.titles.append(tmp_title)
+        else:
+            self.number_results = 0

Modified: trunk/lib/plugins/movie/PluginMovieZelluloid.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieZelluloid.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/plugins/movie/PluginMovieZelluloid.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -36,169 +36,169 @@
 plugin_version      = '1.0'
 
 class Plugin(movie.Movie):
-	index_url = '<A HREF="http://www.zelluloid.de/filme/index.php3?id=">http://www.zelluloid.de/filme/index.php3?id=</A>'
-	
-	def __init__(self, id):
-		self.encode='iso-8859-1'
-		self.movie_id = id
-		self.url = &quot;<A HREF="http://www.zelluloid.de/filme/details.php3?id=">http://www.zelluloid.de/filme/details.php3?id=</A>&quot; + self.movie_id
+    index_url = '<A HREF="http://www.zelluloid.de/filme/index.php3?id=">http://www.zelluloid.de/filme/index.php3?id=</A>'
+    
+    def __init__(self, id):
+        self.encode='iso-8859-1'
+        self.movie_id = id
+        self.url = &quot;<A HREF="http://www.zelluloid.de/filme/details.php3?id=">http://www.zelluloid.de/filme/details.php3?id=</A>&quot; + self.movie_id
 
-	def initialize(self):
-		self.detail_page = self.page
-		self.url = self.index_url + self.movie_id
-		self.page = self.open_page(url=self.url)
+    def initialize(self):
+        self.detail_page = self.page
+        self.url = self.index_url + self.movie_id
+        self.page = self.open_page(url=self.url)
 
-	def get_image(self):
-		self.image_url = '<A HREF="http://www.zelluloid.de/images/poster/">http://www.zelluloid.de/images/poster/</A>' + gutils.trim(self.page, '&lt;IMG SRC=&quot;/images/poster/', '&quot;');
+    def get_image(self):
+        self.image_url = '<A HREF="http://www.zelluloid.de/images/poster/">http://www.zelluloid.de/images/poster/</A>' + gutils.trim(self.page, '&lt;IMG SRC=&quot;/images/poster/', '&quot;');
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, 'Originaltitel: ', '&lt;BR&gt;')
-		if self.o_title == '':
-			self.o_title = gutils.trim(self.page, '&lt;title&gt;', '|')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, 'Originaltitel: ', '&lt;BR&gt;')
+        if self.o_title == '':
+            self.o_title = gutils.trim(self.page, '&lt;title&gt;', '|')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;title&gt;', '|')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '&lt;title&gt;', '|')
 
-	def get_director(self):
-		self.director = gutils.trim(self.detail_page, 'Regie', '&lt;/A&gt;')
+    def get_director(self):
+        self.director = gutils.trim(self.detail_page, 'Regie', '&lt;/A&gt;')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '&lt;DIV CLASS=bigtext&gt;', '&lt;/DIV&gt;')
-		
-	def get_year(self):
-		self.year = ''
-		elements = string.split(self.detail_page, '/directory/az.php3?j')
-		elements[0] = ''
-		delimiter = ''
-		for element in elements:
-			if element &lt;&gt; '':
-				self.year = self.year + delimiter + gutils.trim(element, '&gt;', '&lt;')
-				delimiter = ', '
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '&lt;DIV CLASS=bigtext&gt;', '&lt;/DIV&gt;')
+        
+    def get_year(self):
+        self.year = ''
+        elements = string.split(self.detail_page, '/directory/az.php3?j')
+        elements[0] = ''
+        delimiter = ''
+        for element in elements:
+            if element &lt;&gt; '':
+                self.year = self.year + delimiter + gutils.trim(element, '&gt;', '&lt;')
+                delimiter = ', '
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.detail_page, 'ca.&nbsp;', '&nbsp;min');
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.detail_page, 'ca.&nbsp;', '&nbsp;min');
 
-	def get_genre(self):
-		self.genre = ''
-		elements = string.split(self.detail_page, '/directory/az.php3?g')
-		elements[0] = ''
-		delimiter = ''
-		for element in elements:
-			if element &lt;&gt; '':
-				self.genre = self.genre + delimiter + gutils.trim(element, '&gt;', '&lt;')
-				delimiter = ', '
+    def get_genre(self):
+        self.genre = ''
+        elements = string.split(self.detail_page, '/directory/az.php3?g')
+        elements[0] = ''
+        delimiter = ''
+        for element in elements:
+            if element &lt;&gt; '':
+                self.genre = self.genre + delimiter + gutils.trim(element, '&gt;', '&lt;')
+                delimiter = ', '
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.detail_page, 'alt=&quot;Besetzung&quot;', '&lt;TD COLSPAN=')
-		self.cast = self.cast.replace('&lt;A HREF=', '--flip--' + '&lt;A HREF=')
-		self.cast = gutils.strip_tags(self.cast)
-		self.cast = gutils.after(self.cast, '&gt;')
-		elements = self.cast.split('\n')
-		self.cast = ''
-		for element in elements:
-			elements2 = element.split(&quot;--flip--&quot;)
-			if len(elements2) &gt; 1:
-				self.cast += elements2[1] + '--flip--' + elements2[0] + '\n'
-			else:
-				self.cast += element + '\n'
-		self.cast = string.replace(self.cast, '--flip--', _(' as '))
+    def get_cast(self):
+        self.cast = gutils.trim(self.detail_page, 'alt=&quot;Besetzung&quot;', '&lt;TD COLSPAN=')
+        self.cast = self.cast.replace('&lt;A HREF=', '--flip--' + '&lt;A HREF=')
+        self.cast = gutils.strip_tags(self.cast)
+        self.cast = gutils.after(self.cast, '&gt;')
+        elements = self.cast.split('\n')
+        self.cast = ''
+        for element in elements:
+            elements2 = element.split(&quot;--flip--&quot;)
+            if len(elements2) &gt; 1:
+                self.cast += elements2[1] + '--flip--' + elements2[0] + '\n'
+            else:
+                self.cast += element + '\n'
+        self.cast = string.replace(self.cast, '--flip--', _(' as '))
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.detail_page, 'FSK: ', '&lt;/TD&gt;')
-		self.classification = re.sub(',.*', '', self.classification)
+    def get_classification(self):
+        self.classification = gutils.trim(self.detail_page, 'FSK: ', '&lt;/TD&gt;')
+        self.classification = re.sub(',.*', '', self.classification)
 
-	def get_studio(self):
-		self.studio = gutils.strip_tags(gutils.trim(self.detail_page, 'alt=&quot;Produktion&quot;', '&nbsp;'))
-		if self.studio == '':
-			self.studio = gutils.trim(self.detail_page, 'alt=&quot;Produktion&quot;', '&lt;/TABLE&gt;')
-		self.studio = gutils.after(self.studio, '&gt;')
-		self.studio = self.studio.replace('\n', ', ')
-		self.studio = re.sub('((^, )|(, $))', '', self.studio)
-		
-	def get_o_site(self):
-		self.o_site = &quot;&quot;
+    def get_studio(self):
+        self.studio = gutils.strip_tags(gutils.trim(self.detail_page, 'alt=&quot;Produktion&quot;', '&nbsp;'))
+        if self.studio == '':
+            self.studio = gutils.trim(self.detail_page, 'alt=&quot;Produktion&quot;', '&lt;/TABLE&gt;')
+        self.studio = gutils.after(self.studio, '&gt;')
+        self.studio = self.studio.replace('\n', ', ')
+        self.studio = re.sub('((^, )|(, $))', '', self.studio)
+        
+    def get_o_site(self):
+        self.o_site = &quot;&quot;
 
-	def get_site(self):
-		self.site = &quot;<A HREF="http://www.zelluloid.de/filme/details.php3?id=">http://www.zelluloid.de/filme/details.php3?id=</A>&quot; + self.movie_id
+    def get_site(self):
+        self.site = &quot;<A HREF="http://www.zelluloid.de/filme/details.php3?id=">http://www.zelluloid.de/filme/details.php3?id=</A>&quot; + self.movie_id
 
-	def get_trailer(self):
-		self.trailer = &quot;&quot;
+    def get_trailer(self):
+        self.trailer = &quot;&quot;
 
-	def get_country(self):
-		self.country = ''
-		elements = string.split(self.detail_page, '/directory/az.php3?l')
-		elements[0] = ''
-		delimiter = ''
-		for element in elements:
-			if element &lt;&gt; '':
-				self.country = self.country + delimiter + gutils.trim(element, '&gt;', '&lt;')
-				delimiter = ', '
+    def get_country(self):
+        self.country = ''
+        elements = string.split(self.detail_page, '/directory/az.php3?l')
+        elements[0] = ''
+        delimiter = ''
+        for element in elements:
+            if element &lt;&gt; '':
+                self.country = self.country + delimiter + gutils.trim(element, '&gt;', '&lt;')
+                delimiter = ', '
 
-	def get_rating(self):
-		self.rating = gutils.strip_tags(gutils.trim(self.page, 'User-Wertung:', '&lt;/TABLE&gt;'))
-		self.rating = self.rating.replace('%', '')
-		self.rating = self.rating.replace('&nbsp;', '')
-		self.rating = self.rating.replace('\n', '')
-		try:
-			ratingint = round(float(self.rating) / 10.0)
-		except:
-			ratingint = 0
-		self.rating = str(ratingint)
+    def get_rating(self):
+        self.rating = gutils.strip_tags(gutils.trim(self.page, 'User-Wertung:', '&lt;/TABLE&gt;'))
+        self.rating = self.rating.replace('%', '')
+        self.rating = self.rating.replace('&nbsp;', '')
+        self.rating = self.rating.replace('\n', '')
+        try:
+            ratingint = round(float(self.rating) / 10.0)
+        except:
+            ratingint = 0
+        self.rating = str(ratingint)
 
-	def get_notes(self):
-		self.notes = &quot;&quot;
+    def get_notes(self):
+        self.notes = &quot;&quot;
 
 class SearchPlugin(movie.SearchMovie):
 
-	def __init__(self):
-		self.original_url_search   = &quot;<A HREF="http://www.zelluloid.de/suche/index.php3?qstring=">http://www.zelluloid.de/suche/index.php3?qstring=</A>&quot;
-		self.translated_url_search = &quot;<A HREF="http://www.zelluloid.de/suche/index.php3?qstring=">http://www.zelluloid.de/suche/index.php3?qstring=</A>&quot;
-		self.encode='iso-8859-1'
-		self.remove_accents = False
+    def __init__(self):
+        self.original_url_search   = &quot;<A HREF="http://www.zelluloid.de/suche/index.php3?qstring=">http://www.zelluloid.de/suche/index.php3?qstring=</A>&quot;
+        self.translated_url_search = &quot;<A HREF="http://www.zelluloid.de/suche/index.php3?qstring=">http://www.zelluloid.de/suche/index.php3?qstring=</A>&quot;
+        self.encode='iso-8859-1'
+        self.remove_accents = False
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		tmp = gutils.trim(self.page, &quot;Der Suchbegriff erzielte&quot;, &quot;&lt;/TABLE&gt;&quot;)
-		return tmp
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        tmp = gutils.trim(self.page, &quot;Der Suchbegriff erzielte&quot;, &quot;&lt;/TABLE&gt;&quot;)
+        return tmp
 
-	def get_searches(self):
-		elements = string.split(self.page, &quot;hit.php3?hit=&quot;)
-		elements[0] = ''
-		for element in elements:
-			if element &lt;&gt; '':
-				id = gutils.trim(element, 'movie-', '-')
-				if id &lt;&gt; '':
-					self.ids.append(id)
-					self.titles.append(gutils.strip_tags(string.replace(gutils.trim(element, '&gt;', '&lt;/A&gt;'), '&lt;BR&gt;', ' - ')))
+    def get_searches(self):
+        elements = string.split(self.page, &quot;hit.php3?hit=&quot;)
+        elements[0] = ''
+        for element in elements:
+            if element &lt;&gt; '':
+                id = gutils.trim(element, 'movie-', '-')
+                if id &lt;&gt; '':
+                    self.ids.append(id)
+                    self.titles.append(gutils.strip_tags(string.replace(gutils.trim(element, '&gt;', '&lt;/A&gt;'), '&lt;BR&gt;', ' - ')))
 
 #
 # Plugin Test
 #
 class SearchPluginTest(SearchPlugin):
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; expected result count }
-	#
-	test_configuration = {
-		'Rocky Balboa'		: 1,
-		'Die wilden H&#195;&#188;hner'	: 3
-	}
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; expected result count }
+    #
+    test_configuration = {
+        'Rocky Balboa'        : 1,
+        'Die wilden H&#195;&#188;hner'    : 3
+    }
 
 class PluginTest:
-	#
-	# Configuration for automated tests:
-	# dict { movie_id -&gt; dict { arribute -&gt; value } }
-	#
-	# value: * True/False if attribute only should be tested for any value
-	#        * or the expected value
-	#
-	test_configuration = {
-		'2835' : { 
-			'title' 			: 'Rocky Balboa',
-			'o_title' 			: 'Rocky Balboa',
-			'director'			: 'Sylvester Stallone',
-			'plot' 				: True,
-			'cast'				: 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute only should be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        '2835' : { 
+            'title'             : 'Rocky Balboa',
+            'o_title'             : 'Rocky Balboa',
+            'director'            : 'Sylvester Stallone',
+            'plot'                 : True,
+            'cast'                : 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
 Burt Young' + _(' as ') + 'Paulie\n\
 Antonio Tarver' + _(' as ') + 'Mason Dixon\n\
 Geraldine Hughes' + _(' as ') + 'Marie\n\
@@ -210,25 +210,25 @@
 Lou DiBella' + _(' as ') + 'Lou DiBella\n\
 Mike Tyson' + _(' as ') + 'Mike Tyson\n\
 Henry G. Sanders' + _(' as ') + 'Martin',
-			'country'			: 'USA',
-			'genre'				: 'Drama, Sport',
-			'classification'	: 'ab 12',
-			'studio'			: 'Chartoff-Winkler Productions, Columbia Pictures Corporation, Metro-Goldwyn-Mayer, Revolution Studios, Rogue Marble',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.zelluloid.de/filme/details.php3?id=2835">http://www.zelluloid.de/filme/details.php3?id=2835</A>',
-			'trailer'			: False,
-			'year'				: 2006,
-			'notes'				: False,
-			'runtime'			: 102,
-			'image'				: True,
-			'rating'			: 8.0
-		},
-		'6342' : { 
-			'title' 			: 'Die wilden H&#195;&#188;hner',
-			'o_title' 			: 'Die wilden H&#195;&#188;hner',
-			'director'			: 'Vivian Naefe',
-			'plot' 				: True,
-			'cast'				: 'Michelle von Treuberg' + _(' as ') + 'Sprotte\n\
+            'country'            : 'USA',
+            'genre'                : 'Drama, Sport',
+            'classification'    : 'ab 12',
+            'studio'            : 'Chartoff-Winkler Productions, Columbia Pictures Corporation, Metro-Goldwyn-Mayer, Revolution Studios, Rogue Marble',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.zelluloid.de/filme/details.php3?id=2835">http://www.zelluloid.de/filme/details.php3?id=2835</A>',
+            'trailer'            : False,
+            'year'                : 2006,
+            'notes'                : False,
+            'runtime'            : 102,
+            'image'                : True,
+            'rating'            : 8.0
+        },
+        '6342' : { 
+            'title'             : 'Die wilden H&#195;&#188;hner',
+            'o_title'             : 'Die wilden H&#195;&#188;hner',
+            'director'            : 'Vivian Naefe',
+            'plot'                 : True,
+            'cast'                : 'Michelle von Treuberg' + _(' as ') + 'Sprotte\n\
 Lucie Hollmann' + _(' as ') + 'Frieda\n\
 Paula Riemann' + _(' as ') + 'Melanie\n\
 Zsa Zsa Inci B&#195;&#188;rkle' + _(' as ') + 'Trude\n\
@@ -253,17 +253,17 @@
 Axel H&#195;&#164;fner' + _(' as ') + 'Schrottplatzw&#195;&#164;rter\n\
 Simon Gosejohann' + _(' as ') + 'junger Mann\n\
 Piet Klocke' + _(' as ') + 'Junggeselle',
-			'country'			: 'Deutschland',
-			'genre'				: 'Kinder',
-			'classification'	: 'ohne',
-			'studio'			: 'Bavaria Film, Constantin Film',
-			'o_site'			: False,
-			'site'				: '<A HREF="http://www.zelluloid.de/filme/details.php3?id=6342">http://www.zelluloid.de/filme/details.php3?id=6342</A>',
-			'trailer'			: False,
-			'year'				: 2006,
-			'notes'				: False,
-			'runtime'			: 109,
-			'image'				: True,
-			'rating'			: 8.0
-		}
-	}
+            'country'            : 'Deutschland',
+            'genre'                : 'Kinder',
+            'classification'    : 'ohne',
+            'studio'            : 'Bavaria Film, Constantin Film',
+            'o_site'            : False,
+            'site'                : '<A HREF="http://www.zelluloid.de/filme/details.php3?id=6342">http://www.zelluloid.de/filme/details.php3?id=6342</A>',
+            'trailer'            : False,
+            'year'                : 2006,
+            'notes'                : False,
+            'runtime'            : 109,
+            'image'                : True,
+            'rating'            : 8.0
+        }
+    }

Modified: trunk/lib/preferences.py
===================================================================
--- trunk/lib/preferences.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/preferences.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -28,428 +28,428 @@
 import socket
 
 try:
-	import gtkspell
-	spell_support = 1
+    import gtkspell
+    spell_support = 1
 except:
-	spell_support = 0
+    spell_support = 0
 
 def show_preferences(self):
-	w = self.widgets['preferences']
-	# number
-	if self.config.get('number', True, section='mainlist') == False:
-		w['view_number'].set_active(False)
-	else:
-		w['view_number'].set_active(True)
-	# image
-	if self.config.get('image', True, section='mainlist') == False:
-		w['view_image'].set_active(False)
-	else:
-		w['view_image'].set_active(True)
-	# original title
-	if self.config.get('otitle', True, section='mainlist') == False:
-		w['view_o_title'].set_active(False)
-	else:
-		w['view_o_title'].set_active(True)
-	# title
-	if self.config.get('title', True, section='mainlist') == False:
-		w['view_title'].set_active(False)
-	else:
-		w['view_title'].set_active(True)
-	# director
-	if self.config.get('director', True, 'mainlist') == False:
-		w['view_director'].set_active(False)
-	else:
-		w['view_director'].set_active(True)
-	# genre
-	if self.config.get('genre', True, 'mainlist') == False:
-		w['view_genre'].set_active(False)
-	else:
-		w['view_genre'].set_active(True)
-	# seen
-	if self.config.get('seen', True, 'mainlist') == False:
-		w['view_seen'].set_active(False)
-	else:
-		w['view_seen'].set_active(True)
-	# year
-	if self.config.get('year', True, 'mainlist') == False:
-		w['view_year'].set_active(False)
-	else:
-		w['view_year'].set_active(True)
-	# runtime
-	if self.config.get('runtime', True, 'mainlist') == False:
-		w['view_runtime'].set_active(False)
-	else:
-		w['view_runtime'].set_active(True)
-	# rating
-	if self.config.get('rating', True, 'mainlist') == False:
-		w['view_rating'].set_active(False)
-	else:
-		w['view_rating'].set_active(True)
+    w = self.widgets['preferences']
+    # number
+    if self.config.get('number', True, section='mainlist') == False:
+        w['view_number'].set_active(False)
+    else:
+        w['view_number'].set_active(True)
+    # image
+    if self.config.get('image', True, section='mainlist') == False:
+        w['view_image'].set_active(False)
+    else:
+        w['view_image'].set_active(True)
+    # original title
+    if self.config.get('otitle', True, section='mainlist') == False:
+        w['view_o_title'].set_active(False)
+    else:
+        w['view_o_title'].set_active(True)
+    # title
+    if self.config.get('title', True, section='mainlist') == False:
+        w['view_title'].set_active(False)
+    else:
+        w['view_title'].set_active(True)
+    # director
+    if self.config.get('director', True, 'mainlist') == False:
+        w['view_director'].set_active(False)
+    else:
+        w['view_director'].set_active(True)
+    # genre
+    if self.config.get('genre', True, 'mainlist') == False:
+        w['view_genre'].set_active(False)
+    else:
+        w['view_genre'].set_active(True)
+    # seen
+    if self.config.get('seen', True, 'mainlist') == False:
+        w['view_seen'].set_active(False)
+    else:
+        w['view_seen'].set_active(True)
+    # year
+    if self.config.get('year', True, 'mainlist') == False:
+        w['view_year'].set_active(False)
+    else:
+        w['view_year'].set_active(True)
+    # runtime
+    if self.config.get('runtime', True, 'mainlist') == False:
+        w['view_runtime'].set_active(False)
+    else:
+        w['view_runtime'].set_active(True)
+    # rating
+    if self.config.get('rating', True, 'mainlist') == False:
+        w['view_rating'].set_active(False)
+    else:
+        w['view_rating'].set_active(True)
 
-	# email reminder
-	if self.config.get('use_auth', False, section='mail') == False:
-		w['mail_use_auth'].set_active(False)
-	else:
-		w['mail_use_auth'].set_active(True)
-		
-	if self.config.get('mail_use_tls', False, section='mail') == False:
-		w['mail_use_tls'].set_active(False)
-	else:
-		w['mail_use_tls'].set_active(True)
+    # email reminder
+    if self.config.get('use_auth', False, section='mail') == False:
+        w['mail_use_auth'].set_active(False)
+    else:
+        w['mail_use_auth'].set_active(True)
+        
+    if self.config.get('mail_use_tls', False, section='mail') == False:
+        w['mail_use_tls'].set_active(False)
+    else:
+        w['mail_use_tls'].set_active(True)
 
-	w['mail_smtp_server'].set_text(self.config.get('smtp_server', 'localhost', section='mail'))
-	w['mail_smtp_port'].set_text(self.config.get('mail_smtp_port', '25', section='mail'))
-	w['mail_username'].set_text(self.config.get('username', '', section='mail'))
-	w['mail_password'].set_text(self.config.get('password', '', section='mail'))
-	w['mail_email'].set_text(self.config.get('email', '<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">griffith at localhost</A>', section='mail'))
+    w['mail_smtp_server'].set_text(self.config.get('smtp_server', 'localhost', section='mail'))
+    w['mail_smtp_port'].set_text(self.config.get('mail_smtp_port', '25', section='mail'))
+    w['mail_username'].set_text(self.config.get('username', '', section='mail'))
+    w['mail_password'].set_text(self.config.get('password', '', section='mail'))
+    w['mail_email'].set_text(self.config.get('email', '<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">griffith at localhost</A>', section='mail'))
 
-	# pdf reader
-	w['epdf_reader'].set_text(self.pdf_reader)
+    # pdf reader
+    w['epdf_reader'].set_text(self.pdf_reader)
 
-	# pdf font
-	if self.config.get('font'):
-		w['font'].set_filename(self.config.get('font'))
+    # pdf font
+    if self.config.get('font'):
+        w['font'].set_filename(self.config.get('font'))
 
-	# defaults (for static data only)
-	w['condition'].set_active( gutils.digits_only(self.config.get('condition', 0, section='defaults'), 5) )
-	w['region'].set_active( gutils.digits_only(self.config.get('region', 0, section='defaults'), 8) )
-	w['layers'].set_active( gutils.digits_only(self.config.get('layers', 0, section='defaults'), 4) )
-	w['color'].set_active( gutils.digits_only(self.config.get('color', 0, section='defaults'), 3 ))
-	tmp = self.config.get('media', 0, section='defaults')
-	if tmp is not None and int(tmp) in self.media_ids:
-		if int(self.config.get('media', 0, section='defaults')) &gt; 0:
-			w['media'].set_active( gutils.findKey(int(self.config.get('media', 0, section='defaults')), self.media_ids) )
-		else:
-			w['media'].set_active(0)
-	tmp = self.config.get('vcodec', 0, section='defaults')
-	if tmp is not None and int(tmp) in self.vcodecs_ids:
-		if int(self.config.get('vcodec', 0, section='defaults')) &gt; 0:
-			w['vcodec'].set_active(	int(gutils.findKey(int(self.config.get('vcodec', 0, section='defaults')), self.vcodecs_ids)) )
-		else:
-			w['vcodec'].set_active(0)
-	
-	# search for:
-	w['s_classification'].set_active(bool(self.config.get('s_classification', True, section='add')))
-	w['s_country'].set_active(bool(self.config.get('s_country', True, section='add')))
-	w['s_director'].set_active(bool(self.config.get('s_director', True, section='add')))
-	w['s_genre'].set_active(bool(self.config.get('s_genre', True, section='add')))
-	w['s_image'].set_active(bool(self.config.get('s_image', True, section='add')))
-	w['s_notes'].set_active(bool(self.config.get('s_notes', True, section='add')))
-	w['s_o_site'].set_active(bool(self.config.get('s_o_site', True, section='add')))
-	w['s_o_title'].set_active(bool(self.config.get('s_o_title', True, section='add')))
-	w['s_plot'].set_active(bool(self.config.get('s_plot', True, section='add')))
-	w['s_rating'].set_active(bool(self.config.get('s_rating', True, section='add')))
-	w['s_runtime'].set_active(bool(self.config.get('s_runtime', True, section='add')))
-	w['s_site'].set_active(bool(self.config.get('s_site', True, section='add')))
-	w['s_studio'].set_active(bool(self.config.get('s_studio', True, section='add')))
-	w['s_title'].set_active(bool(self.config.get('s_title', True, section='add')))
-	w['s_trailer'].set_active(bool(self.config.get('s_trailer', True, section='add')))
-	w['s_cast'].set_active(bool(self.config.get('s_cast', True, section='add')))
-	w['s_year'].set_active(bool(self.config.get('s_year', True, section='add')))
-	
-	if self.config.get('sortby', section='mainlist'):
-		tmp = self.sort_criteria.index(self.config.get('sortby', section='mainlist'))
-		w['sortby'].set_active(tmp)
-	w['sortby_reverse'].set_active(bool(self.config.get('sortby_reverse', False, section='mainlist')))
-	
-	w['s_limit'].set_value(gutils.digits_only(self.config.get('limit', 0, section='mainlist')))
-	
-	plugins = gutils.read_plugins('PluginMovie', \
-		self.locations['movie_plugins'])
-	plugins.sort()
-	mcounter = 0
-	default_movie_plugin = self.config.get('default_movie_plugin')
-	for p in plugins:
-		plugin_module = os.path.basename(p).replace('.py','')
-		plugin_name = plugin_module.replace('PluginMovie','')
-		if plugin_name == default_movie_plugin:
-			w['default_plugin'].set_active(mcounter)
-			self.d_plugin = mcounter
-		mcounter = mcounter + 1
+    # defaults (for static data only)
+    w['condition'].set_active( gutils.digits_only(self.config.get('condition', 0, section='defaults'), 5) )
+    w['region'].set_active( gutils.digits_only(self.config.get('region', 0, section='defaults'), 8) )
+    w['layers'].set_active( gutils.digits_only(self.config.get('layers', 0, section='defaults'), 4) )
+    w['color'].set_active( gutils.digits_only(self.config.get('color', 0, section='defaults'), 3 ))
+    tmp = self.config.get('media', 0, section='defaults')
+    if tmp is not None and int(tmp) in self.media_ids:
+        if int(self.config.get('media', 0, section='defaults')) &gt; 0:
+            w['media'].set_active( gutils.findKey(int(self.config.get('media', 0, section='defaults')), self.media_ids) )
+        else:
+            w['media'].set_active(0)
+    tmp = self.config.get('vcodec', 0, section='defaults')
+    if tmp is not None and int(tmp) in self.vcodecs_ids:
+        if int(self.config.get('vcodec', 0, section='defaults')) &gt; 0:
+            w['vcodec'].set_active(    int(gutils.findKey(int(self.config.get('vcodec', 0, section='defaults')), self.vcodecs_ids)) )
+        else:
+            w['vcodec'].set_active(0)
+    
+    # search for:
+    w['s_classification'].set_active(bool(self.config.get('s_classification', True, section='add')))
+    w['s_country'].set_active(bool(self.config.get('s_country', True, section='add')))
+    w['s_director'].set_active(bool(self.config.get('s_director', True, section='add')))
+    w['s_genre'].set_active(bool(self.config.get('s_genre', True, section='add')))
+    w['s_image'].set_active(bool(self.config.get('s_image', True, section='add')))
+    w['s_notes'].set_active(bool(self.config.get('s_notes', True, section='add')))
+    w['s_o_site'].set_active(bool(self.config.get('s_o_site', True, section='add')))
+    w['s_o_title'].set_active(bool(self.config.get('s_o_title', True, section='add')))
+    w['s_plot'].set_active(bool(self.config.get('s_plot', True, section='add')))
+    w['s_rating'].set_active(bool(self.config.get('s_rating', True, section='add')))
+    w['s_runtime'].set_active(bool(self.config.get('s_runtime', True, section='add')))
+    w['s_site'].set_active(bool(self.config.get('s_site', True, section='add')))
+    w['s_studio'].set_active(bool(self.config.get('s_studio', True, section='add')))
+    w['s_title'].set_active(bool(self.config.get('s_title', True, section='add')))
+    w['s_trailer'].set_active(bool(self.config.get('s_trailer', True, section='add')))
+    w['s_cast'].set_active(bool(self.config.get('s_cast', True, section='add')))
+    w['s_year'].set_active(bool(self.config.get('s_year', True, section='add')))
+    
+    if self.config.get('sortby', section='mainlist'):
+        tmp = self.sort_criteria.index(self.config.get('sortby', section='mainlist'))
+        w['sortby'].set_active(tmp)
+    w['sortby_reverse'].set_active(bool(self.config.get('sortby_reverse', False, section='mainlist')))
+    
+    w['s_limit'].set_value(gutils.digits_only(self.config.get('limit', 0, section='mainlist')))
+    
+    plugins = gutils.read_plugins('PluginMovie', \
+        self.locations['movie_plugins'])
+    plugins.sort()
+    mcounter = 0
+    default_movie_plugin = self.config.get('default_movie_plugin')
+    for p in plugins:
+        plugin_module = os.path.basename(p).replace('.py','')
+        plugin_name = plugin_module.replace('PluginMovie','')
+        if plugin_name == default_movie_plugin:
+            w['default_plugin'].set_active(mcounter)
+            self.d_plugin = mcounter
+        mcounter = mcounter + 1
 
-	# rating image
-	try:
-		rimage = int(self.config.get('rating_image', 0))
-	except:
-		rimage = 0
-	w['rating_image'].set_active(rimage)
+    # rating image
+    try:
+        rimage = int(self.config.get('rating_image', 0))
+    except:
+        rimage = 0
+    w['rating_image'].set_active(rimage)
 
-	# spellchecker
-	if self.config.get('gtkspell', False, section='spell') == False:
-		w['spellchecker'].set_active(False)
-	else:
-		w['spellchecker'].set_active(True)
-	self.on_cb_spellchecker_pref_toggled(w['spellchecker'])
+    # spellchecker
+    if self.config.get('gtkspell', False, section='spell') == False:
+        w['spellchecker'].set_active(False)
+    else:
+        w['spellchecker'].set_active(True)
+    self.on_cb_spellchecker_pref_toggled(w['spellchecker'])
 
-	if self.config.get('notes', True, section='spell') == False:
-		w['spell_notes'].set_active(False)
-	else:
-		w['spell_notes'].set_active(True)
+    if self.config.get('notes', True, section='spell') == False:
+        w['spell_notes'].set_active(False)
+    else:
+        w['spell_notes'].set_active(True)
 
-	if self.config.get('plot', True, section='spell') == False:
-		w['spell_plot'].set_active(False)
-	else:
-		w['spell_plot'].set_active(True)
+    if self.config.get('plot', True, section='spell') == False:
+        w['spell_plot'].set_active(False)
+    else:
+        w['spell_plot'].set_active(True)
 
-	w['spell_lang'].set_text(str(self.config.get('lang', 'en', section='spell')))
+    w['spell_lang'].set_text(str(self.config.get('lang', 'en', section='spell')))
 
-	w['amazon_locale'].set_active(int(self.config.get('amazon_locale', 0, section='add')))
+    w['amazon_locale'].set_active(int(self.config.get('amazon_locale', 0, section='add')))
 
-	w['window'].show()
+    w['window'].show()
 
 def save_preferences(self):
-	w = self.widgets['preferences']
-	c = self.config
-	global spell_support
+    w = self.widgets['preferences']
+    c = self.config
+    global spell_support
 
-	was_false = notes_was_false = plot_was_false = 1	
+    was_false = notes_was_false = plot_was_false = 1    
 
-	if c.get('gtkspell', False, section='spell') == True:
-		was_false = 0
+    if c.get('gtkspell', False, section='spell') == True:
+        was_false = 0
 
-	if c.get('notes', False, section='spell') == True:
-		notes_was_false = 0
+    if c.get('notes', False, section='spell') == True:
+        notes_was_false = 0
 
-	if c.get('plot', False, section='spell') == True:
-		plot_was_false = 0
+    if c.get('plot', False, section='spell') == True:
+        plot_was_false = 0
 
-	# number
-	if w['view_number'].get_active():
-		c.set('number', 'True', section='mainlist')
-	else:
-		c.set('number', 'False', section='mainlist')
-	# image
-	if w['view_image'].get_active():
-		c.set('image', 'True', section='mainlist')
-	else:
-		c.set('image', 'False', section='mainlist')
-	# original title
-	if w['view_o_title'].get_active():
-		c.set('otitle', 'True', section='mainlist')
-	else:
-		c.set('otitle', 'False', section='mainlist')
-	# title
-	if w['view_title'].get_active():
-		c.set('title', 'True', section='mainlist')
-	else:
-		c.set('title', 'False', section='mainlist')
-	# director
-	if w['view_director'].get_active():
-		c.set('director', 'True', section='mainlist')
-	else:
-		c.set('director', 'False', section='mainlist')
-	# genre
-	if w['view_genre'].get_active():
-		c.set('genre', 'True', section='mainlist')
-	else:
-		c.set('genre', 'False', section='mainlist')
-	# seen
-	if w['view_seen'].get_active():
-		c.set('seen', 'True', section='mainlist')
-	else:
-		c.set('seen', 'False', section='mainlist')
-	# year
-	if w['view_year'].get_active():
-		c.set('year', 'True', section='mainlist')
-	else:
-		c.set('year', 'False', section='mainlist')
-	# runtime
-	if w['view_runtime'].get_active():
-		c.set('runtime', 'True', section='mainlist')
-	else:
-		c.set('runtime', 'False', section='mainlist')
-	# rating
-	if w['view_rating'].get_active():
-		c.set('rating', 'True', section='mainlist')
-	else:
-		c.set('rating', 'False', section='mainlist')
-	
-	# sortby
-	if w['sortby'].get_active():
-		field = self.sort_criteria[w['sortby'].get_active()]
-		if field:
-			c.set('sortby', field, section='mainlist')
-	else:
-		c.set('sortby', 'number', section='mainlist')
-	c.set('sortby_reverse', w['sortby_reverse'].get_active(), section='mainlist')
-	
-	c.set('limit', str(int(w['s_limit'].get_value())), section='mainlist')
-	
+    # number
+    if w['view_number'].get_active():
+        c.set('number', 'True', section='mainlist')
+    else:
+        c.set('number', 'False', section='mainlist')
+    # image
+    if w['view_image'].get_active():
+        c.set('image', 'True', section='mainlist')
+    else:
+        c.set('image', 'False', section='mainlist')
+    # original title
+    if w['view_o_title'].get_active():
+        c.set('otitle', 'True', section='mainlist')
+    else:
+        c.set('otitle', 'False', section='mainlist')
+    # title
+    if w['view_title'].get_active():
+        c.set('title', 'True', section='mainlist')
+    else:
+        c.set('title', 'False', section='mainlist')
+    # director
+    if w['view_director'].get_active():
+        c.set('director', 'True', section='mainlist')
+    else:
+        c.set('director', 'False', section='mainlist')
+    # genre
+    if w['view_genre'].get_active():
+        c.set('genre', 'True', section='mainlist')
+    else:
+        c.set('genre', 'False', section='mainlist')
+    # seen
+    if w['view_seen'].get_active():
+        c.set('seen', 'True', section='mainlist')
+    else:
+        c.set('seen', 'False', section='mainlist')
+    # year
+    if w['view_year'].get_active():
+        c.set('year', 'True', section='mainlist')
+    else:
+        c.set('year', 'False', section='mainlist')
+    # runtime
+    if w['view_runtime'].get_active():
+        c.set('runtime', 'True', section='mainlist')
+    else:
+        c.set('runtime', 'False', section='mainlist')
+    # rating
+    if w['view_rating'].get_active():
+        c.set('rating', 'True', section='mainlist')
+    else:
+        c.set('rating', 'False', section='mainlist')
+    
+    # sortby
+    if w['sortby'].get_active():
+        field = self.sort_criteria[w['sortby'].get_active()]
+        if field:
+            c.set('sortby', field, section='mainlist')
+    else:
+        c.set('sortby', 'number', section='mainlist')
+    c.set('sortby_reverse', w['sortby_reverse'].get_active(), section='mainlist')
+    
+    c.set('limit', str(int(w['s_limit'].get_value())), section='mainlist')
+    
 
-	# pdf font
-	if w['font'].get_filename():
-		c['font'] = w['font'].get_filename()
+    # pdf font
+    if w['font'].get_filename():
+        c['font'] = w['font'].get_filename()
 
-	# spellchecker
-	if w['spellchecker'].get_active():
-		c.set('gtkspell', True, section='spell')
-	else:
-		c.set('gtkspell', False, section='spell')
-	if w['spell_notes'].get_active():
-		c.set('notes', True, section='spell')
-	else:
-		c.set('notes', False, section='spell')
-	if w['spell_plot'].get_active():
-		c.set('plot', True, section='spell')
-	else:
-		c.set('plot', False, section='spell')
+    # spellchecker
+    if w['spellchecker'].get_active():
+        c.set('gtkspell', True, section='spell')
+    else:
+        c.set('gtkspell', False, section='spell')
+    if w['spell_notes'].get_active():
+        c.set('notes', True, section='spell')
+    else:
+        c.set('notes', False, section='spell')
+    if w['spell_plot'].get_active():
+        c.set('plot', True, section='spell')
+    else:
+        c.set('plot', False, section='spell')
 
-	# rating image
-	c['rating_image'] = str(w['rating_image'].get_active())
+    # rating image
+    c['rating_image'] = str(w['rating_image'].get_active())
 
-	#defaults
-	media_id = self.media_ids[w['media'].get_active()]
-	if media_id is None:
-		media_id = 0
-	c.set('media', media_id, section='defaults')
-	vcodec_id = self.vcodecs_ids[w['vcodec'].get_active()]
-	if vcodec_id is None:
-		vcodec_id = 0
-	c.set('vcodec', vcodec_id, section='defaults')
-	c.set('condition', str(w['condition'].get_active()), section='defaults')
-	c.set('region', str(w['region'].get_active()), section='defaults')
-	c.set('layers', str(w['layers'].get_active()), section='defaults')
-	c.set('color', str(w['color'].get_active()), section='defaults')
+    #defaults
+    media_id = self.media_ids[w['media'].get_active()]
+    if media_id is None:
+        media_id = 0
+    c.set('media', media_id, section='defaults')
+    vcodec_id = self.vcodecs_ids[w['vcodec'].get_active()]
+    if vcodec_id is None:
+        vcodec_id = 0
+    c.set('vcodec', vcodec_id, section='defaults')
+    c.set('condition', str(w['condition'].get_active()), section='defaults')
+    c.set('region', str(w['region'].get_active()), section='defaults')
+    c.set('layers', str(w['layers'].get_active()), section='defaults')
+    c.set('color', str(w['color'].get_active()), section='defaults')
 
-	# email reminder
-	if w['mail_use_auth'].get_active():
-		c.set('use_auth', True, section='mail')
-	else:
-		c.set('use_auth', False, section='mail')
-		
-	if w['mail_use_tls'].get_active():
-		c.set('mail_use_tls', True, section='mail')
-	else:
-		c.set('mail_use_tls', False, section='mail')
+    # email reminder
+    if w['mail_use_auth'].get_active():
+        c.set('use_auth', True, section='mail')
+    else:
+        c.set('use_auth', False, section='mail')
+        
+    if w['mail_use_tls'].get_active():
+        c.set('mail_use_tls', True, section='mail')
+    else:
+        c.set('mail_use_tls', False, section='mail')
 
-	c.set('smtp_server', w['mail_smtp_server'].get_text(), section='mail')
-	c.set('mail_smtp_port', w['mail_smtp_port'].get_text(), section='mail')
+    c.set('smtp_server', w['mail_smtp_server'].get_text(), section='mail')
+    c.set('mail_smtp_port', w['mail_smtp_port'].get_text(), section='mail')
 
-	c.set('username', w['mail_username'].get_text(), section='mail')
-	c.set('password', w['mail_password'].get_text(), section='mail')
-	c.set('email', w['mail_email'].get_text(), section='mail')
+    c.set('username', w['mail_username'].get_text(), section='mail')
+    c.set('password', w['mail_password'].get_text(), section='mail')
+    c.set('email', w['mail_email'].get_text(), section='mail')
 
-	# default movie plugin
-	if w['default_plugin'].get_active():
-		c['default_movie_plugin'] = \
-			gutils.on_combo_box_entry_changed(w['default_plugin'])
-	# search for:
-	c.set('s_classification', w['s_classification'].get_active(), section='add')
-	c.set('s_country', w['s_country'].get_active(), section='add')
-	c.set('s_director', w['s_director'].get_active(), section='add')
-	c.set('s_genre', w['s_genre'].get_active(), section='add')
-	c.set('s_image', w['s_image'].get_active(), section='add')
-	c.set('s_notes', w['s_notes'].get_active(), section='add')
-	c.set('s_o_site', w['s_o_site'].get_active(), section='add')
-	c.set('s_o_title', w['s_o_title'].get_active(), section='add')
-	c.set('s_plot', w['s_plot'].get_active(), section='add')
-	c.set('s_rating', w['s_rating'].get_active(), section='add')
-	c.set('s_runtime', w['s_runtime'].get_active(), section='add')
-	c.set('s_site', w['s_site'].get_active(), section='add')
-	c.set('s_studio', w['s_studio'].get_active(), section='add')
-	c.set('s_title', w['s_title'].get_active(), section='add')
-	c.set('s_trailer', w['s_trailer'].get_active(), section='add')
-	c.set('s_cast', w['s_cast'].get_active(), section='add')
-	c.set('s_year', w['s_year'].get_active(), section='add')
-	
-	mcounter = 0
-	for p in self.plugins:
-		plugin_module = os.path.basename(p).replace('.py','')
-		plugin_name = plugin_module.replace('PluginMovie','')
-		if gutils.on_combo_box_entry_changed(w['default_plugin']) == plugin_name:
-			self.d_plugin = mcounter
-		mcounter = mcounter + 1
-	self.widgets['add']['source'].set_active(self.d_plugin)
+    # default movie plugin
+    if w['default_plugin'].get_active():
+        c['default_movie_plugin'] = \
+            gutils.on_combo_box_entry_changed(w['default_plugin'])
+    # search for:
+    c.set('s_classification', w['s_classification'].get_active(), section='add')
+    c.set('s_country', w['s_country'].get_active(), section='add')
+    c.set('s_director', w['s_director'].get_active(), section='add')
+    c.set('s_genre', w['s_genre'].get_active(), section='add')
+    c.set('s_image', w['s_image'].get_active(), section='add')
+    c.set('s_notes', w['s_notes'].get_active(), section='add')
+    c.set('s_o_site', w['s_o_site'].get_active(), section='add')
+    c.set('s_o_title', w['s_o_title'].get_active(), section='add')
+    c.set('s_plot', w['s_plot'].get_active(), section='add')
+    c.set('s_rating', w['s_rating'].get_active(), section='add')
+    c.set('s_runtime', w['s_runtime'].get_active(), section='add')
+    c.set('s_site', w['s_site'].get_active(), section='add')
+    c.set('s_studio', w['s_studio'].get_active(), section='add')
+    c.set('s_title', w['s_title'].get_active(), section='add')
+    c.set('s_trailer', w['s_trailer'].get_active(), section='add')
+    c.set('s_cast', w['s_cast'].get_active(), section='add')
+    c.set('s_year', w['s_year'].get_active(), section='add')
+    
+    mcounter = 0
+    for p in self.plugins:
+        plugin_module = os.path.basename(p).replace('.py','')
+        plugin_name = plugin_module.replace('PluginMovie','')
+        if gutils.on_combo_box_entry_changed(w['default_plugin']) == plugin_name:
+            self.d_plugin = mcounter
+        mcounter = mcounter + 1
+    self.widgets['add']['source'].set_active(self.d_plugin)
 
-	if self.windows:
-		save_reader = ''
-	else:
-		save_reader = w['epdf_reader'].get_text()
+    if self.windows:
+        save_reader = ''
+    else:
+        save_reader = w['epdf_reader'].get_text()
 
-	c.set('lang', w['spell_lang'].get_text(), section='spell')
-	c['pdf_reader'] = save_reader
+    c.set('lang', w['spell_lang'].get_text(), section='spell')
+    c['pdf_reader'] = save_reader
 
-	c.set('amazon_locale', w['amazon_locale'].get_active(), section='add')
-	
-	if spell_support:
-		if c.get('gtkspell', False, section='spell') == False and not was_false:
-			self.notes_spell.detach()
-			self.plot_spell.detach()
-		elif c.get('gtkspell', False, section='spell') == True and was_false:
-			initialize.initialize_gtkspell(self)
-		else:
-			pass
+    c.set('amazon_locale', w['amazon_locale'].get_active(), section='add')
+    
+    if spell_support:
+        if c.get('gtkspell', False, section='spell') == False and not was_false:
+            self.notes_spell.detach()
+            self.plot_spell.detach()
+        elif c.get('gtkspell', False, section='spell') == True and was_false:
+            initialize.initialize_gtkspell(self)
+        else:
+            pass
 
-		if c.get('gtkspell', False, section='spell') == True:
-			if c.get('plot', True, section='spell') == False and not plot_was_false:
-				self.plot_spell.detach()
-			elif c.get('plot', True, section='spell') == True and plot_was_false:
-				self.plot_spell = gtkspell.Spell(self.widgets['add']['plot'])
-				self.plot_spell.set_language(c.get('lang', 'en', section='spell'))
-			else:
-				pass
+        if c.get('gtkspell', False, section='spell') == True:
+            if c.get('plot', True, section='spell') == False and not plot_was_false:
+                self.plot_spell.detach()
+            elif c.get('plot', True, section='spell') == True and plot_was_false:
+                self.plot_spell = gtkspell.Spell(self.widgets['add']['plot'])
+                self.plot_spell.set_language(c.get('lang', 'en', section='spell'))
+            else:
+                pass
 
-			if c.get('notes', True, section='spell') == False and not notes_was_false:
-				self.notes_spell.detach()
-			elif c.get('notes', True, section='spell') == True and notes_was_false:
-				self.notes_spell = gtkspell.Spell(self.widgets['add']['notes'])
-				self.notes_spell.set_language(c.get('lang', 'en', section='spell'))
-			else:
-				pass
-	self.pdf_reader = save_reader
+            if c.get('notes', True, section='spell') == False and not notes_was_false:
+                self.notes_spell.detach()
+            elif c.get('notes', True, section='spell') == True and notes_was_false:
+                self.notes_spell = gtkspell.Spell(self.widgets['add']['notes'])
+                self.notes_spell.set_language(c.get('lang', 'en', section='spell'))
+            else:
+                pass
+    self.pdf_reader = save_reader
 
-	# database
-	old = c.toDict(section='database')
-	
-	c.set('host', w['db_host'].get_text(), section='database')
-	c.set('port', int(w['db_port'].get_value()), section='database')
-	c.set('name', w['db_name'].get_text(), section='database')
-	c.set('user', w['db_user'].get_text(), section='database')
-	c.set('passwd', w['db_passwd'].get_text(), section='database')
-	db_type = int(w['db_type'].get_active())
-	if db_type == 1:
-		c.set('type', 'postgres', section='database')
-	elif db_type == 2:
-		c.set('type', 'mysql', section='database')
-	elif db_type == 3:
-		c.set('type', 'mssql', section='database')
-	else:
-		c.set('type', 'sqlite', section='database')
+    # database
+    old = c.toDict(section='database')
+    
+    c.set('host', w['db_host'].get_text(), section='database')
+    c.set('port', int(w['db_port'].get_value()), section='database')
+    c.set('name', w['db_name'].get_text(), section='database')
+    c.set('user', w['db_user'].get_text(), section='database')
+    c.set('passwd', w['db_passwd'].get_text(), section='database')
+    db_type = int(w['db_type'].get_active())
+    if db_type == 1:
+        c.set('type', 'postgres', section='database')
+    elif db_type == 2:
+        c.set('type', 'mysql', section='database')
+    elif db_type == 3:
+        c.set('type', 'mssql', section='database')
+    else:
+        c.set('type', 'sqlite', section='database')
 
-	if old['type'] != c.get('type', section='database') or (old['type']!='sqlite' and (\
-			old['host'] != c.get('host', section='database') or \
-			old['port'] != c.get('port', section='database') or \
-			old['user'] != c.get('user', section='database') or \
-			old['passwd'] != c.get('passwd', section='database'))) or \
-			old['name'] != c.get('name', section='database'):
-		self.debug.show('DATABASE: connecting to new db server...')
-		
-		# new database connection
-		import sql
-		self.initialized = False
-		self.db.metadata.clear()
-		from sqlalchemy.orm import clear_mappers
-		from sqlalchemy.exceptions import InvalidRequestError
-		clear_mappers()
-		try:
-			self.db = sql.GriffithSQL(c, self.debug, self.locations['home'])
-		except InvalidRequestError, e:
-			self.debug.show(str(e))
-			c.set('type', 'sqlite', section='database')
-			w['db_type'].set_active(0)
-			self.db = sql.GriffithSQL(c, self.debug, self.locations['home'])
+    if old['type'] != c.get('type', section='database') or (old['type']!='sqlite' and (\
+            old['host'] != c.get('host', section='database') or \
+            old['port'] != c.get('port', section='database') or \
+            old['user'] != c.get('user', section='database') or \
+            old['passwd'] != c.get('passwd', section='database'))) or \
+            old['name'] != c.get('name', section='database'):
+        self.debug.show('DATABASE: connecting to new db server...')
+        
+        # new database connection
+        import sql
+        self.initialized = False
+        self.db.metadata.clear()
+        from sqlalchemy.orm import clear_mappers
+        from sqlalchemy.exceptions import InvalidRequestError
+        clear_mappers()
+        try:
+            self.db = sql.GriffithSQL(c, self.debug, self.locations['home'])
+        except InvalidRequestError, e:
+            self.debug.show(str(e))
+            c.set('type', 'sqlite', section='database')
+            w['db_type'].set_active(0)
+            self.db = sql.GriffithSQL(c, self.debug, self.locations['home'])
 
-		self.debug.show(&quot;New database Engine: %s&quot; % self.db.metadata.engine.name)
-		
-		# initialize new database
-		self.total = int(self.db.Movie.query.count())
-		self.count_statusbar()
-		from initialize	import dictionaries, people_treeview, location_posters
-		c['posters'] = None # force update
-		location_posters(self.locations, self.config)
-		dictionaries(self)
-		people_treeview(self, False)
-		self.initialized = True
-	self.clear_details()
-	self.filter_txt(None)
-	c.save()
+        self.debug.show(&quot;New database Engine: %s&quot; % self.db.metadata.engine.name)
+        
+        # initialize new database
+        self.total = int(self.db.Movie.query.count())
+        self.count_statusbar()
+        from initialize    import dictionaries, people_treeview, location_posters
+        c['posters'] = None # force update
+        location_posters(self.locations, self.config)
+        dictionaries(self)
+        people_treeview(self, False)
+        self.initialized = True
+    self.clear_details()
+    self.filter_txt(None)
+    c.save()

Modified: trunk/lib/quick_filter.py
===================================================================
--- trunk/lib/quick_filter.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/quick_filter.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -23,35 +23,37 @@
 
 from gettext import gettext as _
 import gutils
+import db
 
 def change_filter(self):
-	x = 0
-	text = gutils.gescape(self.widgets['filter']['text'].get_text())
-	
-	from sqlalchemy import select
-	statement = select(self.db.Movie.c)
-	
-	if text:
-		criteria = self.search_criteria[self.widgets['filter']['criteria'].get_active()]
-		if criteria in ('year', 'runtime', 'media_num', 'rating'):
-			statement.append_whereclause(self.db.Movie.c[criteria]==text)
-		else:
-			statement.append_whereclause(self.db.Movie.c[criteria].like('%'+text+'%'))
-	if self.widgets['filter']['text'].is_focus():
-		if len(text)&lt;4: # filter mode
-			limit = int(self.config.get('limit', 0, section='mainlist'))
-			if limit &gt; 0:
-				statement.limit = limit
-	self.populate_treeview(statement)
+    x = 0
+    text = gutils.gescape(self.widgets['filter']['text'].get_text())
+    
+    from sqlalchemy import select
+    from sqlalchemy.orm.util import class_mapper, object_mapper
+    statement = select(db.movies_table.columns, bind=self.db.session.bind)
+    
+    if text:
+        criteria = self.search_criteria[self.widgets['filter']['criteria'].get_active()]
+        if criteria in ('year', 'runtime', 'media_num', 'rating'):
+            statement.append_whereclause(db.movies_table.c[criteria]==text)
+        else:
+            statement.append_whereclause(db.movies_table.c[criteria].like('%'+text+'%'))
+    if self.widgets['filter']['text'].is_focus():
+        if len(text)&lt;4: # filter mode
+            limit = int(self.config.get('limit', 0, section='mainlist'))
+            if limit &gt; 0:
+                statement.limit = limit
+    self.populate_treeview(statement)
 
 def clear_filter(self):
-	# prevent multiple treeview updates
-	self.initialized = False
-	self.widgets['filter']['text'].set_text('')
-	self.widgets['filter']['criteria'].set_active(0)
-	self.widgets['filter']['collection'].set_active(0)
-	self.widgets['filter']['volume'].set_active(0)
-	self.widgets['filter']['tag'].set_active(0)
-	self.initialized = True
-	self.populate_treeview()
+    # prevent multiple treeview updates
+    self.initialized = False
+    self.widgets['filter']['text'].set_text('')
+    self.widgets['filter']['criteria'].set_active(0)
+    self.widgets['filter']['collection'].set_active(0)
+    self.widgets['filter']['volume'].set_active(0)
+    self.widgets['filter']['tag'].set_active(0)
+    self.initialized = True
+    self.populate_treeview()
 

Modified: trunk/lib/sql.py
===================================================================
--- trunk/lib/sql.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/sql.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -1,4 +1,5 @@
 # -*- coding: UTF-8 -*-
+# vim: fdm=marker
 
 __revision__ = '$Id$'
 
@@ -21,513 +22,113 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
-from sqlalchemy import *
-from sqlalchemy.orm import *
-from sqlalchemy.exceptions import *
+# imports
+#from sqlalchemy            import *
+from sqlalchemy.orm        import sessionmaker
+from sqlalchemy.exceptions import SQLError
+from gettext               import gettext as _
 import os.path
 import gutils
-import gtk
 
-class DBTable(object):#{{{
-	def __repr__(self):
-		return &quot;%s:%s&quot; % (self.__class__.__name__, self.name)
-	def add_to_db(self):
-		if self.name is None or len(self.name)==0:
-			debug.show(&quot;%s: name can't be empty&quot; % self.__class__.__name__)
-			return False
-		# check if item already exists
-		if self.query.filter_by(name=self.name).first() is not None:
-			debug.show(&quot;%s: '%s' already exists&quot; % (self.__class__.__name__, self.name))
-			return False
-		debug.show(&quot;%s: adding '%s' to database...&quot; % (self.__class__.__name__, self.name))
-		self.save()
-		try:
-			self.flush()
-		except exceptions.SQLError, e:
-			debug.show(&quot;%s: add_to_db: %s&quot; % (self.__class__.__name__, e))
-			return False
-		self.refresh()
-		return True
-	def remove_from_db(self):
-		dbtable_id = self.__dict__[self.__class__.__name__.lower() + '_id']
-		if dbtable_id&lt;1:
-			debug.show(&quot;%s: none selected =&gt; none removed&quot; % self.__class__.__name__)
-			return False
-		tmp = None
-		if hasattr(self,'movies'):
-			tmp = getattr(self,'movies')
-		elif hasattr(self,'movielangs'):
-			tmp = getattr(self,'movielangs')
-		if tmp and len(tmp)&gt;0:
-			gutils.warning(self, msg=_(&quot;This item is in use.\nOperation aborted!&quot;))
-			return False
-		debug.show(&quot;%s: removing '%s' (id=%s) from database...&quot;%(self.__class__.__name__, self.name, dbtable_id))
-		self.delete()
-		try:
-			self.flush()
-		except exceptions.SQLError, e:
-			debug.show(&quot;%s: remove_from_db: %s&quot; % (self.__class__.__name__, e))
-			return False
-		#self.refresh()
-		return True
-	def update_in_db(self):
-		dbtable_id = self.__dict__[self.__class__.__name__.lower() + '_id']
-		if dbtable_id&lt;1:
-			debug.show(&quot;%s: none selected =&gt; none updated&quot; % self.__class__.__name__)
-			return False
-		if self.name is None or len(self.name)==0:
-			debug.show(&quot;%s: name can't be empty&quot; % self.__class__.__name__)
-			return False
-		tmp = self.query.filter_by(name=self.name).first()
-		if tmp is not None and tmp is not self:
-			gutils.warning(self, msg=_(&quot;This name is already in use!&quot;))
-			return False
-		self.update()
-		try:
-			self.flush()
-		except exceptions.SQLError, e:
-			debug.show(&quot;%s: update_in_db: %s&quot; % (self.__class__.__name__, e))
-			return False
-		self.refresh()
-		return True#}}}
+from db import * # ORM data (SQLAlchemy stuff)
 
 class GriffithSQL:
-	version = 2	# database format version, incrase after any changes in data structures
-	metadata = None
-	class Configuration(object):
-		def __repr__(self):
-			return &quot;Config:%s=%s&quot; % (self.param, self.value)
-	class AChannel(DBTable):
-		pass
-	class ACodec(DBTable):
-		pass
-	class Collection(DBTable):
-		pass
-	class Lang(DBTable):
-		pass
-	class Medium(DBTable):
-		pass
-	class MovieLang(object):
-		def __repr__(self):
-			return &quot;MovieLang:%s-%s (Type:%s ACodec:%s AChannel:%s SubFormat:%s)&quot; % \
-				(self.movie_id, self.lang_id, self.type, self.acodec_id, self.achannel_id, self.subformat_id)
-	class MovieTag(object):
-		def __repr__(self):
-			return &quot;MovieTag:%s-%s&quot; % (self.movie_id, self.tag_id)
-	class Person(DBTable):
-		pass
-	class SubFormat(DBTable):
-		pass
-	class Tag(DBTable):
-		def remove_from_db(self):
-			if len(self.movietags) &gt; 0:
-				gutils.warning(self, msg=_(&quot;This item is in use.\nOperation aborted!&quot;))
-				return False
-			return DBTable.remove_from_db(self)
-	class VCodec(DBTable):
-		pass
-	class Volume(DBTable):
-		pass
-	class Loan(object):#{{{
-		def __repr__(self):
-			return &quot;Loan:%s (movie:%s person:%s)&quot; % (self.loan_id, self.movie_id, self.person_id)
-		def __setitem__(self, key, value):
-			if key == 'movie_id' and value:
-				if GriffithSQL.Movie.query.filter_by(movie_id=value).first() is None:
-					raise ValueError('wrong movie_id')
-			elif key == 'person_id' and value:
-				if GriffithSQL.Person.query.filter_by(person_id=value).first() is None:
-					raise ValueError('wrong movie_id')
-			self[key] = value
-		def _validate(self):
-			if self.movie_id is None:
-				raise ValueError('movie_id is not set')
-			if self.person_id is None:
-				raise ValueError('person_id is not set')
-			if self.movie is None:
-				self.movie = GriffithSQL.Movie.query.filter_by(movie_id=self.movie_id).first()
-				if self.movie is None:
-					raise ValueError('wrong movie_id')
-			if self.person is None:
-				self.person = GriffithSQL.Person.query.filter_by(person_id=self.person_id).first()
-				if self.person is None:
-					raise ValueError('wrong person_id')
-			if self.collection_id&gt;0 and self.collection is None:
-				self.collection = GriffithSQL.Collection.query.filter_by(collection_id=self.collection_id).first()
-				if self.collection is None:
-					raise ValueError('wrong collection_id')
-			if self.volume_id&gt;0 and self.volume is None:
-				self.volume = GriffithSQL.Volume.query.filter_by(volume_id=self.volume_id).first()
-				if self.volume is None:
-					raise ValueError('wrong volume_id')
-			return True
-		def set_loaned(self):
-			&quot;&quot;&quot;
-			Set loaned=True for all movies in volume/collection and for movie itself
-			Set loan's date to today's date
-			&quot;&quot;&quot;
-			self._validate()
+    version = 2    # database format version, incrase after any changes in data structures
 
-			if self.collection is not None:
-				self.movie.mapper.mapped_table.update(self.movie.c.collection_id==self.collection_id).execute(loaned=True)
-				self.collection.loaned = True
-				self.collection.update()
-			if self.volume is not None:
-				self.movie.mapper.mapped_table.update(self.movie.c.volume_id==self.volume_id).execute(loaned=True)
-				self.volume.loaned = True
-				self.volume.update()
-			if self.movie is None:
-				self.movie = Movie.query.filter_by(movie_id=self.movie_id).first()
-			self.movie.loaned = True
-			self.movie.update()
-			if self.date is None:
-				self.date = func.current_date()	# update loan date
-			self.return_date = None
-			self.save_or_update()
-			try:
-				self.mapper.get_session().flush()
-				self.refresh()
-			except exceptions.SQLError, e:
-				debug.show(&quot;set_loaned: %s&quot; % e)
-				return False
-			return True
-		def set_returned(self):
-			&quot;&quot;&quot;
-			Set loaned=False for all movies in volume/collection and for movie itself.
-			Set return_date to today's date
-			&quot;&quot;&quot;
-			self._validate()
-			if self.collection is not None:
-				self.movie.mapper.mapped_table.update(self.movie.c.collection_id==self.collection_id).execute(loaned=False)
-				self.collection.loaned = False
-				self.collection.update()
-			if self.volume_id is not None:
-				self.movie.mapper.mapped_table.update(self.movie.c.volume_id==self.volume_id).execute(loaned=False)
-				self.volume.loaned = False
-				self.volume.update()
-			self.movie.loaned = False
-			self.movie.update()
-			if self.return_date is None:
-				self.return_date = func.current_date()
-			self.save_or_update()
-			try:
-				self.mapper.get_session().flush()
-				self.refresh()
-			except exceptions.SQLError, e:
-				debug.show(&quot;set_returned: %s&quot; % e)
-				return False
-			return True
-			#}}}
-	class Movie(object):#{{{
-		def __repr__(self):
-			return &quot;Movie:%s (number=%s)&quot; % (self.movie_id, self.number)
-		def __setitem__(self, key, value):
-			setattr(self,key,value)
-		def __getitem__(self, key):
-			return getattr(self,key)
-		def has_key(self, key):
-			if key in ('volume','collection','medium','vcodec','loans','tags','languages','lectors','dubbings','subtitles'):
-				return True
-			else:
-				return self.c.has_key(key)
-		def remove_from_db(self):
-			if self.loaned == True:
-				debug.show(&quot;You can't remove loaned movie!&quot;)
-				return False
-			self.delete()
-			try:
-				self.flush()
-			except exceptions.SQLError, e:
-				debug.show(&quot;remove_from_db: %s&quot; % e)
-				return False
-			return True
-		def update_in_db(self, t_movies=None):
-			if self.movie_id &lt; 1:
-				raise ValueError('movie_id is not set')
-			if t_movies is not None:
-				self.languages.clear()
-				self.tags.clear()
-				#self.mapper.mapped_table.update(self.c.movie_id==t_movies['movie_id']).execute(t_movies)
-			return self.add_to_db(t_movies)
-		def add_to_db(self, t_movies=None):
-			if t_movies is not None:
-				t_tags = t_languages = None
-				if t_movies.has_key('tags'):
-					t_tags = t_movies.pop('tags')
-				if t_movies.has_key('languages'):
-					t_languages = t_movies.pop('languages')
-				for i in self.c.keys():
-					if t_movies.has_key(i):
-						self[i] = t_movies[i]
-				# languages
-				if t_languages is not None:
-					for lang in t_languages:
-						if lang[0]&gt;0:
-							ml = GriffithSQL.MovieLang(lang_id=lang[0], type=lang[1],
-								acodec_id=lang[2], achannel_id=lang[3], subformat_id=lang[4])
-							self.languages.append(ml)
-				# tags
-				if t_tags is not None:
-					for tag in t_tags.keys():
-						self.tags.append(GriffithSQL.Tag(tag_id=tag))
-			self.update()
-			try:
-				self.flush()
-			except exceptions.SQLError, e:
-				debug.show(&quot;add_to_db: %s&quot; % e)
-				if e.args[0][:16] == '(IntegrityError)':
-					gutils.error(None, _('Column &quot;%s&quot; is not unique') % _('Number'))
-				return False
-			self.refresh()
-			return True
-		#}}}
+    def __init__(self, config, gdebug, griffith_dir):
+        #mapper = Session.mapper
+        global debug
+        debug = gdebug
+        if config.get('type', None, section='database') is None:
+            config.set('type', 'sqlite', section='database')
 
-	def __init__(self, config, gdebug, griffith_dir):
-		from sqlalchemy.orm import scoped_session, sessionmaker
-		Session = scoped_session(sessionmaker(autoflush=True, transactional=True))
-		mapper = Session.mapper
-		global debug
-		debug = gdebug
-		if config.get('type', None, section='database') is None:
-			config.set('type', 'sqlite', section='database')
+        if config.get('type', 'sqlite', section='database') != 'sqlite':
+            if config.get('host', None, section='database') is None:
+                config.set('host', '127.0.0.1', section='database')
+            if config.get('user', None, section='database') is None:
+                config.set('user', 'griffith', section='database')
+            if config.get('passwd', None, section='database') is None:
+                config.set('passwd', 'gRiFiTh', section='database')
+            if config.get('name', None, section='database') is None:
+                config.set('name', 'griffith', section='database')
 
-		if config.get('type', 'sqlite', section='database') != 'sqlite':
-			if config.get('host', None, section='database') is None:
-				config.set('host', '127.0.0.1', section='database')
-			if config.get('user', None, section='database') is None:
-				config.set('user', 'griffith', section='database')
-			if config.get('passwd', None, section='database') is None:
-				config.set('passwd', 'gRiFiTh', section='database')
-			if config.get('name', None, section='database') is None:
-				config.set('name', 'griffith', section='database')
+        # connect to database --------------------------------------{{{
+        if config.get('type', section='database') == 'sqlite':
+            url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, config.get('name', 'griffith', section='database') + '.db')
+        elif config.get('type', section='database') == 'postgres':
+            if config.get('port', 0, section='database')==0:
+                config.set('port', 5432, section='database')
+            url = &quot;<A HREF="postgres://%s:%s@%s:%d/%s">postgres://%s:%s@%s:%d/%s</A>&quot; % (
+                config.get('user', section='database'),
+                config.get('passwd', section='database'),
+                config.get('host', section='database'),
+                int(config.get('port', section='database')),
+                config.get('name', section='database'))
+        elif config.get('type', section='database') == 'mysql':
+            if config.get('port', 0, section='database')==0:
+                config.set('port', 3306, section='database')
+            url = &quot;<A HREF="mysql://%s:%s@%s:%d/%s">mysql://%s:%s@%s:%d/%s</A>&quot; % (
+                config.get('user', section='database'),
+                config.get('passwd', section='database'),
+                config.get('host', section='database'),
+                int(config.get('port', section='database')),
+                config.get('name', section='database'))
+        elif config.get('type', section='database') == 'mssql':
+            if config.get('port', 0, section='database')==0:
+                config.set('port', 1433, section='database')
+            # use_scope_identity=0 have to be set as workaround for a sqlalchemy bug
+            # but it is not guaranteed that the right identity value will be selected
+            # because the select @@identity statement selects the very last id which
+            # also can be a id from a trigger-insert or another user
+            # sqlalchemy uses a wrong syntax. It has to select the id within the insert
+            # statement: insert &lt;table&gt; (&lt;columns&gt;) values (&lt;values&gt;) select scope_identity()
+            # (one statement !) After preparing and executing there should be a fetch
+            # If it is executed as two separate statements the scope is lost after insert.
+            url = &quot;<A HREF="mssql://%s:%s@%s:%d/%s?use_scope_identity=0">mssql://%s:%s@%s:%d/%s?use_scope_identity=0</A>&quot; % (
+                config.get('user', section='database'),
+                config.get('passwd', section='database'),
+                config.get('host', section='database'),
+                int(config.get('port', section='database')),
+                config.get('name', section='database'))
+        else:
+            config.set('type', 'sqlite', section='database')
+            url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, config.get('name', 'griffith', section='database') + '.db')
 
-		# connect to database --------------------------------------{{{
-		if config.get('type', section='database') == 'sqlite':
-			url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, config.get('name', 'griffith', section='database') + '.db')
-		elif config.get('type', section='database') == 'postgres':
-			if config.get('port', 0, section='database')==0:
-				config.set('port', 5432, section='database')
-			url = &quot;<A HREF="postgres://%s:%s@%s:%d/%s">postgres://%s:%s@%s:%d/%s</A>&quot; % (
-				config.get('user', section='database'),
-				config.get('passwd', section='database'),
-				config.get('host', section='database'),
-				int(config.get('port', section='database')),
-				config.get('name', section='database'))
-		elif config.get('type', section='database') == 'mysql':
-			if config.get('port', 0, section='database')==0:
-				config.set('port', 3306, section='database')
-			url = &quot;<A HREF="mysql://%s:%s@%s:%d/%s">mysql://%s:%s@%s:%d/%s</A>&quot; % (
-				config.get('user', section='database'),
-				config.get('passwd', section='database'),
-				config.get('host', section='database'),
-				int(config.get('port', section='database')),
-				config.get('name', section='database'))
-		elif config.get('type', section='database') == 'mssql':
-			if config.get('port', 0, section='database')==0:
-				config.set('port', 1433, section='database')
-			# use_scope_identity=0 have to be set as workaround for a sqlalchemy bug
-			# but it is not guaranteed that the right identity value will be selected
-			# because the select @@identity statement selects the very last id which
-			# also can be a id from a trigger-insert or another user
-			# sqlalchemy uses a wrong syntax. It has to select the id within the insert
-			# statement: insert &lt;table&gt; (&lt;columns&gt;) values (&lt;values&gt;) select scope_identity()
-			# (one statement !) After preparing and executing there should be a fetch
-			# If it is executed as two separate statements the scope is lost after insert.
-			url = &quot;<A HREF="mssql://%s:%s@%s:%d/%s?use_scope_identity=0">mssql://%s:%s@%s:%d/%s?use_scope_identity=0</A>&quot; % (
-				config.get('user', section='database'),
-				config.get('passwd', section='database'),
-				config.get('host', section='database'),
-				int(config.get('port', section='database')),
-				config.get('name', section='database'))
-		else:
-			config.set('type', 'sqlite', section='database')
-			url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, config.get('name', 'griffith', section='database') + '.db')
-		try:
-			self.metadata = MetaData(url)
-		except Exception, e:	# InvalidRequestError, ImportError
-			debug.show(&quot;MetaData: %s&quot; % e)
-			config.set('type', 'sqlite', section='database')
-			gutils.warning(self, &quot;%s\n\n%s&quot; % (_('Cannot connect to database.\nFalling back to SQLite.'), _('Please check debug output for more informations.')))
-			self.metadata = MetaData(&quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, config.get('name', 'griffith', section='database') + '.db'))
+        try:
+            engine = create_engine(url, echo=False)
+            conn = engine.connect()
+        except Exception, e:    # InvalidRequestError, ImportError
+            debug.show(&quot;MetaData: %s&quot; % e)
+            config.set('type', 'sqlite', section='database')
+            gutils.warning(self, &quot;%s\n\n%s&quot; % (_('Cannot connect to database.\nFalling back to SQLite.'), _('Please check debug output for more informations.')))
+            url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, config.get('name', 'griffith', section='database') + '.db')
+            engine = create_engine(url)
+            conn = engine.connect()
 
-		# try to establish a db connection
-		try:
-			self.metadata.bind.connect()
-		except Exception, e:
-			debug.show(&quot;engine connection: %s&quot; % e)
-			gutils.error(self, _('Database connection failed.'))
-			config.set('type', 'sqlite', section='database')
-			url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, 'griffith.db')
-			self.metadata = MetaData(url)
-			self.metadata.bind.connect()
-		#}}}
+        # try to establish a db connection
+        try:
+            Session = sessionmaker(bind=engine)
+            self.session = Session()
+            #self.metadata.bind.connect()
+        except Exception, e:
+            debug.show(&quot;engine connection: %s&quot; % e)
+            gutils.error(self, _('Database connection failed.'))
+            config.set('type', 'sqlite', section='database')
+            url = &quot;<A HREF="sqlite:///%s">sqlite:///%s</A>&quot; % os.path.join(griffith_dir, 'griffith.db')
+            engine = create_engine(url)
+            Session = sessionmaker(bind=engine)
+            self.session = Session()
+        #}}}
+        
+        # check if database needs an upgrade
+        try:
+            v = self.session.query(Configuration).filter_by(param='version').one()    # returns None if table exists &amp;&amp; param ISNULL
+        except SQLError, e:    # table doesn't exist
+            debug.show(&quot;DB version: %s&quot; % e)
+            v = 0
 
-		# prepare tables interface ---------------------------------{{{
-		movies = Table('movies', self.metadata,
-			Column('movie_id', Integer, primary_key = True),
-			Column('number', Integer, nullable=False, unique=True),
-			Column('collection_id', Integer, ForeignKey('collections.collection_id')),
-			Column('volume_id', Integer, ForeignKey('volumes.volume_id')),
-			Column('medium_id', Integer, ForeignKey('media.medium_id')),
-			Column('vcodec_id', Integer, ForeignKey('vcodecs.vcodec_id')),
-			Column('loaned', Boolean, nullable=False, default=False),
-			Column('seen', Boolean, nullable=False, default=False),
-			Column('rating', SmallInteger(2)),
-			Column('color', SmallInteger),
-			Column('cond', SmallInteger),	# MySQL will not accept name &quot;condition&quot;
-			Column('layers', SmallInteger),
-			Column('region', SmallInteger),
-			Column('media_num', SmallInteger),
-			Column('runtime', Integer),
-			Column('year', Integer),
-			Column('o_title', VARCHAR(255)),
-			Column('title', VARCHAR(255)),
-			Column('director', VARCHAR(255)),
-			Column('o_site', VARCHAR(255)),
-			Column('site', VARCHAR(255)),
-			Column('trailer', VARCHAR(256)),
-			Column('country', VARCHAR(128)),
-			Column('genre', VARCHAR(128)),
-			Column('image', VARCHAR(128)),
-			Column('studio', VARCHAR(128)),
-			Column('classification', VARCHAR(128)),
-			Column('cast', TEXT),
-			Column('plot', TEXT),
-			Column('notes', TEXT))
-		loans = Table('loans', self.metadata,
-			Column('loan_id', Integer, primary_key=True),
-			Column('person_id', Integer, ForeignKey('people.person_id'), nullable=False),
-			Column('movie_id', Integer, ForeignKey('movies.movie_id'), nullable=False),
-			Column('volume_id', Integer, ForeignKey('volumes.volume_id')),
-			Column('collection_id', Integer, ForeignKey('collections.collection_id')),
-			Column('date', Date, nullable=False, default=func.current_date()),
-			Column('return_date', Date, nullable=True))
-		people = Table('people', self.metadata,
-			Column('person_id', Integer, primary_key=True),
-			Column('name', VARCHAR(255), nullable=False, unique=True),
-			Column('email', VARCHAR(128)),
-			Column('phone', VARCHAR(64)))
-		volumes = Table('volumes', self.metadata,
-			Column('volume_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True),
-			Column('loaned', Boolean, nullable=False, default=False))
-		collections = Table('collections', self.metadata,
-			Column('collection_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True),
-			Column('loaned', Boolean, nullable=False, default=False))
-		media = Table('media', self.metadata,
-			Column('medium_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True))
-		languages = Table('languages', self.metadata,
-			Column('lang_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True))
-		vcodecs = Table('vcodecs', self.metadata,
-			Column('vcodec_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True))
-		acodecs = Table('acodecs', self.metadata,
-			Column('acodec_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True))
-		achannels = Table('achannels', self.metadata,
-			Column('achannel_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True))
-		subformats = Table('subformats', self.metadata,
-			Column('subformat_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True))
-		tags = Table('tags', self.metadata,
-			Column('tag_id', Integer, primary_key=True),
-			Column('name', VARCHAR(64), nullable=False, unique=True))
-		movie_lang = Table('movie_lang', self.metadata,
-			Column('ml_id', Integer, primary_key=True),
-			Column('type', SmallInteger), # 0: Original, 1:lector, 2:dubbing, 3:subtitle 
-			Column('movie_id', Integer, ForeignKey('movies.movie_id'), nullable=False),
-			Column('lang_id', Integer, ForeignKey('languages.lang_id'), nullable=False),
-			Column('acodec_id', Integer, ForeignKey('acodecs.acodec_id')),
-			Column('achannel_id', Integer, ForeignKey('achannels.achannel_id')),
-			Column('subformat_id', Integer, ForeignKey('subformats.subformat_id')))
-		movie_tag = Table('movie_tag', self.metadata,
-			Column('mt_id', Integer, primary_key=True),
-			Column('movie_id', Integer, ForeignKey('movies.movie_id')),
-			Column('tag_id', Integer, ForeignKey('tags.tag_id')))
-		configuration = Table('configuration', self.metadata,
-			Column('param', VARCHAR(16), primary_key=True),
-			Column('value', VARCHAR(128), nullable=False))#}}}
-
-		# mappers -------------------------------------------------#{{{
-		mapper(self.Configuration, configuration)
-		mapper(self.Volume, volumes, order_by=volumes.c.name, properties={
-			'movies': relation(self.Movie, backref='volume')})
-		mapper(self.Collection, collections, order_by=collections.c.name, properties={
-			'movies': relation(self.Movie, backref='collection')})
-		mapper(self.Medium, media, properties={
-			'movies': relation(self.Movie, backref='medium')})
-		mapper(self.VCodec, vcodecs, properties={
-			'movies': relation(self.Movie, backref='vcodec')})
-		mapper(self.Person, people, properties = {
-			'loans'    : relation(self.Loan, backref='person', cascade='all, delete-orphan')})
-		mapper(self.MovieLang, movie_lang, primary_key=[movie_lang.c.ml_id], properties = {
-			'movie'    : relation(self.Movie, lazy=False),
-			'language' : relation(self.Lang, lazy=False),
-			'achannel' : relation(self.AChannel),
-			'acodec'   : relation(self.ACodec),
-			'subformat': relation(self.SubFormat)})
-		mapper(self.ACodec, acodecs, properties={
-			'movielangs': relation(self.MovieLang, lazy=False)})
-		mapper(self.AChannel, achannels, properties={
-			'movielangs': relation(self.MovieLang, lazy=False)})
-		mapper(self.SubFormat, subformats, properties={
-			'movielangs': relation(self.MovieLang, lazy=False)})
-		mapper(self.Lang, languages, properties={
-			'movielangs': relation(self.MovieLang, lazy=False)})
-		mapper(self.MovieTag, movie_tag)
-		mapper(self.Tag, tags, properties={'movietags': relation(self.MovieTag, backref='tag')})
-		mapper(self.Loan, loans, properties = {
-			'volume'    : relation(self.Volume),
-			'collection': relation(self.Collection)})
-		mapper(self.Movie, movies, order_by=movies.c.number , properties = {
-			'loans'     : relation(self.Loan, backref='movie', cascade='all, delete-orphan'),
-			#'tags'       : relation(self.Tag, cascade='all, delete-orphan', secondary=movie_tag,
-			'tags'      : relation(self.Tag, secondary=movie_tag,
-					primaryjoin=movies.c.movie_id==movie_tag.c.movie_id,
-					secondaryjoin=movie_tag.c.tag_id==tags.c.tag_id),
-			'languages' : relation(self.MovieLang, cascade='all, delete-orphan')})#}}}
-		
-		self.metadata.create_all()
-		# check if database needs upgrade
-		try:
-			v = self.Configuration.query.filter_by(param='version').one()	# returns None if table exists &amp;&amp; param ISNULL
-		except SQLError, e:	# table doesn't exist
-			debug.show(&quot;DB version: %s&quot; % e)
-			v = 0
-
-		if v is not None and v&gt;1:
-			v = int(v.value)
-		# FIXME:
-#		if v &lt; self.version:
-#			from dbupgrade import upgrade_database
-#			upgrade_database(self, v)
-
-# for debugging (run: ipython sql.py)
-if __name__ == '__main__':
-	import sys
-	import config, gdebug
-	from initialize import locations, location_posters
-	from gconsole import check_args, check_args_with_db
-	
-	class Tmp:
-		def __init__(self):
-			self.debug = gdebug.GriffithDebug(True)
-	tmp = Tmp()
-	check_args(tmp)
-	locations(tmp)
-	tmp.config = config.Config(os.path.join(tmp.locations['home'], 'griffith.cfg'))
-	location_posters(tmp.locations, tmp.config)
-	
-	db = GriffithSQL(tmp.config, tmp.debug, tmp.locations['home'])
-	check_args_with_db(tmp)
-	
-	print '\nGriffithSQL test drive\n======================'
-	print &quot;Engine: %s&quot; % (db.metadata.bind.name)
-	print 'Database object name: db\n'
-
-# vim: fdm=marker
+        if v is not None and v&gt;1:
+            v = int(v.value)
+        if v &lt; self.version:
+            from dbupgrade import upgrade_database
+            upgrade_database(self, v)

Modified: trunk/lib/test_movieplugins.py
===================================================================
--- trunk/lib/test_movieplugins.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/test_movieplugins.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -45,11 +45,11 @@
 import gdebug
 import gutils
 try:
-	import gtk
-	import gobject
+    import gtk
+    import gobject
 except:
-	pass
-	
+    pass
+    
 sys.path.append('plugins/movie')
 
 #
@@ -58,206 +58,206 @@
 # compares the results with the expected once
 #
 class PluginTester:
-	test_plugins = [
-		'PluginMovieFilmeVonAZ',
-		'PluginMovieKinoDe',
-		'PluginMovieOFDb',
-		'PluginMovieZelluloid',
-	]
+    test_plugins = [
+        'PluginMovieFilmeVonAZ',
+        'PluginMovieKinoDe',
+        'PluginMovieOFDb',
+        'PluginMovieZelluloid',
+    ]
 
-	#
-	# simulates the search for a movie title and compares
-	# the count of results with the expected count
-	#
-	def test_search(self, plugin, title, cnt):
-		plugin.url = plugin.translated_url_search
-		plugin.title = gutils.remove_accents(title, 'utf-8')
-		plugin.search(None)
-		plugin.get_searches()
-		if not len(plugin.ids) - 1 == cnt:	# first entry is always '' (???)
-			print &quot;Title: %s - expected: %d - found: %d&quot; % (title, cnt, len(plugin.ids) - 1)
-			return False
-		return True
+    #
+    # simulates the search for a movie title and compares
+    # the count of results with the expected count
+    #
+    def test_search(self, plugin, title, cnt):
+        plugin.url = plugin.translated_url_search
+        plugin.title = gutils.remove_accents(title, 'utf-8')
+        plugin.search(None)
+        plugin.get_searches()
+        if not len(plugin.ids) - 1 == cnt:    # first entry is always '' (???)
+            print &quot;Title: %s - expected: %d - found: %d&quot; % (title, cnt, len(plugin.ids) - 1)
+            return False
+        return True
 
-	#
-	# check every configured movie title
-	#
-	def do_test_searchplugin(self, plugin_name, domsgbox=True):
-		result = True
-		
-		plugin = __import__(plugin_name)
-		try:
-			pluginTestConfig = plugin.SearchPluginTest()
-		except:
-			print &quot;Warning: SearchPlugin test could not be executed for %s because of missing configuration class SearchPluginTest.&quot; % plugin_name
-			pluginTestConfig = None
-		
-		if not pluginTestConfig == None:
-			for i in pluginTestConfig.test_configuration:
-				searchPlugin = plugin.SearchPlugin()
-				if not self.test_search(searchPlugin, i, pluginTestConfig.test_configuration[i]):
-					result = False
-		
-		if domsgbox:
-			if not result:
-				gutils.error(self, 'SearchPluginTest %s: Test NOT successful !' % plugin_name)
-			else:
-				gutils.info(self, 'SearchPluginTest %s: Test successful !' % plugin_name)
-		
-		return result
+    #
+    # check every configured movie title
+    #
+    def do_test_searchplugin(self, plugin_name, domsgbox=True):
+        result = True
+        
+        plugin = __import__(plugin_name)
+        try:
+            pluginTestConfig = plugin.SearchPluginTest()
+        except:
+            print &quot;Warning: SearchPlugin test could not be executed for %s because of missing configuration class SearchPluginTest.&quot; % plugin_name
+            pluginTestConfig = None
+        
+        if not pluginTestConfig == None:
+            for i in pluginTestConfig.test_configuration:
+                searchPlugin = plugin.SearchPlugin()
+                if not self.test_search(searchPlugin, i, pluginTestConfig.test_configuration[i]):
+                    result = False
+        
+        if domsgbox:
+            if not result:
+                gutils.error(self, 'SearchPluginTest %s: Test NOT successful !' % plugin_name)
+            else:
+                gutils.info(self, 'SearchPluginTest %s: Test successful !' % plugin_name)
+        
+        return result
 
-	#
-	# simulates the resolving of movie data for configured movies and
-	# compares the results with the expected once
-	#
-	def test_one_movie(self, movieplugin, results_expected):
-		result = True
-		self.movie = movieplugin
-		self.movie.parent_window = None
-		self.movie.locations = self.locations
+    #
+    # simulates the resolving of movie data for configured movies and
+    # compares the results with the expected once
+    #
+    def test_one_movie(self, movieplugin, results_expected):
+        result = True
+        self.movie = movieplugin
+        self.movie.parent_window = None
+        self.movie.locations = self.locations
 
-		fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
-				'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
-				'notes', 'runtime', 'image', 'rating']
+        fields_to_fetch = ['o_title', 'title', 'director', 'plot', 'cast', 'country', 'genre',
+                'classification', 'studio', 'o_site', 'site', 'trailer', 'year',
+                'notes', 'runtime', 'image', 'rating']
 
-		self.movie.fields_to_fetch = fields_to_fetch
-	
-		self.movie.open_page(None)
-		self.movie.parse_movie()
+        self.movie.fields_to_fetch = fields_to_fetch
+    
+        self.movie.open_page(None)
+        self.movie.parse_movie()
 
-		results = {}
-		if 'year' in fields_to_fetch:
-			results['year'] = self.movie.year
-			fields_to_fetch.pop(fields_to_fetch.index('year'))
-		if 'runtime' in fields_to_fetch:
-			results['runtime'] = self.movie.runtime
-			fields_to_fetch.pop(fields_to_fetch.index('runtime'))
-		if 'cast' in fields_to_fetch:
-			results['cast'] = gutils.convert_entities(self.movie.cast)
-			fields_to_fetch.pop(fields_to_fetch.index('cast'))
-		if 'plot' in fields_to_fetch:
-			results['plot'] = gutils.convert_entities(self.movie.plot)
-			fields_to_fetch.pop(fields_to_fetch.index('plot'))
-		if 'notes' in fields_to_fetch:
-			results['notes'] = gutils.convert_entities(self.movie.notes)
-			fields_to_fetch.pop(fields_to_fetch.index('notes'))
-		if 'rating' in fields_to_fetch:
-			if self.movie.rating:
-				results['rating'] = float(self.movie.rating)
-			fields_to_fetch.pop(fields_to_fetch.index('rating'))
-		# poster
-		if 'image' in fields_to_fetch:
-			if self.movie.image:
-				results['image'] = self.movie.image
-			fields_to_fetch.pop(fields_to_fetch.index('image'))
-		# other fields
-		for i in fields_to_fetch:
-			results[i] = gutils.convert_entities(self.movie[i])
-			
-		# check the fields
-		for i in results_expected:
-			i_val = results_expected[i]
-			if isinstance(i_val, bool):
-				if i_val:
-					if not results.has_key(i) or len(results[i]) &lt; 1:
-						print &quot;Test error: %s: Value expected but nothing returned.\nKey: %s&quot; % (movieplugin.movie_id, i)
-						result = False
-				else:
-					if results.has_key(i) and len(results[i]) &gt; 0:
-						print &quot;Test error: %s: No value expected but something returned.\nKey: %s\nValue: %s&quot; % (movieplugin.movie_id, i, results[i])
-						result = False
-			else:
-				if not results.has_key(i):
-					print &quot;Test error: %s: Value expected but nothing returned.\nKey: %s&quot; % (movieplugin.movie_id, i)
-					result = False
-				else:
-					if not results[i] == i_val:
-						print &quot;Test error: %s: Wrong value returned.\nKey: %s\nValue expected: %s\nValue returned: %s&quot; % (movieplugin.movie_id, i, i_val, results[i])
-						result = False
-		return result
-	
-	#
-	# check every configured movie
-	#
-	def do_test_plugin(self, plugin_name, domsgbox=True):
-		result = True
-		
-		plugin = __import__(plugin_name)
-		try:
-			pluginTestConfig = plugin.PluginTest()
-		except:
-			print &quot;Warning: Plugin test could not be executed for %s because of missing configuration class PluginTest.&quot; % plugin_name
-			pluginTestConfig = None
-		
-		if not pluginTestConfig == None:
-			for i in pluginTestConfig.test_configuration:
-				moviePlugin = plugin.Plugin(i)
-				if not self.test_one_movie(moviePlugin, pluginTestConfig.test_configuration[i]):
-					result = False
-		
-		if domsgbox:
-			if not result:
-				gutils.error(self, 'PluginTest %s: Test NOT successful !' % plugin_name)
-			else:
-				gutils.info(self, 'PluginTest %s: Test successful !' % plugin_name)
-		
-		return result
+        results = {}
+        if 'year' in fields_to_fetch:
+            results['year'] = self.movie.year
+            fields_to_fetch.pop(fields_to_fetch.index('year'))
+        if 'runtime' in fields_to_fetch:
+            results['runtime'] = self.movie.runtime
+            fields_to_fetch.pop(fields_to_fetch.index('runtime'))
+        if 'cast' in fields_to_fetch:
+            results['cast'] = gutils.convert_entities(self.movie.cast)
+            fields_to_fetch.pop(fields_to_fetch.index('cast'))
+        if 'plot' in fields_to_fetch:
+            results['plot'] = gutils.convert_entities(self.movie.plot)
+            fields_to_fetch.pop(fields_to_fetch.index('plot'))
+        if 'notes' in fields_to_fetch:
+            results['notes'] = gutils.convert_entities(self.movie.notes)
+            fields_to_fetch.pop(fields_to_fetch.index('notes'))
+        if 'rating' in fields_to_fetch:
+            if self.movie.rating:
+                results['rating'] = float(self.movie.rating)
+            fields_to_fetch.pop(fields_to_fetch.index('rating'))
+        # poster
+        if 'image' in fields_to_fetch:
+            if self.movie.image:
+                results['image'] = self.movie.image
+            fields_to_fetch.pop(fields_to_fetch.index('image'))
+        # other fields
+        for i in fields_to_fetch:
+            results[i] = gutils.convert_entities(self.movie[i])
+            
+        # check the fields
+        for i in results_expected:
+            i_val = results_expected[i]
+            if isinstance(i_val, bool):
+                if i_val:
+                    if not results.has_key(i) or len(results[i]) &lt; 1:
+                        print &quot;Test error: %s: Value expected but nothing returned.\nKey: %s&quot; % (movieplugin.movie_id, i)
+                        result = False
+                else:
+                    if results.has_key(i) and len(results[i]) &gt; 0:
+                        print &quot;Test error: %s: No value expected but something returned.\nKey: %s\nValue: %s&quot; % (movieplugin.movie_id, i, results[i])
+                        result = False
+            else:
+                if not results.has_key(i):
+                    print &quot;Test error: %s: Value expected but nothing returned.\nKey: %s&quot; % (movieplugin.movie_id, i)
+                    result = False
+                else:
+                    if not results[i] == i_val:
+                        print &quot;Test error: %s: Wrong value returned.\nKey: %s\nValue expected: %s\nValue returned: %s&quot; % (movieplugin.movie_id, i, i_val, results[i])
+                        result = False
+        return result
+    
+    #
+    # check every configured movie
+    #
+    def do_test_plugin(self, plugin_name, domsgbox=True):
+        result = True
+        
+        plugin = __import__(plugin_name)
+        try:
+            pluginTestConfig = plugin.PluginTest()
+        except:
+            print &quot;Warning: Plugin test could not be executed for %s because of missing configuration class PluginTest.&quot; % plugin_name
+            pluginTestConfig = None
+        
+        if not pluginTestConfig == None:
+            for i in pluginTestConfig.test_configuration:
+                moviePlugin = plugin.Plugin(i)
+                if not self.test_one_movie(moviePlugin, pluginTestConfig.test_configuration[i]):
+                    result = False
+        
+        if domsgbox:
+            if not result:
+                gutils.error(self, 'PluginTest %s: Test NOT successful !' % plugin_name)
+            else:
+                gutils.info(self, 'PluginTest %s: Test successful !' % plugin_name)
+        
+        return result
 
-	#
-	# main method
-	# iterates through all plugins which should be auto-tested
-	# and executes the Plugin and SearchPlugin test methods
-	#
-	def do_test(self, domsgbox=True):
-		global debug
-		debug = self.debug = gdebug.GriffithDebug()
-		self._tmp_home = None
-		initialize.locations(self)
-		search_successful = ''
-		search_unsuccessful = ''
-		get_successful = ''
-		get_unsuccessful = ''
-		# test all plugins ?
-		test_all = True
-		dialog = gtk.MessageDialog(None,
-			gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
-			gtk.MESSAGE_QUESTION, gtk.BUTTONS_NONE, 'Test all plugins ?')
-		dialog.add_buttons(gtk.STOCK_YES, gtk.RESPONSE_YES,
-			gtk.STOCK_NO, gtk.RESPONSE_NO)
-		dialog.set_default_response(gtk.RESPONSE_NO)
-		dialog.set_skip_taskbar_hint(False)
-		response = dialog.run()
-		dialog.destroy()
-		if not response == gtk.RESPONSE_YES:
-			test_all = False
-		# iterate through all testable plugins
-		for i in self.test_plugins:
-			if domsgbox and test_all == False:
-				# ask for test of that specific plugin
-				dialog = gtk.MessageDialog(None,
-					gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
-					gtk.MESSAGE_QUESTION, gtk.BUTTONS_NONE, 'Test plugin %s ?' %i)
-				dialog.add_buttons(gtk.STOCK_YES, gtk.RESPONSE_YES,
-					gtk.STOCK_NO, gtk.RESPONSE_NO)
-				dialog.set_default_response(gtk.RESPONSE_NO)
-				dialog.set_skip_taskbar_hint(False)
-				response = dialog.run()
-				dialog.destroy()
-				if not response == gtk.RESPONSE_YES:
-					continue
-			plugin = __import__(i)
-			# search test
-			if self.do_test_searchplugin(i, False):
-				search_successful = search_successful + i + ', '
-			else:
-				search_unsuccessful = search_unsuccessful + i + ', '
-			# movie test
-			if self.do_test_plugin(i, False):
-				get_successful = get_successful + i + ', '
-			else:
-				get_unsuccessful = get_unsuccessful + i + ', '
-		if domsgbox:
-			gutils.info(self, 'SearchPluginTests\n  Success: %s\n  Failed: %s\n\nPluginTests\n  Success: %s\n  Failed: %s' % (search_successful, search_unsuccessful, get_successful, get_unsuccessful))
+    #
+    # main method
+    # iterates through all plugins which should be auto-tested
+    # and executes the Plugin and SearchPlugin test methods
+    #
+    def do_test(self, domsgbox=True):
+        global debug
+        debug = self.debug = gdebug.GriffithDebug()
+        self._tmp_home = None
+        initialize.locations(self)
+        search_successful = ''
+        search_unsuccessful = ''
+        get_successful = ''
+        get_unsuccessful = ''
+        # test all plugins ?
+        test_all = True
+        dialog = gtk.MessageDialog(None,
+            gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
+            gtk.MESSAGE_QUESTION, gtk.BUTTONS_NONE, 'Test all plugins ?')
+        dialog.add_buttons(gtk.STOCK_YES, gtk.RESPONSE_YES,
+            gtk.STOCK_NO, gtk.RESPONSE_NO)
+        dialog.set_default_response(gtk.RESPONSE_NO)
+        dialog.set_skip_taskbar_hint(False)
+        response = dialog.run()
+        dialog.destroy()
+        if not response == gtk.RESPONSE_YES:
+            test_all = False
+        # iterate through all testable plugins
+        for i in self.test_plugins:
+            if domsgbox and test_all == False:
+                # ask for test of that specific plugin
+                dialog = gtk.MessageDialog(None,
+                    gtk.DIALOG_MODAL | gtk.DIALOG_DESTROY_WITH_PARENT,
+                    gtk.MESSAGE_QUESTION, gtk.BUTTONS_NONE, 'Test plugin %s ?' %i)
+                dialog.add_buttons(gtk.STOCK_YES, gtk.RESPONSE_YES,
+                    gtk.STOCK_NO, gtk.RESPONSE_NO)
+                dialog.set_default_response(gtk.RESPONSE_NO)
+                dialog.set_skip_taskbar_hint(False)
+                response = dialog.run()
+                dialog.destroy()
+                if not response == gtk.RESPONSE_YES:
+                    continue
+            plugin = __import__(i)
+            # search test
+            if self.do_test_searchplugin(i, False):
+                search_successful = search_successful + i + ', '
+            else:
+                search_unsuccessful = search_unsuccessful + i + ', '
+            # movie test
+            if self.do_test_plugin(i, False):
+                get_successful = get_successful + i + ', '
+            else:
+                get_unsuccessful = get_unsuccessful + i + ', '
+        if domsgbox:
+            gutils.info(self, 'SearchPluginTests\n  Success: %s\n  Failed: %s\n\nPluginTests\n  Success: %s\n  Failed: %s' % (search_successful, search_unsuccessful, get_successful, get_unsuccessful))
 
 #
 # Start the tests

Modified: trunk/lib/update.py
===================================================================
--- trunk/lib/update.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/update.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -24,35 +24,36 @@
 from gettext import gettext as _
 import gutils
 import os
+import db
 
 def update_volume_combo_ids(self):
-	self.volume_combo_ids = {}
-	self.volume_combo_ids[0] = 0
-	i = 1
-	for volume in self.db.Volume.query.all():
-		self.volume_combo_ids[i] = volume.volume_id
-		i += 1
+    self.volume_combo_ids = {}
+    self.volume_combo_ids[0] = 0
+    i = 1
+    for volume in self.db.session.query(db.Volume).all():
+        self.volume_combo_ids[i] = volume.volume_id
+        i += 1
 
 def update_collection_combo_ids(self):
-	self.collection_combo_ids = {}
-	self.collection_combo_ids[0] = 0
-	i = 1
-	for collection in self.db.Collection.query.all():
-		self.collection_combo_ids[i] = collection.collection_id
-		i += 1
+    self.collection_combo_ids = {}
+    self.collection_combo_ids[0] = 0
+    i = 1
+    for collection in self.db.session.query(db.Collection).all():
+        self.collection_combo_ids[i] = collection.collection_id
+        i += 1
 
 def update_loanedto_combo_ids(self):
-	self.loanedto_combo_ids = {}
-	self.loanedto_combo_ids[0] = 0
-	i = 1
-	for person in self.db.Person.query.order_by('name').all():
-		self.loanedto_combo_ids[i] = person.person_id
-		i += 1
+    self.loanedto_combo_ids = {}
+    self.loanedto_combo_ids[0] = 0
+    i = 1
+    for person in self.db.session.query(db.Person).order_by('name').all():
+        self.loanedto_combo_ids[i] = person.person_id
+        i += 1
 
 def update_bytag_combo_ids(self):
-	self.bytag_combo_ids = {}
-	self.bytag_combo_ids[0] = 0
-	i = 1
-	for tag in self.db.Tag.query.order_by('name').all():
-		self.bytag_combo_ids[i] = tag.tag_id
-		i += 1
+    self.bytag_combo_ids = {}
+    self.bytag_combo_ids[0] = 0
+    i = 1
+    for tag in self.db.session.query(db.Tag).order_by('name').all():
+        self.bytag_combo_ids[i] = tag.tag_id
+        i += 1

Modified: trunk/lib/view.py
===================================================================
--- trunk/lib/view.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/view.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -24,27 +24,27 @@
 from gettext import gettext as _
 
 def filter_not_seen(self):
-	self.populate_treeview()
-	self.update_statusbar(_(&quot;Filter activated. Showing only not seen movies.&quot;))
+    self.populate_treeview()
+    self.update_statusbar(_(&quot;Filter activated. Showing only not seen movies.&quot;))
 
 def filter_loaned(self):
-	self.populate_treeview()
-	self.update_statusbar(_(&quot;Filter activated. Showing only loaned movies.&quot;))
+    self.populate_treeview()
+    self.update_statusbar(_(&quot;Filter activated. Showing only loaned movies.&quot;))
 
 def filter_all(self):
-	self.populate_treeview()
+    self.populate_treeview()
 
 def filter_by_volume(self, volume_id):
-	from quick_filter import clear_filter
-	clear_filter(self)
-	self.populate_treeview(where={'volume_id':volume_id})
-	volume_name = self.db.Volume.query.filter_by(volume_id=volume_id).one().name
-	self.update_statusbar(_(&quot;Filter activated. Showing only movies from volume: %s&quot;)%volume_name)
+    from quick_filter import clear_filter
+    clear_filter(self)
+    self.populate_treeview(where={'volume_id':volume_id})
+    volume_name = self.db.Volume.query.filter_by(volume_id=volume_id).one().name
+    self.update_statusbar(_(&quot;Filter activated. Showing only movies from volume: %s&quot;)%volume_name)
 
 def filter_by_collection(self, collection_id):
-	from quick_filter import clear_filter
-	clear_filter(self)
-	self.populate_treeview(where={'collection_id':collection_id})
-	collection_name = self.db.Collection.query.filter_by(collection_id=collection_id).one().name
-	self.update_statusbar(_(&quot;Filter activated. Showing only movies from collection: %s&quot;)%collection_name)
+    from quick_filter import clear_filter
+    clear_filter(self)
+    self.populate_treeview(where={'collection_id':collection_id})
+    collection_name = self.db.Collection.query.filter_by(collection_id=collection_id).one().name
+    self.update_statusbar(_(&quot;Filter activated. Showing only movies from collection: %s&quot;)%collection_name)
 

Modified: trunk/lib/widgets.py
===================================================================
--- trunk/lib/widgets.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/lib/widgets.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -26,483 +26,483 @@
 import sys
 
 def define_widgets(self, gladefile):
-	get = lambda x: gladefile.get_widget(x)
-	self.widgets = {}
-	
-	self.widgets['window'] = get('main_window')
-	self.widgets['window'].connect('key_press_event', self.on_key_press_event)
-	self.widgets['treeview'] = get('main_treeview')
-	self.widgets['treeview'].connect('button_press_event', self.on_maintree_button_press_event)
-	self.widgets['statusbar'] = get('statusbar')
-	self.widgets['progressbar']    = get('w_progress')	# get from web
-	#buttons
-	self.widgets['new_db']      = get('new_bt')
-	self.widgets['toolbar'] = get('toolbar1')
-	
+    get = lambda x: gladefile.get_widget(x)
+    self.widgets = {}
+    
+    self.widgets['window'] = get('main_window')
+    self.widgets['window'].connect('key_press_event', self.on_key_press_event)
+    self.widgets['treeview'] = get('main_treeview')
+    self.widgets['treeview'].connect('button_press_event', self.on_maintree_button_press_event)
+    self.widgets['statusbar'] = get('statusbar')
+    self.widgets['progressbar']    = get('w_progress')    # get from web
+    #buttons
+    self.widgets['new_db']      = get('new_bt')
+    self.widgets['toolbar'] = get('toolbar1')
+    
 
-	self.widgets['movie'] = {#{{{
-		'cast':			get('m_cast'),
-		'classification':	get('m_classification'),
-		'collection':		get('m_collection'),
-		'color':		get('m_color'),
-		'condition':		get('m_condition'),
-		'country':		get('m_country'),
-		'director':		get('m_director'),
-		'genre':		get('m_genre'),
-		'imdb':			get('m_imdb'),
-		'layers':		get('m_layers'),
-		'loan_info':		get('loan_information'),
-		'medium':		get('m_medium'),
-		'notes':		get('m_notes'),
-		'number':		get('m_number'),
-		'o_title':		get('m_o_title'),
-		'picture':		get('m_picture_image'),
-		'picture_button':	get('m_picture'),
-		'plot':			get('m_plot'),
-		'region':		get('m_region'),
-		'runtime':		get('m_runtime'),
-		'seen_icon':		get('m_seen_icon'),
-		'site':			get('m_site'),
-		'studio':		get('m_studio'),
-		'tags':			get('m_tags'),
-		'title':		get('m_title'),
-		'trailer':		get('m_trailer'),
-		'vcodec':		get('m_vcodec'),
-		'volume':		get('m_volume'),
-		'year':			get('m_year'),
-		'audio_vbox':		get('m_audio_vbox'),
-		'subtitle_vbox':	get('m_subtitle_vbox'),
-		'show_collection_button':get('m_show_collection_button'),
-		'show_volume_button':	get('m_show_volume_button'),
-		'go_o_site_button':	get('go_o_site'),
-		'go_site_button':	get('go_site'),
-		'go_trailer_button':	get('go_trailer'),
-		'return_button':	get('return_button'),
-		'loan_button':		get('loan_button'),
-		'loan_history':		get('loan_history'),
-		'loan_to':		get('loan_to'),
-		'email_reminder_button':get('b_email_reminder'),
-		'image_rating':		get('m_image_rating'),
-	}
-	get('m_seen_icon_eventbox').connect('button_press_event', self.on_m_seen_icon_button_press_event)
-	#}}}
+    self.widgets['movie'] = {#{{{
+        'cast':            get('m_cast'),
+        'classification':    get('m_classification'),
+        'collection':        get('m_collection'),
+        'color':        get('m_color'),
+        'condition':        get('m_condition'),
+        'country':        get('m_country'),
+        'director':        get('m_director'),
+        'genre':        get('m_genre'),
+        'imdb':            get('m_imdb'),
+        'layers':        get('m_layers'),
+        'loan_info':        get('loan_information'),
+        'medium':        get('m_medium'),
+        'notes':        get('m_notes'),
+        'number':        get('m_number'),
+        'o_title':        get('m_o_title'),
+        'picture':        get('m_picture_image'),
+        'picture_button':    get('m_picture'),
+        'plot':            get('m_plot'),
+        'region':        get('m_region'),
+        'runtime':        get('m_runtime'),
+        'seen_icon':        get('m_seen_icon'),
+        'site':            get('m_site'),
+        'studio':        get('m_studio'),
+        'tags':            get('m_tags'),
+        'title':        get('m_title'),
+        'trailer':        get('m_trailer'),
+        'vcodec':        get('m_vcodec'),
+        'volume':        get('m_volume'),
+        'year':            get('m_year'),
+        'audio_vbox':        get('m_audio_vbox'),
+        'subtitle_vbox':    get('m_subtitle_vbox'),
+        'show_collection_button':get('m_show_collection_button'),
+        'show_volume_button':    get('m_show_volume_button'),
+        'go_o_site_button':    get('go_o_site'),
+        'go_site_button':    get('go_site'),
+        'go_trailer_button':    get('go_trailer'),
+        'return_button':    get('return_button'),
+        'loan_button':        get('loan_button'),
+        'loan_history':        get('loan_history'),
+        'loan_to':        get('loan_to'),
+        'email_reminder_button':get('b_email_reminder'),
+        'image_rating':        get('m_image_rating'),
+    }
+    get('m_seen_icon_eventbox').connect('button_press_event', self.on_m_seen_icon_button_press_event)
+    #}}}
 
-	self.widgets['add'] = {#{{{
-		'window':	get('add_movie'),
-		'notebook':	get('notebook_add'),
-		'classification':get('am_classification'),
-		'collection':	get('am_collection_combo'),
-		'color':	get('am_color'),
-		'condition':	get('am_condition'),
-		'country':	get('am_country'),
-		'director':	get('am_director'),
-		'discs':	get('am_discs'),
-		'genre':	get('am_genre'),
-		'site':		get('am_imdb'),
-		'layers':	get('am_layers'),
-		'media':	get('am_media'),
-		'medium_vbox':	get('am_medium_vbox'),
-		'number':	get('am_number'),
-		'notes':	get('am_obs'),
-		'o_title':	get('am_original_title'),
-		'picture':	get('am_image'),
-		'image':	get('am_hide_image_name'),
-		'plot':		get('am_plot'),
-		'plugin_desc':	get('am_plugin_desc'),
-		'plugin_image':	get('am_plugin_image'),
-		'region':	get('am_region'),
-		'runtime':	get('am_runtime'),
-		'seen':		get('am_seen'),
-		'o_site':	get('am_site'),
-		'source':	get('am_source'),
-		'studio':	get('am_studio'),
-		'tag_vbox':	get('am_tag_vbox'),
-		'title':	get('am_title'),
-		'trailer':	get('am_trailer'),
-		'vcodec':	get('am_vcodec'),
-		'volume':	get('am_volume_combo'),
-		'cast':		get('am_with'),
-		'year':		get('am_year'),
-		'image_rating': get('image_add_rating'),
-		'rating_slider':get('rating_scale_add'),
-		'lang_menu':	get('lang_menu'),
-		'lang_treeview':get('lang_treeview'),
-		'b_get_from_web':get('get_from_web'),
-		'c_web_source':	get('combo_source'), # c_web_source
-		'delete_poster': get('delete_poster'),
-		'add_button':	get('am_add_button'),
-		'add_close_button':get('am_add_close_button'),
-		'clear_button':	get('am_clear_button'),
-		'save_button':	get('am_save_button'),
-		'cb_only_empty':get('am_cb_only_empty'),
-	}
-	self.widgets['add']['window'].connect('delete_event', self.on_delete_event_am)
-	self.widgets['add']['lang_treeview'].connect('button_press_event', self.on_lang_treeview_button_press_event)
-	self.widgets['add']['o_title'].connect('activate', self.on_enter)
-	self.widgets['add']['title'].connect('activate', self.on_enter)
-	self.widgets['add']['window'].set_transient_for(self.widgets['window'])
-	#}}}
+    self.widgets['add'] = {#{{{
+        'window':    get('add_movie'),
+        'notebook':    get('notebook_add'),
+        'classification':get('am_classification'),
+        'collection':    get('am_collection_combo'),
+        'color':    get('am_color'),
+        'condition':    get('am_condition'),
+        'country':    get('am_country'),
+        'director':    get('am_director'),
+        'discs':    get('am_discs'),
+        'genre':    get('am_genre'),
+        'site':        get('am_imdb'),
+        'layers':    get('am_layers'),
+        'media':    get('am_media'),
+        'medium_vbox':    get('am_medium_vbox'),
+        'number':    get('am_number'),
+        'notes':    get('am_obs'),
+        'o_title':    get('am_original_title'),
+        'picture':    get('am_image'),
+        'image':    get('am_hide_image_name'),
+        'plot':        get('am_plot'),
+        'plugin_desc':    get('am_plugin_desc'),
+        'plugin_image':    get('am_plugin_image'),
+        'region':    get('am_region'),
+        'runtime':    get('am_runtime'),
+        'seen':        get('am_seen'),
+        'o_site':    get('am_site'),
+        'source':    get('am_source'),
+        'studio':    get('am_studio'),
+        'tag_vbox':    get('am_tag_vbox'),
+        'title':    get('am_title'),
+        'trailer':    get('am_trailer'),
+        'vcodec':    get('am_vcodec'),
+        'volume':    get('am_volume_combo'),
+        'cast':        get('am_with'),
+        'year':        get('am_year'),
+        'image_rating': get('image_add_rating'),
+        'rating_slider':get('rating_scale_add'),
+        'lang_menu':    get('lang_menu'),
+        'lang_treeview':get('lang_treeview'),
+        'b_get_from_web':get('get_from_web'),
+        'c_web_source':    get('combo_source'), # c_web_source
+        'delete_poster': get('delete_poster'),
+        'add_button':    get('am_add_button'),
+        'add_close_button':get('am_add_close_button'),
+        'clear_button':    get('am_clear_button'),
+        'save_button':    get('am_save_button'),
+        'cb_only_empty':get('am_cb_only_empty'),
+    }
+    self.widgets['add']['window'].connect('delete_event', self.on_delete_event_am)
+    self.widgets['add']['lang_treeview'].connect('button_press_event', self.on_lang_treeview_button_press_event)
+    self.widgets['add']['o_title'].connect('activate', self.on_enter)
+    self.widgets['add']['title'].connect('activate', self.on_enter)
+    self.widgets['add']['window'].set_transient_for(self.widgets['window'])
+    #}}}
 
-	self.widgets['preferences'] = {#{{{
-		'window':		get('w_preferences'),
-		'treeview':		get('p_treeview'),
-		'color':		get('p_color'),
-		'condition':		get('p_condition'),
-		'db_details':		get('p_db_details'),
-		'db_host':		get('p_db_host'),
-		'db_name':		get('p_db_name'),
-		'db_passwd':		get('p_db_passwd'),
-		'db_port':		get('p_db_port'),
-		'db_type':		get('p_db_type'),
-		'db_user':		get('p_db_user'),
-		'epdf_reader':		get('pdf_reader_entry'),
-		'font':			get('p_font'),
-		'layers':		get('p_layers'),
-		'media':		get('p_media'),
-		'region':		get('p_region'),
-		's_classification':	get('p_s_classification'),
-		's_country':		get('p_s_country'),
-		's_director':		get('p_s_director'),
-		's_genre':		get('p_s_genre'),
-		's_image':		get('p_s_image'),
-		's_notes':		get('p_s_notes'),
-		's_o_site':		get('p_s_o_site'),
-		's_o_title':		get('p_s_o_title'),
-		's_plot':		get('p_s_plot'),
-		's_rating':		get('p_s_rating'),
-		's_runtime':		get('p_s_runtime'),
-		's_site':		get('p_s_site'),
-		's_studio':		get('p_s_studio'),
-		's_title':		get('p_s_title'),
-		's_trailer':		get('p_s_trailer'),
-		's_cast':		get('p_s_cast'),
-		's_year':		get('p_s_year'),
-		's_limit':		get('p_sp_s_limit'),
-		'vcodec':		get('p_vcodec'),
-		'view_image':		get('view_image'),
-		'view_number':		get('view_number'),
-		'view_o_title':		get('view_otitle'),
-		'view_title':		get('view_title'),
-		'view_director':	get('view_director'),
-		'view_genre':	get('view_genre'),
-		'view_seen':	get('view_seen'),
-		'view_year':	get('view_year'),
-		'view_runtime':	get('view_runtime'),
-		'view_rating':	get('view_rating'),
-		'rating_image':		get('rating_image'),
-		'spellchecker':		get('spellchecker_pref'),
-		'spell_notes':		get('spell_notes'),
-		'spell_plot':		get('spell_plot'),
-		'spell_lang':		get('spell_lang'),
-		'vbox_spellchecker':	get('vbox_spellchecker'),
-		'default_plugin':	get('default_plugin'),
-		'mail_smtp_server':	get('mail_smtp_server'),
-		'mail_use_auth':	get('mail_use_auth'),
-		'mail_username':	get('mail_username'),
-		'mail_password':	get('mail_password'),
-		'mail_email':		get('mail_email'),
-		'mail_smtp_port':		get('mail_smtp_port'),
-		'mail_use_tls':		get('mail_use_tls'),
-		'lang_name':		get('lang_name_combo'),
-		'tag_name':		get('tag_name_combo'),
-		'acodec_name':		get('acodec_name_combo'),
-		'achannel_name':	get('achannel_name_combo'),
-		'subformat_name':	get('subformat_name_combo'),
-		'medium_name':		get('medium_name_combo'),
-		'vcodec_name':		get('vcodec_name_combo'),
-		'sortby':		get('p_sortby'),
-		'sortby_reverse':	get('p_sortby_reverse'),
-		'amazon_locale':	get('cb_amazon_locale'),
-	}
-	self.widgets['preferences']['treeview'].connect('button_press_event', self.on_p_tree_button_press_event)
-	self.widgets['preferences']['window'].connect('delete_event', self.on_delete_event_p)
-	self.widgets['preferences']['spellchecker'].connect('toggled', self.on_cb_spellchecker_pref_toggled)
-	self.widgets['preferences']['window'].set_transient_for(self.widgets['window'])
-	#}}}
+    self.widgets['preferences'] = {#{{{
+        'window':        get('w_preferences'),
+        'treeview':        get('p_treeview'),
+        'color':        get('p_color'),
+        'condition':        get('p_condition'),
+        'db_details':        get('p_db_details'),
+        'db_host':        get('p_db_host'),
+        'db_name':        get('p_db_name'),
+        'db_passwd':        get('p_db_passwd'),
+        'db_port':        get('p_db_port'),
+        'db_type':        get('p_db_type'),
+        'db_user':        get('p_db_user'),
+        'epdf_reader':        get('pdf_reader_entry'),
+        'font':            get('p_font'),
+        'layers':        get('p_layers'),
+        'media':        get('p_media'),
+        'region':        get('p_region'),
+        's_classification':    get('p_s_classification'),
+        's_country':        get('p_s_country'),
+        's_director':        get('p_s_director'),
+        's_genre':        get('p_s_genre'),
+        's_image':        get('p_s_image'),
+        's_notes':        get('p_s_notes'),
+        's_o_site':        get('p_s_o_site'),
+        's_o_title':        get('p_s_o_title'),
+        's_plot':        get('p_s_plot'),
+        's_rating':        get('p_s_rating'),
+        's_runtime':        get('p_s_runtime'),
+        's_site':        get('p_s_site'),
+        's_studio':        get('p_s_studio'),
+        's_title':        get('p_s_title'),
+        's_trailer':        get('p_s_trailer'),
+        's_cast':        get('p_s_cast'),
+        's_year':        get('p_s_year'),
+        's_limit':        get('p_sp_s_limit'),
+        'vcodec':        get('p_vcodec'),
+        'view_image':        get('view_image'),
+        'view_number':        get('view_number'),
+        'view_o_title':        get('view_otitle'),
+        'view_title':        get('view_title'),
+        'view_director':    get('view_director'),
+        'view_genre':    get('view_genre'),
+        'view_seen':    get('view_seen'),
+        'view_year':    get('view_year'),
+        'view_runtime':    get('view_runtime'),
+        'view_rating':    get('view_rating'),
+        'rating_image':        get('rating_image'),
+        'spellchecker':        get('spellchecker_pref'),
+        'spell_notes':        get('spell_notes'),
+        'spell_plot':        get('spell_plot'),
+        'spell_lang':        get('spell_lang'),
+        'vbox_spellchecker':    get('vbox_spellchecker'),
+        'default_plugin':    get('default_plugin'),
+        'mail_smtp_server':    get('mail_smtp_server'),
+        'mail_use_auth':    get('mail_use_auth'),
+        'mail_username':    get('mail_username'),
+        'mail_password':    get('mail_password'),
+        'mail_email':        get('mail_email'),
+        'mail_smtp_port':        get('mail_smtp_port'),
+        'mail_use_tls':        get('mail_use_tls'),
+        'lang_name':        get('lang_name_combo'),
+        'tag_name':        get('tag_name_combo'),
+        'acodec_name':        get('acodec_name_combo'),
+        'achannel_name':    get('achannel_name_combo'),
+        'subformat_name':    get('subformat_name_combo'),
+        'medium_name':        get('medium_name_combo'),
+        'vcodec_name':        get('vcodec_name_combo'),
+        'sortby':        get('p_sortby'),
+        'sortby_reverse':    get('p_sortby_reverse'),
+        'amazon_locale':    get('cb_amazon_locale'),
+    }
+    self.widgets['preferences']['treeview'].connect('button_press_event', self.on_p_tree_button_press_event)
+    self.widgets['preferences']['window'].connect('delete_event', self.on_delete_event_p)
+    self.widgets['preferences']['spellchecker'].connect('toggled', self.on_cb_spellchecker_pref_toggled)
+    self.widgets['preferences']['window'].set_transient_for(self.widgets['window'])
+    #}}}
 
-	self.widgets['results'] = {#{{{
-		'window':	get('results'),
-		'treeview':	get('results_treeview'),
-		'select':	get('results_select'),
-		'cancel':	get('results_cancel'),
-	}
-	self.widgets['results']['window'].connect('delete_event', self.on_delete_event_r)
-	self.widgets['results']['window'].set_transient_for(self.widgets['add']['window'])
-	# default results window signals:
-	self.results_signal = self.widgets['results']['select'].connect('clicked', self.populate_dialog_with_results)
-	self.results_double_click = self.widgets['results']['treeview'].connect('button_press_event', self.on_results_button_press_event)
-	#}}}
+    self.widgets['results'] = {#{{{
+        'window':    get('results'),
+        'treeview':    get('results_treeview'),
+        'select':    get('results_select'),
+        'cancel':    get('results_cancel'),
+    }
+    self.widgets['results']['window'].connect('delete_event', self.on_delete_event_r)
+    self.widgets['results']['window'].set_transient_for(self.widgets['add']['window'])
+    # default results window signals:
+    self.results_signal = self.widgets['results']['select'].connect('clicked', self.populate_dialog_with_results)
+    self.results_double_click = self.widgets['results']['treeview'].connect('button_press_event', self.on_results_button_press_event)
+    #}}}
 
-	self.widgets['print_cover'] = {#{{{
-		# TODO: merge these two windows
-		'window_simple':	get('w_print_cover_simple'),
-		'window_image':		get('w_print_cover_image'),
-		'cs_size':		get('cover_simple_size'),
-		'cs_include_movie_number':get('cover_simple_include_movie_number'),
-		'cs_include_poster':	get('cover_simple_include_poster'),
-		'ci_size':		get('cover_image_size'),
-		'ci_number':		get('cover_image_number'),
-	}
-	self.widgets['print_cover']['window_simple'].connect('delete_event', self.on_delete_event_pcs)
-	self.widgets['print_cover']['window_image'].connect('delete_event', self.on_delete_event_pci)
-	self.widgets['print_cover']['window_simple'].set_transient_for(self.widgets['window'])
-	self.widgets['print_cover']['window_image'].set_transient_for(self.widgets['window'])
-	#}}}
-	
-	self.widgets['people'] = {#{{{
-		'window':	get('w_people'),
-		'treeview':	get('p_treeview'),
-	}
-	self.widgets['people']['window'].connect('delete_event', self.on_delete_event_wp)
-	self.widgets['people']['window'].set_transient_for(self.widgets['window'])
-	#}}}
-	
-	self.widgets['person'] = {#{{{
-		# TODO: merge these two windows
-		'window':	get('w_add_person'),
-		'e_window':	get('w_edit_person'),
-		'name':		get('ap_name'),
-		'email':	get('ap_email'),
-		'phone':	get('ap_phone'),
-		'e_name':	get('ep_name'),
-		'e_email':	get('ep_email'),
-		'e_phone':	get('ep_phone'),
-		'e_id':		get('ep_id'),
-	}
-	self.widgets['person']['window'].connect('delete_event', self.on_delete_event_ap)
-	self.widgets['person']['e_window'].connect('delete_event', self.on_delete_event_ep)
-	self.widgets['person']['window'].set_transient_for(self.widgets['people']['window'])
-	self.widgets['person']['e_window'].set_transient_for(self.widgets['people']['window'])
-	#}}}
+    self.widgets['print_cover'] = {#{{{
+        # TODO: merge these two windows
+        'window_simple':    get('w_print_cover_simple'),
+        'window_image':        get('w_print_cover_image'),
+        'cs_size':        get('cover_simple_size'),
+        'cs_include_movie_number':get('cover_simple_include_movie_number'),
+        'cs_include_poster':    get('cover_simple_include_poster'),
+        'ci_size':        get('cover_image_size'),
+        'ci_number':        get('cover_image_number'),
+    }
+    self.widgets['print_cover']['window_simple'].connect('delete_event', self.on_delete_event_pcs)
+    self.widgets['print_cover']['window_image'].connect('delete_event', self.on_delete_event_pci)
+    self.widgets['print_cover']['window_simple'].set_transient_for(self.widgets['window'])
+    self.widgets['print_cover']['window_image'].set_transient_for(self.widgets['window'])
+    #}}}
+    
+    self.widgets['people'] = {#{{{
+        'window':    get('w_people'),
+        'treeview':    get('p_treeview'),
+    }
+    self.widgets['people']['window'].connect('delete_event', self.on_delete_event_wp)
+    self.widgets['people']['window'].set_transient_for(self.widgets['window'])
+    #}}}
+    
+    self.widgets['person'] = {#{{{
+        # TODO: merge these two windows
+        'window':    get('w_add_person'),
+        'e_window':    get('w_edit_person'),
+        'name':        get('ap_name'),
+        'email':    get('ap_email'),
+        'phone':    get('ap_phone'),
+        'e_name':    get('ep_name'),
+        'e_email':    get('ep_email'),
+        'e_phone':    get('ep_phone'),
+        'e_id':        get('ep_id'),
+    }
+    self.widgets['person']['window'].connect('delete_event', self.on_delete_event_ap)
+    self.widgets['person']['e_window'].connect('delete_event', self.on_delete_event_ep)
+    self.widgets['person']['window'].set_transient_for(self.widgets['people']['window'])
+    self.widgets['person']['e_window'].set_transient_for(self.widgets['people']['window'])
+    #}}}
 
-	self.widgets['filter'] = {#{{{
-		'text':		get('filter_txt'),
-		'criteria':	get('filter_criteria'),
-		'collection':	get('f_col'),
-		'volume':	get('f_volume'),
-		'loanedto':	get('f_loanedto'),
-		'tag':	get('f_bytag'),
-	}#}}}
-	
-	self.widgets['menu'] = {#{{{
-		'toolbar':	get('menu_toolbar'),
-		'export':	get('export_menu'),
-		'import':	get('import_menu'),
-		'not_seen_movies':	get('seen_movies'),
-		'loaned_movies':get('loaned_movies'),
-		'all_movies':	get('all_movies'),
-		'delete_poster': get('t_delete_poster'),
-		'loan':		get('loan1'),
-		'email':	get('return1'),
-		'return':	get('e-mail_reminder1'),
-	}#}}}
-	
-	self.widgets['popups'] = {#{{{
-		'main':		get('popup'),
-		'loan':		get('popup_loan'),
-		'return':	get('popup_return'),
-		'email':	get('popup_email'),
-	}#}}}
-	
-	self.widgets['w_loan_to']     = get('w_loan_to')
-	self.widgets['w_loan_to'].connect('delete_event', self.on_delete_event_lt)
+    self.widgets['filter'] = {#{{{
+        'text':        get('filter_txt'),
+        'criteria':    get('filter_criteria'),
+        'collection':    get('f_col'),
+        'volume':    get('f_volume'),
+        'loanedto':    get('f_loanedto'),
+        'tag':    get('f_bytag'),
+    }#}}}
+    
+    self.widgets['menu'] = {#{{{
+        'toolbar':    get('menu_toolbar'),
+        'export':    get('export_menu'),
+        'import':    get('import_menu'),
+        'not_seen_movies':    get('seen_movies'),
+        'loaned_movies':get('loaned_movies'),
+        'all_movies':    get('all_movies'),
+        'delete_poster': get('t_delete_poster'),
+        'loan':        get('loan1'),
+        'email':    get('return1'),
+        'return':    get('e-mail_reminder1'),
+    }#}}}
+    
+    self.widgets['popups'] = {#{{{
+        'main':        get('popup'),
+        'loan':        get('popup_loan'),
+        'return':    get('popup_return'),
+        'email':    get('popup_email'),
+    }#}}}
+    
+    self.widgets['w_loan_to']     = get('w_loan_to')
+    self.widgets['w_loan_to'].connect('delete_event', self.on_delete_event_lt)
 
-	self.widgets['poster_window'] = get('poster_window')
-	self.widgets['poster_window'].connect('delete_event', self.on_delete_event_pw)
-	self.widgets['poster_window'].set_transient_for(self.widgets['window'])
-	self.widgets['big_poster']    = get('big_poster')
+    self.widgets['poster_window'] = get('poster_window')
+    self.widgets['poster_window'].connect('delete_event', self.on_delete_event_pw)
+    self.widgets['poster_window'].set_transient_for(self.widgets['window'])
+    self.widgets['big_poster']    = get('big_poster')
 
-	#add some tooltips
-	self.widgets['tooltips'] = gtk.Tooltips()
-	self.widgets['tooltips'].set_tip(self.widgets['preferences']['epdf_reader'], _('Define here the PDF reader you want to use within Griffith. Popular choices are xpdf, gpdf, evince or kpdf. Make sure you have this program installed and working first.'))
-	self.widgets['tooltips'].set_tip(self.widgets['preferences']['spell_lang'], _(&quot;Here you can define the desired language to use while spell checking some fields. Use you locale setting. For example, to use european portuguese spell checking enter 'pt'&quot;))
-	self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_smtp_server'], _(&quot;Use this entry to define the SMTP server you want to use to send e-mails. On *nix systems, 'localhost' should work. Alternatively, you can use your Internet Service Provider's SMTP server address.&quot;))
-	self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_email'], _(&quot;This is the from e-mail address that should be used to all outgoing e-mail. You want to include your own e-mail address here probably.&quot;))
-	self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_smtp_port'], _(&quot;Here you can define the smtp server port to use. If you want to use your gmail account service to send e-mails, try to enter '587' here. Default (and the most common one) is '25'&quot;))
-	self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_use_tls'], _(&quot;If you need TLS support, please check this checkbox. This is needed, for example, when using gmail service to send your reminder e-mails.&quot;))
+    #add some tooltips
+    self.widgets['tooltips'] = gtk.Tooltips()
+    self.widgets['tooltips'].set_tip(self.widgets['preferences']['epdf_reader'], _('Define here the PDF reader you want to use within Griffith. Popular choices are xpdf, gpdf, evince or kpdf. Make sure you have this program installed and working first.'))
+    self.widgets['tooltips'].set_tip(self.widgets['preferences']['spell_lang'], _(&quot;Here you can define the desired language to use while spell checking some fields. Use you locale setting. For example, to use european portuguese spell checking enter 'pt'&quot;))
+    self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_smtp_server'], _(&quot;Use this entry to define the SMTP server you want to use to send e-mails. On *nix systems, 'localhost' should work. Alternatively, you can use your Internet Service Provider's SMTP server address.&quot;))
+    self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_email'], _(&quot;This is the from e-mail address that should be used to all outgoing e-mail. You want to include your own e-mail address here probably.&quot;))
+    self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_smtp_port'], _(&quot;Here you can define the smtp server port to use. If you want to use your gmail account service to send e-mails, try to enter '587' here. Default (and the most common one) is '25'&quot;))
+    self.widgets['tooltips'].set_tip(self.widgets['preferences']['mail_use_tls'], _(&quot;If you need TLS support, please check this checkbox. This is needed, for example, when using gmail service to send your reminder e-mails.&quot;))
 
-	# define handlers for general events
-	gladefile.signal_autoconnect({#{{{
-		'gtk_main_quit'				: self.destroy,
-		'on_window_state'			: self.on_window_state,
-		'on_configure'				: self.on_configure,
-		'on_about1_activate'			: self.about_dialog,
-		'on_quit1_activate'			: self.destroy,
-		'on_toolbar_quit_clicked'		: self.destroy,
-		'on_toolbar_add_clicked'		: self.add_movie,
-		'on_cancel_add_movie_clicked'		: self.hide_add_window,
-		'on_add1_activate'			: self.add_movie,
-		'on_add_movie_clicked'			: self.add_movie_db,
-		'on_add_movie_close_clicked'		: self.add_movie_close_db,
-		'on_delete_movie_clicked'		: self.delete_movie,
-		'on_delete1_movie_activate'		: self.delete_movie,
-		'on_main_treeview_row_activated'	: self.treeview_clicked,
-		'on_row_activated'			: self.treeview_clicked,
-		'on_get_from_web_clicked'		: self.get_from_web,
-		'on_update_button_clicked'		: self.update_movie,
-		'on_import_activate'			: self.on_import_activate,
-		'on_seen_activate'			: self.toggle_seen,
-		# preferences
-		'on_preferences1_activate'		: self.show_preferences,
-		'on_cancel_preferences_clicked'		: self.hide_preferences,
-		'on_save_preferences_clicked'		: self.save_preferences,
-		'on_p_db_type_changed'			: self.on_p_db_type_changed,
-		'on_backup_activate'			: self.backup,
-		'on_restore_activate'			: self.restore,
-		'on_merge_activate'			: self.merge,
-		'on_cover_simple_activate'		: self.print_cover_simple_show,
-		'on_cancel_print_cover_simple_clicked'	: self.print_cover_simple_hide,
-		'on_b_print_cover_simple_clicked'	: self.print_cover_simple_process,
-		'on_add_clear_clicked'			: self.clear_add_dialog,
-		'on_am_save_button_clicked'		: self.update_movie,
-		'on_people_activate'			: self.show_people_window,
-		'on_cancel_people_clicked'		: self.hide_people_window,
-		'on_filter_txt_changed'			: self.filter_txt,
-		'on_filter_criteria_changed'		: self.on_filter_criteria_changed,
-		'on_clear_filter_clicked'		: self.clear_filter,
-		'on_people_add_clicked'			: self.add_person,
-		'on_add_person_cancel_clicked'		: self.add_person_cancel,
-		'on_add_person_db_clicked'		: self.add_person_db,
-		'on_people_delete_clicked'		: self.delete_person,
-		'on_people_edit_clicked'		: self.edit_person,
-		'on_edit_person_cancel_clicked'		: self.edit_person_cancel,
-		'on_update_person_clicked'		: self.update_person,
-		'on_clone_activate'			: self.clone_movie,
-		'on_loan_button_clicked'		: self.loan_movie,
-		'on_cancel_loan_clicked'		: self.cancel_loan,
-		'on_loan_ok_clicked'			: self.commit_loan,
-		'on_return_button_clicked'		: self.return_loan,
-		'on_list_loaned_movies_activate'	: self.filter_loaned,
-		'on_m_show_volume_button_clicked'	: self.show_volume,
-		'on_m_show_collection_button_clicked'	: self.show_collection,
-		'on_cover_choose_image_activate'	: self.print_cover_image,
-		'on_cancel_print_cover_image_clicked'	: self.print_cover_image_hide,
-		'on_b_print_cover_image_clicked'	: self.print_cover_image_process,
-		'on_combo_source_changed'		: self.source_changed,
-		# toolbar
-		'on_view_toolbar_activate'		: self.toggle_toolbar,
-		'on_go_first_clicked'			: self.go_first,
-		'on_go_last_clicked'			: self.go_last,
-		'on_go_back_clicked'			: self.go_prev,
-		'on_go_forward_clicked'			: self.go_next,
-		'on_new_bt_clicked'			: self.new_dbb,
-		'on_new_activate'			: self.new_dbb,
-		'on_edit_button_clicked'		: self.edit_movie,
-		# poster
-		'on_e_picture_clicked'			: self.change_poster,
-		'on_open_poster_clicked'		: self.change_poster,
-		'on_zoom_poster_clicked'		: self.z_poster,
-		'on_delete_poster_clicked'		: self.del_poster,
-		'on_fetch_poster_clicked'		: self.get_poster,
-		# URLs
-		'on_goto_homepage_activate'		: self.on_goto_homepage_activate,
-		'on_goto_forum_activate'		: self.on_goto_forum_activate,
-		'on_goto_report_bug_activate'		: self.on_goto_report_bug_activate,
-		'on_go_o_site_clicked'			: self.go_oficial_site,
-		'on_go_site_clicked'			: self.go_site,
-		'on_go_trailer_clicked'			: self.go_trailer_site,
-		'on_seen_movies_activate'		: self.filter_not_seen,
-		'on_all_movies_activate'		: self.filter_all,
-		'on_rating_scale_add_value_changed'	: self.scale_rating_change_add,
-		'on_sugest_activate'			: self.sugest_movie,
-		'on_popup_delete_activate'		: self.delete_movie,
-		'on_popup_clone_activate'		: self.clone_movie,
-		'on_popup_simple_activate'		: self.print_cover_simple_show,
-		'on_popup_choose_image_activate'	: self.print_cover_image,
-		# loans
-		'on_popup_loan_activate'		: self.loan_movie,
-		'on_popup_return_activate'		: self.return_loan,
-		'on_popup_email_activate'		: self.email_reminder,
-		'on_email_reminder_clicked'		: self.email_reminder,
-		# volumes/collections
-		'on_am_collection_combo_changed'	: self.on_am_collection_combo_changed,
-		'on_am_volume_combo_changed'		: self.on_am_volume_combo_changed,
-		'on_am_add_volume_button_clicked'	: self.add_volume,
-		'on_am_add_collection_button_clicked'	: self.add_collection,
-		'on_am_remove_volume_button_clicked'	: self.remove_volume,
-		'on_am_remove_collection_button_clicked': self.remove_collection,
-		'on_f_col_changed'			: self.filter_collection,
-		'on_f_volume_changed'			: self.filter_volume,
-		'on_f_loanedto_changed'			: self.filter_loanedto,
-		'on_f_bytag_changed'			: self.filter_bytag,
-		'on_results_cancel_clicked'		: self.results_cancel_ck,
-		# languages
-		'on_lang_add_clicked'			: self.on_lang_add_clicked,
-		'on_lang_remove_clicked'		: self.on_lang_remove_clicked,
-		'on_am_lang_add_clicked'		: self.on_am_lang_add_clicked,
-		'on_am_lang_remove_clicked'		: self.on_am_lang_remove_clicked,
-		'on_lang_rename_clicked'		: self.on_lang_rename_clicked,
-		'on_lang_name_combo_changed'		: self.on_lang_name_combo_changed,
-		# tags
-		'on_tag_add_clicked'			: self.on_tag_add_clicked,
-		'on_tag_remove_clicked'			: self.on_tag_remove_clicked,
-		'on_tag_rename_clicked'			: self.on_tag_rename_clicked,
-		'on_tag_name_combo_changed'		: self.on_tag_name_combo_changed,
-		# audio codecs
-		'on_acodec_add_clicked'			: self.on_acodec_add_clicked,
-		'on_acodec_remove_clicked'		: self.on_acodec_remove_clicked,
-		'on_acodec_rename_clicked'		: self.on_acodec_rename_clicked,
-		'on_acodec_name_combo_changed'		: self.on_acodec_name_combo_changed,
-		# audio channels
-		'on_achannel_add_clicked'		: self.on_achannel_add_clicked,
-		'on_achannel_remove_clicked'		: self.on_achannel_remove_clicked,
-		'on_achannel_rename_clicked'		: self.on_achannel_rename_clicked,
-		'on_achannel_name_combo_changed'	: self.on_achannel_name_combo_changed,
-		# subtitle formats
-		'on_subformat_add_clicked'		: self.on_subformat_add_clicked,
-		'on_subformat_remove_clicked'		: self.on_subformat_remove_clicked,
-		'on_subformat_rename_clicked'		: self.on_subformat_rename_clicked,
-		'on_subformat_name_combo_changed'	: self.on_subformat_name_combo_changed,
-		# media
-		'on_medium_add_clicked'			: self.on_medium_add_clicked,
-		'on_medium_remove_clicked'		: self.on_medium_remove_clicked,
-		'on_medium_rename_clicked'		: self.on_medium_rename_clicked,
-		'on_medium_name_combo_changed'		: self.on_medium_name_combo_changed,
-		# video codecs
-		'on_vcodec_add_clicked'			: self.on_vcodec_add_clicked,
-		'on_vcodec_remove_clicked'		: self.on_vcodec_remove_clicked,
-		'on_vcodec_rename_clicked'		: self.on_vcodec_rename_clicked,
-		'on_vcodec_name_combo_changed'		: self.on_vcodec_name_combo_changed
-	})#}}}
+    # define handlers for general events
+    gladefile.signal_autoconnect({#{{{
+        'gtk_main_quit'                : self.destroy,
+        'on_window_state'            : self.on_window_state,
+        'on_configure'                : self.on_configure,
+        'on_about1_activate'            : self.about_dialog,
+        'on_quit1_activate'            : self.destroy,
+        'on_toolbar_quit_clicked'        : self.destroy,
+        'on_toolbar_add_clicked'        : self.add_movie,
+        'on_cancel_add_movie_clicked'        : self.hide_add_window,
+        'on_add1_activate'            : self.add_movie,
+        'on_add_movie_clicked'            : self.add_movie_db,
+        'on_add_movie_close_clicked'        : self.add_movie_close_db,
+        'on_delete_movie_clicked'        : self.delete_movie,
+        'on_delete1_movie_activate'        : self.delete_movie,
+        'on_main_treeview_row_activated'    : self.treeview_clicked,
+        'on_row_activated'            : self.treeview_clicked,
+        'on_get_from_web_clicked'        : self.get_from_web,
+        'on_update_button_clicked'        : self.update_movie,
+        'on_import_activate'            : self.on_import_activate,
+        'on_seen_activate'            : self.toggle_seen,
+        # preferences
+        'on_preferences1_activate'        : self.show_preferences,
+        'on_cancel_preferences_clicked'        : self.hide_preferences,
+        'on_save_preferences_clicked'        : self.save_preferences,
+        'on_p_db_type_changed'            : self.on_p_db_type_changed,
+        'on_backup_activate'            : self.backup,
+        'on_restore_activate'            : self.restore,
+        'on_merge_activate'            : self.merge,
+        'on_cover_simple_activate'        : self.print_cover_simple_show,
+        'on_cancel_print_cover_simple_clicked'    : self.print_cover_simple_hide,
+        'on_b_print_cover_simple_clicked'    : self.print_cover_simple_process,
+        'on_add_clear_clicked'            : self.clear_add_dialog,
+        'on_am_save_button_clicked'        : self.update_movie,
+        'on_people_activate'            : self.show_people_window,
+        'on_cancel_people_clicked'        : self.hide_people_window,
+        'on_filter_txt_changed'            : self.filter_txt,
+        'on_filter_criteria_changed'        : self.on_filter_criteria_changed,
+        'on_clear_filter_clicked'        : self.clear_filter,
+        'on_people_add_clicked'            : self.add_person,
+        'on_add_person_cancel_clicked'        : self.add_person_cancel,
+        'on_add_person_db_clicked'        : self.add_person_db,
+        'on_people_delete_clicked'        : self.delete_person,
+        'on_people_edit_clicked'        : self.edit_person,
+        'on_edit_person_cancel_clicked'        : self.edit_person_cancel,
+        'on_update_person_clicked'        : self.update_person,
+        'on_clone_activate'            : self.clone_movie,
+        'on_loan_button_clicked'        : self.loan_movie,
+        'on_cancel_loan_clicked'        : self.cancel_loan,
+        'on_loan_ok_clicked'            : self.commit_loan,
+        'on_return_button_clicked'        : self.return_loan,
+        'on_list_loaned_movies_activate'    : self.filter_loaned,
+        'on_m_show_volume_button_clicked'    : self.show_volume,
+        'on_m_show_collection_button_clicked'    : self.show_collection,
+        'on_cover_choose_image_activate'    : self.print_cover_image,
+        'on_cancel_print_cover_image_clicked'    : self.print_cover_image_hide,
+        'on_b_print_cover_image_clicked'    : self.print_cover_image_process,
+        'on_combo_source_changed'        : self.source_changed,
+        # toolbar
+        'on_view_toolbar_activate'        : self.toggle_toolbar,
+        'on_go_first_clicked'            : self.go_first,
+        'on_go_last_clicked'            : self.go_last,
+        'on_go_back_clicked'            : self.go_prev,
+        'on_go_forward_clicked'            : self.go_next,
+        'on_new_bt_clicked'            : self.new_dbb,
+        'on_new_activate'            : self.new_dbb,
+        'on_edit_button_clicked'        : self.edit_movie,
+        # poster
+        'on_e_picture_clicked'            : self.change_poster,
+        'on_open_poster_clicked'        : self.change_poster,
+        'on_zoom_poster_clicked'        : self.z_poster,
+        'on_delete_poster_clicked'        : self.del_poster,
+        'on_fetch_poster_clicked'        : self.get_poster,
+        # URLs
+        'on_goto_homepage_activate'        : self.on_goto_homepage_activate,
+        'on_goto_forum_activate'        : self.on_goto_forum_activate,
+        'on_goto_report_bug_activate'        : self.on_goto_report_bug_activate,
+        'on_go_o_site_clicked'            : self.go_oficial_site,
+        'on_go_site_clicked'            : self.go_site,
+        'on_go_trailer_clicked'            : self.go_trailer_site,
+        'on_seen_movies_activate'        : self.filter_not_seen,
+        'on_all_movies_activate'        : self.filter_all,
+        'on_rating_scale_add_value_changed'    : self.scale_rating_change_add,
+        'on_sugest_activate'            : self.sugest_movie,
+        'on_popup_delete_activate'        : self.delete_movie,
+        'on_popup_clone_activate'        : self.clone_movie,
+        'on_popup_simple_activate'        : self.print_cover_simple_show,
+        'on_popup_choose_image_activate'    : self.print_cover_image,
+        # loans
+        'on_popup_loan_activate'        : self.loan_movie,
+        'on_popup_return_activate'        : self.return_loan,
+        'on_popup_email_activate'        : self.email_reminder,
+        'on_email_reminder_clicked'        : self.email_reminder,
+        # volumes/collections
+        'on_am_collection_combo_changed'    : self.on_am_collection_combo_changed,
+        'on_am_volume_combo_changed'        : self.on_am_volume_combo_changed,
+        'on_am_add_volume_button_clicked'    : self.add_volume,
+        'on_am_add_collection_button_clicked'    : self.add_collection,
+        'on_am_remove_volume_button_clicked'    : self.remove_volume,
+        'on_am_remove_collection_button_clicked': self.remove_collection,
+        'on_f_col_changed'            : self.filter_collection,
+        'on_f_volume_changed'            : self.filter_volume,
+        'on_f_loanedto_changed'            : self.filter_loanedto,
+        'on_f_bytag_changed'            : self.filter_bytag,
+        'on_results_cancel_clicked'        : self.results_cancel_ck,
+        # languages
+        'on_lang_add_clicked'            : self.on_lang_add_clicked,
+        'on_lang_remove_clicked'        : self.on_lang_remove_clicked,
+        'on_am_lang_add_clicked'        : self.on_am_lang_add_clicked,
+        'on_am_lang_remove_clicked'        : self.on_am_lang_remove_clicked,
+        'on_lang_rename_clicked'        : self.on_lang_rename_clicked,
+        'on_lang_name_combo_changed'        : self.on_lang_name_combo_changed,
+        # tags
+        'on_tag_add_clicked'            : self.on_tag_add_clicked,
+        'on_tag_remove_clicked'            : self.on_tag_remove_clicked,
+        'on_tag_rename_clicked'            : self.on_tag_rename_clicked,
+        'on_tag_name_combo_changed'        : self.on_tag_name_combo_changed,
+        # audio codecs
+        'on_acodec_add_clicked'            : self.on_acodec_add_clicked,
+        'on_acodec_remove_clicked'        : self.on_acodec_remove_clicked,
+        'on_acodec_rename_clicked'        : self.on_acodec_rename_clicked,
+        'on_acodec_name_combo_changed'        : self.on_acodec_name_combo_changed,
+        # audio channels
+        'on_achannel_add_clicked'        : self.on_achannel_add_clicked,
+        'on_achannel_remove_clicked'        : self.on_achannel_remove_clicked,
+        'on_achannel_rename_clicked'        : self.on_achannel_rename_clicked,
+        'on_achannel_name_combo_changed'    : self.on_achannel_name_combo_changed,
+        # subtitle formats
+        'on_subformat_add_clicked'        : self.on_subformat_add_clicked,
+        'on_subformat_remove_clicked'        : self.on_subformat_remove_clicked,
+        'on_subformat_rename_clicked'        : self.on_subformat_rename_clicked,
+        'on_subformat_name_combo_changed'    : self.on_subformat_name_combo_changed,
+        # media
+        'on_medium_add_clicked'            : self.on_medium_add_clicked,
+        'on_medium_remove_clicked'        : self.on_medium_remove_clicked,
+        'on_medium_rename_clicked'        : self.on_medium_rename_clicked,
+        'on_medium_name_combo_changed'        : self.on_medium_name_combo_changed,
+        # video codecs
+        'on_vcodec_add_clicked'            : self.on_vcodec_add_clicked,
+        'on_vcodec_remove_clicked'        : self.on_vcodec_remove_clicked,
+        'on_vcodec_rename_clicked'        : self.on_vcodec_rename_clicked,
+        'on_vcodec_name_combo_changed'        : self.on_vcodec_name_combo_changed
+    })#}}}
 
 def reconnect_add_signals(self):#{{{
-	self.widgets['add']['b_get_from_web'].set_sensitive(True)
-	try:
-		self.widgets['results']['select'].disconnect(self.poster_results_signal)
-	except:
-		pass
+    self.widgets['add']['b_get_from_web'].set_sensitive(True)
+    try:
+        self.widgets['results']['select'].disconnect(self.poster_results_signal)
+    except:
+        pass
 
-	try:
-		self.widgets['results']['treeview'].disconnect(self.results_poster_double_click)
-	except:
-		pass
+    try:
+        self.widgets['results']['treeview'].disconnect(self.results_poster_double_click)
+    except:
+        pass
 
-	# connect signals
-	self.results_signal = self.widgets['results']['select'].connect('clicked', \
-			self.populate_dialog_with_results)
-	self.results_double_click = self.widgets['results']['treeview'].connect('button_press_event', \
-		self.on_results_button_press_event)#}}}
+    # connect signals
+    self.results_signal = self.widgets['results']['select'].connect('clicked', \
+            self.populate_dialog_with_results)
+    self.results_double_click = self.widgets['results']['treeview'].connect('button_press_event', \
+        self.on_results_button_press_event)#}}}
 
 def connect_poster_signals(self, event, result, current_poster):#{{{
-	import edit
+    import edit
 
-	try:
-		self.widgets['results']['select'].disconnect(self.results_signal)
-	except:
-		pass
+    try:
+        self.widgets['results']['select'].disconnect(self.results_signal)
+    except:
+        pass
 
-	try:
-		self.widgets['results']['treeview'].disconnect(self.results_double_click)
-	except:
-		pass
+    try:
+        self.widgets['results']['treeview'].disconnect(self.results_double_click)
+    except:
+        pass
 
-	# connect signals
+    # connect signals
 
-	self.results_poster_double_click = self.widgets['results']['treeview'].connect('button_press_event', \
-		edit.get_poster_select_dc, self, result, current_poster)
+    self.results_poster_double_click = self.widgets['results']['treeview'].connect('button_press_event', \
+        edit.get_poster_select_dc, self, result, current_poster)
 
-	self.poster_results_signal = \
-		self.widgets['results']['select'].connect('clicked', edit.get_poster_select, \
-		self, result, current_poster)
-	#}}}
+    self.poster_results_signal = \
+        self.widgets['results']['select'].connect('clicked', edit.get_poster_select, \
+        self, result, current_poster)
+    #}}}
 # vim: fdm=marker

Modified: trunk/winsetup.py
===================================================================
--- trunk/winsetup.py	2008-07-26 20:43:43 UTC (rev 970)
+++ trunk/winsetup.py	2008-07-28 21:26:40 UTC (rev 971)
@@ -48,14 +48,14 @@
     &quot;py2exe&quot;: {
         &quot;includes&quot;: &quot;pygtk,cairo,pangocairo,gobject,cgi,PIL,pysqlite2,pysqlite2.*,pango,atk,gobject,tempfile,csv,xml.dom,xml.dom.ext,xml.dom.minidom,xml.sax,threading,htmlentitydefs,sqlalchemy,sqlalchemy.*,sqlalchemy.mods.*,sqlalchemy.databases.*,sqlalchemy.engine.*,sqlalchemy.ext.*,sqlalchemy.orm.*,zipfile,webbrowser,shutil,reportlab,reportlab.pdfgen,reportlab.pdfgen.canvas,reportlab.platypus,reportlab.pdfbase.ttfonts,smtplib,win32com,platform,winshell,psycopg2,MySQLdb,chardet,gzip,commands,encodings,encodings.*&quot;,
         &quot;optimize&quot;: 2,
-		&quot;dist_dir&quot;: &quot;dist&quot;,
+        &quot;dist_dir&quot;: &quot;dist&quot;,
     }
 }
 
 setup(
     name = &quot;Griffith&quot;,
     version = &quot;0.9.7.1&quot;,
-	description = 'Griffith - A film manager',
+    description = 'Griffith - A film manager',
     author = 'Vasco Nunes/Piotr Ozarowski',
     author_email = '<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">vasco.m.nunes at gmail.com</A>',
     url = '<A HREF="http://griffith.cc/">http://griffith.cc/</A>',
@@ -65,39 +65,39 @@
             &quot;script&quot;: &quot;griffith&quot;,
             &quot;icon_resources&quot;: [(1, &quot;images\griffith.ico&quot;)]
         }],
-	options = opts,
-		data_files=[
-		(&quot;images&quot;, glob.glob(&quot;data\\*.png&quot;)),
-		(&quot;images/export_templates&quot;, glob.glob(&quot;export_templates\\*.dtd&quot;)),
-		(&quot;images/export_templates/csv&quot;,	glob.glob(&quot;export_templates\\csv\\*.*&quot;)),
-		(&quot;images/export_templates/xml&quot;,	glob.glob(&quot;export_templates\\xml\\*.*&quot;)),
-		(&quot;images/export_templates/latex&quot;, glob.glob(&quot;export_templates\\latex\\*.*&quot;)),
-		(&quot;images/export_templates/html_table&quot;, glob.glob(&quot;export_templates\\html_table\\*.*&quot;)),
-		(&quot;images/export_templates/html_tables&quot;,	glob.glob(&quot;export_templates\\html_tables\\*.*&quot;)),
-		(&quot;glade&quot;, glob.glob(&quot;glade\\*.*&quot;)),
-		(&quot;i18n/bg/LC_MESSAGES&quot;, glob.glob(&quot;i18n\\bg\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/ca/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\ca\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/cs/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\cs\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/da/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\da\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/de/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\de\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/el/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\el\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/es/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\es\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/ja/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\ja\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/fr/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\fr\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/nb/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\nb\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/pl/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\pl\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/pt/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\pt\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/ru/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\ru\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/it/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\it\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/nl/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\nl\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/sv/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\sv\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/tr/LC_MESSAGES&quot;,	glob.glob(&quot;i18n\\tr\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/pt_BR/LC_MESSAGES&quot;, glob.glob(&quot;i18n\\pt_BR\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;i18n/zh_CN/LC_MESSAGES&quot;, glob.glob(&quot;i18n\\zh_CN\\LC_MESSAGES\\*.mo&quot;)),
-		(&quot;lib/plugins&quot;, glob.glob(&quot;lib\\plugins\\*.*&quot;)),
-		(&quot;lib/plugins/export&quot;, glob.glob(&quot;lib\\plugins\\export\\*.*&quot;)),
-		(&quot;lib/plugins/movie&quot;, glob.glob(&quot;lib\\plugins\\movie\\*.*&quot;)),
-		(&quot;lib/plugins/imp&quot;, glob.glob(&quot;lib\\plugins\\imp\\*.*&quot;)),
-		(&quot;images&quot;, glob.glob(&quot;images\\*.png&quot;)),
-		(&quot;lib&quot;, glob.glob(&quot;lib\\*.*&quot;))],
+    options = opts,
+        data_files=[
+        (&quot;images&quot;, glob.glob(&quot;data\\*.png&quot;)),
+        (&quot;images/export_templates&quot;, glob.glob(&quot;export_templates\\*.dtd&quot;)),
+        (&quot;images/export_templates/csv&quot;,    glob.glob(&quot;export_templates\\csv\\*.*&quot;)),
+        (&quot;images/export_templates/xml&quot;,    glob.glob(&quot;export_templates\\xml\\*.*&quot;)),
+        (&quot;images/export_templates/latex&quot;, glob.glob(&quot;export_templates\\latex\\*.*&quot;)),
+        (&quot;images/export_templates/html_table&quot;, glob.glob(&quot;export_templates\\html_table\\*.*&quot;)),
+        (&quot;images/export_templates/html_tables&quot;,    glob.glob(&quot;export_templates\\html_tables\\*.*&quot;)),
+        (&quot;glade&quot;, glob.glob(&quot;glade\\*.*&quot;)),
+        (&quot;i18n/bg/LC_MESSAGES&quot;, glob.glob(&quot;i18n\\bg\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/ca/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\ca\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/cs/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\cs\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/da/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\da\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/de/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\de\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/el/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\el\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/es/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\es\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/ja/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\ja\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/fr/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\fr\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/nb/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\nb\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/pl/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\pl\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/pt/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\pt\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/ru/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\ru\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/it/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\it\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/nl/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\nl\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/sv/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\sv\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/tr/LC_MESSAGES&quot;,    glob.glob(&quot;i18n\\tr\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/pt_BR/LC_MESSAGES&quot;, glob.glob(&quot;i18n\\pt_BR\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;i18n/zh_CN/LC_MESSAGES&quot;, glob.glob(&quot;i18n\\zh_CN\\LC_MESSAGES\\*.mo&quot;)),
+        (&quot;lib/plugins&quot;, glob.glob(&quot;lib\\plugins\\*.*&quot;)),
+        (&quot;lib/plugins/export&quot;, glob.glob(&quot;lib\\plugins\\export\\*.*&quot;)),
+        (&quot;lib/plugins/movie&quot;, glob.glob(&quot;lib\\plugins\\movie\\*.*&quot;)),
+        (&quot;lib/plugins/imp&quot;, glob.glob(&quot;lib\\plugins\\imp\\*.*&quot;)),
+        (&quot;images&quot;, glob.glob(&quot;images\\*.png&quot;)),
+        (&quot;lib&quot;, glob.glob(&quot;lib\\*.*&quot;))],
 )


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000453.html">[Griffith-svn] r969 - branches/0.9.x/docs/en branches/0.9.x/docs/pl	branches/0.9.x/docs/pt trunk/docs/en trunk/docs/pl trunk/docs/pt
</A></li>
	<LI>Next message: <A HREF="000455.html">[Griffith-svn] r972 - in trunk: . lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#454">[ date ]</a>
              <a href="thread.html#454">[ thread ]</a>
              <a href="subject.html#454">[ subject ]</a>
              <a href="author.html#454">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/griffith-svn">More information about the Griffith-svn
mailing list</a><br>
</body></html>
