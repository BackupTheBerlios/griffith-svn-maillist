From mikej06 at mail.berlios.de  Sat Nov  1 23:09:59 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 1 Nov 2008 23:09:59 +0100
Subject: [Griffith-svn] r1024 - branches/0.9.x
	branches/0.9.x/lib/plugins/movie trunk trunk/lib/plugins/movie
Message-ID: <200811012209.mA1M9xcV026614@sheep.berlios.de>

Author: mikej06
Date: 2008-11-01 23:09:44 +0100 (Sat, 01 Nov 2008)
New Revision: 1024

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
   trunk/ChangeLog
   trunk/lib/plugins/movie/PluginMovieIMDB.py
Log:
updated IMDB plugin

Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-10-30 10:54:36 UTC (rev 1023)
+++ branches/0.9.x/ChangeLog	2008-11-01 22:09:44 UTC (rev 1024)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-01  Michael Jahn
+	* updated IMDB plugin
+
 2008-10-26  Michael Jahn
 	* [#179618] During "Get from Web ", griffith window keeps stealing focus
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-10-30 10:54:36 UTC (rev 1023)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-01 22:09:44 UTC (rev 1024)
@@ -52,12 +52,16 @@
 
 	def get_o_title(self):
 		self.o_title = gutils.trim(self.page, '<h1>', ' <span')
+		if self.o_title == '':
+			self.o_title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 
 	def get_title(self):	# same as get_o_title()
 		self.title = gutils.trim(self.page, '<h1>', ' <span')
+		if self.title == '':
+			self.title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 
 	def get_director(self):
-		pattern = re.compile('<h5>Directors?:</h5>[\n\s\r]*(.*?)(?:<br/>)?(?:<a[^>]+>more</a>)?\n</div')
+		pattern = re.compile('<h5>Director[s]*?:</h5>[\n\s\r]*(.*?)(?:<br/>)?(?:<a[^>]+>more</a>)?[\n]*</div')
 		result = pattern.search(self.page)
 		if result:
 			self.director = result.groups()[0]
@@ -91,6 +95,7 @@
 		if self.cast == '':
 			self.cast = gutils.trim(self.page, '<table class="cast">', '</table>')
 		self.cast = string.replace(self.cast, ' ... ', _(' as '))
+		self.cast = string.replace(self.cast, '...', _(' as '))
 		self.cast = string.replace(self.cast, '</tr><tr>', "\n")
 		self.cast = string.replace(self.cast, '</tr><tr class="even">', "\n")
 		self.cast = string.replace(self.cast, '</tr><tr class="odd">', "\n")
@@ -116,12 +121,15 @@
 		self.country = gutils.trim(self.page, '<h5>Country:</h5>', '</div>')
 
 	def get_rating(self):
-		self.rating = gutils.trim(self.page, '<b>User Rating:</b> \n<b>', '/10')
-		if self.rating and self.rating.find('awaiting') == -1:
-			try:
-				self.rating = float(self.rating)
-			except Exception, e:
-				self.rating = 0
+		pattern = re.compile('>([0-9]([.][0-9])*)[/][0-9][0-9]<')
+		result = pattern.search(self.page)
+		if result:
+			self.rating = result.groups()[0]
+			if self.rating:
+				try:
+					self.rating = float(self.rating)
+				except Exception, e:
+					self.rating = 0
 		else:
 			self.rating = 0
 
@@ -129,13 +137,25 @@
 		self.notes = ''
 		language = gutils.trim(self.page, '<h5>Language:</h5>', '</div>')
 		language = gutils.strip_tags(language)
+		language = re.sub('[\n]+', '', language)
+		language = re.sub('[ ]+', ' ', language)
+		language = language.rstrip()
 		color = gutils.trim(self.page, '<h5>Color:</h5>', '</div>')
 		color = gutils.strip_tags(color)
+		color = re.sub('[\n]+', '', color)
+		color = re.sub('[ ]+', ' ', color)
+		color = color.rstrip()
 		sound = gutils.trim(self.page, '<h5>Sound Mix:</h5>', '</div>')
 		sound = gutils.strip_tags(sound)
+		sound = re.sub('[\n]+', '', sound)
+		sound = re.sub('[ ]+', ' ', sound)
+		sound = sound.rstrip()
 		tagline = gutils.trim(self.page, '<h5>Tagline:</h5>', '</div>')
 		tagline = self.__before_more(tagline)
 		tagline = gutils.strip_tags(tagline)
+		tagline = re.sub('[\n]+', '', tagline)
+		tagline = re.sub('[ ]+', ' ', tagline)
+		tagline = tagline.rstrip()
 		if len(language)>0:
 			self.notes = "%s: %s\n" %(_('Language'), language)
 		if len(sound)>0:
@@ -152,22 +172,36 @@
 		return data
 
 class SearchPlugin(movie.SearchMovie):
-	PATTERN = re.compile(r"""<a href=['"]/title/tt([0-9]+)/["']>(.*?)</td>""")
+	PATTERN = re.compile(r"""<A HREF=['"]/title/tt([0-9]+)/["']>(.*?)</LI>""")
+	PATTERN2 = re.compile(r"""<a href=['"]/title/tt([0-9]+)/["']>(.*?)</td>""")
+
 	def __init__(self):
-		self.original_url_search	= 'http://imdb.com/find?more=tt;q='
-		self.translated_url_search	= 'http://imdb.com/find?more=tt;q='
+		self.original_url_search	= 'http://www.imdb.com/List?words='
+		self.translated_url_search	= 'http://www.imdb.com/find?more=tt;q='
 		self.encode = 'utf-8'
 
 	def search(self,parent_window):
 		self.open_search(parent_window)
-		self.page = gutils.trim(self.page, '(Displaying', '<b>Suggestions For Improving Your Results</b>');
+		tmp_page = gutils.trim(self.page, 'Here are the', '</TABLE>')
+		if tmp_page == '':
+			self.page = gutils.trim(self.page, '(Displaying', '<b>Suggestions For Improving Your Results</b>')
+		else:
+			self.page = tmp_page
 		self.page = self.page.decode('iso-8859-1')
 		return self.page
 
 	def get_searches(self):
-		elements = string.split(self.page, '<tr>')
-
-		if len(elements):
+		elements = re.split('<LI>', self.page)
+		if len(elements) < 2:
+			elements = string.split(self.page, '<tr>')
+			if len(elements):
+				for element in elements[1:]:
+					match = self.PATTERN2.findall(element)
+					if len(match):
+						tmp  = gutils.clean(match[0][1])
+						self.ids.append(match[0][0])
+						self.titles.append(tmp)
+		else:
 			for element in elements[1:]:
 				match = self.PATTERN.findall(element)
 				if len(match):

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-10-30 10:54:36 UTC (rev 1023)
+++ trunk/ChangeLog	2008-11-01 22:09:44 UTC (rev 1024)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-01  Michael Jahn
+	* updated IMDB plugin
+
 2008-10-26  Michael Jahn
 	* [#179618] During "Get from Web ", griffith window keeps stealing focus
 

Modified: trunk/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-10-30 10:54:36 UTC (rev 1023)
+++ trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-11-01 22:09:44 UTC (rev 1024)
@@ -53,12 +53,16 @@
 
     def get_o_title(self):
         self.o_title = gutils.trim(self.page, '<h1>', ' <span')
+        if self.o_title == '':
+            self.o_title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 
     def get_title(self):    # same as get_o_title()
         self.title = gutils.trim(self.page, '<h1>', ' <span')
+        if self.title == '':
+            self.title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 
     def get_director(self):
-        pattern = re.compile('<h5>Directors?:</h5>[\n\s\r]*(.*?)(?:<br/>)?(?:<a[^>]+>more</a>)?\n</div')
+        pattern = re.compile('<h5>Director[s]*?:</h5>[\n\s\r]*(.*?)(?:<br/>)?(?:<a[^>]+>more</a>)?[\n]*</div')
         result = pattern.search(self.page)
         if result:
             self.director = result.groups()[0]
@@ -92,6 +96,7 @@
         if self.cast == '':
             self.cast = gutils.trim(self.page, '<table class="cast">', '</table>')
         self.cast = string.replace(self.cast, ' ... ', _(' as '))
+        self.cast = string.replace(self.cast, '...', _(' as '))
         self.cast = string.replace(self.cast, '</tr><tr>', "\n")
         self.cast = string.replace(self.cast, '</tr><tr class="even">', "\n")
         self.cast = string.replace(self.cast, '</tr><tr class="odd">', "\n")
@@ -117,12 +122,15 @@
         self.country = gutils.trim(self.page, '<h5>Country:</h5>', '</div>')
 
     def get_rating(self):
-        self.rating = gutils.trim(self.page, '<b>User Rating:</b> \n<b>', '/10')
-        if self.rating and self.rating.find('awaiting') == -1:
-            try:
-                self.rating = float(self.rating)
-            except Exception, e:
-                self.rating = 0
+        pattern = re.compile('>([0-9]([.][0-9])*)[/][0-9][0-9]<')
+        result = pattern.search(self.page)
+        if result:
+            self.rating = result.groups()[0]
+            if self.rating:
+                try:
+                    self.rating = float(self.rating)
+                except Exception, e:
+                    self.rating = 0
         else:
             self.rating = 0
 
@@ -130,13 +138,25 @@
         self.notes = ''
         language = gutils.trim(self.page, '<h5>Language:</h5>', '</div>')
         language = gutils.strip_tags(language)
+        language = re.sub('[\n]+', '', language)
+        language = re.sub('[ ]+', ' ', language)
+        language = language.rstrip()
         color = gutils.trim(self.page, '<h5>Color:</h5>', '</div>')
         color = gutils.strip_tags(color)
+        color = re.sub('[\n]+', '', color)
+        color = re.sub('[ ]+', ' ', color)
+        color = color.rstrip()
         sound = gutils.trim(self.page, '<h5>Sound Mix:</h5>', '</div>')
         sound = gutils.strip_tags(sound)
+        sound = re.sub('[\n]+', '', sound)
+        sound = re.sub('[ ]+', ' ', sound)
+        sound = sound.rstrip()
         tagline = gutils.trim(self.page, '<h5>Tagline:</h5>', '</div>')
         tagline = self.__before_more(tagline)
         tagline = gutils.strip_tags(tagline)
+        tagline = re.sub('[\n]+', '', tagline)
+        tagline = re.sub('[ ]+', ' ', tagline)
+        tagline = tagline.rstrip()
         if len(language)>0:
             self.notes = "%s: %s\n" %(_('Language'), language)
         if len(sound)>0:
@@ -153,25 +173,39 @@
         return data
 
 class SearchPlugin(movie.SearchMovie):
-    PATTERN = re.compile(r"""<a href=['"]/title/tt([0-9]+)/["']>(.*?)</td>""")
+    PATTERN = re.compile(r"""<A HREF=['"]/title/tt([0-9]+)/["']>(.*?)</LI>""")
+    PATTERN2 = re.compile(r"""<a href=['"]/title/tt([0-9]+)/["']>(.*?)</td>""")
+
     def __init__(self):
-        self.original_url_search    = 'http://imdb.com/find?more=tt;q='
-        self.translated_url_search    = 'http://imdb.com/find?more=tt;q='
+        self.original_url_search    = 'http://www.imdb.com/List?words='
+        self.translated_url_search	= 'http://www.imdb.com/find?more=tt;q='
         self.encode = 'utf-8'
 
     def search(self,parent_window):
         self.open_search(parent_window)
-        self.page = gutils.trim(self.page, '(Displaying', '<b>Suggestions For Improving Your Results</b>');
+        tmp_page = gutils.trim(self.page, 'Here are the', '</TABLE>')
+        if tmp_page == '':
+            self.page = gutils.trim(self.page, '(Displaying', '<b>Suggestions For Improving Your Results</b>')
+        else:
+            self.page = tmp_page
         self.page = self.page.decode('iso-8859-1')
         return self.page
 
     def get_searches(self):
-        elements = string.split(self.page, '<tr>')
-
-        if len(elements):
+        elements = re.split('<LI>', self.page)
+        if len(elements) < 2:
+            elements = string.split(self.page, '<tr>')
+            if len(elements):
+                for element in elements[1:]:
+                    match = self.PATTERN.findall(element)
+                    if len(match):
+                        tmp = gutils.clean(match[0][1])
+                        self.ids.append(match[0][0])
+                        self.titles.append(tmp)
+        else:
             for element in elements[1:]:
                 match = self.PATTERN.findall(element)
                 if len(match):
-                    tmp  = gutils.clean(match[0][1])
+                    tmp = gutils.clean(match[0][1])
                     self.ids.append(match[0][0])
                     self.titles.append(tmp)



From mikej06 at mail.berlios.de  Sat Nov  1 23:14:06 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 1 Nov 2008 23:14:06 +0100
Subject: [Griffith-svn] r1025 - in trunk: . lib
Message-ID: <200811012214.mA1ME6Jh026951@sheep.berlios.de>

Author: mikej06
Date: 2008-11-01 23:13:44 +0100 (Sat, 01 Nov 2008)
New Revision: 1025

Modified:
   trunk/griffith
   trunk/lib/dbupgrade.py
   trunk/lib/sql.py
Log:
* load movie pictures from locations['posters'] when upgrading to 0.10
* added MySQL and MSSQL support for 0.10

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-01 22:09:44 UTC (rev 1024)
+++ trunk/griffith	2008-11-01 22:13:44 UTC (rev 1025)
@@ -109,7 +109,7 @@
         
         # create/connect db
         from sql import GriffithSQL
-        self.db = GriffithSQL(self.config, self.locations['home'])
+        self.db = GriffithSQL(self.config, self.locations['home'], self.locations)
 
         # let's check any console arguments to parse
         gconsole.check_args_with_db(self)
@@ -1288,7 +1288,7 @@
                 treeview.set_cursor_on_cell(0)
 
 if __name__ == "__main__":
-    developer = False # TODO: get from config
+    developer = True # TODO: get from config
     if not developer and '~' in version.pversion or '-' in version.pversion:
         response = gutils.question(_("""This is development version of Griffith.
 We're not providing upgrade path from dev. versions.

Modified: trunk/lib/dbupgrade.py
===================================================================
--- trunk/lib/dbupgrade.py	2008-11-01 22:09:44 UTC (rev 1024)
+++ trunk/lib/dbupgrade.py	2008-11-01 22:13:44 UTC (rev 1025)
@@ -30,7 +30,7 @@
 import logging
 log = logging.getLogger("Griffith")
 
-def upgrade_database(self, version):
+def upgrade_database(self, version, locations):
     """Create new db or update existing one to current format"""
     b = self.session.bind
     if version == 0:
@@ -134,10 +134,15 @@
                    'screenplay': 'ALTER TABLE movies ADD COLUMN screenplay VARCHAR(256) NULL;',
                    'cameraman' : 'ALTER TABLE movies ADD COLUMN cameraman VARCHAR(256) NULL;'}
         if e_type == 'mysql':
-            pass
+            queries = {'poster_md5': 'ALTER TABLE movies ADD COLUMN poster_md5 VARCHAR(32) NULL REFERENCES posters(md5sum);',
+                       'ratio_id'  : 'ALTER TABLE movies ADD COLUMN ratio_id INTEGER NOT NULL DEFAULT 1 REFERENCES ratios(ratio_id);',
+                       'screenplay': 'ALTER TABLE movies ADD COLUMN screenplay VARCHAR(256) NULL;',
+                       'cameraman' : 'ALTER TABLE movies ADD COLUMN cameraman VARCHAR(256) NULL;'}
         elif e_type == 'mssql':
-            #queries['ratio_id'] = "FIXME"
-            pass
+            queries = {'poster_md5': 'ALTER TABLE movies ADD poster_md5 VARCHAR(32) NULL REFERENCES posters(md5sum);',
+                       'ratio_id'  : 'ALTER TABLE movies ADD ratio_id INTEGER NOT NULL REFERENCES ratios(ratio_id) DEFAULT 1;',
+                       'screenplay': 'ALTER TABLE movies ADD screenplay VARCHAR(256) NULL;',
+                       'cameraman' : 'ALTER TABLE movies ADD cameraman VARCHAR(256) NULL;'}
         for key, query in queries.items():
             try:
                 self.session.bind.execute(query)
@@ -147,7 +152,7 @@
         
         log.info("... saving posters in database")
         for movie in self.session.query(db.Movie).all():
-            poster_file_name = os.path.join(self.data_dir, self.config.get("poster", "posters"), "%s.jpg" % movie.image)
+            poster_file_name = os.path.join(locations['posters'], "%s.jpg" % movie.image)
             if os.path.isfile(poster_file_name):
                 poster_md5  = gutils.md5sum(file(poster_file_name, 'rb'))
                 poster = self.session.query(db.Poster).filter_by(md5sum=poster_md5).first()

Modified: trunk/lib/sql.py
===================================================================
--- trunk/lib/sql.py	2008-11-01 22:09:44 UTC (rev 1024)
+++ trunk/lib/sql.py	2008-11-01 22:13:44 UTC (rev 1025)
@@ -39,7 +39,7 @@
 class GriffithSQL:
     version = 3    # database format version, increase after changing data structures
 
-    def __init__(self, config, griffith_dir, reconnect=True):
+    def __init__(self, config, griffith_dir, locations, reconnect=True):
         #mapper = Session.mapper
         self.config = config
         self.data_dir = griffith_dir
@@ -147,7 +147,7 @@
             v = int(v.value)
         if v < self.version:
             from dbupgrade import upgrade_database
-            if not upgrade_database(self, v):
+            if not upgrade_database(self, v, locations):
                 import sys
                 sys.exit(1)
 



From mikej06 at mail.berlios.de  Mon Nov  3 22:18:54 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Mon, 3 Nov 2008 22:18:54 +0100
Subject: [Griffith-svn] r1026 - in trunk: . lib
Message-ID: <200811032118.mA3LIs8g005225@sheep.berlios.de>

Author: mikej06
Date: 2008-11-03 22:18:35 +0100 (Mon, 03 Nov 2008)
New Revision: 1026

Modified:
   trunk/griffith
   trunk/lib/backup.py
   trunk/lib/dbupgrade.py
   trunk/lib/preferences.py
Log:
* common sql syntax for upgrading statements
* fixed some missing arguments and locations issues

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-01 22:13:44 UTC (rev 1025)
+++ trunk/griffith	2008-11-03 21:18:35 UTC (rev 1026)
@@ -1288,7 +1288,7 @@
                 treeview.set_cursor_on_cell(0)
 
 if __name__ == "__main__":
-    developer = True # TODO: get from config
+    developer = False # TODO: get from config
     if not developer and '~' in version.pversion or '-' in version.pversion:
         response = gutils.question(_("""This is development version of Griffith.
 We're not providing upgrade path from dev. versions.

Modified: trunk/lib/backup.py
===================================================================
--- trunk/lib/backup.py	2008-11-01 22:13:44 UTC (rev 1025)
+++ trunk/lib/backup.py	2008-11-03 21:18:35 UTC (rev 1026)
@@ -168,7 +168,7 @@
                 import sys
                 sys.exit(4)
 
-        self.db = sql.GriffithSQL(self.config, self.locations['home'])
+        self.db = sql.GriffithSQL(self.config, self.locations['home'], self.locations)
         from initialize import dictionaries, people_treeview
         dictionaries(self)
         people_treeview(self)
@@ -225,7 +225,7 @@
         tmp_dir, tmp_file = os.path.split(filename)
         self.config.get('file', tmp_file, section='database') 
 
-        tmp_db = sql.GriffithSQL(tmp_config, tmp_dir)
+        tmp_db = sql.GriffithSQL(tmp_config, tmp_dir, self.locations)
 
         merged=0
         movies = tmp_db.Movie.count()

Modified: trunk/lib/dbupgrade.py
===================================================================
--- trunk/lib/dbupgrade.py	2008-11-01 22:13:44 UTC (rev 1025)
+++ trunk/lib/dbupgrade.py	2008-11-03 21:18:35 UTC (rev 1026)
@@ -33,7 +33,8 @@
 def upgrade_database(self, version, locations):
     """Create new db or update existing one to current format"""
     b = self.session.bind
-    if version == 0:
+    if version == 0 or version is None:
+        # version is 0 or none only for new databases
         db.metadata.create_all(b)
         db.configuration_table.insert(bind=b).execute(param=u'version', value=self.version)
         db.media_table.insert(bind=b).execute(name=u'DVD')
@@ -106,6 +107,10 @@
         db.languages_table.insert(bind=b).execute(name=_('Turkish'))
         db.tags_table.insert(bind=b).execute(name=_('Favourite'))
         return True # upgrade process finished
+    #
+    # next steps are only for existing databases with an outdated structure
+    # not for new created databases
+    #
     if version == 1: # fix changes between v1 and v2
         version += 1
         log.info("Upgrading database to version %d..." % version)
@@ -128,21 +133,16 @@
         db.ratios_table.insert(bind=b).execute(name=u'4:3')
 
         log.info("... adding new columns")
-        # SQLite, PostgreSQL
-        queries = {'poster_md5': 'ALTER TABLE movies ADD COLUMN poster_md5 VARCHAR(32) NULL REFERENCES posters(md5sum);',
-                   'ratio_id'  : 'ALTER TABLE movies ADD COLUMN ratio_id INTEGER NOT NULL REFERENCES ratios(ratio_id) DEFAULT 1;',
-                   'screenplay': 'ALTER TABLE movies ADD COLUMN screenplay VARCHAR(256) NULL;',
-                   'cameraman' : 'ALTER TABLE movies ADD COLUMN cameraman VARCHAR(256) NULL;'}
+        # common SQL statements
+        queries = {'poster_md5': 'ALTER TABLE movies ADD poster_md5 VARCHAR(32) NULL REFERENCES posters(md5sum);',
+                   'ratio_id'  : 'ALTER TABLE movies ADD ratio_id INTEGER NOT NULL DEFAULT 1 REFERENCES ratios(ratio_id);',
+                   'screenplay': 'ALTER TABLE movies ADD screenplay VARCHAR(256) NULL;',
+                   'cameraman' : 'ALTER TABLE movies ADD cameraman VARCHAR(256) NULL;'}
+        # if needed some db specific SQL statements
         if e_type == 'mysql':
-            queries = {'poster_md5': 'ALTER TABLE movies ADD COLUMN poster_md5 VARCHAR(32) NULL REFERENCES posters(md5sum);',
-                       'ratio_id'  : 'ALTER TABLE movies ADD COLUMN ratio_id INTEGER NOT NULL DEFAULT 1 REFERENCES ratios(ratio_id);',
-                       'screenplay': 'ALTER TABLE movies ADD COLUMN screenplay VARCHAR(256) NULL;',
-                       'cameraman' : 'ALTER TABLE movies ADD COLUMN cameraman VARCHAR(256) NULL;'}
+            pass
         elif e_type == 'mssql':
-            queries = {'poster_md5': 'ALTER TABLE movies ADD poster_md5 VARCHAR(32) NULL REFERENCES posters(md5sum);',
-                       'ratio_id'  : 'ALTER TABLE movies ADD ratio_id INTEGER NOT NULL REFERENCES ratios(ratio_id) DEFAULT 1;',
-                       'screenplay': 'ALTER TABLE movies ADD screenplay VARCHAR(256) NULL;',
-                       'cameraman' : 'ALTER TABLE movies ADD cameraman VARCHAR(256) NULL;'}
+            pass
         for key, query in queries.items():
             try:
                 self.session.bind.execute(query)
@@ -287,7 +287,7 @@
     self.config.set('region', 0, section='defaults')
     self.config.set('vcodec', 0, section='defaults')
     self.locations['posters'] = os.path.join(self.locations['home'], 'posters')
-    new_db = GriffithSQL(self.config, self.locations['home'])
+    new_db = GriffithSQL(self.config, self.locations['home'], self.locations)
 
     # collections
     collection_mapper = {'':None, u'':None, 0:None, '0':None, -1:None, '-1':None}

Modified: trunk/lib/preferences.py
===================================================================
--- trunk/lib/preferences.py	2008-11-01 22:13:44 UTC (rev 1025)
+++ trunk/lib/preferences.py	2008-11-03 21:18:35 UTC (rev 1026)
@@ -434,12 +434,14 @@
         # new database connection
         self.initialized = False
         try:
-            self.db = sql.GriffithSQL(c, self.locations['home'])
+            c['posters'] = None # force update
+            location_posters(self.locations, self.config)
+            self.db = sql.GriffithSQL(c, self.locations['home'], self.locations)
         except InvalidRequestError, e:
             log.error(str(e))
             c.set('type', 'sqlite', section='database')
             w['db_type'].set_active(0)
-            self.db = sql.GriffithSQL(c, self.locations['home'])
+            self.db = sql.GriffithSQL(c, self.locations['home'], self.locations)
 
         log.info("New database Engine: %s" % self.db.session.bind.engine.name)
         



From piotrek at mail.berlios.de  Sat Nov  8 20:13:32 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sat, 8 Nov 2008 20:13:32 +0100
Subject: [Griffith-svn] r1027 - in trunk: . lib
Message-ID: <200811081913.mA8JDWKW016060@sheep.berlios.de>

Author: piotrek
Date: 2008-11-08 20:13:31 +0100 (Sat, 08 Nov 2008)
New Revision: 1027

Modified:
   trunk/griffith
   trunk/lib/gutils.py
Log:
* fix volume/colection add/rename/remove functions
* catch db module import's exceptions (get_dependencies will now work without sqlalchemy installed)


Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-03 21:18:35 UTC (rev 1026)
+++ trunk/griffith	2008-11-08 19:13:31 UTC (rev 1027)
@@ -409,53 +409,95 @@
             self._selected_volume = self.volume_combo_ids[widget.get_active()]
 
     def add_volume(self, widget):
+        session = self.db.Session()
         name = self.widgets['add']['volume'].get_active_text().decode('utf-8')
-        vol = db.Volume()
-        vol.name = name
-        if vol and vol.add_to_db():
+        vol = db.Volume(name=name)
+        session.add(vol)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add volume: %s", e.message)
+        else:
             update.update_volume_combo_ids(self)
             initialize.fill_volumes_combo(self, id)
 
     def add_collection(self, widget):
+        session = self.db.Session()
         name = self.widgets['add']['collection'].get_active_text().decode('utf-8')
-        col = db.Collection()
-        col.name = name
-        if col and col.add_to_db():
+        col = db.Collection(name=name)
+        session.add(col)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add collection: %s", e.message)
+        else:
             update.update_collection_combo_ids(self)
             initialize.fill_collections_combo(self, id)
 
     def remove_volume(self, widget):
+        session = self.db.Session()
         vol_id = self._selected_volume
-        vol = self.db.session.query(db.Volume).filter_by(volume_id=vol_id).first()
-        if vol and vol.remove_from_db():
-            update.update_volume_combo_ids(self)
-            initialize.fill_volumes_combo(self, id)
+        vol = session.query(db.Volume).filter_by(volume_id=vol_id).first()
+        if vol:
+            session.remove(vol)
+            try:
+                session.commi()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot remove volume: %s", e.message)
+            else:
+                update.update_volume_combo_ids(self)
+                initialize.fill_volumes_combo(self, id)
 
     def remove_collection(self, widget):
+        session = self.db.Session()
         col_id = self._selected_collection
-        col = self.db.session.query(db.Collection).filter_by(collection_id=col_id).first()
-        if col and col.remove_from_db():
-            update.update_collection_combo_ids(self)
-            initialize.fill_collections_combo(self, id)
+        col = session.query(db.Collection).filter_by(collection_id=col_id).first()
+        if col:
+            session.remove(col)
+            try:
+                session.commi()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot remove collection: %s", e.message)
+            else:
+                update.update_collection_combo_ids(self)
+                initialize.fill_collections_combo(self, id)
 
     def rename_volume(self, widget):
+        session = self.db.Session()
         vol_id = self._selected_volume
         if vol_id != 0:
             new_name = self.widgets['add']['volume'].get_active_text().decode('utf-8')
-            vol = self.db.session.query(db.Volume).filter_by(volume_id=vol_id).first()
+            vol = session.query(db.Volume).filter_by(volume_id=vol_id).first()
             if vol:
                 vol.name=new_name
-                if vol.update_in_db():
+                session.add(vol)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot rename volume: %s", e.message)
+                else:
                     initialize.fill_volumes_combo(self, default=vol_id)
 
     def rename_collection(self, widget):
+        session = self.db.Session()
         col_id = self.e_selected_collection
         if col_id != 0:
             new_name = self.widgets['add']['collection'].get_active_text().decode('utf-8')
-            col = self.db.session.query(db.Collection).filter_by(collection_id=col_id).first()
-            if col is not None:
+            col = session.query(db.Collection).filter_by(collection_id=col_id).first()
+            if col:
                 col.name=new_name
-                if col.update_in_db():
+                session.add(col)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot rename collection: %s", e.message)
+                else:
                     initialize.fill_collections_combo(self, default=col_id)
 
     def show_volume(self, widget):

Modified: trunk/lib/gutils.py
===================================================================
--- trunk/lib/gutils.py	2008-11-03 21:18:35 UTC (rev 1026)
+++ trunk/lib/gutils.py	2008-11-08 19:13:31 UTC (rev 1027)
@@ -29,6 +29,7 @@
 try:
     import gtk
     import gobject
+    import db
 except:
     pass
 import htmlentitydefs
@@ -36,7 +37,6 @@
 import webbrowser
 import logging
 log = logging.getLogger("Griffith")
-import db
 
 url_re = re.compile('^\w+://')
 entity = re.compile(r'\&.\w*?\;')
@@ -415,10 +415,10 @@
         version = False
     depend.append({'module': 'sqlalchemy',
         'version'    : version,
-        'module_req' : '0.5rc1',
+        'module_req' : '0.5rc3',
         'url'        : 'http://www.sqlalchemy.org/',
         'debian'     : 'python-sqlalchemy',
-        'debian_req' : '0.5~rc1'
+        'debian_req' : '0.5~rc3'
     })
     try:
         import sqlite3



From piotrek at mail.berlios.de  Sun Nov  9 12:45:56 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 9 Nov 2008 12:45:56 +0100
Subject: [Griffith-svn] r1028 - in trunk: . lib
Message-ID: <200811091145.mA9BjuxJ008980@sheep.berlios.de>

Author: piotrek
Date: 2008-11-09 12:45:54 +0100 (Sun, 09 Nov 2008)
New Revision: 1028

Modified:
   trunk/NEWS
   trunk/README
   trunk/TODO
   trunk/griffith
   trunk/lib/add.py
   trunk/lib/gutils.py
   trunk/lib/initialize.py
Log:
* update docs (0.10-beta1; new req.)
* remove spaces from empty volume/collection name in add window


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2008-11-08 19:13:31 UTC (rev 1027)
+++ trunk/NEWS	2008-11-09 11:45:54 UTC (rev 1028)
@@ -1,3 +1,14 @@
+Griffith 0.10-beta1
+===================
+* Filter movies using complex search criteria functionality
+* Posters stored in database (+local cache)
+* Unicode used internally (less problems with encodings)
+
+Note to package maintainers:
+Please note that Griffith requires Python >=2.5 and SQLAlchemy >= 0.5 now
+(see `./griffith --check-dep` or `./griffith --show-dep`)
+
+
 Griffith 0.9.7.1
 ================
 * Fixed crash when database (rating/year/runtime fields) contains empty data

Modified: trunk/README
===================================================================
--- trunk/README	2008-11-08 19:13:31 UTC (rev 1027)
+++ trunk/README	2008-11-09 11:45:54 UTC (rev 1028)
@@ -29,7 +29,7 @@
 
   Name			Minimum version		URL						NOTE
   ----			---------------		---						----
-  * Python		2.4 or higher		http://www.python.org/
+  * Python		2.5 or higher		http://www.python.org/
   * GTK+		tested on 2.6.4		http://www.gtk.org/
   * PyGTK (with glade2)	tested on 2.6.1		http://www.pygtk.org/
   * SQLAlchemy		0.5			http://www.sqlalchemy.org/

Modified: trunk/TODO
===================================================================
--- trunk/TODO	2008-11-08 19:13:31 UTC (rev 1027)
+++ trunk/TODO	2008-11-09 11:45:54 UTC (rev 1028)
@@ -1,16 +1,13 @@
-next version
-============
-* Advanced sort/filter criteria
+near future
+===========
 * Export plugin system rewrite, new templates format (mako? jinja?)
 * Impor/export plugins for Excel files (.xls) (pyExcelerator?)
 * Customising main list view
 * New fields:
   + location of the DVD (room/box/case/etc) - will replace "Number" field
-  + screenplay
-  + aspect ratio
 
-near future
-===========
+future
+======
 * More import plugins
 * Nice PDF tabular report
 * Detecting audio/video parameters from file (mmpython?)

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-08 19:13:31 UTC (rev 1027)
+++ trunk/griffith	2008-11-09 11:45:54 UTC (rev 1028)
@@ -70,7 +70,7 @@
 import update
 import version
 
-class Griffith:
+class Griffith(object):
     """The main application class"""
 
     Image = gtk.Image()
@@ -79,7 +79,7 @@
     lang = {}
 
     def __init__(self):
-        """main griffith application constructor"""    
+        """main griffith application constructor"""
 
         gconsole.check_args(self)
         initialize.locations(self)
@@ -264,9 +264,9 @@
         if active == 0:
             # change port number if it is something useful at the moment; for clearness
             if self.widgets['preferences']['db_port'].get_value() == 0 or \
-                self.widgets['preferences']['db_port'].get_value() == 3306 or \
-                self.widgets['preferences']['db_port'].get_value() == 5432 or \
-                self.widgets['preferences']['db_port'].get_value() == 1433:
+               self.widgets['preferences']['db_port'].get_value() == 3306 or \
+               self.widgets['preferences']['db_port'].get_value() == 5432 or \
+               self.widgets['preferences']['db_port'].get_value() == 1433:
                 self.widgets['preferences']['db_port'].set_value(0)
             self.widgets['preferences']['db_passwd'].set_sensitive(False)
             self.widgets['preferences']['db_user'].set_sensitive(False)
@@ -275,8 +275,8 @@
         elif active == 1:
             # change port number IF previous one was MySQL's or MSSQL one
             if self.widgets['preferences']['db_port'].get_value() == 0 or \
-                self.widgets['preferences']['db_port'].get_value() == 3306 or \
-                self.widgets['preferences']['db_port'].get_value() == 1433:
+               self.widgets['preferences']['db_port'].get_value() == 3306 or \
+               self.widgets['preferences']['db_port'].get_value() == 1433:
                 self.widgets['preferences']['db_port'].set_value(5432)
             self.widgets['preferences']['db_passwd'].set_sensitive(True)
             self.widgets['preferences']['db_user'].set_sensitive(True)
@@ -285,8 +285,8 @@
         elif active == 2:
             # change port number IF previous one was PostgreSQL's or MSSQL one
             if self.widgets['preferences']['db_port'].get_value() == 0 or \
-                self.widgets['preferences']['db_port'].get_value() == 5432 or \
-                self.widgets['preferences']['db_port'].get_value() == 1433:
+               self.widgets['preferences']['db_port'].get_value() == 5432 or \
+               self.widgets['preferences']['db_port'].get_value() == 1433:
                 self.widgets['preferences']['db_port'].set_value(3306)
             self.widgets['preferences']['db_passwd'].set_sensitive(True)
             self.widgets['preferences']['db_user'].set_sensitive(True)
@@ -295,8 +295,8 @@
         elif active == 3:
             # change port number IF previous one was PostgreSQL's or MySQL one
             if self.widgets['preferences']['db_port'].get_value() == 0 or \
-                self.widgets['preferences']['db_port'].get_value() == 5432 or \
-                self.widgets['preferences']['db_port'].get_value() == 3306:
+               self.widgets['preferences']['db_port'].get_value() == 5432 or \
+               self.widgets['preferences']['db_port'].get_value() == 3306:
                 self.widgets['preferences']['db_port'].set_value(1433)
             self.widgets['preferences']['db_passwd'].set_sensitive(True)
             self.widgets['preferences']['db_user'].set_sensitive(True)
@@ -1256,7 +1256,7 @@
             self.delete_movie()
 
     def on_p_tree_button_press_event(self, widget, event):
-        """add a double click event to people tree"""                
+        """add a double click event to people tree"""
         if event.type == gtk.gdk._2BUTTON_PRESS:
             from people import edit_person
             edit_person(self)

Modified: trunk/lib/add.py
===================================================================
--- trunk/lib/add.py	2008-11-08 19:13:31 UTC (rev 1027)
+++ trunk/lib/add.py	2008-11-09 11:45:54 UTC (rev 1028)
@@ -82,7 +82,7 @@
     if details['image'] and old_poster_md5 != details['image']: # details["image"] can contain MD5 or file path
         new_image_path = os.path.join(self.locations['temp'], "poster_%s.jpg" % details['image'])
         if not os.path.isfile(new_image_path):
-            log.warn("cannot read temporary file: %s" % new_image_path)
+            log.warn("cannot read temporary file: %s", new_image_path)
         else:
             new_poster_md5 = gutils.md5sum(file(new_image_path, 'rb'))
             details["poster_md5"] = new_poster_md5
@@ -163,7 +163,7 @@
     w = self.widgets['add']
     m_id = None
     if self.founded_results_id:
-        log.info("self.founded:results_id: %s" % self.founded_results_id)
+        log.info("self.founded:results_id: %s", self.founded_results_id)
         m_id = self.founded_results_id
     else:
         self.founded_results_id = 0
@@ -396,7 +396,6 @@
                 return i[0]
         return None
     # languages
-    from sets import Set as set # for python2.3 compatibility
     t_movies['languages'] = set()
     for row in self.lang['model']:
         lang_id   = get_id(self.lang['lang'], row[0])
@@ -588,7 +587,7 @@
             else: w['image'].set_text(item['image'])
         else:
             image_path = os.path.join(self.locations['posters'], "m_%s.jpg" % item['image'])
-            log.warn("TODO: image=%s" % item['image'])
+            log.warn("TODO: image=%s", item['image'])
     else:
         w['image'].set_text('')
         image_path = os.path.join(self.locations['images'], 'default.png')
@@ -663,9 +662,9 @@
             try:
                 os.remove(tmp_image_path)
             except Exception, e:
-                log.warn("cannot remove temporary file %s" % tmp_image_path)
+                log.warn("cannot remove temporary file %s", tmp_image_path)
         else:
-            log.warn("cannot read temporary file: %s" % tmp_image_path)
+            log.warn("cannot read temporary file: %s", tmp_image_path)
 
 
     movie = update_movie_instance(None, details, self.db.session)
@@ -728,7 +727,7 @@
     movie = self.db.session.query(db.Movie).filter_by(number=number).first()
 
     if movie is None:
-        log.warn("cannot clone movie: Movie(%s) not found" % number)
+        log.warn("cannot clone movie: Movie(%s) not found", number)
         return False
 
     next_number = gutils.find_next_available(self.db)
@@ -834,9 +833,9 @@
     except IntegrityError, e:
         session.rollback()
         gutils.warning(self, str(e.orig))
-        log.warn("Cannot commit movie: %s" % e.message)
+        log.warn("Cannot commit movie: %s", e.message)
         return False
     except Exception, e:
-        log.error("Unexpected problem: %s" % e)
+        log.error("Unexpected problem: %s", e)
         return False
     return True

Modified: trunk/lib/gutils.py
===================================================================
--- trunk/lib/gutils.py	2008-11-08 19:13:31 UTC (rev 1027)
+++ trunk/lib/gutils.py	2008-11-09 11:45:54 UTC (rev 1028)
@@ -367,13 +367,13 @@
     depend = []
 
     # Python version
-    if sys.version_info[:2] < (2, 4):
+    if sys.version_info[:2] < (2, 5):
         depend.append({'module': 'python',
             'version'    : '-'+'.'.join(map(str,sys.version_info)),
-            'module_req' : '2.4',
+            'module_req' : '2.5',
             'url'        : 'http://www.python.org/',
             'debian'     : 'python',
-            'debian_req' : '2.4'
+            'debian_req' : '2.5'
             # TODO: 'fedora', 'suse', etc.
         })
 
@@ -588,10 +588,10 @@
 def create_image_cache(md5sum, gsql):
     poster = gsql.session.query(db.Poster).filter_by(md5sum=md5sum).first()
     if not poster:
-        log.warn("poster not available: %s" % md5sum)
+        log.warn("poster not available: %s", md5sum)
         return False
     if not poster.data:
-        log.warn("poster data not available: %s" % md5sum)
+        log.warn("poster data not available: %s", md5sum)
         return False
     
     fn_big    = os.path.join(gsql.data_dir, 'posters', md5sum+'.jpg')

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2008-11-08 19:13:31 UTC (rev 1027)
+++ trunk/lib/initialize.py	2008-11-09 11:45:54 UTC (rev 1028)
@@ -728,8 +728,8 @@
             name = self.db.session.query(db.Volume).filter_by(volume_id=vol_id).first().name
         else:
             name = ''
+        self.widgets['add']['volume'].insert_text(int(i), str(name))
         # add some white spaces to prevent scrollbar hides parts of the names    
-        self.widgets['add']['volume'].insert_text(int(i), str(name) + '   ')
         self.widgets['filter']['volume'].insert_text(int(i), str(name) + '   ')
     self.initialized = _tmp
     self.widgets['add']['volume'].show_all()
@@ -751,8 +751,8 @@
             name = self.db.session.query(db.Collection).filter_by(collection_id=col_id).first().name
         else:
             name = ''
+        self.widgets['add']['collection'].insert_text(int(i), str(name))
         # add some white spaces to prevent scrollbar hides parts of the names    
-        self.widgets['add']['collection'].insert_text(int(i), str(name) + '   ')
         self.widgets['filter']['collection'].insert_text(int(i), str(name) + '   ')
     self.initialized = _tmp
     self.widgets['add']['collection'].show_all()



From mikej06 at mail.berlios.de  Mon Nov 10 17:59:16 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Mon, 10 Nov 2008 17:59:16 +0100
Subject: [Griffith-svn] r1029 - branches/0.9.x branches/0.9.x/lib
	branches/0.9.x/lib/plugins/movie trunk trunk/lib/plugins/movie
Message-ID: <200811101659.mAAGxGEM012639@sheep.berlios.de>

Author: mikej06
Date: 2008-11-10 17:58:54 +0100 (Mon, 10 Nov 2008)
New Revision: 1029

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/gdebug.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
   branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
   trunk/ChangeLog
   trunk/lib/plugins/movie/PluginMovieAmazon.py
   trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   trunk/lib/plugins/movie/PluginMovieIMDB-de.py
   trunk/lib/plugins/movie/PluginMovieKinoDe.py
Log:
* updated plugins IMDB, IMDB-de, Amazon, Kino.de, FilmeVonAZ
* fixed little problem with gdebug (only in 0.9 branch)

Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-09 11:45:54 UTC (rev 1028)
+++ branches/0.9.x/ChangeLog	2008-11-10 16:58:54 UTC (rev 1029)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-10  Michael Jahn
+	* updated plugins IMDB-de, Amazon, Kino.de, FilmeVonAZ
+
 2008-11-01  Michael Jahn
 	* updated IMDB plugin
 

Modified: branches/0.9.x/lib/gdebug.py
===================================================================
--- branches/0.9.x/lib/gdebug.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ branches/0.9.x/lib/gdebug.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -86,8 +86,9 @@
 	def close(self):
 		self.dialog.destroy()
 	def add(self, txt):
-		buffer = self.textview.get_buffer()
-		buffer.insert(buffer.get_end_iter(), txt, -1)
+		if txt is not None:
+			buffer = self.textview.get_buffer()
+			buffer.insert(buffer.get_end_iter(), txt, -1)
 
 #
 # used on windows system

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -369,7 +369,7 @@
 	test_configuration = {
 		'Rocky Balboa'			: [ 10, 10 ],
 		'Arahan'				: [ 6, 6 ],
-		'Ein gl?ckliches Jahr'	: [ 1, 1 ]
+		'Ein gl?ckliches Jahr'	: [ 2, 2 ]
 	}
 
 class PluginTest:

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -80,7 +80,7 @@
 					self.delimiter = ", "
 
 	def get_cast(self):
-		self.cast = self.regextrim(self.page, '[(]Darsteller[)]', '<[pP]>')
+		self.cast = self.regextrim(self.page, '[(]Darsteller[)]', '(<[pP]>|<br><span[^>]+>)')
 		self.cast = gutils.clean(self.cast)
 		self.cast = self.cast.replace(' als ', _(' as '))
 		self.cast = re.sub('( \t|\t|\r|\n)', '', self.cast)

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -65,7 +65,7 @@
 
 	def get_title(self):
 		self.title = gutils.trim(self.page, '<h1>', '<span')
-		elements = string.split(gutils.trim(self.page, '<h5>Alternativ:', '</div>'), '<i class="transl"')
+		elements = string.split(self.regextrim(self.page, '<h5>(Alternativ|Auch bekannt als):', '</div>'), '<i class="transl"')
 		if len(elements) > 1:
 			for element in elements:
 				tmp = gutils.before(gutils.trim(element, '>', '[de]'), '(')

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -51,12 +51,12 @@
 			self.image_url = gutils.trim(self.page[tmp:], 'src="', '"')
 
 	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '<h1>', ' <span')
+		self.o_title = self.regextrim(self.page, '<h1>', '([ ]|[&][#][0-9]+[;])<span')
 		if self.o_title == '':
 			self.o_title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 
 	def get_title(self):	# same as get_o_title()
-		self.title = gutils.trim(self.page, '<h1>', ' <span')
+		self.title = self.regextrim(self.page, '<h1>', '([ ]|[&][#][0-9]+[;])<span')
 		if self.title == '':
 			self.title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 
@@ -171,6 +171,19 @@
 			data = data[:tmp] + '>'
 		return data
 
+	def regextrim(self,text,key1,key2):
+		obj = re.search(key1, text)
+		if obj is None:
+			return ''
+		else:
+			p1 = obj.end()
+		obj = re.search(key2, text[p1:])
+		if obj is None:
+			return ''
+		else:
+			p2 = p1 + obj.start()
+		return text[p1:p2]
+
 class SearchPlugin(movie.SearchMovie):
 	PATTERN = re.compile(r"""<A HREF=['"]/title/tt([0-9]+)/["']>(.*?)</LI>""")
 	PATTERN2 = re.compile(r"""<a href=['"]/title/tt([0-9]+)/["']>(.*?)</td>""")

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -139,20 +139,23 @@
 				self.cast = gutils.after(self.cast, '>mehr<')
 			self.cast = gutils.after(self.cast, '>')
 			self.cast = re.sub('<tr[ ]+class="(dbtrefferlight|dbtrefferdark)">', "\n", self.cast)
-			self.cast = self.cast.replace("&nbsp;", "--flip--")
+			self.cast = self.cast.replace('&nbsp;', '--flip--')
 			self.cast = gutils.clean(self.cast)
+			self.cast = re.sub("[\t]+", '', self.cast)
+			self.cast = re.sub("[\n]+", "\n", self.cast)
+			self.cast = re.sub("--flip--[\n]+", '--flip--', self.cast)
 			elements = self.cast.split("\n")
 			self.cast = ''
 			for element in elements:
-				elements2 = element.split("--flip--")
+				elements2 = element.split('--flip--')
 				if len(elements2) > 1:
 					if elements2[0] <> '':
-						self.cast += elements2[1] + "--flip--" + elements2[0] + "\n"
+						self.cast += elements2[1] + '--flip--' + elements2[0] + "\n"
 					else:
 						self.cast += elements2[1] + "\n"
 				else:
-					self.cast = element
-			self.cast = string.replace(self.cast, "--flip--", _(" as "))
+					self.cast += element + "\n"
+			self.cast = string.replace(self.cast, '--flip--', _(' as '))
 
 	def get_classification(self):
 		self.classification = self.regextrim(self.tmp_page,'FSK:( |&nbsp;)+', '</strong>')
@@ -220,8 +223,8 @@
 class SearchPlugin(movie.SearchMovie):
 
 	def __init__(self):
-		self.original_url_search    = "http://www.kino.de/megasuche.php4?typ=filme&wort="
-		self.translated_url_search    = "http://www.kino.de/megasuche.php4?typ=filme&wort="
+		self.original_url_search   = 'http://www.kino.de/search.php?mode=megaSearch&searchCategory=film&inputSearch='
+		self.translated_url_search = 'http://www.kino.de/search.php?mode=megaSearch&searchCategory=film&inputSearch='
 #		self.encode='utf-8'
 		self.encode='iso-8859-1'
 
@@ -231,7 +234,7 @@
 		#
 		# try to get all result pages (not so nice, but it works)
 		#
-		tmp_pagecount = gutils.trim(tmp_pagemovie, "&nbsp;von ", "</SPAN>")
+		tmp_pagecount = gutils.trim(tmp_pagemovie, '>von', '</a>')
 		try:
 			tmp_pagecountint = int(tmp_pagecount)
 		except:
@@ -239,19 +242,19 @@
 		tmp_pagecountintcurrent = 1
 		while (tmp_pagecountint > tmp_pagecountintcurrent and tmp_pagecountintcurrent < 5):
 			tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-			self.url = "http://www.kino.de/megasuche.php4?typ=filme&page=" + str(tmp_pagecountintcurrent) + "&wort="
+			self.url = 'http://www.kino.de/search.php?mode=megaSearch&searchCategory=film&page=' + str(tmp_pagecountintcurrent) + "&inputSearch="
 			self.open_search(parent_window)
 			tmp_pagemovie = tmp_pagemovie + self.page
 		#
 		# Look for DVD and VHS
 		#
-		self.url = "http://www.kino.de/megasuche.php4?typ=video&wort="
+		self.url = "http://www.kino.de/search.php?mode=megaSearch&searchCategory=video&inputSearch="
 		self.open_search(parent_window)
 		tmp_pagevideo = tmp_pagemovie + self.page
 		#
 		# try to get all result pages (not so nice, but it works)
 		#
-		tmp_pagecount = gutils.trim(self.page, "&nbsp;von ", "</SPAN>")
+		tmp_pagecount = gutils.trim(self.page, '>von', '</a>')
 		try:
 			tmp_pagecountint = int(tmp_pagecount)
 		except:
@@ -259,7 +262,7 @@
 		tmp_pagecountintcurrent = 1
 		while (tmp_pagecountint > tmp_pagecountintcurrent and tmp_pagecountintcurrent < 5):
 			tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-			self.url = "http://www.kino.de/megasuche.php4?typ=video&page=" + str(tmp_pagecountintcurrent) + "&wort="
+			self.url = "http://www.kino.de/search.php?mode=megaSearch&searchCategory=video&page=" + str(tmp_pagecountintcurrent) + "&inputSearch="
 			self.open_search(parent_window)
 			tmp_pagevideo = tmp_pagevideo + self.page
 

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-09 11:45:54 UTC (rev 1028)
+++ trunk/ChangeLog	2008-11-10 16:58:54 UTC (rev 1029)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-10  Michael Jahn
+	* updated plugins IMDB-de, Amazon, Kino.de, FilmeVonAZ
+
 2008-11-01  Michael Jahn
 	* updated IMDB plugin
 

Modified: trunk/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -367,9 +367,9 @@
     # dict { movie_id -> [ expected result count for original url, expected result count for translated url ] }
     #
     test_configuration = {
-        'Rocky Balboa'            : [ 10, 10 ],
+        'Rocky Balboa'          : [ 10, 10 ],
         'Arahan'                : [ 6, 6 ],
-        'Ein gl?ckliches Jahr'    : [ 1, 1 ]
+        'Ein gl?ckliches Jahr'  : [ 2, 2 ]
     }
 
 class PluginTest:

Modified: trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -81,7 +81,7 @@
                     self.delimiter = ", "
 
     def get_cast(self):
-        self.cast = self.regextrim(self.page, '[(]Darsteller[)]', '<[pP]>')
+        self.cast = self.regextrim(self.page, '[(]Darsteller[)]', '(<[pP]>|<br><span[^>]+>)')
         self.cast = gutils.clean(self.cast)
         self.cast = self.cast.replace(' als ', _(' as '))
         self.cast = re.sub('( \t|\t|\r|\n)', '', self.cast)

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -66,7 +66,7 @@
 
     def get_title(self):
         self.title = gutils.trim(self.page, '<h1>', '<span')
-        elements = string.split(gutils.trim(self.page, '<h5>Alternativ:', '</div>'), '<i class="transl"')
+        elements = string.split(self.regextrim(self.page, '<h5>(Alternativ|Auch bekannt als):', '</div>'), '<i class="transl"')
         if len(elements) > 1:
             for element in elements:
                 tmp = gutils.before(gutils.trim(element, '>', '[de]'), '(')

Modified: trunk/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-09 11:45:54 UTC (rev 1028)
+++ trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-10 16:58:54 UTC (rev 1029)
@@ -140,20 +140,23 @@
                 self.cast = gutils.after(self.cast, '>mehr<')
             self.cast = gutils.after(self.cast, '>')
             self.cast = re.sub('<tr[ ]+class="(dbtrefferlight|dbtrefferdark)">', "\n", self.cast)
-            self.cast = self.cast.replace("&nbsp;", "--flip--")
+            self.cast = self.cast.replace('&nbsp;', '--flip--')
             self.cast = gutils.clean(self.cast)
+            self.cast = re.sub("[\t]+", '', self.cast)
+            self.cast = re.sub("[\n]+", "\n", self.cast)
+            self.cast = re.sub("--flip--[\n]+", '--flip--', self.cast)
             elements = self.cast.split("\n")
             self.cast = ''
             for element in elements:
-                elements2 = element.split("--flip--")
+                elements2 = element.split('--flip--')
                 if len(elements2) > 1:
                     if elements2[0] <> '':
-                        self.cast += elements2[1] + "--flip--" + elements2[0] + "\n"
+                        self.cast += elements2[1] + '--flip--' + elements2[0] + "\n"
                     else:
                         self.cast += elements2[1] + "\n"
                 else:
-                    self.cast = element
-            self.cast = string.replace(self.cast, "--flip--", _(" as ").encode('utf8'))
+                    self.cast += element + "\n"
+            self.cast = string.replace(self.cast, '--flip--', _(' as ').encode('utf8'))
 
     def get_classification(self):
         self.classification = self.regextrim(self.tmp_page,'FSK:( |&nbsp;)+', '</strong>')
@@ -221,8 +224,8 @@
 class SearchPlugin(movie.SearchMovie):
 
     def __init__(self):
-        self.original_url_search    = "http://www.kino.de/megasuche.php4?typ=filme&wort="
-        self.translated_url_search    = "http://www.kino.de/megasuche.php4?typ=filme&wort="
+        self.original_url_search   = 'http://www.kino.de/search.php?mode=megaSearch&searchCategory=film&inputSearch='
+        self.translated_url_search = 'http://www.kino.de/search.php?mode=megaSearch&searchCategory=film&inputSearch='
 #        self.encode='utf-8'
         self.encode='iso-8859-1'
 
@@ -232,7 +235,7 @@
         #
         # try to get all result pages (not so nice, but it works)
         #
-        tmp_pagecount = gutils.trim(tmp_pagemovie, "&nbsp;von ", "</SPAN>")
+        tmp_pagecount = gutils.trim(tmp_pagemovie, '>von', '</a>')
         try:
             tmp_pagecountint = int(tmp_pagecount)
         except:
@@ -240,19 +243,19 @@
         tmp_pagecountintcurrent = 1
         while (tmp_pagecountint > tmp_pagecountintcurrent and tmp_pagecountintcurrent < 5):
             tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-            self.url = "http://www.kino.de/megasuche.php4?typ=filme&page=" + str(tmp_pagecountintcurrent) + "&wort="
+            self.url = 'http://www.kino.de/search.php?mode=megaSearch&searchCategory=film&page=' + str(tmp_pagecountintcurrent) + "&inputSearch="
             self.open_search(parent_window)
             tmp_pagemovie = tmp_pagemovie + self.page
         #
         # Look for DVD and VHS
         #
-        self.url = "http://www.kino.de/megasuche.php4?typ=video&wort="
+        self.url = "http://www.kino.de/search.php?mode=megaSearch&searchCategory=video&inputSearch="
         self.open_search(parent_window)
         tmp_pagevideo = tmp_pagemovie + self.page
         #
         # try to get all result pages (not so nice, but it works)
         #
-        tmp_pagecount = gutils.trim(self.page, "&nbsp;von ", "</SPAN>")
+        tmp_pagecount = gutils.trim(self.page, '>von', '</a>')
         try:
             tmp_pagecountint = int(tmp_pagecount)
         except:
@@ -260,7 +263,7 @@
         tmp_pagecountintcurrent = 1
         while (tmp_pagecountint > tmp_pagecountintcurrent and tmp_pagecountintcurrent < 5):
             tmp_pagecountintcurrent = tmp_pagecountintcurrent + 1
-            self.url = "http://www.kino.de/megasuche.php4?typ=video&page=" + str(tmp_pagecountintcurrent) + "&wort="
+            self.url = "http://www.kino.de/search.php?mode=megaSearch&searchCategory=video&page=" + str(tmp_pagecountintcurrent) + "&inputSearch="
             self.open_search(parent_window)
             tmp_pagevideo = tmp_pagevideo + self.page
 



From mikej06 at mail.berlios.de  Mon Nov 10 21:51:15 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Mon, 10 Nov 2008 21:51:15 +0100
Subject: [Griffith-svn] r1030 - in trunk/lib: . plugins/movie
Message-ID: <200811102051.mAAKpF7Y032285@sheep.berlios.de>

Author: mikej06
Date: 2008-11-10 21:51:03 +0100 (Mon, 10 Nov 2008)
New Revision: 1030

Modified:
   trunk/lib/gutils.py
   trunk/lib/plugins/movie/PluginMovieDVDPalace.py
   trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   trunk/lib/plugins/movie/PluginMovieFilmtipset.py
   trunk/lib/plugins/movie/PluginMovieIMDB-de.py
   trunk/lib/plugins/movie/PluginMovieIMDB.py
   trunk/lib/plugins/movie/PluginMovieKinoDe.py
   trunk/lib/plugins/movie/PluginMovieOFDb.py
Log:
function regextrim moved from different movie plugins to gutils

Modified: trunk/lib/gutils.py
===================================================================
--- trunk/lib/gutils.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/gutils.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -94,6 +94,19 @@
         p2 = p1+p2
     return text[p1:p2]
 
+def regextrim(text,key1,key2):
+    obj = re.search(key1, text)
+    if obj is None:
+        return ''
+    else:
+        p1 = obj.end()
+    obj = re.search(key2, text[p1:])
+    if obj is None:
+        return ''
+    else:
+        p2 = p1 + obj.start()
+    return text[p1:p2]
+
 def after(text,key):
     p1 = string.find(text,key)
     return text[p1+len(key):]

Modified: trunk/lib/plugins/movie/PluginMovieDVDPalace.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -65,7 +65,7 @@
             re.sub(
                 '[?]', '-',
                 re.sub(
-                    '[\x93?]', '"', self.regextrim(self.page, 'showcover.php[^>]*>', '</td>'))))
+                    '[\x93?]', '"', gutils.regextrim(self.page, 'showcover.php[^>]*>', '</td>'))))
 
     def get_year(self):
         self.year = gutils.after(gutils.trim(gutils.trim(self.page, 'Originaltitel', '</TR>'), '(', ')'), ' ')
@@ -135,19 +135,6 @@
         )
         if (tmp_notes != ""):
             self.notes = self.notes + "Untertitel:" + tmp_notes + "\n\n"
-            
-    def regextrim(self,text,key1,key2):
-        obj = re.search(key1, text)
-        if obj is None:
-            return ''
-        else:
-            p1 = obj.end()
-        obj = re.search(key2, text[p1:])
-        if obj is None:
-            return ''
-        else:
-            p2 = p1 + obj.end()
-        return text[p1:p2]
 
 class SearchPlugin(movie.SearchMovie):
 
@@ -189,22 +176,10 @@
                         re.sub('[ \t\n][ \t\n]+', ' ',
                         string.replace(
                         string.replace(
-                            self.regextrim(element, '<div [^>]*>', '</div>'),
+                            gutils.regextrim(element, '<div [^>]*>', '</div>'),
                             '<br>', ' - '),
                             '&nbsp;', ''))
                         + ')'
                     )
                 )
-            
-    def regextrim(self,text,key1,key2):
-        obj = re.search(key1, text)
-        if obj is None:
-            return ''
-        else:
-            p1 = obj.end()
-        obj = re.search(key2, text[p1:])
-        if obj is None:
-            return ''
-        else:
-            p2 = p1 + obj.end()
-        return text[p1:p2]
+

Modified: trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -50,7 +50,7 @@
     def get_o_title(self):
         self.o_title = string.capwords(
             gutils.clean(gutils.after(
-            self.regextrim(self.page, '"[ \t]+class="text_ergebniss_titel"', '[ \t]+[(]Originaltitel[)]'), '</a>')))
+            gutils.regextrim(self.page, '"[ \t]+class="text_ergebniss_titel"', '[ \t]+[(]Originaltitel[)]'), '</a>')))
         if self.o_title == '':
             self.o_title = gutils.after(gutils.trim(self.page, 'sucheNach=titel', '</a>'), '>')
 
@@ -61,7 +61,7 @@
         self.director = gutils.after(gutils.trim(self.page, '(Regie)', '</a>'), '>')
 
     def get_plot(self):
-        self.plot = gutils.after(self.regextrim(self.page, '[(]Darsteller[)]', '</[pP]>'), '<p>')
+        self.plot = gutils.after(gutils.regextrim(self.page, '[(]Darsteller[)]', '</[pP]>'), '<p>')
 
     def get_year(self):
         self.year = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsjahr', '</a>'), '>')
@@ -81,7 +81,7 @@
                     self.delimiter = ", "
 
     def get_cast(self):
-        self.cast = self.regextrim(self.page, '[(]Darsteller[)]', '(<[pP]>|<br><span[^>]+>)')
+        self.cast = gutils.regextrim(self.page, '[(]Darsteller[)]', '(<[pP]>|<br><span[^>]+>)')
         self.cast = gutils.clean(self.cast)
         self.cast = self.cast.replace(' als ', _(' as '))
         self.cast = re.sub('( \t|\t|\r|\n)', '', self.cast)
@@ -89,7 +89,7 @@
         self.cast = self.cast.replace(',', '')
 
     def get_classification(self):
-        self.classification = self.regextrim(self.page, 'FSK:[ ]+', '[,;]')
+        self.classification = gutils.regextrim(self.page, 'FSK:[ ]+', '[,;]')
 
     def get_studio(self):
         self.studio = gutils.after(gutils.trim(self.page, 'sucheNach=produktionsfirma', '</a>'), '>')
@@ -108,19 +108,6 @@
 
     def get_rating(self):
         self.rating = 0
-        
-    def regextrim(self,text,key1,key2):
-        obj = re.search(key1, text)
-        if obj is None:
-            return ''
-        else:
-            p1 = obj.end()
-        obj = re.search(key2, text[p1:])
-        if obj is None:
-            return ''
-        else:
-            p2 = p1 + obj.start()
-        return text[p1:p2]
 
 class SearchPlugin(movie.SearchMovie):
     def __init__(self):

Modified: trunk/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -61,7 +61,7 @@
         self.director = gutils.trim(self.page, 'Regiss&ouml;r:', '</tr>')
 
     def get_plot(self):
-        self.plot = self.regextrim(self.page, '<h2>Om [^>]*[>]', '</tr>')
+        self.plot = gutils.regextrim(self.page, '<h2>Om [^>]*[>]', '</tr>')
 
     def get_year(self):
         self.year = gutils.trim(self.page, 'Utgivnings&aring;r:', '</tr>')
@@ -75,7 +75,7 @@
             self.genre = string.strip(gutils.trim(self.page, 'Genre:', '</tr>'))
 
     def get_cast(self):
-        self.cast = self.regextrim(self.page, 'Sk&aring;despelare [^:]*[:]', '</tr>')
+        self.cast = gutils.regextrim(self.page, 'Sk&aring;despelare [^:]*[:]', '</tr>')
         self.cast = string.replace(self.cast, ', ', '\n')
 
     def get_classification(self):
@@ -108,19 +108,6 @@
         if tmp != '':
             self.notes = self.notes + 'Alt. titel:' + string.strip(gutils.strip_tags(tmp))
 
-    def regextrim(self,text,key1,key2):
-        obj = re.search(key1, text)
-        if obj is None:
-            return ''
-        else:
-            p1 = obj.end()
-        obj = re.search(key2, text[p1:])
-        if obj is None:
-            return ''
-        else:
-            p2 = p1 + obj.start()
-        return text[p1:p2]
-
 class SearchPlugin(movie.SearchMovie):
 
     def __init__(self):

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -66,7 +66,7 @@
 
     def get_title(self):
         self.title = gutils.trim(self.page, '<h1>', '<span')
-        elements = string.split(self.regextrim(self.page, '<h5>(Alternativ|Auch bekannt als):', '</div>'), '<i class="transl"')
+        elements = string.split(gutils.regextrim(self.page, '<h5>(Alternativ|Auch bekannt als):', '</div>'), '<i class="transl"')
         if len(elements) > 1:
             for element in elements:
                 tmp = gutils.before(gutils.trim(element, '>', '[de]'), '(')
@@ -99,7 +99,7 @@
         self.year = gutils.after(self.year, '">')
 
     def get_runtime(self):
-        self.runtime = self.regextrim(self.page, '<h5>L[^n]+nge:</h5>', ' [Mm]in')
+        self.runtime = gutils.regextrim(self.page, '<h5>L[^n]+nge:</h5>', ' [Mm]in')
 
     def get_genre(self):
         self.genre = gutils.trim(self.page, '<h5>Genre:</h5>', '</div>')
@@ -194,19 +194,6 @@
             data = data[:tmp] + '>'
         return data
 
-    def regextrim(self,text,key1,key2):
-        obj = re.search(key1, text)
-        if obj is None:
-            return ''
-        else:
-            p1 = obj.end()
-        obj = re.search(key2, text[p1:])
-        if obj is None:
-            return ''
-        else:
-            p2 = p1 + obj.start()
-        return text[p1:p2]
-
 class SearchPlugin(movie.SearchMovie):
     PATTERN = re.compile(r"""<a href=['"]/title/tt([0-9]+)/["']>(.*?)(</td>|</A>)""", re.IGNORECASE)
     PATTERN_POWERSEARCH = re.compile(r"""Here are the [0-9]+ matching titles""")

Modified: trunk/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -52,12 +52,12 @@
             self.image_url = gutils.trim(self.page[tmp:], 'src="', '"')
 
     def get_o_title(self):
-        self.o_title = gutils.trim(self.page, '<h1>', ' <span')
+        self.o_title = gutils.regextrim(self.page, '<h1>', '([ ]|[&][#][0-9]+[;])<span')
         if self.o_title == '':
             self.o_title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 
     def get_title(self):    # same as get_o_title()
-        self.title = gutils.trim(self.page, '<h1>', ' <span')
+        self.title = gutils.regextrim(self.page, '<h1>', '([ ]|[&][#][0-9]+[;])<span')
         if self.title == '':
             self.title = re.sub('[(].*', '', gutils.trim(self.page, '<title>', '</title>'))
 

Modified: trunk/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -63,7 +63,7 @@
 
     def get_image(self):
         self.image_url = ''
-        tmpdata = self.regextrim(self.tmp_page, '(PRINT[-]CONTENT[-]START|<td class="content">)', '(Dieser Film wurde |>FOTOSHOW<|>KRITIK<)')
+        tmpdata = gutils.regextrim(self.tmp_page, '(PRINT[-]CONTENT[-]START|<td class="content">)', '(Dieser Film wurde |>FOTOSHOW<|>KRITIK<)')
         tmpdatasplit = re.split('src="http://.+/flbilder', tmpdata)
         if len(tmpdatasplit) > 2:
             tmpdata = gutils.before(tmpdatasplit[2], '.jpg')
@@ -78,25 +78,25 @@
         self.o_title = gutils.trim(self.tmp_page, 'span class="standardsmall">(', ')<')
         if self.o_title == '':
             if self.url_type == 'V':
-                self.o_title = gutils.after(self.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/videofilm', '</a>'), '>')
+                self.o_title = gutils.after(gutils.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/videofilm', '</a>'), '>')
             else:
-                self.o_title = gutils.after(self.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/kinofilm', '</a>'), '>')
+                self.o_title = gutils.after(gutils.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/kinofilm', '</a>'), '>')
 
     def get_title(self):
         if self.url_type == "V":
-            self.title = gutils.after(self.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/videofilm', '</a>'), '>')
+            self.title = gutils.after(gutils.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/videofilm', '</a>'), '>')
         else:
-            self.title = gutils.after(self.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/kinofilm', '</a>'), '>')
+            self.title = gutils.after(gutils.regextrim(self.tmp_page, 'headline2"[^>]*>[ \t\r\n]*<a href="/kinofilm', '</a>'), '>')
 
     def get_director(self):
-        self.director = self.regextrim(self.tmp_creditspage, '>[ ]*Regie', '</a>')
+        self.director = gutils.regextrim(self.tmp_creditspage, '>[ ]*Regie', '</a>')
         self.director = gutils.after(self.director, '/star/')
         self.director = gutils.after(self.director, '>')
 
     def get_plot(self):
         # little steps to perfect plot (I hope ... it's a terrible structured content ... )
         self.plot = gutils.before(self.tmp_page, '<!-- PRINT-CONTENT-ENDE-->')
-        self.plot = self.regextrim(self.plot, 'Kurzinfo', '</td></tr>[ \t\r\n]*<tr><td></td></tr>')
+        self.plot = gutils.regextrim(self.plot, 'Kurzinfo', '</td></tr>[ \t\r\n]*<tr><td></td></tr>')
         if self.plot != '':
             lastpos = self.plot.rfind('</table>')
             if lastpos == -1:
@@ -118,7 +118,7 @@
 
     def get_year(self):
         self.year = ''
-        tmp = self.regextrim(self.tmp_page, 'span class="standardsmall"[^>]*><strong>', '</span>')
+        tmp = gutils.regextrim(self.tmp_page, 'span class="standardsmall"[^>]*><strong>', '</span>')
         if tmp <> None:
             srchresult = re.search('[0-9][0-9][0-9][0-9]</strong>', tmp)
             if srchresult <> None:
@@ -128,10 +128,10 @@
         self.runtime = ''
         srchresult = re.search('>[0-9]+[ \t]Min[.]<', self.tmp_page)
         if srchresult <> None:
-            self.runtime = self.regextrim(srchresult.string[srchresult.start():srchresult.end()], '>', '[^0-9]')
+            self.runtime = gutils.regextrim(srchresult.string[srchresult.start():srchresult.end()], '>', '[^0-9]')
 
     def get_genre(self):
-        self.genre = self.regextrim(self.tmp_page,'span class="standardsmall"[^>]*>[ \t\r\n]*<strong>((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)</strong>[ \t]-[ \t]<strong>)*', '</strong>[ \t]-[ \t]<strong>')
+        self.genre = gutils.regextrim(self.tmp_page,'span class="standardsmall"[^>]*>[ \t\r\n]*<strong>((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)</strong>[ \t]-[ \t]<strong>)*', '</strong>[ \t]-[ \t]<strong>')
 
     def get_cast(self):
         self.cast = gutils.trim(self.tmp_creditspage,'>Cast<', '</table><br')
@@ -159,12 +159,12 @@
             self.cast = string.replace(self.cast, '--flip--', _(' as ').encode('utf8'))
 
     def get_classification(self):
-        self.classification = self.regextrim(self.tmp_page,'FSK:( |&nbsp;)+', '</strong>')
+        self.classification = gutils.regextrim(self.tmp_page,'FSK:( |&nbsp;)+', '</strong>')
 
     def get_studio(self):
-        self.studio = self.regextrim(self.tmp_page, '>[ ]*Verleih:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*</strong>')
+        self.studio = gutils.regextrim(self.tmp_page, '>[ ]*Verleih:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*</strong>')
         if (self.studio == ""):
-            self.studio = self.regextrim(self.tmp_page, '>[ ]*Anbieter:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*</strong>')
+            self.studio = gutils.regextrim(self.tmp_page, '>[ ]*Anbieter:( |&nbsp;)+', '( - |&nbsp;-&nbsp;)*</strong>')
 
     def get_o_site(self):
         self.o_site = ""
@@ -176,9 +176,9 @@
         self.trailer = ""
 
     def get_country(self):
-        self.country = self.regextrim(self.tmp_page, 'span class="standardsmall"[^>]*><strong>((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)</strong>[ \t]-[ \t]<strong>)*', '</span>')
+        self.country = gutils.regextrim(self.tmp_page, 'span class="standardsmall"[^>]*><strong>((DVD|VHS|Laser Disc|Video CD|Blue-ray Disc)</strong>[ \t]-[ \t]<strong>)*', '</span>')
         if self.country <> None:
-            self.country = self.regextrim(self.country, '-[ \t]<strong>', '</strong>')
+            self.country = gutils.regextrim(self.country, '-[ \t]<strong>', '</strong>')
             self.country = re.sub('[0-9]+$', '', self.country)
         else:
             self.country = ''
@@ -200,19 +200,6 @@
         tmp_notes = string.replace(gutils.strip_tags(gutils.trim(self.tmp_dvdfeaturespage, "<b>EAN</b>", "</td></tr>")), "&nbsp;", "")
         if (tmp_notes != ""):
             self.notes = self.notes + "EAN:\n" + tmp_notes + "\n\n"
-            
-    def regextrim(self,text,key1,key2):
-        obj = re.search(key1, text)
-        if obj is None:
-            return ''
-        else:
-            p1 = obj.end()
-        obj = re.search(key2, text[p1:])
-        if obj is None:
-            return ''
-        else:
-            p2 = p1 + obj.start()
-        return text[p1:p2]
 
 #
 # kino.de use iso-8859-1

Modified: trunk/lib/plugins/movie/PluginMovieOFDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieOFDb.py	2008-11-10 16:58:54 UTC (rev 1029)
+++ trunk/lib/plugins/movie/PluginMovieOFDb.py	2008-11-10 20:51:03 UTC (rev 1030)
@@ -50,7 +50,7 @@
         self.director = gutils.trim(self.page,"Regie:","</a><br>")
 
     def get_plot(self):
-        storyid = self.regextrim(self.page, '<a href="plot/', '(">|[&])')
+        storyid = gutils.regextrim(self.page, '<a href="plot/', '(">|[&])')
         if not storyid is None:
             story_page = self.open_page(url="http://www.ofdb.de/plot/%s" % (storyid))
         self.plot = gutils.trim(story_page, "</b><br><br>","</")
@@ -110,19 +110,6 @@
             self.rating = "0"
         self.rating = str(round(float(self.rating)))
 
-    def regextrim(self,text,key1,key2):
-        obj = re.search(key1, text)
-        if obj is None:
-            return ''
-        else:
-            p1 = obj.end()
-        obj = re.search(key2, text[p1:])
-        if obj is None:
-            return ''
-        else:
-            p2 = p1 + obj.start()
-        return text[p1:p2]
-
 class SearchPlugin(movie.SearchMovie):
     def __init__(self):
         self.original_url_search   = "http://www.ofdb.de/view.php?page=suchergebnis&Kat=OTitel&SText="



From piotrek at mail.berlios.de  Tue Nov 11 14:53:16 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Tue, 11 Nov 2008 14:53:16 +0100
Subject: [Griffith-svn] r1031 - in branches/0.9.x: . lib lib/plugins/export
	lib/plugins/imp lib/plugins/movie lib/sqlalchemy/databases
Message-ID: <200811111353.mABDrGH7018469@sheep.berlios.de>

Author: piotrek
Date: 2008-11-11 14:53:11 +0100 (Tue, 11 Nov 2008)
New Revision: 1031

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/TODO
   branches/0.9.x/griffith
   branches/0.9.x/lib/about.py
   branches/0.9.x/lib/add.py
   branches/0.9.x/lib/backup.py
   branches/0.9.x/lib/cover.py
   branches/0.9.x/lib/dbupgrade.py
   branches/0.9.x/lib/delete.py
   branches/0.9.x/lib/edit.py
   branches/0.9.x/lib/gconsole.py
   branches/0.9.x/lib/gemail.py
   branches/0.9.x/lib/gutils.py
   branches/0.9.x/lib/initialize.py
   branches/0.9.x/lib/loan.py
   branches/0.9.x/lib/main_treeview.py
   branches/0.9.x/lib/movie.py
   branches/0.9.x/lib/people.py
   branches/0.9.x/lib/plugins/export/PluginExportCSV.py
   branches/0.9.x/lib/plugins/export/PluginExportHTML.py
   branches/0.9.x/lib/plugins/export/PluginExportPDF.py
   branches/0.9.x/lib/plugins/export/PluginExportXML.py
   branches/0.9.x/lib/plugins/export/PluginExportiPod.py
   branches/0.9.x/lib/plugins/imp/CSV.py
   branches/0.9.x/lib/plugins/imp/__init__.py
   branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py
   branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py
   branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py
   branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
   branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
   branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py
   branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py
   branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py
   branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py
   branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
   branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py
   branches/0.9.x/lib/plugins/movie/PluginMovieWP.py
   branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
   branches/0.9.x/lib/preferences.py
   branches/0.9.x/lib/quick_filter.py
   branches/0.9.x/lib/sql.py
   branches/0.9.x/lib/sqlalchemy/databases/sqlite.py
   branches/0.9.x/lib/update.py
   branches/0.9.x/lib/version.py
   branches/0.9.x/lib/view.py
   branches/0.9.x/lib/widgets.py
Log:
* Backport SQLAlchemy's pysqlite2 2.5.0 compatibility (taken from 0.4.8)
  + force gettext to use unicode


Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/ChangeLog	2008-11-11 13:53:11 UTC (rev 1031)
@@ -5,6 +5,10 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-11  Piotr O?arowski
+	* Backport SQLAlchemy's pysqlite2 2.5.0 compatibility (taken from 0.4.8)
+	  + force gettext to use unicode
+
 2008-11-10  Michael Jahn
 	* updated plugins IMDB-de, Amazon, Kino.de, FilmeVonAZ
 

Modified: branches/0.9.x/TODO
===================================================================
--- branches/0.9.x/TODO	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/TODO	2008-11-11 13:53:11 UTC (rev 1031)
@@ -1,16 +1,21 @@
 next version
 ============
 * Advanced sort/filter criteria
+* Posters stored in database
+* New fields:
+  + screenplay
+  + aspect ratio
+
+near future
+===========
 * Export plugin system rewrite, new templates format (mako? jinja?)
 * Impor/export plugins for Excel files (.xls) (pyExcelerator?)
 * Customising main list view
 * New fields:
   + location of the DVD (room/box/case/etc) - will replace "Number" field
-  + screenplay
-  + aspect ratio
 
-near future
-===========
+future
+======
 * More import plugins
 * Nice PDF tabular report
 * Detecting audio/video parameters from file (mmpython?)

Modified: branches/0.9.x/griffith
===================================================================
--- branches/0.9.x/griffith	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/griffith	2008-11-11 13:53:11 UTC (rev 1031)
@@ -22,6 +22,9 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
+import gettext
+gettext.install('griffith', unicode=1)
+
 # set the PATH
 import sys, os.path
 lib = os.path.abspath(os.path.join(os.path.dirname(sys.argv[0]), 'lib'))
@@ -54,7 +57,6 @@
 # other imports
 import gtk, gtk.glade
 import add, config, gconsole, gutils, gdebug, initialize, main_treeview, quick_filter, update
-from gettext import gettext as _
 
 class Griffith:
 	"""The main application class"""

Modified: branches/0.9.x/lib/about.py
===================================================================
--- branches/0.9.x/lib/about.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/about.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gtk
 import version
 import os

Modified: branches/0.9.x/lib/add.py
===================================================================
--- branches/0.9.x/lib/add.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/add.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import os
 import gtk

Modified: branches/0.9.x/lib/backup.py
===================================================================
--- branches/0.9.x/lib/backup.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/backup.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import config, edit, gutils, sql
 import gtk
 import os.path

Modified: branches/0.9.x/lib/cover.py
===================================================================
--- branches/0.9.x/lib/cover.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/cover.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm

Modified: branches/0.9.x/lib/dbupgrade.py
===================================================================
--- branches/0.9.x/lib/dbupgrade.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/dbupgrade.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from sqlalchemy import *
 import os.path
 import gutils

Modified: branches/0.9.x/lib/delete.py
===================================================================
--- branches/0.9.x/lib/delete.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/delete.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import os
 

Modified: branches/0.9.x/lib/edit.py
===================================================================
--- branches/0.9.x/lib/edit.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/edit.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import os
 import update

Modified: branches/0.9.x/lib/gconsole.py
===================================================================
--- branches/0.9.x/lib/gconsole.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/gconsole.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import getopt
 import sys
 import gutils

Modified: branches/0.9.x/lib/gemail.py
===================================================================
--- branches/0.9.x/lib/gemail.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/gemail.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -24,7 +24,8 @@
 import socket
 import smtplib
 import gutils
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 
 socket.setdefaulttimeout(10)
 

Modified: branches/0.9.x/lib/gutils.py
===================================================================
--- branches/0.9.x/lib/gutils.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/gutils.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import string
 import os
 try:

Modified: branches/0.9.x/lib/initialize.py
===================================================================
--- branches/0.9.x/lib/initialize.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/initialize.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -30,7 +30,8 @@
 import gettext
 import platform
 import re
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from locale import getdefaultlocale
 
 try:

Modified: branches/0.9.x/lib/loan.py
===================================================================
--- branches/0.9.x/lib/loan.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/loan.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import gtk
 import datetime

Modified: branches/0.9.x/lib/main_treeview.py
===================================================================
--- branches/0.9.x/lib/main_treeview.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/main_treeview.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import os
 import gtk

Modified: branches/0.9.x/lib/movie.py
===================================================================
--- branches/0.9.x/lib/movie.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/movie.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from urllib import *
 import sys
 import string

Modified: branches/0.9.x/lib/people.py
===================================================================
--- branches/0.9.x/lib/people.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/people.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 
 def show_people_window(self):

Modified: branches/0.9.x/lib/plugins/export/PluginExportCSV.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportCSV.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/export/PluginExportCSV.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -25,7 +25,9 @@
 import gtk
 import gutils
 import os
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
+import gutils
 
 plugin_name = "CSV"
 plugin_description = _("Full CSV list export plugin")

Modified: branches/0.9.x/lib/plugins/export/PluginExportHTML.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -30,7 +30,8 @@
 import version
 import math
 from xml.dom import minidom
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 
 plugin_name         = 'HTML'
 plugin_description  = _('Plugin exports data using templates')

Modified: branches/0.9.x/lib/plugins/export/PluginExportPDF.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportPDF.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/export/PluginExportPDF.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm, inch
@@ -115,7 +116,7 @@
                 sort_reverse = self.config.get('sortby_reverse', False, section='mainlist')
                 do_grouping = True
                 for i in sort_column_name.split(','):
-                    if i <> 'title' and i <> 'o_title':
+                    if i != 'title' and i != 'o_title':
                         do_grouping = False
                     if self.db.Movie.c.has_key(i):
                         if sort_reverse:

Modified: branches/0.9.x/lib/plugins/export/PluginExportXML.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportXML.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/export/PluginExportXML.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -26,7 +26,8 @@
 import gtk
 import gutils
 import os
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 
 plugin_name = "XML"
 plugin_description = _("Full XML list export plugin")

Modified: branches/0.9.x/lib/plugins/export/PluginExportiPod.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportiPod.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/export/PluginExportiPod.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -30,7 +30,8 @@
 import platform
 import shutil
 from tempfile import mkdtemp
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 
 plugin_name = "iPod"
 plugin_description = _("iPod Notes export plugin")

Modified: branches/0.9.x/lib/plugins/imp/CSV.py
===================================================================
--- branches/0.9.x/lib/plugins/imp/CSV.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/imp/CSV.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -10,7 +10,8 @@
 #
 ###########################################################################
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from plugins.imp import ImportPlugin as IP
 import gtk
 import gtk.glade

Modified: branches/0.9.x/lib/plugins/imp/__init__.py
===================================================================
--- branches/0.9.x/lib/plugins/imp/__init__.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/imp/__init__.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -23,7 +23,8 @@
 
 # detect all plugins:
 import glob, os.path
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 
 __all__ = [os.path.basename(x)[:-3] for x in glob.glob("%s/*.py" % os.path.dirname(__file__))]
 __all__.remove('__init__')

Modified: branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 from gutils import decompress

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -19,7 +19,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils, movie, string
 
 plugin_name = "Cinematografo"

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -25,7 +25,8 @@
 # joe1310 at terra.com.br - S?o Paulo/Brasil
 
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils, movie, string
 
 plugin_name = "E-Pipoca"

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils, movie
 import re,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -6,7 +6,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -6,7 +6,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -7,7 +7,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string,re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieWP.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieWP.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieWP.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/preferences.py
===================================================================
--- branches/0.9.x/lib/preferences.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/preferences.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import os
 import initialize
 import gutils

Modified: branches/0.9.x/lib/quick_filter.py
===================================================================
--- branches/0.9.x/lib/quick_filter.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/quick_filter.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 
 def change_filter(self):

Modified: branches/0.9.x/lib/sql.py
===================================================================
--- branches/0.9.x/lib/sql.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/sql.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from sqlalchemy import *
 import os.path
 import gutils

Modified: branches/0.9.x/lib/sqlalchemy/databases/sqlite.py
===================================================================
--- branches/0.9.x/lib/sqlalchemy/databases/sqlite.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/sqlalchemy/databases/sqlite.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -82,15 +82,47 @@
         tup = self._cvt(value, dialect)
         return tup and datetime.time(*tup[3:7])
 
-class SLText(sqltypes.TEXT):
+
+class SLUnicodeMixin(object):
+   def bind_processor(self, dialect):
+       if self.convert_unicode or dialect.convert_unicode:
+           if self.assert_unicode is None:
+               assert_unicode = dialect.assert_unicode
+           else:
+               assert_unicode = self.assert_unicode
+                
+           if not assert_unicode:
+               return None 
+                
+           def process(value):
+               if not isinstance(value, (unicode, NoneType)):
+                   if assert_unicode == 'warn':
+                       util.warn("Unicode type received non-unicode bind " 
+                                 "param value %r" % value)
+                       return value 
+                   else:
+                       raise exc.InvalidRequestError("Unicode type received non-unicode bind param value %r" % value)
+               else:
+                   return value
+           return process
+       else:
+           return None 
+
+   def result_processor(self, dialect):
+       return None 
+    
+class SLText(SLUnicodeMixin, sqltypes.TEXT):
+#class SLText(sqltypes.TEXT):
     def get_col_spec(self):
         return "TEXT"
 
-class SLString(sqltypes.String):
+class SLString(SLUnicodeMixin, sqltypes.String):
+#class SLString(sqltypes.String):
     def get_col_spec(self):
         return "VARCHAR(%(length)s)" % {'length' : self.length}
 
-class SLChar(sqltypes.CHAR):
+class SLChar(SLUnicodeMixin, sqltypes.CHAR):
+#class SLChar(sqltypes.CHAR):
     def get_col_spec(self):
         return "CHAR(%(length)s)" % {'length' : self.length}
 

Modified: branches/0.9.x/lib/update.py
===================================================================
--- branches/0.9.x/lib/update.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/update.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 from sqlalchemy import Select, desc
 import gutils
 import os

Modified: branches/0.9.x/lib/version.py
===================================================================
--- branches/0.9.x/lib/version.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/version.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,9 +21,10 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 pname        = "Griffith"
-pversion     = "0.9.7.1"
+pversion     = "0.9.8"
 pauthor      = "Vasco Nunes, Piotr O?arowski <griffith-private at lists.berlios.de>"
 pyear        = "2005-2008"
 pwebsite     = "http://www.griffith.cc/"

Modified: branches/0.9.x/lib/view.py
===================================================================
--- branches/0.9.x/lib/view.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/view.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 
 def filter_not_seen(self):
 	self.populate_treeview()

Modified: branches/0.9.x/lib/widgets.py
===================================================================
--- branches/0.9.x/lib/widgets.py	2008-11-10 20:51:03 UTC (rev 1030)
+++ branches/0.9.x/lib/widgets.py	2008-11-11 13:53:11 UTC (rev 1031)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gtk
 import sys
 



From mikej06 at mail.berlios.de  Tue Nov 11 21:40:56 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Tue, 11 Nov 2008 21:40:56 +0100
Subject: [Griffith-svn] r1032 - in trunk: . lib
Message-ID: <200811112040.mABKeu5E000328@sheep.berlios.de>

Author: mikej06
Date: 2008-11-11 21:40:43 +0100 (Tue, 11 Nov 2008)
New Revision: 1032

Modified:
   trunk/griffith
   trunk/lib/initialize.py
Log:
fixed add/remove/rename for language, medium, audio codec, video codec, audio channels and sub title

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-11 13:53:11 UTC (rev 1031)
+++ trunk/griffith	2008-11-11 20:40:43 UTC (rev 1032)
@@ -441,9 +441,9 @@
         vol_id = self._selected_volume
         vol = session.query(db.Volume).filter_by(volume_id=vol_id).first()
         if vol:
-            session.remove(vol)
+            session.delete(vol)
             try:
-                session.commi()
+                session.commit()
             except Exception, e:
                 session.rollback()
                 log.warn("Cannot remove volume: %s", e.message)
@@ -456,9 +456,9 @@
         col_id = self._selected_collection
         col = session.query(db.Collection).filter_by(collection_id=col_id).first()
         if col:
-            session.remove(col)
+            session.delete(col)
             try:
-                session.commi()
+                session.commit()
             except Exception, e:
                 session.rollback()
                 log.warn("Cannot remove collection: %s", e.message)
@@ -584,33 +584,55 @@
 
     # preferences
     def on_lang_add_clicked(self, widget):
+        session = self.db.Session()
         lang = db.Lang()
         lang.name = self.widgets['preferences']['lang_name'].get_active_text().decode('utf-8')
-        if lang and lang.add_to_db():
+        session.add(lang)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add language: %s" % e.message)
+        else:
             initialize.language_combos(self)
 
     def on_lang_remove_clicked(self, widget):
+        session = self.db.Session()
         active = self.widgets['preferences']['lang_name'].get_active()
-        if active>0:
+        if active>-1:
             lang_id = self.languages_ids[active]
-            lang = self.db.session.query(db.Lang).filter_by(lang_id=lang_id).first()
-            if lang and lang.remove_from_db():
-                initialize.language_combos(self)
+            lang = session.query(db.Lang).filter_by(lang_id=lang_id).first()
+            if lang and len(lang.movielangs)==0:
+                session.delete(lang)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot remove language: %s" % e.message)
+                else:
+                    initialize.language_combos(self)
+            else:
+                gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
         else:
-            log.warn("You have to select language first")
+            log.warn("You have to select a language first")
 
     def on_lang_rename_clicked(self, widget):
         try:
             active = self.lang_name_active
         except:
             return False
+        session = self.db.Session()
         lang_id = self.languages_ids[active]
-        if lang_id>0:
-            lang = self.db.session.query(db.Lang).filter_by(lang_id=lang_id).first()
-            if lang is not None:
-                lang.name = self.widgets['preferences']['lang_name'].get_active_text().decode('utf-8')
-                if lang.update_in_db():
-                    initialize.language_combos(self)
+        lang = session.query(db.Lang).filter_by(lang_id=lang_id).first()
+        if lang is not None:
+            lang.name = self.widgets['preferences']['lang_name'].get_active_text().decode('utf-8')
+            try:
+                session.commit()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot rename language: %s" % e.message)
+            else:
+                initialize.language_combos(self)
 
     def on_lang_name_combo_changed(self, widget):
         active = self.widgets['preferences']['lang_name'].get_active()
@@ -686,31 +708,54 @@
 
     # audio codecs ------------------------------------------------------{{{
     def on_acodec_add_clicked(self, widget):
-        acodec = self.db.ACodec()
+        session = self.db.Session()
+        acodec = db.ACodec()
         acodec.name = self.widgets['preferences']['acodec_name'].get_active_text().decode('utf-8')
-        if acodec and acodec.add_to_db():
+        session.add(acodec)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add tag: %s" % e.message)
+        else:
             initialize.acodec_combos(self)
 
     def on_acodec_remove_clicked(self, widget):
+        session = self.db.Session()
         active = self.widgets['preferences']['acodec_name'].get_active()
-        if active>0:
+        if active>-1:
             acodec_id = self.acodecs_ids[active]
-            acodec = self.db.session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
-            if acodec and acodec.remove_from_db():
-                initialize.acodec_combos(self)
+            acodec = session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
+            if acodec and len(acodec.movielangs)==0:
+                session.delete(acodec)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot remove audio codec: %s" % e.message)
+                else:
+                    initialize.acodec_combos(self)
+            else:
+                gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
         else:
-            log.warn("You have to select audio codec first")
+            log.warn("You have to select an audio codec first")
 
     def on_acodec_rename_clicked(self, widget):
         try:
             active = self.acodec_name_active
         except:
             return False
+        session = self.db.Session()
         acodec_id = self.acodecs_ids[active]
-        acodec = self.db.session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
+        acodec = session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
         if acodec is not None:
             acodec.name = self.widgets['preferences']['acodec_name'].get_active_text().decode('utf-8')
-            if acodec.update_in_db():
+            try:
+                session.commit()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot rename audio codec: %s" % e.message)
+            else:
                 initialize.acodec_combos(self)
 
     def on_acodec_name_combo_changed(self, widget):
@@ -721,31 +766,54 @@
 
     # audio channels ----------------------------------------------------{{{
     def on_achannel_add_clicked(self, widget):
-        achannel = self.db.AChannel()
+        session = self.db.Session()
+        achannel = db.AChannel()
         achannel.name = self.widgets['preferences']['achannel_name'].get_active_text().decode('utf-8')
-        if achannel and achannel.add_to_db():
+        session.add(achannel)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add audio channel: %s" % e.message)
+        else:
             initialize.achannel_combos(self)
 
     def on_achannel_remove_clicked(self, widget):
+        session = self.db.Session()
         active = self.widgets['preferences']['achannel_name'].get_active()
-        if active>0:
+        if active>-1:
             achannel_id = self.achannels_ids[active]
-            achannel = self.db.session.query(db.AChannel).filter_by(achannel_id=achannel_id).first()
-            if achannel and achannel.remove_from_db():
-                initialize.achannel_combos(self)
+            achannel = session.query(db.AChannel).filter_by(achannel_id=achannel_id).first()
+            if achannel and len(achannel.movielangs)==0:
+                session.delete(achannel)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot remove audio channel: %s" % e.message)
+                else:
+                    initialize.achannel_combos(self)
+            else:
+                gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
         else:
-            log.warn("You have to select audio channel first")
+            log.warn("You have to select an audio channel entry first")
 
     def on_achannel_rename_clicked(self, widget):
         try:
             active = self.achannel_name_active
         except:
             return False
+        session = self.db.Session()
         achannel_id = self.achannels_ids[active]
-        achannel = self.db.session.query(db.AChannel).filter_by(achannel_id=achannel_id).first()
+        achannel = session.query(db.AChannel).filter_by(achannel_id=achannel_id).first()
         if achannel is not None:
             achannel.name = self.widgets['preferences']['achannel_name'].get_active_text().decode('utf-8')
-            if achannel.update_in_db():
+            try:
+                session.commit()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot rename audio channel entry: %s" % e.message)
+            else:
                 initialize.achannel_combos(self)
 
     def on_achannel_name_combo_changed(self, widget):
@@ -756,31 +824,54 @@
 
     # subformats -------------------------------------------------------------{{{
     def on_subformat_add_clicked(self, widget):
-        subformat = self.db.SubFormat()
+        session = self.db.Session()
+        subformat = db.SubFormat()
         subformat.name = self.widgets['preferences']['subformat_name'].get_active_text().decode('utf-8')
-        if subformat and subformat.add_to_db():
+        session.add(subformat)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add subtitle format entry: %s" % e.message)
+        else:
             initialize.subformat_combos(self)
 
     def on_subformat_remove_clicked(self, widget):
+        session = self.db.Session()
         active = self.widgets['preferences']['subformat_name'].get_active()
-        if active>0:
+        if active>-1:
             subformat_id = self.subformats_ids[active]
-            subformat = self.db.session.query(db.SubFormat).filter_by(subformat_id=subformat_id).first()
-            if subformat and subformat.remove_from_db():
-                initialize.subformat_combos(self)
+            subformat = session.query(db.SubFormat).filter_by(subformat_id=subformat_id).first()
+            if subformat and len(subformat.movielangs)==0:
+                session.delete(subformat)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot remove subtitle format entry: %s" % e.message)
+                else:
+                    initialize.subformat_combos(self)
+            else:
+                gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
         else:
-            log.warn("You have to select subtitle format first")
+            log.warn("You have to select a subtitle format first")
 
     def on_subformat_rename_clicked(self, widget):
         try:
             active = self.subformat_name_active
         except:
             return False
+        session = self.db.Session()
         subformat_id = self.subformats_ids[active]
-        subformat = self.db.session.query(db.SubFormat).filter_by(subformat_id=subformat_id).first()
+        subformat = session.query(db.SubFormat).filter_by(subformat_id=subformat_id).first()
         if subformat is not None:
             subformat.name = self.widgets['preferences']['subformat_name'].get_active_text().decode('utf-8')
-            if subformat.update_in_db():
+            try:
+                session.commit()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot rename subtitle format entry: %s" % e.message)
+            else:
                 initialize.subformat_combos(self)
 
     def on_subformat_name_combo_changed(self, widget):
@@ -791,31 +882,54 @@
 
     # media ------------------------------------------------------------{{{
     def on_medium_add_clicked(self, widget):
-        medium = self.db.Medium()
+        session = self.db.Session()
+        medium = db.Medium()
         medium.name = self.widgets['preferences']['medium_name'].get_active_text().decode('utf-8')
-        if medium and medium.add_to_db():
+        session.add(medium)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add medium entry: %s" % e.message)
+        else:
             initialize.media_combos(self)
 
     def on_medium_remove_clicked(self, widget):
+        session = self.db.Session()
         active = self.widgets['preferences']['medium_name'].get_active()
         if active>-1:
             medium_id = self.media_ids[active]
-            medium = self.db.session.query(db.Medium).filter_by(medium_id=medium_id).first()
-            if medium and medium.remove_from_db():
-                initialize.media_combos(self)
+            medium = session.query(db.Medium).filter_by(medium_id=medium_id).first()
+            if medium and len(medium.movies)==0:
+                session.delete(medium)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot remove medium entry: %s" % e.message)
+                else:
+                    initialize.media_combos(self)
+            else:
+                gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
         else:
-            log.warn("You have to select medium first")
+            log.warn("You have to select a medium entry first")
 
     def on_medium_rename_clicked(self, widget):
         try:
             active = self.medium_name_active
         except:
             return False
+        session = self.db.Session()
         medium_id = self.media_ids[active]
-        medium = self.db.session.query(db.Medium).filter_by(medium_id=medium_id).first()
+        medium = session.query(db.Medium).filter_by(medium_id=medium_id).first()
         if medium is not None:
             medium.name = self.widgets['preferences']['medium_name'].get_active_text().decode('utf-8')
-            if medium.update_in_db():
+            try:
+                session.commit()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot rename medium entry: %s" % e.message)
+            else:
                 initialize.media_combos(self)
 
     def on_medium_name_combo_changed(self, widget):
@@ -826,31 +940,54 @@
 
     # vcodecs -------------------------------------------------------------{{{
     def on_vcodec_add_clicked(self, widget):
-        vcodec = self.db.VCodec()
+        session = self.db.Session()
+        vcodec = db.VCodec()
         vcodec.name = self.widgets['preferences']['vcodec_name'].get_active_text().decode('utf-8')
-        if vcodec and vcodec.add_to_db():
+        session.add(vcodec)
+        try:
+            session.commit()
+        except Exception, e:
+            session.rollback()
+            log.warn("Cannot add video codec entry: %s" % e.message)
+        else:
             initialize.vcodec_combos(self)
 
     def on_vcodec_remove_clicked(self, widget):
+        session = self.db.Session()
         active = self.widgets['preferences']['vcodec_name'].get_active()
         if active>-1:
             vcodec_id = self.vcodecs_ids[active]
-            vcodec = self.db.session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
-            if vcodec and vcodec.remove_from_db():
-                initialize.vcodec_combos(self)
+            vcodec = session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
+            if vcodec and len(vcodec.movies)==0:
+                session.delete(vcodec)
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot remove video codec entry: %s" % e.message)
+                else:
+                    initialize.vcodec_combos(self)
+            else:
+                gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
         else:
-            log.warn("You have to select video codec first")
+            log.warn("You have to select a video codec entry first")
 
     def on_vcodec_rename_clicked(self, widget):
         try:
             active = self.vcodec_name_active
         except:
             return False
+        session = self.db.Session()
         vcodec_id = self.vcodecs_ids[active]
-        vcodec = self.db.session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
+        vcodec = session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
         if vcodec is not None:
             vcodec.name = self.widgets['preferences']['vcodec_name'].get_active_text().decode('utf-8')
-            if vcodec.update_in_db():
+            try:
+                session.commit()
+            except Exception, e:
+                session.rollback()
+                log.warn("Cannot rename video codec entry: %s" % e.message)
+            else:
                 initialize.vcodec_combos(self)
 
     def on_vcodec_name_combo_changed(self, widget):

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2008-11-11 13:53:11 UTC (rev 1031)
+++ trunk/lib/initialize.py	2008-11-11 20:40:43 UTC (rev 1032)
@@ -807,6 +807,7 @@
         i += 1
     self.initialized = _tmp
     self.widgets['preferences']['tag_name'].show_all()
+    self.widgets['preferences']['tag_name'].set_active(0)
 
 def language_combos(self):
     self.widgets['preferences']['lang_name'].get_model().clear()
@@ -819,6 +820,7 @@
         self.widgets['preferences']['lang_name'].insert_text(int(i), str(lang.name))
         i += 1
     self.widgets['preferences']['lang_name'].show_all()
+    self.widgets['preferences']['lang_name'].set_active(0)
     # add movie languages treeview
     self.lang['lang'].clear()
     for i in self.db.session.query(db.Lang).all():
@@ -834,6 +836,7 @@
         self.widgets['preferences']['acodec_name'].insert_text(int(i), str(acodec.name))
         i += 1
     self.widgets['preferences']['acodec_name'].show_all()
+    self.widgets['preferences']['acodec_name'].set_active(0)
     # add movie languages treeview
     self.lang['acodec'].clear()
     for i in self.db.session.query(db.ACodec).all():
@@ -849,6 +852,7 @@
         self.widgets['preferences']['achannel_name'].insert_text(int(i), str(achannel.name))
         i += 1
     self.widgets['preferences']['achannel_name'].show_all()
+    self.widgets['preferences']['achannel_name'].set_active(0)
     # add movie languages treeview
     self.lang['achannel'].clear()
     for i in self.db.session.query(db.AChannel).all():
@@ -864,6 +868,7 @@
         self.widgets['preferences']['subformat_name'].insert_text(int(i), str(subformat.name))
         i += 1
     self.widgets['preferences']['subformat_name'].show_all()
+    self.widgets['preferences']['subformat_name'].set_active(0)
     # add movie languages treeview
     self.lang['subformat'].clear()
     for i in self.db.session.query(db.SubFormat).all():
@@ -900,6 +905,7 @@
             self.widgets['preferences']['media'].set_active(0)
     else:
         self.widgets['preferences']['media'].set_active(0)
+    self.widgets['preferences']['medium_name'].set_active(0)
 
 def vcodec_combos(self):
     # clear data
@@ -930,6 +936,7 @@
         self.widgets['preferences']['vcodec'].set_active(int(pos))
     else:
         self.widgets['preferences']['vcodec'].set_active(0)
+    self.widgets['preferences']['vcodec_name'].set_active(0)
 
 def create_tag_vbox(self, widget, tab):
     for i in widget.get_children():



From piotrek at mail.berlios.de  Tue Nov 11 21:49:41 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Tue, 11 Nov 2008 21:49:41 +0100
Subject: [Griffith-svn] r1033 - in branches/0.9.x: . lib lib/plugins/export
Message-ID: <200811112049.mABKnfsk001221@sheep.berlios.de>

Author: piotrek
Date: 2008-11-11 21:49:40 +0100 (Tue, 11 Nov 2008)
New Revision: 1033

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/griffith
   branches/0.9.x/lib/add.py
   branches/0.9.x/lib/edit.py
   branches/0.9.x/lib/gemail.py
   branches/0.9.x/lib/gutils.py
   branches/0.9.x/lib/initialize.py
   branches/0.9.x/lib/people.py
   branches/0.9.x/lib/plugins/export/PluginExportHTML.py
   branches/0.9.x/lib/preferences.py
   branches/0.9.x/lib/quick_filter.py
Log:
* Backport some unicode related changes from Griffith 0.10-beta1
* Few minor fixes


Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/ChangeLog	2008-11-11 20:49:40 UTC (rev 1033)
@@ -7,7 +7,8 @@
 
 2008-11-11  Piotr O?arowski
 	* Backport SQLAlchemy's pysqlite2 2.5.0 compatibility (taken from 0.4.8)
-	  + force gettext to use unicode
+	* Backport some unicode related changes from Griffith 0.10-beta1
+	* Few minor fixes
 
 2008-11-10  Michael Jahn
 	* updated plugins IMDB-de, Amazon, Kino.de, FilmeVonAZ

Modified: branches/0.9.x/griffith
===================================================================
--- branches/0.9.x/griffith	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/griffith	2008-11-11 20:49:40 UTC (rev 1033)
@@ -405,7 +405,7 @@
 
 	def add_volume(self, widget):
 		from update import update_volume_combo_ids
-		name = self.widgets['add']['volume'].get_active_text()
+		name = self.widgets['add']['volume'].get_active_text().decode('utf-8')
 		vol = self.db.Volume(name=name)
 		if vol and vol.add_to_db():
 			update_volume_combo_ids(self)
@@ -413,7 +413,7 @@
 
 	def add_collection(self, widget):
 		from update import update_collection_combo_ids
-		name = self.widgets['add']['collection'].get_active_text()
+		name = self.widgets['add']['collection'].get_active_text().decode('utf-8')
 		col = self.db.Collection(name=name)
 		if col and col.add_to_db():
 			update_collection_combo_ids(self)
@@ -438,7 +438,7 @@
 	def rename_volume(self, widget):
 		vol_id = self._selected_volume
 		if vol_id != 0:
-			new_name = self.widgets['add']['volume'].get_active_text()
+			new_name = self.widgets['add']['volume'].get_active_text().decode('utf-8')
 			vol = self.db.Volume.get_by(volume_id=vol_id)
 			if vol:
 				vol.name=new_name
@@ -448,7 +448,7 @@
 	def rename_collection(self, widget):
 		col_id = self.e_selected_collection
 		if col_id != 0:
-			new_name = self.widgets['add']['collection'].get_active_text()
+			new_name = self.widgets['add']['collection'].get_active_text().decode('utf-8')
 			col = self.db.Collection.get_by(collection_id=col_id)
 			if col is not None:
 				col.name=new_name
@@ -539,7 +539,7 @@
 
 	# preferences
 	def on_lang_add_clicked(self, widget):
-		lang = self.db.Lang(name=self.widgets['preferences']['lang_name'].get_active_text())
+		lang = self.db.Lang(name=self.widgets['preferences']['lang_name'].get_active_text().decode('utf-8'))
 		if lang and lang.add_to_db():
 			initialize.language_combos(self)
 
@@ -562,7 +562,7 @@
 		if lang_id>0:
 			lang = self.db.Lang.get_by(lang_id=lang_id)
 			if lang is not None:
-				lang.name = self.widgets['preferences']['lang_name'].get_active_text()
+				lang.name = self.widgets['preferences']['lang_name'].get_active_text().decode('utf-8')
 				if lang.update_in_db():
 					initialize.language_combos(self)
 
@@ -574,7 +574,7 @@
 
 	# tags -------------------------------------------------------------{{{
 	def on_tag_add_clicked(self, widget):
-		tag = self.db.Tag(name=self.widgets['preferences']['tag_name'].get_active_text())
+		tag = self.db.Tag(name=self.widgets['preferences']['tag_name'].get_active_text().decode('utf-8'))
 		if tag and tag.add_to_db():
 			initialize.fill_preferences_tags_combo(self)
 			initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
@@ -602,7 +602,7 @@
 		tag_id = self.tags_ids[active]
 		tag = self.db.Tag.get_by(tag_id=tag_id)
 		if tag is not None:
-			tag.name = self.widgets['preferences']['tag_name'].get_active_text()
+			tag.name = self.widgets['preferences']['tag_name'].get_active_text().decode('utf-8')
 			if tag.update_in_db():
 				initialize.fill_preferences_tags_combo(self)
 				initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
@@ -617,7 +617,7 @@
 
 	# audio codecs ------------------------------------------------------{{{
 	def on_acodec_add_clicked(self, widget):
-		acodec = self.db.ACodec(name=self.widgets['preferences']['acodec_name'].get_active_text())
+		acodec = self.db.ACodec(name=self.widgets['preferences']['acodec_name'].get_active_text().decode('utf-8'))
 		if acodec and acodec.add_to_db():
 			initialize.acodec_combos(self)
 
@@ -639,7 +639,7 @@
 		acodec_id = self.acodecs_ids[active]
 		acodec = self.db.ACodec.get_by(acodec_id=acodec_id)
 		if acodec is not None:
-			acodec.name = self.widgets['preferences']['acodec_name'].get_active_text()
+			acodec.name = self.widgets['preferences']['acodec_name'].get_active_text().decode('utf-8')
 			if acodec.update_in_db():
 				initialize.acodec_combos(self)
 
@@ -651,7 +651,7 @@
 
 	# audio channels ----------------------------------------------------{{{
 	def on_achannel_add_clicked(self, widget):
-		achannel = self.db.AChannel(name=self.widgets['preferences']['achannel_name'].get_active_text())
+		achannel = self.db.AChannel(name=self.widgets['preferences']['achannel_name'].get_active_text().decode('utf-8'))
 		if achannel and achannel.add_to_db():
 			initialize.achannel_combos(self)
 
@@ -673,7 +673,7 @@
 		achannel_id = self.achannels_ids[active]
 		achannel = self.db.AChannel.get_by(achannel_id=achannel_id)
 		if achannel is not None:
-			achannel.name = self.widgets['preferences']['achannel_name'].get_active_text()
+			achannel.name = self.widgets['preferences']['achannel_name'].get_active_text().decode('utf-8')
 			if achannel.update_in_db():
 				initialize.achannel_combos(self)
 
@@ -685,7 +685,7 @@
 
 	# subformats -------------------------------------------------------------{{{
 	def on_subformat_add_clicked(self, widget):
-		subformat = self.db.SubFormat(name=self.widgets['preferences']['subformat_name'].get_active_text())
+		subformat = self.db.SubFormat(name=self.widgets['preferences']['subformat_name'].get_active_text().decode('utf-8'))
 		if subformat and subformat.add_to_db():
 			initialize.subformat_combos(self)
 
@@ -707,7 +707,7 @@
 		subformat_id = self.subformats_ids[active]
 		subformat = self.db.SubFormat.get_by(subformat_id=subformat_id)
 		if subformat is not None:
-			subformat.name = self.widgets['preferences']['subformat_name'].get_active_text()
+			subformat.name = self.widgets['preferences']['subformat_name'].get_active_text().decode('utf-8')
 			if subformat.update_in_db():
 				initialize.subformat_combos(self)
 
@@ -719,7 +719,7 @@
 
 	# media ------------------------------------------------------------{{{
 	def on_medium_add_clicked(self, widget):
-		medium = self.db.Medium(name=self.widgets['preferences']['medium_name'].get_active_text())
+		medium = self.db.Medium(name=self.widgets['preferences']['medium_name'].get_active_text().decode('utf-8'))
 		if medium and medium.add_to_db():
 			initialize.media_combos(self)
 
@@ -741,7 +741,7 @@
 		medium_id = self.media_ids[active]
 		medium = self.db.Medium.get_by(medium_id=medium_id)
 		if medium is not None:
-			medium.name = self.widgets['preferences']['medium_name'].get_active_text()
+			medium.name = self.widgets['preferences']['medium_name'].get_active_text().decode('utf-8')
 			if medium.update_in_db():
 				initialize.media_combos(self)
 
@@ -753,7 +753,7 @@
 
 	# vcodecs -------------------------------------------------------------{{{
 	def on_vcodec_add_clicked(self, widget):
-		vcodec = self.db.VCodec(name=self.widgets['preferences']['vcodec_name'].get_active_text())
+		vcodec = self.db.VCodec(name=self.widgets['preferences']['vcodec_name'].get_active_text().decode('utf-8'))
 		if vcodec and vcodec.add_to_db():
 			initialize.vcodec_combos(self)
 
@@ -775,7 +775,7 @@
 		vcodec_id = self.vcodecs_ids[active]
 		vcodec = self.db.VCodec.get_by(vcodec_id=vcodec_id)
 		if vcodec is not None:
-			vcodec.name = self.widgets['preferences']['vcodec_name'].get_active_text()
+			vcodec.name = self.widgets['preferences']['vcodec_name'].get_active_text().decode('utf-8')
 			if vcodec.update_in_db():
 				initialize.vcodec_combos(self)
 
@@ -928,7 +928,7 @@
 	# quick filter operations ---------------------------------------------
 
 	def on_filter_criteria_changed(self, *args):
-		selected_criteria = self.widgets['filter']['criteria'].get_active_text()
+		selected_criteria = self.widgets['filter']['criteria'].get_active_text().decode('utf-8')
 		self.config.set('criteria', selected_criteria, section='mainlist')
 		quick_filter.change_filter(self)
 

Modified: branches/0.9.x/lib/add.py
===================================================================
--- branches/0.9.x/lib/add.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/add.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -236,33 +236,33 @@
 	plot_buffer  = w['plot'].get_buffer()
 	
 	t_movies = {
-		'classification' : w['classification'].get_text(),
+		'classification' : w['classification'].get_text().decode('utf-8'),
 		'color'          : w['color'].get_active(),
 		'cond'           : w['condition'].get_active(),
-		'country'        : w['country'].get_text(),
-		'director'       : w['director'].get_text(),
-		'genre'          : w['genre'].get_text(),
-		'image'          : w['image'].get_text(),
+		'country'        : w['country'].get_text().decode('utf-8'),
+		'director'       : w['director'].get_text().decode('utf-8'),
+		'genre'          : w['genre'].get_text().decode('utf-8'),
+		'image'          : w['image'].get_text().decode('utf-8'),
 		'layers'         : w['layers'].get_active(),
 		'media_num'      : w['discs'].get_value(),
 		'number'         : w['number'].get_value(),
-		'o_site'         : w['o_site'].get_text(),
-		'o_title'        : w['o_title'].get_text(),
+		'o_site'         : w['o_site'].get_text().decode('utf-8'),
+		'o_title'        : w['o_title'].get_text().decode('utf-8'),
 		'rating'         : w['rating_slider'].get_value(),
 		'region'         : w['region'].get_active(),
-		'runtime'        : w['runtime'].get_text(),
-		'site'           : w['site'].get_text(),
-		'studio'         : w['studio'].get_text(),
-		'title'          : w['title'].get_text(),
-		'trailer'        : w['trailer'].get_text(),
+		'runtime'        : w['runtime'].get_text().decode('utf-8'),
+		'site'           : w['site'].get_text().decode('utf-8'),
+		'studio'         : w['studio'].get_text().decode('utf-8'),
+		'title'          : w['title'].get_text().decode('utf-8'),
+		'trailer'        : w['trailer'].get_text().decode('utf-8'),
 		'year'           : w['year'].get_value(),
 		'collection_id'  : w['collection'].get_active(),
 		'medium_id'      : w['media'].get_active(),
 		'volume_id'      : w['volume'].get_active(),
 		'vcodec_id'      : w['vcodec'].get_active(),
-		'cast'           : cast_buffer.get_text(cast_buffer.get_start_iter(),cast_buffer.get_end_iter()),
-		'notes'          : notes_buffer.get_text(notes_buffer.get_start_iter(),notes_buffer.get_end_iter()),
-		'plot'           : plot_buffer.get_text(plot_buffer.get_start_iter(),plot_buffer.get_end_iter()),
+		'cast'           : cast_buffer.get_text(cast_buffer.get_start_iter(),cast_buffer.get_end_iter()).decode('utf-8'),
+		'notes'          : notes_buffer.get_text(notes_buffer.get_start_iter(),notes_buffer.get_end_iter()).decode('utf-8'),
+		'plot'           : plot_buffer.get_text(plot_buffer.get_start_iter(),plot_buffer.get_end_iter()).decode('utf-8'),
 	}
 	if self._am_movie_id is not None:
 		t_movies['movie_id'] = self._am_movie_id

Modified: branches/0.9.x/lib/edit.py
===================================================================
--- branches/0.9.x/lib/edit.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/edit.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -132,12 +132,12 @@
 	amazon.setLicense("04GDDMMXX8X9CJ1B22G2")
 
 	locale = self.config.get('amazon_locale', 0, section='add')
-	keyword = self.widgets['movie']['o_title'].get_text()
+	keyword = self.widgets['movie']['o_title'].get_text().decode('utf-8')
 	if locale == '1':
 		locale = 'uk'
 	elif locale == '2':
 		locale = 'de'
-		keyword = self.widgets['movie']['title'].get_text()
+		keyword = self.widgets['movie']['title'].get_text().decode('utf-8')
 	elif locale == '3':
 		locale = 'ca'
 	elif locale == '4':
@@ -163,7 +163,7 @@
 		return
 
 	for f in range(len(result.Item)):
-		if self.widgets['movie']['o_title'].get_text() == result.Item[f].ItemAttributes.Title:
+		if self.widgets['movie']['o_title'].get_text().decode('utf-8') == result.Item[f].ItemAttributes.Title:
 			get_poster(self, f, result, current_poster)
 			return
 
@@ -197,7 +197,7 @@
 		f = int(tmp_model.get_value(tmp_iter, 0))
 		self.widgets['results']['window'].hide()
 
-	file_to_copy = tempfile.mktemp(suffix=self.widgets['movie']['number'].get_text(), \
+	file_to_copy = tempfile.mktemp(suffix=self.widgets['movie']['number'].get_text().decode('utf-8'), \
 		dir=self.locations['temp'])
 	file_to_copy += ".jpg"
 	if len(result.Item[f].LargeImage.URL):
@@ -250,7 +250,7 @@
 				1, self.widgets['window'])
 		if response == -8:
 			self.debug.show("Using fetched poster, updating and removing old one from disk.")
-			update_image(self, self.widgets['movie']['number'].get_text(), file_to_copy)
+			update_image(self, self.widgets['movie']['number'].get_text().decode('utf-8'), file_to_copy)
 		else:
 			self.debug.show("Reverting to previous poster and deleting new one from disk.")
 			try:

Modified: branches/0.9.x/lib/gemail.py
===================================================================
--- branches/0.9.x/lib/gemail.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/gemail.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -78,8 +78,8 @@
 				_("Movie loan reminder"), _("Hi, %s!\n\nJust to remind you " + \
 				"that I'm really needing the following movie I have loaned to you " + \
 				"recently:\n\n%s (%s)\n\nLoaned on %s") \
-				%(self.person_name, self.widgets['movie']['o_title'].get_text(), \
-				self.widgets['movie']['title'].get_text(), self.loan_date[:10]))
+				%(self.person_name, self.widgets['movie']['o_title'].get_text().decode('utf-8'), \
+				self.widgets['movie']['title'].get_text().decode('utf-8'), self.loan_date[:10]))
 		except:
 			gutils.error(self, _("Mail could not be sent. Please check e-mail preferences."), self.widgets['window'])
 	else:

Modified: branches/0.9.x/lib/gutils.py
===================================================================
--- branches/0.9.x/lib/gutils.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/gutils.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -135,7 +135,7 @@
 		return 0
 
 def on_combo_box_entry_changed_name(widget):
-	return widget.get_active_text()
+	return widget.get_active_text().decode('utf-8')
 
 def convert_entities(text):
 	def conv(ents):
@@ -268,9 +268,9 @@
 		mfilter.add_mime_type("image/jpeg")
 		mfilter.add_mime_type("image/gif")
 		mfilter.add_pattern("*.[pP][nN][gG]")
-		mfilter.add_pattern("*.[jJ][pP][gG]")
+		mfilter.add_pattern("*.[jJ][pP][eE][gG]")
 		mfilter.add_pattern("*.[gG][iI][fF]")
-		mfilter.add_pattern("*.[tT][iI][fF]")
+		mfilter.add_pattern("*.[tT][iI][fF]{1,2}")
 		mfilter.add_pattern("*.[xX][pP][mM]")
 		dialog.add_filter(mfilter)
 	mfilter = gtk.FileFilter()

Modified: branches/0.9.x/lib/initialize.py
===================================================================
--- branches/0.9.x/lib/initialize.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/initialize.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -722,8 +722,8 @@
 			name = self.db.Volume.get_by(volume_id=vol_id).name
 		else:
 			name = ''
+		self.widgets['add']['volume'].insert_text(int(i), str(name))
 		# add some white spaces to prevent scrollbar hides parts of the names	
-		self.widgets['add']['volume'].insert_text(int(i), str(name) + '   ')
 		self.widgets['filter']['volume'].insert_text(int(i), str(name) + '   ')
 	self.initialized = _tmp
 	self.widgets['add']['volume'].show_all()
@@ -745,8 +745,8 @@
 			name = self.db.Collection.get_by(collection_id=col_id).name
 		else:
 			name = ''
+		self.widgets['add']['collection'].insert_text(int(i), str(name))
 		# add some white spaces to prevent scrollbar hides parts of the names	
-		self.widgets['add']['collection'].insert_text(int(i), str(name) + '   ')
 		self.widgets['filter']['collection'].insert_text(int(i), str(name) + '   ')
 	self.initialized = _tmp
 	self.initialized = False

Modified: branches/0.9.x/lib/people.py
===================================================================
--- branches/0.9.x/lib/people.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/people.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -45,16 +45,16 @@
 	self.widgets['person']['phone'].set_text("")
 
 def add_person_db(self):
-	if (self.widgets['person']['name'].get_text()<>''):
+	if self.widgets['person']['name'].get_text().decode('utf-8'):
 		p = self.db.Person()
-		p.name = self.widgets['person']['name'].get_text()
-		p.email = self.widgets['person']['email'].get_text()
-		p.phone = self.widgets['person']['phone'].get_text()
+		p.name = self.widgets['person']['name'].get_text().decode('utf-8')
+		p.email = self.widgets['person']['email'].get_text().decode('utf-8')
+		p.phone = self.widgets['person']['phone'].get_text().decode('utf-8')
 		self.widgets['person']['window'].hide()
 		if p.add_to_db():
 			myiter = self.p_treemodel.insert_after(None, None)
-			self.p_treemodel.set_value(myiter,0,str(self.widgets['person']['name'].get_text()))
-			self.p_treemodel.set_value(myiter,1,str(self.widgets['person']['email'].get_text()))
+			self.p_treemodel.set_value(myiter,0,str(self.widgets['person']['name'].get_text().decode('utf-8')))
+			self.p_treemodel.set_value(myiter,1,str(self.widgets['person']['email'].get_text().decode('utf-8')))
 		self.widgets['people']['window'].present()
 	else:
 		gutils.error(self.widgets['results']['window'],_("You should fill the person name"))
@@ -63,7 +63,7 @@
 	try:
 		treeselection = self.widgets['people']['treeview'].get_selection()
 		(tmp_model, tmp_iter) = treeselection.get_selected()
-		name = tmp_model.get_value(tmp_iter,0)
+		name = tmp_model.get_value(tmp_iter,0).decode('utf-8')
 	except:
 		return
 	p = self.db.Person.get_by(name=name)
@@ -79,12 +79,12 @@
 	self.widgets['people']['window'].present()
 
 def update_person(self):
-	p = self.db.Person.get_by(person_id=self.widgets['person']['e_id'].get_text())
+	p = self.db.Person.get_by(person_id=self.widgets['person']['e_id'].get_text().decode('utf-8'))
 	if p is None:
 		return False
-	p.name = self.widgets['person']['e_name'].get_text()
-	p.email = self.widgets['person']['e_email'].get_text()
-	p.phone = self.widgets['person']['e_phone'].get_text()
+	p.name = self.widgets['person']['e_name'].get_text().decode('utf-8')
+	p.email = self.widgets['person']['e_email'].get_text().decode('utf-8')
+	p.phone = self.widgets['person']['e_phone'].get_text().decode('utf-8')
 	if p.update_in_db():
 		self.update_statusbar(_("Record updated"))
 		edit_person_cancel(self)
@@ -101,7 +101,7 @@
 	try:
 		treeselection = self.widgets['people']['treeview'].get_selection()
 		(tmp_model, tmp_iter) = treeselection.get_selected()
-		person = tmp_model.get_value(tmp_iter,0)
+		person = tmp_model.get_value(tmp_iter,0).decode('utf-8')
 	except:
 		return
 	person = self.db.Person.get_by(name=person)

Modified: branches/0.9.x/lib/plugins/export/PluginExportHTML.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -467,10 +467,12 @@
 	def on_combo_style_changed(self, widget):
 		self.config['style'] = widget.get_active()
 		self.widgets['cb_custom_style'].set_active(False)
+		preview_file = None
 
 		tpl_id = self.config['template']
 		template_dir = os.path.join(self.locations['share'], 'export_templates', self.templates[tpl_id]['dir'])
-		preview_file = self.templates[self.config['template']]['styles'][self.config['style']]['preview']
+		if self.config['style'] > -1:
+			preview_file = self.templates[self.config['template']]['styles'][self.config['style']]['preview']
 		if preview_file is not None:
 			preview_file = os.path.join(template_dir, preview_file)
 		if preview_file is not None and not os.path.isfile(preview_file):
@@ -622,8 +624,8 @@
 		
 		# get data from widgets
 		self.config['exported_dir'] = self.widgets['fcw'].get_filename()
-		self.config['title']        = self.widgets['entry_header'].get_text()
-		self.config['sorting']      = self.names[self.widgets['combo_sortby'].get_active_text()]
+		self.config['title']        = self.widgets['entry_header'].get_text().decode('utf-8')
+		self.config['sorting']      = self.names[self.widgets['combo_sortby'].get_active_text().decode('utf-8')]
 		if self.widgets['cb_reverse'].get_active():
 			self.config['sorting2'] = 'DESC'
 		else:

Modified: branches/0.9.x/lib/preferences.py
===================================================================
--- branches/0.9.x/lib/preferences.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/preferences.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -323,12 +323,12 @@
 	else:
 		c.set('mail_use_tls', False, section='mail')
 
-	c.set('smtp_server', w['mail_smtp_server'].get_text(), section='mail')
-	c.set('mail_smtp_port', w['mail_smtp_port'].get_text(), section='mail')
+	c.set('smtp_server', w['mail_smtp_server'].get_text().decode('utf-8'), section='mail')
+	c.set('mail_smtp_port', w['mail_smtp_port'].get_text().decode('utf-8'), section='mail')
 
-	c.set('username', w['mail_username'].get_text(), section='mail')
-	c.set('password', w['mail_password'].get_text(), section='mail')
-	c.set('email', w['mail_email'].get_text(), section='mail')
+	c.set('username', w['mail_username'].get_text().decode('utf-8'), section='mail')
+	c.set('password', w['mail_password'].get_text().decode('utf-8'), section='mail')
+	c.set('email', w['mail_email'].get_text().decode('utf-8'), section='mail')
 
 	# default movie plugin
 	if w['default_plugin'].get_active():
@@ -365,9 +365,9 @@
 	if self.windows:
 		save_reader = ''
 	else:
-		save_reader = w['epdf_reader'].get_text()
+		save_reader = w['epdf_reader'].get_text().decode('utf-8')
 
-	c.set('lang', w['spell_lang'].get_text(), section='spell')
+	c.set('lang', w['spell_lang'].get_text().decode('utf-8'), section='spell')
 	c['pdf_reader'] = save_reader
 
 	c.set('amazon_locale', w['amazon_locale'].get_active(), section='add')

Modified: branches/0.9.x/lib/quick_filter.py
===================================================================
--- branches/0.9.x/lib/quick_filter.py	2008-11-11 20:40:43 UTC (rev 1032)
+++ branches/0.9.x/lib/quick_filter.py	2008-11-11 20:49:40 UTC (rev 1033)
@@ -27,7 +27,7 @@
 
 def change_filter(self):
 	x = 0
-	text = gutils.gescape(self.widgets['filter']['text'].get_text())
+	text = gutils.gescape(self.widgets['filter']['text'].get_text().decode('utf-8'))
 	
 	from sqlalchemy import select
 	statement = select(self.db.Movie.c)



From piotrek at mail.berlios.de  Tue Nov 11 22:22:21 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Tue, 11 Nov 2008 22:22:21 +0100
Subject: [Griffith-svn] r1034 - in trunk: . lib lib/plugins/export
	lib/plugins/movie
Message-ID: <200811112122.mABLMLqk004803@sheep.berlios.de>

Author: piotrek
Date: 2008-11-11 22:22:16 +0100 (Tue, 11 Nov 2008)
New Revision: 1034

Modified:
   trunk/griffith
   trunk/lib/gemail.py
   trunk/lib/people.py
   trunk/lib/plugins/export/PluginExportHTML.py
   trunk/lib/plugins/movie/PluginMovieAmazon.py
Log:
* don't try to rename/remove fake acodec/changel/...
* few more unicode related changes


Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-11 20:49:40 UTC (rev 1033)
+++ trunk/griffith	2008-11-11 21:22:16 UTC (rev 1034)
@@ -402,10 +402,10 @@
 
     # volumes/collections ----------------------------------------------{{{
     def on_am_collection_combo_changed(self,widget):
-        if widget.get_active()!=-1:
+        if widget.get_active() != -1:
             self._selected_collection = self.collection_combo_ids[widget.get_active()]
     def on_am_volume_combo_changed(self,widget):
-        if widget.get_active()!=-1:
+        if widget.get_active() != -1:
             self._selected_volume = self.volume_combo_ids[widget.get_active()]
 
     def add_volume(self, widget):
@@ -469,7 +469,7 @@
     def rename_volume(self, widget):
         session = self.db.Session()
         vol_id = self._selected_volume
-        if vol_id != 0:
+        if vol_id > 0:
             new_name = self.widgets['add']['volume'].get_active_text().decode('utf-8')
             vol = session.query(db.Volume).filter_by(volume_id=vol_id).first()
             if vol:
@@ -486,7 +486,7 @@
     def rename_collection(self, widget):
         session = self.db.Session()
         col_id = self.e_selected_collection
-        if col_id != 0:
+        if col_id > 0:
             new_name = self.widgets['add']['collection'].get_active_text().decode('utf-8')
             col = session.query(db.Collection).filter_by(collection_id=col_id).first()
             if col:
@@ -592,14 +592,14 @@
             session.commit()
         except Exception, e:
             session.rollback()
-            log.warn("Cannot add language: %s" % e.message)
+            log.warn("Cannot add language: %s", e.message)
         else:
             initialize.language_combos(self)
 
     def on_lang_remove_clicked(self, widget):
         session = self.db.Session()
         active = self.widgets['preferences']['lang_name'].get_active()
-        if active>-1:
+        if active > 0:
             lang_id = self.languages_ids[active]
             lang = session.query(db.Lang).filter_by(lang_id=lang_id).first()
             if lang and len(lang.movielangs)==0:
@@ -608,7 +608,7 @@
                     session.commit()
                 except Exception, e:
                     session.rollback()
-                    log.warn("Cannot remove language: %s" % e.message)
+                    log.warn("Cannot remove language: %s", e.message)
                 else:
                     initialize.language_combos(self)
             else:
@@ -623,20 +623,21 @@
             return False
         session = self.db.Session()
         lang_id = self.languages_ids[active]
-        lang = session.query(db.Lang).filter_by(lang_id=lang_id).first()
-        if lang is not None:
-            lang.name = self.widgets['preferences']['lang_name'].get_active_text().decode('utf-8')
-            try:
-                session.commit()
-            except Exception, e:
-                session.rollback()
-                log.warn("Cannot rename language: %s" % e.message)
-            else:
-                initialize.language_combos(self)
+        if lang_id > 0:
+            lang = session.query(db.Lang).filter_by(lang_id=lang_id).first()
+            if lang:
+                lang.name = self.widgets['preferences']['lang_name'].get_active_text().decode('utf-8')
+                try:
+                    session.commit()
+                except Exception, e:
+                    session.rollback()
+                    log.warn("Cannot rename language: %s", e.message)
+                else:
+                    initialize.language_combos(self)
 
     def on_lang_name_combo_changed(self, widget):
         active = self.widgets['preferences']['lang_name'].get_active()
-        if active>-1:
+        if active > -1:
             self.lang_name_active = active
     #}}}
 
@@ -650,7 +651,7 @@
             session.commit()
         except Exception, e:
             session.rollback()
-            log.warn("Cannot add tag: %s" % e.message)
+            log.warn("Cannot add tag: %s", e.message)
         else:
             initialize.fill_preferences_tags_combo(self)
             initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
@@ -660,7 +661,7 @@
     def on_tag_remove_clicked(self, widget):
         session = self.db.Session()
         active = self.widgets['preferences']['tag_name'].get_active()
-        if active>-1:
+        if active > -1:
             tag_id = self.tags_ids[active]
             tag = session.query(db.Tag).filter_by(tag_id=tag_id).first()
             if tag and len(tag.movietags)==0:
@@ -669,7 +670,7 @@
                     session.commit()
                 except Exception, e:
                     session.rollback()
-                    log.warn("Cannot remove tag: %s" % e.message)
+                    log.warn("Cannot remove tag: %s", e.message)
                 initialize.fill_preferences_tags_combo(self)
                 initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
                 update.update_bytag_combo_ids(self)
@@ -693,7 +694,7 @@
                 session.commit()
             except Exception, e:
                 session.rollback()
-                log.warn("Cannot rename tag: %s" % e.message)
+                log.warn("Cannot rename tag: %s", e.message)
             else:
                 initialize.fill_preferences_tags_combo(self)
                 initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
@@ -702,7 +703,7 @@
 
     def on_tag_name_combo_changed(self, widget):
         active = self.widgets['preferences']['tag_name'].get_active()
-        if active>-1:
+        if active > -1:
             self.tag_name_active = active
     # }}}
 
@@ -716,23 +717,23 @@
             session.commit()
         except Exception, e:
             session.rollback()
-            log.warn("Cannot add tag: %s" % e.message)
+            log.warn("Cannot add audio codec: %s", e.message)
         else:
             initialize.acodec_combos(self)
 
     def on_acodec_remove_clicked(self, widget):
         session = self.db.Session()
         active = self.widgets['preferences']['acodec_name'].get_active()
-        if active>-1:
+        if active > 0:
             acodec_id = self.acodecs_ids[active]
             acodec = session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
-            if acodec and len(acodec.movielangs)==0:
+            if acodec and len(acodec.movielangs) == 0:
                 session.delete(acodec)
                 try:
                     session.commit()
                 except Exception, e:
                     session.rollback()
-                    log.warn("Cannot remove audio codec: %s" % e.message)
+                    log.warn("Cannot remove audio codec: %s", e.message)
                 else:
                     initialize.acodec_combos(self)
             else:
@@ -748,19 +749,19 @@
         session = self.db.Session()
         acodec_id = self.acodecs_ids[active]
         acodec = session.query(db.ACodec).filter_by(acodec_id=acodec_id).first()
-        if acodec is not None:
+        if acodec:
             acodec.name = self.widgets['preferences']['acodec_name'].get_active_text().decode('utf-8')
             try:
                 session.commit()
             except Exception, e:
                 session.rollback()
-                log.warn("Cannot rename audio codec: %s" % e.message)
+                log.warn("Cannot rename audio codec: %s", e.message)
             else:
                 initialize.acodec_combos(self)
 
     def on_acodec_name_combo_changed(self, widget):
         active = self.widgets['preferences']['acodec_name'].get_active()
-        if active>-1:
+        if active > -1:
             self.acodec_name_active = active
     # }}}
 
@@ -774,14 +775,14 @@
             session.commit()
         except Exception, e:
             session.rollback()
-            log.warn("Cannot add audio channel: %s" % e.message)
+            log.warn("Cannot add audio channel: %s", e.message)
         else:
             initialize.achannel_combos(self)
 
     def on_achannel_remove_clicked(self, widget):
         session = self.db.Session()
         active = self.widgets['preferences']['achannel_name'].get_active()
-        if active>-1:
+        if active > 0:
             achannel_id = self.achannels_ids[active]
             achannel = session.query(db.AChannel).filter_by(achannel_id=achannel_id).first()
             if achannel and len(achannel.movielangs)==0:
@@ -790,7 +791,7 @@
                     session.commit()
                 except Exception, e:
                     session.rollback()
-                    log.warn("Cannot remove audio channel: %s" % e.message)
+                    log.warn("Cannot remove audio channel: %s", e.message)
                 else:
                     initialize.achannel_combos(self)
             else:
@@ -812,13 +813,13 @@
                 session.commit()
             except Exception, e:
                 session.rollback()
-                log.warn("Cannot rename audio channel entry: %s" % e.message)
+                log.warn("Cannot rename audio channel entry: %s", e.message)
             else:
                 initialize.achannel_combos(self)
 
     def on_achannel_name_combo_changed(self, widget):
         active = self.widgets['preferences']['achannel_name'].get_active()
-        if active>-1:
+        if active > -1:
             self.achannel_name_active = active
     # }}}
 
@@ -832,14 +833,14 @@
             session.commit()
         except Exception, e:
             session.rollback()
-            log.warn("Cannot add subtitle format entry: %s" % e.message)
+            log.warn("Cannot add subtitle format entry: %s", e.message)
         else:
             initialize.subformat_combos(self)
 
     def on_subformat_remove_clicked(self, widget):
         session = self.db.Session()
         active = self.widgets['preferences']['subformat_name'].get_active()
-        if active>-1:
+        if active > 0:
             subformat_id = self.subformats_ids[active]
             subformat = session.query(db.SubFormat).filter_by(subformat_id=subformat_id).first()
             if subformat and len(subformat.movielangs)==0:
@@ -848,7 +849,7 @@
                     session.commit()
                 except Exception, e:
                     session.rollback()
-                    log.warn("Cannot remove subtitle format entry: %s" % e.message)
+                    log.warn("Cannot remove subtitle format entry: %s", e.message)
                 else:
                     initialize.subformat_combos(self)
             else:
@@ -870,13 +871,13 @@
                 session.commit()
             except Exception, e:
                 session.rollback()
-                log.warn("Cannot rename subtitle format entry: %s" % e.message)
+                log.warn("Cannot rename subtitle format entry: %s", e.message)
             else:
                 initialize.subformat_combos(self)
 
     def on_subformat_name_combo_changed(self, widget):
         active = self.widgets['preferences']['subformat_name'].get_active()
-        if active>-1:
+        if active > -1:
             self.subformat_name_active = active
     # }}}
 
@@ -890,14 +891,14 @@
             session.commit()
         except Exception, e:
             session.rollback()
-            log.warn("Cannot add medium entry: %s" % e.message)
+            log.warn("Cannot add medium entry: %s", e.message)
         else:
             initialize.media_combos(self)
 
     def on_medium_remove_clicked(self, widget):
         session = self.db.Session()
         active = self.widgets['preferences']['medium_name'].get_active()
-        if active>-1:
+        if active > 0:
             medium_id = self.media_ids[active]
             medium = session.query(db.Medium).filter_by(medium_id=medium_id).first()
             if medium and len(medium.movies)==0:
@@ -906,7 +907,7 @@
                     session.commit()
                 except Exception, e:
                     session.rollback()
-                    log.warn("Cannot remove medium entry: %s" % e.message)
+                    log.warn("Cannot remove medium entry: %s", e.message)
                 else:
                     initialize.media_combos(self)
             else:
@@ -922,19 +923,19 @@
         session = self.db.Session()
         medium_id = self.media_ids[active]
         medium = session.query(db.Medium).filter_by(medium_id=medium_id).first()
-        if medium is not None:
+        if medium:
             medium.name = self.widgets['preferences']['medium_name'].get_active_text().decode('utf-8')
             try:
                 session.commit()
             except Exception, e:
                 session.rollback()
-                log.warn("Cannot rename medium entry: %s" % e.message)
+                log.warn("Cannot rename medium entry: %s", e.message)
             else:
                 initialize.media_combos(self)
 
     def on_medium_name_combo_changed(self, widget):
         active = self.widgets['preferences']['medium_name'].get_active()
-        if active>-1:
+        if active > -1:
             self.medium_name_active = active
     # }}}
 
@@ -948,14 +949,14 @@
             session.commit()
         except Exception, e:
             session.rollback()
-            log.warn("Cannot add video codec entry: %s" % e.message)
+            log.warn("Cannot add video codec entry: %s", e.message)
         else:
             initialize.vcodec_combos(self)
 
     def on_vcodec_remove_clicked(self, widget):
         session = self.db.Session()
         active = self.widgets['preferences']['vcodec_name'].get_active()
-        if active>-1:
+        if active > 0:
             vcodec_id = self.vcodecs_ids[active]
             vcodec = session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
             if vcodec and len(vcodec.movies)==0:
@@ -964,7 +965,7 @@
                     session.commit()
                 except Exception, e:
                     session.rollback()
-                    log.warn("Cannot remove video codec entry: %s" % e.message)
+                    log.warn("Cannot remove video codec entry: %s", e.message)
                 else:
                     initialize.vcodec_combos(self)
             else:
@@ -980,19 +981,19 @@
         session = self.db.Session()
         vcodec_id = self.vcodecs_ids[active]
         vcodec = session.query(db.VCodec).filter_by(vcodec_id=vcodec_id).first()
-        if vcodec is not None:
+        if vcodec:
             vcodec.name = self.widgets['preferences']['vcodec_name'].get_active_text().decode('utf-8')
             try:
                 session.commit()
             except Exception, e:
                 session.rollback()
-                log.warn("Cannot rename video codec entry: %s" % e.message)
+                log.warn("Cannot rename video codec entry: %s", e.message)
             else:
                 initialize.vcodec_combos(self)
 
     def on_vcodec_name_combo_changed(self, widget):
         active = self.widgets['preferences']['vcodec_name'].get_active()
-        if active>-1:
+        if active > -1:
             self.vcodec_name_active = active
     # }}}
 

Modified: trunk/lib/gemail.py
===================================================================
--- trunk/lib/gemail.py	2008-11-11 20:49:40 UTC (rev 1033)
+++ trunk/lib/gemail.py	2008-11-11 21:22:16 UTC (rev 1034)
@@ -78,8 +78,8 @@
                 _("Movie loan reminder"), _("Hi, %s!\n\nJust to remind you " + \
                 "that I'm really needing the following movie I have loaned to you " + \
                 "recently:\n\n%s (%s)\n\nLoaned on %s") \
-                %(self.person_name, self.widgets['movie']['o_title'].get_text(), \
-                self.widgets['movie']['title'].get_text(), self.loan_date[:10]))
+                %(self.person_name, self.widgets['movie']['o_title'].get_text().decode('utf-8'), \
+                self.widgets['movie']['title'].get_text().decode('utf-8'), self.loan_date[:10]))
         except:
             gutils.error(self, _("Mail could not be sent. Please check e-mail preferences."), self.widgets['window'])
     else:

Modified: trunk/lib/people.py
===================================================================
--- trunk/lib/people.py	2008-11-11 20:49:40 UTC (rev 1033)
+++ trunk/lib/people.py	2008-11-11 21:22:16 UTC (rev 1034)
@@ -124,7 +124,7 @@
     try:
         treeselection = self.widgets['people']['treeview'].get_selection()
         (tmp_model, tmp_iter) = treeselection.get_selected()
-        person = tmp_model.get_value(tmp_iter,0)
+        person = tmp_model.get_value(tmp_iter,0).decode('utf-8')
     except:
         return
     person = self.db.session.query(db.Person).filter_by(name=person).first()

Modified: trunk/lib/plugins/export/PluginExportHTML.py
===================================================================
--- trunk/lib/plugins/export/PluginExportHTML.py	2008-11-11 20:49:40 UTC (rev 1033)
+++ trunk/lib/plugins/export/PluginExportHTML.py	2008-11-11 21:22:16 UTC (rev 1034)
@@ -469,10 +469,12 @@
     def on_combo_style_changed(self, widget):
         self.config['style'] = widget.get_active()
         self.widgets['cb_custom_style'].set_active(False)
+        preview_file = None
 
         tpl_id = self.config['template']
         template_dir = os.path.join(self.locations['share'], 'export_templates', self.templates[tpl_id]['dir'])
-        preview_file = self.templates[self.config['template']]['styles'][self.config['style']]['preview']
+        if self.config['style'] > -1:
+            preview_file = self.templates[self.config['template']]['styles'][self.config['style']]['preview']
         if preview_file is not None:
             preview_file = os.path.join(template_dir, preview_file)
         if preview_file is not None and not os.path.isfile(preview_file):
@@ -620,7 +622,7 @@
         
         # get data from widgets
         self.config['exported_dir'] = self.widgets['fcw'].get_filename()
-        self.config['title']        = self.widgets['entry_header'].get_text()
+        self.config['title']        = self.widgets['entry_header'].get_text().decode('utf-8')
         self.config['sorting']      = self.names[self.widgets['combo_sortby'].get_active_text().decode('utf-8')]
         if self.widgets['cb_reverse'].get_active():
             self.config['sorting2'] = 'DESC'

Modified: trunk/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-11 20:49:40 UTC (rev 1033)
+++ trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-11 21:22:16 UTC (rev 1034)
@@ -21,7 +21,8 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-from gettext import gettext as _
+import gettext
+gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string



From piotrek at mail.berlios.de  Thu Nov 13 23:37:03 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Thu, 13 Nov 2008 23:37:03 +0100
Subject: [Griffith-svn] r1037 - branches/0.9.x/glade branches/0.9.x/po
	trunk/glade
Message-ID: <200811132237.mADMb337016532@sheep.berlios.de>

Author: piotrek
Date: 2008-11-13 23:37:03 +0100 (Thu, 13 Nov 2008)
New Revision: 1037

Removed:
   branches/0.9.x/glade/exporthtml.glade.h
   branches/0.9.x/glade/griffith.glade.h
   branches/0.9.x/glade/import.glade.h
   branches/0.9.x/glade/importcsv.glade.h
   branches/0.9.x/po/messages.pot
   trunk/glade/exporthtml.glade.h
   trunk/glade/griffith.glade.h
   trunk/glade/import.glade.h
   trunk/glade/importcsv.glade.h
Log:
remove .h files from the repo


Deleted: branches/0.9.x/glade/exporthtml.glade.h
===================================================================
--- branches/0.9.x/glade/exporthtml.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ branches/0.9.x/glade/exporthtml.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,33 +0,0 @@
-char *s = N_("<b>Example</b>");
-char *s = N_("<b>Export</b>");
-char *s = N_("<b>Header</b>");
-char *s = N_("<b>Limits</b>");
-char *s = N_("<b>Sort by</b>");
-char *s = N_("<b>Split into</b>");
-char *s = N_("<b>Style</b>");
-char *s = N_("<b>Template</b>");
-char *s = N_("Author");
-char *s = N_("Black and white");
-char *s = N_("Choose style file");
-char *s = N_("Convert images");
-char *s = N_("Data");
-char *s = N_("Description");
-char *s = N_("Destination");
-char *s = N_("E-mail");
-char *s = N_("Export");
-char *s = N_("Export data");
-char *s = N_("Format");
-char *s = N_("Maximal height");
-char *s = N_("Maximal width");
-char *s = N_("Posters");
-char *s = N_("Reverse");
-char *s = N_("Template");
-char *s = N_("Use custom file");
-char *s = N_("Version");
-char *s = N_("entries per page");
-char *s = N_("files");
-char *s = N_("loaned only");
-char *s = N_("none");
-char *s = N_("not loaned only");
-char *s = N_("seen only");
-char *s = N_("unseen only");

Deleted: branches/0.9.x/glade/griffith.glade.h
===================================================================
--- branches/0.9.x/glade/griffith.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ branches/0.9.x/glade/griffith.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,180 +0,0 @@
-char *s = N_("0 means no limits");
-char *s = N_("<b>Audio channels</b>");
-char *s = N_("<b>Audio codecs</b>");
-char *s = N_("<b>Audio</b>");
-char *s = N_("<b>Collection</b>");
-char *s = N_("<b>Defaults</b>");
-char *s = N_("<b>E-mail reminder</b>");
-char *s = N_("<b>Languages</b>");
-char *s = N_("<b>Loan History</b>");
-char *s = N_("<b>Media</b>");
-char *s = N_("<b>Search for:</b>");
-char *s = N_("<b>Search results</b>");
-char *s = N_("<b>Select database to use</b>");
-char *s = N_("<b>Show only the following columns</b>");
-char *s = N_("<b>Sort by</b>");
-char *s = N_("<b>Subtitle formats</b>");
-char *s = N_("<b>Subtitles</b>");
-char *s = N_("<b>Tags</b>");
-char *s = N_("<b>Use spell checking on the following fields:</b>");
-char *s = N_("<b>Video codecs</b>");
-char *s = N_("<b>Volume</b>");
-char *s = N_("Add");
-char *s = N_("Add a new movie");
-char *s = N_("Add a new person");
-char *s = N_("Add movie");
-char *s = N_("Add movie and close");
-char *s = N_("Add new movie");
-char *s = N_("All Movies");
-char *s = N_("Attempt to fetch a big poster from Amazon services Web site");
-char *s = N_("By Collection");
-char *s = N_("By Tag");
-char *s = N_("By Volume");
-char *s = N_("Cast");
-char *s = N_("Choose Image");
-char *s = N_("Classification");
-char *s = N_("Clears filter");
-char *s = N_("Clone");
-char *s = N_("Collection");
-char *s = N_("Color");
-char *s = N_("Condition");
-char *s = N_("Country");
-char *s = N_("DVD layers");
-char *s = N_("DVD region");
-char *s = N_("Database");
-char *s = N_("Delete a person");
-char *s = N_("Details");
-char *s = N_("Dictionaries");
-char *s = N_("Director");
-char *s = N_("Discs");
-char *s = N_("E-mail");
-char *s = N_("E-mail reminder");
-char *s = N_("E_xport");
-char *s = N_("Edit a person");
-char *s = N_("Edit movie details");
-char *s = N_("Favorite Movie Plugin");
-char *s = N_("Fetch from Amazon");
-char *s = N_("Fill empty fields only");
-char *s = N_("Filter ");
-char *s = N_("Font for reports");
-char *s = N_("Forum");
-char *s = N_("Found Results");
-char *s = N_("Genre");
-char *s = N_("Get from web");
-char *s = N_("Get movie data from:");
-char *s = N_("Griffith");
-char *s = N_("Homepage");
-char *s = N_("Host");
-char *s = N_("I_mport");
-char *s = N_("Image");
-char *s = N_("Include Front Image");
-char *s = N_("Include movie number");
-char *s = N_("Languages");
-char *s = N_("Layers");
-char *s = N_("Limit search results to");
-char *s = N_("Load poster from disk");
-char *s = N_("Loan");
-char *s = N_("Loan Management");
-char *s = N_("Loan movie");
-char *s = N_("Loan to");
-char *s = N_("Loaned Movies");
-char *s = N_("Loaned to");
-char *s = N_("Loans");
-char *s = N_("Main list");
-char *s = N_("Manage People");
-char *s = N_("Media");
-char *s = N_("Medium");
-char *s = N_("Meter\n"
-             "Stars");
-char *s = N_("Movie details");
-char *s = N_("Movie information");
-char *s = N_("Name");
-char *s = N_("Needs authentication");
-char *s = N_("Not Seen Movies");
-char *s = N_("Notes");
-char *s = N_("Number");
-char *s = N_("Official site");
-char *s = N_("Original Title");
-char *s = N_("Original title");
-char *s = N_("Other");
-char *s = N_("PDF reader");
-char *s = N_("Password");
-char *s = N_("People");
-char *s = N_("Phone");
-char *s = N_("Please wait a moment...");
-char *s = N_("Plot");
-char *s = N_("Plugins");
-char *s = N_("Port");
-char *s = N_("Poster image");
-char *s = N_("Poster viewer");
-char *s = N_("Preferences");
-char *s = N_("Print Cover");
-char *s = N_("Print cover");
-char *s = N_("Rating");
-char *s = N_("Rating image");
-char *s = N_("Region");
-char *s = N_("Remove");
-char *s = N_("Remove selected movie");
-char *s = N_("Removes poster");
-char *s = N_("Rename");
-char *s = N_("Report bug");
-char *s = N_("Return");
-char *s = N_("Reverse");
-char *s = N_("Runtime");
-char *s = N_("SMTP port");
-char *s = N_("SMTP server");
-char *s = N_("Searching on the web");
-char *s = N_("Seen it");
-char *s = N_("Select A File");
-char *s = N_("Select first movie");
-char *s = N_("Select last movie");
-char *s = N_("Select next movie");
-char *s = N_("Select previous movie");
-char *s = N_("Sender E-mail address");
-char *s = N_("Show other movies in this collection");
-char *s = N_("Show other movies in this volume");
-char *s = N_("Simple");
-char *s = N_("Site");
-char *s = N_("Size");
-char *s = N_("Spell check the following language");
-char *s = N_("Standard\n"
-             "Slim\n"
-             "Double Slim");
-char *s = N_("Studio");
-char *s = N_("Suggest an unseen movie");
-char *s = N_("Tags");
-char *s = N_("Technical information");
-char *s = N_("This movie is part of...");
-char *s = N_("Title");
-char *s = N_("Toolbar");
-char *s = N_("Trailer");
-char *s = N_("Type");
-char *s = N_("Type in the original film tile, select source and choose <i>Get from web</i>. Griffith will try to fetch all the related information from the Web.");
-char *s = N_("Use Spellchecker");
-char *s = N_("Use TLS?");
-char *s = N_("Use locale:");
-char *s = N_("Username");
-char *s = N_("Video codec");
-char *s = N_("Visit movie web site");
-char *s = N_("Visit the oficial web site");
-char *s = N_("Volume");
-char *s = N_("Watch the trailer");
-char *s = N_("Year");
-char *s = N_("_Edit");
-char *s = N_("_File");
-char *s = N_("_Help");
-char *s = N_("_Loans");
-char *s = N_("_Tools");
-char *s = N_("_View");
-char *s = N_("add entered name to collections list");
-char *s = N_("add entered name to volumes list");
-char *s = N_("classification");
-char *s = N_("click here if movie was returned");
-char *s = N_("collection details");
-char *s = N_("loans movie or volume");
-char *s = N_("minutes");
-char *s = N_("movies");
-char *s = N_("remove selected collection");
-char *s = N_("remove selected volume");
-char *s = N_("tags");
-char *s = N_("volume details");

Deleted: branches/0.9.x/glade/import.glade.h
===================================================================
--- branches/0.9.x/glade/import.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ branches/0.9.x/glade/import.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,10 +0,0 @@
-char *s = N_("<b>Import only fields selected below</b>");
-char *s = N_("<b>Importing...</b>");
-char *s = N_("Author");
-char *s = N_("Description");
-char *s = N_("E-mail");
-char *s = N_("Fields");
-char *s = N_("Import window");
-char *s = N_("Plugin");
-char *s = N_("Source");
-char *s = N_("Version");

Deleted: branches/0.9.x/glade/importcsv.glade.h
===================================================================
--- branches/0.9.x/glade/importcsv.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ branches/0.9.x/glade/importcsv.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,102 +0,0 @@
-char *s = N_("<b>Some Hints</b>:\n"
-             "\n"
-             "On the next step you can assign your csv fields with the one in Griffith.\n"
-             "One CSV-field can be assigned to multiple griffith-fields, i.e. if you have only one title.\n"
-             "Your cast-list should be comma-seperated to break it apart in multiple lines.");
-char *s = N_("Assigned Fields (CSV > Griffith)");
-char *s = N_("CSV Fields");
-char *s = N_("CSV Import");
-char *s = N_("Delimiter");
-char *s = N_("Encoding");
-char *s = N_("Fields");
-char *s = N_("File-Options");
-char *s = N_("From Row");
-char *s = N_("Griffith Fields");
-char *s = N_("If your file has no column headers then you should import from row 0.");
-char *s = N_("Lineterminator");
-char *s = N_("Quotechar");
-char *s = N_("ascii (English)\n"
-             "big5 (Traditional Chinese)\n"
-             "big5hkscs (Traditional Chinese)\n"
-             "cp037 (English)\n"
-             "cp424 (Hebrew)\n"
-             "cp437 (English)\n"
-             "cp500 (Western Europe)\n"
-             "cp737 (Greek)\n"
-             "cp775 (Baltic languages)\n"
-             "cp850 (Western Europe)\n"
-             "cp852 (Central and Eastern Europe)\n"
-             "cp855 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "cp856 (Hebrew)\n"
-             "cp857 (Turkish)\n"
-             "cp860 (Portuguese)\n"
-             "cp861 (Icelandic)\n"
-             "cp862 (Hebrew)\n"
-             "cp863 (Canadian)\n"
-             "cp864 (Arabic)\n"
-             "cp865 (Danish, Norwegian)\n"
-             "cp866 (Russian)\n"
-             "cp869 (Greek)\n"
-             "cp874 (Thai)\n"
-             "cp875 (Greek)\n"
-             "cp932 (Japanese)\n"
-             "cp949 (Korean)\n"
-             "cp950 (Traditional Chinese)\n"
-             "cp1006 (Urdu)\n"
-             "cp1026 (Turkish)\n"
-             "cp1140 (Western Europe)\n"
-             "cp1250 (Central and Eastern Europe)\n"
-             "cp1251 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "cp1252 (Western Europe)\n"
-             "cp1253 (Greek)\n"
-             "cp1254 (Turkish)\n"
-             "cp1255 (Hebrew)\n"
-             "cp1256 (Arabic)\n"
-             "cp1257 (Baltic languages)\n"
-             "cp1258 (Vietnamese)\n"
-             "euc_jp (Japanese)\n"
-             "euc_jis_2004 (Japanese)\n"
-             "euc_jisx0213 (Japanese)\n"
-             "euc_kr (Korean)\n"
-             "gb2312 (Simplified Chinese)\n"
-             "gbk (Unified Chinese)\n"
-             "gb18030 (Unified Chinese)\n"
-             "hz (Simplified Chinese)\n"
-             "iso2022_jp (Japanese)\n"
-             "iso2022_jp_1 (Japanese)\n"
-             "iso2022_jp_2 (Japanese, Korean, Simplified Chinese, Western Europe, Greek)\n"
-             "iso2022_jp_2004 (Japanese)\n"
-             "iso2022_jp_3 (Japanese)\n"
-             "iso2022_jp_ext (Japanese)\n"
-             "iso2022_kr (Korean)\n"
-             "latin_1 (West Europe)\n"
-             "iso8859_2 (Central and Eastern Europe)\n"
-             "iso8859_3 (Esperanto, Maltese)\n"
-             "iso8859_4 (Baltic languagues)\n"
-             "iso8859_5 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "iso8859_6 (Arabic)\n"
-             "iso8859_7 (Greek)\n"
-             "iso8859_8 (Hebrew)\n"
-             "iso8859_9 (Turkish)\n"
-             "iso8859_10 (Nordic languages)\n"
-             "iso8859_13 (Baltic languages)\n"
-             "iso8859_14 (Celtic languages)\n"
-             "iso8859_15 (Western Europe)\n"
-             "johab (Korean)\n"
-             "koi8_r (Russian)\n"
-             "koi8_u (Ukrainian)\n"
-             "mac_cyrillic (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "mac_greek (Greek)\n"
-             "mac_iceland (Icelandic)\n"
-             "mac_latin2 (Central and Eastern Europe)\n"
-             "mac_roman (Western Europe)\n"
-             "mac_turkish (Turkish)\n"
-             "ptcp154 (Kazakh)\n"
-             "shift_jis (Japanese)\n"
-             "shift_jis_2004 (Japanese)\n"
-             "shift_jisx0213 (Japanese)\n"
-             "utf_16 (all languages)\n"
-             "utf_16_be (all languages (BMP only))\n"
-             "utf_16_le (all languages (BMP only))\n"
-             "utf_7 (all languages)\n"
-             "utf_8 (all languages)");

Deleted: branches/0.9.x/po/messages.pot
===================================================================
--- branches/0.9.x/po/messages.pot	2008-11-13 22:30:55 UTC (rev 1036)
+++ branches/0.9.x/po/messages.pot	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,2011 +0,0 @@
-# SOME DESCRIPTIVE TITLE.
-# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
-# This file is distributed under the same license as the PACKAGE package.
-# FIRST AUTHOR <EMAIL at ADDRESS>, YEAR.
-#
-#, fuzzy
-msgid ""
-msgstr ""
-"Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-07-26 21:54+0200\n"
-"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
-"Last-Translator: FULL NAME <EMAIL at ADDRESS>\n"
-"Language-Team: LANGUAGE <LL at li.org>\n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=CHARSET\n"
-"Content-Transfer-Encoding: 8bit\n"
-
-#: ../griffith:212 ../griffith:842 ../lib/delete.py:33 ../lib/edit.py:44
-#: ../lib/edit.py:128
-msgid "You have no movies in your database"
-msgstr ""
-
-#: ../griffith:393
-msgid "You have seen all films in your collection!"
-msgstr ""
-
-#: ../griffith:521 ../griffith:526 ../lib/initialize.py:350
-#: ../lib/initialize.py:637
-msgid "subtitles"
-msgstr ""
-
-#: ../griffith:809
-msgid ""
-"Are you sure you want to restore?\n"
-"Your current movie collection will be replaced.\n"
-"You can't undo this operation."
-msgstr ""
-
-#: ../griffith:819
-msgid ""
-"Are you sure you want to mix?\n"
-"Your current movie collection will be mixed with a backup.\n"
-"You can't undo this operation."
-msgstr ""
-
-#: ../griffith:917
-msgid " movie(s) in collection. "
-msgstr ""
-
-#: ../griffith:918
-msgid " movie(s) loaned. "
-msgstr ""
-
-#: ../griffith:919
-msgid "You haven't seen "
-msgstr ""
-
-#: ../griffith:919
-msgid " movie(s)"
-msgstr ""
-
-#: ../griffith:1121
-msgid ""
-"Are you sure you want to create a new database?\n"
-"You will lose ALL your current data!"
-msgstr ""
-
-#: ../griffith:1125
-msgid ""
-"Last chance!\n"
-"Do you confirm that you want\n"
-"to lose your current data?"
-msgstr ""
-
-#: ../lib/about.py:41
-msgid "Main Authors"
-msgstr ""
-
-#: ../lib/about.py:43
-msgid "Programmers"
-msgstr ""
-
-#: ../lib/about.py:46
-msgid "Contributors:"
-msgstr ""
-
-#: ../lib/about.py:50
-msgid "Logo, icon and general artwork "
-msgstr ""
-
-#: ../lib/about.py:76
-msgid "See TRANSLATORS file"
-msgstr ""
-
-#: ../lib/about.py:84
-msgid "This program is released under the GNU"
-msgstr ""
-
-#: ../lib/add.py:45 ../glade/griffith.glade.h:23
-msgid "Add a new movie"
-msgstr ""
-
-#: ../lib/add.py:56
-msgid "Edit movie"
-msgstr ""
-
-#: ../lib/add.py:374 ../lib/add.py:442 ../lib/cover.py:181
-#: ../lib/main_treeview.py:498
-msgid " min"
-msgstr ""
-
-#: ../lib/add.py:379
-msgid "Movie information has been updated"
-msgstr ""
-
-#: ../lib/add.py:384 ../lib/add.py:613
-msgid ""
-"You should fill the original title\n"
-"or the movie title."
-msgstr ""
-
-#: ../lib/add.py:390 ../lib/add.py:396
-msgid "Movie with that title already exists, are you sure you want to add?"
-msgstr ""
-
-#: ../lib/add.py:575
-msgid "No results"
-msgstr ""
-
-#: ../lib/add.py:621
-msgid "Url: "
-msgstr ""
-
-#: ../lib/add.py:622
-msgid "Language: "
-msgstr ""
-
-#: ../lib/backup.py:32
-msgid "Save Griffith backup"
-msgstr ""
-
-#: ../lib/backup.py:41 ../lib/plugins/export/PluginExportCSV.py:64
-#: ../lib/plugins/export/PluginExportiPod.py:111
-#: ../lib/plugins/export/PluginExportPDF.py:85
-#: ../lib/plugins/export/PluginExportXML.py:65
-msgid "File exists. Do you want to overwrite it?"
-msgstr ""
-
-#: ../lib/backup.py:55
-msgid "Error creating backup"
-msgstr ""
-
-#: ../lib/backup.py:62
-msgid "Backup function is available only for SQLite engine for now"
-msgstr ""
-
-#: ../lib/backup.py:105
-msgid "Backup has been created"
-msgstr ""
-
-#: ../lib/backup.py:109 ../lib/backup.py:183
-msgid "Restore Griffith backup"
-msgstr ""
-
-#: ../lib/backup.py:117 ../lib/backup.py:199
-msgid "Can't read backup file"
-msgstr ""
-
-#: ../lib/backup.py:174
-msgid "Backup restored"
-msgstr ""
-
-#: ../lib/cover.py:42 ../lib/edit.py:46
-msgid "Select image"
-msgstr ""
-
-#: ../lib/cover.py:86 ../lib/cover.py:149
-msgid "Cover generated by Griffith v"
-msgstr ""
-
-#: ../lib/cover.py:88 ../lib/cover.py:151
-#: ../lib/plugins/export/PluginExportHTML.py:743
-#: ../lib/plugins/export/PluginExportPDF.py:167
-msgid "Released Under the GNU/GPL License"
-msgstr ""
-
-#: ../lib/cover.py:176 ../lib/initialize.py:200 ../lib/initialize.py:622
-#: ../lib/plugins/export/PluginExportHTML.py:145
-#: ../lib/plugins/export/PluginExportHTML.py:330 ../glade/griffith.glade.h:97
-msgid "Original Title"
-msgstr ""
-
-#: ../lib/cover.py:177 ../lib/initialize.py:207 ../lib/initialize.py:630
-#: ../lib/plugins/export/PluginExportHTML.py:151 ../glade/griffith.glade.h:148
-msgid "Title"
-msgstr ""
-
-#: ../lib/cover.py:179 ../lib/initialize.py:214 ../lib/initialize.py:612
-#: ../lib/plugins/export/PluginExportHTML.py:136 ../glade/griffith.glade.h:48
-msgid "Director"
-msgstr ""
-
-#: ../lib/cover.py:181
-msgid "Running Time"
-msgstr ""
-
-#: ../lib/cover.py:182 ../lib/initialize.py:611
-#: ../lib/plugins/export/PluginExportHTML.py:135 ../glade/griffith.glade.h:41
-msgid "Country"
-msgstr ""
-
-#: ../lib/cover.py:183 ../lib/initialize.py:221 ../lib/initialize.py:613
-#: ../lib/plugins/export/PluginExportHTML.py:137
-#: ../lib/plugins/export/PluginExportPDF.py:147 ../glade/griffith.glade.h:62
-msgid "Genre"
-msgstr ""
-
-#: ../lib/dbupgrade.py:86 ../lib/plugins/movie/PluginMovieE-Pipoca.py:34
-msgid "Brazilian Portuguese"
-msgstr ""
-
-#: ../lib/dbupgrade.py:87
-msgid "Bulgarian"
-msgstr ""
-
-#: ../lib/dbupgrade.py:88
-msgid "Catalan"
-msgstr ""
-
-#: ../lib/dbupgrade.py:89 ../lib/plugins/movie/PluginMovieCSFD.py:30
-msgid "Czech"
-msgstr ""
-
-#: ../lib/dbupgrade.py:90
-msgid "Danish"
-msgstr ""
-
-#: ../lib/dbupgrade.py:91
-msgid "Dutch"
-msgstr ""
-
-#: ../lib/dbupgrade.py:92 ../lib/plugins/movie/PluginMovieAniDB.py:32
-#: ../lib/plugins/movie/PluginMovieDVDEmpire.py:32
-#: ../lib/plugins/movie/PluginMovieIMDB.py:31
-#: ../lib/plugins/movie/PluginMovieMediadis.py:16
-#: ../lib/plugins/movie/PluginMovieMoviefone.py:16
-msgid "English"
-msgstr ""
-
-#: ../lib/dbupgrade.py:93
-msgid "Estonian"
-msgstr ""
-
-#: ../lib/dbupgrade.py:94 ../lib/plugins/movie/PluginMovieAllocine.py:32
-#: ../lib/plugins/movie/PluginMovieCineMovies.py:31
-msgid "French"
-msgstr ""
-
-#: ../lib/dbupgrade.py:95 ../lib/plugins/movie/PluginMovieDVDPalace.py:33
-#: ../lib/plugins/movie/PluginMovieFilmDb.py:32
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:33
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:31
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:33
-#: ../lib/plugins/movie/PluginMovieOFDb.py:17
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:33
-msgid "German"
-msgstr ""
-
-#: ../lib/dbupgrade.py:96
-msgid "Greek"
-msgstr ""
-
-#: ../lib/dbupgrade.py:97
-msgid "Hungarian"
-msgstr ""
-
-#: ../lib/dbupgrade.py:98
-msgid "Indonesian"
-msgstr ""
-
-#: ../lib/dbupgrade.py:99 ../lib/plugins/movie/PluginMovieCinematografo.py:30
-msgid "Italian"
-msgstr ""
-
-#: ../lib/dbupgrade.py:100
-msgid "Japanese"
-msgstr ""
-
-#: ../lib/dbupgrade.py:101
-msgid "Korean"
-msgstr ""
-
-#: ../lib/dbupgrade.py:102
-msgid "Norwegian Bokmal"
-msgstr ""
-
-#: ../lib/dbupgrade.py:103
-msgid "Occitan"
-msgstr ""
-
-#: ../lib/dbupgrade.py:104
-msgid "Pashto"
-msgstr ""
-
-#: ../lib/dbupgrade.py:105 ../lib/plugins/movie/PluginMovieFDb.py:33
-#: ../lib/plugins/movie/PluginMovieFilmweb.py:31
-#: ../lib/plugins/movie/PluginMovieOnet.py:31
-#: ../lib/plugins/movie/PluginMovieStopklatka.py:31
-#: ../lib/plugins/movie/PluginMovieTanukiAnime.py:31
-#: ../lib/plugins/movie/PluginMovieWP.py:32
-msgid "Polish"
-msgstr ""
-
-#: ../lib/dbupgrade.py:106 ../lib/plugins/movie/PluginMovie7arte.py:32
-#: ../lib/plugins/movie/PluginMovieCineteka.py:32
-#: ../lib/plugins/movie/PluginMoviePTGate.py:32
-msgid "Portuguese"
-msgstr ""
-
-#: ../lib/dbupgrade.py:107
-msgid "Russian"
-msgstr ""
-
-#: ../lib/dbupgrade.py:108
-msgid "Simplified Chinese"
-msgstr ""
-
-#: ../lib/dbupgrade.py:109
-msgid "Slovak"
-msgstr ""
-
-#: ../lib/dbupgrade.py:110 ../lib/plugins/movie/PluginMovieCulturalia.py:32
-#: ../lib/plugins/movie/PluginMovieFilmAffinity.py:32
-#: ../lib/plugins/movie/PluginMovieIMDB-es.py:32
-msgid "Spanish"
-msgstr ""
-
-#: ../lib/dbupgrade.py:111 ../lib/plugins/movie/PluginMovieFilmtipset.py:33
-msgid "Swedish"
-msgstr ""
-
-#: ../lib/dbupgrade.py:112
-msgid "Turkish"
-msgstr ""
-
-#: ../lib/dbupgrade.py:115
-msgid "Favourite"
-msgstr ""
-
-#: ../lib/dbupgrade.py:137
-msgid ""
-"Griffith will now convert your database to the new format. This can take "
-"several minutes if you have a large database."
-msgstr ""
-
-#: ../lib/dbupgrade.py:151
-msgid "Old DB conversion: please install pysqlite legacy (v1.0)"
-msgstr ""
-
-#: ../lib/dbupgrade.py:180
-msgid ""
-"Your database is most probably in SQLite2 format, please convert it to "
-"SQLite3"
-msgstr ""
-
-#: ../lib/delete.py:37
-msgid "You can't delete movie while it is loaned."
-msgstr ""
-
-#: ../lib/delete.py:39
-msgid "Are you sure you want to delete this movie?"
-msgstr ""
-
-#: ../lib/edit.py:58
-msgid "Image not valid."
-msgstr ""
-
-#: ../lib/edit.py:88 ../lib/edit.py:106
-msgid "Image has been updated"
-msgstr ""
-
-#: ../lib/edit.py:95
-msgid "Are you sure you want to delete this poster?"
-msgstr ""
-
-#: ../lib/edit.py:149 ../lib/edit.py:156
-msgid "No posters found for this movie."
-msgstr ""
-
-#: ../lib/edit.py:200 ../lib/movie.py:147
-msgid "Fetching poster"
-msgstr ""
-
-#: ../lib/edit.py:200 ../lib/movie.py:121 ../lib/movie.py:147
-#: ../lib/movie.py:241
-msgid "Wait a moment"
-msgstr ""
-
-#: ../lib/edit.py:212
-msgid "Sorry. A connection error has occurred."
-msgstr ""
-
-#: ../lib/edit.py:225 ../lib/edit.py:258
-msgid "Sorry. This movie is listed but has no poster available at Amazon.com."
-msgstr ""
-
-#: ../lib/edit.py:244
-msgid "Do you want to use this poster instead?"
-msgstr ""
-
-#: ../lib/gconsole.py:133
-msgid "No movie found"
-msgstr ""
-
-#: ../lib/gemail.py:39
-msgid "Connection timed out"
-msgstr ""
-
-#: ../lib/gemail.py:50 ../lib/gemail.py:60
-#, python-format
-msgid "Error sending e-mail: %s"
-msgstr ""
-
-#: ../lib/gemail.py:50
-msgid "login failure"
-msgstr ""
-
-#: ../lib/gemail.py:57
-msgid "E-mail sent sucessfuly"
-msgstr ""
-
-#: ../lib/gemail.py:77
-msgid "Movie loan reminder"
-msgstr ""
-
-#: ../lib/gemail.py:77
-#, python-format
-msgid ""
-"Hi, %s!\n"
-"\n"
-"Just to remind you "
-msgstr ""
-
-#: ../lib/gemail.py:83
-msgid "Mail could not be sent. Please check e-mail preferences."
-msgstr ""
-
-#: ../lib/gemail.py:85
-msgid "This person has no e-mail address defined."
-msgstr ""
-
-#: ../lib/gutils.py:265
-msgid "Images"
-msgstr ""
-
-#: ../lib/gutils.py:276 ../lib/plugins/imp/__init__.py:202
-msgid "All files"
-msgstr ""
-
-#: ../lib/initialize.py:187
-msgid "N."
-msgstr ""
-
-#: ../lib/initialize.py:194 ../lib/initialize.py:614
-#: ../lib/plugins/export/PluginExportHTML.py:138 ../glade/griffith.glade.h:69
-msgid "Image"
-msgstr ""
-
-#: ../lib/initialize.py:228 ../lib/initialize.py:627
-#: ../lib/plugins/export/PluginExportHTML.py:150 ../glade/griffith.glade.h:127
-msgid "Seen it"
-msgstr ""
-
-#: ../lib/initialize.py:236 ../lib/initialize.py:634
-#: ../lib/plugins/export/PluginExportHTML.py:152 ../glade/griffith.glade.h:162
-msgid "Year"
-msgstr ""
-
-#: ../lib/initialize.py:245 ../lib/initialize.py:626
-#: ../lib/plugins/export/PluginExportHTML.py:148 ../glade/griffith.glade.h:123
-msgid "Runtime"
-msgstr ""
-
-#: ../lib/initialize.py:254 ../lib/initialize.py:624
-#: ../lib/plugins/export/PluginExportHTML.py:147 ../glade/griffith.glade.h:113
-msgid "Rating"
-msgstr ""
-
-#: ../lib/initialize.py:306
-msgid "Loan Date"
-msgstr ""
-
-#: ../lib/initialize.py:312
-msgid "Return Date"
-msgstr ""
-
-#: ../lib/initialize.py:317
-msgid "Loaned To"
-msgstr ""
-
-#: ../lib/initialize.py:336 ../lib/plugins/movie/PluginMovieIMDB-de.py:145
-#: ../lib/plugins/movie/PluginMovieIMDB.py:140
-msgid "Language"
-msgstr ""
-
-#: ../lib/initialize.py:348 ../lib/initialize.py:637
-msgid "lector"
-msgstr ""
-
-#: ../lib/initialize.py:349 ../lib/initialize.py:637
-msgid "dubbing"
-msgstr ""
-
-#: ../lib/initialize.py:351 ../lib/initialize.py:637
-msgid "commentary"
-msgstr ""
-
-#: ../lib/initialize.py:358 ../glade/griffith.glade.h:151
-msgid "Type"
-msgstr ""
-
-#: ../lib/initialize.py:373
-msgid "Codec"
-msgstr ""
-
-#: ../lib/initialize.py:388
-msgid "Channels"
-msgstr ""
-
-#: ../lib/initialize.py:403
-msgid "Subtitle format"
-msgstr ""
-
-#: ../lib/initialize.py:519 ../glade/griffith.glade.h:91
-msgid "Name"
-msgstr ""
-
-#: ../lib/initialize.py:525 ../glade/exporthtml.glade.h:16
-#: ../glade/griffith.glade.h:50 ../glade/import.glade.h:5
-msgid "E-mail"
-msgstr ""
-
-#: ../lib/initialize.py:573
-msgid "Last added"
-msgstr ""
-
-#: ../lib/initialize.py:606 ../lib/plugins/export/PluginExportHTML.py:133
-#: ../lib/plugins/export/PluginExportPDF.py:153 ../glade/griffith.glade.h:33
-msgid "Cast"
-msgstr ""
-
-#: ../lib/initialize.py:607 ../lib/plugins/export/PluginExportHTML.py:134
-#: ../glade/griffith.glade.h:35
-msgid "Classification"
-msgstr ""
-
-#: ../lib/initialize.py:608 ../lib/plugins/export/PluginExportHTML.py:161
-#: ../glade/griffith.glade.h:38
-msgid "Collection"
-msgstr ""
-
-#: ../lib/initialize.py:609 ../lib/initialize.py:636
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:149
-#: ../lib/plugins/movie/PluginMovieIMDB.py:144 ../glade/griffith.glade.h:39
-msgid "Color"
-msgstr ""
-
-#: ../lib/initialize.py:610 ../glade/griffith.glade.h:40
-msgid "Condition"
-msgstr ""
-
-#: ../lib/initialize.py:615 ../glade/griffith.glade.h:73
-msgid "Layers"
-msgstr ""
-
-#: ../lib/initialize.py:616 ../lib/plugins/export/PluginExportHTML.py:142
-msgid "Loaned"
-msgstr ""
-
-#: ../lib/initialize.py:617 ../lib/plugins/export/PluginExportHTML.py:143
-#: ../glade/griffith.glade.h:49
-msgid "Discs"
-msgstr ""
-
-#: ../lib/initialize.py:618 ../glade/griffith.glade.h:86
-msgid "Medium"
-msgstr ""
-
-#: ../lib/initialize.py:619 ../lib/plugins/export/PluginExportHTML.py:153
-#: ../glade/griffith.glade.h:94
-msgid "Notes"
-msgstr ""
-
-#: ../lib/initialize.py:620 ../lib/sql.py:278
-#: ../lib/plugins/export/PluginExportHTML.py:144 ../glade/griffith.glade.h:95
-msgid "Number"
-msgstr ""
-
-#: ../lib/initialize.py:621 ../lib/plugins/export/PluginExportHTML.py:139
-#: ../glade/griffith.glade.h:96
-msgid "Official site"
-msgstr ""
-
-#: ../lib/initialize.py:623 ../lib/plugins/export/PluginExportHTML.py:146
-#: ../glade/griffith.glade.h:105
-msgid "Plot"
-msgstr ""
-
-#: ../lib/initialize.py:625 ../glade/griffith.glade.h:115
-msgid "Region"
-msgstr ""
-
-#: ../lib/initialize.py:628 ../lib/plugins/export/PluginExportHTML.py:140
-#: ../glade/griffith.glade.h:137
-msgid "Site"
-msgstr ""
-
-#: ../lib/initialize.py:629 ../lib/plugins/export/PluginExportHTML.py:149
-#: ../glade/griffith.glade.h:143
-msgid "Studio"
-msgstr ""
-
-#: ../lib/initialize.py:631 ../lib/plugins/export/PluginExportHTML.py:141
-#: ../glade/griffith.glade.h:150
-msgid "Trailer"
-msgstr ""
-
-#: ../lib/initialize.py:632 ../lib/plugins/export/PluginExportHTML.py:164
-#: ../glade/griffith.glade.h:157
-msgid "Video codec"
-msgstr ""
-
-#: ../lib/initialize.py:633 ../lib/plugins/export/PluginExportHTML.py:162
-#: ../glade/griffith.glade.h:160
-msgid "Volume"
-msgstr ""
-
-#: ../lib/initialize.py:635 ../lib/initialize.py:636 ../lib/initialize.py:638
-#: ../lib/initialize.py:860 ../lib/initialize.py:861 ../lib/initialize.py:892
-#: ../lib/initialize.py:893
-msgid "N/A"
-msgstr ""
-
-#: ../lib/initialize.py:635
-msgid "Damaged"
-msgstr ""
-
-#: ../lib/initialize.py:635
-msgid "Poor"
-msgstr ""
-
-#: ../lib/initialize.py:635
-msgid "Fair"
-msgstr ""
-
-#: ../lib/initialize.py:635
-msgid "Good"
-msgstr ""
-
-#: ../lib/initialize.py:635
-msgid "Excellent"
-msgstr ""
-
-#: ../lib/initialize.py:636
-msgid "Black and White"
-msgstr ""
-
-#: ../lib/initialize.py:636
-msgid "Mixed"
-msgstr ""
-
-#: ../lib/initialize.py:638
-msgid "Single Side, Single Layer"
-msgstr ""
-
-#: ../lib/initialize.py:638
-msgid "Single Side, Dual Layer"
-msgstr ""
-
-#: ../lib/initialize.py:638
-msgid "Dual Side, Single Layer"
-msgstr ""
-
-#: ../lib/initialize.py:638
-msgid "Dual Side, Dual Layer"
-msgstr ""
-
-#: ../lib/initialize.py:640
-msgid "Region 0 (No Region Coding)"
-msgstr ""
-
-#: ../lib/initialize.py:641
-msgid "Region 1 (United States of America, Canada)"
-msgstr ""
-
-#: ../lib/initialize.py:642
-msgid ""
-"Region 2 (Europe,including France, Greece, Turkey, Egypt, Arabia, Japan and "
-"South Africa)"
-msgstr ""
-
-#: ../lib/initialize.py:643
-msgid "Region 3 (Korea, Thailand, Vietnam, Borneo and Indonesia)"
-msgstr ""
-
-#: ../lib/initialize.py:644
-msgid ""
-"Region 4 (Australia and New Zealand, Mexico, the Caribbean, and South "
-"America)"
-msgstr ""
-
-#: ../lib/initialize.py:645
-msgid "Region 5 (India, Africa, Russia and former USSR countries)"
-msgstr ""
-
-#: ../lib/initialize.py:646
-msgid "Region 6 (Popular Republic of China)"
-msgstr ""
-
-#: ../lib/initialize.py:647
-msgid "Region 7 (Reserved for Unspecified Special Use)"
-msgstr ""
-
-#: ../lib/initialize.py:648
-msgid "Region 8 (Airlines/Cruise Ships)"
-msgstr ""
-
-#: ../lib/initialize.py:685
-msgid "Dictionary not available. Spellcheck will be disabled. \n"
-msgstr ""
-
-#: ../lib/loan.py:40
-msgid "No person is defined yet."
-msgstr ""
-
-#: ../lib/loan.py:67
-msgid "Do you want to loan whole collection?"
-msgstr ""
-
-#: ../lib/loan.py:79
-msgid "Movie loaned"
-msgstr ""
-
-#: ../lib/main_treeview.py:245
-msgid "This movie has been loaned to "
-msgstr ""
-
-#: ../lib/main_treeview.py:245
-msgid " on "
-msgstr ""
-
-#: ../lib/main_treeview.py:256
-msgid "Movie not loaned"
-msgstr ""
-
-#: ../lib/movie.py:121
-msgid "Fetching data"
-msgstr ""
-
-#: ../lib/movie.py:241
-msgid "Searching"
-msgstr ""
-
-#: ../lib/movie.py:280
-msgid "Connection error"
-msgstr ""
-
-#: ../lib/movie.py:320
-msgid "Cancel"
-msgstr ""
-
-#: ../lib/people.py:59
-msgid "You should fill the person name"
-msgstr ""
-
-#: ../lib/people.py:88
-msgid "Record updated"
-msgstr ""
-
-#: ../lib/people.py:111
-msgid "This person has loaned films from you. Return them first."
-msgstr ""
-
-#: ../lib/people.py:116
-msgid ""
-"This person has data in the loan history. This data will be erased if you "
-"continue."
-msgstr ""
-
-#: ../lib/people.py:117
-#, python-format
-msgid ""
-"%s\n"
-"Are you sure you want to delete this person?"
-msgstr ""
-
-#: ../lib/sql.py:61 ../lib/sql.py:123
-msgid ""
-"This item is in use.\n"
-"Operation aborted!"
-msgstr ""
-
-#: ../lib/sql.py:82
-msgid "This name is already in use!"
-msgstr ""
-
-#: ../lib/sql.py:278
-#, python-format
-msgid "Column \"%s\" is not unique"
-msgstr ""
-
-#: ../lib/sql.py:348
-msgid ""
-"Cannot connect to database.\n"
-"Falling back to SQLite."
-msgstr ""
-
-#: ../lib/sql.py:348
-msgid "Please check debug output for more informations."
-msgstr ""
-
-#: ../lib/sql.py:356
-msgid "Database connection failed."
-msgstr ""
-
-#: ../lib/version.py:30
-msgid "Griffith is a film collection manager."
-msgstr ""
-
-#: ../lib/view.py:28
-msgid "Filter activated. Showing only not seen movies."
-msgstr ""
-
-#: ../lib/view.py:32
-msgid "Filter activated. Showing only loaned movies."
-msgstr ""
-
-#: ../lib/view.py:42
-#, python-format
-msgid "Filter activated. Showing only movies from volume: %s"
-msgstr ""
-
-#: ../lib/view.py:49
-#, python-format
-msgid "Filter activated. Showing only movies from collection: %s"
-msgstr ""
-
-#: ../lib/widgets.py:317
-msgid ""
-"Define here the PDF reader you want to use within Griffith. Popular choices "
-"are xpdf, gpdf, evince or kpdf. Make sure you have this program installed "
-"and working first."
-msgstr ""
-
-#: ../lib/widgets.py:318
-msgid ""
-"Here you can define the desired language to use while spell checking some "
-"fields. Use you locale setting. For example, to use european portuguese "
-"spell checking enter 'pt'"
-msgstr ""
-
-#: ../lib/widgets.py:319
-msgid ""
-"Use this entry to define the SMTP server you want to use to send e-mails. On "
-"*nix systems, 'localhost' should work. Alternatively, you can use your "
-"Internet Service Provider's SMTP server address."
-msgstr ""
-
-#: ../lib/widgets.py:320
-msgid ""
-"This is the from e-mail address that should be used to all outgoing e-mail. "
-"You want to include your own e-mail address here probably."
-msgstr ""
-
-#: ../lib/widgets.py:321
-msgid ""
-"Here you can define the smtp server port to use. If you want to use your "
-"gmail account service to send e-mails, try to enter '587' here. Default (and "
-"the most common one) is '25'"
-msgstr ""
-
-#: ../lib/widgets.py:322
-msgid ""
-"If you need TLS support, please check this checkbox. This is needed, for "
-"example, when using gmail service to send your reminder e-mails."
-msgstr ""
-
-#: ../lib/plugins/movie/PluginMovieCinematografo.py:93
-#: ../lib/plugins/movie/PluginMovieFDb.py:103
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:85
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:197
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:198
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:199
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:200
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:201
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:202
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:203
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:222
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:223
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:224
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:225
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:226
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:227
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:228
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:229
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:248
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:249
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:250
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:251
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:252
-#: ../lib/plugins/movie/PluginMovieFilmweb.py:106
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:100
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:101
-#: ../lib/plugins/movie/PluginMovieIMDB-es.py:101
-#: ../lib/plugins/movie/PluginMovieIMDB.py:93
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:155
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:330
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:331
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:332
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:333
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:334
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:335
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:336
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:337
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:407
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:408
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:409
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:410
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:411
-#: ../lib/plugins/movie/PluginMovieOFDb.py:83
-#: ../lib/plugins/movie/PluginMovieOFDb.py:182
-#: ../lib/plugins/movie/PluginMovieOFDb.py:183
-#: ../lib/plugins/movie/PluginMovieOFDb.py:184
-#: ../lib/plugins/movie/PluginMovieOFDb.py:234
-#: ../lib/plugins/movie/PluginMovieOFDb.py:297
-#: ../lib/plugins/movie/PluginMovieOFDb.py:298
-#: ../lib/plugins/movie/PluginMovieOFDb.py:299
-#: ../lib/plugins/movie/PluginMovieOnet.py:102
-#: ../lib/plugins/movie/PluginMovieWP.py:96
-#: ../lib/plugins/movie/PluginMovieWP.py:98
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:104
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:201
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:202
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:203
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:204
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:205
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:206
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:207
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:208
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:209
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:210
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:211
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:212
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:231
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:232
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:233
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:234
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:235
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:236
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:237
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:238
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:239
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:240
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:241
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:242
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:243
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:244
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:245
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:246
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:247
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:248
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:249
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:250
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:251
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:252
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:253
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:254
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:255
-msgid " as "
-msgstr ""
-
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:147
-#: ../lib/plugins/movie/PluginMovieIMDB.py:142 ../glade/griffith.glade.h:4
-msgid "<b>Audio</b>"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportCSV.py:31
-msgid "Full CSV list export plugin"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportCSV.py:53
-#: ../lib/plugins/export/PluginExportCSV.py:56
-#: ../lib/plugins/export/PluginExportiPod.py:106
-#: ../lib/plugins/export/PluginExportXML.py:54
-#: ../lib/plugins/export/PluginExportXML.py:57
-#, python-format
-msgid "Export a %s document"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportCSV.py:79
-#: ../lib/plugins/export/PluginExportXML.py:97
-#, python-format
-msgid "%s file has been created."
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:36
-msgid "Plugin exports data using templates"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:48
-msgid "Griffith's movies list"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:160 ../glade/griffith.glade.h:85
-msgid "Media"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:504
-#: ../lib/plugins/export/PluginExportHTML.py:506
-msgid "previous"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:517
-#: ../lib/plugins/export/PluginExportHTML.py:519
-msgid "next"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:648
-#: ../lib/plugins/export/PluginExportHTML.py:690
-#: ../lib/plugins/export/PluginExportHTML.py:787
-#, python-format
-msgid "Can't create %s!"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:679
-#, python-format
-msgid ""
-"Directory %s already exists.\n"
-"Do you want to overwrite it?"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:683
-#, python-format
-msgid "Can't remove %s!"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:698
-#: ../lib/plugins/export/PluginExportHTML.py:711
-#, python-format
-msgid "Can't copy %s!"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:733
-#, python-format
-msgid "Can't open %s!"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:741
-#: ../lib/plugins/export/PluginExportPDF.py:165
-msgid "Document generated by Griffith v"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:809
-msgid "Yes"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:811
-msgid "No"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportHTML.py:884
-msgid "Document has been generated."
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportiPod.py:36
-msgid "iPod Notes export plugin"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportiPod.py:85
-msgid "My Movies List"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportiPod.py:101
-msgid "List was successful exported to iPod."
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportiPod.py:103
-msgid "iPod is not connected."
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportiPod.py:118
-msgid ""
-"List was successful exported. Now you should move it to the 'Notes' folder "
-"on your iPod."
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportPDF.py:47
-msgid "PDF export plugin"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportPDF.py:75
-#: ../lib/plugins/export/PluginExportPDF.py:77
-msgid "Export a PDF"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportPDF.py:106
-msgid "List of films"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportPDF.py:109
-#, python-format
-msgid "Total Movies: %s"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportPDF.py:158
-msgid "PDF has been created."
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportPDF.py:163
-#, python-format
-msgid "Page %d"
-msgstr ""
-
-#: ../lib/plugins/export/PluginExportXML.py:32
-msgid "Full XML list export plugin"
-msgstr ""
-
-#: ../lib/plugins/imp/CSV.py:43
-msgid "Full CSV list import plugin"
-msgstr ""
-
-#: ../lib/plugins/imp/CSV.py:192
-msgid "Please assign at least one field first!"
-msgstr ""
-
-#: ../lib/plugins/imp/CSV.py:310
-#, python-format
-msgid "Can't open the file %s"
-msgstr ""
-
-#: ../lib/plugins/imp/__init__.py:227
-#, python-format
-msgid "%s file has been imported. %s movies added."
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:1
-msgid "<b>Example</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:2
-msgid "<b>Export</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:3
-msgid "<b>Header</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:4
-msgid "<b>Limits</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:5 ../glade/griffith.glade.h:15
-msgid "<b>Sort by</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:6
-msgid "<b>Split into</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:7
-msgid "<b>Style</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:8
-msgid "<b>Template</b>"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:9 ../glade/import.glade.h:3
-msgid "Author"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:10
-msgid "Black and white"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:11
-msgid "Choose style file"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:12
-msgid "Convert images"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:13
-msgid "Data"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:14 ../glade/import.glade.h:4
-msgid "Description"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:15
-msgid "Destination"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:17
-msgid "Export"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:18
-msgid "Export data"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:19
-msgid "Format"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:20
-msgid "Maximal height"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:21
-msgid "Maximal width"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:22
-msgid "Posters"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:23 ../glade/griffith.glade.h:122
-msgid "Reverse"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:24
-msgid "Template"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:25
-msgid "Use custom file"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:26 ../glade/import.glade.h:10
-msgid "Version"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:27
-msgid "entries per page"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:28
-msgid "files"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:29
-msgid "loaned only"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:30
-msgid "none"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:31
-msgid "not loaned only"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:32
-msgid "seen only"
-msgstr ""
-
-#: ../glade/exporthtml.glade.h:33
-msgid "unseen only"
-msgstr ""
-
-#: ../glade/griffith.glade.h:1
-msgid "0 means no limits"
-msgstr ""
-
-#: ../glade/griffith.glade.h:2
-msgid "<b>Audio channels</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:3
-msgid "<b>Audio codecs</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:5
-msgid "<b>Collection</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:6
-msgid "<b>Defaults</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:7
-msgid "<b>E-mail reminder</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:8
-msgid "<b>Languages</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:9
-msgid "<b>Loan History</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:10
-msgid "<b>Media</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:11
-msgid "<b>Search for:</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:12
-msgid "<b>Search results</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:13
-msgid "<b>Select database to use</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:14
-msgid "<b>Show only the following columns</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:16
-msgid "<b>Subtitle formats</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:17
-msgid "<b>Subtitles</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:18
-msgid "<b>Tags</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:19
-msgid "<b>Use spell checking on the following fields:</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:20
-msgid "<b>Video codecs</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:21
-msgid "<b>Volume</b>"
-msgstr ""
-
-#: ../glade/griffith.glade.h:22
-msgid "Add"
-msgstr ""
-
-#: ../glade/griffith.glade.h:24
-msgid "Add a new person"
-msgstr ""
-
-#: ../glade/griffith.glade.h:25
-msgid "Add movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:26
-msgid "Add movie and close"
-msgstr ""
-
-#: ../glade/griffith.glade.h:27
-msgid "Add new movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:28
-msgid "All Movies"
-msgstr ""
-
-#: ../glade/griffith.glade.h:29
-msgid "Attempt to fetch a big poster from Amazon services Web site"
-msgstr ""
-
-#: ../glade/griffith.glade.h:30
-msgid "By Collection"
-msgstr ""
-
-#: ../glade/griffith.glade.h:31
-msgid "By Tag"
-msgstr ""
-
-#: ../glade/griffith.glade.h:32
-msgid "By Volume"
-msgstr ""
-
-#: ../glade/griffith.glade.h:34
-msgid "Choose Image"
-msgstr ""
-
-#: ../glade/griffith.glade.h:36
-msgid "Clears filter"
-msgstr ""
-
-#: ../glade/griffith.glade.h:37
-msgid "Clone"
-msgstr ""
-
-#: ../glade/griffith.glade.h:42
-msgid "DVD layers"
-msgstr ""
-
-#: ../glade/griffith.glade.h:43
-msgid "DVD region"
-msgstr ""
-
-#: ../glade/griffith.glade.h:44
-msgid "Database"
-msgstr ""
-
-#: ../glade/griffith.glade.h:45
-msgid "Delete a person"
-msgstr ""
-
-#: ../glade/griffith.glade.h:46
-msgid "Details"
-msgstr ""
-
-#: ../glade/griffith.glade.h:47
-msgid "Dictionaries"
-msgstr ""
-
-#: ../glade/griffith.glade.h:51
-msgid "E-mail reminder"
-msgstr ""
-
-#: ../glade/griffith.glade.h:52
-msgid "E_xport"
-msgstr ""
-
-#: ../glade/griffith.glade.h:53
-msgid "Edit a person"
-msgstr ""
-
-#: ../glade/griffith.glade.h:54
-msgid "Edit movie details"
-msgstr ""
-
-#: ../glade/griffith.glade.h:55
-msgid "Favorite Movie Plugin"
-msgstr ""
-
-#: ../glade/griffith.glade.h:56
-msgid "Fetch from Amazon"
-msgstr ""
-
-#: ../glade/griffith.glade.h:57
-msgid "Fill empty fields only"
-msgstr ""
-
-#: ../glade/griffith.glade.h:58
-msgid "Filter "
-msgstr ""
-
-#: ../glade/griffith.glade.h:59
-msgid "Font for reports"
-msgstr ""
-
-#: ../glade/griffith.glade.h:60
-msgid "Forum"
-msgstr ""
-
-#: ../glade/griffith.glade.h:61
-msgid "Found Results"
-msgstr ""
-
-#: ../glade/griffith.glade.h:63
-msgid "Get from web"
-msgstr ""
-
-#: ../glade/griffith.glade.h:64
-msgid "Get movie data from:"
-msgstr ""
-
-#: ../glade/griffith.glade.h:65
-msgid "Griffith"
-msgstr ""
-
-#: ../glade/griffith.glade.h:66
-msgid "Homepage"
-msgstr ""
-
-#: ../glade/griffith.glade.h:67
-msgid "Host"
-msgstr ""
-
-#: ../glade/griffith.glade.h:68
-msgid "I_mport"
-msgstr ""
-
-#: ../glade/griffith.glade.h:70
-msgid "Include Front Image"
-msgstr ""
-
-#: ../glade/griffith.glade.h:71
-msgid "Include movie number"
-msgstr ""
-
-#: ../glade/griffith.glade.h:72
-msgid "Languages"
-msgstr ""
-
-#: ../glade/griffith.glade.h:74
-msgid "Limit search results to"
-msgstr ""
-
-#: ../glade/griffith.glade.h:75
-msgid "Load poster from disk"
-msgstr ""
-
-#: ../glade/griffith.glade.h:76
-msgid "Loan"
-msgstr ""
-
-#: ../glade/griffith.glade.h:77
-msgid "Loan Management"
-msgstr ""
-
-#: ../glade/griffith.glade.h:78
-msgid "Loan movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:79
-msgid "Loan to"
-msgstr ""
-
-#: ../glade/griffith.glade.h:80
-msgid "Loaned Movies"
-msgstr ""
-
-#: ../glade/griffith.glade.h:81
-msgid "Loaned to"
-msgstr ""
-
-#: ../glade/griffith.glade.h:82
-msgid "Loans"
-msgstr ""
-
-#: ../glade/griffith.glade.h:83
-msgid "Main list"
-msgstr ""
-
-#: ../glade/griffith.glade.h:84
-msgid "Manage People"
-msgstr ""
-
-#: ../glade/griffith.glade.h:87
-msgid ""
-"Meter\n"
-"Stars"
-msgstr ""
-
-#: ../glade/griffith.glade.h:89
-msgid "Movie details"
-msgstr ""
-
-#: ../glade/griffith.glade.h:90
-msgid "Movie information"
-msgstr ""
-
-#: ../glade/griffith.glade.h:92
-msgid "Needs authentication"
-msgstr ""
-
-#: ../glade/griffith.glade.h:93
-msgid "Not Seen Movies"
-msgstr ""
-
-#: ../glade/griffith.glade.h:98
-msgid "Original title"
-msgstr ""
-
-#: ../glade/griffith.glade.h:99
-msgid "Other"
-msgstr ""
-
-#: ../glade/griffith.glade.h:100
-msgid "PDF reader"
-msgstr ""
-
-#: ../glade/griffith.glade.h:101
-msgid "Password"
-msgstr ""
-
-#: ../glade/griffith.glade.h:102
-msgid "People"
-msgstr ""
-
-#: ../glade/griffith.glade.h:103
-msgid "Phone"
-msgstr ""
-
-#: ../glade/griffith.glade.h:104
-msgid "Please wait a moment..."
-msgstr ""
-
-#: ../glade/griffith.glade.h:106
-msgid "Plugins"
-msgstr ""
-
-#: ../glade/griffith.glade.h:107
-msgid "Port"
-msgstr ""
-
-#: ../glade/griffith.glade.h:108
-msgid "Poster image"
-msgstr ""
-
-#: ../glade/griffith.glade.h:109
-msgid "Poster viewer"
-msgstr ""
-
-#: ../glade/griffith.glade.h:110
-msgid "Preferences"
-msgstr ""
-
-#: ../glade/griffith.glade.h:111
-msgid "Print Cover"
-msgstr ""
-
-#: ../glade/griffith.glade.h:112
-msgid "Print cover"
-msgstr ""
-
-#: ../glade/griffith.glade.h:114
-msgid "Rating image"
-msgstr ""
-
-#: ../glade/griffith.glade.h:116
-msgid "Remove"
-msgstr ""
-
-#: ../glade/griffith.glade.h:117
-msgid "Remove selected movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:118
-msgid "Removes poster"
-msgstr ""
-
-#: ../glade/griffith.glade.h:119
-msgid "Rename"
-msgstr ""
-
-#: ../glade/griffith.glade.h:120
-msgid "Report bug"
-msgstr ""
-
-#: ../glade/griffith.glade.h:121
-msgid "Return"
-msgstr ""
-
-#: ../glade/griffith.glade.h:124
-msgid "SMTP port"
-msgstr ""
-
-#: ../glade/griffith.glade.h:125
-msgid "SMTP server"
-msgstr ""
-
-#: ../glade/griffith.glade.h:126
-msgid "Searching on the web"
-msgstr ""
-
-#: ../glade/griffith.glade.h:128
-msgid "Select A File"
-msgstr ""
-
-#: ../glade/griffith.glade.h:129
-msgid "Select first movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:130
-msgid "Select last movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:131
-msgid "Select next movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:132
-msgid "Select previous movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:133
-msgid "Sender E-mail address"
-msgstr ""
-
-#: ../glade/griffith.glade.h:134
-msgid "Show other movies in this collection"
-msgstr ""
-
-#: ../glade/griffith.glade.h:135
-msgid "Show other movies in this volume"
-msgstr ""
-
-#: ../glade/griffith.glade.h:136
-msgid "Simple"
-msgstr ""
-
-#: ../glade/griffith.glade.h:138
-msgid "Size"
-msgstr ""
-
-#: ../glade/griffith.glade.h:139
-msgid "Spell check the following language"
-msgstr ""
-
-#: ../glade/griffith.glade.h:140
-msgid ""
-"Standard\n"
-"Slim\n"
-"Double Slim"
-msgstr ""
-
-#: ../glade/griffith.glade.h:144
-msgid "Suggest an unseen movie"
-msgstr ""
-
-#: ../glade/griffith.glade.h:145
-msgid "Tags"
-msgstr ""
-
-#: ../glade/griffith.glade.h:146
-msgid "Technical information"
-msgstr ""
-
-#: ../glade/griffith.glade.h:147
-msgid "This movie is part of..."
-msgstr ""
-
-#: ../glade/griffith.glade.h:149
-msgid "Toolbar"
-msgstr ""
-
-#: ../glade/griffith.glade.h:152
-msgid ""
-"Type in the original film tile, select source and choose <i>Get from web</"
-"i>. Griffith will try to fetch all the related information from the Web."
-msgstr ""
-
-#: ../glade/griffith.glade.h:153
-msgid "Use Spellchecker"
-msgstr ""
-
-#: ../glade/griffith.glade.h:154
-msgid "Use TLS?"
-msgstr ""
-
-#: ../glade/griffith.glade.h:155
-msgid "Use locale:"
-msgstr ""
-
-#: ../glade/griffith.glade.h:156
-msgid "Username"
-msgstr ""
-
-#: ../glade/griffith.glade.h:158
-msgid "Visit movie web site"
-msgstr ""
-
-#: ../glade/griffith.glade.h:159
-msgid "Visit the oficial web site"
-msgstr ""
-
-#: ../glade/griffith.glade.h:161
-msgid "Watch the trailer"
-msgstr ""
-
-#: ../glade/griffith.glade.h:163
-msgid "_Edit"
-msgstr ""
-
-#: ../glade/griffith.glade.h:164
-msgid "_File"
-msgstr ""
-
-#: ../glade/griffith.glade.h:165
-msgid "_Help"
-msgstr ""
-
-#: ../glade/griffith.glade.h:166
-msgid "_Loans"
-msgstr ""
-
-#: ../glade/griffith.glade.h:167
-msgid "_Tools"
-msgstr ""
-
-#: ../glade/griffith.glade.h:168
-msgid "_View"
-msgstr ""
-
-#: ../glade/griffith.glade.h:169
-msgid "add entered name to collections list"
-msgstr ""
-
-#: ../glade/griffith.glade.h:170
-msgid "add entered name to volumes list"
-msgstr ""
-
-#: ../glade/griffith.glade.h:171
-msgid "classification"
-msgstr ""
-
-#: ../glade/griffith.glade.h:172
-msgid "click here if movie was returned"
-msgstr ""
-
-#: ../glade/griffith.glade.h:173
-msgid "collection details"
-msgstr ""
-
-#: ../glade/griffith.glade.h:174
-msgid "loans movie or volume"
-msgstr ""
-
-#: ../glade/griffith.glade.h:175
-msgid "minutes"
-msgstr ""
-
-#: ../glade/griffith.glade.h:176
-msgid "movies"
-msgstr ""
-
-#: ../glade/griffith.glade.h:177
-msgid "remove selected collection"
-msgstr ""
-
-#: ../glade/griffith.glade.h:178
-msgid "remove selected volume"
-msgstr ""
-
-#: ../glade/griffith.glade.h:179
-msgid "tags"
-msgstr ""
-
-#: ../glade/griffith.glade.h:180
-msgid "volume details"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:1
-msgid ""
-"<b>Some Hints</b>:\n"
-"\n"
-"On the next step you can assign your csv fields with the one in Griffith.\n"
-"One CSV-field can be assigned to multiple griffith-fields, i.e. if you have "
-"only one title.\n"
-"Your cast-list should be comma-seperated to break it apart in multiple lines."
-msgstr ""
-
-#: ../glade/importcsv.glade.h:6
-msgid "Assigned Fields (CSV > Griffith)"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:7
-msgid "CSV Fields"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:8
-msgid "CSV Import"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:9
-msgid "Delimiter"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:10
-msgid "Encoding"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:11 ../glade/import.glade.h:6
-msgid "Fields"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:12
-msgid "File-Options"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:13
-msgid "From Row"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:14
-msgid "Griffith Fields"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:15
-msgid "If your file has no column headers then you should import from row 0."
-msgstr ""
-
-#: ../glade/importcsv.glade.h:16
-msgid "Lineterminator"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:17
-msgid "Quotechar"
-msgstr ""
-
-#: ../glade/importcsv.glade.h:18
-msgid ""
-"ascii (English)\n"
-"big5 (Traditional Chinese)\n"
-"big5hkscs (Traditional Chinese)\n"
-"cp037 (English)\n"
-"cp424 (Hebrew)\n"
-"cp437 (English)\n"
-"cp500 (Western Europe)\n"
-"cp737 (Greek)\n"
-"cp775 (Baltic languages)\n"
-"cp850 (Western Europe)\n"
-"cp852 (Central and Eastern Europe)\n"
-"cp855 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-"cp856 (Hebrew)\n"
-"cp857 (Turkish)\n"
-"cp860 (Portuguese)\n"
-"cp861 (Icelandic)\n"
-"cp862 (Hebrew)\n"
-"cp863 (Canadian)\n"
-"cp864 (Arabic)\n"
-"cp865 (Danish, Norwegian)\n"
-"cp866 (Russian)\n"
-"cp869 (Greek)\n"
-"cp874 (Thai)\n"
-"cp875 (Greek)\n"
-"cp932 (Japanese)\n"
-"cp949 (Korean)\n"
-"cp950 (Traditional Chinese)\n"
-"cp1006 (Urdu)\n"
-"cp1026 (Turkish)\n"
-"cp1140 (Western Europe)\n"
-"cp1250 (Central and Eastern Europe)\n"
-"cp1251 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-"cp1252 (Western Europe)\n"
-"cp1253 (Greek)\n"
-"cp1254 (Turkish)\n"
-"cp1255 (Hebrew)\n"
-"cp1256 (Arabic)\n"
-"cp1257 (Baltic languages)\n"
-"cp1258 (Vietnamese)\n"
-"euc_jp (Japanese)\n"
-"euc_jis_2004 (Japanese)\n"
-"euc_jisx0213 (Japanese)\n"
-"euc_kr (Korean)\n"
-"gb2312 (Simplified Chinese)\n"
-"gbk (Unified Chinese)\n"
-"gb18030 (Unified Chinese)\n"
-"hz (Simplified Chinese)\n"
-"iso2022_jp (Japanese)\n"
-"iso2022_jp_1 (Japanese)\n"
-"iso2022_jp_2 (Japanese, Korean, Simplified Chinese, Western Europe, Greek)\n"
-"iso2022_jp_2004 (Japanese)\n"
-"iso2022_jp_3 (Japanese)\n"
-"iso2022_jp_ext (Japanese)\n"
-"iso2022_kr (Korean)\n"
-"latin_1 (West Europe)\n"
-"iso8859_2 (Central and Eastern Europe)\n"
-"iso8859_3 (Esperanto, Maltese)\n"
-"iso8859_4 (Baltic languagues)\n"
-"iso8859_5 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-"iso8859_6 (Arabic)\n"
-"iso8859_7 (Greek)\n"
-"iso8859_8 (Hebrew)\n"
-"iso8859_9 (Turkish)\n"
-"iso8859_10 (Nordic languages)\n"
-"iso8859_13 (Baltic languages)\n"
-"iso8859_14 (Celtic languages)\n"
-"iso8859_15 (Western Europe)\n"
-"johab (Korean)\n"
-"koi8_r (Russian)\n"
-"koi8_u (Ukrainian)\n"
-"mac_cyrillic (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-"mac_greek (Greek)\n"
-"mac_iceland (Icelandic)\n"
-"mac_latin2 (Central and Eastern Europe)\n"
-"mac_roman (Western Europe)\n"
-"mac_turkish (Turkish)\n"
-"ptcp154 (Kazakh)\n"
-"shift_jis (Japanese)\n"
-"shift_jis_2004 (Japanese)\n"
-"shift_jisx0213 (Japanese)\n"
-"utf_16 (all languages)\n"
-"utf_16_be (all languages (BMP only))\n"
-"utf_16_le (all languages (BMP only))\n"
-"utf_7 (all languages)\n"
-"utf_8 (all languages)"
-msgstr ""
-
-#: ../glade/import.glade.h:1
-msgid "<b>Import only fields selected below</b>"
-msgstr ""
-
-#: ../glade/import.glade.h:2
-msgid "<b>Importing...</b>"
-msgstr ""
-
-#: ../glade/import.glade.h:7
-msgid "Import window"
-msgstr ""
-
-#: ../glade/import.glade.h:8
-msgid "Plugin"
-msgstr ""
-
-#: ../glade/import.glade.h:9
-msgid "Source"
-msgstr ""

Deleted: trunk/glade/exporthtml.glade.h
===================================================================
--- trunk/glade/exporthtml.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ trunk/glade/exporthtml.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,33 +0,0 @@
-char *s = N_("<b>Example</b>");
-char *s = N_("<b>Export</b>");
-char *s = N_("<b>Header</b>");
-char *s = N_("<b>Limits</b>");
-char *s = N_("<b>Sort by</b>");
-char *s = N_("<b>Split into</b>");
-char *s = N_("<b>Style</b>");
-char *s = N_("<b>Template</b>");
-char *s = N_("Author");
-char *s = N_("Black and white");
-char *s = N_("Choose style file");
-char *s = N_("Convert images");
-char *s = N_("Data");
-char *s = N_("Description");
-char *s = N_("Destination");
-char *s = N_("E-mail");
-char *s = N_("Export");
-char *s = N_("Export data");
-char *s = N_("Format");
-char *s = N_("Maximal height");
-char *s = N_("Maximal width");
-char *s = N_("Posters");
-char *s = N_("Reverse");
-char *s = N_("Template");
-char *s = N_("Use custom file");
-char *s = N_("Version");
-char *s = N_("entries per page");
-char *s = N_("files");
-char *s = N_("loaned only");
-char *s = N_("none");
-char *s = N_("not loaned only");
-char *s = N_("seen only");
-char *s = N_("unseen only");

Deleted: trunk/glade/griffith.glade.h
===================================================================
--- trunk/glade/griffith.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ trunk/glade/griffith.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,180 +0,0 @@
-char *s = N_("0 means no limits");
-char *s = N_("<b>Audio channels</b>");
-char *s = N_("<b>Audio codecs</b>");
-char *s = N_("<b>Audio</b>");
-char *s = N_("<b>Collection</b>");
-char *s = N_("<b>Defaults</b>");
-char *s = N_("<b>E-mail reminder</b>");
-char *s = N_("<b>Languages</b>");
-char *s = N_("<b>Loan History</b>");
-char *s = N_("<b>Media</b>");
-char *s = N_("<b>Search for:</b>");
-char *s = N_("<b>Search results</b>");
-char *s = N_("<b>Select database to use</b>");
-char *s = N_("<b>Show only the following columns</b>");
-char *s = N_("<b>Sort by</b>");
-char *s = N_("<b>Subtitle formats</b>");
-char *s = N_("<b>Subtitles</b>");
-char *s = N_("<b>Tags</b>");
-char *s = N_("<b>Use spell checking on the following fields:</b>");
-char *s = N_("<b>Video codecs</b>");
-char *s = N_("<b>Volume</b>");
-char *s = N_("Add");
-char *s = N_("Add a new movie");
-char *s = N_("Add a new person");
-char *s = N_("Add movie");
-char *s = N_("Add movie and close");
-char *s = N_("Add new movie");
-char *s = N_("All Movies");
-char *s = N_("Attempt to fetch a big poster from Amazon services Web site");
-char *s = N_("By Collection");
-char *s = N_("By Tag");
-char *s = N_("By Volume");
-char *s = N_("Cast");
-char *s = N_("Choose Image");
-char *s = N_("Classification");
-char *s = N_("Clears filter");
-char *s = N_("Clone");
-char *s = N_("Collection");
-char *s = N_("Color");
-char *s = N_("Condition");
-char *s = N_("Country");
-char *s = N_("DVD layers");
-char *s = N_("DVD region");
-char *s = N_("Database");
-char *s = N_("Delete a person");
-char *s = N_("Details");
-char *s = N_("Dictionaries");
-char *s = N_("Director");
-char *s = N_("Discs");
-char *s = N_("E-mail");
-char *s = N_("E-mail reminder");
-char *s = N_("E_xport");
-char *s = N_("Edit a person");
-char *s = N_("Edit movie details");
-char *s = N_("Favorite Movie Plugin");
-char *s = N_("Fetch from Amazon");
-char *s = N_("Fill empty fields only");
-char *s = N_("Filter ");
-char *s = N_("Font for reports");
-char *s = N_("Forum");
-char *s = N_("Found Results");
-char *s = N_("Genre");
-char *s = N_("Get from web");
-char *s = N_("Get movie data from:");
-char *s = N_("Griffith");
-char *s = N_("Homepage");
-char *s = N_("Host");
-char *s = N_("I_mport");
-char *s = N_("Image");
-char *s = N_("Include Front Image");
-char *s = N_("Include movie number");
-char *s = N_("Languages");
-char *s = N_("Layers");
-char *s = N_("Limit search results to");
-char *s = N_("Load poster from disk");
-char *s = N_("Loan");
-char *s = N_("Loan Management");
-char *s = N_("Loan movie");
-char *s = N_("Loan to");
-char *s = N_("Loaned Movies");
-char *s = N_("Loaned to");
-char *s = N_("Loans");
-char *s = N_("Main list");
-char *s = N_("Manage People");
-char *s = N_("Media");
-char *s = N_("Medium");
-char *s = N_("Meter\n"
-             "Stars");
-char *s = N_("Movie details");
-char *s = N_("Movie information");
-char *s = N_("Name");
-char *s = N_("Needs authentication");
-char *s = N_("Not Seen Movies");
-char *s = N_("Notes");
-char *s = N_("Number");
-char *s = N_("Official site");
-char *s = N_("Original Title");
-char *s = N_("Original title");
-char *s = N_("Other");
-char *s = N_("PDF reader");
-char *s = N_("Password");
-char *s = N_("People");
-char *s = N_("Phone");
-char *s = N_("Please wait a moment...");
-char *s = N_("Plot");
-char *s = N_("Plugins");
-char *s = N_("Port");
-char *s = N_("Poster image");
-char *s = N_("Poster viewer");
-char *s = N_("Preferences");
-char *s = N_("Print Cover");
-char *s = N_("Print cover");
-char *s = N_("Rating");
-char *s = N_("Rating image");
-char *s = N_("Region");
-char *s = N_("Remove");
-char *s = N_("Remove selected movie");
-char *s = N_("Removes poster");
-char *s = N_("Rename");
-char *s = N_("Report bug");
-char *s = N_("Return");
-char *s = N_("Reverse");
-char *s = N_("Runtime");
-char *s = N_("SMTP port");
-char *s = N_("SMTP server");
-char *s = N_("Searching on the web");
-char *s = N_("Seen it");
-char *s = N_("Select A File");
-char *s = N_("Select first movie");
-char *s = N_("Select last movie");
-char *s = N_("Select next movie");
-char *s = N_("Select previous movie");
-char *s = N_("Sender E-mail address");
-char *s = N_("Show other movies in this collection");
-char *s = N_("Show other movies in this volume");
-char *s = N_("Simple");
-char *s = N_("Site");
-char *s = N_("Size");
-char *s = N_("Spell check the following language");
-char *s = N_("Standard\n"
-             "Slim\n"
-             "Double Slim");
-char *s = N_("Studio");
-char *s = N_("Suggest an unseen movie");
-char *s = N_("Tags");
-char *s = N_("Technical information");
-char *s = N_("This movie is part of...");
-char *s = N_("Title");
-char *s = N_("Toolbar");
-char *s = N_("Trailer");
-char *s = N_("Type");
-char *s = N_("Type in the original film tile, select source and choose <i>Get from web</i>. Griffith will try to fetch all the related information from the Web.");
-char *s = N_("Use Spellchecker");
-char *s = N_("Use TLS?");
-char *s = N_("Use locale:");
-char *s = N_("Username");
-char *s = N_("Video codec");
-char *s = N_("Visit movie web site");
-char *s = N_("Visit the oficial web site");
-char *s = N_("Volume");
-char *s = N_("Watch the trailer");
-char *s = N_("Year");
-char *s = N_("_Edit");
-char *s = N_("_File");
-char *s = N_("_Help");
-char *s = N_("_Loans");
-char *s = N_("_Tools");
-char *s = N_("_View");
-char *s = N_("add entered name to collections list");
-char *s = N_("add entered name to volumes list");
-char *s = N_("classification");
-char *s = N_("click here if movie was returned");
-char *s = N_("collection details");
-char *s = N_("loans movie or volume");
-char *s = N_("minutes");
-char *s = N_("movies");
-char *s = N_("remove selected collection");
-char *s = N_("remove selected volume");
-char *s = N_("tags");
-char *s = N_("volume details");

Deleted: trunk/glade/import.glade.h
===================================================================
--- trunk/glade/import.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ trunk/glade/import.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,10 +0,0 @@
-char *s = N_("<b>Import only fields selected below</b>");
-char *s = N_("<b>Importing...</b>");
-char *s = N_("Author");
-char *s = N_("Description");
-char *s = N_("E-mail");
-char *s = N_("Fields");
-char *s = N_("Import window");
-char *s = N_("Plugin");
-char *s = N_("Source");
-char *s = N_("Version");

Deleted: trunk/glade/importcsv.glade.h
===================================================================
--- trunk/glade/importcsv.glade.h	2008-11-13 22:30:55 UTC (rev 1036)
+++ trunk/glade/importcsv.glade.h	2008-11-13 22:37:03 UTC (rev 1037)
@@ -1,102 +0,0 @@
-char *s = N_("<b>Some Hints</b>:\n"
-             "\n"
-             "On the next step you can assign your csv fields with the one in Griffith.\n"
-             "One CSV-field can be assigned to multiple griffith-fields, i.e. if you have only one title.\n"
-             "Your cast-list should be comma-seperated to break it apart in multiple lines.");
-char *s = N_("Assigned Fields (CSV > Griffith)");
-char *s = N_("CSV Fields");
-char *s = N_("CSV Import");
-char *s = N_("Delimiter");
-char *s = N_("Encoding");
-char *s = N_("Fields");
-char *s = N_("File-Options");
-char *s = N_("From Row");
-char *s = N_("Griffith Fields");
-char *s = N_("If your file has no column headers then you should import from row 0.");
-char *s = N_("Lineterminator");
-char *s = N_("Quotechar");
-char *s = N_("ascii (English)\n"
-             "big5 (Traditional Chinese)\n"
-             "big5hkscs (Traditional Chinese)\n"
-             "cp037 (English)\n"
-             "cp424 (Hebrew)\n"
-             "cp437 (English)\n"
-             "cp500 (Western Europe)\n"
-             "cp737 (Greek)\n"
-             "cp775 (Baltic languages)\n"
-             "cp850 (Western Europe)\n"
-             "cp852 (Central and Eastern Europe)\n"
-             "cp855 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "cp856 (Hebrew)\n"
-             "cp857 (Turkish)\n"
-             "cp860 (Portuguese)\n"
-             "cp861 (Icelandic)\n"
-             "cp862 (Hebrew)\n"
-             "cp863 (Canadian)\n"
-             "cp864 (Arabic)\n"
-             "cp865 (Danish, Norwegian)\n"
-             "cp866 (Russian)\n"
-             "cp869 (Greek)\n"
-             "cp874 (Thai)\n"
-             "cp875 (Greek)\n"
-             "cp932 (Japanese)\n"
-             "cp949 (Korean)\n"
-             "cp950 (Traditional Chinese)\n"
-             "cp1006 (Urdu)\n"
-             "cp1026 (Turkish)\n"
-             "cp1140 (Western Europe)\n"
-             "cp1250 (Central and Eastern Europe)\n"
-             "cp1251 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "cp1252 (Western Europe)\n"
-             "cp1253 (Greek)\n"
-             "cp1254 (Turkish)\n"
-             "cp1255 (Hebrew)\n"
-             "cp1256 (Arabic)\n"
-             "cp1257 (Baltic languages)\n"
-             "cp1258 (Vietnamese)\n"
-             "euc_jp (Japanese)\n"
-             "euc_jis_2004 (Japanese)\n"
-             "euc_jisx0213 (Japanese)\n"
-             "euc_kr (Korean)\n"
-             "gb2312 (Simplified Chinese)\n"
-             "gbk (Unified Chinese)\n"
-             "gb18030 (Unified Chinese)\n"
-             "hz (Simplified Chinese)\n"
-             "iso2022_jp (Japanese)\n"
-             "iso2022_jp_1 (Japanese)\n"
-             "iso2022_jp_2 (Japanese, Korean, Simplified Chinese, Western Europe, Greek)\n"
-             "iso2022_jp_2004 (Japanese)\n"
-             "iso2022_jp_3 (Japanese)\n"
-             "iso2022_jp_ext (Japanese)\n"
-             "iso2022_kr (Korean)\n"
-             "latin_1 (West Europe)\n"
-             "iso8859_2 (Central and Eastern Europe)\n"
-             "iso8859_3 (Esperanto, Maltese)\n"
-             "iso8859_4 (Baltic languagues)\n"
-             "iso8859_5 (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "iso8859_6 (Arabic)\n"
-             "iso8859_7 (Greek)\n"
-             "iso8859_8 (Hebrew)\n"
-             "iso8859_9 (Turkish)\n"
-             "iso8859_10 (Nordic languages)\n"
-             "iso8859_13 (Baltic languages)\n"
-             "iso8859_14 (Celtic languages)\n"
-             "iso8859_15 (Western Europe)\n"
-             "johab (Korean)\n"
-             "koi8_r (Russian)\n"
-             "koi8_u (Ukrainian)\n"
-             "mac_cyrillic (Bulgarian, Byelorussian, Macedonian, Russian, Serbian)\n"
-             "mac_greek (Greek)\n"
-             "mac_iceland (Icelandic)\n"
-             "mac_latin2 (Central and Eastern Europe)\n"
-             "mac_roman (Western Europe)\n"
-             "mac_turkish (Turkish)\n"
-             "ptcp154 (Kazakh)\n"
-             "shift_jis (Japanese)\n"
-             "shift_jis_2004 (Japanese)\n"
-             "shift_jisx0213 (Japanese)\n"
-             "utf_16 (all languages)\n"
-             "utf_16_be (all languages (BMP only))\n"
-             "utf_16_le (all languages (BMP only))\n"
-             "utf_7 (all languages)\n"
-             "utf_8 (all languages)");



From mikej06 at mail.berlios.de  Sat Nov 15 21:16:57 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 15 Nov 2008 21:16:57 +0100
Subject: [Griffith-svn] r1038 - in branches/0.9.x: . lib lib/plugins/export
	lib/plugins/imp lib/plugins/movie
Message-ID: <200811152016.mAFKGv1B025675@sheep.berlios.de>

Author: mikej06
Date: 2008-11-15 21:16:06 +0100 (Sat, 15 Nov 2008)
New Revision: 1038

Modified:
   branches/0.9.x/griffith
   branches/0.9.x/lib/about.py
   branches/0.9.x/lib/add.py
   branches/0.9.x/lib/backup.py
   branches/0.9.x/lib/cover.py
   branches/0.9.x/lib/dbupgrade.py
   branches/0.9.x/lib/delete.py
   branches/0.9.x/lib/edit.py
   branches/0.9.x/lib/gconsole.py
   branches/0.9.x/lib/gemail.py
   branches/0.9.x/lib/gutils.py
   branches/0.9.x/lib/initialize.py
   branches/0.9.x/lib/loan.py
   branches/0.9.x/lib/main_treeview.py
   branches/0.9.x/lib/movie.py
   branches/0.9.x/lib/people.py
   branches/0.9.x/lib/plugins/export/PluginExportCSV.py
   branches/0.9.x/lib/plugins/export/PluginExportHTML.py
   branches/0.9.x/lib/plugins/export/PluginExportPDF.py
   branches/0.9.x/lib/plugins/export/PluginExportXML.py
   branches/0.9.x/lib/plugins/export/PluginExportiPod.py
   branches/0.9.x/lib/plugins/imp/CSV.py
   branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py
   branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py
   branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py
   branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
   branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
   branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py
   branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py
   branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py
   branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py
   branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
   branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py
   branches/0.9.x/lib/plugins/movie/PluginMovieWP.py
   branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
   branches/0.9.x/lib/preferences.py
   branches/0.9.x/lib/quick_filter.py
   branches/0.9.x/lib/sql.py
   branches/0.9.x/lib/update.py
   branches/0.9.x/lib/version.py
   branches/0.9.x/lib/view.py
   branches/0.9.x/lib/widgets.py
Log:
small gettext fixes

Modified: branches/0.9.x/griffith
===================================================================
--- branches/0.9.x/griffith	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/griffith	2008-11-15 20:16:06 UTC (rev 1038)
@@ -23,7 +23,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 
 # set the PATH
 import sys, os.path

Modified: branches/0.9.x/lib/about.py
===================================================================
--- branches/0.9.x/lib/about.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/about.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gtk
 import version
 import os

Modified: branches/0.9.x/lib/add.py
===================================================================
--- branches/0.9.x/lib/add.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/add.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import os
 import gtk

Modified: branches/0.9.x/lib/backup.py
===================================================================
--- branches/0.9.x/lib/backup.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/backup.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import config, edit, gutils, sql
 import gtk
 import os.path

Modified: branches/0.9.x/lib/cover.py
===================================================================
--- branches/0.9.x/lib/cover.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/cover.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm

Modified: branches/0.9.x/lib/dbupgrade.py
===================================================================
--- branches/0.9.x/lib/dbupgrade.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/dbupgrade.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 from sqlalchemy import *
 import os.path
 import gutils

Modified: branches/0.9.x/lib/delete.py
===================================================================
--- branches/0.9.x/lib/delete.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/delete.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import os
 

Modified: branches/0.9.x/lib/edit.py
===================================================================
--- branches/0.9.x/lib/edit.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/edit.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import os
 import update

Modified: branches/0.9.x/lib/gconsole.py
===================================================================
--- branches/0.9.x/lib/gconsole.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/gconsole.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import getopt
 import sys
 import gutils

Modified: branches/0.9.x/lib/gemail.py
===================================================================
--- branches/0.9.x/lib/gemail.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/gemail.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -25,7 +25,6 @@
 import smtplib
 import gutils
 import gettext
-gettext.install('griffith', unicode=1)
 
 socket.setdefaulttimeout(10)
 

Modified: branches/0.9.x/lib/gutils.py
===================================================================
--- branches/0.9.x/lib/gutils.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/gutils.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import string
 import os
 try:

Modified: branches/0.9.x/lib/initialize.py
===================================================================
--- branches/0.9.x/lib/initialize.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/initialize.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -31,7 +31,6 @@
 import platform
 import re
 import gettext
-gettext.install('griffith', unicode=1)
 from locale import getdefaultlocale
 
 try:
@@ -172,6 +171,7 @@
 	gettext.textdomain('griffith')
 	gtk.glade.bindtextdomain('griffith', location)
 	gtk.glade.textdomain('griffith')
+	gettext.install('griffith', location, unicode=1)
 
 def toolbar(self):
 	"""if toolbar is hide in config lets hide the widget"""

Modified: branches/0.9.x/lib/loan.py
===================================================================
--- branches/0.9.x/lib/loan.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/loan.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import gtk
 import datetime

Modified: branches/0.9.x/lib/main_treeview.py
===================================================================
--- branches/0.9.x/lib/main_treeview.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/main_treeview.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import os
 import gtk

Modified: branches/0.9.x/lib/movie.py
===================================================================
--- branches/0.9.x/lib/movie.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/movie.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 from urllib import *
 import sys
 import string

Modified: branches/0.9.x/lib/people.py
===================================================================
--- branches/0.9.x/lib/people.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/people.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 
 def show_people_window(self):

Modified: branches/0.9.x/lib/plugins/export/PluginExportCSV.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportCSV.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/export/PluginExportCSV.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -26,7 +26,6 @@
 import gutils
 import os
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 
 plugin_name = "CSV"

Modified: branches/0.9.x/lib/plugins/export/PluginExportHTML.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -31,7 +31,6 @@
 import math
 from xml.dom import minidom
 import gettext
-gettext.install('griffith', unicode=1)
 
 plugin_name         = 'HTML'
 plugin_description  = _('Plugin exports data using templates')

Modified: branches/0.9.x/lib/plugins/export/PluginExportPDF.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportPDF.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/export/PluginExportPDF.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm, inch

Modified: branches/0.9.x/lib/plugins/export/PluginExportXML.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportXML.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/export/PluginExportXML.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -27,7 +27,6 @@
 import gutils
 import os
 import gettext
-gettext.install('griffith', unicode=1)
 
 plugin_name = "XML"
 plugin_description = _("Full XML list export plugin")

Modified: branches/0.9.x/lib/plugins/export/PluginExportiPod.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportiPod.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/export/PluginExportiPod.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -31,7 +31,6 @@
 import shutil
 from tempfile import mkdtemp
 import gettext
-gettext.install('griffith', unicode=1)
 
 plugin_name = "iPod"
 plugin_description = _("iPod Notes export plugin")
@@ -72,48 +71,48 @@
         self.parent = parent_window
         self.export_iPod()
 
-	def split_file(self, filename):
-		pass
+    def split_file(self, filename):
+        pass
 
     def export_iPod(self):
-		tmp_dir = mkdtemp()
-		griffith_list = open(os.path.join(tmp_dir,"movies"),"w")
-		t = []
-		
-		for movie in self.db.Movie.select():
-			t.append("%s | %s | %s | %s"%(movie['number'],movie['o_title'],movie['title'],movie['director']))
-	
-		griffith_list.write("<title>%s</title><br><br>"%_("My Movies List"))
-		
-		for movie in t:
-			griffith_list.write(str(movie))
-			griffith_list.write("<br>")
-			
-		griffith_list.close()
-		
-		# this is a mac, lets export to iPod's notes folder
-		# TODO: windows and linux iPod autodetection
-		if platform.system() == 'Darwin':
-			thisPod=Path2iPod()
-			thisPath=thisPod.returnPath()
-		
-			if thisPath:
-				commands.getoutput('mv '+os.path.join(tmp_dir,"movies")+' "'+thisPath+'/Notes/"')
-				gutils.info(self, _("List was successful exported to iPod."), self.parent)		
-			else:
-				gutils.info(self, _("iPod is not connected."), self.parent)
-		# this is not a mac, lets save the file
-		else:
-			filename = gutils.file_chooser(_("Export a %s document")%"CSV", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
-				buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='ipod_griffith_list')
-			if filename[0]:
-				overwrite = None
-				if os.path.isfile(filename[0]):
-					response = gutils.question(self, _("File exists. Do you want to overwrite it?"), 1, self.parent)
-					if response==-8:
-						overwrite = True
-					else:
-						overwrite = False
-				if overwrite == True or overwrite is None:
-					shutil.copyfile(os.path.join(tmp_dir,"movies"), filename[0])
-					gutils.info(self, _("List was successful exported. Now you should move it to the 'Notes' folder on your iPod."), self.parent)
+        tmp_dir = mkdtemp()
+        griffith_list = open(os.path.join(tmp_dir,"movies"),"w")
+        t = []
+        
+        for movie in self.db.Movie.select():
+            t.append("%s | %s | %s | %s"%(movie['number'],movie['o_title'],movie['title'],movie['director']))
+    
+        griffith_list.write("<title>%s</title><br><br>"%_("My Movies List"))
+        
+        for movie in t:
+            griffith_list.write(str(movie))
+            griffith_list.write("<br>")
+            
+        griffith_list.close()
+        
+        # this is a mac, lets export to iPod's notes folder
+        # TODO: windows and linux iPod autodetection
+        if platform.system() == 'Darwin':
+            thisPod=Path2iPod()
+            thisPath=thisPod.returnPath()
+        
+            if thisPath:
+                commands.getoutput('mv '+os.path.join(tmp_dir,"movies")+' "'+thisPath+'/Notes/"')
+                gutils.info(self, _("List was successful exported to iPod."), self.parent)		
+            else:
+                gutils.info(self, _("iPod is not connected."), self.parent)
+        # this is not a mac, lets save the file
+        else:
+            filename = gutils.file_chooser(_("Export a %s document")%"CSV", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
+                buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='ipod_griffith_list')
+            if filename[0]:
+                overwrite = None
+                if os.path.isfile(filename[0]):
+                    response = gutils.question(self, _("File exists. Do you want to overwrite it?"), 1, self.parent)
+                    if response==-8:
+                        overwrite = True
+                    else:
+                        overwrite = False
+                if overwrite == True or overwrite is None:
+                    shutil.copyfile(os.path.join(tmp_dir,"movies"), filename[0])
+                    gutils.info(self, _("List was successful exported. Now you should move it to the 'Notes' folder on your iPod."), self.parent)

Modified: branches/0.9.x/lib/plugins/imp/CSV.py
===================================================================
--- branches/0.9.x/lib/plugins/imp/CSV.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/imp/CSV.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -11,7 +11,6 @@
 ###########################################################################
 
 import gettext
-gettext.install('griffith', unicode=1)
 from plugins.imp import ImportPlugin as IP
 import gtk
 import gtk.glade

Modified: branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string
@@ -55,18 +54,18 @@
 		self.title = gutils.trim(self.page,"<title>","</title>")
 
 	def get_director(self):
-		self.director = gutils.trim(self.page,"<h4>R?alis? par ","</a></h4>")
+		self.director = gutils.trim(self.page,"<h4>R??alis?? par ","</a></h4>")
 
 	def get_plot(self):
 		self.plot = gutils.trim(self.page,"Synopsis</b></h3></td></tr></table>","</h4>")
 		self.plot = gutils.after(self.plot,"<h4>")
 
 	def get_year(self):
-		self.year = gutils.trim(self.page,"Ann?e de production : ","</h4>")
+		self.year = gutils.trim(self.page,"Ann??e de production : ","</h4>")
 
 	def get_runtime(self):
 		self.runtime = ""
-		self.runtime = gutils.trim(self.page,"<h4>Dur?e : ","min.</h4>&nbsp;")
+		self.runtime = gutils.trim(self.page,"<h4>Dur??e : ","min.</h4>&nbsp;")
 		if self.runtime:
 			self.runtime = str (int(gutils.before(self.runtime,"h"))*60 + int(gutils.after(self.runtime,"h")))
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 from gutils import decompress

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -1,174 +1,173 @@
-# -*- coding: cp1250 -*-
-__revision__ = '$Id: PluginMovieCSFD.py 12 2007-01-05 09:08:06Z blondak $'
-# Copyright (c) 2005 Blondak
-#
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Library General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
-
-# You may use and distribute this software under the terms of the
-# GNU General Public License, version 2 or later
-
-import gettext
-gettext.install('griffith', unicode=1)
-import gutils
-import movie,string
-import re
-
-plugin_name = "CSFD"
-plugin_description = "Cesko-Slovenska Filmova Databaze"
-plugin_url = "www.csfd.cz"
-plugin_language = _("Czech")
-plugin_author = "Blondak"
-plugin_author_email = "<blondak at neser.cz>"
-plugin_version = "0.8"
-
-class Plugin(movie.Movie):
-	def __init__(self, id):
-		self.movie_id = id
-		self.encode = "cp1250"
-		self.url = "http://www.csfd.cz/"+str(id)
-
-	def get_image(self):
-		self.image_url = re.search(r"background=\"http://img.csfd.cz/posters/([^\"]*)\"",self.page)
-		if self.image_url:
-			self.image_url = "http://img.csfd.cz/posters/" + gutils.strip_tags(self.image_url.group(1))
-		else:
-			self.image_url = ""
-
-	def get_o_title(self):
-		self.o_title = re.findall(r"/images/flag_[\d]+\.gif'[^>]*></td><td>([^<]*)",self.page)
-		if len(self.o_title)>0:
-			self.o_title = self.o_title[len(self.o_title)-1]
-		else:
-			self.o_title = ""
-		if self.o_title == "":
-			self.o_title = self.get_title(True)
-
-	def get_title(self, ret=False):
-		data = re.search(r"<title>([^,]*), ",self.page)
-		if data:
-			data = data.group(1)
-		else:
-			data = ""
-		if ret is True:
-			return data
-		else:
-			self.title = data
-
-	def get_director(self):
-		self.director = re.search(r"Re?ie:(.*)<br><b>Hraj?:",self.page)
-		if self.director:
-			self.director = gutils.strip_tags(self.director.group(1))
-		else:
-			self.director = ""
-
-	def get_year(self):
-		self.year = re.search(r"<title>.*\(([\d]+)\)",self.page)
-		if self.year:
-			self.year = self.year.group(1)
-		else:
-			self.year = ""
-
-	def get_runtime(self):
-		self.runtime = re.search(r"([\d]+) min</b><BR><BR><b>Re?ie:",self.page)
-		if self.runtime:
-			self.runtime = gutils.strip_tags(self.runtime.group(1))
-		else:
-			self.runtime = ""
-
-	def get_genre(self):
-		self.genre = re.search(r"/images/flag_[\d]+.gif.*</table>[\s]*<br>[\s]*<b>([^&:]*)&nbsp;<br>",self.page)
-		if self.genre:
-			self.genre = gutils.strip_tags(self.genre.group(1))
-		else:
-			self.genre = ""
-
-	def get_country(self):
-		self.country = re.search(r"/images/flag_[\d]+.gif.*</table>[\s]*<br>[\s]*<b>[^&:]*&nbsp;<br>(.*), [\d]{4}, ",self.page)
-		if self.country:
-			self.country = gutils.strip_tags(self.country.group(1))
-		else:
-			self.country = ""
-
-	def get_cast(self):
-		self.cast = re.search(r"Hraj?: (.*)</div><br>",self.page)
-		if self.cast:
-			self.cast = gutils.strip_tags(self.cast.group(1))
-		else:
-			self.cast = ""
-
-	def get_plot(self):
-		self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,"Obsah / Info:","</td>"),"(ofici?ln? text distributora)",""))
-
-	def get_site(self):
-		self.site = re.search(r"href=[\"'](http://.*imdb\.com/title/[^\"']*)",self.page)
-		if self.site:
-			self.site = gutils.strip_tags(self.site.group(1))
-		else:
-			self.site = ""
-
-	def get_trailer(self):
-		self.trailer = re.search(r"<a href=\"([^\"]*)\"[^>]*>trailer<br><img src=\"http://img.csfd.cz/images/new/film/ikona_trailer",self.page)
-		if self.trailer:
-			self.trailer = "http://www.csfd.cz/"+gutils.strip_tags(self.trailer.group(1))
-
-		else:
-			self.trailer = ""
-
-	def get_rating(self):
-		self.rating = re.search(r"[\s]*([\d]+)%[\s]*</td>",self.page)
-		if self.rating:
-			self.rating = str(float(self.rating.group(1))/10)
-		else:
-			self.rating = ""
-
-	def get_o_site(self):
-		self.o_site = re.search(r"href=\"([^\"]*)\"[^>]*>www<br><img src=\"http://img.csfd.cz/images/new/film/ikona_www",self.page)
-		if self.o_site:
-			self.o_site = gutils.strip_tags(self.o_site.group(1))
-		else:
-			self.o_site = ""
-
-	def get_notes(self):
-		self.notes = ""
-
-	def get_studio(self):
-		self.studio = ""
-
-	def get_classification(self):
-		self.classification = ""
-
-class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode = "cp1250"
-		self.original_url_search   = "http://www.csfd.cz/search_pg.php?search="
-		self.translated_url_search = "http://www.csfd.cz/search_pg.php?search="
-
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		return self.page
-
-	def get_searches(self):
-		tmp_id = self.re_items=re.search(r"window.location.href='http://www.csfd.cz/(/film/[^']*)'",self.page)
-		if tmp_id:
-			self.ids.append(tmp_id.group(1))
-		else:
-			self.re_items=re.findall(r"href=\"(/film/[^\"]+)[^>]*>([^<]+)</a>([^<]*)",self.page)
-			self.number_results = len(self.re_items)
-			if (self.number_results > 0):
-				for item in self.re_items:
-					self.ids.append(item[0])
-#					self.titles.append(gutils.convert_entities(item[1])+' '+item[2])
-					self.titles.append(item[1]+' '+item[2])
-
+# -*- coding: cp1250 -*-
+__revision__ = '$Id: PluginMovieCSFD.py 12 2007-01-05 09:08:06Z blondak $'
+# Copyright (c) 2005 Blondak
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+
+# You may use and distribute this software under the terms of the
+# GNU General Public License, version 2 or later
+
+import gettext
+import gutils
+import movie,string
+import re
+
+plugin_name = "CSFD"
+plugin_description = "Cesko-Slovenska Filmova Databaze"
+plugin_url = "www.csfd.cz"
+plugin_language = _("Czech")
+plugin_author = "Blondak"
+plugin_author_email = "<blondak at neser.cz>"
+plugin_version = "0.8"
+
+class Plugin(movie.Movie):
+	def __init__(self, id):
+		self.movie_id = id
+		self.encode = "cp1250"
+		self.url = "http://www.csfd.cz/"+str(id)
+
+	def get_image(self):
+		self.image_url = re.search(r"background=\"http://img.csfd.cz/posters/([^\"]*)\"",self.page)
+		if self.image_url:
+			self.image_url = "http://img.csfd.cz/posters/" + gutils.strip_tags(self.image_url.group(1))
+		else:
+			self.image_url = ""
+
+	def get_o_title(self):
+		self.o_title = re.findall(r"/images/flag_[\d]+\.gif'[^>]*></td><td>([^<]*)",self.page)
+		if len(self.o_title)>0:
+			self.o_title = self.o_title[len(self.o_title)-1]
+		else:
+			self.o_title = ""
+		if self.o_title == "":
+			self.o_title = self.get_title(True)
+
+	def get_title(self, ret=False):
+		data = re.search(r"<title>([^,]*), ",self.page)
+		if data:
+			data = data.group(1)
+		else:
+			data = ""
+		if ret is True:
+			return data
+		else:
+			self.title = data
+
+	def get_director(self):
+		self.director = re.search(r"Re?ie:(.*)<br><b>Hraj?:",self.page)
+		if self.director:
+			self.director = gutils.strip_tags(self.director.group(1))
+		else:
+			self.director = ""
+
+	def get_year(self):
+		self.year = re.search(r"<title>.*\(([\d]+)\)",self.page)
+		if self.year:
+			self.year = self.year.group(1)
+		else:
+			self.year = ""
+
+	def get_runtime(self):
+		self.runtime = re.search(r"([\d]+) min</b><BR><BR><b>Re?ie:",self.page)
+		if self.runtime:
+			self.runtime = gutils.strip_tags(self.runtime.group(1))
+		else:
+			self.runtime = ""
+
+	def get_genre(self):
+		self.genre = re.search(r"/images/flag_[\d]+.gif.*</table>[\s]*<br>[\s]*<b>([^&:]*)&nbsp;<br>",self.page)
+		if self.genre:
+			self.genre = gutils.strip_tags(self.genre.group(1))
+		else:
+			self.genre = ""
+
+	def get_country(self):
+		self.country = re.search(r"/images/flag_[\d]+.gif.*</table>[\s]*<br>[\s]*<b>[^&:]*&nbsp;<br>(.*), [\d]{4}, ",self.page)
+		if self.country:
+			self.country = gutils.strip_tags(self.country.group(1))
+		else:
+			self.country = ""
+
+	def get_cast(self):
+		self.cast = re.search(r"Hraj?: (.*)</div><br>",self.page)
+		if self.cast:
+			self.cast = gutils.strip_tags(self.cast.group(1))
+		else:
+			self.cast = ""
+
+	def get_plot(self):
+		self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,"Obsah / Info:","</td>"),"(ofici?ln? text distributora)",""))
+
+	def get_site(self):
+		self.site = re.search(r"href=[\"'](http://.*imdb\.com/title/[^\"']*)",self.page)
+		if self.site:
+			self.site = gutils.strip_tags(self.site.group(1))
+		else:
+			self.site = ""
+
+	def get_trailer(self):
+		self.trailer = re.search(r"<a href=\"([^\"]*)\"[^>]*>trailer<br><img src=\"http://img.csfd.cz/images/new/film/ikona_trailer",self.page)
+		if self.trailer:
+			self.trailer = "http://www.csfd.cz/"+gutils.strip_tags(self.trailer.group(1))
+
+		else:
+			self.trailer = ""
+
+	def get_rating(self):
+		self.rating = re.search(r"[\s]*([\d]+)%[\s]*</td>",self.page)
+		if self.rating:
+			self.rating = str(float(self.rating.group(1))/10)
+		else:
+			self.rating = ""
+
+	def get_o_site(self):
+		self.o_site = re.search(r"href=\"([^\"]*)\"[^>]*>www<br><img src=\"http://img.csfd.cz/images/new/film/ikona_www",self.page)
+		if self.o_site:
+			self.o_site = gutils.strip_tags(self.o_site.group(1))
+		else:
+			self.o_site = ""
+
+	def get_notes(self):
+		self.notes = ""
+
+	def get_studio(self):
+		self.studio = ""
+
+	def get_classification(self):
+		self.classification = ""
+
+class SearchPlugin(movie.SearchMovie):
+	def __init__(self):
+		self.encode = "cp1250"
+		self.original_url_search   = "http://www.csfd.cz/search_pg.php?search="
+		self.translated_url_search = "http://www.csfd.cz/search_pg.php?search="
+
+	def search(self,parent_window):
+		self.open_search(parent_window)
+		return self.page
+
+	def get_searches(self):
+		tmp_id = self.re_items=re.search(r"window.location.href='http://www.csfd.cz/(/film/[^']*)'",self.page)
+		if tmp_id:
+			self.ids.append(tmp_id.group(1))
+		else:
+			self.re_items=re.findall(r"href=\"(/film/[^\"]+)[^>]*>([^<]+)</a>([^<]*)",self.page)
+			self.number_results = len(self.re_items)
+			if (self.number_results > 0):
+				for item in self.re_items:
+					self.ids.append(item[0])
+#					self.titles.append(gutils.convert_entities(item[1])+' '+item[2])
+					self.titles.append(item[1]+' '+item[2])
+

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie, string
 
 plugin_name = "Cinematografo"

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string
@@ -57,7 +56,7 @@
 
 	def get_director(self):
 		"""Finds the film's director"""
-		self.director = gutils.strip_tags(gutils.trim(self.page, "<div><b>Realiza??o:</b><br>", "</div>"))
+		self.director = gutils.strip_tags(gutils.trim(self.page, "<div><b>Realiza????o:</b><br>", "</div>"))
 		self.director = string.replace(self.director,"<br>", ", ")
 		self.director = gutils.strip_tags(self.director)
 
@@ -71,11 +70,11 @@
 
 	def get_runtime(self):
 		"""Finds the film's running time"""
-		self.runtime = gutils.trim(self.page, "<td><b>Dura??o:</b> ", " min.</td>")
+		self.runtime = gutils.trim(self.page, "<td><b>Dura????o:</b> ", " min.</td>")
 
 	def get_genre(self):
 		"""Finds the film's genre"""
-		self.genre = gutils.strip_tags(gutils.trim(self.page, "<b>G?nero:</b><br>", "</div>"))
+		self.genre = gutils.strip_tags(gutils.trim(self.page, "<b>G??nero:</b><br>", "</div>"))
 		self.genre = string.replace(self.genre,"<br>", ", ")
 		self.genre = gutils.strip_tags(self.genre)
 
@@ -97,13 +96,13 @@
 		"""Find the film's oficial site"""
 		self.o_site = gutils.trim(self.page, \
 			"<a class=\"button\" href=\"", \
-			" title=\"Consultar t?tulo no Internet Movie Data Base\"")
+			" title=\"Consultar t??tulo no Internet Movie Data Base\"")
 
 	def get_site(self):
 		"""Find the film's imdb details page"""
 		self.site = gutils.trim(self.page, \
 			"</td><td><a class=\"button\" href=\"", \
-			"""" title="Consultar t??tulo""")
+			"""" title="Consultar t????tulo""")
 
 	def get_trailer(self):
 		"""Find the film's trailer page or location"""
@@ -111,7 +110,7 @@
 
 	def get_country(self):
 		"""Find the film's country"""
-		self.country = gutils.trim(self.page, "<b>Pa?s:</b><br>", "</div>")
+		self.country = gutils.trim(self.page, "<b>Pa??s:</b><br>", "</div>")
 		self.country = string.replace(self.country,"<br>", ", ")
 		self.country = gutils.strip_tags(self.country)
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -26,7 +26,6 @@
 
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie, string
 
 plugin_name = "E-Pipoca"

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import re,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -7,7 +7,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -7,7 +7,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -8,7 +8,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string,re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -2,7 +2,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2005-2006 Piotr O?arowski
+# Copyright (c) 2005-2006 Piotr O??arowski
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 
@@ -30,7 +29,7 @@
 plugin_description  = 'Onet Film'
 plugin_url          = 'film.onet.pl'
 plugin_language     = _('Polish')
-plugin_author       = 'Piotr O?arowski'
+plugin_author       = 'Piotr O??arowski'
 plugin_author_email = '<ozarow+griffith at gmail.com>'
 plugin_version      = '1.7'
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string
@@ -51,7 +50,7 @@
 		self.title = string.capwords(gutils.trim(self.page,"class=subtitle>","</b><br>") )
 
 	def get_director(self):
-		self.director = gutils.trim(self.page,"<b>realiza??o</b><br>","<br><br><b>")
+		self.director = gutils.trim(self.page,"<b>realiza????o</b><br>","<br><br><b>")
 
 	def get_plot(self):
 		self.plot = gutils.trim(self.page,"<b>sinopse</b><br>","<br><br>")
@@ -94,7 +93,7 @@
 		self.country = gutils.trim(self.page,"s</b><br>","<br><br><b>g")
 		
 	def get_notes(self):
-		self.notes = gutils.trim(self.page,"pr?mios e nomea??es</b><br><b>", "<td width=6 background='Images/group_r.gif'")
+		self.notes = gutils.trim(self.page,"pr??mios e nomea????es</b><br><b>", "<td width=6 background='Images/group_r.gif'")
 		self.notes = gutils.strip_tags(self.notes)
 
 	def get_rating(self):

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieWP.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieWP.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieWP.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/preferences.py
===================================================================
--- branches/0.9.x/lib/preferences.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/preferences.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import os
 import initialize
 import gutils

Modified: branches/0.9.x/lib/quick_filter.py
===================================================================
--- branches/0.9.x/lib/quick_filter.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/quick_filter.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 
 def change_filter(self):

Modified: branches/0.9.x/lib/sql.py
===================================================================
--- branches/0.9.x/lib/sql.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/sql.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 from sqlalchemy import *
 import os.path
 import gutils

Modified: branches/0.9.x/lib/update.py
===================================================================
--- branches/0.9.x/lib/update.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/update.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 from sqlalchemy import Select, desc
 import gutils
 import os

Modified: branches/0.9.x/lib/version.py
===================================================================
--- branches/0.9.x/lib/version.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/version.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 pname        = "Griffith"
 pversion     = "0.9.8"
 pauthor      = "Vasco Nunes, Piotr O??arowski <griffith-private at lists.berlios.de>"

Modified: branches/0.9.x/lib/view.py
===================================================================
--- branches/0.9.x/lib/view.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/view.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 
 def filter_not_seen(self):
 	self.populate_treeview()

Modified: branches/0.9.x/lib/widgets.py
===================================================================
--- branches/0.9.x/lib/widgets.py	2008-11-13 22:37:03 UTC (rev 1037)
+++ branches/0.9.x/lib/widgets.py	2008-11-15 20:16:06 UTC (rev 1038)
@@ -22,7 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-gettext.install('griffith', unicode=1)
 import gtk
 import sys
 



From mikej06 at mail.berlios.de  Sat Nov 15 21:49:07 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 15 Nov 2008 21:49:07 +0100
Subject: [Griffith-svn] r1039 - trunk/glade
Message-ID: <200811152049.mAFKn7iU027441@sheep.berlios.de>

Author: mikej06
Date: 2008-11-15 21:48:54 +0100 (Sat, 15 Nov 2008)
New Revision: 1039

Modified:
   trunk/glade/griffith.glade
Log:
preferences dialog: seen and runtime checkbox are in the wrong row

Modified: trunk/glade/griffith.glade
===================================================================
--- trunk/glade/griffith.glade	2008-11-15 20:16:06 UTC (rev 1038)
+++ trunk/glade/griffith.glade	2008-11-15 20:48:54 UTC (rev 1039)
@@ -2889,7 +2889,6 @@
                               <packing>
                                 <property name="left_attach">3</property>
                                 <property name="right_attach">4</property>
-                                <property name="top_attach">1</property>
                                 <property name="x_options">GTK_FILL</property>
                                 <property name="y_options"></property>
                               </packing>
@@ -2924,7 +2923,6 @@
                               <packing>
                                 <property name="left_attach">4</property>
                                 <property name="right_attach">5</property>
-                                <property name="top_attach">1</property>
                                 <property name="x_options">GTK_FILL</property>
                                 <property name="y_options"></property>
                               </packing>



From mikej06 at mail.berlios.de  Sat Nov 15 22:14:34 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 15 Nov 2008 22:14:34 +0100
Subject: [Griffith-svn] r1040 - in branches/0.9.x: . lib lib/plugins/export
	lib/plugins/imp lib/plugins/movie
Message-ID: <200811152114.mAFLEY6x030036@sheep.berlios.de>

Author: mikej06
Date: 2008-11-15 22:13:49 +0100 (Sat, 15 Nov 2008)
New Revision: 1040

Modified:
   branches/0.9.x/griffith
   branches/0.9.x/lib/about.py
   branches/0.9.x/lib/add.py
   branches/0.9.x/lib/backup.py
   branches/0.9.x/lib/cover.py
   branches/0.9.x/lib/dbupgrade.py
   branches/0.9.x/lib/delete.py
   branches/0.9.x/lib/edit.py
   branches/0.9.x/lib/gconsole.py
   branches/0.9.x/lib/gemail.py
   branches/0.9.x/lib/gutils.py
   branches/0.9.x/lib/loan.py
   branches/0.9.x/lib/main_treeview.py
   branches/0.9.x/lib/movie.py
   branches/0.9.x/lib/people.py
   branches/0.9.x/lib/plugins/export/PluginExportCSV.py
   branches/0.9.x/lib/plugins/export/PluginExportHTML.py
   branches/0.9.x/lib/plugins/export/PluginExportPDF.py
   branches/0.9.x/lib/plugins/export/PluginExportXML.py
   branches/0.9.x/lib/plugins/export/PluginExportiPod.py
   branches/0.9.x/lib/plugins/imp/CSV.py
   branches/0.9.x/lib/plugins/imp/__init__.py
   branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py
   branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py
   branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py
   branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py
   branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
   branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
   branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py
   branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py
   branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py
   branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py
   branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
   branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py
   branches/0.9.x/lib/plugins/movie/PluginMovieWP.py
   branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
   branches/0.9.x/lib/preferences.py
   branches/0.9.x/lib/quick_filter.py
   branches/0.9.x/lib/sql.py
   branches/0.9.x/lib/update.py
   branches/0.9.x/lib/version.py
   branches/0.9.x/lib/view.py
   branches/0.9.x/lib/widgets.py
Log:
removed unecessary "import gettext"

Modified: branches/0.9.x/griffith
===================================================================
--- branches/0.9.x/griffith	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/griffith	2008-11-15 21:13:49 UTC (rev 1040)
@@ -22,7 +22,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 
 # set the PATH
 import sys, os.path

Modified: branches/0.9.x/lib/about.py
===================================================================
--- branches/0.9.x/lib/about.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/about.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gtk
 import version
 import os

Modified: branches/0.9.x/lib/add.py
===================================================================
--- branches/0.9.x/lib/add.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/add.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import os
 import gtk

Modified: branches/0.9.x/lib/backup.py
===================================================================
--- branches/0.9.x/lib/backup.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/backup.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import config, edit, gutils, sql
 import gtk
 import os.path

Modified: branches/0.9.x/lib/cover.py
===================================================================
--- branches/0.9.x/lib/cover.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/cover.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm

Modified: branches/0.9.x/lib/dbupgrade.py
===================================================================
--- branches/0.9.x/lib/dbupgrade.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/dbupgrade.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 from sqlalchemy import *
 import os.path
 import gutils

Modified: branches/0.9.x/lib/delete.py
===================================================================
--- branches/0.9.x/lib/delete.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/delete.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import os
 

Modified: branches/0.9.x/lib/edit.py
===================================================================
--- branches/0.9.x/lib/edit.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/edit.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import os
 import update

Modified: branches/0.9.x/lib/gconsole.py
===================================================================
--- branches/0.9.x/lib/gconsole.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/gconsole.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import getopt
 import sys
 import gutils

Modified: branches/0.9.x/lib/gemail.py
===================================================================
--- branches/0.9.x/lib/gemail.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/gemail.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -24,7 +24,6 @@
 import socket
 import smtplib
 import gutils
-import gettext
 
 socket.setdefaulttimeout(10)
 

Modified: branches/0.9.x/lib/gutils.py
===================================================================
--- branches/0.9.x/lib/gutils.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/gutils.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import string
 import os
 try:

Modified: branches/0.9.x/lib/loan.py
===================================================================
--- branches/0.9.x/lib/loan.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/loan.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import gtk
 import datetime

Modified: branches/0.9.x/lib/main_treeview.py
===================================================================
--- branches/0.9.x/lib/main_treeview.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/main_treeview.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import os
 import gtk

Modified: branches/0.9.x/lib/movie.py
===================================================================
--- branches/0.9.x/lib/movie.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/movie.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 from urllib import *
 import sys
 import string

Modified: branches/0.9.x/lib/people.py
===================================================================
--- branches/0.9.x/lib/people.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/people.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 
 def show_people_window(self):

Modified: branches/0.9.x/lib/plugins/export/PluginExportCSV.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportCSV.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/export/PluginExportCSV.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -25,7 +25,6 @@
 import gtk
 import gutils
 import os
-import gettext
 import gutils
 
 plugin_name = "CSV"

Modified: branches/0.9.x/lib/plugins/export/PluginExportHTML.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/export/PluginExportHTML.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -30,7 +30,6 @@
 import version
 import math
 from xml.dom import minidom
-import gettext
 
 plugin_name         = 'HTML'
 plugin_description  = _('Plugin exports data using templates')

Modified: branches/0.9.x/lib/plugins/export/PluginExportPDF.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportPDF.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/export/PluginExportPDF.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm, inch

Modified: branches/0.9.x/lib/plugins/export/PluginExportXML.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportXML.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/export/PluginExportXML.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -26,7 +26,6 @@
 import gtk
 import gutils
 import os
-import gettext
 
 plugin_name = "XML"
 plugin_description = _("Full XML list export plugin")

Modified: branches/0.9.x/lib/plugins/export/PluginExportiPod.py
===================================================================
--- branches/0.9.x/lib/plugins/export/PluginExportiPod.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/export/PluginExportiPod.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -30,7 +30,6 @@
 import platform
 import shutil
 from tempfile import mkdtemp
-import gettext
 
 plugin_name = "iPod"
 plugin_description = _("iPod Notes export plugin")

Modified: branches/0.9.x/lib/plugins/imp/CSV.py
===================================================================
--- branches/0.9.x/lib/plugins/imp/CSV.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/imp/CSV.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -10,7 +10,6 @@
 #
 ###########################################################################
 
-import gettext
 from plugins.imp import ImportPlugin as IP
 import gtk
 import gtk.glade

Modified: branches/0.9.x/lib/plugins/imp/__init__.py
===================================================================
--- branches/0.9.x/lib/plugins/imp/__init__.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/imp/__init__.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -23,8 +23,6 @@
 
 # detect all plugins:
 import glob, os.path
-import gettext
-gettext.install('griffith', unicode=1)
 
 __all__ = [os.path.basename(x)[:-3] for x in glob.glob("%s/*.py" % os.path.dirname(__file__))]
 __all__.remove('__init__')

Modified: branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovie7arte.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAllocine.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAniDB.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils, movie
 import string, re
 from gutils import decompress

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -19,7 +19,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils, movie, string
 
 plugin_name = "Cinematografo"

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCineteka.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -24,8 +24,6 @@
 # Updated on 04/29/2007 by Djohnson "Joe" Lima
 # joe1310 at terra.com.br - S?o Paulo/Brasil
 
-
-import gettext
 import gutils, movie, string
 
 plugin_name = "E-Pipoca"

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils, movie
 import re,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieMediadis.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -6,7 +6,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -6,7 +6,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieOFDb.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -7,7 +7,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string,re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieOnet.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMoviePTGate.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils, movie
 import string, re
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieWP.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieWP.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieWP.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie,string
 import re

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 import movie
 import string

Modified: branches/0.9.x/lib/preferences.py
===================================================================
--- branches/0.9.x/lib/preferences.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/preferences.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import os
 import initialize
 import gutils

Modified: branches/0.9.x/lib/quick_filter.py
===================================================================
--- branches/0.9.x/lib/quick_filter.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/quick_filter.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gutils
 
 def change_filter(self):

Modified: branches/0.9.x/lib/sql.py
===================================================================
--- branches/0.9.x/lib/sql.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/sql.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 from sqlalchemy import *
 import os.path
 import gutils

Modified: branches/0.9.x/lib/update.py
===================================================================
--- branches/0.9.x/lib/update.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/update.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 from sqlalchemy import Select, desc
 import gutils
 import os

Modified: branches/0.9.x/lib/version.py
===================================================================
--- branches/0.9.x/lib/version.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/version.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 pname        = "Griffith"
 pversion     = "0.9.8"
 pauthor      = "Vasco Nunes, Piotr O?arowski <griffith-private at lists.berlios.de>"

Modified: branches/0.9.x/lib/view.py
===================================================================
--- branches/0.9.x/lib/view.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/view.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-
 def filter_not_seen(self):
 	self.populate_treeview()
 	self.update_statusbar(_("Filter activated. Showing only not seen movies."))

Modified: branches/0.9.x/lib/widgets.py
===================================================================
--- branches/0.9.x/lib/widgets.py	2008-11-15 20:48:54 UTC (rev 1039)
+++ branches/0.9.x/lib/widgets.py	2008-11-15 21:13:49 UTC (rev 1040)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 import gtk
 import sys
 



From piotrek at mail.berlios.de  Sat Nov 15 22:39:53 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sat, 15 Nov 2008 22:39:53 +0100
Subject: [Griffith-svn] r1041 - in trunk: . glade lib lib/plugins/export
	lib/plugins/imp lib/plugins/movie
Message-ID: <200811152139.mAFLdr1e031708@sheep.berlios.de>

Author: piotrek
Date: 2008-11-15 22:39:47 +0100 (Sat, 15 Nov 2008)
New Revision: 1041

Modified:
   trunk/ChangeLog
   trunk/glade/exporthtml.glade
   trunk/griffith
   trunk/lib/about.py
   trunk/lib/add.py
   trunk/lib/advfilter.py
   trunk/lib/backup.py
   trunk/lib/cover.py
   trunk/lib/db.py
   trunk/lib/dbupgrade.py
   trunk/lib/delete.py
   trunk/lib/edit.py
   trunk/lib/gconsole.py
   trunk/lib/gemail.py
   trunk/lib/gutils.py
   trunk/lib/initialize.py
   trunk/lib/loan.py
   trunk/lib/main_treeview.py
   trunk/lib/movie.py
   trunk/lib/people.py
   trunk/lib/plugins/export/PluginExportCSV.py
   trunk/lib/plugins/export/PluginExportHTML.py
   trunk/lib/plugins/export/PluginExportPDF.py
   trunk/lib/plugins/export/PluginExportXML.py
   trunk/lib/plugins/export/PluginExportiPod.py
   trunk/lib/plugins/export/__init__.py
   trunk/lib/plugins/imp/CSV.py
   trunk/lib/plugins/imp/__init__.py
   trunk/lib/plugins/movie/PluginMovie7arte.py
   trunk/lib/plugins/movie/PluginMovieAllocine.py
   trunk/lib/plugins/movie/PluginMovieAmazon.py
   trunk/lib/plugins/movie/PluginMovieAniDB.py
   trunk/lib/plugins/movie/PluginMovieCSFD.py
   trunk/lib/plugins/movie/PluginMovieCineMovies.py
   trunk/lib/plugins/movie/PluginMovieCinematografo.py
   trunk/lib/plugins/movie/PluginMovieCineteka.py
   trunk/lib/plugins/movie/PluginMovieCulturalia.py
   trunk/lib/plugins/movie/PluginMovieDVDEmpire.py
   trunk/lib/plugins/movie/PluginMovieDVDPalace.py
   trunk/lib/plugins/movie/PluginMovieE-Pipoca.py
   trunk/lib/plugins/movie/PluginMovieFDb.py
   trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
   trunk/lib/plugins/movie/PluginMovieFilmDb.py
   trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
   trunk/lib/plugins/movie/PluginMovieFilmtipset.py
   trunk/lib/plugins/movie/PluginMovieFilmweb.py
   trunk/lib/plugins/movie/PluginMovieIMDB-de.py
   trunk/lib/plugins/movie/PluginMovieIMDB-es.py
   trunk/lib/plugins/movie/PluginMovieIMDB.py
   trunk/lib/plugins/movie/PluginMovieKinoDe.py
   trunk/lib/plugins/movie/PluginMovieMediadis.py
   trunk/lib/plugins/movie/PluginMovieMoviefone.py
   trunk/lib/plugins/movie/PluginMovieOFDb.py
   trunk/lib/plugins/movie/PluginMovieOnet.py
   trunk/lib/plugins/movie/PluginMoviePTGate.py
   trunk/lib/plugins/movie/PluginMovieStopklatka.py
   trunk/lib/plugins/movie/PluginMovieTanukiAnime.py
   trunk/lib/plugins/movie/PluginMovieWP.py
   trunk/lib/plugins/movie/PluginMovieZelluloid.py
   trunk/lib/preferences.py
   trunk/lib/quick_filter.py
   trunk/lib/sql.py
   trunk/lib/update.py
   trunk/lib/version.py
   trunk/lib/view.py
   trunk/lib/widgets.py
Log:
* Export plugins are now exporting movies listed in main window
* gettext imports removed


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/ChangeLog	2008-11-15 21:39:47 UTC (rev 1041)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-15  Piotr O?arowski
+	* Export plugins are now exporting movies listed in main window
+
 2008-11-13  Piotr O?arowski
 	* update translations
 	* sync with 0.9.x branch

Modified: trunk/glade/exporthtml.glade
===================================================================
--- trunk/glade/exporthtml.glade	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/glade/exporthtml.glade	2008-11-15 21:39:47 UTC (rev 1041)
@@ -1,1718 +1,922 @@
-<?xml version="1.0" standalone="no"?> <!--*- mode: xml -*-->
-<!DOCTYPE glade-interface SYSTEM "http://glade.gnome.org/glade-2.0.dtd">
-
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!DOCTYPE glade-interface SYSTEM "glade-2.0.dtd">
+<!--*- mode: xml -*-->
 <glade-interface>
-
-<widget class="GtkWindow" id="w_eh">
-  <property name="border_width">2</property>
-  <property name="width_request">600</property>
-  <property name="visible">True</property>
-  <property name="title" translatable="yes">Export data</property>
-  <property name="type">GTK_WINDOW_TOPLEVEL</property>
-  <property name="window_position">GTK_WIN_POS_CENTER</property>
-  <property name="modal">False</property>
-  <property name="resizable">True</property>
-  <property name="destroy_with_parent">False</property>
-  <property name="icon_name">gtk-convert</property>
-  <property name="decorated">True</property>
-  <property name="skip_taskbar_hint">False</property>
-  <property name="skip_pager_hint">False</property>
-  <property name="type_hint">GDK_WINDOW_TYPE_HINT_NORMAL</property>
-  <property name="gravity">GDK_GRAVITY_NORTH_WEST</property>
-  <property name="focus_on_map">True</property>
-  <property name="urgency_hint">False</property>
-
-  <child>
-    <widget class="GtkVBox" id="vbox1">
-      <property name="visible">True</property>
-      <property name="homogeneous">False</property>
-      <property name="spacing">0</property>
-
-      <child>
-	<widget class="GtkNotebook" id="notebook4">
-	  <property name="border_width">2</property>
-	  <property name="visible">True</property>
-	  <property name="can_focus">True</property>
-	  <property name="show_tabs">True</property>
-	  <property name="show_border">True</property>
-	  <property name="tab_pos">GTK_POS_TOP</property>
-	  <property name="scrollable">False</property>
-	  <property name="enable_popup">False</property>
-
-	  <child>
-	    <widget class="GtkFileChooserWidget" id="fcw">
-	      <property name="border_width">4</property>
-	      <property name="visible">True</property>
-	      <property name="action">GTK_FILE_CHOOSER_ACTION_SELECT_FOLDER</property>
-	      <property name="local_only">True</property>
-	      <property name="select_multiple">False</property>
-	      <property name="show_hidden">False</property>
-	    </widget>
-	    <packing>
-	      <property name="tab_expand">False</property>
-	      <property name="tab_fill">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkLabel" id="l_destination">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">Destination</property>
-	      <property name="use_underline">False</property>
-	      <property name="use_markup">False</property>
-	      <property name="justify">GTK_JUSTIFY_LEFT</property>
-	      <property name="wrap">False</property>
-	      <property name="selectable">False</property>
-	      <property name="xalign">0.5</property>
-	      <property name="yalign">0.5</property>
-	      <property name="xpad">0</property>
-	      <property name="ypad">0</property>
-	      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-	      <property name="width_chars">-1</property>
-	      <property name="single_line_mode">False</property>
-	      <property name="angle">0</property>
-	    </widget>
-	    <packing>
-	      <property name="type">tab</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkVBox" id="vbox3">
-	      <property name="border_width">4</property>
-	      <property name="visible">True</property>
-	      <property name="homogeneous">False</property>
-	      <property name="spacing">4</property>
-
-	      <child>
-		<widget class="GtkAlignment" id="alignment11">
-		  <property name="visible">True</property>
-		  <property name="xalign">1</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xscale">0.5</property>
-		  <property name="yscale">1</property>
-		  <property name="top_padding">0</property>
-		  <property name="bottom_padding">0</property>
-		  <property name="left_padding">0</property>
-		  <property name="right_padding">0</property>
-
-		  <child>
-		    <widget class="GtkHBox" id="box_sorting">
-		      <property name="visible">True</property>
-		      <property name="homogeneous">False</property>
-		      <property name="spacing">8</property>
-
-		      <child>
-			<widget class="GtkLabel" id="label2">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">&lt;b&gt;Sort by&lt;/b&gt;</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">True</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0.00999999977648</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">1</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkComboBox" id="combo_sortby">
-			  <property name="visible">True</property>
-			  <property name="items" translatable="yes"></property>
-			  <property name="add_tearoffs">False</property>
-			  <property name="focus_on_click">True</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">True</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkCheckButton" id="cb_reverse">
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="label" translatable="yes">Reverse</property>
-			  <property name="use_underline">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <property name="active">False</property>
-			  <property name="inconsistent">False</property>
-			  <property name="draw_indicator">True</property>
-			  <signal name="toggled" handler="on_cb_reverse_toggled" last_modification_time="Thu, 14 Jul 2005 10:20:15 GMT"/>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkHSeparator" id="hseparator5">
-		  <property name="visible">True</property>
-		</widget>
-		<packing>
-		  <property name="padding">4</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkAlignment" id="alignment12">
-		  <property name="visible">True</property>
-		  <property name="xalign">1</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xscale">0.5</property>
-		  <property name="yscale">1</property>
-		  <property name="top_padding">0</property>
-		  <property name="bottom_padding">0</property>
-		  <property name="left_padding">0</property>
-		  <property name="right_padding">0</property>
-
-		  <child>
-		    <widget class="GtkHBox" id="box_spliting">
-		      <property name="visible">True</property>
-		      <property name="homogeneous">False</property>
-		      <property name="spacing">0</property>
-
-		      <child>
-			<widget class="GtkLabel" id="label3">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">&lt;b&gt;Split into&lt;/b&gt;</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">True</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkSpinButton" id="sb_split_num">
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="climb_rate">10</property>
-			  <property name="digits">0</property>
-			  <property name="numeric">False</property>
-			  <property name="update_policy">GTK_UPDATE_IF_VALID</property>
-			  <property name="snap_to_ticks">False</property>
-			  <property name="wrap">False</property>
-			  <property name="adjustment">50 1 1000 1 10 10</property>
-			</widget>
-			<packing>
-			  <property name="padding">4</property>
-			  <property name="expand">False</property>
-			  <property name="fill">True</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkRadioButton" id="rb_split_files">
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="label" translatable="yes">files</property>
-			  <property name="use_underline">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <property name="active">False</property>
-			  <property name="inconsistent">False</property>
-			  <property name="draw_indicator">True</property>
-			  <signal name="toggled" handler="on_rb_split_files_toggled" last_modification_time="Wed, 10 Aug 2005 16:13:00 GMT"/>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkRadioButton" id="rb_split_movies">
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="label" translatable="yes">entries per page</property>
-			  <property name="use_underline">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <property name="active">True</property>
-			  <property name="inconsistent">False</property>
-			  <property name="draw_indicator">True</property>
-			  <property name="group">rb_split_files</property>
-			  <signal name="toggled" handler="on_rb_split_movies_toggled" last_modification_time="Wed, 10 Aug 2005 16:13:08 GMT"/>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkFrame" id="frame1">
-		  <property name="visible">True</property>
-		  <property name="label_xalign">0</property>
-		  <property name="label_yalign">0.5</property>
-		  <property name="shadow_type">GTK_SHADOW_ETCHED_IN</property>
-
-		  <child>
-		    <widget class="GtkAlignment" id="alignment2">
-		      <property name="visible">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xscale">1</property>
-		      <property name="yscale">1</property>
-		      <property name="top_padding">0</property>
-		      <property name="bottom_padding">2</property>
-		      <property name="left_padding">12</property>
-		      <property name="right_padding">0</property>
-
-		      <child>
-			<widget class="GtkHBox" id="box_include">
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">0</property>
-
-			  <child>
-			    <widget class="GtkVBox" id="box_include_1">
-			      <property name="visible">True</property>
-			      <property name="homogeneous">False</property>
-			      <property name="spacing">0</property>
-
-			      <child>
-				<placeholder/>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">True</property>
-			      <property name="fill">True</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkVBox" id="box_include_2">
-			      <property name="visible">True</property>
-			      <property name="homogeneous">False</property>
-			      <property name="spacing">0</property>
-
-			      <child>
-				<placeholder/>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">True</property>
-			      <property name="fill">True</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkVBox" id="box_include_3">
-			      <property name="visible">True</property>
-			      <property name="homogeneous">False</property>
-			      <property name="spacing">0</property>
-
-			      <child>
-				<placeholder/>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">True</property>
-			      <property name="fill">True</property>
-			    </packing>
-			  </child>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkLabel" id="label4">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">&lt;b&gt;Export&lt;/b&gt;</property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">True</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">False</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">0</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="type">label_item</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">4</property>
-		  <property name="expand">True</property>
-		  <property name="fill">True</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkFrame" id="frame2">
-		  <property name="visible">True</property>
-		  <property name="label_xalign">0</property>
-		  <property name="label_yalign">0.5</property>
-		  <property name="shadow_type">GTK_SHADOW_ETCHED_IN</property>
-
-		  <child>
-		    <widget class="GtkAlignment" id="alignment3">
-		      <property name="visible">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xscale">1</property>
-		      <property name="yscale">1</property>
-		      <property name="top_padding">0</property>
-		      <property name="bottom_padding">0</property>
-		      <property name="left_padding">12</property>
-		      <property name="right_padding">0</property>
-
-		      <child>
-			<widget class="GtkTable" id="table1">
-			  <property name="visible">True</property>
-			  <property name="n_rows">2</property>
-			  <property name="n_columns">3</property>
-			  <property name="homogeneous">True</property>
-			  <property name="row_spacing">0</property>
-			  <property name="column_spacing">0</property>
-
-			  <child>
-			    <widget class="GtkRadioButton" id="rb_seen_only_n">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes">unseen only</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			      <property name="active">False</property>
-			      <property name="inconsistent">False</property>
-			      <property name="draw_indicator">True</property>
-			      <signal name="toggled" handler="on_rb_seen_only_n_toggled" last_modification_time="Wed, 10 Aug 2005 16:10:22 GMT"/>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">2</property>
-			      <property name="right_attach">3</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkRadioButton" id="rb_loaned_only_n">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes">not loaned only</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			      <property name="active">False</property>
-			      <property name="inconsistent">False</property>
-			      <property name="draw_indicator">True</property>
-			      <signal name="toggled" handler="on_rb_loaned_only_n_toggled" last_modification_time="Wed, 10 Aug 2005 16:11:52 GMT"/>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">2</property>
-			      <property name="right_attach">3</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkRadioButton" id="rb_seen_only">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes">seen only</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			      <property name="active">False</property>
-			      <property name="inconsistent">False</property>
-			      <property name="draw_indicator">True</property>
-			      <property name="group">rb_seen_only_n</property>
-			      <signal name="toggled" handler="on_rb_seen_only_toggled" last_modification_time="Wed, 10 Aug 2005 16:10:15 GMT"/>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">1</property>
-			      <property name="right_attach">2</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkRadioButton" id="rb_loaned_only">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes">loaned only</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			      <property name="active">False</property>
-			      <property name="inconsistent">False</property>
-			      <property name="draw_indicator">True</property>
-			      <property name="group">rb_loaned_only_n</property>
-			      <signal name="toggled" handler="on_rb_loaned_only_toggled" last_modification_time="Wed, 10 Aug 2005 16:10:42 GMT"/>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">1</property>
-			      <property name="right_attach">2</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkRadioButton" id="rb_seen">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes">none</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			      <property name="active">False</property>
-			      <property name="inconsistent">False</property>
-			      <property name="draw_indicator">True</property>
-			      <property name="group">rb_seen_only_n</property>
-			      <signal name="toggled" handler="on_rb_seen_toggled" last_modification_time="Wed, 10 Aug 2005 16:10:08 GMT"/>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">0</property>
-			      <property name="right_attach">1</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkRadioButton" id="rb_loaned">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes">none</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			      <property name="active">False</property>
-			      <property name="inconsistent">False</property>
-			      <property name="draw_indicator">True</property>
-			      <property name="group">rb_loaned_only_n</property>
-			      <signal name="toggled" handler="on_rb_loaned_toggled" last_modification_time="Wed, 10 Aug 2005 16:10:32 GMT"/>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">0</property>
-			      <property name="right_attach">1</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkLabel" id="label5">
-		      <property name="visible">True</property>
-		      <property name="label" translatable="yes">&lt;b&gt;Limits&lt;/b&gt;</property>
-		      <property name="use_underline">False</property>
-		      <property name="use_markup">True</property>
-		      <property name="justify">GTK_JUSTIFY_LEFT</property>
-		      <property name="wrap">False</property>
-		      <property name="selectable">False</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xpad">0</property>
-		      <property name="ypad">0</property>
-		      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-		      <property name="width_chars">-1</property>
-		      <property name="single_line_mode">False</property>
-		      <property name="angle">0</property>
-		    </widget>
-		    <packing>
-		      <property name="type">label_item</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">False</property>
-		  <property name="fill">True</property>
-		</packing>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="tab_expand">False</property>
-	      <property name="tab_fill">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkLabel" id="l_data">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">Data</property>
-	      <property name="use_underline">False</property>
-	      <property name="use_markup">False</property>
-	      <property name="justify">GTK_JUSTIFY_LEFT</property>
-	      <property name="wrap">False</property>
-	      <property name="selectable">False</property>
-	      <property name="xalign">0.5</property>
-	      <property name="yalign">0.5</property>
-	      <property name="xpad">0</property>
-	      <property name="ypad">0</property>
-	      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-	      <property name="width_chars">-1</property>
-	      <property name="single_line_mode">False</property>
-	      <property name="angle">0</property>
-	    </widget>
-	    <packing>
-	      <property name="type">tab</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkVBox" id="vbox4">
-	      <property name="visible">True</property>
-	      <property name="homogeneous">False</property>
-	      <property name="spacing">0</property>
-
-	      <child>
-		<widget class="GtkHBox" id="hbox1">
-		  <property name="border_width">4</property>
-		  <property name="visible">True</property>
-		  <property name="homogeneous">False</property>
-		  <property name="spacing">0</property>
-
-		  <child>
-		    <widget class="GtkAlignment" id="alignment4">
-		      <property name="visible">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xscale">1</property>
-		      <property name="yscale">1</property>
-		      <property name="top_padding">0</property>
-		      <property name="bottom_padding">0</property>
-		      <property name="left_padding">0</property>
-		      <property name="right_padding">10</property>
-
-		      <child>
-			<widget class="GtkLabel" id="label6">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">&lt;b&gt;Header&lt;/b&gt;</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">True</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">False</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkEntry" id="entry_header">
-		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="editable">True</property>
-		      <property name="visibility">True</property>
-		      <property name="max_length">0</property>
-		      <property name="text" translatable="yes"></property>
-		      <property name="has_frame">True</property>
-		      <property name="invisible_char">*</property>
-		      <property name="activates_default">False</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">True</property>
-		      <property name="fill">True</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkHSeparator" id="hseparator1">
-		  <property name="visible">True</property>
-		</widget>
-		<packing>
-		  <property name="padding">4</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
-	      </child>
-
-	      <child>
-		<widget class="GtkHBox" id="hbox2">
-		  <property name="visible">True</property>
-		  <property name="homogeneous">False</property>
-		  <property name="spacing">0</property>
-
-		  <child>
-		    <widget class="GtkVBox" id="vbox5">
-		      <property name="border_width">4</property>
-		      <property name="visible">True</property>
-		      <property name="homogeneous">False</property>
-		      <property name="spacing">0</property>
-
-		      <child>
-			<widget class="GtkLabel" id="l_theme">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">&lt;b&gt;Template&lt;/b&gt;</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">True</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">1</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkComboBox" id="combo_theme">
-			  <property name="visible">True</property>
-			  <property name="items" translatable="yes"></property>
-			  <property name="add_tearoffs">False</property>
-			  <property name="focus_on_click">True</property>
-			  <signal name="changed" handler="on_combo_theme_changed" last_modification_time="Thu, 14 Jul 2005 10:20:47 GMT"/>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkTable" id="table2">
-			  <property name="visible">True</property>
-			  <property name="n_rows">3</property>
-			  <property name="n_columns">3</property>
-			  <property name="homogeneous">False</property>
-			  <property name="row_spacing">2</property>
-			  <property name="column_spacing">5</property>
-
-			  <child>
-			    <widget class="GtkLabel" id="label7">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Author</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">0</property>
-			      <property name="right_attach">1</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label8">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">E-mail</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">0</property>
-			      <property name="right_attach">1</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label9">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Version</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">0</property>
-			      <property name="right_attach">1</property>
-			      <property name="top_attach">2</property>
-			      <property name="bottom_attach">3</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="l_tpl_author">
-			      <property name="visible">True</property>
-			      <property name="label">&lt;i&gt;author&lt;/i&gt;</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">True</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">2</property>
-			      <property name="right_attach">3</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="l_tpl_email">
-			      <property name="visible">True</property>
-			      <property name="label">&lt;i&gt;email&lt;/i&gt;</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">True</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">2</property>
-			      <property name="right_attach">3</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="l_tpl_version">
-			      <property name="visible">True</property>
-			      <property name="label">&lt;i&gt;version&lt;/i&gt;</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">True</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">2</property>
-			      <property name="right_attach">3</property>
-			      <property name="top_attach">2</property>
-			      <property name="bottom_attach">3</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label14">
-			      <property name="visible">True</property>
-			      <property name="label">:</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">1</property>
-			      <property name="right_attach">2</property>
-			      <property name="top_attach">0</property>
-			      <property name="bottom_attach">1</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label15">
-			      <property name="visible">True</property>
-			      <property name="label">:</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">1</property>
-			      <property name="right_attach">2</property>
-			      <property name="top_attach">1</property>
-			      <property name="bottom_attach">2</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label16">
-			      <property name="visible">True</property>
-			      <property name="label">:</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="left_attach">1</property>
-			      <property name="right_attach">2</property>
-			      <property name="top_attach">2</property>
-			      <property name="bottom_attach">3</property>
-			      <property name="x_options">fill</property>
-			      <property name="y_options"></property>
-			    </packing>
-			  </child>
-			</widget>
-			<packing>
-			  <property name="padding">4</property>
-			  <property name="expand">False</property>
-			  <property name="fill">True</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkExpander" id="expander1">
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="expanded">True</property>
-			  <property name="spacing">0</property>
-
-			  <child>
-			    <widget class="GtkLabel" id="l_tpl_desc">
-			      <property name="visible">True</property>
-			      <property name="label">&lt;i&gt;description&lt;/i&gt;</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">True</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			  </child>
-
-			  <child>
-			    <widget class="GtkLabel" id="label10">
-			      <property name="visible">True</property>
-			      <property name="label" translatable="yes">Description</property>
-			      <property name="use_underline">False</property>
-			      <property name="use_markup">False</property>
-			      <property name="justify">GTK_JUSTIFY_LEFT</property>
-			      <property name="wrap">False</property>
-			      <property name="selectable">False</property>
-			      <property name="xalign">0</property>
-			      <property name="yalign">0.5</property>
-			      <property name="xpad">0</property>
-			      <property name="ypad">0</property>
-			      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			      <property name="width_chars">-1</property>
-			      <property name="single_line_mode">False</property>
-			      <property name="angle">0</property>
-			    </widget>
-			    <packing>
-			      <property name="type">label_item</property>
-			    </packing>
-			  </child>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">False</property>
-		      <property name="fill">True</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkVSeparator" id="vseparator1">
-		      <property name="visible">True</property>
-		    </widget>
-		    <packing>
-		      <property name="padding">2</property>
-		      <property name="expand">False</property>
-		      <property name="fill">True</property>
-		    </packing>
-		  </child>
-
-		  <child>
-		    <widget class="GtkVBox" id="vbox6">
-		      <property name="border_width">4</property>
-		      <property name="visible">True</property>
-		      <property name="homogeneous">False</property>
-		      <property name="spacing">2</property>
-
-		      <child>
-			<widget class="GtkLabel" id="label11">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">&lt;b&gt;Style&lt;/b&gt;</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">True</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">1</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkComboBox" id="combo_style">
-			  <property name="visible">True</property>
-			  <property name="items" translatable="yes"></property>
-			  <property name="add_tearoffs">False</property>
-			  <property name="focus_on_click">True</property>
-			  <signal name="changed" handler="on_combo_style_changed" last_modification_time="Thu, 14 Jul 2005 10:20:54 GMT"/>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">True</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkCheckButton" id="cb_custom_style">
-			  <property name="visible">True</property>
-			  <property name="can_focus">True</property>
-			  <property name="label" translatable="yes">Use custom file</property>
-			  <property name="use_underline">True</property>
-			  <property name="relief">GTK_RELIEF_NORMAL</property>
-			  <property name="focus_on_click">True</property>
-			  <property name="active">False</property>
-			  <property name="inconsistent">False</property>
-			  <property name="draw_indicator">True</property>
-			  <signal name="toggled" handler="on_cb_custom_style_toggled" last_modification_time="Thu, 14 Jul 2005 17:16:30 GMT"/>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkFileChooserButton" id="fcb_custom_style_file">
-			  <property name="visible">True</property>
-			  <property name="title" translatable="yes">Choose style file</property>
-			  <property name="action">GTK_FILE_CHOOSER_ACTION_OPEN</property>
-			  <property name="local_only">True</property>
-			  <property name="show_hidden">False</property>
-			  <property name="do_overwrite_confirmation">False</property>
-			  <property name="width_chars">-1</property>
-			  <signal name="selection_changed" handler="on_fcb_custom_style_file_activated" last_modification_time="Thu, 14 Jul 2005 18:23:00 GMT"/>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkHSeparator" id="hseparator6">
-			  <property name="visible">True</property>
-			</widget>
-			<packing>
-			  <property name="padding">4</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="label17">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">&lt;b&gt;Example&lt;/b&gt;</property>
-			  <property name="use_underline">False</property>
-			  <property name="use_markup">True</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">1</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkHBox" id="hbox5">
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">0</property>
-
-			  <child>
-			    <placeholder/>
-			  </child>
-
-			  <child>
-			    <widget class="GtkButton" id="button1">
-			      <property name="border_width">2</property>
-			      <property name="visible">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">False</property>
-
-			      <child>
-				<widget class="GtkImage" id="image_preview">
-				  <property name="visible">True</property>
-				  <property name="stock">gtk-missing-image</property>
-				  <property name="icon_size">3</property>
-				  <property name="xalign">0.5</property>
-				  <property name="yalign">0.5</property>
-				  <property name="xpad">0</property>
-				  <property name="ypad">0</property>
-				</widget>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <placeholder/>
-			  </child>
-			</widget>
-			<packing>
-			  <property name="padding">2</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-		    </widget>
-		    <packing>
-		      <property name="padding">0</property>
-		      <property name="expand">True</property>
-		      <property name="fill">True</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">True</property>
-		  <property name="fill">True</property>
-		</packing>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="tab_expand">False</property>
-	      <property name="tab_fill">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkLabel" id="l_theme">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">Template</property>
-	      <property name="use_underline">False</property>
-	      <property name="use_markup">False</property>
-	      <property name="justify">GTK_JUSTIFY_LEFT</property>
-	      <property name="wrap">False</property>
-	      <property name="selectable">False</property>
-	      <property name="xalign">0.5</property>
-	      <property name="yalign">0.5</property>
-	      <property name="xpad">0</property>
-	      <property name="ypad">0</property>
-	      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-	      <property name="width_chars">-1</property>
-	      <property name="single_line_mode">False</property>
-	      <property name="angle">0</property>
-	    </widget>
-	    <packing>
-	      <property name="type">tab</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkVBox" id="vbox7">
-	      <property name="border_width">4</property>
-	      <property name="visible">True</property>
-	      <property name="homogeneous">False</property>
-	      <property name="spacing">0</property>
-
-	      <child>
-		<widget class="GtkFrame" id="frame3">
-		  <property name="visible">True</property>
-		  <property name="label_xalign">0</property>
-		  <property name="label_yalign">0.5</property>
-		  <property name="shadow_type">GTK_SHADOW_OUT</property>
-
-		  <child>
-		    <widget class="GtkAlignment" id="alignment13">
-		      <property name="visible">True</property>
-		      <property name="xalign">0.5</property>
-		      <property name="yalign">0.5</property>
-		      <property name="xscale">1</property>
-		      <property name="yscale">1</property>
-		      <property name="top_padding">0</property>
-		      <property name="bottom_padding">0</property>
-		      <property name="left_padding">12</property>
-		      <property name="right_padding">0</property>
-
-		      <child>
-			<widget class="GtkVBox" id="vb_posters">
-			  <property name="border_width">8</property>
-			  <property name="visible">True</property>
-			  <property name="homogeneous">False</property>
-			  <property name="spacing">4</property>
-
-			  <child>
-			    <widget class="GtkTable" id="table3">
-			      <property name="visible">True</property>
-			      <property name="n_rows">2</property>
-			      <property name="n_columns">2</property>
-			      <property name="homogeneous">False</property>
-			      <property name="row_spacing">1</property>
-			      <property name="column_spacing">8</property>
-
-			      <child>
-				<widget class="GtkLabel" id="label19">
-				  <property name="visible">True</property>
-				  <property name="label" translatable="yes">Maximal height</property>
-				  <property name="use_underline">False</property>
-				  <property name="use_markup">False</property>
-				  <property name="justify">GTK_JUSTIFY_LEFT</property>
-				  <property name="wrap">False</property>
-				  <property name="selectable">False</property>
-				  <property name="xalign">0</property>
-				  <property name="yalign">0.5</property>
-				  <property name="xpad">0</property>
-				  <property name="ypad">0</property>
-				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-				  <property name="width_chars">-1</property>
-				  <property name="single_line_mode">False</property>
-				  <property name="angle">0</property>
-				</widget>
-				<packing>
-				  <property name="left_attach">1</property>
-				  <property name="right_attach">2</property>
-				  <property name="top_attach">0</property>
-				  <property name="bottom_attach">1</property>
-				  <property name="x_options">fill</property>
-				  <property name="y_options"></property>
-				</packing>
-			      </child>
-
-			      <child>
-				<widget class="GtkLabel" id="label20">
-				  <property name="visible">True</property>
-				  <property name="label" translatable="yes">Maximal width</property>
-				  <property name="use_underline">False</property>
-				  <property name="use_markup">False</property>
-				  <property name="justify">GTK_JUSTIFY_LEFT</property>
-				  <property name="wrap">False</property>
-				  <property name="selectable">False</property>
-				  <property name="xalign">0</property>
-				  <property name="yalign">0.5</property>
-				  <property name="xpad">0</property>
-				  <property name="ypad">0</property>
-				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-				  <property name="width_chars">-1</property>
-				  <property name="single_line_mode">False</property>
-				  <property name="angle">0</property>
-				</widget>
-				<packing>
-				  <property name="left_attach">1</property>
-				  <property name="right_attach">2</property>
-				  <property name="top_attach">1</property>
-				  <property name="bottom_attach">2</property>
-				  <property name="x_options">fill</property>
-				  <property name="y_options"></property>
-				</packing>
-			      </child>
-
-			      <child>
-				<widget class="GtkSpinButton" id="sb_height">
-				  <property name="visible">True</property>
-				  <property name="can_focus">True</property>
-				  <property name="climb_rate">1</property>
-				  <property name="digits">0</property>
-				  <property name="numeric">True</property>
-				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
-				  <property name="snap_to_ticks">False</property>
-				  <property name="wrap">False</property>
-				  <property name="adjustment">200 10 10000 1 10 10</property>
-				</widget>
-				<packing>
-				  <property name="left_attach">0</property>
-				  <property name="right_attach">1</property>
-				  <property name="top_attach">0</property>
-				  <property name="bottom_attach">1</property>
-				  <property name="x_options">fill</property>
-				  <property name="y_options"></property>
-				</packing>
-			      </child>
-
-			      <child>
-				<widget class="GtkSpinButton" id="sb_width">
-				  <property name="visible">True</property>
-				  <property name="can_focus">True</property>
-				  <property name="climb_rate">1</property>
-				  <property name="digits">0</property>
-				  <property name="numeric">False</property>
-				  <property name="update_policy">GTK_UPDATE_ALWAYS</property>
-				  <property name="snap_to_ticks">False</property>
-				  <property name="wrap">False</property>
-				  <property name="adjustment">150 10 10000 1 10 10</property>
-				</widget>
-				<packing>
-				  <property name="left_attach">0</property>
-				  <property name="right_attach">1</property>
-				  <property name="top_attach">1</property>
-				  <property name="bottom_attach">2</property>
-				  <property name="x_options">fill</property>
-				  <property name="y_options"></property>
-				</packing>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkCheckButton" id="cb_black">
-			      <property name="visible">True</property>
-			      <property name="can_focus">True</property>
-			      <property name="label" translatable="yes">Black and white</property>
-			      <property name="use_underline">True</property>
-			      <property name="relief">GTK_RELIEF_NORMAL</property>
-			      <property name="focus_on_click">True</property>
-			      <property name="active">False</property>
-			      <property name="inconsistent">False</property>
-			      <property name="draw_indicator">True</property>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-
-			  <child>
-			    <widget class="GtkHBox" id="hbox7">
-			      <property name="visible">True</property>
-			      <property name="homogeneous">False</property>
-			      <property name="spacing">4</property>
-
-			      <child>
-				<widget class="GtkLabel" id="label21">
-				  <property name="visible">True</property>
-				  <property name="label" translatable="yes">Format</property>
-				  <property name="use_underline">False</property>
-				  <property name="use_markup">False</property>
-				  <property name="justify">GTK_JUSTIFY_LEFT</property>
-				  <property name="wrap">False</property>
-				  <property name="selectable">False</property>
-				  <property name="xalign">0.5</property>
-				  <property name="yalign">0.5</property>
-				  <property name="xpad">0</property>
-				  <property name="ypad">0</property>
-				  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-				  <property name="width_chars">-1</property>
-				  <property name="single_line_mode">False</property>
-				  <property name="angle">0</property>
-				</widget>
-				<packing>
-				  <property name="padding">0</property>
-				  <property name="expand">False</property>
-				  <property name="fill">False</property>
-				</packing>
-			      </child>
-
-			      <child>
-				<widget class="GtkComboBox" id="combo_format">
-				  <property name="visible">True</property>
-				  <property name="items">JPEG
+  <widget class="GtkWindow" id="w_eh">
+    <property name="width_request">600</property>
+    <property name="visible">True</property>
+    <property name="border_width">2</property>
+    <property name="title" translatable="yes">Export data</property>
+    <property name="window_position">GTK_WIN_POS_CENTER</property>
+    <property name="icon_name">gtk-convert</property>
+    <child>
+      <widget class="GtkVBox" id="vbox1">
+        <property name="visible">True</property>
+        <child>
+          <widget class="GtkNotebook" id="notebook4">
+            <property name="visible">True</property>
+            <property name="can_focus">True</property>
+            <property name="border_width">2</property>
+            <child>
+              <widget class="GtkFileChooserWidget" id="fcw">
+                <property name="visible">True</property>
+                <property name="border_width">4</property>
+                <property name="action">GTK_FILE_CHOOSER_ACTION_SELECT_FOLDER</property>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkLabel" id="l_destination">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">Destination</property>
+              </widget>
+              <packing>
+                <property name="type">tab</property>
+                <property name="tab_fill">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkVBox" id="vbox3">
+                <property name="visible">True</property>
+                <property name="border_width">4</property>
+                <property name="spacing">4</property>
+                <child>
+                  <widget class="GtkAlignment" id="alignment11">
+                    <property name="visible">True</property>
+                    <property name="xalign">1</property>
+                    <property name="xscale">0.5</property>
+                    <child>
+                      <widget class="GtkHBox" id="box_sorting">
+                        <property name="visible">True</property>
+                        <property name="spacing">8</property>
+                        <child>
+                          <widget class="GtkLabel" id="label2">
+                            <property name="visible">True</property>
+                            <property name="xalign">0.0099999997764825821</property>
+                            <property name="ypad">1</property>
+                            <property name="label" translatable="yes">&lt;b&gt;Sort by&lt;/b&gt;</property>
+                            <property name="use_markup">True</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkComboBox" id="combo_sortby">
+                            <property name="visible">True</property>
+                            <property name="items" translatable="yes"></property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkCheckButton" id="cb_reverse">
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="label" translatable="yes">Reverse</property>
+                            <property name="use_underline">True</property>
+                            <property name="response_id">0</property>
+                            <property name="draw_indicator">True</property>
+                            <signal name="toggled" handler="on_cb_reverse_toggled"/>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">2</property>
+                          </packing>
+                        </child>
+                      </widget>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkHSeparator" id="hseparator5">
+                    <property name="visible">True</property>
+                  </widget>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                    <property name="padding">4</property>
+                    <property name="position">1</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkAlignment" id="alignment12">
+                    <property name="visible">True</property>
+                    <property name="xalign">1</property>
+                    <property name="xscale">0.5</property>
+                    <child>
+                      <widget class="GtkHBox" id="box_spliting">
+                        <property name="visible">True</property>
+                        <child>
+                          <widget class="GtkLabel" id="label3">
+                            <property name="visible">True</property>
+                            <property name="label" translatable="yes">&lt;b&gt;Split into&lt;/b&gt;</property>
+                            <property name="use_markup">True</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkSpinButton" id="sb_split_num">
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="adjustment">50 1 1000 1 10 10</property>
+                            <property name="climb_rate">10</property>
+                            <property name="update_policy">GTK_UPDATE_IF_VALID</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="padding">4</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkRadioButton" id="rb_split_files">
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="label" translatable="yes">files</property>
+                            <property name="use_underline">True</property>
+                            <property name="response_id">0</property>
+                            <property name="draw_indicator">True</property>
+                            <signal name="toggled" handler="on_rb_split_files_toggled"/>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">2</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkRadioButton" id="rb_split_movies">
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="label" translatable="yes">entries per page</property>
+                            <property name="use_underline">True</property>
+                            <property name="response_id">0</property>
+                            <property name="active">True</property>
+                            <property name="draw_indicator">True</property>
+                            <property name="group">rb_split_files</property>
+                            <signal name="toggled" handler="on_rb_split_movies_toggled"/>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">3</property>
+                          </packing>
+                        </child>
+                      </widget>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                    <property name="position">2</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkFrame" id="frame1">
+                    <property name="visible">True</property>
+                    <property name="label_xalign">0</property>
+                    <child>
+                      <widget class="GtkAlignment" id="alignment2">
+                        <property name="visible">True</property>
+                        <property name="bottom_padding">2</property>
+                        <property name="left_padding">12</property>
+                        <child>
+                          <widget class="GtkHBox" id="box_include">
+                            <property name="visible">True</property>
+                            <child>
+                              <widget class="GtkVBox" id="box_include_1">
+                                <property name="visible">True</property>
+                                <child>
+                                  <placeholder/>
+                                </child>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkVBox" id="box_include_2">
+                                <property name="visible">True</property>
+                                <child>
+                                  <placeholder/>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="position">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkVBox" id="box_include_3">
+                                <property name="visible">True</property>
+                                <child>
+                                  <placeholder/>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="position">2</property>
+                              </packing>
+                            </child>
+                          </widget>
+                        </child>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkLabel" id="label4">
+                        <property name="visible">True</property>
+                        <property name="label" translatable="yes">&lt;b&gt;Export&lt;/b&gt;</property>
+                        <property name="use_markup">True</property>
+                      </widget>
+                      <packing>
+                        <property name="type">label_item</property>
+                      </packing>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="padding">4</property>
+                    <property name="position">3</property>
+                  </packing>
+                </child>
+              </widget>
+              <packing>
+                <property name="position">1</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkLabel" id="l_data">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">Data</property>
+              </widget>
+              <packing>
+                <property name="type">tab</property>
+                <property name="position">1</property>
+                <property name="tab_fill">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkVBox" id="vbox4">
+                <property name="visible">True</property>
+                <child>
+                  <widget class="GtkHBox" id="hbox1">
+                    <property name="visible">True</property>
+                    <property name="border_width">4</property>
+                    <child>
+                      <widget class="GtkAlignment" id="alignment4">
+                        <property name="visible">True</property>
+                        <property name="right_padding">10</property>
+                        <child>
+                          <widget class="GtkLabel" id="label6">
+                            <property name="visible">True</property>
+                            <property name="label" translatable="yes">&lt;b&gt;Header&lt;/b&gt;</property>
+                            <property name="use_markup">True</property>
+                          </widget>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkEntry" id="entry_header">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="invisible_char">*</property>
+                      </widget>
+                      <packing>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkHSeparator" id="hseparator1">
+                    <property name="visible">True</property>
+                  </widget>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                    <property name="padding">4</property>
+                    <property name="position">1</property>
+                  </packing>
+                </child>
+                <child>
+                  <widget class="GtkHBox" id="hbox2">
+                    <property name="visible">True</property>
+                    <child>
+                      <widget class="GtkVBox" id="vbox5">
+                        <property name="visible">True</property>
+                        <property name="border_width">4</property>
+                        <child>
+                          <widget class="GtkLabel" id="l_theme">
+                            <property name="visible">True</property>
+                            <property name="xalign">0</property>
+                            <property name="ypad">1</property>
+                            <property name="label" translatable="yes">&lt;b&gt;Template&lt;/b&gt;</property>
+                            <property name="use_markup">True</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkComboBox" id="combo_theme">
+                            <property name="visible">True</property>
+                            <property name="items" translatable="yes"></property>
+                            <signal name="changed" handler="on_combo_theme_changed"/>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkTable" id="table2">
+                            <property name="visible">True</property>
+                            <property name="n_rows">3</property>
+                            <property name="n_columns">3</property>
+                            <property name="column_spacing">5</property>
+                            <property name="row_spacing">2</property>
+                            <child>
+                              <widget class="GtkLabel" id="label16">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label">:</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">1</property>
+                                <property name="right_attach">2</property>
+                                <property name="top_attach">2</property>
+                                <property name="bottom_attach">3</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label15">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label">:</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">1</property>
+                                <property name="right_attach">2</property>
+                                <property name="top_attach">1</property>
+                                <property name="bottom_attach">2</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label14">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label">:</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">1</property>
+                                <property name="right_attach">2</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="l_tpl_version">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label">&lt;i&gt;version&lt;/i&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">2</property>
+                                <property name="right_attach">3</property>
+                                <property name="top_attach">2</property>
+                                <property name="bottom_attach">3</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="l_tpl_email">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label">&lt;i&gt;email&lt;/i&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">2</property>
+                                <property name="right_attach">3</property>
+                                <property name="top_attach">1</property>
+                                <property name="bottom_attach">2</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="l_tpl_author">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label">&lt;i&gt;author&lt;/i&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="left_attach">2</property>
+                                <property name="right_attach">3</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label9">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label" translatable="yes">Version</property>
+                              </widget>
+                              <packing>
+                                <property name="top_attach">2</property>
+                                <property name="bottom_attach">3</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label8">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label" translatable="yes">E-mail</property>
+                              </widget>
+                              <packing>
+                                <property name="top_attach">1</property>
+                                <property name="bottom_attach">2</property>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label7">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label" translatable="yes">Author</property>
+                              </widget>
+                              <packing>
+                                <property name="x_options">GTK_FILL</property>
+                                <property name="y_options"></property>
+                              </packing>
+                            </child>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="padding">4</property>
+                            <property name="position">2</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkExpander" id="expander1">
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="expanded">True</property>
+                            <child>
+                              <widget class="GtkLabel" id="l_tpl_desc">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label">&lt;i&gt;description&lt;/i&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label10">
+                                <property name="visible">True</property>
+                                <property name="xalign">0</property>
+                                <property name="label" translatable="yes">Description</property>
+                              </widget>
+                              <packing>
+                                <property name="type">label_item</property>
+                              </packing>
+                            </child>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">3</property>
+                          </packing>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkVSeparator" id="vseparator1">
+                        <property name="visible">True</property>
+                      </widget>
+                      <packing>
+                        <property name="expand">False</property>
+                        <property name="padding">2</property>
+                        <property name="position">1</property>
+                      </packing>
+                    </child>
+                    <child>
+                      <widget class="GtkVBox" id="vbox6">
+                        <property name="visible">True</property>
+                        <property name="border_width">4</property>
+                        <property name="spacing">2</property>
+                        <child>
+                          <widget class="GtkLabel" id="label11">
+                            <property name="visible">True</property>
+                            <property name="xalign">0</property>
+                            <property name="ypad">1</property>
+                            <property name="label" translatable="yes">&lt;b&gt;Style&lt;/b&gt;</property>
+                            <property name="use_markup">True</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkComboBox" id="combo_style">
+                            <property name="visible">True</property>
+                            <property name="items" translatable="yes"></property>
+                            <signal name="changed" handler="on_combo_style_changed"/>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkCheckButton" id="cb_custom_style">
+                            <property name="visible">True</property>
+                            <property name="can_focus">True</property>
+                            <property name="label" translatable="yes">Use custom file</property>
+                            <property name="use_underline">True</property>
+                            <property name="response_id">0</property>
+                            <property name="draw_indicator">True</property>
+                            <signal name="toggled" handler="on_cb_custom_style_toggled"/>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">2</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkFileChooserButton" id="fcb_custom_style_file">
+                            <property name="visible">True</property>
+                            <property name="title" translatable="yes">Choose style file</property>
+                            <signal name="selection_changed" handler="on_fcb_custom_style_file_activated"/>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">3</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkHSeparator" id="hseparator6">
+                            <property name="visible">True</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="padding">4</property>
+                            <property name="position">4</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkLabel" id="label17">
+                            <property name="visible">True</property>
+                            <property name="xalign">0</property>
+                            <property name="ypad">1</property>
+                            <property name="label" translatable="yes">&lt;b&gt;Example&lt;/b&gt;</property>
+                            <property name="use_markup">True</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">5</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkHBox" id="hbox5">
+                            <property name="visible">True</property>
+                            <child>
+                              <placeholder/>
+                            </child>
+                            <child>
+                              <widget class="GtkButton" id="button1">
+                                <property name="visible">True</property>
+                                <property name="border_width">2</property>
+                                <property name="focus_on_click">False</property>
+                                <property name="response_id">0</property>
+                                <child>
+                                  <widget class="GtkImage" id="image_preview">
+                                    <property name="visible">True</property>
+                                    <property name="stock">gtk-missing-image</property>
+                                    <property name="icon_size">3</property>
+                                  </widget>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="position">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <placeholder/>
+                            </child>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="padding">2</property>
+                            <property name="position">6</property>
+                          </packing>
+                        </child>
+                      </widget>
+                      <packing>
+                        <property name="position">2</property>
+                      </packing>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="position">2</property>
+                  </packing>
+                </child>
+              </widget>
+              <packing>
+                <property name="position">2</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkLabel" id="l_theme1">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">Template</property>
+              </widget>
+              <packing>
+                <property name="type">tab</property>
+                <property name="position">2</property>
+                <property name="tab_fill">False</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkVBox" id="vbox7">
+                <property name="visible">True</property>
+                <property name="border_width">4</property>
+                <child>
+                  <widget class="GtkFrame" id="frame3">
+                    <property name="visible">True</property>
+                    <property name="label_xalign">0</property>
+                    <property name="shadow_type">GTK_SHADOW_OUT</property>
+                    <child>
+                      <widget class="GtkAlignment" id="alignment13">
+                        <property name="visible">True</property>
+                        <property name="left_padding">12</property>
+                        <child>
+                          <widget class="GtkVBox" id="vb_posters">
+                            <property name="visible">True</property>
+                            <property name="border_width">8</property>
+                            <property name="spacing">4</property>
+                            <child>
+                              <widget class="GtkTable" id="table3">
+                                <property name="visible">True</property>
+                                <property name="n_rows">2</property>
+                                <property name="n_columns">2</property>
+                                <property name="column_spacing">8</property>
+                                <property name="row_spacing">1</property>
+                                <child>
+                                  <widget class="GtkSpinButton" id="sb_width">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="adjustment">150 10 10000 1 10 10</property>
+                                    <property name="climb_rate">1</property>
+                                  </widget>
+                                  <packing>
+                                    <property name="top_attach">1</property>
+                                    <property name="bottom_attach">2</property>
+                                    <property name="x_options">GTK_FILL</property>
+                                    <property name="y_options"></property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <widget class="GtkSpinButton" id="sb_height">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">True</property>
+                                    <property name="adjustment">200 10 10000 1 10 10</property>
+                                    <property name="climb_rate">1</property>
+                                    <property name="numeric">True</property>
+                                  </widget>
+                                  <packing>
+                                    <property name="x_options">GTK_FILL</property>
+                                    <property name="y_options"></property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <widget class="GtkLabel" id="label20">
+                                    <property name="visible">True</property>
+                                    <property name="xalign">0</property>
+                                    <property name="label" translatable="yes">Maximal width</property>
+                                  </widget>
+                                  <packing>
+                                    <property name="left_attach">1</property>
+                                    <property name="right_attach">2</property>
+                                    <property name="top_attach">1</property>
+                                    <property name="bottom_attach">2</property>
+                                    <property name="x_options">GTK_FILL</property>
+                                    <property name="y_options"></property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <widget class="GtkLabel" id="label19">
+                                    <property name="visible">True</property>
+                                    <property name="xalign">0</property>
+                                    <property name="label" translatable="yes">Maximal height</property>
+                                  </widget>
+                                  <packing>
+                                    <property name="left_attach">1</property>
+                                    <property name="right_attach">2</property>
+                                    <property name="x_options">GTK_FILL</property>
+                                    <property name="y_options"></property>
+                                  </packing>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkCheckButton" id="cb_black">
+                                <property name="visible">True</property>
+                                <property name="can_focus">True</property>
+                                <property name="label" translatable="yes">Black and white</property>
+                                <property name="use_underline">True</property>
+                                <property name="response_id">0</property>
+                                <property name="draw_indicator">True</property>
+                              </widget>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="position">1</property>
+                              </packing>
+                            </child>
+                            <child>
+                              <widget class="GtkHBox" id="hbox7">
+                                <property name="visible">True</property>
+                                <property name="spacing">4</property>
+                                <child>
+                                  <widget class="GtkLabel" id="label21">
+                                    <property name="visible">True</property>
+                                    <property name="label" translatable="yes">Format</property>
+                                  </widget>
+                                  <packing>
+                                    <property name="expand">False</property>
+                                    <property name="fill">False</property>
+                                  </packing>
+                                </child>
+                                <child>
+                                  <widget class="GtkComboBox" id="combo_format">
+                                    <property name="visible">True</property>
+                                    <property name="items">JPEG
 PNG
 GIF</property>
-				  <property name="add_tearoffs">False</property>
-				  <property name="focus_on_click">True</property>
-				</widget>
-				<packing>
-				  <property name="padding">0</property>
-				  <property name="expand">False</property>
-				  <property name="fill">True</property>
-				</packing>
-			      </child>
-			    </widget>
-			    <packing>
-			      <property name="padding">0</property>
-			      <property name="expand">False</property>
-			      <property name="fill">False</property>
-			    </packing>
-			  </child>
-			</widget>
-		      </child>
-		    </widget>
-		  </child>
-
-		  <child>
-		    <widget class="GtkCheckButton" id="cb_convert">
-		      <property name="visible">True</property>
-		      <property name="can_focus">True</property>
-		      <property name="label" translatable="yes">Convert images</property>
-		      <property name="use_underline">True</property>
-		      <property name="relief">GTK_RELIEF_NORMAL</property>
-		      <property name="focus_on_click">True</property>
-		      <property name="active">False</property>
-		      <property name="inconsistent">False</property>
-		      <property name="draw_indicator">True</property>
-		      <signal name="toggled" handler="on_cb_convert_toggled" last_modification_time="Sat, 12 Nov 2005 20:14:33 GMT"/>
-		    </widget>
-		    <packing>
-		      <property name="type">label_item</property>
-		    </packing>
-		  </child>
-		</widget>
-		<packing>
-		  <property name="padding">0</property>
-		  <property name="expand">False</property>
-		  <property name="fill">False</property>
-		</packing>
-	      </child>
-	    </widget>
-	    <packing>
-	      <property name="tab_expand">False</property>
-	      <property name="tab_fill">True</property>
-	    </packing>
-	  </child>
-
-	  <child>
-	    <widget class="GtkLabel" id="l_posters">
-	      <property name="visible">True</property>
-	      <property name="label" translatable="yes">Posters</property>
-	      <property name="use_underline">False</property>
-	      <property name="use_markup">False</property>
-	      <property name="justify">GTK_JUSTIFY_LEFT</property>
-	      <property name="wrap">False</property>
-	      <property name="selectable">False</property>
-	      <property name="xalign">0.5</property>
-	      <property name="yalign">0.5</property>
-	      <property name="xpad">0</property>
-	      <property name="ypad">0</property>
-	      <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-	      <property name="width_chars">-1</property>
-	      <property name="single_line_mode">False</property>
-	      <property name="angle">0</property>
-	    </widget>
-	    <packing>
-	      <property name="type">tab</property>
-	    </packing>
-	  </child>
-	</widget>
-	<packing>
-	  <property name="padding">0</property>
-	  <property name="expand">True</property>
-	  <property name="fill">True</property>
-	</packing>
-      </child>
-
-      <child>
-	<widget class="GtkHButtonBox" id="hbuttonbox12">
-	  <property name="visible">True</property>
-	  <property name="layout_style">GTK_BUTTONBOX_END</property>
-	  <property name="spacing">8</property>
-
-	  <child>
-	    <widget class="GtkButton" id="cancel_button">
-	      <property name="visible">True</property>
-	      <property name="can_focus">True</property>
-	      <property name="label">gtk-cancel</property>
-	      <property name="use_stock">True</property>
-	      <property name="relief">GTK_RELIEF_NORMAL</property>
-	      <property name="focus_on_click">True</property>
-	      <signal name="clicked" handler="on_cancel_button_clicked" last_modification_time="Thu, 14 Jul 2005 16:48:41 GMT"/>
-	    </widget>
-	  </child>
-
-	  <child>
-	    <widget class="GtkButton" id="export_button">
-	      <property name="visible">True</property>
-	      <property name="can_focus">True</property>
-	      <property name="relief">GTK_RELIEF_NORMAL</property>
-	      <property name="focus_on_click">True</property>
-	      <signal name="clicked" handler="on_export_button_clicked" last_modification_time="Thu, 14 Jul 2005 16:49:02 GMT"/>
-
-	      <child>
-		<widget class="GtkAlignment" id="alignment6">
-		  <property name="visible">True</property>
-		  <property name="xalign">0.5</property>
-		  <property name="yalign">0.5</property>
-		  <property name="xscale">0</property>
-		  <property name="yscale">0</property>
-		  <property name="top_padding">0</property>
-		  <property name="bottom_padding">0</property>
-		  <property name="left_padding">0</property>
-		  <property name="right_padding">0</property>
-
-		  <child>
-		    <widget class="GtkHBox" id="hbox4">
-		      <property name="visible">True</property>
-		      <property name="homogeneous">False</property>
-		      <property name="spacing">2</property>
-
-		      <child>
-			<widget class="GtkImage" id="image307">
-			  <property name="visible">True</property>
-			  <property name="stock">gtk-convert</property>
-			  <property name="icon_size">4</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-
-		      <child>
-			<widget class="GtkLabel" id="label13">
-			  <property name="visible">True</property>
-			  <property name="label" translatable="yes">Export</property>
-			  <property name="use_underline">True</property>
-			  <property name="use_markup">False</property>
-			  <property name="justify">GTK_JUSTIFY_LEFT</property>
-			  <property name="wrap">False</property>
-			  <property name="selectable">False</property>
-			  <property name="xalign">0.5</property>
-			  <property name="yalign">0.5</property>
-			  <property name="xpad">0</property>
-			  <property name="ypad">0</property>
-			  <property name="ellipsize">PANGO_ELLIPSIZE_NONE</property>
-			  <property name="width_chars">-1</property>
-			  <property name="single_line_mode">False</property>
-			  <property name="angle">0</property>
-			</widget>
-			<packing>
-			  <property name="padding">0</property>
-			  <property name="expand">False</property>
-			  <property name="fill">False</property>
-			</packing>
-		      </child>
-		    </widget>
-		  </child>
-		</widget>
-	      </child>
-	    </widget>
-	  </child>
-	</widget>
-	<packing>
-	  <property name="padding">0</property>
-	  <property name="expand">False</property>
-	  <property name="fill">True</property>
-	</packing>
-      </child>
-    </widget>
-  </child>
-</widget>
-
+                                  </widget>
+                                  <packing>
+                                    <property name="expand">False</property>
+                                    <property name="position">1</property>
+                                  </packing>
+                                </child>
+                              </widget>
+                              <packing>
+                                <property name="expand">False</property>
+                                <property name="fill">False</property>
+                                <property name="position">2</property>
+                              </packing>
+                            </child>
+                          </widget>
+                        </child>
+                      </widget>
+                    </child>
+                    <child>
+                      <widget class="GtkCheckButton" id="cb_convert">
+                        <property name="visible">True</property>
+                        <property name="can_focus">True</property>
+                        <property name="label" translatable="yes">Convert images</property>
+                        <property name="use_underline">True</property>
+                        <property name="response_id">0</property>
+                        <property name="draw_indicator">True</property>
+                        <signal name="toggled" handler="on_cb_convert_toggled"/>
+                      </widget>
+                      <packing>
+                        <property name="type">label_item</property>
+                      </packing>
+                    </child>
+                  </widget>
+                  <packing>
+                    <property name="expand">False</property>
+                    <property name="fill">False</property>
+                  </packing>
+                </child>
+              </widget>
+              <packing>
+                <property name="position">3</property>
+              </packing>
+            </child>
+            <child>
+              <widget class="GtkLabel" id="l_posters">
+                <property name="visible">True</property>
+                <property name="label" translatable="yes">Posters</property>
+              </widget>
+              <packing>
+                <property name="type">tab</property>
+                <property name="position">3</property>
+                <property name="tab_fill">False</property>
+              </packing>
+            </child>
+          </widget>
+        </child>
+        <child>
+          <widget class="GtkHButtonBox" id="hbuttonbox12">
+            <property name="visible">True</property>
+            <property name="spacing">8</property>
+            <property name="layout_style">GTK_BUTTONBOX_END</property>
+            <child>
+              <widget class="GtkButton" id="cancel_button">
+                <property name="visible">True</property>
+                <property name="can_focus">True</property>
+                <property name="label">gtk-cancel</property>
+                <property name="use_stock">True</property>
+                <property name="response_id">0</property>
+                <signal name="clicked" handler="on_cancel_button_clicked"/>
+              </widget>
+            </child>
+            <child>
+              <widget class="GtkButton" id="export_button">
+                <property name="visible">True</property>
+                <property name="can_focus">True</property>
+                <property name="response_id">0</property>
+                <signal name="clicked" handler="on_export_button_clicked"/>
+                <child>
+                  <widget class="GtkAlignment" id="alignment6">
+                    <property name="visible">True</property>
+                    <property name="xscale">0</property>
+                    <property name="yscale">0</property>
+                    <child>
+                      <widget class="GtkHBox" id="hbox4">
+                        <property name="visible">True</property>
+                        <property name="spacing">2</property>
+                        <child>
+                          <widget class="GtkImage" id="image307">
+                            <property name="visible">True</property>
+                            <property name="stock">gtk-convert</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                          </packing>
+                        </child>
+                        <child>
+                          <widget class="GtkLabel" id="label13">
+                            <property name="visible">True</property>
+                            <property name="label" translatable="yes">Export</property>
+                            <property name="use_underline">True</property>
+                          </widget>
+                          <packing>
+                            <property name="expand">False</property>
+                            <property name="fill">False</property>
+                            <property name="position">1</property>
+                          </packing>
+                        </child>
+                      </widget>
+                    </child>
+                  </widget>
+                </child>
+              </widget>
+              <packing>
+                <property name="position">1</property>
+              </packing>
+            </child>
+          </widget>
+          <packing>
+            <property name="expand">False</property>
+            <property name="position">1</property>
+          </packing>
+        </child>
+      </widget>
+    </child>
+  </widget>
 </glade-interface>

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/griffith	2008-11-15 21:39:47 UTC (rev 1041)
@@ -169,8 +169,14 @@
     ###########        
 
     def on_export_activate(self, menu_iter, plugin_name):
-        export_plugin = __import__('PluginExport%s' % plugin_name)
-        export_plugin.ExportPlugin(self.db, self.locations, self.widgets['window'], config=self.config)
+        module = __import__('PluginExport%s' % plugin_name)
+        plugin = module.ExportPlugin(self.db, self.locations, self.widgets['window'], self._search_conditions, self.config)
+        if plugin.initialize():
+            try:
+                plugin.run()
+            except Exception, e:
+                log.error(str(e))
+            plugin.cleanup()
 
     def on_import_activate(self, *args):
         if self.widgets.has_key('import'):

Modified: trunk/lib/about.py
===================================================================
--- trunk/lib/about.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/about.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gtk
 import version
 import os

Modified: trunk/lib/add.py
===================================================================
--- trunk/lib/add.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/add.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -23,8 +23,6 @@
 # GNU General Public License, version 2 or later
 
 from sqlalchemy.exceptions import IntegrityError
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import os
 import gtk

Modified: trunk/lib/advfilter.py
===================================================================
--- trunk/lib/advfilter.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/advfilter.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -42,7 +42,7 @@
     'required_tags'   : set(), # like in tags, but movie must contain all listed tags
     'loaned_to'       : set(), # list of person_ids     (search for movies loaned to these people)
     'loan_history'    : set(), # list of person_ids     (search for movies which were loaned by these people)
-    'sort_by'         : set(("number",)), # "number DESC"
+    'sort_by'         : ("number",), # "number DESC"
     'equals'          : {}, # {column1: set(value1, value2), column2: set(value3)}
     'equals_n'        : {}, # see above
     'startswith'      : {}, # see above
@@ -401,8 +401,8 @@
 
     self._search_conditions = conditions # save for later
     # TODO: remove after debugging:
-    from pprint import pprint
-    pprint(conditions)
+#    from pprint import pprint
+#    pprint(conditions)
 
     return sql.update_whereclause(query, conditions)
 

Modified: trunk/lib/backup.py
===================================================================
--- trunk/lib/backup.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/backup.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gtk
 import os.path
 import zipfile

Modified: trunk/lib/cover.py
===================================================================
--- trunk/lib/cover.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/cover.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -26,8 +26,6 @@
 import pango
 import string
 import sys
-import gettext
-gettext.install('griffith', unicode=1)
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm

Modified: trunk/lib/db.py
===================================================================
--- trunk/lib/db.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/db.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -24,8 +24,6 @@
 
 # XXX: keep stdlib and SQLAlchemy imports only in this file
 
-import gettext
-gettext.install('griffith', unicode=1)
 from sqlalchemy     import *
 from sqlalchemy.orm import mapper, relation, sessionmaker, validates
 import re

Modified: trunk/lib/dbupgrade.py
===================================================================
--- trunk/lib/dbupgrade.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/dbupgrade.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 from sqlalchemy import *
 import os.path
 import gutils

Modified: trunk/lib/delete.py
===================================================================
--- trunk/lib/delete.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/delete.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -22,8 +22,6 @@
 # GNU General Public License, version 2 or later
 
 import os
-import gettext
-gettext.install('griffith', unicode=1)
 import logging
 log = logging.getLogger("Griffith")
 import gutils

Modified: trunk/lib/edit.py
===================================================================
--- trunk/lib/edit.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/edit.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -25,8 +25,6 @@
 import gtk
 import tempfile
 import shutil
-import gettext
-gettext.install('griffith', unicode=1)
 from PIL     import Image
 from urllib  import urlcleanup, FancyURLopener, urlretrieve
 import logging

Modified: trunk/lib/gconsole.py
===================================================================
--- trunk/lib/gconsole.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/gconsole.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import getopt
 import sys
 import gutils

Modified: trunk/lib/gemail.py
===================================================================
--- trunk/lib/gemail.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/gemail.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -24,8 +24,6 @@
 import socket
 import smtplib
 import gutils
-import gettext
-gettext.install('griffith', unicode=1)
 
 socket.setdefaulttimeout(10)
 

Modified: trunk/lib/gutils.py
===================================================================
--- trunk/lib/gutils.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/gutils.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import string
 import os
 import sys

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/initialize.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -25,13 +25,11 @@
 import os
 import string
 import gtk
+import gettext
 import gutils
 import gobject
-import gettext
 import platform
 import re
-import gettext
-gettext.install('griffith', unicode=1)
 from locale import getdefaultlocale
 import logging
 log = logging.getLogger("Griffith")

Modified: trunk/lib/loan.py
===================================================================
--- trunk/lib/loan.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/loan.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
 gettext.install('griffith', unicode=1)
 import gutils
 import gtk

Modified: trunk/lib/main_treeview.py
===================================================================
--- trunk/lib/main_treeview.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/main_treeview.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -23,8 +23,6 @@
 
 from sqlalchemy import select, desc
 from sqlalchemy.sql.expression import Select
-import gettext
-gettext.install('griffith', unicode=1)
 import os
 import gtk
 import logging

Modified: trunk/lib/movie.py
===================================================================
--- trunk/lib/movie.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/movie.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 from urllib import *
 import sys
 import string

Modified: trunk/lib/people.py
===================================================================
--- trunk/lib/people.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/people.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import db
 import logging

Modified: trunk/lib/plugins/export/PluginExportCSV.py
===================================================================
--- trunk/lib/plugins/export/PluginExportCSV.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/export/PluginExportCSV.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -24,58 +24,51 @@
 import csv
 import gtk
 import os
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import db
+from plugins.export import Base
 
-plugin_name = "CSV"
-plugin_description = _("Full CSV list export plugin")
-plugin_author = "Vasco Nunes"
-plugin_author_email = "<vasco.m.nunes at gmail.com>"
-plugin_version = "0.2"
+class ExportPlugin(Base):
+    name = "CSV"
+    description = _("Full CSV list export plugin")
+    author = "Vasco Nunes"
+    email = "<vasco.m.nunes at gmail.com>"
+    version = "0.3"
 
-class ExportPlugin:
+    fields_to_export = ('number', 'o_title', 'title', 'director', 'year', 'classification', 'country',
+                        'genre', 'rating', 'runtime', 'studio', 'seen', 'loaned', 'o_site', 'site', 'trailer',
+                        'plot', 'cast', 'notes', 'image', 'volumes.name', 'collections.name', 'media.name')
 
-    def __init__(self, database, locations, parent, **kwargs):
-        self.db = database
-        self.locations = locations
-        self.parent = parent
-        if kwargs.has_key('config'):
-            self.persistent_config = kwargs['config']
-        else:
-            self.persistent_config = None
-        self.export_csv()
-
-    def export_csv(self):
+    def run(self):
         basedir = None
-        if not self.persistent_config is None:
-            basedir = self.persistent_config.get('export_dir', None, section='export-csv')
-        if basedir is None:
+        if not self.config is None:
+            basedir = self.config.get('export_dir', None, section='export-csv')
+        if not basedir:
             filename = gutils.file_chooser(_("Export a %s document")%"CSV", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
                 buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.csv')
         else:
             filename = gutils.file_chooser(_("Export a %s document")%"CSV", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
                 buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.csv',folder=basedir)
-        if filename[0]:
-            if not self.persistent_config is None and filename[1]:
-                self.persistent_config.set('export_dir', filename[1], section='export-csv')
-                self.persistent_config.save()
+        if filename and filename[0]:
+            if not self.config is None and filename[1]:
+                self.config.set('export_dir', filename[1], section='export-csv')
+                self.config.save()
             overwrite = None
             if os.path.isfile(filename[0]):
-                response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent)
+                response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent_window)
                 if response==-8:
                     overwrite = True
                 else:
                     overwrite = False
-                    
+            
             if overwrite == True or overwrite is None:
+                movies = self.get_query().execute()
+
                 writer = csv.writer(file(filename[0], 'w'), dialect=csv.excel)
-                for movie in self.db.session.query(db.Movie).all():
+                for movie in movies:
                     t = []
-                    for s in ('number', 'o_title', 'title', 'director', 'year', 'classification', 'country',
-                            'genre', 'rating', 'runtime', 'studio', 'seen', 'loaned', 'o_site', 'site', 'trailer',
-                            'plot', 'cast', 'notes','image'):
+                    for s in self.exported_columns:
                         t.append(movie[s])
                     writer.writerow(t)
-                gutils.info(_("%s file has been created.")%"CSV", self.parent)
+                gutils.info(_("%s file has been created.") % "CSV", self.parent_window)
+

Modified: trunk/lib/plugins/export/PluginExportHTML.py
===================================================================
--- trunk/lib/plugins/export/PluginExportHTML.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/export/PluginExportHTML.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -3,7 +3,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2005-2007 Piotr O?arowski
+# Copyright (c) 2005-2008 Piotr O?arowski
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -30,21 +30,20 @@
 import version
 import math
 from xml.dom import minidom
-import gettext
-gettext.install('griffith', unicode=1)
 import logging
 log = logging.getLogger("Griffith")
 import db
+from plugins.export import Base
 
-plugin_name         = 'HTML'
-plugin_description  = _('Plugin exports data using templates')
-plugin_author       = 'Piotr O?arowski'
-plugin_author_email = 'ozarow+griffith at gmail.com'
-plugin_version      = '3.8'
+class ExportPlugin(Base):
+    name = 'HTML'
+    description = _('Plugin exports data using templates')
+    author = 'Piotr O?arowski'
+    email = 'piotr at griffith.cc'
+    version = '4.0'
 
-class ExportPlugin(gtk.Window):
     #==[ configuration - default values ]==========={{{
-    config = {
+    settings = {
         'sorting'           : 'movies_title',
         'sorting2'          : 'ASC',
         'exported_dir'      : 'griffith_movies',
@@ -53,14 +52,12 @@
         'style'             : 0,
         'custom_style'      : False,
         'custom_style_file' : None,
-        'split_num'         : 50,        # split into x files/pages
-        'split_by'          : 1,        # 0==files, 1==movies
-        'seen_only'         : 0,        # 0==all movies; 1==seen only;   2==unseen only
-        'loaned_only'       : 0,        # 0==all movies; 1==loaned only; 2==not loaned only
-        'poster_convert'    : False,        # dont convert
+        'split_num'         : 50,    # split into x files/pages
+        'split_by'          : 1,     # 0==files, 1==movies
+        'poster_convert'    : False, # dont convert
         'poster_height'     : 200,
         'poster_width'      : 150,
-        'poster_mode'       : 'RGB',        # RGB == color, L == black and white
+        'poster_mode'       : 'RGB', # RGB == color, L == black and white
         'poster_format'     : 'jpg'
     }
     fields = {
@@ -169,22 +166,25 @@
     }
     #}}}
 
-    def __init__(self, database, locations, parent_window, **kwargs):#{{{
-        self.db = database
-        self.locations = locations
-        if kwargs.has_key('config'):
-            self.persistent_config = kwargs['config']
-        else:
-            self.persistent_config = None
+    def initialize(self): #{{{
+        self.fields_to_export = []
+        for field in ExportPlugin.fields:
+            pos = field.find('_')
+            self.fields_to_export.append("%s.%s" % (field[:pos], field[pos+1:]))
+
         self.widgets = {}
         self.style_list = {}
         self.templates = self.make_template_list()
         # glade
-        gf = os.path.join(locations['glade'], 'exporthtml.glade')
+        gf = os.path.join(self.locations['glade'], 'exporthtml.glade')
         self.define_widgets(gtk.glade.XML(gf))
         self.fill_widgets()
+        return True
     #}}}
 
+    def run(self):
+        pass
+
     def get_node_value_by_language(self, parent, name, language='en'):#{{{
         nodes = parent.getElementsByTagName(name)
         for node in nodes:
@@ -272,12 +272,6 @@
             'sb_split_num'          : get('sb_split_num'),
             'rb_split_files'        : get('rb_split_files'),
             'rb_split_movies'       : get('rb_split_movies'),
-            'rb_seen'               : get('rb_seen'),
-            'rb_seen_only'          : get('rb_seen_only'),
-            'rb_seen_only_n'        : get('rb_seen_only_n'),
-            'rb_loaned'             : get('rb_loaned'),
-            'rb_loaned_only'        : get('rb_loaned_only'),
-            'rb_loaned_only_n'      : get('rb_loaned_only_n'),
             'entry_header'          : get('entry_header'),
             'cb_custom_style'       : get('cb_custom_style'),
             'cb_reverse'            : get('cb_reverse'),
@@ -303,12 +297,6 @@
             'on_export_button_clicked'           : self.export_data,
             'on_rb_split_files_toggled'          : self.on_rb_split_files_toggled,
             'on_rb_split_movies_toggled'         : self.on_rb_split_movies_toggled,
-            'on_rb_seen_toggled'                 : self.on_rb_seen_toggled,
-            'on_rb_seen_only_toggled'            : self.on_rb_seen_only_toggled,
-            'on_rb_seen_only_n_toggled'          : self.on_rb_seen_only_n_toggled,
-            'on_rb_loaned_toggled'               : self.on_rb_loaned_toggled,
-            'on_rb_loaned_only_toggled'          : self.on_rb_loaned_only_toggled,
-            'on_rb_loaned_only_n_toggled'        : self.on_rb_loaned_only_n_toggled,
             'on_cancel_button_clicked'           : self.on_quit,
             'on_cb_data_toggled'                 : self.on_cb_data_toggled,
             'on_cb_custom_style_toggled'         : self.on_cb_custom_style_toggled,
@@ -356,39 +344,26 @@
         self.widgets['box_include_3'].show_all()
 
         # set defaults --------------------------------
-        self.widgets['entry_header'].set_text(self.config['title'])
+        self.widgets['entry_header'].set_text(self.settings['title'])
         self.widgets['combo_theme'].set_active(2)    # html_tables
         self.widgets['combo_sortby'].set_active(pos_o_title)    # orginal title
         # spliting
-        self.widgets['sb_split_num'].set_value(self.config['split_num'])
-        if self.config['split_by'] == 0:
+        self.widgets['sb_split_num'].set_value(self.settings['split_num'])
+        if self.settings['split_by'] == 0:
             self.widgets['rb_split_files'].set_active(True)
         else:
             self.widgets['rb_split_movies'].set_active(True)
-        # limiting
-        if self.config['seen_only'] == 2:
-            self.widgets['rb_seen_only_n'].set_active(True)
-        elif self.config['seen_only'] == 1:
-            self.widgets['rb_seen_only'].set_active(True)
-        else:
-            self.widgets['rb_seen'].set_active(True)
-        if self.config['loaned_only'] == 2:
-            self.widgets['rb_loaned_only_n'].set_active(True)
-        elif self.config['loaned_only'] == 1:
-            self.widgets['rb_loaned_only'].set_active(True)
-        else:
-            self.widgets['rb_loaned'].set_active(True)
         # posters
         self.widgets['combo_format'].set_active(0)
-        if self.config['poster_convert'] and self.config['poster_convert'] == True:
+        if self.settings['poster_convert'] and self.settings['poster_convert'] == True:
             self.widgets['cb_convert'].set_active(True)
             self.widgets['vb_posters'].set_sensitive(True)
         else:
             self.widgets['cb_convert'].set_active(False)
             self.widgets['vb_posters'].set_sensitive(False)
         # persistent config
-        if not self.persistent_config is None:
-            tmp = self.persistent_config.get('export_dir', None, section='export-html')
+        if self.config is not None:
+            tmp = self.config.get('export_dir', None, section='export-html')
             if not tmp is None:
                 self.widgets['fcw'].set_current_folder(tmp)
     #}}}
@@ -400,44 +375,19 @@
 
     # data tab -------------------------------------#{{{
     def on_rb_split_files_toggled(self, widget):
-        self.config['split_by'] = 0    # files
+        self.settings['split_by'] = 0    # files
 
     def on_rb_split_movies_toggled(self, widget):
-        self.config['split_by'] = 1    # movies
+        self.settings['split_by'] = 1    # movies
     
     # export frame
     def on_cb_data_toggled(self, widget):
         self.fields[gutils.after(widget.get_name(), 'cb_')] = widget.get_active()
 
-    # limit frame
-    def on_rb_seen_toggled(self, widget):
-        if widget.get_active():
-            self.config['seen_only'] = 0    # export all movies
-
-    def on_rb_seen_only_toggled(self, widget):
-        if widget.get_active():
-            self.config['seen_only'] = 1    # export only seen movies
-    
-    def on_rb_seen_only_n_toggled(self, widget):
-        if widget.get_active():
-            self.config['seen_only'] = 2    # export only unseen movies
-    
-    def on_rb_loaned_toggled(self, widget):
-        if widget.get_active():
-            self.config['loaned_only'] = 0  # export all movies
-
-    def on_rb_loaned_only_toggled(self, widget):
-        if widget.get_active():
-            self.config['loaned_only'] = 1  # export only loaned movies
-    
-    def on_rb_loaned_only_n_toggled(self, widget):
-        if widget.get_active():
-            self.config['loaned_only'] = 2  # export only not loaned movies
-    
     # posters frame
     def on_cb_convert_toggled(self, widget):
         active = widget.get_active()
-        self.config['poster_convert'] = active
+        self.settings['poster_convert'] = active
         if not active:
             self.widgets['vb_posters'].set_sensitive(False)
         else:
@@ -446,9 +396,9 @@
 
     # template tab ---------------------------------#{{{
     def on_combo_theme_changed(self, widget):
-        old_id = self.config['template']
+        old_id = self.settings['template']
         tpl_id = widget.get_active()
-        self.config['template'] = tpl_id
+        self.settings['template'] = tpl_id
         # fill authors data
         self.widgets['l_tpl_author'].set_markup("<i>%s</i>" % self.templates[tpl_id]['author'])
         self.widgets['l_tpl_email'].set_markup("<i>%s</i>" % self.templates[tpl_id]['email'])
@@ -463,18 +413,18 @@
                 self.widgets['combo_style'].insert_text(i, self.templates[tpl_id]['styles'][i]['name'])    # template name
             self.widgets['combo_style'].set_active(0)
         else:
-            self.config['style'] = None
+            self.settings['style'] = None
             self.widgets['image_preview'].set_from_stock(gtk.STOCK_MISSING_IMAGE, gtk.ICON_SIZE_LARGE_TOOLBAR)
 
     def on_combo_style_changed(self, widget):
-        self.config['style'] = widget.get_active()
+        self.settings['style'] = widget.get_active()
         self.widgets['cb_custom_style'].set_active(False)
         preview_file = None
 
-        tpl_id = self.config['template']
+        tpl_id = self.settings['template']
         template_dir = os.path.join(self.locations['share'], 'export_templates', self.templates[tpl_id]['dir'])
-        if self.config['style'] > -1:
-            preview_file = self.templates[self.config['template']]['styles'][self.config['style']]['preview']
+        if self.settings['style'] > -1:
+            preview_file = self.templates[self.settings['template']]['styles'][self.settings['style']]['preview']
         if preview_file is not None:
             preview_file = os.path.join(template_dir, preview_file)
         if preview_file is not None and not os.path.isfile(preview_file):
@@ -489,20 +439,20 @@
 
     def on_cb_custom_style_toggled(self, widget):
         if widget.get_active():
-            self.config['custom_style'] = True
+            self.settings['custom_style'] = True
             self.widgets['image_preview'].hide()
         else:
-            self.config['custom_style'] = False
+            self.settings['custom_style'] = False
             self.widgets['image_preview'].show()
 
     def on_fcb_custom_style_file_activated(self, widget):
-        self.config['custom_style_file'] = widget.get_filename()
+        self.settings['custom_style_file'] = widget.get_filename()
         self.widgets['cb_custom_style'].set_active(True)
     #}}} }}}
 
     def make_navigation(self, pages, current):#{{{
         if pages > 1:    # navigation needed
-            tpl_id = self.config['template']
+            tpl_id = self.settings['template']
             t = '<div class="navi">\n\t<p id="prev">'
             if current > 1:
                 t += '<a href="./page_%s.%s">%s</a>' % \
@@ -547,95 +497,46 @@
     #}}}
 
     def select(self):    #{{{
-        from sqlalchemy import select, outerjoin
-        config = self.config
-        
-        # columns to select
-        columns = []
-        for i in self.fields_as_columns:
-            try:
-                columns.append(db.movies_table.c[self.fields_as_columns[i]])
-            except:
-                pass
-        # use outer join to media table to get the name of the media
-        columns.append(db.media_table.c['name'])
-        media_join = outerjoin(db.movies_table, db.media_table, \
-                db.movies_table.c.medium_id==db.media_table.c.medium_id)
-        # use outer join to collections table to get the name of the collection
-        columns.append(db.collections_table.c['name'])
-        collection_join = media_join.outerjoin(db.collections_table, \
-            db.movies_table.c.collection_id==db.collections_table.c.collection_id)
-        # use outer join to volumes table to get the name of the volume
-        columns.append(db.volumes_table.c['name'])
-        volume_join = collection_join.outerjoin(db.volumes_table, \
-            db.movies_table.c.volume_id==db.volumes_table.c.volume_id)
-        # use outer join to volumes table to get the name of the volume
-        columns.append(db.vcodecs_table.c['name'])
-        vcodec_join = volume_join.outerjoin(db.vcodecs_table, \
-            db.movies_table.c.vcodec_id==db.vcodecs_table.c.vcodec_id)
-        #
-        # selecting the audio codec doesn't work with joins because if more than one codec per movie is
-        # added it would duplicate the movie in the result set as many as audio codecs are added to the movie
-        #
-        # use outer join to language and acodec table to get the name of the audio codec
-        #movie_lang_join = vcodec_join.outerjoin( \
-        #    db.movie_lang_table, \
-        #    db.movies_table.c.movie_id==db.movie_lang_table.c.movie_id)
-        #columns.append(db.acodec_table.c['name'])
-        #acodec_join = movie_lang_join.outerjoin( \
-        #    db.acodec_table, \
-        #    db.movie_lang_table.c.acodec_id==db.acodec_table.c.acodec_id)
-        
-        # sort order    TODO: more than one sort column
-        sort_columns = []
-        sorting_parts = config['sorting'].split('_')
-        if config['sorting2'] == 'ASC':
-            from sqlalchemy import asc
-            sort_columns.append(asc(db.metadata.tables[sorting_parts[0]].c['_'.join(sorting_parts[1:])]))
-        elif config['sorting2'] == 'DESC':
-            from sqlalchemy import desc
-            sort_columns.append(desc(db.metadata.tables[sorting_parts[0]].c['_'.join(sorting_parts[1:])]))
+        config = self.settings
+        # sort order TODO: update self.search_conditions["sort_by"]
+        tmp = config['sorting'].split('_')
+        sort_column = "%s.%s" % (tmp[0], '_'.join(tmp[1:]))
 
-        statement = select(columns=columns, order_by=sort_columns, bind=self.db.session.bind,
-                    from_obj=[media_join, collection_join, volume_join, vcodec_join], use_labels=True)
-
-        # where clause
-        if config['seen_only'] == 1:
-            statement.append_whereclause(db.movies_table.c.seen==True)
-        elif config['seen_only'] == 2:
-            statement.append_whereclause(db.movies_table.c.seen!=True)
-        if config['loaned_only'] == 1:
-            statement.append_whereclause(db.movies_table.c.loaned==True)
-        elif config['loaned_only'] == 2:
-            statement.append_whereclause(db.movies_table.c.loaned!=True)
+        if config['sorting2'] == 'ASC':
+            sort_column += ' ASC'
+        else:
+            sort_column += ' DESC'
         
-        return statement.execute()
+        self.search_conditions["sort_by"] = (sort_column,)
+        query = self.get_query()
+
+        return query.execute()
     #}}}
 
     #==[ main function ]============================{{{
     def export_data(self, widget):
         """Main exporting function"""
 
-        config = self.config
+        config = self.settings
         fields = self.fields
         tid = config['template']
         
         # get data from widgets
-        self.config['exported_dir'] = self.widgets['fcw'].get_filename()
-        self.config['title']        = self.widgets['entry_header'].get_text().decode('utf-8')
-        self.config['sorting']      = self.names[self.widgets['combo_sortby'].get_active_text().decode('utf-8')]
+        self.settings['exported_dir'] = self.widgets['fcw'].get_filename()
+        self.settings['title']        = self.widgets['entry_header'].get_text().decode('utf-8')
+        self.settings['sorting']      = self.names[self.widgets['combo_sortby'].get_active_text().decode('utf-8')]
         if self.widgets['cb_reverse'].get_active():
-            self.config['sorting2'] = 'DESC'
+            self.settings['sorting2'] = 'DESC'
         else:
-            self.config['sorting2'] = 'ASC'
-        self.config['split_num']     = self.widgets['sb_split_num'].get_value_as_int()
-        self.config['poster_height'] = self.widgets['sb_height'].get_value_as_int()
-        self.config['poster_width']  = self.widgets['sb_width'].get_value_as_int()
+            self.settings['sorting2'] = 'ASC'
+        self.settings['split_num']     = self.widgets['sb_split_num'].get_value_as_int()
+        self.settings['poster_height'] = self.widgets['sb_height'].get_value_as_int()
+        self.settings['poster_width']  = self.widgets['sb_width'].get_value_as_int()
         if self.widgets['cb_black'].get_active():
-            self.config['poster_mode'] = 'L'
+            self.settings['poster_mode'] = 'L'
         else:
-            self.config['poster_mode'] = 'RGB'
-        self.config['poster_format'] = self.widgets['combo_format'].get_active_text()
+            self.settings['poster_mode'] = 'RGB'
+        self.settings['poster_format'] = self.widgets['combo_format'].get_active_text()
 
         # create directories
         if not config['exported_dir']:
@@ -657,9 +558,9 @@
                 gutils.warning(self, str(err))
         
         # persist config
-        if not self.persistent_config is None:
-            self.persistent_config.set('export_dir', config['exported_dir'], section='export-html')
-            self.persistent_config.save()
+        if self.config is not None:
+            self.config.set('export_dir', config['exported_dir'], section='export-html')
+            self.config.save()
 
         if fields['movies_image']:
             # import modules needed later
@@ -676,7 +577,7 @@
             
             posters_dir = os.path.join(config['exported_dir'], 'posters')
             if os.path.isdir(posters_dir):
-                if gutils.question(_("Directory %s already exists.\nDo you want to overwrite it?") % posters_dir, True, self) == gtk.RESPONSE_YES:
+                if gutils.question(_("Directory %s already exists.\nDo you want to overwrite it?") % posters_dir, True, self.widgets['window']) == gtk.RESPONSE_YES:
                     try:
                         shutil.rmtree(posters_dir)
                     except:
@@ -697,7 +598,7 @@
                 except:
                     gutils.warning(self,_("Can't copy %s!")%style_file)
                     config['custom_style'] = False
-                style = os.path.split(self.config['custom_style_file'])[1]
+                style = os.path.split(self.settings['custom_style_file'])[1]
             else:
                 config['custom_style'] = False
 
@@ -881,7 +782,7 @@
             im.save(image_file_dst, config['poster_format'])
         except:
             log.info("Can't convert %s" % image_file_src)
-        gutils.info(_("Document has been generated."), self)
+        gutils.info(_("Document has been generated."), self.widgets['window'])
         self.on_quit()
     #}}}
 

Modified: trunk/lib/plugins/export/PluginExportPDF.py
===================================================================
--- trunk/lib/plugins/export/PluginExportPDF.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/export/PluginExportPDF.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 from reportlab.pdfgen import canvas
 from reportlab.lib.pagesizes import letter, A4
 from reportlab.lib.units import mm, inch
@@ -39,37 +37,33 @@
 import string
 import sys
 from locale import getdefaultlocale
-from sqlalchemy import select
 import db
 import gutils
 import version
+from plugins.export import Base
 
-exec_location = os.path.abspath(os.path.dirname(sys.argv[0]))
+class ExportPlugin(Base):
+    name = "PDF"
+    description = _("PDF export plugin")
+    author = "Vasco Nunes"
+    email = "<vasco.m.nunes at gmail.com>"
+    version = "0.5"
+    
+    fields_to_export = ('number', 'o_title', 'title', 'director', 'genre', 'cast')
 
-plugin_name = "PDF"
-plugin_description = _("PDF export plugin")
-plugin_author = "Vasco Nunes"
-plugin_author_email = "<vasco.m.nunes at gmail.com>"
-plugin_version = "0.4"
-
-class ExportPlugin:
-    def __init__(self, database, locations, parent_window, **kwargs):
-        self.db = database
-        self.locations = locations
-        self.parent = parent_window
-        self.config = kwargs['config']
+    def initialize(self):
         self.styles = getSampleStyleSheet()
-        self.export_simple_pdf()
-        self.fontName = ""
+        self.fontName = ''
+        return True
 
-    def export_simple_pdf(self):
+    def run(self):
         """exports a simple movie list to a pdf file"""
         
         if self.config.get('font', '') != '':
-                self.fontName = 'custom_font'
-                pdfmetrics.registerFont(TTFont(self.fontName, self.config.get('font', '')))
+            self.fontName = 'custom_font'
+            pdfmetrics.registerFont(TTFont(self.fontName, self.config.get('font', '')))
         else:
-                self.fontName = "Helvetica"
+            self.fontName = "Helvetica"
 
         basedir = None
         if not self.config is None:
@@ -85,7 +79,7 @@
             overwrite = None
             pdffilename = filename[0].decode('utf-8')
             if os.path.isfile(pdffilename):
-                response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent)
+                response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent_window)
                 if response==-8:
                     overwrite = True
                 else:
@@ -104,21 +98,19 @@
                 defaultEnc = 'utf-8'
                 style = self.styles["Normal"]
                 Story = [Spacer(1,2*inch)]
-                # build the query
-                movies = select(db.movies_table.c, bind=self.db.session.bind)
-                # select sort column
+
+                # select sort column - FIXME
                 sort_column_name = self.config.get('sortby', 'number', section='mainlist')
                 sort_reverse = self.config.get('sortby_reverse', False, section='mainlist')
                 do_grouping = True
                 for i in sort_column_name.split(','):
-                    if i <> 'title' and i <> 'o_title':
+                    if i != 'title' and i != 'o_title':
                         do_grouping = False
-                    if db.movies_table.c.has_key(i):
-                        if sort_reverse:
-                            movies = movies.order_by(db.movies_table.c[i].desc())
-                        else:
-                            movies = movies.order_by(db.movies_table.c[i])
-                movies = movies.execute().fetchall()
+
+                # build the query
+                query = self.get_query()
+                movies = query.execute().fetchall()
+
                 # define some custom stylesheetfont
                 total = len(movies)
                 p = Paragraph("<font name='" + self.fontName +"' size=\"18\">" + saxutils.escape((_("List of films")).encode('utf-8')) + '</font>', self.styles["Heading1"] )
@@ -131,10 +123,10 @@
                 first_letter = '0'
                 for movie in movies:
                     number = movie.number
-                    original_title = str(movie.o_title).encode(defaultEnc)
-                    title = str(movie.title).encode(defaultEnc)
+                    original_title = movie.o_title.encode(defaultEnc)
+                    title = movie.title.encode(defaultEnc)
                     if movie.director:
-                        director = ' - ' + str(movie.director).encode(defaultEnc)
+                        director = ' - ' + movie.director.encode(defaultEnc)
                     else:
                         director = ""
                     # group by first letter
@@ -158,20 +150,20 @@
                         '</font>'
                     p = Paragraph(paragraph_text.decode(defaultEnc), self.styles['Normal'])
                     Story.append(p)
-                    if not movie.genre is None:
+                    if movie.genre is not None:
                         paragraph_text = '<font name=' + self.fontName + ' size="5">' + \
-                        '<b>' + _('Genre') + ': </b>' + saxutils.escape(str(movie.genre).encode(defaultEnc)) + \
+                        '<b>' + _('Genre') + ': </b>' + saxutils.escape(movie.genre.encode(defaultEnc)) + \
                         '</font>'
                         p = Paragraph(paragraph_text.decode(defaultEnc), self.styles['Normal'])
                         Story.append(p)
-                    if not movie.cast is None:
+                    if movie.cast is not None:
                         paragraph_text = '<i><font name=' + self.fontName + ' size="5">' + \
-                        '<b>' + _('Cast') + ': </b>' + saxutils.escape('; '.join(str(movie.cast).encode(defaultEnc).split("\n")[0:2])) + \
+                        '<b>' + _('Cast') + ': </b>' + saxutils.escape('; '.join(movie.cast.encode(defaultEnc).split("\n")[0:2])) + \
                             '</font></i>'
                         p = Paragraph(paragraph_text.decode(defaultEnc), self.styles['Normal'])
                         Story.append(p)
                 c.build(Story, onFirstPage=self.page_template, onLaterPages=self.page_template)
-                gutils.info(_('PDF has been created.'), self.parent)
+                gutils.info(_('PDF has been created.'), self.parent_window)
             
     def page_template(self, canvas, doc):
         canvas.saveState()

Modified: trunk/lib/plugins/export/PluginExportXML.py
===================================================================
--- trunk/lib/plugins/export/PluginExportXML.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/export/PluginExportXML.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -25,69 +25,65 @@
 import xml.dom.ext
 import gtk
 import os
-import gettext
-gettext.install('griffith', unicode=1)
 import db
 import gutils
+from plugins.export import Base
 
-plugin_name = "XML"
-plugin_description = _("Full XML list export plugin")
-plugin_author = "Vasco Nunes"
-plugin_author_email = "<vasco.m.nunes at gmail.com>"
-plugin_version = "0.1"
+class ExportPlugin(Base):
+    name = "XML"
+    description = _("Full XML list export plugin")
+    author = "Vasco Nunes"
+    email = "<vasco.m.nunes at gmail.com>"
+    version = "0.1"
 
-class ExportPlugin:
+    fields_to_export = ('number', 'o_title', 'title', 'director', 'year', 'classification', 'country',
+                        'genre', 'rating', 'runtime', 'studio', 'seen', 'loaned', 'o_site', 'site', 'trailer',
+                        'plot', 'cast', 'notes', 'image', 'volumes.name', 'collections.name', 'media.name')
 
-    def __init__(self, database, locations, parent_window, **kwargs):
-        self.db = database
-        self.locations = locations
-        self.parent = parent_window
-        if kwargs.has_key('config'):
-            self.persistent_config = kwargs['config']
-        else:
-            self.persistent_config = None
-        self.export_xml()
-
-    def export_xml(self):
+    def run(self):
         basedir = None
-        if not self.persistent_config is None:
-            basedir = self.persistent_config.get('export_dir', None, section='export-xml')
+        if self.config is not None:
+            basedir = self.config.get('export_dir', None, section='export-xml')
         if basedir is None:
             filename = gutils.file_chooser(_("Export a %s document")%"XML", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
                 buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.xml')
         else:
             filename = gutils.file_chooser(_("Export a %s document")%"XML", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
                 buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.xml',folder=basedir)
-        if filename[0]:
-            if not self.persistent_config is None and filename[1]:
-                self.persistent_config.set('export_dir', filename[1], section='export-xml')
-                self.persistent_config.save()
+        if filename and filename[0]:
+            if self.config is not None and filename[1]:
+                self.config.set('export_dir', filename[1], section='export-xml')
+                self.config.save()
             overwrite = None
             if os.path.isfile(filename[0]):
-                response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent)
+                response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent_window)
                 if response==-8:
                     overwrite = True
                 else:
                     overwrite = False
                     
-            if overwrite == True or overwrite is None:
+            if overwrite or overwrite is None:
                 # create document
                 impl = xml.dom.minidom.getDOMImplementation()
                 doc  = impl.createDocument(None, "root", None)
                 root = doc.documentElement
                 
+                movies = self.get_query().execute().fetchall()
                 # create object
-                for movie in self.db.session.query(db.Movie).all():
+                for movie in movies:
                     e = doc.createElement('movie')
                     root.appendChild(e)
-                    for key in db.movies_table.c.keys():
-                        e2 = doc.createElement(key)
+                    for key in self.exported_columns:
+                        e2 = doc.createElement(str(key).replace('movies_', ''))
                         if movie[key] is None:
                             value = ''
                         elif movie[key] in (True, False):
                             value = str(int(movie[key]))
                         else:
-                            value = str(movie[key])
+                            if movie[key] is unicode:
+                                value = movie[key].encode('utf-8')
+                            else:
+                                value = str(movie[key])
                         t = doc.createTextNode(value)
                         e2.appendChild(t)
                         e.appendChild(e2)
@@ -96,4 +92,5 @@
                 fp = open(filename[0], "w")
                 xml.dom.ext.PrettyPrint(doc, fp)
                 fp.close()
-                gutils.info( _("%s file has been created.")%"XML", self.parent)
+                gutils.info( _("%s file has been created.")%"XML", self.parent_window)
+

Modified: trunk/lib/plugins/export/PluginExportiPod.py
===================================================================
--- trunk/lib/plugins/export/PluginExportiPod.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/export/PluginExportiPod.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -30,19 +30,12 @@
 import platform
 import shutil
 from tempfile import mkdtemp
-import gettext
-gettext.install('griffith', unicode=1)
 import db
+from plugins.export import Base
 
-plugin_name = "iPod"
-plugin_description = _("iPod Notes export plugin")
-plugin_author = "Vasco Nunes"
-plugin_author_email = "<vasco.m.nunes at gmail.com>"
-plugin_version = "0.1"
-
 # TODO: bypass the 4Kb file limit on the iPod notes folder, splitting the file in multiple ones and linking them.
 
-class Path2iPod:
+class Path2iPod(object):
 
   def __init__(self):
     self.thing_to_find="iPod_Control"
@@ -65,29 +58,28 @@
     else:
       return self.path_to_pod
 
-class ExportPlugin:
+class ExportPlugin(Base):
+    name = "iPod"
+    description = _("iPod Notes export plugin")
+    author = "Vasco Nunes"
+    email = "<vasco.m.nunes at gmail.com>"
+    version = "0.2"
 
-    def __init__(self, database, locations, parent_window, **kwargs):
-        self.db = database
-        self.locations = locations
-        self.parent = parent_window
-        self.export_iPod()
+    fields_to_export = ('number', 'o_title', 'title', 'director' )
 
-    def split_file(self, filename):
-        pass
-
-    def export_iPod(self):
+    def run(self):
         tmp_dir = mkdtemp()
         griffith_list = open(os.path.join(tmp_dir,"movies"),"w")
         t = []
-        
-        for movie in self.db.session.query(db.Movie).all():
-            t.append("%s | %s | %s | %s"%(movie['number'],movie['o_title'],movie['title'],movie['director']))
+       
+        movies = self.get_query().execute().fetchall()
+        for movie in movies:
+            t.append("%s | %s | %s | %s" % (movie['number'], movie['o_title'].encode('utf-8'), movie['title'].encode('utf-8'), movie['director'].encode('utf-8')))
     
-        griffith_list.write("<title>%s</title><br><br>"%_("My Movies List"))
+        griffith_list.write("<title>%s</title><br><br>" % _("My Movies List"))
         
         for movie in t:
-            griffith_list.write(str(movie))
+            griffith_list.write(movie)
             griffith_list.write("<br>")
             
         griffith_list.close()
@@ -99,22 +91,22 @@
             thisPath=thisPod.returnPath()
         
             if thisPath:
-                commands.getoutput('mv '+os.path.join(tmp_dir,"movies")+' "'+thisPath+'/Notes/"')
-                gutils.info(_("List was successful exported to iPod."), self.parent)        
+                commands.getoutput('mv '+os.path.join(tmp_dir,"movies")+' "'+thisPath+'/Notes/"') # FIXME: WTF?
+                gutils.info(_("List was successful exported to iPod."), self.parent_window)
             else:
-                gutils.info(_("iPod is not connected."), self.parent)
+                gutils.info(_("iPod is not connected."), self.parent_window)
         # this is not a mac, lets save the file
         else:
             filename = gutils.file_chooser(_("Export a %s document")%"CSV", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
                 buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='ipod_griffith_list')
-            if filename[0]:
+            if filename and filename[0]:
                 overwrite = None
                 if os.path.isfile(filename[0]):
-                    response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent)
+                    response = gutils.question(_("File exists. Do you want to overwrite it?"), True, self.parent_window)
                     if response==-8:
                         overwrite = True
                     else:
                         overwrite = False
                 if overwrite == True or overwrite is None:
                     shutil.copyfile(os.path.join(tmp_dir,"movies"), filename[0])
-                    gutils.info(_("List was successful exported. Now you should move it to the 'Notes' folder on your iPod."), self.parent)
+                    gutils.info(_("List was successful exported. Now you should move it to the 'Notes' folder on your iPod."), self.parent_window)

Modified: trunk/lib/plugins/export/__init__.py
===================================================================
--- trunk/lib/plugins/export/__init__.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/export/__init__.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -0,0 +1,109 @@
+# -*- coding: UTF-8 -*-
+
+__revision__ = '$Id$'
+
+# Copyright (c) 2008 Piotr O?arowski
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published byp
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
+
+# You may use and distribute this software under the terms of the
+# GNU General Public License, version 2 or later
+
+import glob
+import os.path
+
+import logging
+log = logging.getLogger("Griffith.%s" % __name__)
+
+from sqlalchemy import select, outerjoin
+import db
+from sql import update_whereclause
+
+# detect all plugins:
+__all__ = [os.path.basename(x)[:-3] for x in glob.glob("%s/PluginExport*.py" % os.path.dirname(__file__))]
+
+class Base(object):
+    description = None
+    author = None
+    email = None
+    version = None
+    fields_to_export = ('number', 'o_title', 'title', 'director', 'year')
+
+    def __init__(self, database, locations, parent_window, search_conditions, config, **kwargs): #{{{
+        self.db = database
+        self.locations = locations
+        self.parent_window = parent_window
+        self.search_conditions = search_conditions
+
+        self.config = config
+        self.search_conditions = search_conditions
+    #}}}
+    
+    def initialize(self):
+        """Initializes plugin (get all parameters from user, etc.)"""
+        return True
+
+    def cleanup(self):
+        pass
+
+    def run(self):
+        raise NotImplemented
+    
+    def get_query(self):
+        tables = set()
+        columns = []
+
+        for i in self.fields_to_export:
+            table = 'movies'
+            column = i.split('.')
+            if len(column) > 1:
+                table = column[0]
+                column = column[1]
+                if table not in db.tables:
+                    log.warning("Wrong table name: %s", table)
+                    continue
+                tables.add(table) # will be used to generate JOIN
+            else:
+                column = column[0]
+
+            if column in db.tables[table].columns:
+                columns.append(db.tables[table].columns[column])
+            else:
+                log.warning("Wrong field name: %s", i)
+
+        joins = []
+        if 'media' in tables:
+            joins.append((db.tables['media'], db.tables['movies'].c.medium_id==db.tables['media'].c.medium_id))
+        if 'collections' in tables:
+            joins.append((db.tables['collections'], db.tables['movies'].c.collection_id==db.tables['collections'].c.collection_id))
+        if 'volumes' in tables:
+            joins.append((db.tables['volumes'], db.tables['movies'].c.volume_id==db.tables['volumes'].c.volume_id))
+        if 'vcodecs' in tables:
+            joins.append((db.tables['vcodecs'], db.tables['movies'].c.vcodec_id==db.tables['vcodecs'].c.vcodec_id))
+
+        if joins:
+            from_obj = [ outerjoin(db.tables['movies'], *(joins[0])) ]
+            for j in joins[1:]:
+                from_obj.append(outerjoin(from_obj[-1], *j))
+            query = select(columns=columns, bind=self.db.session.bind, from_obj=from_obj, use_labels=True)
+        else:
+            query = select(columns=columns, bind=self.db.session.bind)
+
+        query = update_whereclause(query, self.search_conditions)
+
+        # save column names (will contain 'movies_title' or 'title' depending on how many tables were requested)
+        self.exported_columns = query.columns
+
+        return query

Modified: trunk/lib/plugins/imp/CSV.py
===================================================================
--- trunk/lib/plugins/imp/CSV.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/imp/CSV.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -10,8 +10,6 @@
 #
 ###########################################################################
 
-import gettext
-gettext.install('griffith', unicode=1)
 from plugins.imp import ImportPlugin as IP
 import gtk
 import gtk.glade

Modified: trunk/lib/plugins/imp/__init__.py
===================================================================
--- trunk/lib/plugins/imp/__init__.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/imp/__init__.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,18 +21,16 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-# detect all plugins:
 import glob
 import os.path
 import time
 import gc
-import gettext
-gettext.install('griffith', unicode=1)
 import logging
 log = logging.getLogger("Griffith")
 
 import db
 
+# detect all plugins:
 __all__ = [os.path.basename(x)[:-3] for x in glob.glob("%s/*.py" % os.path.dirname(__file__))]
 __all__.remove('__init__')
 
@@ -116,7 +114,7 @@
         # get some values from DB to avoid queries in the loop
         statement = select([db.Movie.number, db.Movie.title, db.Movie.o_title])
         data = session.execute(statement).fetchall()
-        numbers = set([i[0] for i in data])
+        numbers = set(i[0] for i in data)
         titles = set(i[1].lower() for i in data)
         o_titles = set(i[2].lower() for i in data)
 

Modified: trunk/lib/plugins/movie/PluginMovie7arte.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovie7arte.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovie7arte.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieAllocine.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAllocine.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieAllocine.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieAniDB.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAniDB.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieAniDB.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 from gutils import decompress

Modified: trunk/lib/plugins/movie/PluginMovieCSFD.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCSFD.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieCSFD.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -19,8 +19,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 import re

Modified: trunk/lib/plugins/movie/PluginMovieCineMovies.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieCineMovies.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: trunk/lib/plugins/movie/PluginMovieCinematografo.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieCinematografo.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie, string
 
 plugin_name = "Cinematografo"

Modified: trunk/lib/plugins/movie/PluginMovieCineteka.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCineteka.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieCineteka.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieCulturalia.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieCulturalia.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieDVDEmpire.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieDVDEmpire.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import re

Modified: trunk/lib/plugins/movie/PluginMovieDVDPalace.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieDVDPalace.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieE-Pipoca.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieE-Pipoca.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -25,8 +25,6 @@
 # joe1310 at terra.com.br - S?o Paulo/Brasil
 
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie, string
 
 plugin_name = "E-Pipoca"

Modified: trunk/lib/plugins/movie/PluginMovieFDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFDb.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieFDb.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieFilmDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieFilmDb.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,9 +21,7 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
-import gutils
+mport gutils
 import movie
 import string
 import re

Modified: trunk/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieFilmweb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import re,string
 

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-es.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-es.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieIMDB.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: trunk/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieMediadis.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieMediadis.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieMediadis.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -6,8 +6,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: trunk/lib/plugins/movie/PluginMovieMoviefone.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieMoviefone.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -6,8 +6,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: trunk/lib/plugins/movie/PluginMovieOFDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieOFDb.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieOFDb.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -7,8 +7,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string,re
 

Modified: trunk/lib/plugins/movie/PluginMovieOnet.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieOnet.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieOnet.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: trunk/lib/plugins/movie/PluginMoviePTGate.py
===================================================================
--- trunk/lib/plugins/movie/PluginMoviePTGate.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMoviePTGate.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/plugins/movie/PluginMovieStopklatka.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils, movie
 import string, re
 

Modified: trunk/lib/plugins/movie/PluginMovieTanukiAnime.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieTanukiAnime.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 

Modified: trunk/lib/plugins/movie/PluginMovieWP.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieWP.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieWP.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie,string
 import re

Modified: trunk/lib/plugins/movie/PluginMovieZelluloid.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import movie
 import string

Modified: trunk/lib/preferences.py
===================================================================
--- trunk/lib/preferences.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/preferences.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import os
 import socket
 import logging

Modified: trunk/lib/quick_filter.py
===================================================================
--- trunk/lib/quick_filter.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/quick_filter.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import db
 

Modified: trunk/lib/sql.py
===================================================================
--- trunk/lib/sql.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/sql.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -29,8 +29,6 @@
 from sqlalchemy.orm        import sessionmaker
 from sqlalchemy.exceptions import OperationalError
 import os.path
-import gettext
-gettext.install('griffith', unicode=1)
 import logging
 log = logging.getLogger("Griffith")
 import gutils # TODO: get rid of this import
@@ -251,14 +249,21 @@
     for rule in cond["sort_by"]:
         if rule.endswith(" DESC"):
             reverse = True
-            rule = rule.replace(" DESC", '')
+            column = rule.replace(" DESC", '')
         else:
+            column = rule.replace(" ASC", '') # note that " ASC" is optional
             reverse = False
 
+        table = 'movies'
+        tmp = column.split('.')
+        if len(tmp) > 1:
+            table = tmp[0]
+            column = tmp[1]
+
         if reverse:
-            query.append_order_by(desc(db.movies_table.columns[rule]))
+            query.append_order_by(desc(db.tables[table].columns[column]))
         else:
-            query.append_order_by(asc(db.movies_table.columns[rule]))
+            query.append_order_by(asc(db.tables[table].columns[column]))
 
     log.debug(query.compile())
     return query #}}}

Modified: trunk/lib/update.py
===================================================================
--- trunk/lib/update.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/update.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gutils
 import os
 import db

Modified: trunk/lib/version.py
===================================================================
--- trunk/lib/version.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/version.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 pname        = "Griffith"
 pversion     = "0.10~svn"
 pauthor      = "Vasco Nunes, Piotr O?arowski <griffith-private at lists.berlios.de>"

Modified: trunk/lib/view.py
===================================================================
--- trunk/lib/view.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/view.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,9 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
-
 # TODO: rewrite it using advfilter (see get_def_conditions)
 
 def filter_not_seen(self):

Modified: trunk/lib/widgets.py
===================================================================
--- trunk/lib/widgets.py	2008-11-15 21:13:49 UTC (rev 1040)
+++ trunk/lib/widgets.py	2008-11-15 21:39:47 UTC (rev 1041)
@@ -21,8 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-import gettext
-gettext.install('griffith', unicode=1)
 import gtk
 import sys
 import advfilter



From mikej06 at mail.berlios.de  Sat Nov 15 23:00:14 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 15 Nov 2008 23:00:14 +0100
Subject: [Griffith-svn] r1042 - branches/0.9.x/lib
	branches/0.9.x/lib/plugins/movie trunk/lib
Message-ID: <200811152200.mAFM0EWc000471@sheep.berlios.de>

Author: mikej06
Date: 2008-11-15 22:59:58 +0100 (Sat, 15 Nov 2008)
New Revision: 1042

Modified:
   branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
   branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
   branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
   branches/0.9.x/lib/test_movieplugins.py
   trunk/lib/test_movieplugins.py
Log:
minor fixes because of gettext changes

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-15 21:39:47 UTC (rev 1041)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieIMDB-de.py	2008-11-15 21:59:58 UTC (rev 1042)
@@ -108,8 +108,8 @@
 		self.cast = gutils.trim(self.cast_page, '<table class="cast">', '</table>')
 		if self.cast == '':
 			self.cast = gutils.trim(self.page, '<table class="cast">', '</table>')
-		self.cast = string.replace(self.cast, ' ... ', _(' as '))
-		self.cast = string.replace(self.cast, '...', _(' as '))
+		self.cast = string.replace(self.cast, ' ... ', _(' as ').encode('utf8'))
+		self.cast = string.replace(self.cast, '...', _(' as ').encode('utf8'))
 		self.cast = string.replace(self.cast, '</tr><tr>', "\n")
 		self.cast = string.replace(self.cast, '</tr><tr class="even">', "\n")
 		self.cast = string.replace(self.cast, '</tr><tr class="odd">', "\n")
@@ -178,11 +178,11 @@
 		tagline = re.sub('[ ]+', ' ', tagline)
 		tagline = tagline.rstrip()
 		if len(language)>0:
-			self.notes = "%s: %s\n" %(_('Language'), language)
+			self.notes = "%s: %s\n" %(_('Language').encode('utf8'), language)
 		if len(sound)>0:
-			self.notes += "%s: %s\n" %(gutils.strip_tags(_('<b>Audio</b>')), sound)
+			self.notes += "%s: %s\n" %(gutils.strip_tags(_('<b>Audio</b>').encode('utf8')), sound)
 		if len(color)>0:
-			self.notes += "%s: %s\n" %(_('Color'), color)
+			self.notes += "%s: %s\n" %(_('Color').encode('utf8'), color)
 		if len(tagline)>0:
 			self.notes += "%s: %s\n" %('Tagline', tagline)
 	
@@ -211,7 +211,7 @@
 
 	def __init__(self):
 		self.original_url_search	= 'http://german.imdb.com/find?more=tt&q='
-		self.translated_url_search	= 'http://german.imdb.com/List?words='
+		self.translated_url_search	= 'http://german.imdb.com/find?more=tt&q='
 		self.encode = 'iso8859-1'
 		self.remove_accents = False
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-15 21:39:47 UTC (rev 1041)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieKinoDe.py	2008-11-15 21:59:58 UTC (rev 1042)
@@ -154,7 +154,7 @@
 						self.cast += elements2[1] + "\n"
 				else:
 					self.cast += element + "\n"
-			self.cast = string.replace(self.cast, '--flip--', _(' as '))
+			self.cast = string.replace(self.cast, '--flip--', _(' as ').encode('utf8'))
 
 	def get_classification(self):
 		self.classification = self.regextrim(self.tmp_page,'FSK:( |&nbsp;)+', '</strong>')

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-15 21:39:47 UTC (rev 1041)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieZelluloid.py	2008-11-15 21:59:58 UTC (rev 1042)
@@ -100,7 +100,7 @@
 				self.cast += elements2[1] + '--flip--' + elements2[0] + '\n'
 			else:
 				self.cast += element + '\n'
-		self.cast = string.replace(self.cast, '--flip--', _(' as '))
+		self.cast = string.replace(self.cast, '--flip--', _(' as ').encode('utf8'))
 
 	def get_classification(self):
 		self.classification = gutils.trim(self.detail_page, 'FSK: ', '</TD>')

Modified: branches/0.9.x/lib/test_movieplugins.py
===================================================================
--- branches/0.9.x/lib/test_movieplugins.py	2008-11-15 21:39:47 UTC (rev 1041)
+++ branches/0.9.x/lib/test_movieplugins.py	2008-11-15 21:59:58 UTC (rev 1042)
@@ -40,6 +40,7 @@
 #        * or the expected value
 #
 
+import gettext
 import sys
 import initialize
 import gdebug
@@ -244,6 +245,7 @@
 		self._tmp_home = None
 		self._tmp_config = 'griffith.cfg'
 		initialize.locations(self)
+		gettext.install('griffith', self.locations['i18n'], unicode=1)
 		configFileName = os.path.join(self.locations['home'], self._tmp_config)
 		myconfig = self.config = config.Config(file=configFileName)
 		search_successful = ''

Modified: trunk/lib/test_movieplugins.py
===================================================================
--- trunk/lib/test_movieplugins.py	2008-11-15 21:39:47 UTC (rev 1041)
+++ trunk/lib/test_movieplugins.py	2008-11-15 21:59:58 UTC (rev 1042)
@@ -40,6 +40,7 @@
 #        * or the expected value
 #
 
+import gettext
 import sys
 import initialize
 import gutils
@@ -239,6 +240,7 @@
         self._tmp_home = None
         self._tmp_config = 'griffith.cfg'
         initialize.locations(self)
+        gettext.install('griffith', self.locations['i18n'], unicode=1)
         configFileName = os.path.join(self.locations['home'], self._tmp_config)
         myconfig = self.config = config.Config(file=configFileName)
         search_successful = ''



From piotrek at mail.berlios.de  Sat Nov 15 23:01:11 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sat, 15 Nov 2008 23:01:11 +0100
Subject: [Griffith-svn] r1043 - in trunk/lib: . plugins/export
Message-ID: <200811152201.mAFM1BrM000580@sheep.berlios.de>

Author: piotrek
Date: 2008-11-15 23:01:10 +0100 (Sat, 15 Nov 2008)
New Revision: 1043

Modified:
   trunk/lib/advfilter.py
   trunk/lib/plugins/export/PluginExportCSV.py
   trunk/lib/plugins/export/__init__.py
Log:
cosmetics


Modified: trunk/lib/advfilter.py
===================================================================
--- trunk/lib/advfilter.py	2008-11-15 21:59:58 UTC (rev 1042)
+++ trunk/lib/advfilter.py	2008-11-15 22:01:10 UTC (rev 1043)
@@ -42,7 +42,7 @@
     'required_tags'   : set(), # like in tags, but movie must contain all listed tags
     'loaned_to'       : set(), # list of person_ids     (search for movies loaned to these people)
     'loan_history'    : set(), # list of person_ids     (search for movies which were loaned by these people)
-    'sort_by'         : ("number",), # "number DESC"
+    'sort_by'         : set(("number",)), # "number DESC"
     'equals'          : {}, # {column1: set(value1, value2), column2: set(value3)}
     'equals_n'        : {}, # see above
     'startswith'      : {}, # see above

Modified: trunk/lib/plugins/export/PluginExportCSV.py
===================================================================
--- trunk/lib/plugins/export/PluginExportCSV.py	2008-11-15 21:59:58 UTC (rev 1042)
+++ trunk/lib/plugins/export/PluginExportCSV.py	2008-11-15 22:01:10 UTC (rev 1043)
@@ -41,16 +41,16 @@
 
     def run(self):
         basedir = None
-        if not self.config is None:
+        if self.config is not None:
             basedir = self.config.get('export_dir', None, section='export-csv')
         if not basedir:
             filename = gutils.file_chooser(_("Export a %s document")%"CSV", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
-                buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.csv')
+                buttons=(gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, gtk.STOCK_SAVE, gtk.RESPONSE_OK), name='griffith_list.csv')
         else:
             filename = gutils.file_chooser(_("Export a %s document")%"CSV", action=gtk.FILE_CHOOSER_ACTION_SAVE, \
-                buttons=(gtk.STOCK_CANCEL,gtk.RESPONSE_CANCEL,gtk.STOCK_SAVE,gtk.RESPONSE_OK),name='griffith_list.csv',folder=basedir)
+                buttons=(gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL, gtk.STOCK_SAVE,gtk.RESPONSE_OK), name='griffith_list.csv', folder=basedir)
         if filename and filename[0]:
-            if not self.config is None and filename[1]:
+            if self.config is not None and filename[1]:
                 self.config.set('export_dir', filename[1], section='export-csv')
                 self.config.save()
             overwrite = None
@@ -61,7 +61,7 @@
                 else:
                     overwrite = False
             
-            if overwrite == True or overwrite is None:
+            if overwrite: or overwrite is None:
                 movies = self.get_query().execute()
 
                 writer = csv.writer(file(filename[0], 'w'), dialect=csv.excel)

Modified: trunk/lib/plugins/export/__init__.py
===================================================================
--- trunk/lib/plugins/export/__init__.py	2008-11-15 21:59:58 UTC (rev 1042)
+++ trunk/lib/plugins/export/__init__.py	2008-11-15 22:01:10 UTC (rev 1043)
@@ -41,15 +41,12 @@
     version = None
     fields_to_export = ('number', 'o_title', 'title', 'director', 'year')
 
-    def __init__(self, database, locations, parent_window, search_conditions, config, **kwargs): #{{{
+    def __init__(self, database, locations, parent_window, search_conditions, config):
         self.db = database
+        self.config = config
         self.locations = locations
         self.parent_window = parent_window
         self.search_conditions = search_conditions
-
-        self.config = config
-        self.search_conditions = search_conditions
-    #}}}
     
     def initialize(self):
         """Initializes plugin (get all parameters from user, etc.)"""



From piotrek at mail.berlios.de  Sat Nov 15 23:06:56 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sat, 15 Nov 2008 23:06:56 +0100
Subject: [Griffith-svn] r1044 - trunk/lib/plugins/export
Message-ID: <200811152206.mAFM6urd000926@sheep.berlios.de>

Author: piotrek
Date: 2008-11-15 23:06:56 +0100 (Sat, 15 Nov 2008)
New Revision: 1044

Modified:
   trunk/lib/plugins/export/PluginExportCSV.py
Log:
typo


Modified: trunk/lib/plugins/export/PluginExportCSV.py
===================================================================
--- trunk/lib/plugins/export/PluginExportCSV.py	2008-11-15 22:01:10 UTC (rev 1043)
+++ trunk/lib/plugins/export/PluginExportCSV.py	2008-11-15 22:06:56 UTC (rev 1044)
@@ -61,7 +61,7 @@
                 else:
                     overwrite = False
             
-            if overwrite: or overwrite is None:
+            if overwrite or overwrite is None:
                 movies = self.get_query().execute()
 
                 writer = csv.writer(file(filename[0], 'w'), dialect=csv.excel)



From piotrek at mail.berlios.de  Sun Nov 16 00:46:53 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 00:46:53 +0100
Subject: [Griffith-svn] r1045 - in trunk: . glade lib
Message-ID: <200811152346.mAFNkrPO030565@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 00:46:51 +0100 (Sun, 16 Nov 2008)
New Revision: 1045

Removed:
   trunk/lib/update.py
Modified:
   trunk/ChangeLog
   trunk/glade/griffith.glade
   trunk/griffith
   trunk/lib/advfilter.py
   trunk/lib/edit.py
   trunk/lib/initialize.py
   trunk/lib/main_treeview.py
   trunk/lib/quick_filter.py
   trunk/lib/widgets.py
Log:
Replace "by ..." quick filter combo boxes with saved search conditions


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/ChangeLog	2008-11-15 23:46:51 UTC (rev 1045)
@@ -7,6 +7,7 @@
 
 2008-11-15  Piotr O?arowski
 	* Export plugins are now exporting movies listed in main window
+	* Replace "by ..." quick filter combo boxes with saved search conditions
 
 2008-11-13  Piotr O?arowski
 	* update translations

Modified: trunk/glade/griffith.glade
===================================================================
--- trunk/glade/griffith.glade	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/glade/griffith.glade	2008-11-15 23:46:51 UTC (rev 1045)
@@ -751,7 +751,7 @@
                   <widget class="GtkLabel" id="label291">
                     <property name="visible">True</property>
                     <property name="xpad">6</property>
-                    <property name="label" translatable="yes">By Volume</property>
+                    <property name="label">saved</property>
                   </widget>
                 </child>
               </widget>
@@ -764,10 +764,10 @@
               <widget class="GtkToolItem" id="toolitem15">
                 <property name="visible">True</property>
                 <child>
-                  <widget class="GtkComboBox" id="f_volume">
+                  <widget class="GtkComboBox" id="f_advfilter">
                     <property name="visible">True</property>
                     <property name="items" translatable="yes"></property>
-                    <signal name="changed" handler="on_f_volume_changed"/>
+                    <signal name="changed" handler="on_f_advfilter_changed"/>
                   </widget>
                 </child>
               </widget>
@@ -776,82 +776,6 @@
                 <property name="homogeneous">False</property>
               </packing>
             </child>
-            <child>
-              <widget class="GtkToolItem" id="toolitem16">
-                <property name="visible">True</property>
-                <child>
-                  <widget class="GtkLabel" id="label292">
-                    <property name="visible">True</property>
-                    <property name="xpad">6</property>
-                    <property name="label" translatable="yes">Loaned to</property>
-                  </widget>
-                </child>
-              </widget>
-              <packing>
-                <property name="expand">False</property>
-                <property name="homogeneous">False</property>
-              </packing>
-            </child>
-            <child>
-              <widget class="GtkToolItem" id="toolitem17">
-                <property name="visible">True</property>
-                <child>
-                  <widget class="GtkComboBox" id="f_loanedto">
-                    <property name="visible">True</property>
-                    <property name="items" translatable="yes"></property>
-                    <signal name="changed" handler="on_f_loanedto_changed"/>
-                  </widget>
-                </child>
-              </widget>
-              <packing>
-                <property name="expand">False</property>
-                <property name="homogeneous">False</property>
-              </packing>
-            </child>
-            <child>
-              <widget class="GtkToolItem" id="toolitem18">
-                <property name="visible">True</property>
-                <child>
-                  <widget class="GtkLabel" id="label293">
-                    <property name="visible">True</property>
-                    <property name="xpad">6</property>
-                    <property name="label" translatable="yes">By Tag</property>
-                  </widget>
-                </child>
-              </widget>
-              <packing>
-                <property name="expand">False</property>
-                <property name="homogeneous">False</property>
-              </packing>
-            </child>
-            <child>
-              <widget class="GtkToolItem" id="toolitem19">
-                <property name="visible">True</property>
-                <child>
-                  <widget class="GtkComboBox" id="f_bytag">
-                    <property name="visible">True</property>
-                    <property name="items" translatable="yes"></property>
-                    <signal name="changed" handler="on_f_bytag_changed"/>
-                  </widget>
-                </child>
-              </widget>
-              <packing>
-                <property name="expand">False</property>
-                <property name="homogeneous">False</property>
-              </packing>
-            </child>
-            <child>
-              <widget class="GtkToolItem" id="toolitem13">
-                <property name="visible">True</property>
-                <child>
-                  <placeholder/>
-                </child>
-              </widget>
-              <packing>
-                <property name="expand">False</property>
-                <property name="homogeneous">False</property>
-              </packing>
-            </child>
           </widget>
           <packing>
             <property name="expand">False</property>
@@ -2773,12 +2697,6 @@
                             <property name="column_spacing">8</property>
                             <property name="row_spacing">8</property>
                             <child>
-                              <placeholder/>
-                            </child>
-                            <child>
-                              <placeholder/>
-                            </child>
-                            <child>
                               <widget class="GtkCheckButton" id="view_image">
                                 <property name="visible">True</property>
                                 <property name="can_focus">True</property>

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/griffith	2008-11-15 23:46:51 UTC (rev 1045)
@@ -67,7 +67,6 @@
 import initialize
 import main_treeview
 import quick_filter
-import update
 import version
 
 class Griffith(object):
@@ -425,7 +424,7 @@
             session.rollback()
             log.warn("Cannot add volume: %s", e.message)
         else:
-            update.update_volume_combo_ids(self)
+            initialize.update_volume_combo_ids(self)
             initialize.fill_volumes_combo(self, id)
 
     def add_collection(self, widget):
@@ -439,7 +438,7 @@
             session.rollback()
             log.warn("Cannot add collection: %s", e.message)
         else:
-            update.update_collection_combo_ids(self)
+            initialize.update_collection_combo_ids(self)
             initialize.fill_collections_combo(self, id)
 
     def remove_volume(self, widget):
@@ -454,7 +453,7 @@
                 session.rollback()
                 log.warn("Cannot remove volume: %s", e.message)
             else:
-                update.update_volume_combo_ids(self)
+                initialize.update_volume_combo_ids(self)
                 initialize.fill_volumes_combo(self, id)
 
     def remove_collection(self, widget):
@@ -469,7 +468,7 @@
                 session.rollback()
                 log.warn("Cannot remove collection: %s", e.message)
             else:
-                update.update_collection_combo_ids(self)
+                initialize.update_collection_combo_ids(self)
                 initialize.fill_collections_combo(self, id)
 
     def rename_volume(self, widget):
@@ -661,8 +660,6 @@
         else:
             initialize.fill_preferences_tags_combo(self)
             initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
-            update.update_bytag_combo_ids(self)
-            initialize.fill_bytag_combo(self)
 
     def on_tag_remove_clicked(self, widget):
         session = self.db.Session()
@@ -679,8 +676,6 @@
                     log.warn("Cannot remove tag: %s", e.message)
                 initialize.fill_preferences_tags_combo(self)
                 initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
-                update.update_bytag_combo_ids(self)
-                initialize.fill_bytag_combo(self)
             else:
                 gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
         else:
@@ -704,8 +699,6 @@
             else:
                 initialize.fill_preferences_tags_combo(self)
                 initialize.create_tag_vbox(self, widget=self.widgets['add']['tag_vbox'], tab=self.am_tags)
-                update.update_bytag_combo_ids(self)
-                initialize.fill_bytag_combo(self)
 
     def on_tag_name_combo_changed(self, widget):
         active = self.widgets['preferences']['tag_name'].get_active()
@@ -1192,15 +1185,9 @@
     def filter_collection(self, *args):
         quick_filter.change_filter(self)
 
-    def filter_volume(self, *args):
+    def filter_using_advfilter_rule(self, *args):
         quick_filter.change_filter(self)
 
-    def filter_loanedto(self, *args):
-        quick_filter.change_filter(self)
-
-    def filter_bytag(self, *args):
-        quick_filter.change_filter(self)
-
     # windows/dialogs -----------------------------------------------------
 
     def results_cancel_ck(self, *args):
@@ -1208,7 +1195,7 @@
         reconnect_add_signals(self)
         self.widgets['results']['window'].hide()
 
-    def save_state(self): 
+    def save_state(self):
         """Saves main window state"""
         # size should only be saved on microsoft windows systems
         # on other systems the window manager should manage the windows

Modified: trunk/lib/advfilter.py
===================================================================
--- trunk/lib/advfilter.py	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/lib/advfilter.py	2008-11-15 23:46:51 UTC (rev 1045)
@@ -99,6 +99,9 @@
         i.destroy()
     for i in widgets['dynamic_vbox'].get_children():
         i.destroy()
+    
+    from initialize import fill_advfilter_combo
+    fill_advfilter_combo(self)
 
     return True
 

Modified: trunk/lib/edit.py
===================================================================
--- trunk/lib/edit.py	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/lib/edit.py	2008-11-15 23:46:51 UTC (rev 1045)
@@ -34,7 +34,6 @@
 import delete
 import gutils
 import movie
-import update
 
 def change_poster(self):
     """

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/lib/initialize.py	2008-11-15 23:46:51 UTC (rev 1045)
@@ -580,16 +580,12 @@
 
 def dictionaries(self):
     """initializes data filled dynamically by users"""
-    import update
     self.am_tags = {} # dictionary for tag CheckBoxes
-    update.update_volume_combo_ids(self)
-    update.update_collection_combo_ids(self)
-    update.update_loanedto_combo_ids(self)
-    update.update_bytag_combo_ids(self)
+    update_volume_combo_ids(self)
+    update_collection_combo_ids(self)
     fill_volumes_combo(self)
     fill_collections_combo(self)
-    fill_loanedto_combo(self)
-    fill_bytag_combo(self)
+    fill_advfilter_combo(self)
     fill_preferences_tags_combo(self)
     language_combos(self)
     acodec_combos(self)
@@ -716,11 +712,26 @@
     else:
         self.widgets['preferences']['db_type'].set_active(0)
 
+def update_volume_combo_ids(self):
+    self.volume_combo_ids = {}
+    self.volume_combo_ids[0] = 0
+    i = 1
+    for volume in self.db.session.query(db.Volume).all():
+        self.volume_combo_ids[i] = volume.volume_id
+        i += 1
+
+def update_collection_combo_ids(self):
+    self.collection_combo_ids = {}
+    self.collection_combo_ids[0] = 0
+    i = 1
+    for collection in self.db.session.query(db.Collection).all():
+        self.collection_combo_ids[i] = collection.collection_id
+        i += 1
+
 def fill_volumes_combo(self, default=0):
     _tmp = self.initialized
     self.initialized = False # don't refresh main treeview
     self.widgets['add']['volume'].get_model().clear()
-    self.widgets['filter']['volume'].get_model().clear()
     for i in self.volume_combo_ids:
         vol_id = self.volume_combo_ids[i]
         if vol_id>0:
@@ -728,16 +739,12 @@
         else:
             name = ''
         self.widgets['add']['volume'].insert_text(int(i), str(name))
-        # add some white spaces to prevent scrollbar hides parts of the names    
-        self.widgets['filter']['volume'].insert_text(int(i), str(name) + '   ')
-    self.initialized = _tmp
     self.widgets['add']['volume'].show_all()
-    self.widgets['filter']['volume'].show_all()
-    self.widgets['filter']['volume'].set_active(0)
     i = gutils.findKey(default, self.volume_combo_ids)
     if i is not None:
         self.widgets['add']['volume'].set_active(int(i))
     self.widgets['add']['volume'].set_wrap_width(3)
+    self.initialized = _tmp
 
 def fill_collections_combo(self, default=0):
     _tmp = self.initialized
@@ -753,7 +760,6 @@
         self.widgets['add']['collection'].insert_text(int(i), str(name))
         # add some white spaces to prevent scrollbar hides parts of the names    
         self.widgets['filter']['collection'].insert_text(int(i), str(name) + '   ')
-    self.initialized = _tmp
     self.widgets['add']['collection'].show_all()
     self.widgets['filter']['collection'].show_all()
     self.widgets['filter']['collection'].set_active(0)
@@ -761,38 +767,21 @@
     if i is not None:
         self.widgets['add']['collection'].set_active(int(i))
     self.widgets['add']['collection'].set_wrap_width(2)
-
-def fill_loanedto_combo(self):
-    _tmp = self.initialized
-    self.initialized = False # don't refresh main treeview
-    self.widgets['filter']['loanedto'].get_model().clear()
-    for i in self.loanedto_combo_ids:
-        per_id = self.loanedto_combo_ids[i]
-        if per_id>0:
-            name = self.db.session.query(db.Person).filter_by(person_id=per_id).first().name
-        else:
-            name = ''
-        # add some white spaces to prevent scrollbar hides parts of the names    
-        self.widgets['filter']['loanedto'].insert_text(int(i), str(name) + '   ')
     self.initialized = _tmp
-    self.widgets['filter']['loanedto'].show_all()
-    self.widgets['filter']['loanedto'].set_active(0)
 
-def fill_bytag_combo(self):
+def fill_advfilter_combo(self):
     _tmp = self.initialized
     self.initialized = False # don't refresh main treeview
-    self.widgets['filter']['tag'].get_model().clear()
-    for i in self.bytag_combo_ids:
-        id = self.bytag_combo_ids[i]
-        if id>0:
-            name = self.db.session.query(db.Tag).filter_by(tag_id=id).first().name
-        else:
-            name = ''
+    self.widgets['filter']['advfilter'].get_model().clear()
+    self.widgets['filter']['advfilter'].insert_text(0, '') # empty one
+    i = 1
+    for item in self.db.session.query(db.Filter.name).all():
         # add some white spaces to prevent scrollbar hides parts of the names    
-        self.widgets['filter']['tag'].insert_text(int(i), str(name) + '   ')
+        self.widgets['filter']['advfilter'].insert_text(int(i), item.name + '   ')
+        i += 1
+    self.widgets['filter']['advfilter'].show_all()
+    self.widgets['filter']['advfilter'].set_active(0)
     self.initialized = _tmp
-    self.widgets['filter']['tag'].show_all()
-    self.widgets['filter']['tag'].set_active(0)
 
 def fill_preferences_tags_combo(self):
     _tmp = self.initialized
@@ -804,9 +793,9 @@
         self.tags_ids[i] = tag.tag_id
         self.widgets['preferences']['tag_name'].insert_text(int(i), str(tag.name))
         i += 1
-    self.initialized = _tmp
     self.widgets['preferences']['tag_name'].show_all()
     self.widgets['preferences']['tag_name'].set_active(0)
+    self.initialized = _tmp
 
 def language_combos(self):
     self.widgets['preferences']['lang_name'].get_model().clear()

Modified: trunk/lib/main_treeview.py
===================================================================
--- trunk/lib/main_treeview.py	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/lib/main_treeview.py	2008-11-15 23:46:51 UTC (rev 1045)
@@ -353,7 +353,16 @@
     if qf and not movies or isinstance(movies, Select): # if ".execute().fetchall()" not invoked on movies yet
         if not where: # due to possible 'seen', 'loaned', 'collection_id' in where
             import advfilter
-            cond = advfilter.get_def_conditions()
+            
+            # saved in advfilter
+            name = self.widgets['filter']['advfilter'].get_active_text()[:-3].decode('utf-8') # :-3 due to additional '   ' in the name
+            if name:
+                from sql import load_conditions
+                cond = load_conditions(self.db, name)
+                if not cond:
+                    cond = advfilter.get_def_conditions()
+            else:
+                cond = advfilter.get_def_conditions()
 
             # seen / loaned
             cond['loaned_only']   = self.widgets['menu']['loaned_movies'].get_active()
@@ -364,24 +373,6 @@
                 col_id = self.collection_combo_ids[pos]
                 if col_id > 0:
                     cond["collections"].add(col_id)
-            # volume
-            pos = self.widgets['filter']['volume'].get_active()
-            if pos >= 0:
-                vol_id = self.volume_combo_ids[pos]
-                if vol_id > 0:
-                    cond["volumes"].add(vol_id)
-            # loaned to
-            pos = self.widgets['filter']['loanedto'].get_active()
-            if pos >= 0:
-                per_id = self.loanedto_combo_ids[pos]
-                if per_id > 0:
-                    cond["loaned_to"].add(per_id)
-            # tag
-            pos = self.widgets['filter']['tag'].get_active()
-            if pos >= 0:
-                tag_id = self.bytag_combo_ids[pos]
-                if tag_id > 0:
-                    cond["tags"].add(tag_id)
 
             movies = advfilter.create_select_query(self, None, cond, movies)
         

Modified: trunk/lib/quick_filter.py
===================================================================
--- trunk/lib/quick_filter.py	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/lib/quick_filter.py	2008-11-15 23:46:51 UTC (rev 1045)
@@ -51,8 +51,7 @@
     self.widgets['filter']['text'].set_text('')
     self.widgets['filter']['criteria'].set_active(0)
     self.widgets['filter']['collection'].set_active(0)
-    self.widgets['filter']['volume'].set_active(0)
-    self.widgets['filter']['tag'].set_active(0)
+    self.widgets['filter']['advfilter'].set_active(0)
     self.initialized = True
     if populate:
         self.populate_treeview()

Deleted: trunk/lib/update.py
===================================================================
--- trunk/lib/update.py	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/lib/update.py	2008-11-15 23:46:51 UTC (rev 1045)
@@ -1,58 +0,0 @@
-# -*- coding: UTF-8 -*-
-
-__revision__ = '$Id$'
-
-# Copyright (c) 2005-2008 Vasco Nunes, Piotr O?arowski
-#
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Library General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
-
-# You may use and distribute this software under the terms of the
-# GNU General Public License, version 2 or later
-
-import gutils
-import os
-import db
-
-def update_volume_combo_ids(self):
-    self.volume_combo_ids = {}
-    self.volume_combo_ids[0] = 0
-    i = 1
-    for volume in self.db.session.query(db.Volume).all():
-        self.volume_combo_ids[i] = volume.volume_id
-        i += 1
-
-def update_collection_combo_ids(self):
-    self.collection_combo_ids = {}
-    self.collection_combo_ids[0] = 0
-    i = 1
-    for collection in self.db.session.query(db.Collection).all():
-        self.collection_combo_ids[i] = collection.collection_id
-        i += 1
-
-def update_loanedto_combo_ids(self):
-    self.loanedto_combo_ids = {}
-    self.loanedto_combo_ids[0] = 0
-    i = 1
-    for person in self.db.session.query(db.Person).order_by('name').all():
-        self.loanedto_combo_ids[i] = person.person_id
-        i += 1
-
-def update_bytag_combo_ids(self):
-    self.bytag_combo_ids = {}
-    self.bytag_combo_ids[0] = 0
-    i = 1
-    for tag in self.db.session.query(db.Tag).order_by('name').all():
-        self.bytag_combo_ids[i] = tag.tag_id
-        i += 1

Modified: trunk/lib/widgets.py
===================================================================
--- trunk/lib/widgets.py	2008-11-15 22:06:56 UTC (rev 1044)
+++ trunk/lib/widgets.py	2008-11-15 23:46:51 UTC (rev 1045)
@@ -312,9 +312,7 @@
         'text'       : get('filter_txt'),
         'criteria'   : get('filter_criteria'),
         'collection' : get('f_col'),
-        'volume'     : get('f_volume'),
-        'loanedto'   : get('f_loanedto'),
-        'tag'        : get('f_bytag'),
+        'advfilter'  : get('f_advfilter'),
     }#}}}
     
     self.widgets['menu'] = {#{{{
@@ -455,9 +453,7 @@
         'on_am_remove_volume_button_clicked'     : self.remove_volume,
         'on_am_remove_collection_button_clicked' : self.remove_collection,
         'on_f_col_changed'                       : self.filter_collection,
-        'on_f_volume_changed'                    : self.filter_volume,
-        'on_f_loanedto_changed'                  : self.filter_loanedto,
-        'on_f_bytag_changed'                     : self.filter_bytag,
+        'on_f_advfilter_changed'                 : self.filter_using_advfilter_rule,
         'on_results_cancel_clicked'              : self.results_cancel_ck,
         # languages
         'on_lang_add_clicked'                    : self.on_lang_add_clicked,



From piotrek at mail.berlios.de  Sun Nov 16 13:57:21 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 13:57:21 +0100
Subject: [Griffith-svn] r1046 - branches/0.9.x branches/0.9.x/lib trunk
	trunk/lib
Message-ID: <200811161257.mAGCvLuD028945@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 13:57:20 +0100 (Sun, 16 Nov 2008)
New Revision: 1046

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/dbupgrade.py
   branches/0.9.x/lib/sql.py
   trunk/ChangeLog
   trunk/griffith
   trunk/lib/sql.py
Log:
fail if database requires newer Griffith version


Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-15 23:46:51 UTC (rev 1045)
+++ branches/0.9.x/ChangeLog	2008-11-16 12:57:20 UTC (rev 1046)
@@ -7,6 +7,9 @@
 
 ---- 0.9.8 ---
 
+2008-11-16  Piotr O?arowski
+	* fail if database requires newer Griffith version
+
 2008-11-13  Piotr O?arowski
 	* New translations:
 	  + Persian (thanks to Artin)

Modified: branches/0.9.x/lib/dbupgrade.py
===================================================================
--- branches/0.9.x/lib/dbupgrade.py	2008-11-15 23:46:51 UTC (rev 1045)
+++ branches/0.9.x/lib/dbupgrade.py	2008-11-16 12:57:20 UTC (rev 1046)
@@ -125,6 +125,7 @@
 	#if version == 2:	# fix changes between v2 and v3
 	#	version+=1
 	#	self.Configuration.get_by(param='version').value = version
+	return True
 
 
 # ---------------------------------------------------

Modified: branches/0.9.x/lib/sql.py
===================================================================
--- branches/0.9.x/lib/sql.py	2008-11-15 23:46:51 UTC (rev 1045)
+++ branches/0.9.x/lib/sql.py	2008-11-16 12:57:20 UTC (rev 1046)
@@ -495,11 +495,16 @@
 			debug.show("DB version: %s" % e)
 			v = 0
 
-		if v is not None and v>1:
+		if v is not None and v > 1:
 			v = int(v.value)
 		if v < self.version:
 			from dbupgrade import upgrade_database
-			upgrade_database(self, v)
+            if not upgrade_database(self, v):
+				raise Exception("cannot upgrade database")
+		elif v > self.version:
+			debug.show("database version mismatch (detacted:%s; current:%s)" % (v, self.version))
+			gutils.warning(self, _('This database requires newer version of Griffith.'))
+			raise Exception("database version mismatch")
 
 # for debugging (run: ipython sql.py)
 if __name__ == '__main__':

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-15 23:46:51 UTC (rev 1045)
+++ trunk/ChangeLog	2008-11-16 12:57:20 UTC (rev 1046)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-16  Piotr O?arowski
+	* fail if database requires newer Griffith version
+
 2008-11-15  Piotr O?arowski
 	* Export plugins are now exporting movies listed in main window
 	* Replace "by ..." quick filter combo boxes with saved search conditions

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-15 23:46:51 UTC (rev 1045)
+++ trunk/griffith	2008-11-16 12:57:20 UTC (rev 1046)
@@ -1369,7 +1369,7 @@
                     if self.config.get('file', 'griffith.db', section='database') == 'griffith.gri':
                         self.config.set('file', 'griffith.db', section='database')
                 # create/connect db
-                self.db = GriffithSQL(self.config, self.griffith_dir)
+                self.db = GriffithSQL(self.config, self.griffith_dir, self.locations)
                 self.clear_details()
                 self.total = 0
                 self.count_statusbar()

Modified: trunk/lib/sql.py
===================================================================
--- trunk/lib/sql.py	2008-11-15 23:46:51 UTC (rev 1045)
+++ trunk/lib/sql.py	2008-11-16 12:57:20 UTC (rev 1046)
@@ -146,8 +146,11 @@
         if v < self.version:
             from dbupgrade import upgrade_database
             if not upgrade_database(self, v, locations):
-                import sys
-                sys.exit(1)
+                raise Exception("cannot upgrade database")
+        elif v > self.version:
+            log.error("database version mismatch (detacted:%s; current:%s)", v, self.version)
+            gutils.warning(_('This database requires newer version of Griffith.'))
+            raise Exception("database version mismatch")
 
 
 def update_whereclause(query, cond): # {{{



From piotrek at mail.berlios.de  Sun Nov 16 13:59:48 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 13:59:48 +0100
Subject: [Griffith-svn] r1047 - branches/0.9.x/lib
Message-ID: <200811161259.mAGCxmpD029104@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 13:59:48 +0100 (Sun, 16 Nov 2008)
New Revision: 1047

Modified:
   branches/0.9.x/lib/sql.py
Log:
s/    /\t

Modified: branches/0.9.x/lib/sql.py
===================================================================
--- branches/0.9.x/lib/sql.py	2008-11-16 12:57:20 UTC (rev 1046)
+++ branches/0.9.x/lib/sql.py	2008-11-16 12:59:48 UTC (rev 1047)
@@ -499,7 +499,7 @@
 			v = int(v.value)
 		if v < self.version:
 			from dbupgrade import upgrade_database
-            if not upgrade_database(self, v):
+			if not upgrade_database(self, v):
 				raise Exception("cannot upgrade database")
 		elif v > self.version:
 			debug.show("database version mismatch (detacted:%s; current:%s)" % (v, self.version))



From piotrek at mail.berlios.de  Sun Nov 16 19:39:59 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 19:39:59 +0100
Subject: [Griffith-svn] r1048 - in trunk: . lib
Message-ID: <200811161839.mAGIdxU2001056@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 19:39:58 +0100 (Sun, 16 Nov 2008)
New Revision: 1048

Modified:
   trunk/griffith
   trunk/lib/db.py
   trunk/lib/loan.py
Log:
show_volume() fixed


Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-16 12:59:48 UTC (rev 1047)
+++ trunk/griffith	2008-11-16 18:39:58 UTC (rev 1048)
@@ -506,11 +506,15 @@
                     initialize.fill_collections_combo(self, default=col_id)
 
     def show_volume(self, widget):
+        import advfilter
         vol_id = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).first().volume_id
-        pos = gutils.findKey(vol_id, self.volume_combo_ids)
-        quick_filter.clear_filter(self)
-        self.widgets['filter']['volume'].set_active(pos)
+        #quick_filter.clear_filter(self)
+        cond = advfilter.get_def_conditions()
+        cond["volumes"] = set((vol_id,))
+        movies = advfilter.create_select_query(self, None, cond, None).execute().fetchall()
+        self.populate_treeview(movies)
 
+
     def show_collection(self, widget):
         col_id = self.db.session.query(db.Movie).filter_by(movie_id=self._movie_id).first().collection_id
         pos = gutils.findKey(col_id, self.collection_combo_ids)

Modified: trunk/lib/db.py
===================================================================
--- trunk/lib/db.py	2008-11-16 12:59:48 UTC (rev 1047)
+++ trunk/lib/db.py	2008-11-16 18:39:58 UTC (rev 1048)
@@ -41,21 +41,21 @@
             if hasattr(self, i):
                 setattr(self, i, kwargs[i])
             else:
-                log.warn("%s.%s not set" % (self.__class__.__name__, i))
+                log.warn("%s.%s not set", self.__class__.__name__, i)
     def __repr__(self):
         return "<%s:%s>" % (self.__class__.__name__, self.name.encode('utf-8'))
 
     @validates('name')
     def _validate_name(self, key, name):
         if not name or not name.strip():
-            log.warning("%s: empty name (%s)" % (self.__class__.__name__, name))
+            log.warning("%s: empty name (%s)", self.__class__.__name__, name)
             raise ValueError(_("Name cannot be empty"))
         return name.strip()
 
     def remove_from_db(self):
         dbtable_id = self.__dict__[self.__class__.__name__.lower() + '_id']
         if dbtable_id<1:
-            log.info("%s: none selected => none removed" % self.__class__.__name__)
+            log.info("%s: none selected => none removed", self.__class__.__name__)
             return False
         tmp = None
         if hasattr(self,'movies'):
@@ -65,19 +65,19 @@
         if tmp and len(tmp)>0:
             gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
             return False
-        log.info("%s: removing '%s' (id=%s) from database..."%(self.__class__.__name__, self.name, dbtable_id))
+        log.info("%s: removing '%s' (id=%s) from database...", self.__class__.__name__, self.name, dbtable_id)
         self.delete()
         try:
             self.flush()
         except exceptions.SQLError, e:
-            log.info("%s: remove_from_db: %s" % (self.__class__.__name__, e))
+            log.info("%s: remove_from_db: %s", self.__class__.__name__, e)
             return False
         #self.refresh()
         return True
     def update_in_db(self):
         dbtable_id = self.__dict__[self.__class__.__name__.lower() + '_id']
         if dbtable_id<1:
-            log.info("%s: none selected => none updated" % self.__class__.__name__)
+            log.info("%s: none selected => none updated", self.__class__.__name__)
             return False
         tmp = self.query.filter_by(name=self.name).first()
         if tmp is not None and tmp is not self:
@@ -87,7 +87,7 @@
         try:
             self.flush()
         except exceptions.SQLError, e:
-            log.info("%s: update_in_db: %s" % (self.__class__.__name__, e))
+            log.info("%s: update_in_db: %s", self.__class__.__name__, e)
             return False
         self.refresh()
         return True
@@ -114,7 +114,7 @@
     def _validate_email(self, key, address):
         address = address.strip()
         if not EMAIL_PATTERN.match(address):
-            log.warning("%s: email address is not valid (%s)" % (self.__class__.__name__, address))
+            log.warning("%s: email address is not valid (%s)", self.__class__.__name__, address)
             raise ValueError(_("E-mail address is not valid"))
         return address
 
@@ -397,7 +397,7 @@
     import sqlalchemy
     logging.basicConfig()
     log.setLevel(logging.INFO)
-    log.info("SQLAlchemy version: %s" % sqlalchemy.__version__)
+    log.info("SQLAlchemy version: %s", sqlalchemy.__version__)
 
     ### ENGINE ###
     engine_mem = create_engine('sqlite:///:memory:', echo=False)

Modified: trunk/lib/loan.py
===================================================================
--- trunk/lib/loan.py	2008-11-16 12:59:48 UTC (rev 1047)
+++ trunk/lib/loan.py	2008-11-16 18:39:58 UTC (rev 1048)
@@ -21,7 +21,6 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-gettext.install('griffith', unicode=1)
 import gutils
 import gtk
 import datetime



From piotrek at mail.berlios.de  Sun Nov 16 19:52:09 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 19:52:09 +0100
Subject: [Griffith-svn] r1049 - trunk/lib
Message-ID: <200811161852.mAGIq9Qg002581@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 19:52:08 +0100 (Sun, 16 Nov 2008)
New Revision: 1049

Modified:
   trunk/lib/cover.py
Log:
print cover takes poster image from database again


Modified: trunk/lib/cover.py
===================================================================
--- trunk/lib/cover.py	2008-11-16 18:39:58 UTC (rev 1048)
+++ trunk/lib/cover.py	2008-11-16 18:52:08 UTC (rev 1049)
@@ -51,7 +51,7 @@
     size = self.widgets['print_cover']['ci_size'].get_active()
     print_number = self.widgets['print_cover']['ci_number'].get_active()
 
-    if self.config.get('font', '')!='':
+    if self.config.get('font', '') != '':
         fontName = "custom_font"
         pdfmetrics.registerFont(TTFont(fontName,self.config.get('font', '')))
     else:
@@ -165,28 +165,28 @@
         c.rotate(90)
         c.drawString(60, (-pageWidth/2)-8, movie.o_title.encode('utf-8'))
         c.rotate(-90)
-        if movie.image is not None and movie.image != '':
-            tmp_dest = self.locations['posters']
-            image = str(os.path.join(tmp_dest, str(movie.image)+".jpg"))
-            c.drawImage(image, x=(pageWidth-30)/2, y=470, width=30, height=50)
+        if movie.poster_md5:
+            filename = gutils.get_image_fname(movie.poster_md5, self.db)
+            if filename:
+                c.drawImage(filename, x=(pageWidth-30)/2, y=470, width=30, height=50)
         # print movie info
         c.setFont(fontName, 8)
         textObject = c.beginText()
         textObject.setTextOrigin(pageWidth-cover_x, 300)
         textObject.setFont(fontName, 8)
-        textObject.textLine(_("Original Title").encode('utf-8')+': '+str(movie.o_title).encode('utf-8'))
-        textObject.textLine(_("Title").encode('utf-8')+': '+str(movie.title).encode('utf-8'))
+        textObject.textLine(_("Original Title").encode('utf-8')+': '+ movie.o_title.encode('utf-8'))
+        textObject.textLine(_("Title").encode('utf-8')+': '+ movie.title.encode('utf-8'))
         textObject.textLine("")
-        textObject.textLine(_("Director").encode('utf-8')+': '+str(movie.director).encode('utf-8'))
+        textObject.textLine(_("Director").encode('utf-8')+': '+ movie.director.encode('utf-8'))
         textObject.textLine("")
         textObject.textLine(_("Running Time").encode('utf-8')+': '+str(movie.runtime).encode('utf-8')+ _(" min").encode('utf-8'))
-        textObject.textLine(_("Country").encode('utf-8')+': '+str(movie.country).encode('utf-8'))
-        textObject.textLine(_("Genre").encode('utf-8')+': '+str(movie.genre).encode('utf-8'))
+        textObject.textLine(_("Country").encode('utf-8')+': ' + movie.country.encode('utf-8'))
+        textObject.textLine(_("Genre").encode('utf-8')+': '+ movie.genre.encode('utf-8'))
         textObject.textLine("")
         c.drawText(textObject)
         # draw bigger poster image
-        if poster == True and movie.image is not None:
-            c.drawImage(image, x=(pageWidth-(pageWidth-cover_x)-235), y=(pageHeight/2)-125, width=180, height=250)
+        if poster and movie.poster_md5 and filename:
+            c.drawImage(filename, x=(pageWidth-(pageWidth-cover_x)-235), y=(pageHeight/2)-125, width=180, height=250)
     c.showPage()
     c.save()
     self.widgets['print_cover']['window_simple'].hide()
@@ -197,3 +197,4 @@
         os.popen3("open -a Preview" + " " + cover_file)
     else:
         os.popen3(self.pdf_reader + " " + cover_file)
+



From piotrek at mail.berlios.de  Sun Nov 16 19:56:32 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 19:56:32 +0100
Subject: [Griffith-svn] r1050 - trunk/lib
Message-ID: <200811161856.mAGIuWGL003461@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 19:56:32 +0100 (Sun, 16 Nov 2008)
New Revision: 1050

Modified:
   trunk/lib/main_treeview.py
Log:
fix menu->{loanded,not seen} only


Modified: trunk/lib/main_treeview.py
===================================================================
--- trunk/lib/main_treeview.py	2008-11-16 18:52:08 UTC (rev 1049)
+++ trunk/lib/main_treeview.py	2008-11-16 18:56:32 UTC (rev 1050)
@@ -365,8 +365,10 @@
                 cond = advfilter.get_def_conditions()
 
             # seen / loaned
-            cond['loaned_only']   = self.widgets['menu']['loaned_movies'].get_active()
-            cond["not_seen_only"] = self.widgets['menu']['not_seen_movies'].get_active()
+            if self.widgets['menu']['loaned_movies'].get_active():
+                cond['loaned'] = True
+            if self.widgets['menu']['not_seen_movies'].get_active():
+                cond["seen"] = False
             # collection
             pos = self.widgets['filter']['collection'].get_active()
             if pos >= 0:



From piotrek at mail.berlios.de  Sun Nov 16 20:07:49 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 20:07:49 +0100
Subject: [Griffith-svn] r1051 - in trunk: . glade
Message-ID: <200811161907.mAGJ7nOg007548@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 20:07:48 +0100 (Sun, 16 Nov 2008)
New Revision: 1051

Modified:
   trunk/ChangeLog
   trunk/glade/griffith.glade
Log:
Rename backup/restore menu items


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-16 18:56:32 UTC (rev 1050)
+++ trunk/ChangeLog	2008-11-16 19:07:48 UTC (rev 1051)
@@ -7,6 +7,7 @@
 
 2008-11-16  Piotr O?arowski
 	* fail if database requires newer Griffith version
+	* Rename backup/restore menu items
 
 2008-11-15  Piotr O?arowski
 	* Export plugins are now exporting movies listed in main window

Modified: trunk/glade/griffith.glade
===================================================================
--- trunk/glade/griffith.glade	2008-11-16 18:56:32 UTC (rev 1050)
+++ trunk/glade/griffith.glade	2008-11-16 19:07:48 UTC (rev 1051)
@@ -29,28 +29,40 @@
                     <child>
                       <widget class="GtkImageMenuItem" id="new1">
                         <property name="visible">True</property>
-                        <property name="label">gtk-new</property>
+                        <property name="label" translatable="yes">New database</property>
                         <property name="use_underline">True</property>
-                        <property name="use_stock">True</property>
                         <signal name="activate" handler="on_new_activate"/>
+                        <child internal-child="image">
+                          <widget class="GtkImage" id="menu-item-image8">
+                            <property name="stock">gtk-new</property>
+                          </widget>
+                        </child>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="backup">
                         <property name="visible">True</property>
-                        <property name="label">gtk-save-as</property>
+                        <property name="label" translatable="yes">Create backup</property>
                         <property name="use_underline">True</property>
-                        <property name="use_stock">True</property>
                         <signal name="activate" handler="on_backup_activate"/>
+                        <child internal-child="image">
+                          <widget class="GtkImage" id="menu-item-image7">
+                            <property name="stock">gtk-save-as</property>
+                          </widget>
+                        </child>
                       </widget>
                     </child>
                     <child>
                       <widget class="GtkImageMenuItem" id="restore">
                         <property name="visible">True</property>
-                        <property name="label">gtk-revert-to-saved</property>
+                        <property name="label" translatable="yes">Restore from backup</property>
                         <property name="use_underline">True</property>
-                        <property name="use_stock">True</property>
                         <signal name="activate" handler="on_restore_activate"/>
+                        <child internal-child="image">
+                          <widget class="GtkImage" id="menu-item-image11">
+							<property name="stock">gtk-revert-to-saved</property>
+                          </widget>
+                        </child>
                       </widget>
                     </child>
                     <child>



From piotrek at mail.berlios.de  Sun Nov 16 20:25:06 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 20:25:06 +0100
Subject: [Griffith-svn] r1052 - trunk/lib
Message-ID: <200811161925.mAGJP6NI012850@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 20:25:06 +0100 (Sun, 16 Nov 2008)
New Revision: 1052

Modified:
   trunk/lib/initialize.py
   trunk/lib/main_treeview.py
Log:
s/ratio/ratio_id


Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2008-11-16 19:07:48 UTC (rev 1051)
+++ trunk/lib/initialize.py	2008-11-16 19:25:06 UTC (rev 1052)
@@ -621,7 +621,7 @@
         'o_site'         : _('Official site'),
         'o_title'        : _('Original Title'),
         'plot'           : _('Plot'),
-        'ratio'          : _('Aspect ratio'),
+        'ratio_id'       : _('Aspect ratio'),
         'rating'         : _('Rating'),
         'region'         : _('Region'),
         'runtime'        : _('Runtime'),

Modified: trunk/lib/main_treeview.py
===================================================================
--- trunk/lib/main_treeview.py	2008-11-16 19:07:48 UTC (rev 1051)
+++ trunk/lib/main_treeview.py	2008-11-16 19:25:06 UTC (rev 1052)
@@ -247,6 +247,7 @@
         
         data_loan = get_loan_info(self.db, collection_id=item['collection_id'], volume_id=item['volume_id'], movie_id=item['movie_id'])
         if data_loan is None:
+            log.warning("movie has no load data, changing 'loaned' status to False (movie_id: %s)", item['movie_id'])
             item.loaned = False
         else:
             data_person = self.db.session.query(db.Person).filter_by(person_id=data_loan.person.person_id).first()



From piotrek at mail.berlios.de  Sun Nov 16 22:11:03 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 16 Nov 2008 22:11:03 +0100
Subject: [Griffith-svn] r1054 - branches/0.9.x/debian
Message-ID: <200811162111.mAGLB3PG023004@sheep.berlios.de>

Author: piotrek
Date: 2008-11-16 22:11:03 +0100 (Sun, 16 Nov 2008)
New Revision: 1054

Modified:
   branches/0.9.x/debian/watch
Log:
replace '-' with '~' in all versions, not just for RC


Modified: branches/0.9.x/debian/watch
===================================================================
--- branches/0.9.x/debian/watch	2008-11-16 21:04:13 UTC (rev 1053)
+++ branches/0.9.x/debian/watch	2008-11-16 21:11:03 UTC (rev 1054)
@@ -1,4 +1,4 @@
 version=3
-opts=downloadurlmangle=s/prdownload/download/,uversionmangle=s/-rc/~rc/ \
+opts=downloadurlmangle=s/prdownload/download/,uversionmangle=s/-/~/ \
 http://developer.berlios.de/project/showfiles.php?group_id=4891 \
 http://prdownload.berlios.de/griffith/griffith-(\d.*).tar.gz



From piotrek at mail.berlios.de  Mon Nov 17 00:21:20 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 00:21:20 +0100
Subject: [Griffith-svn] r1055 - in trunk: . debian lib
Message-ID: <200811162321.mAGNLKba006550@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 00:21:19 +0100 (Mon, 17 Nov 2008)
New Revision: 1055

Modified:
   trunk/ChangeLog
   trunk/debian/changelog
   trunk/debian/watch
   trunk/griffith
   trunk/lib/backup.py
   trunk/lib/dbupgrade.py
   trunk/lib/gconsole.py
   trunk/lib/initialize.py
   trunk/lib/main_treeview.py
   trunk/lib/preferences.py
   trunk/lib/sql.py
Log:
* Warn about developement version only once
  + home / config/ posters directory detected before initializing Griffith
* make ratio_id nullable
* share posters cache directory between databases


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/ChangeLog	2008-11-16 23:21:19 UTC (rev 1055)
@@ -8,6 +8,8 @@
 2008-11-16  Piotr O?arowski
 	* fail if database requires newer Griffith version
 	* Rename backup/restore menu items
+	* Warn about developement version only once
+	  + home / config/ posters directory detected before initializing Griffith
 
 2008-11-15  Piotr O?arowski
 	* Export plugins are now exporting movies listed in main window

Modified: trunk/debian/changelog
===================================================================
--- trunk/debian/changelog	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/debian/changelog	2008-11-16 23:21:19 UTC (rev 1055)
@@ -1,14 +1,14 @@
-griffith (0.10~svn-1) UNRELEASED; urgency=low
+griffith (0.10~beta1-1) UNRELEASED; urgency=low
 
   * New upstream release
 
- -- Piotr O?arowski <piotr at debian.org>  Thu, 13 Nov 2008 22:14:26 +0100
+ -- Piotr O?arowski <piotr at debian.org>  Mon, 17 Nov 2008 20:00:00 +0100
 
-griffith (0.9.8-1) UNRELEASED; urgency=low
+griffith (0.9.8-1) unstable; urgency=low
 
   * New upstream release
 
- -- Piotr O?arowski <piotr at debian.org>  Thu, 13 Nov 2008 22:14:26 +0100
+ -- Piotr O?arowski <piotr at debian.org>  Sun, 16 Nov 2008 21:58:55 +0100
 
 griffith (0.9.7.1-1) unstable; urgency=low
 

Modified: trunk/debian/watch
===================================================================
--- trunk/debian/watch	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/debian/watch	2008-11-16 23:21:19 UTC (rev 1055)
@@ -1,4 +1,4 @@
 version=3
-opts=downloadurlmangle=s/prdownload/download/,uversionmangle=s/-rc/~rc/ \
+opts=downloadurlmangle=s/prdownload/download/,uversionmangle=s/-/~/ \
 http://developer.berlios.de/project/showfiles.php?group_id=4891 \
 http://prdownload.berlios.de/griffith/griffith-(\d.*).tar.gz

Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/griffith	2008-11-16 23:21:19 UTC (rev 1055)
@@ -77,38 +77,32 @@
     initialized = False
     lang = {}
 
-    def __init__(self):
+    def __init__(self, home_dir, config):
         """main griffith application constructor"""
 
-        gconsole.check_args(self)
-        initialize.locations(self)
-        
-        initialize.i18n(self, self.locations['i18n'])
-        self.posix = (os.name == 'posix')
-    
         # Configuration
-        if self._tmp_config.find('/') >=0 or self._tmp_config.find('\\') >=0:
-            configFileName = self._tmp_config
-        else:
-            configFileName = os.path.join(self.locations['home'], self._tmp_config)
-        self.config = config.Config(file=configFileName)
-        initialize.location_posters(self.locations, self.config)
+        self.config = config
 
+        self.windows = (os.name == 'nt' or os.name.startswith('win')) # win32, win64
+        self.posix = (os.name == 'posix')
+
+        initialize.locations(self, home_dir)
+        initialize.i18n(self, self.locations['i18n'])
+
         # convert old database
-        filename = os.path.join(self.locations['home'], self.config.get('file', 'griffith.db', section='database'))
-        if self.config.get('file', 'griffith.db', section='database').lower().endswith('.gri'):
+        filename = os.path.join(self.locations['home'], config.get('file', 'griffith.db', section='database'))
+        if config.get('file', 'griffith.db', section='database').lower().endswith('.gri'):
             log.info('Old database format detected. Converting...')
             from dbupgrade import convert_from_old_db
             if convert_from_old_db(self, filename, os.path.join(self.locations['home'], 'griffith.db')):
-                self.config.save()
-                initialize.location_posters(self.locations, self.config)
+                config.save()
             else:
                 log.error('Cant convert old database, exiting.')
                 sys.exit(4)
         
         # create/connect db
         from sql import GriffithSQL
-        self.db = GriffithSQL(self.config, self.locations['home'], self.locations)
+        self.db = GriffithSQL(config, self.locations['home'], self.locations)
 
         # let's check any console arguments to parse
         gconsole.check_args_with_db(self)
@@ -1465,17 +1459,26 @@
                 treeview.set_cursor_on_cell(0)
 
 if __name__ == "__main__":
-    developer = False # TODO: get from config
-    if not developer and '~' in version.pversion or '-' in version.pversion:
-        response = gutils.question(_("""This is development version of Griffith.
-We're not providing upgrade path from dev. versions.
+    # where Griffith should look for its data?
+    home_dir, config_name = gconsole.check_args()
+    if not (config_name.find('/') >= 0 or config_name.find('\\') >= 0):
+        config_name = os.path.join(home_dir, config_name)
+    config = config.Config(file=config_name)
+
+    if ('~' in version.pversion or '-' in version.pversion) and \
+       config.get('warned_version', section='devel') != version.pversion:
+
+        response = gutils.question(_("""You're trying to run development version of Griffith.
+Upgrade path from dev. versions will not be provided.
 Please make sure you have a backup!
 
 Do you want to proceed?"""))
         if response != gtk.RESPONSE_YES:
             sys.exit(2)
+        else:
+            config.set('warned_version', version.pversion, section='devel')
 
-    griffith = Griffith()
+    griffith = Griffith(home_dir, config)
     griffith.main()
 
 # vim: fdm=marker

Modified: trunk/lib/backup.py
===================================================================
--- trunk/lib/backup.py	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/lib/backup.py	2008-11-16 23:21:19 UTC (rev 1055)
@@ -157,10 +157,8 @@
         if self.config.get('file', 'griffith.db', section='database').lower().endswith('.gri'):
             log.info('Old database format detected. Converting...')
             from dbupgrade  import convert_from_old_db
-            from initialize import location_posters
             if convert_from_old_db(self, filename, os.path.join(self.locations['home'], 'griffith.db')):
                 self.config.save()
-                location_posters(self.locations, self.config)
             else:
                 log.error('Cant convert old database, exiting.')
                 import sys

Modified: trunk/lib/dbupgrade.py
===================================================================
--- trunk/lib/dbupgrade.py	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/lib/dbupgrade.py	2008-11-16 23:21:19 UTC (rev 1055)
@@ -34,7 +34,7 @@
     if version == 0 or version is None:
         # version is 0 or none only for new databases
         db.metadata.create_all(b)
-        db.configuration_table.insert(bind=b).execute(param=u'version', value=self.version)
+        db.configuration_table.insert(bind=b).execute(param=u'version', value=unicode(self.version))
         db.media_table.insert(bind=b).execute(name=u'DVD')
         db.media_table.insert(bind=b).execute(name=u'DVD-R')
         db.media_table.insert(bind=b).execute(name=u'DVD-RW')
@@ -133,7 +133,7 @@
         log.info("... adding new columns")
         # common SQL statements
         queries = {'poster_md5': 'ALTER TABLE movies ADD poster_md5 VARCHAR(32) NULL REFERENCES posters(md5sum);',
-                   'ratio_id'  : 'ALTER TABLE movies ADD ratio_id INTEGER NOT NULL DEFAULT 1 REFERENCES ratios(ratio_id);',
+                   'ratio_id'  : 'ALTER TABLE movies ADD ratio_id INTEGER NULL REFERENCES ratios(ratio_id);',
                    'screenplay': 'ALTER TABLE movies ADD screenplay VARCHAR(256) NULL;',
                    'cameraman' : 'ALTER TABLE movies ADD cameraman VARCHAR(256) NULL;'}
         # if needed some db specific SQL statements

Modified: trunk/lib/gconsole.py
===================================================================
--- trunk/lib/gconsole.py	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/lib/gconsole.py	2008-11-16 23:21:19 UTC (rev 1055)
@@ -22,19 +22,30 @@
 # GNU General Public License, version 2 or later
 
 import getopt
+import os
 import sys
 import gutils
 import logging
 log = logging.getLogger("Griffith")
+from locale import getdefaultlocale
 
 options = ('hDCo:t:d:c:y:s:', ('help', 'debug', 'sqlecho', 'clean', 'check-dep',
     'show-dep', 'original_title=', 'title=', 'director=', 'cast=', 'year=',
     'sort=', 'seen=', 'loaned=', 'number=', 'runtime=', 'rating=', 'home=',
     'config='))
 
-def check_args(self):
-    self._tmp_home = None
-    self._tmp_config = 'griffith.cfg'
+def check_args():
+    default_lang, default_enc = getdefaultlocale()
+    if not default_enc:
+        default_enc = 'UTF-8'
+    
+    if os.name == 'nt' or os.name.startswith('win'): # win32, win64
+        from win32com.shell import shellcon, shell
+        home = os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc)
+    else:
+        home = os.path.join(os.path.expanduser('~'), '.griffith').decode(default_enc)
+    config = 'griffith.cfg'
+
     if len(sys.argv)>1:
         try:
             opts, args = getopt.getopt(sys.argv[1:], options[0], options[1])
@@ -53,15 +64,16 @@
                 sa_log = logging.getLogger("sqlalchemy")
                 sa_log.setLevel(logging.INFO)
             elif o == '--home':
-                self._tmp_home = a # see initialize.locations()
+                home = a
             elif o == '--config':
-                self._tmp_config = a # griffith.__init__
+                config = a
             elif o == '--check-dep':
                 check_dependencies()
                 sys.exit()
             elif o == '--show-dep':
                 show_dependencies()
                 sys.exit()
+    return home, config
 
 def check_args_with_db(self):
     if len(sys.argv)>1:

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/lib/initialize.py	2008-11-16 23:21:19 UTC (rev 1055)
@@ -41,13 +41,14 @@
 except:
     spell_support = 0
 
-def locations(self):
+def locations(self, home_dir):
     defaultLang, defaultEnc = getdefaultlocale()
     if defaultEnc is None:
         defaultEnc = 'UTF-8'
     locations = {}
     locations['exec'] = os.path.abspath(os.path.dirname(sys.argv[0])) # deprecated
     locations['lib']  = os.path.dirname(__file__)
+    locations['home'] = home_dir
     
     if os.name == 'nt' or os.name.startswith('win'): # win32, win64
         import winshell
@@ -68,7 +69,6 @@
         # this is changed on 0.9.5+svn so we need to make it backward compatible
         if os.path.exists(os.path.join(mydocs, 'griffith').decode(defaultEnc)):
             shutil.move(os.path.join(mydocs, 'griffith').decode(defaultEnc),os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc))
-        locations['home'] = os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc)
         
         # windows hack for locale setting
         lang = os.getenv('LANG')
@@ -79,7 +79,6 @@
             os.environ['LANG'] = lang
 
     elif os.name == 'posix':
-        locations['home']  = os.path.join(os.path.expanduser('~'), '.griffith').decode(defaultEnc)
         locations['share'] = os.path.abspath(os.path.join(locations['lib'], '..'))
         locations['glade'] = os.path.join(locations['share'], 'glade')
         locations['i18n']  = os.path.abspath(os.path.join(locations['share'], '..', 'locale'))
@@ -97,24 +96,24 @@
     from tempfile import gettempdir
     locations['temp'] = gettempdir()
     
-    if self._tmp_home is not None: # see gconsole.check_args
-        locations['home'] = self._tmp_home.decode(defaultEnc)
-        del self._tmp_home
-
     try:
         if not os.path.exists(locations['home']):
-            log.info('Creating %s' % locations['home'])
+            log.info('Creating %s', locations['home'])
             os.makedirs(locations['home'])
         else:
-            log.info("Using Griffith directory: %s" % locations['home'])
+            log.info("Using Griffith directory: %s", locations['home'])
     except OSError:
         log.info('Unable to create griffith directory.')
         raise
         sys.exit()
 
     if not os.access(locations['home'], os.W_OK):
-        log.info('Cannot write to griffith directory, %s' % locations['home'])
+        log.info('Cannot write to griffith directory, %s', locations['home'])
         sys.exit()
+    
+    locations['posters'] = os.path.join(locations['home'], 'posters')
+    if not os.path.isdir(locations['posters']):
+        os.makedirs(locations['posters'])
 
     # includes plugins in system path for easier importing
     sys.path.append(locations['lib'])
@@ -124,33 +123,10 @@
     self.locations = locations
     return locations
 
-def location_posters(locations, config):
-    if config.get('posters', None) is not None:
-        locations['posters']  = os.path.join(locations['home'], config.get('posters'))
-    elif config.get('type', 'sqlite', section='database') == 'sqlite':
-        dbname = config.get('name', 'griffith', section='database')
-        if dbname != 'griffith':
-            config['posters'] = 'posters_sqlite_' + dbname
-        else:
-            config['posters'] = 'posters'
-        locations['posters'] = os.path.join(locations['home'], config.get('posters'))
-        config.save()
-    else:
-        config['posters'] = "posters_%(type)s_%(host)s_%(port)s_%(name)s_%(user)s" % config.toDict('database')
-        locations['posters'] = os.path.join(locations['home'], config.get('posters'))
-        config.save()
-    # check if posters dir exists
-    if not os.path.isdir(locations['posters']):
-        os.makedirs(locations['posters'])
-
 def gui(self):
     self._ = None
-    log.info("running on %s - %s" % (os.name, platform.system()))
-    if os.name == 'nt' or os.name.startswith('win'):
-        self.windows = True
-    else:
-        self.windows = False
-        
+    log.info("running on %s - %s", os.name, platform.system())
+
     if platform.system() == 'Darwin':
         self.mac = True
     else:

Modified: trunk/lib/main_treeview.py
===================================================================
--- trunk/lib/main_treeview.py	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/lib/main_treeview.py	2008-11-16 23:21:19 UTC (rev 1055)
@@ -247,7 +247,7 @@
         
         data_loan = get_loan_info(self.db, collection_id=item['collection_id'], volume_id=item['volume_id'], movie_id=item['movie_id'])
         if data_loan is None:
-            log.warning("movie has no load data, changing 'loaned' status to False (movie_id: %s)", item['movie_id'])
+            log.warning("movie has no loan data, changing 'loaned' flag to False (movie_id: %s)", item['movie_id'])
             item.loaned = False
         else:
             data_person = self.db.session.query(db.Person).filter_by(person_id=data_loan.person.person_id).first()

Modified: trunk/lib/preferences.py
===================================================================
--- trunk/lib/preferences.py	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/lib/preferences.py	2008-11-16 23:21:19 UTC (rev 1055)
@@ -427,13 +427,11 @@
         log.info('DATABASE: connecting to new db server...')
         import sql
         from sqlalchemy.exceptions import InvalidRequestError
-        from initialize            import dictionaries, people_treeview, location_posters
+        from initialize import dictionaries, people_treeview
         
         # new database connection
         self.initialized = False
         try:
-            c['posters'] = None # force update
-            location_posters(self.locations, self.config)
             self.db = sql.GriffithSQL(c, self.locations['home'], self.locations)
         except InvalidRequestError, e:
             log.error(str(e))
@@ -446,8 +444,6 @@
         # initialize new database
         self.total = int(self.db.session.query(db.Movie).count())
         self.count_statusbar()
-        c['posters'] = None # force update
-        location_posters(self.locations, self.config)
         dictionaries(self)
         people_treeview(self, False)
         self.initialized = True

Modified: trunk/lib/sql.py
===================================================================
--- trunk/lib/sql.py	2008-11-16 21:11:03 UTC (rev 1054)
+++ trunk/lib/sql.py	2008-11-16 23:21:19 UTC (rev 1055)
@@ -34,7 +34,7 @@
 import gutils # TODO: get rid of this import
 import db # ORM data (SQLAlchemy stuff)
 
-class GriffithSQL:
+class GriffithSQL(object):
     version = 3    # database format version, increase after changing data structures
 
     def __init__(self, config, griffith_dir, locations, reconnect=True):



From piotrek at mail.berlios.de  Mon Nov 17 21:18:39 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 21:18:39 +0100
Subject: [Griffith-svn] r1057 - in trunk: . lib
Message-ID: <200811172018.mAHKIdix024434@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 21:18:38 +0100 (Mon, 17 Nov 2008)
New Revision: 1057

Modified:
   trunk/griffith
   trunk/lib/config.py
   trunk/lib/dbupgrade.py
   trunk/lib/preferences.py
   trunk/lib/sql.py
Log:
generate correct posters' path while upgrading from Griffith < 0.10 (i.e. db version < 3)


Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-16 23:29:08 UTC (rev 1056)
+++ trunk/griffith	2008-11-17 20:18:38 UTC (rev 1057)
@@ -1463,6 +1463,7 @@
     home_dir, config_name = gconsole.check_args()
     if not (config_name.find('/') >= 0 or config_name.find('\\') >= 0):
         config_name = os.path.join(home_dir, config_name)
+    log.debug("config file used: %s", config_name)
     config = config.Config(file=config_name)
 
     if ('~' in version.pversion or '-' in version.pversion) and \

Modified: trunk/lib/config.py
===================================================================
--- trunk/lib/config.py	2008-11-16 23:29:08 UTC (rev 1056)
+++ trunk/lib/config.py	2008-11-17 20:18:38 UTC (rev 1057)
@@ -25,8 +25,10 @@
 import os.path
 import ConfigParser
 #import cPickle as pickle
+import logging
+log = logging.getLogger("Griffith")
 
-class Config:
+class Config(object):
     subst = {'True': True, 'False': False, 'None': None}
     def __init__ (self, file):
         self._file = file
@@ -42,14 +44,13 @@
             return default
         else:
             value = self._cfg.get(section, option, False)
-            if value in self.subst.keys():
-                value = self.subst[value]
+            value = Config.subst.get(value, value) # replace 'True' etc.
             return value
 
     def set(self, option, value, section='main'):
-        if not isinstance(option, str):
+        if not isinstance(option, basestring):
             option = str(option)
-        if not isinstance(value, str):
+        if not isinstance(value, basestring):
             value = str(value)
         if not self._cfg.has_section(section):
             self._cfg.add_section(section)
@@ -64,13 +65,16 @@
     def __getitem__(self, key):
         return self.get('main', key)
 
+    def remove_option(self, option, section='main'):
+        return self._cfg.remove_option(section, option)
+
     def keys(self, section='main'):
         return [ i[0] for i in self._cfg.items(section) ]
     def values(self, section='main'):
         return [ i[1] for i in self._cfg.items(section) ]
     def items(self, section='main'):
         return self._cfg.items(section)
-    def toDict(self, section='main'):
+    def to_dict(self, section='main'):
         d = {}
         for i,j in self._cfg.items(section):
             d[i] = j
@@ -86,8 +90,9 @@
             self._cfg = ConfigParser.SafeConfigParser()
             try:
                 self._cfg.read(self._file)
-            except:
-                print 'Cannot parse config file'
+            except Exception, e:
+                log.debug(str(e))
+                log.error('Cannot parse config file')
                 return False
             # check values for number datatypes
             # if current value could not be converted to number datatype

Modified: trunk/lib/dbupgrade.py
===================================================================
--- trunk/lib/dbupgrade.py	2008-11-16 23:29:08 UTC (rev 1056)
+++ trunk/lib/dbupgrade.py	2008-11-17 20:18:38 UTC (rev 1057)
@@ -1,4 +1,5 @@
 # -*- coding: UTF-8 -*-
+# vim: fdm=marker
 
 __revision__ = '$Id$'
 
@@ -28,7 +29,7 @@
 import logging
 log = logging.getLogger("Griffith")
 
-def upgrade_database(self, version, locations):
+def upgrade_database(self, version, locations, config):
     """Create new db or update existing one to current format"""
     b = self.session.bind
     if version == 0 or version is None:
@@ -149,8 +150,9 @@
                 return False
         
         log.info("... saving posters in database")
+        posters_dir = get_old_posters_location(locations['home'], config, clean_config=True)
         for movie in self.session.query(db.Movie).all():
-            poster_file_name = os.path.join(locations['posters'], "%s.jpg" % movie.image)
+            poster_file_name = os.path.join(posters_dir, "%s.jpg" % movie.image)
             if os.path.isfile(poster_file_name):
                 poster_md5  = gutils.md5sum(file(poster_file_name, 'rb'))
                 poster = self.session.query(db.Poster).filter_by(md5sum=poster_md5).first()
@@ -513,4 +515,20 @@
     clear_mappers()
     return True
 #}}}
-# vim: fdm=marker
+
+def get_old_posters_location(home_dir, config, clean_config=False):
+    if config.get('posters', None) is not None:
+        dirname = config.get('posters')
+    elif config.get('type', 'sqlite', section='database') == 'sqlite':
+        dbname = config.get('name', 'griffith', section='database')
+        if dbname != 'griffith':
+            dirname = "posters_sqlite_%s" % dbname
+        else:
+            dirname = 'posters'
+    else:
+        dirname = "posters_%(type)s_%(host)s_%(port)s_%(name)s_%(user)s" % config.to_dict('database')
+    if clean_config:
+        config.remove_option('posters')
+        config.save()
+    return os.path.join(home_dir, dirname)
+

Modified: trunk/lib/preferences.py
===================================================================
--- trunk/lib/preferences.py	2008-11-16 23:29:08 UTC (rev 1056)
+++ trunk/lib/preferences.py	2008-11-17 20:18:38 UTC (rev 1057)
@@ -401,7 +401,7 @@
     self.pdf_reader = save_reader
 
     # database
-    old = c.toDict(section='database')
+    old = c.to_dict(section='database')
     
     c.set('host', w['db_host'].get_text(), section='database')
     c.set('port', int(w['db_port'].get_value()), section='database')
@@ -432,7 +432,8 @@
         # new database connection
         self.initialized = False
         try:
-            self.db = sql.GriffithSQL(c, self.locations['home'], self.locations)
+            c['posters'] = None # force update
+            self.db = sql.GriffithSQL(c, self.locations['home'], self.locations, fallback=True)
         except InvalidRequestError, e:
             log.error(str(e))
             c.set('type', 'sqlite', section='database')

Modified: trunk/lib/sql.py
===================================================================
--- trunk/lib/sql.py	2008-11-16 23:29:08 UTC (rev 1056)
+++ trunk/lib/sql.py	2008-11-17 20:18:38 UTC (rev 1057)
@@ -37,7 +37,7 @@
 class GriffithSQL(object):
     version = 3    # database format version, increase after changing data structures
 
-    def __init__(self, config, griffith_dir, locations, reconnect=True):
+    def __init__(self, config, griffith_dir, locations, fallback=True):
         #mapper = Session.mapper
         self.config = config
         self.data_dir = griffith_dir
@@ -101,9 +101,9 @@
             engine = create_engine(url, echo=False)
             conn = engine.connect()
         except Exception, e:    # InvalidRequestError, ImportError
-            log.info("MetaData: %s" % e)
-            if not reconnect:
-                return False
+            log.info("MetaData: %s", e)
+            if not fallback:
+                raise e
             config.set('type', 'sqlite', section='database')
             gutils.warning(self, "%s\n\n%s" % (_('Cannot connect to database.\nFalling back to SQLite.'), _('Please check debug output for more informations.')))
             url = "sqlite:///%s" % os.path.join(griffith_dir, config.get('name', 'griffith', section='database') + '.db')
@@ -116,9 +116,9 @@
             session = Session()
             #self.metadata.bind.connect()
         except Exception, e:
-            log.info("engine connection: %s" % e)
-            if not reconnect:
-                return False
+            log.info("engine connection error: %s", e)
+            if not fallback:
+                raise e
             gutils.error(self, _('Database connection failed.'))
             config.set('type', 'sqlite', section='database')
             url = "sqlite:///%s" % os.path.join(griffith_dir, 'griffith.db')
@@ -145,7 +145,7 @@
             v = int(v.value)
         if v < self.version:
             from dbupgrade import upgrade_database
-            if not upgrade_database(self, v, locations):
+            if not upgrade_database(self, v, locations, config):
                 raise Exception("cannot upgrade database")
         elif v > self.version:
             log.error("database version mismatch (detacted:%s; current:%s)", v, self.version)
@@ -295,7 +295,7 @@
         movie.collection.loaned = True
         for m in movie.collection.movies:
             if m.loaned:
-                log.warn("collection contains loaned movie (%s), cannot proceed" % m.number)
+                log.warn("collection contains loaned movie (%s), cannot proceed", m.number)
                 session.rollback()
                 return -1
             m.loaned = True
@@ -332,18 +332,18 @@
     if loan is None:
         movie = session.query(db.Movie).filter_by(movie_id=movie_id).first()
         if not movie:
-            log.warn("Cannot find ")
+            log.warn("Cannot find movie: %s", movie_id)
             return False
         # lets check if whole colletion was loaned
         elif movie.collection and movie.collection.loaned:
             loan = session.query(db.Loan).filter_by(collection_id=movie.collection_id, return_date=None).first()
             if not loan:
-                log.error("Collection is marked as loaned but there's no such loan")
+                log.error("Collection is marked as loaned but there's no loan data")
                 return False
         elif movie.volume and movie.volume.loaned:
             loan = session.query(db.Loan).filter_by(volume_id=movie.volume_id, return_date=None).first()
         else:
-            log.error("Cannot find loan data")
+            log.error("Cannot find loan data (movie_id:%s)", movie_id)
             return False
 
     if loan.collection:
@@ -447,6 +447,6 @@
     if filter_:
         return filter_.conditions
     else:
-        log.warn("Cannot find search conditions: %s" % name)
+        log.warn("Cannot find search conditions: %s", name)
         return None
 #}}}



From piotrek at mail.berlios.de  Mon Nov 17 22:26:47 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 22:26:47 +0100
Subject: [Griffith-svn] r1058 - in trunk: . debian lib
Message-ID: <200811172126.mAHLQlWv002254@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 22:26:46 +0100 (Mon, 17 Nov 2008)
New Revision: 1058

Modified:
   trunk/ChangeLog
   trunk/Makefile
   trunk/debian/changelog
   trunk/debian/control
   trunk/lib/gconsole.py
   trunk/lib/preferences.py
Log:
* Add --version/-v command line options
* Add bash completion script


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-17 20:18:38 UTC (rev 1057)
+++ trunk/ChangeLog	2008-11-17 21:26:46 UTC (rev 1058)
@@ -5,6 +5,10 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-17  Piotr O?arowski
+	* Add --version/-v command line options
+	* Add bash completion script
+
 2008-11-16  Piotr O?arowski
 	* fail if database requires newer Griffith version
 	* Rename backup/restore menu items

Modified: trunk/Makefile
===================================================================
--- trunk/Makefile	2008-11-17 20:18:38 UTC (rev 1057)
+++ trunk/Makefile	2008-11-17 21:26:46 UTC (rev 1058)
@@ -20,8 +20,9 @@
 FIND ?= find
 DOC2MAN ?= docbook2x-man
 
-PREFIX = $(DESTDIR)/usr
+PREFIX ?= $(DESTDIR)/usr
 BINDIR = $(PREFIX)/bin
+ETCDIR = $(DESTDIR)/etc
 DATADIR = $(PREFIX)/share/griffith
 LIBDIR = $(DATADIR)/lib
 IMAGESDIR = $(DATADIR)/images
@@ -34,6 +35,7 @@
 APPLICATIONSDIR = $(PREFIX)/share/applications
 ICONDIR = $(PREFIX)/share/pixmaps
 LOCALEDIR = $(PREFIX)/share/locale
+BASHCOMPDIR = $(ETCDIR)/bash_completion.d
 
 help:
 	@echo Usage:
@@ -52,7 +54,7 @@
 	@echo "^^^^^^^^^^^^^^^^^^^"
 	$(INSTALL) -m 755 -d $(BINDIR) $(DATADIR) $(LIBDIR) $(PLUGINSDIR) $(MOVIEPLUGINSDIR) \
 		$(EXPORTPLUGINSDIR) $(IMPORTPLUGINSDIR) $(FONTSDIR) $(APPLICATIONSDIR) \
-		$(ICONDIR) $(TPLDIR) $(IMAGESDIR) $(GLADEDIR)
+		$(ICONDIR) $(TPLDIR) $(IMAGESDIR) $(GLADEDIR) $(ETCDIR) $(BASHCOMPDIR)
 	$(INSTALL) -m 755 griffith $(LIBDIR)
 	$(INSTALL) -m 644 lib/*.py $(LIBDIR)
 	$(INSTALL) -m 644 lib/plugins/*.py $(PLUGINSDIR)
@@ -65,6 +67,7 @@
 	$(INSTALL) -m 644 images/griffith.png $(ICONDIR)
 	$(INSTALL) -m 644 images/griffith.xpm $(ICONDIR)
 	$(INSTALL) -m 644 data/griffith.desktop $(APPLICATIONSDIR)
+	$(INSTALL) -m 644 data/bash_completion $(BASHCOMPDIR)/griffith
 	
 	# installing language files
 	for lang in $(LANGUAGES); do \
@@ -104,6 +107,7 @@
 		${RM} -r $(LOCALEDIR)/$$lang/LC_MESSAGES/griffith.mo; \
 	done
 	${RM} -r $(BINDIR)/griffith
+	${RM} -r $(BASHCOMPDIR)/griffith
 	$(MAKE) -C docs uninstall
 	
 clean:

Modified: trunk/debian/changelog
===================================================================
--- trunk/debian/changelog	2008-11-17 20:18:38 UTC (rev 1057)
+++ trunk/debian/changelog	2008-11-17 21:26:46 UTC (rev 1058)
@@ -1,8 +1,9 @@
-griffith (0.10~beta1-1) UNRELEASED; urgency=low
+griffith (0.10~beta1-1) experimental; urgency=low
 
   * New upstream release
+    + XS-Python-Version bumped to >=2.5
 
- -- Piotr O?arowski <piotr at debian.org>  Mon, 17 Nov 2008 20:00:00 +0100
+ -- Piotr O?arowski <piotr at debian.org>  Mon, 17 Nov 2008 22:20:53 +0100
 
 griffith (0.9.8-1) unstable; urgency=low
 

Modified: trunk/debian/control
===================================================================
--- trunk/debian/control	2008-11-17 20:18:38 UTC (rev 1057)
+++ trunk/debian/control	2008-11-17 21:26:46 UTC (rev 1058)
@@ -5,7 +5,7 @@
 Build-Depends: debhelper (>= 5)
 Build-Depends-Indep: python (>= 2.3.5-11), python-central (>= 0.5.6)
 Standards-Version: 3.8.0
-XS-Python-Version: >=2.3
+XS-Python-Version: >=2.5
 Vcs-Svn: svn://svn.berlios.de/griffith/trunk/debian
 Vcs-Browser: http://svn.berlios.de/wsvn/griffith/debian/?sc=1
 Homepage: http://www.griffith.cc/

Modified: trunk/lib/gconsole.py
===================================================================
--- trunk/lib/gconsole.py	2008-11-17 20:18:38 UTC (rev 1057)
+++ trunk/lib/gconsole.py	2008-11-17 21:26:46 UTC (rev 1058)
@@ -29,10 +29,10 @@
 log = logging.getLogger("Griffith")
 from locale import getdefaultlocale
 
-options = ('hDCo:t:d:c:y:s:', ('help', 'debug', 'sqlecho', 'clean', 'check-dep',
+options = ('hvDCo:t:d:c:y:s:', ('help', 'debug', 'sqlecho', 'clean', 'check-dep',
     'show-dep', 'original_title=', 'title=', 'director=', 'cast=', 'year=',
     'sort=', 'seen=', 'loaned=', 'number=', 'runtime=', 'rating=', 'home=',
-    'config='))
+    'config=', 'version' ))
 
 def check_args():
     default_lang, default_enc = getdefaultlocale()
@@ -58,6 +58,10 @@
             if o in ('-h', '--help'):
                 con_usage()
                 sys.exit()
+            if o in ('-v', '--version'):
+                import version
+                print version.pversion
+                sys.exit()
             elif o in ('-D', '--debug'):
                 log.setLevel(logging.DEBUG)
             elif o == '--sqlecho':
@@ -206,6 +210,7 @@
     print "USAGE:", sys.argv[0], '[OPTIONS]'
     print "\nOPTIONS:"
     print "-h, --help\tprints this screen"
+    print "-v, --version\tprints Griffith's version"
     print "-D, --debug\trun with more debug info"
     print "-C, --clean\tfind and delete orphan files in posters directory"
     print "--check-dep\tcheck dependencies"

Modified: trunk/lib/preferences.py
===================================================================
--- trunk/lib/preferences.py	2008-11-17 20:18:38 UTC (rev 1057)
+++ trunk/lib/preferences.py	2008-11-17 21:26:46 UTC (rev 1058)
@@ -431,8 +431,9 @@
         
         # new database connection
         self.initialized = False
+        if c.has_key('posters'):
+            c['posters'] = None # force update
         try:
-            c['posters'] = None # force update
             self.db = sql.GriffithSQL(c, self.locations['home'], self.locations, fallback=True)
         except InvalidRequestError, e:
             log.error(str(e))



From piotrek at mail.berlios.de  Mon Nov 17 22:40:30 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 22:40:30 +0100
Subject: [Griffith-svn] r1059 - trunk/data
Message-ID: <200811172140.mAHLeUTh004822@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 22:40:29 +0100 (Mon, 17 Nov 2008)
New Revision: 1059

Added:
   trunk/data/bash_completion
Log:
add missing file


Added: trunk/data/bash_completion
===================================================================
--- trunk/data/bash_completion	2008-11-17 21:26:46 UTC (rev 1058)
+++ trunk/data/bash_completion	2008-11-17 21:40:29 UTC (rev 1059)
@@ -0,0 +1,33 @@
+# griffith(1) completion
+# Copyright 2008 Piotr O?arowski <piotr at griffith.cc>
+
+# This script can be distributed under the same license as the
+# griffith or bash packages.
+
+have griffith &&
+_griffith()
+{
+    local cur prev options
+    
+    COMPREPLY=()
+    cur=${COMP_WORDS[COMP_CWORD]}
+    prev=${COMP_WORDS[COMP_CWORD-1]}
+    options='-h --help -v --version -D --debug -C --clean --check-dep --show-dep --sqlecho --home -c --cast -d --director -o --original_title -t --title -y --year -s --sort'
+
+
+    case $prev in
+	-h|--help|-v|--version)
+	    COMPREPLY=()
+	    ;;
+	--home)
+	    COMPREPLY=( $( compgen -d -o dirnames "$cur") )
+	    ;;
+	*)
+	    COMPREPLY=( $( compgen -W "$options" | grep "^$cur" ) )
+	    ;;
+    esac
+
+    return 0
+
+}
+[ "$have" ] && complete -F _griffith griffith



From piotrek at mail.berlios.de  Mon Nov 17 22:50:30 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 22:50:30 +0100
Subject: [Griffith-svn] r1060 - in trunk: . lib
Message-ID: <200811172150.mAHLoUKF007834@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 22:50:30 +0100 (Mon, 17 Nov 2008)
New Revision: 1060

Modified:
   trunk/ChangeLog
   trunk/lib/version.py
Log:
Version changed to 0.10-beta1


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-17 21:40:29 UTC (rev 1059)
+++ trunk/ChangeLog	2008-11-17 21:50:30 UTC (rev 1060)
@@ -5,9 +5,12 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+---- 0.10-beta1 ---
+
 2008-11-17  Piotr O?arowski
 	* Add --version/-v command line options
 	* Add bash completion script
+	* Version changed to 0.10-beta1
 
 2008-11-16  Piotr O?arowski
 	* fail if database requires newer Griffith version

Modified: trunk/lib/version.py
===================================================================
--- trunk/lib/version.py	2008-11-17 21:40:29 UTC (rev 1059)
+++ trunk/lib/version.py	2008-11-17 21:50:30 UTC (rev 1060)
@@ -22,7 +22,7 @@
 # GNU General Public License, version 2 or later
 
 pname        = "Griffith"
-pversion     = "0.10~svn"
+pversion     = "0.10-beta1"
 pauthor      = "Vasco Nunes, Piotr O?arowski <griffith-private at lists.berlios.de>"
 pyear        = "2005-2008"
 pwebsite     = "http://www.griffith.cc/"



From piotrek at mail.berlios.de  Mon Nov 17 23:04:40 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 23:04:40 +0100
Subject: [Griffith-svn] r1061 - trunk
Message-ID: <200811172204.mAHM4eFt011037@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 23:04:39 +0100 (Mon, 17 Nov 2008)
New Revision: 1061

Modified:
   trunk/griffith
Log:
update the warning about dev. versions


Modified: trunk/griffith
===================================================================
--- trunk/griffith	2008-11-17 21:50:30 UTC (rev 1060)
+++ trunk/griffith	2008-11-17 22:04:39 UTC (rev 1061)
@@ -1469,8 +1469,8 @@
     if ('~' in version.pversion or '-' in version.pversion) and \
        config.get('warned_version', section='devel') != version.pversion:
 
-        response = gutils.question(_("""You're trying to run development version of Griffith.
-Upgrade path from dev. versions will not be provided.
+        response = gutils.question(_("""This is development version of Griffith.
+Upgrade path from dev. versions may not be provided.
 Please make sure you have a backup!
 
 Do you want to proceed?"""))



From piotrek at mail.berlios.de  Mon Nov 17 23:09:51 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 23:09:51 +0100
Subject: [Griffith-svn] r1062 - in trunk: . po
Message-ID: <200811172209.mAHM9p28012669@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 23:09:50 +0100 (Mon, 17 Nov 2008)
New Revision: 1062

Modified:
   trunk/ChangeLog
   trunk/po/pl.po
Log:
Update Polish translation


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-17 22:04:39 UTC (rev 1061)
+++ trunk/ChangeLog	2008-11-17 22:09:50 UTC (rev 1062)
@@ -11,6 +11,7 @@
 	* Add --version/-v command line options
 	* Add bash completion script
 	* Version changed to 0.10-beta1
+	* Update Polish translation
 
 2008-11-16  Piotr O?arowski
 	* fail if database requires newer Griffith version

Modified: trunk/po/pl.po
===================================================================
--- trunk/po/pl.po	2008-11-17 22:04:39 UTC (rev 1061)
+++ trunk/po/pl.po	2008-11-17 22:09:50 UTC (rev 1062)
@@ -4,9 +4,9 @@
 # Piotr O?arowski <ozarow at gmail.com>, 2005-2007
 msgid ""
 msgstr ""
-"Project-Id-Version: griffith 0.9.7\n"
+"Project-Id-Version: griffith 0.10-beta1\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2008-11-13 23:26+0100\n"
+"POT-Creation-Date: 2008-11-17 23:04+0100\n"
 "PO-Revision-Date: 2008-01-26 21:55+0000\n"
 "Last-Translator: Piotr O?arowski <ozarow+griffith at gmail.com>\n"
 "Language-Team: Polski\n"
@@ -16,22 +16,22 @@
 "X-Launchpad-Export-Date: 2008-07-21 17:20+0000\n"
 "X-Generator: Launchpad (build Unknown)\n"
 
-#: ../griffith:222 ../griffith:1052 ../lib/delete.py:37 ../lib/edit.py:49
-#: ../lib/edit.py:140
+#: ../griffith:221 ../griffith:1049 ../lib/delete.py:35 ../lib/edit.py:46
+#: ../lib/edit.py:137
 msgid "You have no movies in your database"
 msgstr "Twoja baza nie zawiera film?w"
 
-#: ../griffith:400
+#: ../griffith:399
 msgid "You have seen all films in your collection!"
 msgstr "Obejrza?e? ju? wszystkie filmy z kolekcji!"
 
-#: ../griffith:568 ../griffith:573 ../lib/initialize.py:355
-#: ../lib/initialize.py:645
+#: ../griffith:571 ../griffith:576 ../lib/initialize.py:329
+#: ../lib/initialize.py:615
 msgid "subtitles"
 msgstr "napisy"
 
-#: ../griffith:615 ../griffith:679 ../griffith:740 ../griffith:798
-#: ../griffith:856 ../griffith:914 ../griffith:972 ../lib/db.py:68
+#: ../griffith:618 ../griffith:678 ../griffith:737 ../griffith:795
+#: ../griffith:853 ../griffith:911 ../griffith:969 ../lib/db.py:66
 msgid ""
 "This item is in use.\n"
 "Operation aborted!"
@@ -39,7 +39,7 @@
 "Ta pozycja jest u?ywana.\n"
 "Operacja przerwana!"
 
-#: ../griffith:1022
+#: ../griffith:1019
 msgid ""
 "Are you sure you want to restore?\n"
 "Your current movie collection will be replaced.\n"
@@ -49,7 +49,7 @@
 "Twoja aktualna baza film?w zostanie podmieniona.\n"
 "Nie ma mo?liwo?ci cofni?cia zmian."
 
-#: ../griffith:1030
+#: ../griffith:1027
 msgid ""
 "Are you sure you want to mix?\n"
 "Your current movie collection will be mixed with a backup.\n"
@@ -59,7 +59,7 @@
 "Twoja aktualna baza film?w zostanie po??czona z filmami z kopii zapasowej.\n"
 "Nie ma mo?liwo?ci cofni?cia zmian."
 
-#: ../griffith:1345
+#: ../griffith:1336
 msgid ""
 "Are you sure you want to create a new database?\n"
 "You will lose ALL your current data!"
@@ -67,7 +67,7 @@
 "Czy na pewno chcesz stworzy? now? baz? film?w?\n"
 "Stracisz WSZYSTKIE aktualne dane!"
 
-#: ../griffith:1348
+#: ../griffith:1339
 msgid ""
 "Last chance!\n"
 "Do you confirm that you want\n"
@@ -76,61 +76,65 @@
 "Ostatnia szansa!\n"
 "Potwierdzasz ch?? usuni?cia aktualnych danych?"
 
-#: ../griffith:1473
+#: ../griffith:1472
 msgid ""
 "This is development version of Griffith.\n"
-"We're not providing upgrade path from dev. versions.\n"
+"Upgrade path from dev. versions may not be provided.\n"
 "Please make sure you have a backup!\n"
 "\n"
 "Do you want to proceed?"
-msgstr ""
+msgstr "To jest werjsa deweloperska programu Griffith.\n"
+"Aktualizacja bazy z wersji deweloperskiej mo?e nie by? dost?pna.\n"
+"Upewnij si?, ?e zrobi?e? kopi? zapasow?!\n"
+"\n"
+"Czy chcesz kontynuowa??"
 
-#: ../lib/about.py:42
+#: ../lib/about.py:40
 msgid "Main Authors"
 msgstr "G??wni autorzy"
 
-#: ../lib/about.py:44
+#: ../lib/about.py:42
 msgid "Programmers"
 msgstr "Programi?ci"
 
-#: ../lib/about.py:47
+#: ../lib/about.py:45
 msgid "Contributors:"
 msgstr "Wsp??pracownicy:"
 
-#: ../lib/about.py:51
+#: ../lib/about.py:49
 msgid "Logo, icon and general artwork "
 msgstr "Logo, ikon? i wi?kszo?? grafik "
 
-#: ../lib/about.py:77
+#: ../lib/about.py:75
 msgid "See TRANSLATORS file"
 msgstr "Zobacz plik TRANSLATORS"
 
-#: ../lib/about.py:85
+#: ../lib/about.py:83
 msgid "This program is released under the GNU"
 msgstr "Ten program zosta? wydany na licencji GNU"
 
-#: ../lib/add.py:54 ../glade/griffith.glade.h:27
+#: ../lib/add.py:52 ../glade/griffith.glade.h:27
 msgid "Add a new movie"
 msgstr "Nowy film"
 
-#: ../lib/add.py:66
+#: ../lib/add.py:64
 msgid "Edit movie"
 msgstr "Edycja w?a?ciwo?ci filmu"
 
-#: ../lib/add.py:135 ../lib/add.py:703 ../lib/cover.py:184
-#: ../lib/main_treeview.py:484
+#: ../lib/add.py:133 ../lib/add.py:701 ../lib/cover.py:182
+#: ../lib/main_treeview.py:476
 msgid " min"
 msgstr " min."
 
-#: ../lib/add.py:144
+#: ../lib/add.py:142
 msgid "Movie information has been updated"
 msgstr "Informacje o filmie zosta?y uaktualnione"
 
-#: ../lib/add.py:271
+#: ../lib/add.py:269
 msgid "No results"
 msgstr "Nie znaleziono pasuj?cych"
 
-#: ../lib/add.py:311 ../lib/add.py:627
+#: ../lib/add.py:309 ../lib/add.py:625
 msgid ""
 "You should fill the original title\n"
 "or the movie title."
@@ -138,15 +142,15 @@
 "Powiniene? wype?ni? pole tytu?u oryginalnego\n"
 "lub pole tytu?u."
 
-#: ../lib/add.py:320
+#: ../lib/add.py:318
 msgid "Url: "
 msgstr "URL: "
 
-#: ../lib/add.py:321
+#: ../lib/add.py:319
 msgid "Language: "
 msgstr "J?zyk: "
 
-#: ../lib/add.py:634 ../lib/add.py:641
+#: ../lib/add.py:632 ../lib/add.py:639
 msgid "Movie with that title already exists, are you sure you want to add?"
 msgstr "Film o takim tytule ju? istnieje w bazie, doda? pomimo to?"
 
@@ -190,273 +194,273 @@
 msgid "not ilike"
 msgstr ""
 
-#: ../lib/advfilter.py:131 ../lib/advfilter.py:139 ../lib/advfilter.py:158
+#: ../lib/advfilter.py:134 ../lib/advfilter.py:142 ../lib/advfilter.py:161
 msgid "ignore"
 msgstr "ignoruj"
 
-#: ../lib/advfilter.py:131
+#: ../lib/advfilter.py:134
 msgid "with"
 msgstr "zawiera"
 
-#: ../lib/advfilter.py:131
+#: ../lib/advfilter.py:134
 msgid "without"
 msgstr "bez"
 
-#: ../lib/advfilter.py:131
+#: ../lib/advfilter.py:134
 msgid "require"
 msgstr "wymagaj"
 
-#: ../lib/advfilter.py:139
+#: ../lib/advfilter.py:142
 msgid "in"
 msgstr "wewn?trz"
 
-#: ../lib/advfilter.py:139
+#: ../lib/advfilter.py:142
 msgid "not in"
 msgstr "nie jest wewn?trz"
 
-#: ../lib/advfilter.py:158
+#: ../lib/advfilter.py:161
 msgid "loaned to "
 msgstr "Wypo?yczony przez"
 
-#: ../lib/advfilter.py:158
+#: ../lib/advfilter.py:161
 msgid "loan history"
 msgstr "z histori? wypo?ycze?"
 
-#: ../lib/advfilter.py:357
+#: ../lib/advfilter.py:360
 msgid "Name is empty"
 msgstr "Nie wype?niono pola z nazw?"
 
-#: ../lib/advfilter.py:361
+#: ../lib/advfilter.py:364
 msgid "Search conditions saved"
 msgstr "Regu?y wyszukiwania zapisane"
 
-#: ../lib/advfilter.py:363
+#: ../lib/advfilter.py:366
 msgid "Cannot save search conditions"
 msgstr "Nie mo?na zapisa? regu? wyszukiwania"
 
-#: ../lib/backup.py:38
+#: ../lib/backup.py:36
 msgid "Save Griffith backup"
 msgstr "Zapisz kopi? bezpiecze?stwa"
 
-#: ../lib/backup.py:47 ../lib/plugins/export/PluginExportCSV.py:66
-#: ../lib/plugins/export/PluginExportiPod.py:113
-#: ../lib/plugins/export/PluginExportPDF.py:88
-#: ../lib/plugins/export/PluginExportXML.py:67
+#: ../lib/backup.py:45 ../lib/plugins/export/PluginExportCSV.py:58
+#: ../lib/plugins/export/PluginExportiPod.py:105
+#: ../lib/plugins/export/PluginExportPDF.py:82
+#: ../lib/plugins/export/PluginExportXML.py:59
 msgid "File exists. Do you want to overwrite it?"
 msgstr "Plik istnieje. Ma zosta? nadpisany?"
 
-#: ../lib/backup.py:61
+#: ../lib/backup.py:59
 msgid "Error creating backup"
 msgstr "B??d tworzenia kopii zapasowej"
 
-#: ../lib/backup.py:68
+#: ../lib/backup.py:66
 msgid "Backup function is available only for SQLite engine for now"
 msgstr ""
 "Funkcja tworzenia kopii zapasowej jest na razie dost?pna tylko dla silnika "
 "SQLite"
 
-#: ../lib/backup.py:111
+#: ../lib/backup.py:109
 msgid "Backup has been created"
 msgstr "Kopia zapasowa zosta?a pomy?lnie utworzona"
 
-#: ../lib/backup.py:115 ../lib/backup.py:187
+#: ../lib/backup.py:113 ../lib/backup.py:183
 msgid "Restore Griffith backup"
 msgstr "Przywr?? dane z kopii bezpiecze?stwa"
 
-#: ../lib/backup.py:123 ../lib/backup.py:203
+#: ../lib/backup.py:121 ../lib/backup.py:199
 msgid "Can't read backup file"
 msgstr "Nie mog? odczyta? pliku z kopi? zapasow?"
 
-#: ../lib/backup.py:178
+#: ../lib/backup.py:174
 msgid "Backup restored"
 msgstr "Odzyskano dane z kopii zapasowej"
 
-#: ../lib/cover.py:45 ../lib/edit.py:51
+#: ../lib/cover.py:43 ../lib/edit.py:48
 msgid "Select image"
 msgstr "Wybierz plakat"
 
-#: ../lib/cover.py:89 ../lib/cover.py:152
+#: ../lib/cover.py:87 ../lib/cover.py:150
 msgid "Cover generated by Griffith v"
 msgstr "Ok?adka stworzona przez Griffith v"
 
-#: ../lib/cover.py:91 ../lib/cover.py:154
-#: ../lib/plugins/export/PluginExportHTML.py:743
-#: ../lib/plugins/export/PluginExportPDF.py:183
+#: ../lib/cover.py:89 ../lib/cover.py:152
+#: ../lib/plugins/export/PluginExportHTML.py:644
+#: ../lib/plugins/export/PluginExportPDF.py:175
 msgid "Released Under the GNU/GPL License"
 msgstr "Wydany na licencji GNU/GPL"
 
-#: ../lib/cover.py:179 ../lib/initialize.py:205 ../lib/initialize.py:628
-#: ../lib/plugins/export/PluginExportHTML.py:149
-#: ../lib/plugins/export/PluginExportHTML.py:333 ../glade/griffith.glade.h:105
+#: ../lib/cover.py:177 ../lib/initialize.py:179 ../lib/initialize.py:598
+#: ../lib/plugins/export/PluginExportHTML.py:146
+#: ../lib/plugins/export/PluginExportHTML.py:321 ../glade/griffith.glade.h:104
 msgid "Original Title"
 msgstr "Tytu? oryginalny"
 
-#: ../lib/cover.py:180 ../lib/initialize.py:212 ../lib/initialize.py:638
-#: ../lib/plugins/export/PluginExportHTML.py:155 ../glade/griffith.glade.h:156
+#: ../lib/cover.py:178 ../lib/initialize.py:186 ../lib/initialize.py:608
+#: ../lib/plugins/export/PluginExportHTML.py:152 ../glade/griffith.glade.h:156
 msgid "Title"
 msgstr "Tytu?"
 
-#: ../lib/cover.py:182 ../lib/initialize.py:219 ../lib/initialize.py:618
-#: ../lib/plugins/export/PluginExportHTML.py:140 ../glade/griffith.glade.h:54
+#: ../lib/cover.py:180 ../lib/initialize.py:193 ../lib/initialize.py:588
+#: ../lib/plugins/export/PluginExportHTML.py:137 ../glade/griffith.glade.h:53
 msgid "Director"
 msgstr "Re?yser"
 
-#: ../lib/cover.py:184
+#: ../lib/cover.py:182
 msgid "Running Time"
 msgstr "Czas trwania"
 
-#: ../lib/cover.py:185 ../lib/initialize.py:617
-#: ../lib/plugins/export/PluginExportHTML.py:139 ../glade/griffith.glade.h:47
+#: ../lib/cover.py:183 ../lib/initialize.py:587
+#: ../lib/plugins/export/PluginExportHTML.py:136 ../glade/griffith.glade.h:45
 msgid "Country"
 msgstr "Kraj"
 
-#: ../lib/cover.py:186 ../lib/initialize.py:226 ../lib/initialize.py:619
-#: ../lib/plugins/export/PluginExportHTML.py:141
-#: ../lib/plugins/export/PluginExportPDF.py:163 ../glade/griffith.glade.h:69
+#: ../lib/cover.py:184 ../lib/initialize.py:200 ../lib/initialize.py:589
+#: ../lib/plugins/export/PluginExportHTML.py:138
+#: ../lib/plugins/export/PluginExportPDF.py:155 ../glade/griffith.glade.h:68
 msgid "Genre"
 msgstr "Gatunek"
 
-#: ../lib/db.py:54
+#: ../lib/db.py:52
 msgid "Name cannot be empty"
 msgstr "Nazwa nie mo?e by? pusta"
 
-#: ../lib/db.py:86
+#: ../lib/db.py:84
 msgid "This name is already in use!"
 msgstr "Ta nazwa jest juz u?ywana!"
 
-#: ../lib/db.py:120
+#: ../lib/db.py:118
 msgid "E-mail address is not valid"
 msgstr "Adres email nie jest prawid?owy"
 
-#: ../lib/dbupgrade.py:81 ../lib/plugins/movie/PluginMovieE-Pipoca.py:35
+#: ../lib/dbupgrade.py:80 ../lib/plugins/movie/PluginMovieE-Pipoca.py:33
 msgid "Brazilian Portuguese"
 msgstr "brazylijsko-portugalski"
 
-#: ../lib/dbupgrade.py:82
+#: ../lib/dbupgrade.py:81
 msgid "Bulgarian"
 msgstr "bu?garski"
 
-#: ../lib/dbupgrade.py:83
+#: ../lib/dbupgrade.py:82
 msgid "Catalan"
 msgstr "katalo?ski"
 
-#: ../lib/dbupgrade.py:84 ../lib/plugins/movie/PluginMovieCSFD.py:31
+#: ../lib/dbupgrade.py:83 ../lib/plugins/movie/PluginMovieCSFD.py:29
 msgid "Czech"
 msgstr "czeski"
 
-#: ../lib/dbupgrade.py:85
+#: ../lib/dbupgrade.py:84
 msgid "Danish"
 msgstr "du?ski"
 
-#: ../lib/dbupgrade.py:86
+#: ../lib/dbupgrade.py:85
 msgid "Dutch"
 msgstr "holenderski"
 
-#: ../lib/dbupgrade.py:87 ../lib/plugins/movie/PluginMovieAniDB.py:33
-#: ../lib/plugins/movie/PluginMovieDVDEmpire.py:33
-#: ../lib/plugins/movie/PluginMovieIMDB.py:32
-#: ../lib/plugins/movie/PluginMovieMediadis.py:17
-#: ../lib/plugins/movie/PluginMovieMoviefone.py:17
+#: ../lib/dbupgrade.py:86 ../lib/plugins/movie/PluginMovieAniDB.py:31
+#: ../lib/plugins/movie/PluginMovieDVDEmpire.py:31
+#: ../lib/plugins/movie/PluginMovieIMDB.py:30
+#: ../lib/plugins/movie/PluginMovieMediadis.py:15
+#: ../lib/plugins/movie/PluginMovieMoviefone.py:15
 msgid "English"
 msgstr "angielski"
 
-#: ../lib/dbupgrade.py:88
+#: ../lib/dbupgrade.py:87
 msgid "Estonian"
 msgstr "esto?ski"
 
-#: ../lib/dbupgrade.py:89 ../lib/plugins/movie/PluginMovieAllocine.py:33
-#: ../lib/plugins/movie/PluginMovieCineMovies.py:32
+#: ../lib/dbupgrade.py:88 ../lib/plugins/movie/PluginMovieAllocine.py:31
+#: ../lib/plugins/movie/PluginMovieCineMovies.py:30
 msgid "French"
 msgstr "francuski"
 
-#: ../lib/dbupgrade.py:90 ../lib/plugins/movie/PluginMovieDVDPalace.py:34
-#: ../lib/plugins/movie/PluginMovieFilmDb.py:33
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:34
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:32
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:34
-#: ../lib/plugins/movie/PluginMovieOFDb.py:18
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:34
+#: ../lib/dbupgrade.py:89 ../lib/plugins/movie/PluginMovieDVDPalace.py:32
+#: ../lib/plugins/movie/PluginMovieFilmDb.py:31
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:32
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:30
+#: ../lib/plugins/movie/PluginMovieKinoDe.py:32
+#: ../lib/plugins/movie/PluginMovieOFDb.py:16
+#: ../lib/plugins/movie/PluginMovieZelluloid.py:32
 msgid "German"
 msgstr "niemiecki"
 
-#: ../lib/dbupgrade.py:91
+#: ../lib/dbupgrade.py:90
 msgid "Greek"
 msgstr "grecki"
 
-#: ../lib/dbupgrade.py:92
+#: ../lib/dbupgrade.py:91
 msgid "Hungarian"
 msgstr "w?gierski"
 
-#: ../lib/dbupgrade.py:93
+#: ../lib/dbupgrade.py:92
 msgid "Indonesian"
 msgstr "indonezyjski"
 
-#: ../lib/dbupgrade.py:94 ../lib/plugins/movie/PluginMovieCinematografo.py:31
+#: ../lib/dbupgrade.py:93 ../lib/plugins/movie/PluginMovieCinematografo.py:29
 msgid "Italian"
 msgstr "w?oski"
 
-#: ../lib/dbupgrade.py:95
+#: ../lib/dbupgrade.py:94
 msgid "Japanese"
 msgstr "japo?ski"
 
-#: ../lib/dbupgrade.py:96
+#: ../lib/dbupgrade.py:95
 msgid "Korean"
 msgstr "korea?ski"
 
-#: ../lib/dbupgrade.py:97
+#: ../lib/dbupgrade.py:96
 msgid "Norwegian Bokmal"
 msgstr "Norweski (Bokmal)"
 
-#: ../lib/dbupgrade.py:98
+#: ../lib/dbupgrade.py:97
 msgid "Occitan"
 msgstr "langwedocki"
 
-#: ../lib/dbupgrade.py:99
+#: ../lib/dbupgrade.py:98
 msgid "Pashto"
 msgstr "paszto"
 
-#: ../lib/dbupgrade.py:100 ../lib/plugins/movie/PluginMovieFDb.py:34
-#: ../lib/plugins/movie/PluginMovieFilmweb.py:32
-#: ../lib/plugins/movie/PluginMovieOnet.py:32
-#: ../lib/plugins/movie/PluginMovieStopklatka.py:32
-#: ../lib/plugins/movie/PluginMovieTanukiAnime.py:32
-#: ../lib/plugins/movie/PluginMovieWP.py:33
+#: ../lib/dbupgrade.py:99 ../lib/plugins/movie/PluginMovieFDb.py:32
+#: ../lib/plugins/movie/PluginMovieFilmweb.py:30
+#: ../lib/plugins/movie/PluginMovieOnet.py:30
+#: ../lib/plugins/movie/PluginMovieStopklatka.py:30
+#: ../lib/plugins/movie/PluginMovieTanukiAnime.py:30
+#: ../lib/plugins/movie/PluginMovieWP.py:31
 msgid "Polish"
 msgstr "polski"
 
-#: ../lib/dbupgrade.py:101 ../lib/plugins/movie/PluginMovie7arte.py:33
-#: ../lib/plugins/movie/PluginMovieCineteka.py:33
-#: ../lib/plugins/movie/PluginMoviePTGate.py:33
+#: ../lib/dbupgrade.py:100 ../lib/plugins/movie/PluginMovie7arte.py:31
+#: ../lib/plugins/movie/PluginMovieCineteka.py:31
+#: ../lib/plugins/movie/PluginMoviePTGate.py:31
 msgid "Portuguese"
 msgstr "portugalski"
 
-#: ../lib/dbupgrade.py:102
+#: ../lib/dbupgrade.py:101
 msgid "Russian"
 msgstr "rosyjski"
 
-#: ../lib/dbupgrade.py:103
+#: ../lib/dbupgrade.py:102
 msgid "Simplified Chinese"
 msgstr "uproszczony chi?ski"
 
-#: ../lib/dbupgrade.py:104
+#: ../lib/dbupgrade.py:103
 msgid "Slovak"
 msgstr "s?owacki"
 
-#: ../lib/dbupgrade.py:105 ../lib/plugins/movie/PluginMovieCulturalia.py:33
-#: ../lib/plugins/movie/PluginMovieFilmAffinity.py:33
-#: ../lib/plugins/movie/PluginMovieIMDB-es.py:33
+#: ../lib/dbupgrade.py:104 ../lib/plugins/movie/PluginMovieCulturalia.py:31
+#: ../lib/plugins/movie/PluginMovieFilmAffinity.py:31
+#: ../lib/plugins/movie/PluginMovieIMDB-es.py:31
 msgid "Spanish"
 msgstr "hiszpa?ski"
 
-#: ../lib/dbupgrade.py:106 ../lib/plugins/movie/PluginMovieFilmtipset.py:34
+#: ../lib/dbupgrade.py:105 ../lib/plugins/movie/PluginMovieFilmtipset.py:32
 msgid "Swedish"
 msgstr "szwedzki"
 
-#: ../lib/dbupgrade.py:107
+#: ../lib/dbupgrade.py:106
 msgid "Turkish"
 msgstr "turecki"
 
-#: ../lib/dbupgrade.py:108
+#: ../lib/dbupgrade.py:107
 msgid "Favourite"
 msgstr "Ulubiony"
 
@@ -480,77 +484,77 @@
 "Twoja baza jest najprawdopodobniej zapisana w formacie SQLite2, skonwertuj "
 "j? prosz? do SQLite3"
 
-#: ../lib/delete.py:41
+#: ../lib/delete.py:39
 msgid "You can't delete movie while it is loaned."
 msgstr "Nie mo?esz usun?? wypo?yczonego filmu!"
 
-#: ../lib/delete.py:44
+#: ../lib/delete.py:42
 msgid "Are you sure you want to delete this movie?"
 msgstr "Czy na pewno chcesz usun?? ten film?"
 
-#: ../lib/edit.py:63
+#: ../lib/edit.py:60
 msgid "Image is not valid."
 msgstr "Obraz nie jest prawid?owy"
 
-#: ../lib/edit.py:94 ../lib/edit.py:120
+#: ../lib/edit.py:91 ../lib/edit.py:117
 msgid "Image has been updated"
 msgstr "Plakat zosta? uaktualniony"
 
-#: ../lib/edit.py:102
+#: ../lib/edit.py:99
 msgid "Are you sure you want to delete this poster?"
 msgstr "Czy na pewno chcesz usun?? ten plakat?"
 
-#: ../lib/edit.py:166 ../lib/edit.py:173
+#: ../lib/edit.py:163 ../lib/edit.py:170
 msgid "No posters found for this movie."
 msgstr "Nie znaleziono plakat?w dla tego filmu."
 
-#: ../lib/edit.py:218 ../lib/movie.py:168
+#: ../lib/edit.py:215 ../lib/movie.py:166
 msgid "Fetching poster"
 msgstr "Pobieram plakat"
 
-#: ../lib/edit.py:218 ../lib/movie.py:125 ../lib/movie.py:143
-#: ../lib/movie.py:168 ../lib/movie.py:265 ../lib/movie.py:286
+#: ../lib/edit.py:215 ../lib/movie.py:123 ../lib/movie.py:141
+#: ../lib/movie.py:166 ../lib/movie.py:263 ../lib/movie.py:284
 msgid "Wait a moment"
 msgstr "Prosz? czeka?"
 
-#: ../lib/edit.py:230
+#: ../lib/edit.py:227
 msgid "Sorry. A connection error has occurred."
 msgstr "Wybacz, wyst?pi? b??d po??czenia."
 
-#: ../lib/edit.py:242 ../lib/edit.py:273
+#: ../lib/edit.py:239 ../lib/edit.py:270
 msgid "Sorry. This movie is listed but has no poster available at Amazon.com."
 msgstr "Wybacz, serwis Amazon.com nie posiada plakatu z tym filmem"
 
-#: ../lib/edit.py:260
+#: ../lib/edit.py:257
 msgid "Do you want to use this poster instead?"
 msgstr "Czy chcesz wykorzysta? ten plakat?"
 
-#: ../lib/gconsole.py:137
+#: ../lib/gconsole.py:151
 msgid "No movie found"
 msgstr "Nie znaleziono film?w"
 
-#: ../lib/gemail.py:40
+#: ../lib/gemail.py:38
 msgid "Connection timed out"
 msgstr "Po??czenie wygas?o"
 
-#: ../lib/gemail.py:51 ../lib/gemail.py:61
+#: ../lib/gemail.py:49 ../lib/gemail.py:59
 #, python-format
 msgid "Error sending e-mail: %s"
 msgstr "B??d podczas wysy?ania e-maila: %s"
 
-#: ../lib/gemail.py:51
+#: ../lib/gemail.py:49
 msgid "login failure"
 msgstr "b??d logowania"
 
-#: ../lib/gemail.py:58
+#: ../lib/gemail.py:56
 msgid "E-mail sent sucessfuly"
 msgstr "E-mail zosta? pomy?lnie wys?any"
 
-#: ../lib/gemail.py:78
+#: ../lib/gemail.py:76
 msgid "Movie loan reminder"
 msgstr "Przypomnienie o wypo?yczonym filmie"
 
-#: ../lib/gemail.py:78
+#: ../lib/gemail.py:76
 #, python-format
 msgid ""
 "Hi, %s!\n"
@@ -561,286 +565,286 @@
 "\n"
 "Przypominam, ?e "
 
-#: ../lib/gemail.py:84
+#: ../lib/gemail.py:82
 msgid "Mail could not be sent. Please check e-mail preferences."
 msgstr "Mail nie m?g? zosta? wys?any. Sprawd? ustawienia."
 
-#: ../lib/gemail.py:86
+#: ../lib/gemail.py:84
 msgid "This person has no e-mail address defined."
 msgstr "Ta osoba nie posiada zdefiniowano adresu e-mail."
 
-#: ../lib/gutils.py:286
+#: ../lib/gutils.py:284
 msgid "Images"
 msgstr "Pliki graficzne"
 
-#: ../lib/gutils.py:297 ../lib/plugins/imp/__init__.py:221
+#: ../lib/gutils.py:295 ../lib/plugins/imp/__init__.py:219
 msgid "All files"
 msgstr "Wszystkie pliki"
 
-#: ../lib/initialize.py:192
+#: ../lib/initialize.py:166
 msgid "N."
 msgstr "#"
 
-#: ../lib/initialize.py:199 ../lib/initialize.py:620
-#: ../lib/plugins/export/PluginExportHTML.py:142 ../glade/griffith.glade.h:76
+#: ../lib/initialize.py:173 ../lib/initialize.py:590
+#: ../lib/plugins/export/PluginExportHTML.py:139 ../glade/griffith.glade.h:75
 msgid "Image"
 msgstr "Plakat"
 
-#: ../lib/initialize.py:233 ../lib/initialize.py:635
-#: ../lib/plugins/export/PluginExportHTML.py:154 ../glade/griffith.glade.h:136
+#: ../lib/initialize.py:207 ../lib/initialize.py:605
+#: ../lib/plugins/export/PluginExportHTML.py:151 ../glade/griffith.glade.h:136
 msgid "Seen it"
 msgstr "Obejrzany"
 
-#: ../lib/initialize.py:241 ../lib/initialize.py:642
-#: ../lib/plugins/export/PluginExportHTML.py:156 ../glade/griffith.glade.h:170
+#: ../lib/initialize.py:215 ../lib/initialize.py:612
+#: ../lib/plugins/export/PluginExportHTML.py:153 ../glade/griffith.glade.h:170
 msgid "Year"
 msgstr "Rok"
 
-#: ../lib/initialize.py:250 ../lib/initialize.py:633
-#: ../lib/plugins/export/PluginExportHTML.py:152 ../glade/griffith.glade.h:131
+#: ../lib/initialize.py:224 ../lib/initialize.py:603
+#: ../lib/plugins/export/PluginExportHTML.py:149 ../glade/griffith.glade.h:131
 msgid "Runtime"
 msgstr "Czas trwania"
 
-#: ../lib/initialize.py:259 ../lib/initialize.py:631
-#: ../lib/plugins/export/PluginExportHTML.py:151 ../glade/griffith.glade.h:121
+#: ../lib/initialize.py:233 ../lib/initialize.py:601
+#: ../lib/plugins/export/PluginExportHTML.py:148 ../glade/griffith.glade.h:120
 msgid "Rating"
 msgstr "Ocena"
 
-#: ../lib/initialize.py:311
+#: ../lib/initialize.py:285
 msgid "Loan Date"
 msgstr "Wypo?yczono"
 
-#: ../lib/initialize.py:317
+#: ../lib/initialize.py:291
 msgid "Return Date"
 msgstr "Zwr?cono"
 
-#: ../lib/initialize.py:322
+#: ../lib/initialize.py:296
 msgid "Loaned To"
 msgstr "Wypo?yczony przez"
 
-#: ../lib/initialize.py:341 ../lib/plugins/movie/PluginMovieIMDB-de.py:183
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:332
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:379
-#: ../lib/plugins/movie/PluginMovieIMDB.py:161
+#: ../lib/initialize.py:315 ../lib/plugins/movie/PluginMovieIMDB-de.py:181
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:330
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:377
+#: ../lib/plugins/movie/PluginMovieIMDB.py:159
 msgid "Language"
 msgstr "J?zyk"
 
-#: ../lib/initialize.py:353 ../lib/initialize.py:645
+#: ../lib/initialize.py:327 ../lib/initialize.py:615
 msgid "lector"
 msgstr "lektor"
 
-#: ../lib/initialize.py:354 ../lib/initialize.py:645
+#: ../lib/initialize.py:328 ../lib/initialize.py:615
 msgid "dubbing"
 msgstr "dubbing"
 
-#: ../lib/initialize.py:356 ../lib/initialize.py:645
+#: ../lib/initialize.py:330 ../lib/initialize.py:615
 msgid "commentary"
 msgstr "komentarz"
 
-#: ../lib/initialize.py:363 ../glade/griffith.glade.h:159
+#: ../lib/initialize.py:337 ../glade/griffith.glade.h:159
 msgid "Type"
 msgstr "Typ"
 
-#: ../lib/initialize.py:378
+#: ../lib/initialize.py:352
 msgid "Codec"
 msgstr "Kodek"
 
-#: ../lib/initialize.py:393
+#: ../lib/initialize.py:367
 msgid "Channels"
 msgstr "Kana?y"
 
-#: ../lib/initialize.py:408
+#: ../lib/initialize.py:382
 msgid "Subtitle format"
 msgstr "Format napis?w"
 
-#: ../lib/initialize.py:524 ../glade/griffith.glade.h:98
+#: ../lib/initialize.py:498 ../glade/griffith.glade.h:96
 msgid "Name"
 msgstr "Imi?"
 
-#: ../lib/initialize.py:530 ../glade/exporthtml.glade.h:16
-#: ../glade/griffith.glade.h:56 ../glade/import.glade.h:5
+#: ../lib/initialize.py:504 ../glade/exporthtml.glade.h:15
+#: ../glade/griffith.glade.h:55 ../glade/import.glade.h:5
 msgid "E-mail"
 msgstr "E-mail"
 
-#: ../lib/initialize.py:578
+#: ../lib/initialize.py:552
 msgid "Last added"
 msgstr "Ostatnio dodane"
 
-#: ../lib/initialize.py:611 ../lib/plugins/export/PluginExportHTML.py:137
-#: ../lib/plugins/export/PluginExportPDF.py:169 ../glade/griffith.glade.h:39
+#: ../lib/initialize.py:581 ../lib/plugins/export/PluginExportHTML.py:134
+#: ../lib/plugins/export/PluginExportPDF.py:161 ../glade/griffith.glade.h:37
 msgid "Cast"
 msgstr "Obsada"
 
-#: ../lib/initialize.py:612 ../glade/griffith.glade.h:38
+#: ../lib/initialize.py:582 ../glade/griffith.glade.h:36
 msgid "Cameraman"
 msgstr "Operator kamery"
 
-#: ../lib/initialize.py:613 ../lib/plugins/export/PluginExportHTML.py:138
-#: ../glade/griffith.glade.h:41
+#: ../lib/initialize.py:583 ../lib/plugins/export/PluginExportHTML.py:135
+#: ../glade/griffith.glade.h:39
 msgid "Classification"
 msgstr "Klasyfikacja"
 
-#: ../lib/initialize.py:614 ../lib/plugins/export/PluginExportHTML.py:165
-#: ../glade/griffith.glade.h:44
+#: ../lib/initialize.py:584 ../lib/plugins/export/PluginExportHTML.py:162
+#: ../glade/griffith.glade.h:42
 msgid "Collection"
 msgstr "Kolekcja"
 
-#: ../lib/initialize.py:615 ../lib/initialize.py:644
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:187
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:334
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:381
-#: ../lib/plugins/movie/PluginMovieIMDB.py:165 ../glade/griffith.glade.h:45
+#: ../lib/initialize.py:585 ../lib/initialize.py:614
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:185
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:332
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:379
+#: ../lib/plugins/movie/PluginMovieIMDB.py:163 ../glade/griffith.glade.h:43
 msgid "Color"
 msgstr "Kolor"
 
-#: ../lib/initialize.py:616 ../glade/griffith.glade.h:46
+#: ../lib/initialize.py:586 ../glade/griffith.glade.h:44
 msgid "Condition"
 msgstr "Stan"
 
-#: ../lib/initialize.py:621 ../glade/griffith.glade.h:80
+#: ../lib/initialize.py:591 ../glade/griffith.glade.h:79
 msgid "Layers"
 msgstr "Warstwy"
 
-#: ../lib/initialize.py:622 ../lib/plugins/export/PluginExportHTML.py:146
+#: ../lib/initialize.py:592 ../lib/plugins/export/PluginExportHTML.py:143
 msgid "Loaned"
 msgstr "Wypo?yczony"
 
-#: ../lib/initialize.py:623 ../lib/plugins/export/PluginExportHTML.py:147
-#: ../glade/griffith.glade.h:55
+#: ../lib/initialize.py:593 ../lib/plugins/export/PluginExportHTML.py:144
+#: ../glade/griffith.glade.h:54
 msgid "Discs"
 msgstr "Dyski"
 
-#: ../lib/initialize.py:624 ../glade/griffith.glade.h:93
+#: ../lib/initialize.py:594 ../glade/griffith.glade.h:91
 msgid "Medium"
 msgstr "Media"
 
-#: ../lib/initialize.py:625 ../lib/plugins/export/PluginExportHTML.py:157
-#: ../glade/griffith.glade.h:101
+#: ../lib/initialize.py:595 ../lib/plugins/export/PluginExportHTML.py:154
+#: ../glade/griffith.glade.h:100
 msgid "Notes"
 msgstr "Notatki"
 
-#: ../lib/initialize.py:626 ../lib/plugins/export/PluginExportHTML.py:148
-#: ../glade/griffith.glade.h:102
+#: ../lib/initialize.py:596 ../lib/plugins/export/PluginExportHTML.py:145
+#: ../glade/griffith.glade.h:101
 msgid "Number"
 msgstr "Numer"
 
-#: ../lib/initialize.py:627 ../lib/plugins/export/PluginExportHTML.py:143
-#: ../glade/griffith.glade.h:103
+#: ../lib/initialize.py:597 ../lib/plugins/export/PluginExportHTML.py:140
+#: ../glade/griffith.glade.h:102
 msgid "Official site"
 msgstr "Strona oficjalna"
 
-#: ../lib/initialize.py:629 ../lib/plugins/export/PluginExportHTML.py:150
-#: ../glade/griffith.glade.h:113
+#: ../lib/initialize.py:599 ../lib/plugins/export/PluginExportHTML.py:147
+#: ../glade/griffith.glade.h:112
 msgid "Plot"
 msgstr "Fabu?a"
 
-#: ../lib/initialize.py:630 ../glade/griffith.glade.h:33
+#: ../lib/initialize.py:600 ../glade/griffith.glade.h:33
 msgid "Aspect ratio"
 msgstr ""
 
-#: ../lib/initialize.py:632 ../glade/griffith.glade.h:123
+#: ../lib/initialize.py:602 ../glade/griffith.glade.h:122
 msgid "Region"
 msgstr "Region"
 
-#: ../lib/initialize.py:634 ../glade/griffith.glade.h:134
+#: ../lib/initialize.py:604 ../glade/griffith.glade.h:134
 msgid "Screenplay"
 msgstr "Scenarisz"
 
-#: ../lib/initialize.py:636 ../lib/plugins/export/PluginExportHTML.py:144
+#: ../lib/initialize.py:606 ../lib/plugins/export/PluginExportHTML.py:141
 #: ../glade/griffith.glade.h:145
 msgid "Site"
 msgstr "Strona"
 
-#: ../lib/initialize.py:637 ../lib/plugins/export/PluginExportHTML.py:153
+#: ../lib/initialize.py:607 ../lib/plugins/export/PluginExportHTML.py:150
 #: ../glade/griffith.glade.h:151
 msgid "Studio"
 msgstr "Studio"
 
-#: ../lib/initialize.py:639 ../lib/plugins/export/PluginExportHTML.py:145
+#: ../lib/initialize.py:609 ../lib/plugins/export/PluginExportHTML.py:142
 #: ../glade/griffith.glade.h:158
 msgid "Trailer"
 msgstr "Zwiastun"
 
-#: ../lib/initialize.py:640 ../lib/plugins/export/PluginExportHTML.py:168
+#: ../lib/initialize.py:610 ../lib/plugins/export/PluginExportHTML.py:165
 #: ../glade/griffith.glade.h:165
 msgid "Video codec"
 msgstr "Kodek video"
 
-#: ../lib/initialize.py:641 ../lib/plugins/export/PluginExportHTML.py:166
+#: ../lib/initialize.py:611 ../lib/plugins/export/PluginExportHTML.py:163
 #: ../glade/griffith.glade.h:168
 msgid "Volume"
 msgstr "Wolumin"
 
-#: ../lib/initialize.py:643 ../lib/initialize.py:644 ../lib/initialize.py:646
-#: ../lib/initialize.py:888 ../lib/initialize.py:889 ../lib/initialize.py:921
-#: ../lib/initialize.py:922
+#: ../lib/initialize.py:613 ../lib/initialize.py:614 ../lib/initialize.py:616
+#: ../lib/initialize.py:851 ../lib/initialize.py:852 ../lib/initialize.py:884
+#: ../lib/initialize.py:885
 msgid "N/A"
 msgstr "brak danych"
 
-#: ../lib/initialize.py:643
+#: ../lib/initialize.py:613
 msgid "Damaged"
 msgstr "Uszkodzony"
 
-#: ../lib/initialize.py:643
+#: ../lib/initialize.py:613
 msgid "Poor"
 msgstr "Kiepski"
 
-#: ../lib/initialize.py:643
+#: ../lib/initialize.py:613
 msgid "Fair"
 msgstr "Zadowalaj?cy"
 
-#: ../lib/initialize.py:643
+#: ../lib/initialize.py:613
 msgid "Good"
 msgstr "Dobry"
 
-#: ../lib/initialize.py:643
+#: ../lib/initialize.py:613
 msgid "Excellent"
 msgstr "?wietny"
 
-#: ../lib/initialize.py:644
+#: ../lib/initialize.py:614
 msgid "Black and White"
 msgstr "Czarno-bia?y"
 
-#: ../lib/initialize.py:644
+#: ../lib/initialize.py:614
 msgid "Mixed"
 msgstr "Mieszany"
 
-#: ../lib/initialize.py:646
+#: ../lib/initialize.py:616
 msgid "Single Side, Single Layer"
 msgstr "Jednostronny, jednowarstwowy"
 
-#: ../lib/initialize.py:646
+#: ../lib/initialize.py:616
 msgid "Single Side, Dual Layer"
 msgstr "Jednostronny, dwuwarstwowy"
 
-#: ../lib/initialize.py:646
+#: ../lib/initialize.py:616
 msgid "Dual Side, Single Layer"
 msgstr "Dwustronny, jednowarstwowy"
 
-#: ../lib/initialize.py:646
+#: ../lib/initialize.py:616
 msgid "Dual Side, Dual Layer"
 msgstr "Dwustronny, dwuwarstwowy"
 
-#: ../lib/initialize.py:648
+#: ../lib/initialize.py:618
 msgid "Region 0 (No Region Coding)"
 msgstr "Region 0 (Brak kodowania regionu)"
 
-#: ../lib/initialize.py:649
+#: ../lib/initialize.py:619
 msgid "Region 1 (United States of America, Canada)"
 msgstr "Region 1 (Stany Zjednoczone Ameryki i Kanada)"
 
-#: ../lib/initialize.py:650
+#: ../lib/initialize.py:620
 msgid ""
 "Region 2 (Europe,including France, Greece, Turkey, Egypt, Arabia, Japan and "
 "South Africa)"
 msgstr ""
 "Region 2 (Europa wraz z Turcj?, Egiptem, Arabi?, Japoni? i po?udniow? Afryk?)"
 
-#: ../lib/initialize.py:651
+#: ../lib/initialize.py:621
 msgid "Region 3 (Korea, Thailand, Vietnam, Borneo and Indonesia)"
 msgstr "Region 3 (Korea, Tajlandia, Wietnam, Borneo oraz Indonezja)"
 
-#: ../lib/initialize.py:652
+#: ../lib/initialize.py:622
 msgid ""
 "Region 4 (Australia and New Zealand, Mexico, the Caribbean, and South "
 "America)"
@@ -848,86 +852,87 @@
 "Region 4 (Australia wraz z Now? Zelandi?, Meksyk, Karaiby, poludniowa "
 "Ameryka)"
 
-#: ../lib/initialize.py:653
+#: ../lib/initialize.py:623
 msgid "Region 5 (India, Africa, Russia and former USSR countries)"
 msgstr "Region 5 (Indje, Afryka, Rosja i by?e republiki radzieckie)"
 
-#: ../lib/initialize.py:654
+#: ../lib/initialize.py:624
 msgid "Region 6 (Popular Republic of China)"
 msgstr "Region 6 (Republika Chinska)"
 
-#: ../lib/initialize.py:655
+#: ../lib/initialize.py:625
 msgid "Region 7 (Reserved for Unspecified Special Use)"
 msgstr "Region 7 (Zarezerwowany dla u?ytku specjalnego)"
 
-#: ../lib/initialize.py:656
+#: ../lib/initialize.py:626
 msgid "Region 8 (Airlines/Cruise Ships)"
 msgstr "Region 8 (Linie lotnicze i morskie)"
 
-#: ../lib/initialize.py:693
+#: ../lib/initialize.py:663
 msgid "Dictionary not available. Spellcheck will be disabled. \n"
 msgstr "S?ownik nie jest dost?pny. Sprawdzanie pisowni zostanie wy??czone. \n"
 
-#: ../lib/loan.py:45
+#: ../lib/loan.py:43
 msgid "No person is defined yet."
 msgstr "Nie zdefiniowano jeszcze ?adnej osoby"
 
-#: ../lib/loan.py:72
+#: ../lib/loan.py:70
 msgid "Do you want to loan whole collection?"
 msgstr "Czy chcesz wypo?yczy? ca?? kolekcj??"
 
-#: ../lib/loan.py:80
+#: ../lib/loan.py:78
 msgid ""
 "Collection contains loaned movie.\n"
 "Loan aborted!"
-msgstr ""
+msgstr "Kolekcja zawiera wypo?yczone filmy.\n"
+"Operacja przerwana!"
 
-#: ../lib/loan.py:83
+#: ../lib/loan.py:81
 msgid "Movie loaned"
 msgstr "Film wypo?yczono"
 
-#: ../lib/main_treeview.py:259
+#: ../lib/main_treeview.py:258
 msgid "This movie has been loaned to "
 msgstr "Film zosta? wypo?yczony przez "
 
-#: ../lib/main_treeview.py:259
+#: ../lib/main_treeview.py:258
 msgid " on "
 msgstr " dnia "
 
-#: ../lib/main_treeview.py:270
+#: ../lib/main_treeview.py:269
 msgid "Movie not loaned"
 msgstr "Film dost?pny"
 
-#: ../lib/movie.py:125 ../lib/movie.py:143
+#: ../lib/movie.py:123 ../lib/movie.py:141
 msgid "Fetching data"
 msgstr "Pobieram dane"
 
-#: ../lib/movie.py:265 ../lib/movie.py:286
+#: ../lib/movie.py:263 ../lib/movie.py:284
 msgid "Searching"
 msgstr "Szukam"
 
-#: ../lib/movie.py:320 ../lib/plugins/movie/PluginMovieAmazon.py:345
-#: ../lib/plugins/movie/PluginMovieAmazon.py:359
+#: ../lib/movie.py:318 ../lib/plugins/movie/PluginMovieAmazon.py:343
+#: ../lib/plugins/movie/PluginMovieAmazon.py:357
 msgid "Connection error"
 msgstr "B??d po??czenia"
 
-#: ../lib/movie.py:361
+#: ../lib/movie.py:359
 msgid "Cancel"
 msgstr "Anuluj"
 
-#: ../lib/people.py:73
+#: ../lib/people.py:71
 msgid "You should fill the person name"
 msgstr "Powiniene? wype?ni? pole osoby"
 
-#: ../lib/people.py:112
+#: ../lib/people.py:110
 msgid "Record updated"
 msgstr "Rekord uaktualniony"
 
-#: ../lib/people.py:135
+#: ../lib/people.py:133
 msgid "This person has loaned films from you. Return them first."
 msgstr "Ta osoba posiada wypo?yczone filmy. Nale?y je najpierw zwr?ci?."
 
-#: ../lib/people.py:140
+#: ../lib/people.py:138
 msgid ""
 "This person has data in the loan history. This data will be erased if you "
 "continue."
@@ -935,7 +940,7 @@
 "W historii wypo?ycze? znajduj? si? wpisy dotycz?ce tej osoby. Kontynuacja "
 "spowoduje utrat? tych danych."
 
-#: ../lib/people.py:141
+#: ../lib/people.py:139
 #, python-format
 msgid ""
 "%s\n"
@@ -944,7 +949,7 @@
 "%s\n"
 "Jeste? pewien, ?e chcesz usun?? t? osob??"
 
-#: ../lib/sql.py:110
+#: ../lib/sql.py:108
 msgid ""
 "Cannot connect to database.\n"
 "Falling back to SQLite."
@@ -952,37 +957,41 @@
 "Nie mog? po??czy? si? z baz?.\n"
 "Przywr?cono ustawienia SQLite."
 
-#: ../lib/sql.py:110
+#: ../lib/sql.py:108
 msgid "Please check debug output for more informations."
 msgstr "Wi?cej informacji jest dost?pnych w trybie debuggowania."
 
-#: ../lib/sql.py:124
+#: ../lib/sql.py:122
 msgid "Database connection failed."
 msgstr "Po??czenie z baz? nie mo?e by? ustanowione."
 
-#: ../lib/version.py:31
+#: ../lib/sql.py:152
+msgid "This database requires newer version of Griffith."
+msgstr "Ta wersja bazy wymaga nowszej wersji Griffitha."
+
+#: ../lib/version.py:29
 msgid "Griffith is a film collection manager."
 msgstr "Griffith jest programem zarz?dzaj?cym zbiorem film?w."
 
-#: ../lib/view.py:31
+#: ../lib/view.py:28
 msgid "Filter activated. Showing only not seen movies."
 msgstr "Filtr aktywny. Pokazuj? tylko nieobejrzane filmy."
 
-#: ../lib/view.py:35
+#: ../lib/view.py:32
 msgid "Filter activated. Showing only loaned movies."
 msgstr "Filtr aktywny. Pokazuj? tylko wypo?yczone filmy."
 
-#: ../lib/view.py:45
+#: ../lib/view.py:42
 #, python-format
 msgid "Filter activated. Showing only movies from volume: %s"
 msgstr "Filtr aktywny. Pokazuj? tylko filmy z woluminu: %s"
 
-#: ../lib/view.py:52
+#: ../lib/view.py:49
 #, python-format
 msgid "Filter activated. Showing only movies from collection: %s"
 msgstr "Filtr aktywny. Pokazuj? tylko filmy z kolekcji: %s"
 
-#: ../lib/widgets.py:352
+#: ../lib/widgets.py:348
 msgid ""
 "Define here the PDF reader you want to use within Griffith. Popular choices "
 "are xpdf, gpdf, evince or kpdf. Make sure you have this program installed "
@@ -992,7 +1001,7 @@
 "generowanych ok?adek. Popularnymi wybiorami s?: xpdf, gpdf, evince oraz "
 "kpdf. Upewnij si?, ?e wskazany program jest zainstalowany i dzia?a."
 
-#: ../lib/widgets.py:353
+#: ../lib/widgets.py:349
 msgid ""
 "Here you can define the desired language to use while spell checking some "
 "fields. Use you locale setting. For example, to use european portuguese "
@@ -1001,7 +1010,7 @@
 "Tutaj mo?esz wskaza? j?zyki, w kt?rych ma by? sprawdzana pisownia. U?yj "
 "oznacze? uniksowych, np. 'pl' aby pola sprawdzane by?y w j?zyku polskim."
 
-#: ../lib/widgets.py:354
+#: ../lib/widgets.py:350
 msgid ""
 "Use this entry to define the SMTP server you want to use to send e-mails. On "
 "*nix systems, 'localhost' should work. Alternatively, you can use your "
@@ -1012,7 +1021,7 @@
 "Wzgl?dnie mo?esz wpisa? adres SMTP zdalnego serwera obs?uguj?cego wysy?anie "
 "poczty."
 
-#: ../lib/widgets.py:355
+#: ../lib/widgets.py:351
 msgid ""
 "This is the from e-mail address that should be used to all outgoing e-mail. "
 "You want to include your own e-mail address here probably."
@@ -1020,7 +1029,7 @@
 "W to miejsce wpisz adres e-mail nadawcy wysy?anych list?w. Dobrym "
 "rozwi?zaniem jest wpisanie tu w?asnego adresu e-mail."
 
-#: ../lib/widgets.py:356
+#: ../lib/widgets.py:352
 msgid ""
 "Here you can define the smtp server port to use. If you want to use your "
 "gmail account service to send e-mails, try to enter '587' here. Default (and "
@@ -1029,7 +1038,7 @@
 "Tutaj mo?esz zdefiniowa? port serwera SMTP. Je?eli chcesz u?y? konto "
 "gmailowe, wpisz tutaj '587'. Domy?lna (i najcz??ciej u?ywana) warto?? to '25'"
 
-#: ../lib/widgets.py:357
+#: ../lib/widgets.py:353
 msgid ""
 "If you need TLS support, please check this checkbox. This is needed, for "
 "example, when using gmail service to send your reminder e-mails."
@@ -1037,36 +1046,38 @@
 "Je?eli po??czenie wymaga TLS, zaznacz to pole. Zaznacz je?eli korzystasz z "
 "gmail."
 
-#: ../lib/plugins/movie/PluginMovieAmazon.py:41
+#: ../lib/plugins/movie/PluginMovieAmazon.py:39
 msgid "International"
-msgstr ""
+msgstr "mi?dzynarodowy"
 
-#: ../lib/plugins/movie/PluginMovieCinematografo.py:94
-#: ../lib/plugins/movie/PluginMovieFDb.py:107
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:86
+#: ../lib/plugins/movie/PluginMovieCinematografo.py:92
+#: ../lib/plugins/movie/PluginMovieFDb.py:105
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:84
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:183
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:184
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:185
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:186
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:187
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:188
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:189
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:190
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:191
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:208
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:209
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:210
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:211
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:212
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:213
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:214
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:215
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:216
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:217
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:234
+#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:235
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:236
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:237
 #: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:238
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:239
-#: ../lib/plugins/movie/PluginMovieFilmeVonAZ.py:240
-#: ../lib/plugins/movie/PluginMovieFilmweb.py:107
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:113
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:114
+#: ../lib/plugins/movie/PluginMovieFilmweb.py:105
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:111
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:112
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:259
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:260
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:261
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:262
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:263
@@ -1121,14 +1132,14 @@
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:312
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:313
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:314
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:315
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:316
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:317
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:318
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:319
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:320
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:321
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:322
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:323
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:343
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:344
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:345
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:346
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:347
@@ -1137,43 +1148,43 @@
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:350
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:351
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:352
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:353
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:354
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:360
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:361
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:358
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:359
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:365
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:366
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:367
 #: ../lib/plugins/movie/PluginMovieIMDB-de.py:368
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:369
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:370
-#: ../lib/plugins/movie/PluginMovieIMDB-es.py:102
-#: ../lib/plugins/movie/PluginMovieIMDB.py:98
-#: ../lib/plugins/movie/PluginMovieIMDB.py:99
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:159
+#: ../lib/plugins/movie/PluginMovieIMDB-es.py:100
+#: ../lib/plugins/movie/PluginMovieIMDB.py:96
+#: ../lib/plugins/movie/PluginMovieIMDB.py:97
+#: ../lib/plugins/movie/PluginMovieKinoDe.py:157
+#: ../lib/plugins/movie/PluginMovieKinoDe.py:319
+#: ../lib/plugins/movie/PluginMovieKinoDe.py:320
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:321
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:322
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:323
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:324
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:325
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:326
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:327
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:328
+#: ../lib/plugins/movie/PluginMovieKinoDe.py:396
+#: ../lib/plugins/movie/PluginMovieKinoDe.py:397
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:398
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:399
 #: ../lib/plugins/movie/PluginMovieKinoDe.py:400
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:401
-#: ../lib/plugins/movie/PluginMovieKinoDe.py:402
-#: ../lib/plugins/movie/PluginMovieOFDb.py:84
+#: ../lib/plugins/movie/PluginMovieOFDb.py:82
+#: ../lib/plugins/movie/PluginMovieOFDb.py:169
+#: ../lib/plugins/movie/PluginMovieOFDb.py:170
 #: ../lib/plugins/movie/PluginMovieOFDb.py:171
-#: ../lib/plugins/movie/PluginMovieOFDb.py:172
-#: ../lib/plugins/movie/PluginMovieOFDb.py:173
-#: ../lib/plugins/movie/PluginMovieOFDb.py:223
+#: ../lib/plugins/movie/PluginMovieOFDb.py:221
+#: ../lib/plugins/movie/PluginMovieOFDb.py:284
+#: ../lib/plugins/movie/PluginMovieOFDb.py:285
 #: ../lib/plugins/movie/PluginMovieOFDb.py:286
-#: ../lib/plugins/movie/PluginMovieOFDb.py:287
-#: ../lib/plugins/movie/PluginMovieOFDb.py:288
-#: ../lib/plugins/movie/PluginMovieOnet.py:103
+#: ../lib/plugins/movie/PluginMovieOnet.py:101
+#: ../lib/plugins/movie/PluginMovieWP.py:95
 #: ../lib/plugins/movie/PluginMovieWP.py:97
-#: ../lib/plugins/movie/PluginMovieWP.py:99
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:105
+#: ../lib/plugins/movie/PluginMovieZelluloid.py:103
+#: ../lib/plugins/movie/PluginMovieZelluloid.py:200
+#: ../lib/plugins/movie/PluginMovieZelluloid.py:201
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:202
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:203
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:204
@@ -1184,8 +1195,8 @@
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:209
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:210
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:211
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:212
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:213
+#: ../lib/plugins/movie/PluginMovieZelluloid.py:230
+#: ../lib/plugins/movie/PluginMovieZelluloid.py:231
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:232
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:233
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:234
@@ -1209,18 +1220,16 @@
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:252
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:253
 #: ../lib/plugins/movie/PluginMovieZelluloid.py:254
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:255
-#: ../lib/plugins/movie/PluginMovieZelluloid.py:256
 msgid " as "
 msgstr " jako "
 
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:185
-#: ../lib/plugins/movie/PluginMovieIMDB.py:163 ../glade/griffith.glade.h:4
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:183
+#: ../lib/plugins/movie/PluginMovieIMDB.py:161 ../glade/griffith.glade.h:4
 msgid "<b>Audio</b>"
 msgstr "<b>?cie?ka d?wi?kowa</b>"
 
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:333
-#: ../lib/plugins/movie/PluginMovieIMDB-de.py:380
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:331
+#: ../lib/plugins/movie/PluginMovieIMDB-de.py:378
 msgid "Audio"
 msgstr "D?wi?k"
 
@@ -1228,17 +1237,17 @@
 msgid "Full CSV list export plugin"
 msgstr "Wtyczka eksportu pe?nej listy CSV"
 
-#: ../lib/plugins/export/PluginExportCSV.py:55
-#: ../lib/plugins/export/PluginExportCSV.py:58
-#: ../lib/plugins/export/PluginExportiPod.py:108
-#: ../lib/plugins/export/PluginExportXML.py:56
-#: ../lib/plugins/export/PluginExportXML.py:59
+#: ../lib/plugins/export/PluginExportCSV.py:47
+#: ../lib/plugins/export/PluginExportCSV.py:50
+#: ../lib/plugins/export/PluginExportiPod.py:100
+#: ../lib/plugins/export/PluginExportXML.py:48
+#: ../lib/plugins/export/PluginExportXML.py:51
 #, python-format
 msgid "Export a %s document"
 msgstr "Eksport do dokumentu %s"
 
-#: ../lib/plugins/export/PluginExportCSV.py:81
-#: ../lib/plugins/export/PluginExportXML.py:99
+#: ../lib/plugins/export/PluginExportCSV.py:73
+#: ../lib/plugins/export/PluginExportXML.py:95
 #, python-format
 msgid "%s file has been created."
 msgstr "Utworzono dokument %s."
@@ -1247,32 +1256,32 @@
 msgid "Plugin exports data using templates"
 msgstr "Wtyczka eksportuje dane u?ywaj?c szablon?w"
 
-#: ../lib/plugins/export/PluginExportHTML.py:52
+#: ../lib/plugins/export/PluginExportHTML.py:51
 msgid "Griffith's movies list"
 msgstr "Lista film?w Griffitha"
 
-#: ../lib/plugins/export/PluginExportHTML.py:164 ../glade/griffith.glade.h:92
+#: ../lib/plugins/export/PluginExportHTML.py:161 ../glade/griffith.glade.h:90
 msgid "Media"
 msgstr "Media"
 
-#: ../lib/plugins/export/PluginExportHTML.py:509
-#: ../lib/plugins/export/PluginExportHTML.py:511
+#: ../lib/plugins/export/PluginExportHTML.py:459
+#: ../lib/plugins/export/PluginExportHTML.py:461
 msgid "previous"
 msgstr "poprzednia"
 
-#: ../lib/plugins/export/PluginExportHTML.py:522
-#: ../lib/plugins/export/PluginExportHTML.py:524
+#: ../lib/plugins/export/PluginExportHTML.py:472
+#: ../lib/plugins/export/PluginExportHTML.py:474
 msgid "next"
 msgstr "nast?pna"
 
-#: ../lib/plugins/export/PluginExportHTML.py:649
-#: ../lib/plugins/export/PluginExportHTML.py:690
-#: ../lib/plugins/export/PluginExportHTML.py:787
+#: ../lib/plugins/export/PluginExportHTML.py:550
+#: ../lib/plugins/export/PluginExportHTML.py:591
+#: ../lib/plugins/export/PluginExportHTML.py:688
 #, python-format
 msgid "Can't create %s!"
 msgstr "Nie mog? utworzy? %s!"
 
-#: ../lib/plugins/export/PluginExportHTML.py:679
+#: ../lib/plugins/export/PluginExportHTML.py:580
 #, python-format
 msgid ""
 "Directory %s already exists.\n"
@@ -1281,56 +1290,56 @@
 "Katalog %s ju? istnieje.\n"
 "Ma zosta? nadpisany?"
 
-#: ../lib/plugins/export/PluginExportHTML.py:683
+#: ../lib/plugins/export/PluginExportHTML.py:584
 #, python-format
 msgid "Can't remove %s!"
 msgstr "Nie mo?na usun?? %s!"
 
-#: ../lib/plugins/export/PluginExportHTML.py:698
-#: ../lib/plugins/export/PluginExportHTML.py:711
+#: ../lib/plugins/export/PluginExportHTML.py:599
+#: ../lib/plugins/export/PluginExportHTML.py:612
 #, python-format
 msgid "Can't copy %s!"
 msgstr "Nie mo?na skopiowa? %s!"
 
-#: ../lib/plugins/export/PluginExportHTML.py:733
+#: ../lib/plugins/export/PluginExportHTML.py:634
 #, python-format
 msgid "Can't open %s!"
 msgstr "Nie mo?na otworzy? %s!"
 
-#: ../lib/plugins/export/PluginExportHTML.py:741
-#: ../lib/plugins/export/PluginExportPDF.py:181
+#: ../lib/plugins/export/PluginExportHTML.py:642
+#: ../lib/plugins/export/PluginExportPDF.py:173
 msgid "Document generated by Griffith v"
 msgstr "Dokument wygenerowany przez Griffith v"
 
-#: ../lib/plugins/export/PluginExportHTML.py:809
+#: ../lib/plugins/export/PluginExportHTML.py:710
 msgid "Yes"
 msgstr "Tak"
 
-#: ../lib/plugins/export/PluginExportHTML.py:811
+#: ../lib/plugins/export/PluginExportHTML.py:712
 msgid "No"
 msgstr "Nie"
 
-#: ../lib/plugins/export/PluginExportHTML.py:884
+#: ../lib/plugins/export/PluginExportHTML.py:785
 msgid "Document has been generated."
 msgstr "Dokument zosta? pomy?lnie utworzony."
 
-#: ../lib/plugins/export/PluginExportiPod.py:38
+#: ../lib/plugins/export/PluginExportiPod.py:63
 msgid "iPod Notes export plugin"
 msgstr "Wtyczka eksportu do listy notatek w iPodzie"
 
-#: ../lib/plugins/export/PluginExportiPod.py:87
+#: ../lib/plugins/export/PluginExportiPod.py:79
 msgid "My Movies List"
 msgstr "Moja lista film?w"
 
-#: ../lib/plugins/export/PluginExportiPod.py:103
+#: ../lib/plugins/export/PluginExportiPod.py:95
 msgid "List was successful exported to iPod."
 msgstr "Lista zosta?a wyeksportowana do iPoda"
 
-#: ../lib/plugins/export/PluginExportiPod.py:105
+#: ../lib/plugins/export/PluginExportiPod.py:97
 msgid "iPod is not connected."
 msgstr "iPod nie jest pod??czony"
 
-#: ../lib/plugins/export/PluginExportiPod.py:120
+#: ../lib/plugins/export/PluginExportiPod.py:112
 msgid ""
 "List was successful exported. Now you should move it to the 'Notes' folder "
 "on your iPod."
@@ -1338,29 +1347,29 @@
 "Lista zosta?a pomy?lnie wyeksportowana. Powiniene? teraz przenie?? j? do "
 "katalogu 'Notes' na swoim iPodzie."
 
-#: ../lib/plugins/export/PluginExportPDF.py:50
+#: ../lib/plugins/export/PluginExportPDF.py:47
 msgid "PDF export plugin"
 msgstr "Wtyczka eksportu do PDF"
 
-#: ../lib/plugins/export/PluginExportPDF.py:78
-#: ../lib/plugins/export/PluginExportPDF.py:80
+#: ../lib/plugins/export/PluginExportPDF.py:72
+#: ../lib/plugins/export/PluginExportPDF.py:74
 msgid "Export a PDF"
 msgstr "Eksport do PDF"
 
-#: ../lib/plugins/export/PluginExportPDF.py:124
+#: ../lib/plugins/export/PluginExportPDF.py:116
 msgid "List of films"
 msgstr "Lista film?w"
 
-#: ../lib/plugins/export/PluginExportPDF.py:127
+#: ../lib/plugins/export/PluginExportPDF.py:119
 #, python-format
 msgid "Total Movies: %s"
 msgstr "Razem film?w: %s"
 
-#: ../lib/plugins/export/PluginExportPDF.py:174
+#: ../lib/plugins/export/PluginExportPDF.py:166
 msgid "PDF has been created."
 msgstr "Utworzono dokument PDF."
 
-#: ../lib/plugins/export/PluginExportPDF.py:179
+#: ../lib/plugins/export/PluginExportPDF.py:171
 #, python-format
 msgid "Page %d"
 msgstr "Strona %d"
@@ -1369,20 +1378,20 @@
 msgid "Full XML list export plugin"
 msgstr "Wtyczka eksportu pe?nej listy film?w do XML"
 
-#: ../lib/plugins/imp/CSV.py:44
+#: ../lib/plugins/imp/CSV.py:42
 msgid "Full CSV list import plugin"
 msgstr "Wtyczka importu film?w z pliku CSV"
 
-#: ../lib/plugins/imp/CSV.py:193
+#: ../lib/plugins/imp/CSV.py:191
 msgid "Please assign at least one field first!"
 msgstr "Prosz? przypisa? przynajmniej jedno pole!"
 
-#: ../lib/plugins/imp/CSV.py:311
+#: ../lib/plugins/imp/CSV.py:309
 #, python-format
 msgid "Can't open the file %s"
 msgstr "Nie mo?na otworzy? pliku %s!"
 
-#: ../lib/plugins/imp/__init__.py:246
+#: ../lib/plugins/imp/__init__.py:244
 #, python-format
 msgid "%s file has been imported. %s movies added."
 msgstr "Plik %s zosta? zaimportowany. Dodano %s nowych film?w."
@@ -1399,122 +1408,98 @@
 msgid "<b>Header</b>"
 msgstr "<b>Nag??wek</b>"
 
-#: ../glade/exporthtml.glade.h:4 ../glade/griffith.glade.h:10
-msgid "<b>Limits</b>"
-msgstr "<b>Ograniczenia</b>"
-
-#: ../glade/exporthtml.glade.h:5 ../glade/griffith.glade.h:18
+#: ../glade/exporthtml.glade.h:4 ../glade/griffith.glade.h:18
 msgid "<b>Sort by</b>"
 msgstr "<b>Sortuj wed?ug</b>"
 
-#: ../glade/exporthtml.glade.h:6
+#: ../glade/exporthtml.glade.h:5
 msgid "<b>Split into</b>"
 msgstr "<b>Podziel na</b>"
 
-#: ../glade/exporthtml.glade.h:7
+#: ../glade/exporthtml.glade.h:6
 msgid "<b>Style</b>"
 msgstr "<b>Styl</b>"
 
-#: ../glade/exporthtml.glade.h:8
+#: ../glade/exporthtml.glade.h:7
 msgid "<b>Template</b>"
 msgstr "<b>Szablon</b>"
 
-#: ../glade/exporthtml.glade.h:9 ../glade/import.glade.h:3
+#: ../glade/exporthtml.glade.h:8 ../glade/import.glade.h:3
 msgid "Author"
 msgstr "Autor"
 
-#: ../glade/exporthtml.glade.h:10
+#: ../glade/exporthtml.glade.h:9
 msgid "Black and white"
 msgstr "Czarno-bia?e"
 
-#: ../glade/exporthtml.glade.h:11
+#: ../glade/exporthtml.glade.h:10
 msgid "Choose style file"
 msgstr "Wska? plik styli"
 
-#: ../glade/exporthtml.glade.h:12
+#: ../glade/exporthtml.glade.h:11
 msgid "Convert images"
 msgstr "Konwertuj obrazki"
 
-#: ../glade/exporthtml.glade.h:13
+#: ../glade/exporthtml.glade.h:12
 msgid "Data"
 msgstr "Dane"
 
-#: ../glade/exporthtml.glade.h:14 ../glade/import.glade.h:4
+#: ../glade/exporthtml.glade.h:13 ../glade/import.glade.h:4
 msgid "Description"
 msgstr "Opis"
 
-#: ../glade/exporthtml.glade.h:15
+#: ../glade/exporthtml.glade.h:14
 msgid "Destination"
 msgstr "Miejsce"
 
-#: ../glade/exporthtml.glade.h:17
+#: ../glade/exporthtml.glade.h:16
 msgid "Export"
 msgstr "Eksport"
 
-#: ../glade/exporthtml.glade.h:18
+#: ../glade/exporthtml.glade.h:17
 msgid "Export data"
 msgstr "Eksport danych"
 
-#: ../glade/exporthtml.glade.h:19
+#: ../glade/exporthtml.glade.h:18
 msgid "Format"
 msgstr "Format"
 
-#: ../glade/exporthtml.glade.h:20
+#: ../glade/exporthtml.glade.h:19
 msgid "Maximal height"
 msgstr "Maksymalna wysoko??"
 
-#: ../glade/exporthtml.glade.h:21
+#: ../glade/exporthtml.glade.h:20
 msgid "Maximal width"
 msgstr "Maksymalna szeroko??"
 
-#: ../glade/exporthtml.glade.h:22
+#: ../glade/exporthtml.glade.h:21
 msgid "Posters"
 msgstr "Plakaty"
 
-#: ../glade/exporthtml.glade.h:23 ../glade/griffith.glade.h:130
+#: ../glade/exporthtml.glade.h:22 ../glade/griffith.glade.h:130
 msgid "Reverse"
 msgstr "Odwr?cona kolejno??"
 
-#: ../glade/exporthtml.glade.h:24
+#: ../glade/exporthtml.glade.h:23
 msgid "Template"
 msgstr "Szablon"
 
-#: ../glade/exporthtml.glade.h:25
+#: ../glade/exporthtml.glade.h:24
 msgid "Use custom file"
 msgstr "W?asny plik styli"
 
-#: ../glade/exporthtml.glade.h:26 ../glade/import.glade.h:10
+#: ../glade/exporthtml.glade.h:25 ../glade/import.glade.h:10
 msgid "Version"
 msgstr "Wersja"
 
-#: ../glade/exporthtml.glade.h:27
+#: ../glade/exporthtml.glade.h:26
 msgid "entries per page"
 msgstr "pozycji na stron?"
 
-#: ../glade/exporthtml.glade.h:28
+#: ../glade/exporthtml.glade.h:27
 msgid "files"
 msgstr "plik?w"
 
-#: ../glade/exporthtml.glade.h:29 ../glade/griffith.glade.h:182
-msgid "loaned only"
-msgstr "tylko wypo?yczone"
-
-#: ../glade/exporthtml.glade.h:30 ../glade/griffith.glade.h:186
-msgid "none"
-msgstr "brak"
-
-#: ../glade/exporthtml.glade.h:31 ../glade/griffith.glade.h:187
-msgid "not loaned only"
-msgstr "tylko niewypo?yczone"
-
-#: ../glade/exporthtml.glade.h:32 ../glade/griffith.glade.h:190
-msgid "seen only"
-msgstr "tylko obejrzane"
-
-#: ../glade/exporthtml.glade.h:33 ../glade/griffith.glade.h:192
-msgid "unseen only"
-msgstr "tylko nieobejrzane"
-
 #: ../glade/griffith.glade.h:1
 msgid "0 means no limits"
 msgstr "0 oznacza brak limit?w"
@@ -1547,6 +1532,10 @@
 msgid "<b>Languages</b>"
 msgstr "<b>J?zyki</b>"
 
+#: ../glade/griffith.glade.h:10
+msgid "<b>Limits</b>"
+msgstr "<b>Ograniczenia</b>"
+
 #: ../glade/griffith.glade.h:11
 msgid "<b>Loan History</b>"
 msgstr "<b>Historia wypo?ycze?</b>"
@@ -1635,179 +1624,171 @@
 msgid "By Collection"
 msgstr "Wg kolekcji"
 
-#: ../glade/griffith.glade.h:36
-msgid "By Tag"
-msgstr "Wg tag?w"
-
-#: ../glade/griffith.glade.h:37
-msgid "By Volume"
-msgstr "Wg woluminu"
-
-#: ../glade/griffith.glade.h:40
+#: ../glade/griffith.glade.h:38
 msgid "Choose Image"
 msgstr "W?asne t?o z pliku"
 
-#: ../glade/griffith.glade.h:42
+#: ../glade/griffith.glade.h:40
 msgid "Clears filter"
 msgstr "Czy?ci filtr"
 
-#: ../glade/griffith.glade.h:43
+#: ../glade/griffith.glade.h:41
 msgid "Clone"
 msgstr "Klonuj"
 
-#: ../glade/griffith.glade.h:48
+#: ../glade/griffith.glade.h:46
+msgid "Create backup"
+msgstr "Stw?rz kopi? zapasow?"
+
+#: ../glade/griffith.glade.h:47
 msgid "DVD layers"
 msgstr "Warstwy DVD"
 
-#: ../glade/griffith.glade.h:49
+#: ../glade/griffith.glade.h:48
 msgid "DVD region"
 msgstr "Region DVD"
 
-#: ../glade/griffith.glade.h:50
+#: ../glade/griffith.glade.h:49
 msgid "Database"
 msgstr "Baza danych"
 
-#: ../glade/griffith.glade.h:51
+#: ../glade/griffith.glade.h:50
 msgid "Delete a person"
 msgstr "Usu? osob?"
 
-#: ../glade/griffith.glade.h:52
+#: ../glade/griffith.glade.h:51
 msgid "Details"
 msgstr "Szczeg??y"
 
-#: ../glade/griffith.glade.h:53
+#: ../glade/griffith.glade.h:52
 msgid "Dictionaries"
 msgstr "S?owniki"
 
-#: ../glade/griffith.glade.h:57
+#: ../glade/griffith.glade.h:56
 msgid "E-mail reminder"
 msgstr "Wy?lij maila"
 
-#: ../glade/griffith.glade.h:58
+#: ../glade/griffith.glade.h:57
 msgid "E_xport"
 msgstr "E_xport"
 
-#: ../glade/griffith.glade.h:59
+#: ../glade/griffith.glade.h:58
 msgid "Edit a person"
 msgstr "Edytuj dane wypo?yczaj?cego"
 
-#: ../glade/griffith.glade.h:60
+#: ../glade/griffith.glade.h:59
 msgid "Edit movie details"
 msgstr "Edytuj szczeg??y filmu"
 
-#: ../glade/griffith.glade.h:61
+#: ../glade/griffith.glade.h:60
 msgid "Favorite Movie Plugin"
 msgstr "Ulubiona wtyczka filmowa"
 
-#: ../glade/griffith.glade.h:62
+#: ../glade/griffith.glade.h:61
 msgid "Fetch from Amazon"
 msgstr "Pobierz z Amazonu"
 
-#: ../glade/griffith.glade.h:63
+#: ../glade/griffith.glade.h:62
 msgid "Fill empty fields only"
 msgstr "Wype?nij tylko puste pola"
 
-#: ../glade/griffith.glade.h:64
+#: ../glade/griffith.glade.h:63
 msgid "Filter "
 msgstr "Filtr "
 
-#: ../glade/griffith.glade.h:65
+#: ../glade/griffith.glade.h:64
 msgid "Filter movies"
 msgstr "Filtruj filmy"
 
-#: ../glade/griffith.glade.h:66
+#: ../glade/griffith.glade.h:65
 msgid "Font for reports"
 msgstr "Czcionka"
 
-#: ../glade/griffith.glade.h:67
+#: ../glade/griffith.glade.h:66
 msgid "Forum"
 msgstr "Forum"
 
-#: ../glade/griffith.glade.h:68
+#: ../glade/griffith.glade.h:67
 msgid "Found Results"
 msgstr "Znalezione pozycje"
 
-#: ../glade/griffith.glade.h:70
+#: ../glade/griffith.glade.h:69
 msgid "Get from web"
 msgstr "Pobierz z Internetu"
 
-#: ../glade/griffith.glade.h:71
+#: ../glade/griffith.glade.h:70
 msgid "Get movie data from:"
 msgstr "Pobierz dane filmu z:"
 
-#: ../glade/griffith.glade.h:72
+#: ../glade/griffith.glade.h:71
 msgid "Griffith"
 msgstr "Griffith"
 
-#: ../glade/griffith.glade.h:73
+#: ../glade/griffith.glade.h:72
 msgid "Homepage"
 msgstr "Strona domowa"
 
-#: ../glade/griffith.glade.h:74
+#: ../glade/griffith.glade.h:73
 msgid "Host"
 msgstr "Host"
 
-#: ../glade/griffith.glade.h:75
+#: ../glade/griffith.glade.h:74
 msgid "I_mport"
 msgstr "I_mport"
 
-#: ../glade/griffith.glade.h:77
+#: ../glade/griffith.glade.h:76
 msgid "Include Front Image"
 msgstr "do??cz plakat"
 
-#: ../glade/griffith.glade.h:78
+#: ../glade/griffith.glade.h:77
 msgid "Include movie number"
 msgstr "do??cz numer filmu"
 
-#: ../glade/griffith.glade.h:79
+#: ../glade/griffith.glade.h:78
 msgid "Languages"
 msgstr "J?zyki"
 
-#: ../glade/griffith.glade.h:81
+#: ../glade/griffith.glade.h:80
 msgid "Limit search results to"
 msgstr "Ogranicz wyniki wyszykiwania do"
 
-#: ../glade/griffith.glade.h:82
+#: ../glade/griffith.glade.h:81
 msgid "Load poster from disk"
 msgstr "Wczytuje plakat z dysku"
 
-#: ../glade/griffith.glade.h:83
+#: ../glade/griffith.glade.h:82
 msgid "Loan"
 msgstr "Wypo?ycz"
 
-#: ../glade/griffith.glade.h:84
+#: ../glade/griffith.glade.h:83
 msgid "Loan Management"
 msgstr "Zarz?dzanie wypo?yczeniami"
 
-#: ../glade/griffith.glade.h:85
+#: ../glade/griffith.glade.h:84
 msgid "Loan movie"
 msgstr "Wypo?ycz film"
 
-#: ../glade/griffith.glade.h:86
+#: ../glade/griffith.glade.h:85
 msgid "Loan to"
 msgstr "Wypo?ycz dla"
 
-#: ../glade/griffith.glade.h:87
+#: ../glade/griffith.glade.h:86
 msgid "Loaned Movies"
 msgstr "Wypo?yczone filmy"
 
-#: ../glade/griffith.glade.h:88
-msgid "Loaned to"
-msgstr "Wypo?yczony przez"
-
-#: ../glade/griffith.glade.h:89
+#: ../glade/griffith.glade.h:87
 msgid "Loans"
 msgstr "Wypo?yczenia"
 
-#: ../glade/griffith.glade.h:90
+#: ../glade/griffith.glade.h:88
 msgid "Main list"
 msgstr "G??wna lista"
 
-#: ../glade/griffith.glade.h:91
+#: ../glade/griffith.glade.h:89
 msgid "Manage People"
 msgstr "Dane wypo?yczaj?cych"
 
-#: ../glade/griffith.glade.h:94
+#: ../glade/griffith.glade.h:92
 msgid ""
 "Meter\n"
 "Stars"
@@ -1815,106 +1796,114 @@
 "Termometr\n"
 "Gwiazdki"
 
-#: ../glade/griffith.glade.h:96
+#: ../glade/griffith.glade.h:94
 msgid "Movie details"
 msgstr "Szczeg??y filmu"
 
-#: ../glade/griffith.glade.h:97
+#: ../glade/griffith.glade.h:95
 msgid "Movie information"
 msgstr "Informacje o filmie"
 
-#: ../glade/griffith.glade.h:99
+#: ../glade/griffith.glade.h:97
 msgid "Needs authentication"
 msgstr "Wymagana autoryzacja"
 
-#: ../glade/griffith.glade.h:100
+#: ../glade/griffith.glade.h:98
+msgid "New database"
+msgstr "Nowa baza danych"
+
+#: ../glade/griffith.glade.h:99
 msgid "Not Seen Movies"
 msgstr "Nieobejrzane filmy"
 
-#: ../glade/griffith.glade.h:104
+#: ../glade/griffith.glade.h:103
 msgid "Open search window"
 msgstr "Otw?rz okno wyszukiwania"
 
-#: ../glade/griffith.glade.h:106
+#: ../glade/griffith.glade.h:105
 msgid "Original title"
 msgstr "Tytu? oryginalny"
 
-#: ../glade/griffith.glade.h:107
+#: ../glade/griffith.glade.h:106
 msgid "Other"
 msgstr "Inne"
 
-#: ../glade/griffith.glade.h:108
+#: ../glade/griffith.glade.h:107
 msgid "PDF reader"
 msgstr "Czytnik PDF"
 
-#: ../glade/griffith.glade.h:109
+#: ../glade/griffith.glade.h:108
 msgid "Password"
 msgstr "Has?o"
 
-#: ../glade/griffith.glade.h:110
+#: ../glade/griffith.glade.h:109
 msgid "People"
 msgstr "Lista os?b"
 
-#: ../glade/griffith.glade.h:111
+#: ../glade/griffith.glade.h:110
 msgid "Phone"
 msgstr "Telefon"
 
-#: ../glade/griffith.glade.h:112
+#: ../glade/griffith.glade.h:111
 msgid "Please wait a moment..."
 msgstr "Prosz? czeka?..."
 
-#: ../glade/griffith.glade.h:114
+#: ../glade/griffith.glade.h:113
 msgid "Plugins"
 msgstr "Wtyczki"
 
-#: ../glade/griffith.glade.h:115
+#: ../glade/griffith.glade.h:114
 msgid "Port"
 msgstr "Port"
 
-#: ../glade/griffith.glade.h:116
+#: ../glade/griffith.glade.h:115
 msgid "Poster image"
 msgstr "Plakat"
 
-#: ../glade/griffith.glade.h:117
+#: ../glade/griffith.glade.h:116
 msgid "Poster viewer"
 msgstr "Przegl?darka plakat?w"
 
-#: ../glade/griffith.glade.h:118
+#: ../glade/griffith.glade.h:117
 msgid "Preferences"
 msgstr "Ustawienia"
 
-#: ../glade/griffith.glade.h:119
+#: ../glade/griffith.glade.h:118
 msgid "Print Cover"
 msgstr "Drukuj ok?adk?"
 
-#: ../glade/griffith.glade.h:120
+#: ../glade/griffith.glade.h:119
 msgid "Print cover"
 msgstr "Drukowanie ok?adki"
 
-#: ../glade/griffith.glade.h:122
+#: ../glade/griffith.glade.h:121
 msgid "Rating image"
 msgstr "Schemat ikon suwaka z ocen?"
 
-#: ../glade/griffith.glade.h:124
+#: ../glade/griffith.glade.h:123
 msgid "Remove"
 msgstr "Usu?"
 
-#: ../glade/griffith.glade.h:125
+#: ../glade/griffith.glade.h:124
 msgid "Remove selected movie"
 msgstr "Usu? zaznaczony film"
 
-#: ../glade/griffith.glade.h:126
+#: ../glade/griffith.glade.h:125
 msgid "Removes poster"
 msgstr "Usuwa plakat"
 
-#: ../glade/griffith.glade.h:127
+#: ../glade/griffith.glade.h:126
 msgid "Rename"
 msgstr "Zmie? nazw?"
 
-#: ../glade/griffith.glade.h:128
+#: ../glade/griffith.glade.h:127
 msgid "Report bug"
 msgstr "Zg?o? b??d"
 
+#: ../glade/griffith.glade.h:128
+msgid "Restore from backup"
+msgstr "Przywr?? dane z kopii bezpiecze?stwa"
+
 #: ../glade/griffith.glade.h:129
 msgid "Return"
 msgstr "Zwr?cono"
@@ -2081,6 +2070,10 @@
 msgid "collection details"
 msgstr "szczeg??y kolekcji"
 
+#: ../glade/griffith.glade.h:182
+msgid "loaned only"
+msgstr "tylko wypo?yczone"
+
 #: ../glade/griffith.glade.h:183
 msgid "loans movie or volume"
 msgstr "wypo?ycza film lub wolumin"
@@ -2093,6 +2086,14 @@
 msgid "movies"
 msgstr "film?w"
 
+#: ../glade/griffith.glade.h:186
+msgid "none"
+msgstr "brak"
+
+#: ../glade/griffith.glade.h:187
+msgid "not loaned only"
+msgstr "tylko niewypo?yczone"
+
 #: ../glade/griffith.glade.h:188
 msgid "remove selected collection"
 msgstr "usu? wybran? kolekcj?"
@@ -2101,10 +2102,18 @@
 msgid "remove selected volume"
 msgstr "usu? wybrany wolumin"
 
+#: ../glade/griffith.glade.h:190
+msgid "seen only"
+msgstr "tylko obejrzane"
+
 #: ../glade/griffith.glade.h:191
 msgid "tags"
 msgstr "tagi"
 
+#: ../glade/griffith.glade.h:192
+msgid "unseen only"
+msgstr "tylko nieobejrzane"
+
 #: ../glade/griffith.glade.h:193
 msgid "volume details"
 msgstr "szczeg??y woluminu"
@@ -2369,30 +2378,3 @@
 #: ../glade/import.glade.h:9
 msgid "Source"
 msgstr "?r?d?o"
-
-#~ msgid "Column \"%s\" is not unique"
-#~ msgstr "Pozycja \"%s\" nie jest unikalna"
-
-#, fuzzy
-#~ msgid "No movie selected"
-#~ msgstr "Usu? zaznaczony film"
-
-#, fuzzy
-#~ msgid ""
-#~ "Plugin exports data using templates to a website grouped by collection"
-#~ msgstr "Wtyczka eksportuje dane u?ywaj?c szablon?w"
-
-#~ msgid " movie(s) in collection. "
-#~ msgstr " film(?w) w kolekcji. "
-
-#~ msgid " movie(s) loaned. "
-#~ msgstr " film?w wypo?yczonych. "
-
-#~ msgid "You haven't seen "
-#~ msgstr "Nie obejrza?e? jeszcze "
-
-#~ msgid " movie(s)"
-#~ msgstr " pozycji"
-
-#~ msgid "Select A File"
-#~ msgstr "Wybierz plik"



From piotrek at mail.berlios.de  Mon Nov 17 23:22:08 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 23:22:08 +0100
Subject: [Griffith-svn] r1063 - trunk
Message-ID: <200811172222.mAHMM8tn015292@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 23:22:08 +0100 (Mon, 17 Nov 2008)
New Revision: 1063

Modified:
   trunk/NEWS
Log:
update NEWS file


Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2008-11-17 22:09:50 UTC (rev 1062)
+++ trunk/NEWS	2008-11-17 22:22:08 UTC (rev 1063)
@@ -2,7 +2,12 @@
 ===================
 * Filter movies using complex search criteria functionality
 * Posters stored in database (+local cache)
-* Unicode used internally (less problems with encodings)
+* New fields: aspect ratio, cameraman and screenplay
+* Lots of internal changes
+  + Unicode used internally (less problems with encodings, still needs some work)
+* Movie plugins updated
+* Export plugins are now exporting movies listed in main window only
+* Lots of bugs fixed, some speedups
 
 Note to package maintainers:
 Please note that Griffith requires Python >=2.5 and SQLAlchemy >= 0.5 now



From piotrek at mail.berlios.de  Mon Nov 17 23:28:24 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Mon, 17 Nov 2008 23:28:24 +0100
Subject: [Griffith-svn] r1065 - trunk/lib/plugins/movie
Message-ID: <200811172228.mAHMSOpN016336@sheep.berlios.de>

Author: piotrek
Date: 2008-11-17 23:28:24 +0100 (Mon, 17 Nov 2008)
New Revision: 1065

Modified:
   trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
Log:
typo fixed


Modified: trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-17 22:24:11 UTC (rev 1064)
+++ trunk/lib/plugins/movie/PluginMovieFilmeVonAZ.py	2008-11-17 22:28:24 UTC (rev 1065)
@@ -21,7 +21,7 @@
 # You may use and distribute this software under the terms of the
 # GNU General Public License, version 2 or later
 
-mport gutils
+import gutils
 import movie
 import string
 import re



From kura666 at mail.berlios.de  Tue Nov 18 14:36:10 2008
From: kura666 at mail.berlios.de (kura666 at mail.berlios.de)
Date: Tue, 18 Nov 2008 14:36:10 +0100
Subject: [Griffith-svn] r1066 - trunk/lib/plugins/movie
Message-ID: <200811181336.mAIDaAqG008082@sheep.berlios.de>

Author: kura666
Date: 2008-11-18 14:34:47 +0100 (Tue, 18 Nov 2008)
New Revision: 1066

Modified:
   trunk/lib/plugins/movie/PluginMovieFDb.py
Log:
FDb movie plugin updated


Modified: trunk/lib/plugins/movie/PluginMovieFDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFDb.py	2008-11-17 22:28:24 UTC (rev 1065)
+++ trunk/lib/plugins/movie/PluginMovieFDb.py	2008-11-18 13:34:47 UTC (rev 1066)
@@ -32,10 +32,10 @@
 plugin_language        = _('Polish')
 plugin_author        = 'Piotr O?arowski, Bartosz Kurczewski'
 plugin_author_email    = '<bartosz.kurczewski at gmail.com>'
-plugin_version        = '1.10'
+plugin_version        = '1.11'
 
 class Plugin(movie.Movie):
-    TRAILER_PATTERN = re.compile('http://.*\.fdb\.pl/zwiastuny/odtwarzaj/[0-9]*')
+    TRAILER_PATTERN = re.compile('/film/.*/zwiastuny/odtwarzaj/[0-9]*')
 
     def __init__(self, movie_id):
         from md5 import md5
@@ -53,7 +53,7 @@
             self.image_url = ''
 
     def get_o_title(self):
-        self.o_title = gutils.trim(self.page, '<h2>', '</h2>')
+        self.o_title = gutils.trim(self.page, '<h2 class="title">', '</h2>')
         self.o_title = gutils.strip_tags(self.o_title)
         if self.o_title == '':
             self.o_title = self.get_title(True)
@@ -70,7 +70,7 @@
 
     def get_director(self):
         self.director = ''
-        elements = gutils.trim(self.page,'>Re?yseria</h4>','</div>')
+        elements = gutils.trim(self.page,'>Re?yseria: </h4>','</div>')
         elements = string.split(elements, '</li>')
         if elements[0] != '':
             for element in elements:
@@ -80,23 +80,23 @@
             self.director = string.replace(self.director[2:], ', &nbsp;&nbsp;&nbsp;(wi?cej)', '')
 
     def get_plot(self):
-        self.plot = gutils.trim(self.page,'Opis filmu</h3>','</div>')
-        self.plot = gutils.trim(self.plot,'<p>',"\n \n   ")
+        self.plot = gutils.trim(self.page,'Opis filmu','</div>')
+        self.plot = gutils.trim(self.plot,'<p>',"\n\n")
 
     def get_year(self):
         self.year = gutils.trim(self.page,'<small>(', ')</small>')
 
     def get_runtime(self):
-        self.runtime = gutils.trim(self.page,'Czas trwania</h4>','</div>')
+        self.runtime = gutils.trim(self.page,'Czas trwania: </h4>','</div>')
         self.runtime = gutils.trim(self.runtime,'<li>',' minut')
 
     def get_genre(self):
-        self.genre = gutils.trim(self.page,'Gatunek</h4>','</div>')
+        self.genre = gutils.trim(self.page,'Gatunek: </h4>','</div>')
         self.genre = gutils.trim(self.genre,'<li>','</li>')
         self.genre = string.replace(self.genre, ' / ', ' | ')
 
     def get_cast(self):
-        self.cast = gutils.trim(self.page,'Obsada</h3>','</div>')
+        self.cast = gutils.trim(self.page,'<h2 class="category-header">\n    Obsada','</div>')
         self.cast = gutils.trim(self.cast,"<table>\n",'  </table>')
         if self.cast != '':
             self.cast = gutils.strip_tags(self.cast)
@@ -106,7 +106,7 @@
             self.cast = self.cast.replace("\n\n\n\n\n","")
 
     def get_classification(self):
-        self.classification = gutils.trim(self.page,"Od lat</h4>","</div>")
+        self.classification = gutils.trim(self.page,"Od lat: </h4>","</div>")
         self.classification = gutils.trim(self.classification,'<li>','</li>')
 
     def get_studio(self):
@@ -121,14 +121,14 @@
     def get_trailer(self):
         trailer_url = self.TRAILER_PATTERN.findall(self.page)
         if trailer_url:
-            self.trailer = trailer_url[0]
+            self.trailer = 'http://fdb.pl' + trailer_url[0]
 
     def get_country(self):
-        self.country = gutils.trim(self.page,'Kraj produkcji</h4>','</div>')
+        self.country = gutils.trim(self.page,'Kraj produkcji: </h4>','</div>')
         self.country = gutils.trim(self.country,'<li>','</li>')
 
     def get_rating(self):
-        self.rating = gutils.trim(self.page, 'class="vote"','</strong>')
+        self.rating = gutils.trim(self.page, 'class="vote"','/10</strong>')
         self.rating = gutils.after(self.rating, '<strong>')
         if self.rating:
             self.rating = str(float(gutils.clean(self.rating)))



From piotrek at mail.berlios.de  Tue Nov 18 22:05:31 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Tue, 18 Nov 2008 22:05:31 +0100
Subject: [Griffith-svn] r1067 - in trunk: . lib
Message-ID: <200811182105.mAIL5Vep019712@sheep.berlios.de>

Author: piotrek
Date: 2008-11-18 22:05:30 +0100 (Tue, 18 Nov 2008)
New Revision: 1067

Modified:
   trunk/ChangeLog
   trunk/NEWS
   trunk/lib/gconsole.py
   trunk/lib/version.py
Log:
* Version changed to 0.10-beta2~svn
* command line's search fixed


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-18 13:34:47 UTC (rev 1066)
+++ trunk/ChangeLog	2008-11-18 21:05:30 UTC (rev 1067)
@@ -5,6 +5,10 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-18  Piotr O?arowski
+	* Version changed to 0.10-beta2~svn
+	* command line's search fixed
+
 ---- 0.10-beta1 ---
 
 2008-11-17  Piotr O?arowski

Modified: trunk/NEWS
===================================================================
--- trunk/NEWS	2008-11-18 13:34:47 UTC (rev 1066)
+++ trunk/NEWS	2008-11-18 21:05:30 UTC (rev 1067)
@@ -1,3 +1,8 @@
+Griffith 0.10-beta2
+===================
+*
+
+
 Griffith 0.10-beta1
 ===================
 * Filter movies using complex search criteria functionality
@@ -10,7 +15,7 @@
 * Lots of bugs fixed, some speedups
 
 Note to package maintainers:
-Please note that Griffith requires Python >=2.5 and SQLAlchemy >= 0.5 now
+Please note that Griffith requires Python >=2.5 and SQLAlchemy >=0.5 now
 (see `./griffith --check-dep` or `./griffith --show-dep`)
 
 

Modified: trunk/lib/gconsole.py
===================================================================
--- trunk/lib/gconsole.py	2008-11-18 13:34:47 UTC (rev 1066)
+++ trunk/lib/gconsole.py	2008-11-18 21:05:30 UTC (rev 1067)
@@ -122,18 +122,19 @@
 def con_search_movie(self, where, sort=None):
     # for search function
     from sqlalchemy import select
-    col = lambda x: self.db.Movie.c[x]
-    columns = (col('number'), col('title'), col('o_title'), col('director'), col('year'))
+    import db
+    mt = db.tables['movies'].columns
+    columns = (mt.number, mt.title, mt.o_title, mt.director, mt.year)
     
     sort_columns = []
     if sort:
         for i in sort.split(','):
-            if self.db.Movie.c.has_key(i):
-                sort_columns.append(col(i))
+            if db.tables['movies'].columns.has_key(i):
+                sort_columns.append(mt[i])
     else:
-        sort_columns = [col('number')]
+        sort_columns = [mt.number]
 
-    statement = select(columns=columns, order_by=sort_columns)
+    statement = select(columns=columns, order_by=sort_columns, bind=self.db.session.bind)
 
     for i in where:
         if i in ('seen', 'loaned'):    # force boolean
@@ -142,9 +143,9 @@
             else:
                 where[i] = True
         if i in ('year', 'number', 'runtime', 'seen', 'loaned', 'rating'):
-            statement.append_whereclause(col(i)==where[i])
+            statement.append_whereclause(mt[i]==where[i])
         else:
-            statement.append_whereclause(col(i).like('%' + where[i] + '%' ))
+            statement.append_whereclause(mt[i].like('%' + where[i] + '%' ))
 
     movies = statement.execute().fetchall()
     if not movies:

Modified: trunk/lib/version.py
===================================================================
--- trunk/lib/version.py	2008-11-18 13:34:47 UTC (rev 1066)
+++ trunk/lib/version.py	2008-11-18 21:05:30 UTC (rev 1067)
@@ -22,7 +22,7 @@
 # GNU General Public License, version 2 or later
 
 pname        = "Griffith"
-pversion     = "0.10-beta1"
+pversion     = "0.10-beta2~svn"
 pauthor      = "Vasco Nunes, Piotr O?arowski <griffith-private at lists.berlios.de>"
 pyear        = "2005-2008"
 pwebsite     = "http://www.griffith.cc/"



From mikej06 at mail.berlios.de  Wed Nov 19 23:11:31 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Wed, 19 Nov 2008 23:11:31 +0100
Subject: [Griffith-svn] r1068 - branches/0.9.x trunk
Message-ID: <200811192211.mAJMBVkI018782@sheep.berlios.de>

Author: mikej06
Date: 2008-11-19 23:11:14 +0100 (Wed, 19 Nov 2008)
New Revision: 1068

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/winpackage.iss
   branches/0.9.x/winsetup.bat
   branches/0.9.x/winsetup.py
   trunk/ChangeLog
   trunk/winpackage.iss
   trunk/winsetup.bat
   trunk/winsetup.py
Log:
optimized windows setup related code, added links to documentation files, forum and wiki to the installer

Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-18 21:05:30 UTC (rev 1067)
+++ branches/0.9.x/ChangeLog	2008-11-19 22:11:14 UTC (rev 1068)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-10  Michael Jahn
+	* optimized windows setup related code, added links to documentation files, forum and wiki to the installer
+
 ---- 0.9.8 ---
 
 2008-11-16  Piotr O?arowski

Modified: branches/0.9.x/winpackage.iss
===================================================================
--- branches/0.9.x/winpackage.iss	2008-11-18 21:05:30 UTC (rev 1067)
+++ branches/0.9.x/winpackage.iss	2008-11-19 22:11:14 UTC (rev 1068)
@@ -57,9 +57,20 @@
 ; NOTE: Don't use "Flags: ignoreversion" on any shared system files
 
 [Icons]
-Name: {group}\Griffith; Filename: {app}\griffith.exe
-Name: {group}\{cm:ProgramOnTheWeb,Griffith}; Filename: http://griffith.cc
+Name: {group}\{cm:LaunchProgram,Griffith};    Filename: {app}\griffith.exe
 Name: {group}\{cm:UninstallProgram,Griffith}; Filename: {uninstallexe}
+Name: {group}\{cm:ProgramOnTheWeb,Griffith};  Filename: http://griffith.cc
+Name: {group}\Doc\Griffith Forum;             Filename: http://griffith.cc/forum/
+Name: {group}\Doc\Griffith Wiki;              Filename: http://wiki.griffith.cc/
+; some information files opened by iexplore which should work on most installations
+Name: {group}\Doc\INSTALL;     Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\INSTALL;     IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\NEWS;        Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\NEWS;        IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\AUTHORS;     Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\AUTHORS;     IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\THANKS;      Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\THANKS;      IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\License;     Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\COPYING;     IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\README;      Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\README;      IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\TRANSLATORS; Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\TRANSLATORS; IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+; desktop and quick launch icons
 Name: {userdesktop}\Griffith; Filename: {app}\griffith.exe; Tasks: desktopicon
 Name: {userappdata}\Microsoft\Internet Explorer\Quick Launch\Griffith; Filename: {app}\griffith.exe; Tasks: quicklaunchicon
 

Modified: branches/0.9.x/winsetup.bat
===================================================================
--- branches/0.9.x/winsetup.bat	2008-11-18 21:05:30 UTC (rev 1067)
+++ branches/0.9.x/winsetup.bat	2008-11-19 22:11:14 UTC (rev 1068)
@@ -54,6 +54,12 @@
 copy "%GRIFFITHDIR%\THANKS"      "%GRIFFITHDIR%\dist\"
 copy "%GRIFFITHDIR%\TRANSLATORS" "%GRIFFITHDIR%\dist\"
 
+rem *** remove unnecessary files
+del /S /F /Q *.pyo
+del /S /F /Q *.a
+del /S /F /Q *.lib
+del /S /F /Q xml2Conf.sh
+
 :END
 
 rem **** pause so we can see the exit codes

Modified: branches/0.9.x/winsetup.py
===================================================================
--- branches/0.9.x/winsetup.py	2008-11-18 21:05:30 UTC (rev 1067)
+++ branches/0.9.x/winsetup.py	2008-11-19 22:11:14 UTC (rev 1068)
@@ -46,7 +46,7 @@
 
 opts = {
     "py2exe": {
-        "includes": "pygtk,cairo,pangocairo,gobject,cgi,PIL,pysqlite2,pysqlite2.*,pango,atk,gobject,tempfile,csv,xml.dom,xml.dom.ext,xml.dom.minidom,xml.sax,threading,htmlentitydefs,sqlalchemy,sqlalchemy.*,sqlalchemy.mods.*,sqlalchemy.databases.*,sqlalchemy.engine.*,sqlalchemy.ext.*,sqlalchemy.orm.*,zipfile,webbrowser,shutil,reportlab,reportlab.pdfgen,reportlab.pdfgen.canvas,reportlab.platypus,reportlab.pdfbase.ttfonts,smtplib,win32com,platform,winshell,psycopg2,MySQLdb,chardet,gzip,commands,encodings,encodings.*",
+        "includes": "pygtk,cairo,pangocairo,gobject,cgi,PIL,pysqlite2,pysqlite2.*,pango,atk,gobject,tempfile,csv,xml.dom,xml.dom.ext,xml.dom.minidom,xml.sax,threading,htmlentitydefs,sqlalchemy,sqlalchemy.*,sqlalchemy.mods.*,sqlalchemy.databases.*,sqlalchemy.engine.*,sqlalchemy.ext.*,sqlalchemy.orm.*,zipfile,webbrowser,shutil,reportlab,reportlab.pdfgen,reportlab.pdfgen.canvas,reportlab.platypus,reportlab.pdfbase.ttfonts,smtplib,win32com,platform,winshell,psycopg2,MySQLdb,chardet,gzip,commands,encodings,encodings.*,ConfigParser",
         "optimize": 2,
 		"dist_dir": "dist",
     }

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-18 21:05:30 UTC (rev 1067)
+++ trunk/ChangeLog	2008-11-19 22:11:14 UTC (rev 1068)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-10  Michael Jahn
+	* optimized windows setup related code, added links to documentation files, forum and wiki to the installer
+
 2008-11-18  Piotr O?arowski
 	* Version changed to 0.10-beta2~svn
 	* command line's search fixed

Modified: trunk/winpackage.iss
===================================================================
--- trunk/winpackage.iss	2008-11-18 21:05:30 UTC (rev 1067)
+++ trunk/winpackage.iss	2008-11-19 22:11:14 UTC (rev 1068)
@@ -23,7 +23,7 @@
 AppCopyright=Vasco Nunes/Piotr Ozarowski
 DisableStartupPrompt=false
 AppVersion=0.10-beta1
-VersionInfoVersion=0.10-beta1
+VersionInfoVersion=0.10.0
 
 [Languages]
 Name: eng; MessagesFile: compiler:Default.isl
@@ -57,9 +57,20 @@
 ; NOTE: Don't use "Flags: ignoreversion" on any shared system files
 
 [Icons]
-Name: {group}\Griffith; Filename: {app}\griffith.exe
-Name: {group}\{cm:ProgramOnTheWeb,Griffith}; Filename: http://griffith.cc
+Name: {group}\{cm:LaunchProgram,Griffith};    Filename: {app}\griffith.exe
 Name: {group}\{cm:UninstallProgram,Griffith}; Filename: {uninstallexe}
+Name: {group}\{cm:ProgramOnTheWeb,Griffith};  Filename: http://griffith.cc
+Name: {group}\Doc\Griffith Forum;             Filename: http://griffith.cc/forum/
+Name: {group}\Doc\Griffith Wiki;              Filename: http://wiki.griffith.cc/
+; some information files opened by iexplore which should work on most installations
+Name: {group}\Doc\INSTALL;     Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\INSTALL;     IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\NEWS;        Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\NEWS;        IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\AUTHORS;     Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\AUTHORS;     IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\THANKS;      Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\THANKS;      IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\License;     Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\COPYING;     IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\README;      Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\README;      IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+Name: {group}\Doc\TRANSLATORS; Filename: "{pf}\Internet Explorer\iexplore.exe"; Parameters: {app}\TRANSLATORS; IconFilename: %SystemRoot%\system32\SHELL32.dll; IconIndex: -152
+; desktop and quick launch icons
 Name: {userdesktop}\Griffith; Filename: {app}\griffith.exe; Tasks: desktopicon
 Name: {userappdata}\Microsoft\Internet Explorer\Quick Launch\Griffith; Filename: {app}\griffith.exe; Tasks: quicklaunchicon
 

Modified: trunk/winsetup.bat
===================================================================
--- trunk/winsetup.bat	2008-11-18 21:05:30 UTC (rev 1067)
+++ trunk/winsetup.bat	2008-11-19 22:11:14 UTC (rev 1068)
@@ -54,6 +54,12 @@
 copy "%GRIFFITHDIR%\THANKS"      "%GRIFFITHDIR%\dist\"
 copy "%GRIFFITHDIR%\TRANSLATORS" "%GRIFFITHDIR%\dist\"
 
+rem *** remove unnecessary files
+del /S /F /Q *.pyo
+del /S /F /Q *.a
+del /S /F /Q *.lib
+del /S /F /Q xml2Conf.sh
+
 :END
 
 rem **** pause so we can see the exit codes

Modified: trunk/winsetup.py
===================================================================
--- trunk/winsetup.py	2008-11-18 21:05:30 UTC (rev 1067)
+++ trunk/winsetup.py	2008-11-19 22:11:14 UTC (rev 1068)
@@ -46,7 +46,7 @@
 
 opts = {
     "py2exe": {
-        "includes": "pygtk,cairo,pangocairo,gobject,cgi,PIL,pysqlite2,pysqlite2.*,pango,atk,gobject,tempfile,csv,xml.dom,xml.dom.ext,xml.dom.minidom,xml.sax,threading,htmlentitydefs,sqlalchemy,sqlalchemy.*,sqlalchemy.mods.*,sqlalchemy.databases.*,sqlalchemy.engine.*,sqlalchemy.ext.*,sqlalchemy.orm.*,zipfile,webbrowser,shutil,reportlab,reportlab.pdfgen,reportlab.pdfgen.canvas,reportlab.platypus,reportlab.pdfbase.ttfonts,smtplib,win32com,platform,winshell,psycopg2,MySQLdb,chardet,gzip,commands,encodings,encodings.*",
+        "includes": "pygtk,cairo,pangocairo,gobject,cgi,PIL,pysqlite2,pysqlite2.*,pango,atk,gobject,tempfile,csv,xml.dom,xml.dom.ext,xml.dom.minidom,xml.sax,threading,htmlentitydefs,sqlalchemy,sqlalchemy.*,sqlalchemy.databases.*,sqlalchemy.engine.*,sqlalchemy.ext.*,sqlalchemy.orm.*,sqlalchemy.sql.*,zipfile,webbrowser,shutil,reportlab,reportlab.pdfgen,reportlab.pdfgen.canvas,reportlab.platypus,reportlab.pdfbase.ttfonts,smtplib,win32com,platform,winshell,psycopg2,MySQLdb,chardet,gzip,commands,encodings,encodings.*,ConfigParser,gtk.glade",
         "optimize": 2,
         "dist_dir": "dist",
     }



From mikej06 at mail.berlios.de  Wed Nov 19 23:13:54 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Wed, 19 Nov 2008 23:13:54 +0100
Subject: [Griffith-svn] r1069 - trunk/lib
Message-ID: <200811192213.mAJMDs8x018925@sheep.berlios.de>

Author: mikej06
Date: 2008-11-19 23:13:48 +0100 (Wed, 19 Nov 2008)
New Revision: 1069

Modified:
   trunk/lib/gconsole.py
Log:
typo

Modified: trunk/lib/gconsole.py
===================================================================
--- trunk/lib/gconsole.py	2008-11-19 22:11:14 UTC (rev 1068)
+++ trunk/lib/gconsole.py	2008-11-19 22:13:48 UTC (rev 1069)
@@ -41,7 +41,7 @@
     
     if os.name == 'nt' or os.name.startswith('win'): # win32, win64
         from win32com.shell import shellcon, shell
-        home = os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(defaultEnc)
+        home = os.path.join(shell.SHGetFolderPath(0, shellcon.CSIDL_APPDATA, 0, 0), 'griffith').decode(default_enc)
     else:
         home = os.path.join(os.path.expanduser('~'), '.griffith').decode(default_enc)
     config = 'griffith.cfg'



From piotrek at mail.berlios.de  Sat Nov 22 17:40:50 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sat, 22 Nov 2008 17:40:50 +0100
Subject: [Griffith-svn] r1070 - / online online/trunk
	online/trunk/WebGriffith.egg-info online/trunk/docs
	online/trunk/webgriffith online/trunk/webgriffith/config
	online/trunk/webgriffith/controllers online/trunk/webgriffith/i18n
	online/trunk/webgriffith/i18n/en
	online/trunk/webgriffith/i18n/en/LC_MESSAGES
	online/trunk/webgriffith/lib online/trunk/webgriffith/model
	online/trunk/webgriffith/public online/trunk/webgriffith/public/js
	online/trunk/webgriffith/templates
	online/trunk/webgriffith/templates/default
	online/trunk/webgriffith/tests
	online/trunk/webgriffith/tests/functional
Message-ID: <200811221640.mAMGeoLv028705@sheep.berlios.de>

Author: piotrek
Date: 2008-11-22 17:40:48 +0100 (Sat, 22 Nov 2008)
New Revision: 1070

Added:
   online/
   online/branches/
   online/tags/
   online/trunk/
   online/trunk/MANIFEST.in
   online/trunk/README.txt
   online/trunk/WebGriffith.egg-info/
   online/trunk/WebGriffith.egg-info/PKG-INFO
   online/trunk/WebGriffith.egg-info/SOURCES.txt
   online/trunk/WebGriffith.egg-info/dependency_links.txt
   online/trunk/WebGriffith.egg-info/entry_points.txt
   online/trunk/WebGriffith.egg-info/not-zip-safe
   online/trunk/WebGriffith.egg-info/paster_plugins.txt
   online/trunk/WebGriffith.egg-info/requires.txt
   online/trunk/WebGriffith.egg-info/top_level.txt
   online/trunk/__init__.py
   online/trunk/data/
   online/trunk/development.ini
   online/trunk/docs/
   online/trunk/docs/index.txt
   online/trunk/setup.cfg
   online/trunk/setup.py
   online/trunk/test.ini
   online/trunk/webgriffith/
   online/trunk/webgriffith/__init__.py
   online/trunk/webgriffith/config/
   online/trunk/webgriffith/config/__init__.py
   online/trunk/webgriffith/config/deployment.ini_tmpl
   online/trunk/webgriffith/config/environment.py
   online/trunk/webgriffith/config/middleware.py
   online/trunk/webgriffith/config/routing.py
   online/trunk/webgriffith/controllers/
   online/trunk/webgriffith/controllers/__init__.py
   online/trunk/webgriffith/controllers/error.py
   online/trunk/webgriffith/controllers/list.py
   online/trunk/webgriffith/controllers/movie.py
   online/trunk/webgriffith/controllers/settings.py
   online/trunk/webgriffith/i18n/
   online/trunk/webgriffith/i18n/en/
   online/trunk/webgriffith/i18n/en/LC_MESSAGES/
   online/trunk/webgriffith/i18n/en/LC_MESSAGES/webgriffith.mo
   online/trunk/webgriffith/i18n/en/LC_MESSAGES/webgriffith.po
   online/trunk/webgriffith/i18n/webgriffith.pot
   online/trunk/webgriffith/lib/
   online/trunk/webgriffith/lib/__init__.py
   online/trunk/webgriffith/lib/app_globals.py
   online/trunk/webgriffith/lib/base.py
   online/trunk/webgriffith/lib/helpers.py
   online/trunk/webgriffith/model/
   online/trunk/webgriffith/model/__init__.py
   online/trunk/webgriffith/model/db.py
   online/trunk/webgriffith/model/meta.py
   online/trunk/webgriffith/public/
   online/trunk/webgriffith/public/bg.png
   online/trunk/webgriffith/public/js/
   online/trunk/webgriffith/public/js/jquery.min.js
   online/trunk/webgriffith/public/pylons-logo.gif
   online/trunk/webgriffith/templates/
   online/trunk/webgriffith/templates/default/
   online/trunk/webgriffith/templates/default/base.mako
   online/trunk/webgriffith/templates/default/details.mako
   online/trunk/webgriffith/templates/default/index.mako
   online/trunk/webgriffith/templates/default/list.mako
   online/trunk/webgriffith/templates/default/movie.mako
   online/trunk/webgriffith/templates/default/settings.mako
   online/trunk/webgriffith/templates/default/verbose_list.mako
   online/trunk/webgriffith/tests/
   online/trunk/webgriffith/tests/__init__.py
   online/trunk/webgriffith/tests/functional/
   online/trunk/webgriffith/tests/functional/__init__.py
   online/trunk/webgriffith/tests/functional/test_list.py
   online/trunk/webgriffith/tests/functional/test_movie.py
   online/trunk/webgriffith/tests/functional/test_settings.py
   online/trunk/webgriffith/tests/test_models.py
   online/trunk/webgriffith/websetup.py
Log:
initial WebGriffith import


Added: online/trunk/MANIFEST.in
===================================================================
--- online/trunk/MANIFEST.in	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/MANIFEST.in	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,3 @@
+include webgriffith/config/deployment.ini_tmpl
+recursive-include webgriffith/public *
+recursive-include webgriffith/templates *

Added: online/trunk/README.txt
===================================================================
--- online/trunk/README.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/README.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,32 @@
+This file is for you to describe the WebGriffith application. Typically
+you would include information such as the information below:
+
+Installation and Setup
+======================
+
+
+Install ``Pylons`` using your favourite package manader::
+
+    aptitude install python-pylons
+
+Make a config file as follows::
+
+    paster make-config WebGriffith config.ini
+
+Tweak the config file as appropriate and then setup the application::
+
+    paster setup-app development.ini
+
+Then you are ready to go.
+
+Starting application
+====================
+
+Development::
+
+    paster serve --reload development.ini
+
+Production::
+
+    paster serve production.ini
+

Added: online/trunk/WebGriffith.egg-info/PKG-INFO
===================================================================
--- online/trunk/WebGriffith.egg-info/PKG-INFO	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/PKG-INFO	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,10 @@
+Metadata-Version: 1.0
+Name: WebGriffith
+Version: 0.1~dev
+Summary: UNKNOWN
+Home-page: http://online.griffith.cc
+Author: Piotr O?arowski
+Author-email: piotr at griffith.cc
+License: GPL2
+Description: Online version of Griffith
+Platform: any

Added: online/trunk/WebGriffith.egg-info/SOURCES.txt
===================================================================
--- online/trunk/WebGriffith.egg-info/SOURCES.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/SOURCES.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,33 @@
+MANIFEST.in
+README.txt
+setup.cfg
+setup.py
+WebGriffith.egg-info/PKG-INFO
+WebGriffith.egg-info/SOURCES.txt
+WebGriffith.egg-info/dependency_links.txt
+WebGriffith.egg-info/entry_points.txt
+WebGriffith.egg-info/not-zip-safe
+WebGriffith.egg-info/paster_plugins.txt
+WebGriffith.egg-info/requires.txt
+WebGriffith.egg-info/top_level.txt
+webgriffith/__init__.py
+webgriffith/websetup.py
+webgriffith/config/__init__.py
+webgriffith/config/deployment.ini_tmpl
+webgriffith/config/environment.py
+webgriffith/config/middleware.py
+webgriffith/config/routing.py
+webgriffith/controllers/__init__.py
+webgriffith/controllers/error.py
+webgriffith/lib/__init__.py
+webgriffith/lib/app_globals.py
+webgriffith/lib/base.py
+webgriffith/lib/helpers.py
+webgriffith/model/__init__.py
+webgriffith/model/meta.py
+webgriffith/public/bg.png
+webgriffith/public/index.html
+webgriffith/public/pylons-logo.gif
+webgriffith/tests/__init__.py
+webgriffith/tests/test_models.py
+webgriffith/tests/functional/__init__.py
\ No newline at end of file

Added: online/trunk/WebGriffith.egg-info/dependency_links.txt
===================================================================
--- online/trunk/WebGriffith.egg-info/dependency_links.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/dependency_links.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1 @@
+

Added: online/trunk/WebGriffith.egg-info/entry_points.txt
===================================================================
--- online/trunk/WebGriffith.egg-info/entry_points.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/entry_points.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,7 @@
+
+    [paste.app_factory]
+    main = webgriffith.config.middleware:make_app
+
+    [paste.app_install]
+    main = pylons.util:PylonsInstaller
+    
\ No newline at end of file

Added: online/trunk/WebGriffith.egg-info/not-zip-safe
===================================================================
--- online/trunk/WebGriffith.egg-info/not-zip-safe	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/not-zip-safe	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1 @@
+

Added: online/trunk/WebGriffith.egg-info/paster_plugins.txt
===================================================================
--- online/trunk/WebGriffith.egg-info/paster_plugins.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/paster_plugins.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,2 @@
+PasteScript
+Pylons

Added: online/trunk/WebGriffith.egg-info/requires.txt
===================================================================
--- online/trunk/WebGriffith.egg-info/requires.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/requires.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,5 @@
+Pylons>=0.9.7rc3
+SQLAlchemy>=0.5rc4
+Mako >= 0.2.2
+Beaker
+Webhelpers>=0.6.1

Added: online/trunk/WebGriffith.egg-info/top_level.txt
===================================================================
--- online/trunk/WebGriffith.egg-info/top_level.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/WebGriffith.egg-info/top_level.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1 @@
+webgriffith

Added: online/trunk/__init__.py
===================================================================

Added: online/trunk/development.ini
===================================================================
--- online/trunk/development.ini	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/development.ini	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,91 @@
+#
+# WebGriffith - Pylons development environment configuration
+#
+# The %(here)s variable will be replaced with the parent directory of this file
+#
+[DEFAULT]
+debug = true
+# Uncomment and replace with the address which should receive any error reports
+#email_to = you at yourdomain.com
+smtp_server = localhost
+error_email_from = webgriffith at localhost
+
+[server:main]
+use = egg:Paste#http
+host = 127.0.0.1
+port = 5000
+
+[app:main]
+use = egg:WebGriffith
+full_stack = true
+
+cache_dir = %(here)s/data
+beaker.session.key = webgriffith
+beaker.session.secret = somesecret
+
+# If you'd like to fine-tune the individual locations of the cache data dirs
+# for the Cache data, or the Session saves, un-comment the desired settings
+# here:
+#beaker.cache.data_dir = %(here)s/data/cache
+#beaker.session.data_dir = %(here)s/data/sessions
+
+# SQLAlchemy database URL
+sqlalchemy.url = sqlite:////home/pox/.griffith/griffith.db
+sqlalchemy.convert_unicode = true
+
+
+# WARNING: *THE LINE BELOW MUST BE UNCOMMENTED ON A PRODUCTION ENVIRONMENT*
+# Debug mode will enable the interactive debugging tool, allowing ANYONE to
+# execute malicious code after an exception is raised.
+#set debug = false
+
+# session defaults:
+view.language = en
+view.template = default
+
+# other view settings:
+view.header = Griffith's movie list
+view.items_per_page = 20
+
+# Logging configuration
+[loggers]
+keys = root, routes, webgriffith, sqlalchemy
+
+[handlers]
+keys = console
+
+[formatters]
+keys = generic
+
+[logger_root]
+level = INFO
+handlers = console
+
+[logger_routes]
+level = INFO
+handlers =
+qualname = routes.middleware
+# "level = DEBUG" logs the route matched and routing variables.
+
+[logger_webgriffith]
+level = DEBUG
+handlers =
+qualname = webgriffith
+
+[logger_sqlalchemy]
+level = WARN
+handlers =
+qualname = sqlalchemy.engine
+# "level = INFO" logs SQL queries.
+# "level = DEBUG" logs SQL queries and results.
+# "level = WARN" logs neither.  (Recommended for production systems.)
+
+[handler_console]
+class = StreamHandler
+args = (sys.stderr,)
+level = NOTSET
+formatter = generic
+
+[formatter_generic]
+format = %(asctime)s,%(msecs)03d %(levelname)-5.5s [%(name)s] %(message)s
+datefmt = %H:%M:%S

Added: online/trunk/docs/index.txt
===================================================================
--- online/trunk/docs/index.txt	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/docs/index.txt	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,19 @@
+webgriffith
++++++++++++
+
+This is the main index page of your documentation. It should be written in
+`reStructuredText format <http://docutils.sourceforge.net/rst.html>`_.
+
+You can generate your documentation in HTML format by running this command::
+
+    setup.py pudge
+
+For this to work you will need to download and install `buildutils`_,
+`pudge`_, and `pygments`_.  The ``pudge`` command is disabled by
+default; to ativate it in your project, run::
+
+    setup.py addcommand -p buildutils.pudge_command
+
+.. _buildutils: http://pypi.python.org/pypi/buildutils
+.. _pudge: http://pudge.lesscode.org/
+.. _pygments: http://pygments.org/

Added: online/trunk/setup.cfg
===================================================================
--- online/trunk/setup.cfg	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/setup.cfg	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,31 @@
+[egg_info]
+tag_build = dev
+tag_svn_revision = true
+
+[easy_install]
+find_links = http://www.pylonshq.com/download/
+
+[nosetests]
+with-pylons = test.ini
+
+# Babel configuration
+[compile_catalog]
+domain = webgriffith
+directory = webgriffith/i18n
+statistics = true
+
+[extract_messages]
+add_comments = TRANSLATORS:
+output_file = webgriffith/i18n/webgriffith.pot
+width = 80
+
+[init_catalog]
+domain = webgriffith
+input_file = webgriffith/i18n/webgriffith.pot
+output_dir = webgriffith/i18n
+
+[update_catalog]
+domain = webgriffith
+input_file = webgriffith/i18n/webgriffith.pot
+output_dir = webgriffith/i18n
+previous = true

Added: online/trunk/setup.py
===================================================================
--- online/trunk/setup.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/setup.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,40 @@
+try:
+    from setuptools import setup, find_packages
+except ImportError:
+    print 'Please install setuptools'
+    import sys
+    sys.exit(-1)
+
+setup(
+    name='WebGriffith',
+    version='0.1~dev',
+    description='',
+    author='Piotr O?arowski',
+    author_email='piotr at griffith.cc',
+    url='http://online.griffith.cc',
+    install_requires=[
+        "Pylons>=0.9.7rc3",
+        "SQLAlchemy>=0.5rc4",
+        "Mako>=0.2.2",
+        "Beaker",
+        "Webhelpers",
+    ],
+    setup_requires=["PasteScript==dev,>=1.6.3dev-r7326"],
+    packages=find_packages(exclude=['ez_setup']),
+    include_package_data=True,
+    test_suite='nose.collector',
+    package_data={'webgriffith': ['i18n/*/LC_MESSAGES/*.mo']},
+    #message_extractors = {'webgriffith': [
+    #        ('**.py', 'python', None),
+    #        ('templates/**.mako', 'mako', None),
+    #        ('public/**', 'ignore', None)]},
+    zip_safe=False,
+    paster_plugins=['PasteScript', 'Pylons'],
+    entry_points="""
+    [paste.app_factory]
+    main = webgriffith.config.middleware:make_app
+
+    [paste.app_install]
+    main = pylons.util:PylonsInstaller
+    """,
+)

Added: online/trunk/test.ini
===================================================================
--- online/trunk/test.ini	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/test.ini	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,21 @@
+#
+# WebGriffith - Pylons testing environment configuration
+#
+# The %(here)s variable will be replaced with the parent directory of this file
+#
+[DEFAULT]
+debug = true
+# Uncomment and replace with the address which should receive any error reports
+#email_to = you at yourdomain.com
+smtp_server = localhost
+error_email_from = paste at localhost
+
+[server:main]
+use = egg:Paste#http
+host = 0.0.0.0
+port = 5000
+
+[app:main]
+use = config:development.ini
+
+# Add additional test specific configuration options as necessary.

Added: online/trunk/webgriffith/__init__.py
===================================================================

Added: online/trunk/webgriffith/config/__init__.py
===================================================================

Added: online/trunk/webgriffith/config/deployment.ini_tmpl
===================================================================
--- online/trunk/webgriffith/config/deployment.ini_tmpl	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/config/deployment.ini_tmpl	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,70 @@
+#
+# WebGriffith - Pylons configuration
+#
+# The %(here)s variable will be replaced with the parent directory of this file
+#
+[DEFAULT]
+debug = true
+email_to = you at localhost
+smtp_server = localhost
+error_email_from = webgriffith at localhost
+
+[server:main]
+use = egg:Paste#http
+host = 0.0.0.0
+port = 5000
+
+[app:main]
+use = egg:WebGriffith
+full_stack = true
+cache_dir = %(here)s/data
+beaker.session.key = webgriffith
+beaker.session.secret = ${app_instance_secret}
+app_instance_uuid = ${app_instance_uuid}
+
+# If you'd like to fine-tune the individual locations of the cache data dirs
+# for the Cache data, or the Session saves, un-comment the desired settings
+# here:
+#beaker.cache.data_dir = %(here)s/data/cache
+#beaker.session.data_dir = %(here)s/data/sessions
+
+# SQLAlchemy database URL
+sqlalchemy.url = sqlite:///griffith.db
+sqlalchemy.convert_unicode = true
+sqlalchemy.echo = False
+
+# WARNING: *THE LINE BELOW MUST BE UNCOMMENTED ON A PRODUCTION ENVIRONMENT*
+# Debug mode will enable the interactive debugging tool, allowing ANYONE to
+# execute malicious code after an exception is raised.
+set debug = false
+
+# session defaults:
+view.language = en
+view.template = default
+
+# other view settings:
+view.header = Griffith's movie list
+view.items_per_page = 20
+
+# Logging configuration
+[loggers]
+keys = root, routes, webgriffith, sqlalchemy
+
+[handlers]
+keys = console
+
+[formatters]
+keys = generic
+
+[logger_root]
+level = INFO
+handlers = console
+
+[handler_console]
+class = StreamHandler
+args = (sys.stderr,)
+level = NOTSET
+formatter = generic
+
+[formatter_generic]
+format = %(asctime)s %(levelname)-5.5s [%(name)s] %(message)s

Added: online/trunk/webgriffith/config/environment.py
===================================================================
--- online/trunk/webgriffith/config/environment.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/config/environment.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,46 @@
+"""Pylons environment configuration"""
+import os
+
+from mako.lookup import TemplateLookup
+from pylons.error import handle_mako_error
+from pylons import config
+from sqlalchemy import engine_from_config
+
+import webgriffith.lib.app_globals as app_globals
+import webgriffith.lib.helpers
+from webgriffith.config.routing import make_map
+from webgriffith.model import init_model
+
+def load_environment(global_conf, app_conf):
+    """Configure the Pylons environment via the ``pylons.config``
+    object
+    """
+    # Pylons paths
+    root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
+    paths = dict(root=root,
+                 controllers=os.path.join(root, 'controllers'),
+                 static_files=os.path.join(root, 'public'),
+                 templates=[os.path.join(root, 'templates')])
+
+    # Initialize config with the basic options
+    config.init_app(global_conf, app_conf, package='webgriffith', paths=paths)
+
+    config['routes.map'] = make_map()
+    config['pylons.app_globals'] = app_globals.Globals()
+    config['pylons.h'] = webgriffith.lib.helpers
+
+    # Create the Mako TemplateLookup, with the default auto-escaping
+    config['pylons.app_globals'].mako_lookup = TemplateLookup(
+        directories=paths['templates'],
+        error_handler=handle_mako_error,
+        module_directory=os.path.join(app_conf['cache_dir'], 'templates'),
+        input_encoding='utf-8', output_encoding='utf-8',
+        imports=['from webhelpers.html import escape'],
+        default_filters=['escape'])
+    
+    # Setup SQLAlchemy database engine
+    engine = engine_from_config(config, 'sqlalchemy.')
+    init_model(engine)
+    
+    # CONFIGURATION OPTIONS HERE (note: all config options will override
+    # any Pylons config options)

Added: online/trunk/webgriffith/config/middleware.py
===================================================================
--- online/trunk/webgriffith/config/middleware.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/config/middleware.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,64 @@
+"""Pylons middleware initialization"""
+from beaker.middleware import CacheMiddleware, SessionMiddleware
+from paste.cascade import Cascade
+from paste.registry import RegistryManager
+from paste.urlparser import StaticURLParser
+from paste.deploy.converters import asbool
+from pylons import config
+from pylons.middleware import ErrorHandler, StatusCodeRedirect
+from pylons.wsgiapp import PylonsApp
+from routes.middleware import RoutesMiddleware
+
+from webgriffith.config.environment import load_environment
+
+def make_app(global_conf, full_stack=True, **app_conf):
+    """Create a Pylons WSGI application and return it
+
+    ``global_conf``
+        The inherited configuration for this application. Normally from
+        the [DEFAULT] section of the Paste ini file.
+
+    ``full_stack``
+        Whether or not this application provides a full WSGI stack (by
+        default, meaning it handles its own exceptions and errors).
+        Disable full_stack when this application is "managed" by
+        another WSGI middleware.
+
+    ``app_conf``
+        The application's local configuration. Normally specified in
+        the [app:<name>] section of the Paste ini file (where <name>
+        defaults to main).
+
+    """
+    # Configure the Pylons environment
+    load_environment(global_conf, app_conf)
+
+    # The Pylons WSGI app
+    app = PylonsApp()
+    
+    # CUSTOM MIDDLEWARE HERE (filtered by error handling middlewares)
+    
+    # Routing/Session/Cache Middleware
+    app = RoutesMiddleware(app, config['routes.map'])
+    app = SessionMiddleware(app, config)
+    app = CacheMiddleware(app, config)
+    
+    if asbool(full_stack):
+        # Handle Python exceptions
+        app = ErrorHandler(app, global_conf, **config['pylons.errorware'])
+
+        # Display error documents for 401, 403, 404 status codes (and
+        # 500 when debug is disabled)
+        if asbool(config['debug']):
+            app = StatusCodeRedirect(app)
+        else:
+            app = StatusCodeRedirect(app, [400, 401, 403, 404, 500])
+
+    # Establish the Registry for this application
+    app = RegistryManager(app)
+
+    # Static files (If running in production, and Apache or another web 
+    # server is handling this static content, remove the following 2 lines)
+    static_app = StaticURLParser(config['pylons.paths']['static_files'])
+    app = Cascade([static_app, app])
+    return app

Added: online/trunk/webgriffith/config/routing.py
===================================================================
--- online/trunk/webgriffith/config/routing.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/config/routing.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,29 @@
+"""Routes configuration
+
+The more specific and detailed routes should be defined first so they
+may take precedent over the more generic routes. For more information
+refer to the routes manual at http://routes.groovie.org/docs/
+"""
+from pylons import config
+from routes import Mapper
+
+def make_map():
+    """Create, configure and return the routes Mapper"""
+    map = Mapper(directory=config['pylons.paths']['controllers'],
+                 always_scan=config['debug'])
+    map.minimization = False
+    
+    # The ErrorController route (handles 404/500 error pages); it should
+    # likely stay at the top, ensuring it can always be resolved
+    map.connect('/error/{action}', controller='error')
+    map.connect('/error/{action}/{id}', controller='error')
+
+    # CUSTOM ROUTES HERE
+
+    map.connect('/', controller='list', action='page', id=1)
+    map.connect('/list/{action}_{id}', controller='list', requirements={'id': r'\d+'})
+    map.connect('/{controller}', action='index')
+    map.connect('/{controller}/{action}')
+    map.connect('/{controller}/{action}/{id}', requirements={'id': r'\d+'})
+
+    return map

Added: online/trunk/webgriffith/controllers/__init__.py
===================================================================

Added: online/trunk/webgriffith/controllers/error.py
===================================================================
--- online/trunk/webgriffith/controllers/error.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/controllers/error.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,46 @@
+import cgi
+import os.path
+
+from paste.urlparser import PkgResourcesParser
+from pylons import request
+from pylons.controllers.util import forward
+from pylons.middleware import error_document_template
+from webhelpers.html.builder import literal
+
+from webgriffith.lib.base import BaseController
+
+class ErrorController(BaseController):
+    """Generates error documents as and when they are required.
+
+    The ErrorDocuments middleware forwards to ErrorController when error
+    related status codes are returned from the application.
+
+    This behaviour can be altered by changing the parameters to the
+    ErrorDocuments middleware in your config/middleware.py file.
+    
+    """
+    def document(self):
+        """Render the error document"""
+        resp = request.environ.get('pylons.original_response')
+        content = literal(resp.body) or cgi.escape(request.GET.get('message'))
+        page = error_document_template % \
+            dict(prefix=request.environ.get('SCRIPT_NAME', ''),
+                 code=cgi.escape(request.GET.get('code', str(resp.status_int))),
+                 message=content)
+        return page
+
+    def img(self, id):
+        """Serve Pylons' stock images"""
+        return self._serve_file('/'.join(['media/img', id]))
+
+    def style(self, id):
+        """Serve Pylons' stock stylesheets"""
+        return self._serve_file('/'.join(['media/style', id]))
+
+    def _serve_file(self, path):
+        """Call Paste's FileApp (a WSGI application) to serve the file
+        at the specified path
+        """
+        static = PkgResourcesParser('pylons', 'pylons')
+        request.environ['PATH_INFO'] = '/%s' % path
+        return static(request.environ, self.start_response)

Added: online/trunk/webgriffith/controllers/list.py
===================================================================
--- online/trunk/webgriffith/controllers/list.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/controllers/list.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,43 @@
+import logging
+
+from pylons import request, response, session, tmpl_context as c
+from pylons.controllers.util import abort, redirect_to
+from pylons.decorators.cache import beaker_cache
+from webhelpers import paginate
+from math import ceil
+
+#from webgriffith.lib.base import BaseController, render
+from webgriffith.lib.base import *
+from webgriffith import model
+
+log = logging.getLogger(__name__)
+
+class ListController(BaseController):
+
+    #@beaker_cache(expire=60, type='memory', query_args=True)
+    def page(self, id):
+        page_nr = int(id) # routes will allow \d+ only here, no worry
+
+        items_per_page = int(session['items_per_page'])
+        items = meta.Session.query(model.Movie)
+
+        page = paginate.Page(items, page=page_nr, items_per_page=items_per_page)
+
+        if 'partial' in request.params:
+            return render_def("/%s/list.mako" % session['template'], "showpage", movies=page)
+        else:
+            return render("/%s/list.mako" % session['template'], extra_vars={"movies": page})
+
+    def verbose(self, id):
+        page_nr = int(id) # routes will allow \d+ only here, no worry
+
+        items_per_page = int(session['items_per_page'])
+        items = meta.Session.query(model.Movie)
+
+        page = paginate.Page(items, page=page_nr, items_per_page=items_per_page)
+
+        if 'partial' in request.params:
+            return render_def("/%s/verbose_list.mako" % session['template'], "showpage", movies=page)
+        else:
+            return render("/%s/verbose_list.mako" % session['template'], extra_vars={"movies": page})
+

Added: online/trunk/webgriffith/controllers/movie.py
===================================================================
--- online/trunk/webgriffith/controllers/movie.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/controllers/movie.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,20 @@
+import logging
+
+from pylons import request, response, session, tmpl_context as c
+from pylons.controllers.util import abort, redirect_to
+
+from webgriffith.lib.base import *
+from webgriffith import model
+
+log = logging.getLogger(__name__)
+        
+
+class MovieController(BaseController):
+
+    def view(self, id):
+        movie = meta.Session.query(model.Movie).filter_by(number=id).first()
+        if movie:
+            c.movie = movie
+            return render("/%s/movie.mako" % session['template'])
+        else:
+            return abort(404)

Added: online/trunk/webgriffith/controllers/settings.py
===================================================================
--- online/trunk/webgriffith/controllers/settings.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/controllers/settings.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,40 @@
+import logging
+
+from pylons import request, response, session, tmpl_context as c
+from pylons.controllers.util import abort, redirect_to
+
+from webgriffith.lib.base import BaseController, render
+#from webgriffith import model
+
+log = logging.getLogger(__name__)
+
+class SettingsController(BaseController):
+
+    def index(self):
+        return render("/%s/settings.mako" % session['template'])
+
+    def set(self):
+        session_changed = False
+        if 'lang' in request.params:
+            lang = request.params['lang']
+            if lang in ('en', 'pl', 'de'): # TODO: get all supported translations via lib.get_translations()
+                session['lang'] = lang
+                session_changed = True
+        if 'tpl' in request.params:
+            template = request.params['tpl']
+            if template in ('default',): # TODO: get from lib.get_templates()
+                session['template'] = tpl
+                session_changed = True
+        if 'items' in request.params:
+            try:
+                items_per_page = int(request.params['items'])
+            except:
+                log.warning("Wrong number for items_per_page: %s", request.params['items_per_page'])
+            else:
+                if items_per_page < 2:
+                    items_per_page = 1
+                session['items_per_page'] = items_per_page
+                session_changed = True
+        if session_changed:
+            session.save()
+        redirect_to(action='index', id=None)

Added: online/trunk/webgriffith/i18n/en/LC_MESSAGES/webgriffith.mo
===================================================================
(Binary files differ)


Property changes on: online/trunk/webgriffith/i18n/en/LC_MESSAGES/webgriffith.mo
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: online/trunk/webgriffith/i18n/en/LC_MESSAGES/webgriffith.po
===================================================================
--- online/trunk/webgriffith/i18n/en/LC_MESSAGES/webgriffith.po	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/i18n/en/LC_MESSAGES/webgriffith.po	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,21 @@
+# Translations template for debexpo.
+# Copyright (C) 2008 ORGANIZATION
+# This file is distributed under the same license as the debexpo project.
+# FIRST AUTHOR <EMAIL at ADDRESS>, 2008.
+#
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: webgriffith 0.0.0\n"
+"Report-Msgid-Bugs-To: EMAIL at ADDRESS\n"
+"POT-Creation-Date: 2008-11-20 22:00+0200\n"
+"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
+"Last-Translator: FULL NAME <EMAIL at ADDRESS>\n"
+"Language-Team: LANGUAGE <LL at li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=utf-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+
+
+msgid "Yes"
+msgstr "TAK"

Added: online/trunk/webgriffith/i18n/webgriffith.pot
===================================================================
--- online/trunk/webgriffith/i18n/webgriffith.pot	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/i18n/webgriffith.pot	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,21 @@
+# Translations template for debexpo.
+# Copyright (C) 2008 ORGANIZATION
+# This file is distributed under the same license as the debexpo project.
+# FIRST AUTHOR <EMAIL at ADDRESS>, 2008.
+#
+#, fuzzy
+msgid ""
+msgstr ""
+"Project-Id-Version: webgriffith 0.0.0\n"
+"Report-Msgid-Bugs-To: EMAIL at ADDRESS\n"
+"POT-Creation-Date: 2008-11-20 22:00+0200\n"
+"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
+"Last-Translator: FULL NAME <EMAIL at ADDRESS>\n"
+"Language-Team: LANGUAGE <LL at li.org>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=utf-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+
+
+msgid "Yes"
+msgstr "TAK"

Added: online/trunk/webgriffith/lib/__init__.py
===================================================================

Added: online/trunk/webgriffith/lib/app_globals.py
===================================================================
--- online/trunk/webgriffith/lib/app_globals.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/lib/app_globals.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,14 @@
+"""The application's Globals object"""
+
+class Globals(object):
+    """Globals acts as a container for objects available throughout the
+    life of the application
+
+    """
+    def __init__(self):
+        """One instance of Globals is created during application
+        initialization and is available during requests via the
+        'app_globals' variable
+
+        """
+        pass

Added: online/trunk/webgriffith/lib/base.py
===================================================================
--- online/trunk/webgriffith/lib/base.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/lib/base.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,55 @@
+"""The base Controller API
+
+Provides the BaseController class for subclassing.
+"""
+from pylons.controllers import WSGIController
+from pylons.templating import pylons_globals, render_mako as render
+from pylons import c, config, session
+#from pylons.i18n import _, ungettext, N_, get_lang, set_lang
+from pylons.i18n import _, get_lang, set_lang, add_fallback
+
+from webgriffith.model import meta
+
+class BaseController(WSGIController):
+
+    def __call__(self, environ, start_response):
+        """Invoke the Controller"""
+        # WSGIController.__call__ dispatches to the Controller method
+        # the request is routed to. This routing information is
+        # available in environ['pylons.routes_dict']
+        try:
+            return WSGIController.__call__(self, environ, start_response)
+        finally:
+            meta.Session.remove()
+        
+    def __before__(self):
+        session_changed = False
+        if 'lang' not in session:
+            session['lang'] = config["view.language"]
+            session_changed = True
+        if 'template' not in session:
+            session['template'] = config["view.template"]
+            session_changed = True
+        if 'items_per_page' not in session:
+            session['items_per_page'] = config["view.items_per_page"]
+
+        if session_changed:
+            session.save()
+
+        set_lang(session['lang'])
+        #add_fallback('griffith')
+
+        c.config = config
+        c.session = session
+        c.header = config["view.header"]
+
+
+def render_def(template_name, name, **kwargs):
+    globs = pylons_globals()
+ 
+    if kwargs:
+        globs = globs.copy()
+        globs.update(kwargs)
+ 
+    template = globs['app_globals'].mako_lookup.get_template(template_name).get_def(name)
+    return template.render(**globs)

Added: online/trunk/webgriffith/lib/helpers.py
===================================================================
--- online/trunk/webgriffith/lib/helpers.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/lib/helpers.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,9 @@
+"""Helper functions
+
+Consists of functions to typically be used within templates, but also
+available to Controllers. This module is available to both as 'h'.
+"""
+# Import helpers as desired, or define your own, ie:
+# from webhelpers.html.tags import checkbox, password
+from webhelpers.html.tags import javascript_link
+from routes import url_for

Added: online/trunk/webgriffith/model/__init__.py
===================================================================
--- online/trunk/webgriffith/model/__init__.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/model/__init__.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,39 @@
+"""The application's model objects"""
+import sqlalchemy as sa
+from sqlalchemy import orm
+
+from webgriffith.model import meta
+from webgriffith.model.db import *
+
+def init_model(engine):
+    """Call me before using any of the tables or classes in the model"""
+    ## Reflected tables must be defined and mapped here
+    #global reflected_table
+    #reflected_table = sa.Table("Reflected", meta.metadata, autoload=True,
+    #                           autoload_with=engine)
+    #orm.mapper(Reflected, reflected_table)
+
+    sm = orm.sessionmaker(autoflush=True, autocommit=False, bind=engine)
+
+    meta.engine = engine
+    meta.Session = orm.scoped_session(sm)
+
+
+## Non-reflected tables may be defined and mapped at module level
+#foo_table = sa.Table("Foo", meta.metadata,
+#    sa.Column("id", sa.types.Integer, primary_key=True),
+#    sa.Column("bar", sa.types.String(255), nullable=False),
+#    )
+#
+#class Foo(object):
+#    pass
+#
+#orm.mapper(Foo, foo_table)
+
+
+## Classes for reflected tables may be defined here, but the table and
+## mapping itself must be done in the init_model function
+#reflected_table = None
+#
+#class Reflected(object):
+#    pass

Added: online/trunk/webgriffith/model/db.py
===================================================================
--- online/trunk/webgriffith/model/db.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/model/db.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,432 @@
+# -*- coding: UTF-8 -*-
+# vim: fdm=marker
+__revision__ = '$Id: $'
+
+# Copyright (c) 2008 Vasco Nunes, Piotr O?arowski
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Library General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
+
+# You may use and distribute this software under the terms of the
+# GNU General Public License, version 2 or later
+
+
+# XXX: keep stdlib and SQLAlchemy imports only in this file
+
+from sqlalchemy     import *
+from sqlalchemy.orm import mapper, relation, sessionmaker, validates
+import re
+import string
+import logging
+import marshal
+log = logging.getLogger("Griffith")
+
+EMAIL_PATTERN = re.compile('^[a-z0-9]+[.a-z0-9_+-]*@[a-z0-9_-]+(\.[a-z0-9_-]+)+$', re.IGNORECASE)
+metadata = MetaData()
+
+class DBTable(object):#{{{
+    def __init__(self, **kwargs):
+        for i in kwargs:
+            if hasattr(self, i):
+                setattr(self, i, kwargs[i])
+            else:
+                log.warn("%s.%s not set", self.__class__.__name__, i)
+    def __repr__(self):
+        return "<%s:%s>" % (self.__class__.__name__, self.name.encode('utf-8'))
+
+    @validates('name')
+    def _validate_name(self, key, name):
+        if not name or not name.strip():
+            log.warning("%s: empty name (%s)", self.__class__.__name__, name)
+            raise ValueError(_("Name cannot be empty"))
+        return name.strip()
+
+    def remove_from_db(self):
+        dbtable_id = self.__dict__[self.__class__.__name__.lower() + '_id']
+        if dbtable_id<1:
+            log.info("%s: none selected => none removed", self.__class__.__name__)
+            return False
+        tmp = None
+        if hasattr(self,'movies'):
+            tmp = getattr(self,'movies')
+        elif hasattr(self,'movielangs'):
+            tmp = getattr(self,'movielangs')
+        if tmp and len(tmp)>0:
+            gutils.warning(self, msg=_("This item is in use.\nOperation aborted!"))
+            return False
+        log.info("%s: removing '%s' (id=%s) from database...", self.__class__.__name__, self.name, dbtable_id)
+        self.delete()
+        try:
+            self.flush()
+        except exceptions.SQLError, e:
+            log.info("%s: remove_from_db: %s", self.__class__.__name__, e)
+            return False
+        #self.refresh()
+        return True
+    def update_in_db(self):
+        dbtable_id = self.__dict__[self.__class__.__name__.lower() + '_id']
+        if dbtable_id<1:
+            log.info("%s: none selected => none updated", self.__class__.__name__)
+            return False
+        tmp = self.query.filter_by(name=self.name).first()
+        if tmp is not None and tmp is not self:
+            gutils.warning(self, msg=_("This name is already in use!"))
+            return False
+        self.update()
+        try:
+            self.flush()
+        except exceptions.SQLError, e:
+            log.info("%s: update_in_db: %s", self.__class__.__name__, e)
+            return False
+        self.refresh()
+        return True
+     #}}}
+
+### clases #################################################### {{{
+class AChannel(DBTable):
+    pass
+
+class ACodec(DBTable):
+    pass
+
+class Collection(DBTable):
+    pass
+
+class Lang(DBTable):
+    pass
+
+class Medium(DBTable):
+    pass
+
+class Person(DBTable):
+    @validates('email')
+    def _validate_email(self, key, address):
+        address = address.strip()
+        if not EMAIL_PATTERN.match(address):
+            log.warning("%s: email address is not valid (%s)", self.__class__.__name__, address)
+            raise ValueError(_("E-mail address is not valid"))
+        return address
+
+    @validates('phone')
+    def _digits_only(self, key, value):
+        """removes non-digits"""
+        allchars = string.maketrans('', '')
+        delchars = allchars.translate(allchars, string.digits)
+        return unicode(str(value).translate(allchars, delchars))
+
+class Ratio(DBTable):
+    pass
+
+class SubFormat(DBTable):
+    pass
+
+class Tag(DBTable):
+    pass
+
+class VCodec(DBTable):
+    pass
+
+class Volume(DBTable):
+    pass
+
+class Poster(object):
+    def __init__(self, md5sum=None, data=None):
+        if md5sum and data:
+            if len(md5sum) == 32:
+                self.md5sum = md5sum
+                self.data = data
+            else:
+                log.error("md5sum has wrong size")
+
+    def __repr__(self):
+        return "<Poster(%s)>" % self.md5sum
+
+class Configuration(object):
+    def __repr__(self):
+        return "<Config:%s=%s>" % (self.param, self.value)
+
+class Loan(object):
+    def __repr__(self):
+        return "<Loan:%s (movie:%s person:%s)>" % (self.loan_id, self.movie_id, self.person_id)
+
+class Movie(object):
+    def __repr__(self):
+        return "<Movie:%s (number=%s)>" % (self.movie_id, self.number)
+    def __contains__(self, name):
+        if name in ('volume','collection','medium','vcodec','loans','tags','languages','lectors','dubbings','subtitles'): return True
+        else: return name in movies_table.columns
+    def __getitem__(self, name):
+        if name in self:
+            return getattr(self, name)
+        else: raise AttributeError, name
+
+class MovieLang(object):
+    def __init__(self, lang_id=None, type=None, acodec_id=None, achannel_id=None, subformat_id=None):
+        self.lang_id      = lang_id
+        self.type         = type
+        self.acodec_id    = acodec_id
+        self.achannel_id  = achannel_id
+        self.subformat_id = subformat_id
+    def __repr__(self):
+        return "<MovieLang:%s-%s (Type:%s ACodec:%s AChannel:%s SubFormat:%s)>" % \
+            (self.movie_id, self.lang_id, self.type, self.acodec_id, self.achannel_id, self.subformat_id)
+
+class MovieTag(object):
+    def __init__(self, tag_id=None):
+        self.tag_id = tag_id
+    def __repr__(self):
+        return "<MovieTag:%s-%s>" % (self.movie_id, self.tag_id)
+
+class Filter(object):
+    def __init__(self, name=None, cond=None):
+        if name and cond:
+            self.name = name
+            #self.data = marshal.dumps(cond)
+            self.conditions = cond
+    def __repr__(self):
+        return "<Filter(%s)>" % self.name
+    def _set_cond(self, cond):
+        self.data = marshal.dumps(cond)
+    def _get_cond(self):
+        return marshal.loads(self.data)
+    conditions = property(_get_cond, _set_cond)
+#}}}
+
+### table definitions ######################################### {{{
+movies_table = Table('movies', metadata,
+    Column('movie_id', Integer, primary_key = True),
+    Column('number', Integer, nullable=False, unique=True),
+    Column('collection_id', Integer, ForeignKey('collections.collection_id')),
+    Column('volume_id', Integer, ForeignKey('volumes.volume_id')),
+    Column('medium_id', Integer, ForeignKey('media.medium_id')),
+    Column('ratio_id', Integer, ForeignKey('ratios.ratio_id')),
+    Column('vcodec_id', Integer, ForeignKey('vcodecs.vcodec_id')),
+    Column('loaned', Boolean, nullable=False, default=False),
+    Column('seen', Boolean, nullable=False, default=False),
+    Column('rating', SmallInteger(2)),
+    Column('color', SmallInteger),
+    Column('cond', SmallInteger),    # MySQL will not accept name "condition"
+    Column('layers', SmallInteger),
+    Column('region', SmallInteger),
+    Column('media_num', SmallInteger),
+    Column('runtime', Integer),
+    Column('year', Integer),
+    Column('o_title', Unicode(256)),
+    Column('title', Unicode(256)),
+    Column('director', Unicode(256)),
+    Column('screenplay', Unicode(256)),
+    Column('cameraman', Unicode(256)),
+    Column('o_site', Unicode(256)),
+    Column('site', Unicode(256)),
+    Column('trailer', Unicode(256)),
+    Column('country', Unicode(128)),
+    Column('genre', Unicode(128)),
+    Column('image', Unicode(128)), # XXX: deprecated
+    Column('poster_md5', Unicode(32), ForeignKey('posters.md5sum')),
+    Column('studio', Unicode(128)),
+    Column('classification', Unicode(128)),
+    Column('cast', TEXT),
+    Column('plot', TEXT),
+    Column('notes', TEXT))
+
+loans_table = Table('loans', metadata,
+    Column('loan_id', Integer, primary_key=True),
+    Column('person_id', Integer, ForeignKey('people.person_id'), nullable=False),
+    Column('movie_id', Integer, ForeignKey('movies.movie_id'), nullable=False),
+    Column('volume_id', Integer, ForeignKey('volumes.volume_id')),
+    Column('collection_id', Integer, ForeignKey('collections.collection_id')),
+    Column('date', Date, nullable=False, default=func.current_date()),
+    Column('return_date', Date, nullable=True))
+
+people_table = Table('people', metadata,
+    Column('person_id', Integer, primary_key=True),
+    Column('name', Unicode(256), nullable=False, unique=True),
+    Column('email', Unicode(128)),
+    Column('phone', Unicode(64)))
+
+volumes_table = Table('volumes', metadata,
+    Column('volume_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True),
+    Column('loaned', Boolean, nullable=False, default=False))
+
+collections_table = Table('collections', metadata,
+    Column('collection_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True),
+    Column('loaned', Boolean, nullable=False, default=False))
+
+media_table = Table('media', metadata,
+    Column('medium_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True))
+
+ratios_table = Table('ratios', metadata,
+    Column('ratio_id', Integer, primary_key=True),
+    Column('name', Unicode(5), nullable=False, unique=True))
+
+languages_table = Table('languages', metadata,
+    Column('lang_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True))
+
+vcodecs_table = Table('vcodecs', metadata,
+    Column('vcodec_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True))
+
+acodecs_table = Table('acodecs', metadata,
+    Column('acodec_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True))
+
+achannels_table = Table('achannels', metadata,
+    Column('achannel_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True))
+
+subformats_table = Table('subformats', metadata,
+    Column('subformat_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True))
+
+tags_table = Table('tags', metadata,
+    Column('tag_id', Integer, primary_key=True),
+    Column('name', Unicode(64), nullable=False, unique=True))
+
+movie_lang_table = Table('movie_lang', metadata,
+    Column('ml_id', Integer, primary_key=True),
+    Column('type', SmallInteger), # 0: Original, 1:lector, 2:dubbing, 3:subtitle
+    Column('movie_id', Integer, ForeignKey('movies.movie_id'), nullable=False),
+    Column('lang_id', Integer, ForeignKey('languages.lang_id'), nullable=False),
+    Column('acodec_id', Integer, ForeignKey('acodecs.acodec_id')),
+    Column('achannel_id', Integer, ForeignKey('achannels.achannel_id')),
+    Column('subformat_id', Integer, ForeignKey('subformats.subformat_id')))
+
+movie_tag_table = Table('movie_tag', metadata,
+    Column('mt_id', Integer, primary_key=True),
+    Column('movie_id', Integer, ForeignKey('movies.movie_id')),
+    Column('tag_id', Integer, ForeignKey('tags.tag_id')))
+
+configuration_table = Table('configuration', metadata,
+    Column('param', Unicode(16), primary_key=True),
+    Column('value', Unicode(128), nullable=False))
+
+posters_table = Table('posters', metadata,
+    Column('md5sum', Unicode(32), primary_key=True),
+    Column('data', BLOB, nullable=False))
+
+filters_table = Table('filters', metadata,
+    Column('name', Unicode(64), primary_key=True),
+    Column('data', BLOB, nullable=False))
+
+tables = {
+    'movies':         movies_table,
+    'loans':          loans_table,
+    'people':         people_table,
+    'volumes':        volumes_table,
+    'collections':    collections_table,
+    'media':          media_table,
+    'ratios':         ratios_table,
+    'languages':      languages_table,
+    'vcodecs':        vcodecs_table,
+    'acodecs':        acodecs_table,
+    'achannels':      achannels_table,
+    'subformats':     subformats_table,
+    'tags':           tags_table,
+    'movie_lang':     movie_lang_table,
+    'movie_tag':      movie_tag_table,
+    'configuration':  configuration_table,
+    'posters':        posters_table,
+    'filters':        filters_table}
+#}}}
+
+### mappers ################################################### {{{
+mapper(Configuration, configuration_table)
+mapper(Volume, volumes_table, order_by=volumes_table.c.name, properties={
+    'movies': relation(Movie, backref='volume')})
+mapper(Collection, collections_table, order_by=collections_table.c.name, properties={
+    'movies': relation(Movie, backref='collection')})
+mapper(Medium, media_table, properties={
+    'movies': relation(Movie, backref='medium')})
+mapper(Ratio, ratios_table, properties={
+    'movies': relation(Movie, backref='ratio')})
+mapper(VCodec, vcodecs_table, properties={
+    'movies': relation(Movie, backref='vcodec')})
+mapper(Person, people_table, properties = {
+    'loans'    : relation(Loan, backref='person', cascade='all, delete-orphan')})
+mapper(MovieLang, movie_lang_table, primary_key=[movie_lang_table.c.ml_id], properties = {
+    'movie'    : relation(Movie),
+    'language' : relation(Lang),
+    'achannel' : relation(AChannel),
+    'acodec'   : relation(ACodec),
+    'subformat': relation(SubFormat)})
+mapper(ACodec, acodecs_table, properties={
+    'movielangs': relation(MovieLang)})
+mapper(AChannel, achannels_table, properties={
+    'movielangs': relation(MovieLang)})
+mapper(SubFormat, subformats_table, properties={
+    'movielangs': relation(MovieLang)})
+mapper(Lang, languages_table, properties={
+    'movielangs': relation(MovieLang)})
+mapper(MovieTag, movie_tag_table)
+mapper(Tag, tags_table, properties={'movietags': relation(MovieTag, backref='tag')})
+mapper(Loan, loans_table, properties = {
+    'volume'    : relation(Volume),
+    'collection': relation(Collection)})
+mapper(Movie, movies_table, order_by=movies_table.c.number , properties = {
+    'loans'     : relation(Loan, backref='movie', cascade='all, delete-orphan'),
+    #'tags'       : relation(Tag, cascade='all, delete-orphan', secondary=movie_tag,
+    'tags'      : relation(Tag, secondary=movie_tag_table,
+                           primaryjoin=movies_table.c.movie_id==movie_tag_table.c.movie_id,
+                           secondaryjoin=movie_tag_table.c.tag_id==tags_table.c.tag_id),
+    'languages' : relation(MovieLang, cascade='all, delete-orphan')})
+mapper(Poster, posters_table, properties={
+    'movies': relation(Movie)})
+mapper(Filter, filters_table)
+#}}}
+
+
+
+# for debugging (run: ipython db.py)
+if __name__ == '__main__':
+    import os.path
+    import sqlalchemy
+    logging.basicConfig()
+    log.setLevel(logging.INFO)
+    log.info("SQLAlchemy version: %s", sqlalchemy.__version__)
+
+    ### ENGINE ###
+    engine_mem = create_engine('sqlite:///:memory:', echo=False)
+
+    # create tables
+    metadata.create_all(engine_mem)
+
+    ### MEMORY SESSION ###
+    # create a configured "Session" class
+    Session = sessionmaker(bind=engine_mem)
+    # create a Session
+    sess_mem = Session()
+
+
+    griffith_dir = os.path.expanduser("~/.griffith/")
+    url = "sqlite:///%s" % os.path.join(griffith_dir, 'griffith.db')
+    engine_my = create_engine(url, echo=False)
+    Session2 = sessionmaker(bind=engine_my)
+    sess_my = Session2()
+
+    print "\nAvailable variables:"
+    print "sess_my:  %s" % sess_my
+    print "sess_mem: %s" % sess_mem
+
+    movie1_my = sess_my.query(Movie).first()
+    if movie1_my:
+        movie1_mem = sess_mem.merge(movie1_my)
+        movie1_mem.title = u'updated movie title'
+        sess_mem.add(movie1_mem)
+        sess_mem.commit()
+        print "movie1_my:  %s - title: %s" % (movie1_my, movie1_my.title)
+        print "movie1_mem: %s - title: %s" % (movie1_mem, movie1_mem.title)

Added: online/trunk/webgriffith/model/meta.py
===================================================================
--- online/trunk/webgriffith/model/meta.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/model/meta.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,16 @@
+"""SQLAlchemy Metadata and Session object"""
+from sqlalchemy import MetaData
+from sqlalchemy.orm import scoped_session, sessionmaker
+
+#__all__ = ['engine', 'metadata', 'Session']
+__all__ = ['Session', 'metadata']
+
+# SQLAlchemy database engine.  Updated by model.init_model()
+engine = None
+
+# SQLAlchemy session manager.  Updated by model.init_model()
+Session = None
+
+# Global metadata. If you have multiple databases with overlapping table
+# names, you'll need a metadata for each database
+metadata = MetaData()

Added: online/trunk/webgriffith/public/bg.png
===================================================================
(Binary files differ)


Property changes on: online/trunk/webgriffith/public/bg.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: online/trunk/webgriffith/public/js/jquery.min.js
===================================================================
--- online/trunk/webgriffith/public/js/jquery.min.js	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/public/js/jquery.min.js	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,32 @@
+/*
+ * jQuery 1.2.6 - New Wave Javascript
+ *
+ * Copyright (c) 2008 John Resig (jquery.com)
+ * Dual licensed under the MIT (MIT-LICENSE.txt)
+ * and GPL (GPL-LICENSE.txt) licenses.
+ *
+ * $Date: 2008-05-24 14:22:17 -0400 (Sat, 24 May 2008) $
+ * $Rev: 5685 $
+ */
+(function(){var _jQuery=window.jQuery,_$=window.$;var jQuery=window.jQuery=window.$=function(selector,context){return new jQuery.fn.init(selector,context);};var quickExpr=/^[^<]*(<(.|\s)+>)[^>]*$|^#(\w+)$/,isSimple=/^.[^:#\[\.]*$/,undefined;jQuery.fn=jQuery.prototype={init:function(selector,context){selector=selector||document;if(selector.nodeType){this[0]=selector;this.length=1;return this;}if(typeof selector=="string"){var match=quickExpr.exec(selector);if(match&&(match[1]||!context)){if(match[1])selector=jQuery.clean([match[1]],context);else{var elem=document.getElementById(match[3]);if(elem){if(elem.id!=match[3])return jQuery().find(selector);return jQuery(elem);}selector=[];}}else
+return jQuery(context).find(selector);}else if(jQuery.isFunction(selector))return jQuery(document)[jQuery.fn.ready?"ready":"load"](selector);return this.setArray(jQuery.makeArray(selector));},jquery:"1.2.6",size:function(){return this.length;},length:0,get:function(num){return num==undefined?jQuery.makeArray(this):this[num];},pushStack:function(elems){var ret=jQuery(elems);ret.prevObject=this;return ret;},setArray:function(elems){this.length=0;Array.prototype.push.apply(this,elems);return this;},each:function(callback,args){return jQuery.each(this,callback,args);},index:function(elem){var ret=-1;return jQuery.inArray(elem&&elem.jquery?elem[0]:elem,this);},attr:function(name,value,type){var options=name;if(name.constructor==String)if(value===undefined)return this[0]&&jQuery[type||"attr"](this[0],name);else{options={};options[name]=value;}return this.each(function(i){for(name in options)jQuery.attr(type?this.style:this,name,jQuery.prop(this,options[name],type,i,name));});},cs!
 s:function(key,value){if((key=='width'||key=='height')&&parseFloat(value)<0)value=undefined;return this.attr(key,value,"curCSS");},text:function(text){if(typeof text!="object"&&text!=null)return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text));var ret="";jQuery.each(text||this,function(){jQuery.each(this.childNodes,function(){if(this.nodeType!=8)ret+=this.nodeType!=1?this.nodeValue:jQuery.fn.text([this]);});});return ret;},wrapAll:function(html){if(this[0])jQuery(html,this[0].ownerDocument).clone().insertBefore(this[0]).map(function(){var elem=this;while(elem.firstChild)elem=elem.firstChild;return elem;}).append(this);return this;},wrapInner:function(html){return this.each(function(){jQuery(this).contents().wrapAll(html);});},wrap:function(html){return this.each(function(){jQuery(this).wrapAll(html);});},append:function(){return this.domManip(arguments,true,false,function(elem){if(this.nodeType==1)this.appendChild(elem);});},prepend:funct!
 ion(){return this.domManip(arguments,true,true,function(elem){!
 if(this.
nodeType==1)this.insertBefore(elem,this.firstChild);});},before:function(){return this.domManip(arguments,false,false,function(elem){this.parentNode.insertBefore(elem,this);});},after:function(){return this.domManip(arguments,false,true,function(elem){this.parentNode.insertBefore(elem,this.nextSibling);});},end:function(){return this.prevObject||jQuery([]);},find:function(selector){var elems=jQuery.map(this,function(elem){return jQuery.find(selector,elem);});return this.pushStack(/[^+>] [^+>]/.test(selector)||selector.indexOf("..")>-1?jQuery.unique(elems):elems);},clone:function(events){var ret=this.map(function(){if(jQuery.browser.msie&&!jQuery.isXMLDoc(this)){var clone=this.cloneNode(true),container=document.createElement("div");container.appendChild(clone);return jQuery.clean([container.innerHTML])[0];}else
+return this.cloneNode(true);});var clone=ret.find("*").andSelf().each(function(){if(this[expando]!=undefined)this[expando]=null;});if(events===true)this.find("*").andSelf().each(function(i){if(this.nodeType==3)return;var events=jQuery.data(this,"events");for(var type in events)for(var handler in events[type])jQuery.event.add(clone[i],type,events[type][handler],events[type][handler].data);});return ret;},filter:function(selector){return this.pushStack(jQuery.isFunction(selector)&&jQuery.grep(this,function(elem,i){return selector.call(elem,i);})||jQuery.multiFilter(selector,this));},not:function(selector){if(selector.constructor==String)if(isSimple.test(selector))return this.pushStack(jQuery.multiFilter(selector,this,true));else
+selector=jQuery.multiFilter(selector,this);var isArrayLike=selector.length&&selector[selector.length-1]!==undefined&&!selector.nodeType;return this.filter(function(){return isArrayLike?jQuery.inArray(this,selector)<0:this!=selector;});},add:function(selector){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),typeof selector=='string'?jQuery(selector):jQuery.makeArray(selector))));},is:function(selector){return!!selector&&jQuery.multiFilter(selector,this).length>0;},hasClass:function(selector){return this.is("."+selector);},val:function(value){if(value==undefined){if(this.length){var elem=this[0];if(jQuery.nodeName(elem,"select")){var index=elem.selectedIndex,values=[],options=elem.options,one=elem.type=="select-one";if(index<0)return null;for(var i=one?index:0,max=one?index+1:options.length;i<max;i++){var option=options[i];if(option.selected){value=jQuery.browser.msie&&!option.attributes.value.specified?option.text:option.value;if(one)return value;values.push(valu!
 e);}}return values;}else
+return(this[0].value||"").replace(/\r/g,"");}return undefined;}if(value.constructor==Number)value+='';return this.each(function(){if(this.nodeType!=1)return;if(value.constructor==Array&&/radio|checkbox/.test(this.type))this.checked=(jQuery.inArray(this.value,value)>=0||jQuery.inArray(this.name,value)>=0);else if(jQuery.nodeName(this,"select")){var values=jQuery.makeArray(value);jQuery("option",this).each(function(){this.selected=(jQuery.inArray(this.value,values)>=0||jQuery.inArray(this.text,values)>=0);});if(!values.length)this.selectedIndex=-1;}else
+this.value=value;});},html:function(value){return value==undefined?(this[0]?this[0].innerHTML:null):this.empty().append(value);},replaceWith:function(value){return this.after(value).remove();},eq:function(i){return this.slice(i,i+1);},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments));},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},andSelf:function(){return this.add(this.prevObject);},data:function(key,value){var parts=key.split(".");parts[1]=parts[1]?"."+parts[1]:"";if(value===undefined){var data=this.triggerHandler("getData"+parts[1]+"!",[parts[0]]);if(data===undefined&&this.length)data=jQuery.data(this[0],key);return data===undefined&&parts[1]?this.data(parts[0]):data;}else
+return this.trigger("setData"+parts[1]+"!",[parts[0],value]).each(function(){jQuery.data(this,key,value);});},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});},domManip:function(args,table,reverse,callback){var clone=this.length>1,elems;return this.each(function(){if(!elems){elems=jQuery.clean(args,this.ownerDocument);if(reverse)elems.reverse();}var obj=this;if(table&&jQuery.nodeName(this,"table")&&jQuery.nodeName(elems[0],"tr"))obj=this.getElementsByTagName("tbody")[0]||this.appendChild(this.ownerDocument.createElement("tbody"));var scripts=jQuery([]);jQuery.each(elems,function(){var elem=clone?jQuery(this).clone(true)[0]:this;if(jQuery.nodeName(elem,"script"))scripts=scripts.add(elem);else{if(elem.nodeType==1)scripts=scripts.add(jQuery("script",elem).remove());callback.call(obj,elem);}});scripts.each(evalScript);});}};jQuery.fn.init.prototype=jQuery.fn;function evalScript(i,elem){if(elem.src)jQuery.ajax({url:elem.src,async:false,dataTyp!
 e:"script"});else
+jQuery.globalEval(elem.text||elem.textContent||elem.innerHTML||"");if(elem.parentNode)elem.parentNode.removeChild(elem);}function now(){return+new Date;}jQuery.extend=jQuery.fn.extend=function(){var target=arguments[0]||{},i=1,length=arguments.length,deep=false,options;if(target.constructor==Boolean){deep=target;target=arguments[1]||{};i=2;}if(typeof target!="object"&&typeof target!="function")target={};if(length==i){target=this;--i;}for(;i<length;i++)if((options=arguments[i])!=null)for(var name in options){var src=target[name],copy=options[name];if(target===copy)continue;if(deep&&copy&&typeof copy=="object"&&!copy.nodeType)target[name]=jQuery.extend(deep,src||(copy.length!=null?[]:{}),copy);else if(copy!==undefined)target[name]=copy;}return target;};var expando="jQuery"+now(),uuid=0,windowData={},exclude=/z-?index|font-?weight|opacity|zoom|line-?height/i,defaultView=document.defaultView||{};jQuery.extend({noConflict:function(deep){window.$=_$;if(deep)window.jQuery=_jQuery;!
 return jQuery;},isFunction:function(fn){return!!fn&&typeof fn!="string"&&!fn.nodeName&&fn.constructor!=Array&&/^[\s[]?function/.test(fn+"");},isXMLDoc:function(elem){return elem.documentElement&&!elem.body||elem.tagName&&elem.ownerDocument&&!elem.ownerDocument.body;},globalEval:function(data){data=jQuery.trim(data);if(data){var head=document.getElementsByTagName("head")[0]||document.documentElement,script=document.createElement("script");script.type="text/javascript";if(jQuery.browser.msie)script.text=data;else
+script.appendChild(document.createTextNode(data));head.insertBefore(script,head.firstChild);head.removeChild(script);}},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()==name.toUpperCase();},cache:{},data:function(elem,name,data){elem=elem==window?windowData:elem;var id=elem[expando];if(!id)id=elem[expando]=++uuid;if(name&&!jQuery.cache[id])jQuery.cache[id]={};if(data!==undefined)jQuery.cache[id][name]=data;return name?jQuery.cache[id][name]:id;},removeData:function(elem,name){elem=elem==window?windowData:elem;var id=elem[expando];if(name){if(jQuery.cache[id]){delete jQuery.cache[id][name];name="";for(name in jQuery.cache[id])break;if(!name)jQuery.removeData(elem);}}else{try{delete elem[expando];}catch(e){if(elem.removeAttribute)elem.removeAttribute(expando);}delete jQuery.cache[id];}},each:function(object,callback,args){var name,i=0,length=object.length;if(args){if(length==undefined){for(name in object)if(callback.apply(object[name],args)===fa!
 lse)break;}else
+for(;i<length;)if(callback.apply(object[i++],args)===false)break;}else{if(length==undefined){for(name in object)if(callback.call(object[name],name,object[name])===false)break;}else
+for(var value=object[0];i<length&&callback.call(value,i,value)!==false;value=object[++i]){}}return object;},prop:function(elem,value,type,i,name){if(jQuery.isFunction(value))value=value.call(elem,i);return value&&value.constructor==Number&&type=="curCSS"&&!exclude.test(name)?value+"px":value;},className:{add:function(elem,classNames){jQuery.each((classNames||"").split(/\s+/),function(i,className){if(elem.nodeType==1&&!jQuery.className.has(elem.className,className))elem.className+=(elem.className?" ":"")+className;});},remove:function(elem,classNames){if(elem.nodeType==1)elem.className=classNames!=undefined?jQuery.grep(elem.className.split(/\s+/),function(className){return!jQuery.className.has(classNames,className);}).join(" "):"";},has:function(elem,className){return jQuery.inArray(className,(elem.className||elem).toString().split(/\s+/))>-1;}},swap:function(elem,options,callback){var old={};for(var name in options){old[name]=elem.style[name];elem.style[name]=options[name];!
 }callback.call(elem);for(var name in options)elem.style[name]=old[name];},css:function(elem,name,force){if(name=="width"||name=="height"){var val,props={position:"absolute",visibility:"hidden",display:"block"},which=name=="width"?["Left","Right"]:["Top","Bottom"];function getWH(){val=name=="width"?elem.offsetWidth:elem.offsetHeight;var padding=0,border=0;jQuery.each(which,function(){padding+=parseFloat(jQuery.curCSS(elem,"padding"+this,true))||0;border+=parseFloat(jQuery.curCSS(elem,"border"+this+"Width",true))||0;});val-=Math.round(padding+border);}if(jQuery(elem).is(":visible"))getWH();else
+jQuery.swap(elem,props,getWH);return Math.max(0,val);}return jQuery.curCSS(elem,name,force);},curCSS:function(elem,name,force){var ret,style=elem.style;function color(elem){if(!jQuery.browser.safari)return false;var ret=defaultView.getComputedStyle(elem,null);return!ret||ret.getPropertyValue("color")=="";}if(name=="opacity"&&jQuery.browser.msie){ret=jQuery.attr(style,"opacity");return ret==""?"1":ret;}if(jQuery.browser.opera&&name=="display"){var save=style.outline;style.outline="0 solid black";style.outline=save;}if(name.match(/float/i))name=styleFloat;if(!force&&style&&style[name])ret=style[name];else if(defaultView.getComputedStyle){if(name.match(/float/i))name="float";name=name.replace(/([A-Z])/g,"-$1").toLowerCase();var computedStyle=defaultView.getComputedStyle(elem,null);if(computedStyle&&!color(elem))ret=computedStyle.getPropertyValue(name);else{var swap=[],stack=[],a=elem,i=0;for(;a&&color(a);a=a.parentNode)stack.unshift(a);for(;i<stack.length;i++)if(color(stack[i]!
 )){swap[i]=stack[i].style.display;stack[i].style.display="block";}ret=name=="display"&&swap[stack.length-1]!=null?"none":(computedStyle&&computedStyle.getPropertyValue(name))||"";for(i=0;i<swap.length;i++)if(swap[i]!=null)stack[i].style.display=swap[i];}if(name=="opacity"&&ret=="")ret="1";}else if(elem.currentStyle){var camelCase=name.replace(/\-(\w)/g,function(all,letter){return letter.toUpperCase();});ret=elem.currentStyle[name]||elem.currentStyle[camelCase];if(!/^\d+(px)?$/i.test(ret)&&/^\d/.test(ret)){var left=style.left,rsLeft=elem.runtimeStyle.left;elem.runtimeStyle.left=elem.currentStyle.left;style.left=ret||0;ret=style.pixelLeft+"px";style.left=left;elem.runtimeStyle.left=rsLeft;}}return ret;},clean:function(elems,context){var ret=[];context=context||document;if(typeof context.createElement=='undefined')context=context.ownerDocument||context[0]&&context[0].ownerDocument||document;jQuery.each(elems,function(i,elem){if(!elem)return;if(elem.constructor==Number)elem+=''!
 ;if(typeof elem=="string"){elem=elem.replace(/(<(\w+)[^>]*?)\/!
 >/g,func
tion(all,front,tag){return tag.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?all:front+"></"+tag+">";});var tags=jQuery.trim(elem).toLowerCase(),div=context.createElement("div");var wrap=!tags.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!tags.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||tags.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!tags.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!tags.indexOf("<td")||!tags.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!tags.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||jQuery.browser.msie&&[1,"div<div>","</div>"]||[0,"",""];div.innerHTML=wrap[1]+elem+wrap[2];while(wrap[0]--)div=div.lastChild;if(jQuery.browser.msie){var tbody=!tags.indexOf("<table")&&tags.indexOf("<tbody")<0?div.firstChild&&div.firstChild.childNodes:wrap[1]=="<table>"&&tags.indexOf("<tbody")<0?div.childNodes:[];for(var j=tbody.length-1;j!
 >=0;--j)if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length)tbody[j].parentNode.removeChild(tbody[j]);if(/^\s/.test(elem))div.insertBefore(context.createTextNode(elem.match(/^\s*/)[0]),div.firstChild);}elem=jQuery.makeArray(div.childNodes);}if(elem.length===0&&(!jQuery.nodeName(elem,"form")&&!jQuery.nodeName(elem,"select")))return;if(elem[0]==undefined||jQuery.nodeName(elem,"form")||elem.options)ret.push(elem);else
+ret=jQuery.merge(ret,elem);});return ret;},attr:function(elem,name,value){if(!elem||elem.nodeType==3||elem.nodeType==8)return undefined;var notxml=!jQuery.isXMLDoc(elem),set=value!==undefined,msie=jQuery.browser.msie;name=notxml&&jQuery.props[name]||name;if(elem.tagName){var special=/href|src|style/.test(name);if(name=="selected"&&jQuery.browser.safari)elem.parentNode.selectedIndex;if(name in elem&&notxml&&!special){if(set){if(name=="type"&&jQuery.nodeName(elem,"input")&&elem.parentNode)throw"type property can't be changed";elem[name]=value;}if(jQuery.nodeName(elem,"form")&&elem.getAttributeNode(name))return elem.getAttributeNode(name).nodeValue;return elem[name];}if(msie&&notxml&&name=="style")return jQuery.attr(elem.style,"cssText",value);if(set)elem.setAttribute(name,""+value);var attr=msie&&notxml&&special?elem.getAttribute(name,2):elem.getAttribute(name);return attr===null?undefined:attr;}if(msie&&name=="opacity"){if(set){elem.zoom=1;elem.filter=(elem.filter||"").repla!
 ce(/alpha\([^)]*\)/,"")+(parseInt(value)+''=="NaN"?"":"alpha(opacity="+value*100+")");}return elem.filter&&elem.filter.indexOf("opacity=")>=0?(parseFloat(elem.filter.match(/opacity=([^)]*)/)[1])/100)+'':"";}name=name.replace(/-([a-z])/ig,function(all,letter){return letter.toUpperCase();});if(set)elem[name]=value;return elem[name];},trim:function(text){return(text||"").replace(/^\s+|\s+$/g,"");},makeArray:function(array){var ret=[];if(array!=null){var i=array.length;if(i==null||array.split||array.setInterval||array.call)ret[0]=array;else
+while(i)ret[--i]=array[i];}return ret;},inArray:function(elem,array){for(var i=0,length=array.length;i<length;i++)if(array[i]===elem)return i;return-1;},merge:function(first,second){var i=0,elem,pos=first.length;if(jQuery.browser.msie){while(elem=second[i++])if(elem.nodeType!=8)first[pos++]=elem;}else
+while(elem=second[i++])first[pos++]=elem;return first;},unique:function(array){var ret=[],done={};try{for(var i=0,length=array.length;i<length;i++){var id=jQuery.data(array[i]);if(!done[id]){done[id]=true;ret.push(array[i]);}}}catch(e){ret=array;}return ret;},grep:function(elems,callback,inv){var ret=[];for(var i=0,length=elems.length;i<length;i++)if(!inv!=!callback(elems[i],i))ret.push(elems[i]);return ret;},map:function(elems,callback){var ret=[];for(var i=0,length=elems.length;i<length;i++){var value=callback(elems[i],i);if(value!=null)ret[ret.length]=value;}return ret.concat.apply([],ret);}});var userAgent=navigator.userAgent.toLowerCase();jQuery.browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)};var styleFloat=jQuery.browser.msie?"styleFloat":"cssFloat";jQ!
 uery.extend({boxModel:!jQuery.browser.msie||document.compatMode=="CSS1Compat",props:{"for":"htmlFor","class":"className","float":styleFloat,cssFloat:styleFloat,styleFloat:styleFloat,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing"}});jQuery.each({parent:function(elem){return elem.parentNode;},parents:function(elem){return jQuery.dir(elem,"parentNode");},next:function(elem){return jQuery.nth(elem,2,"nextSibling");},prev:function(elem){return jQuery.nth(elem,2,"previousSibling");},nextAll:function(elem){return jQuery.dir(elem,"nextSibling");},prevAll:function(elem){return jQuery.dir(elem,"previousSibling");},siblings:function(elem){return jQuery.sibling(elem.parentNode.firstChild,elem);},children:function(elem){return jQuery.sibling(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(selector){var ret!
 =jQuery.map(this,fn);if(selector&&typeof selector=="string")re!
 t=jQuery
.multiFilter(selector,ret);return this.pushStack(jQuery.unique(ret));};});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(){var args=arguments;return this.each(function(){for(var i=0,length=args.length;i<length;i++)jQuery(args[i])[original](this);});};});jQuery.each({removeAttr:function(name){jQuery.attr(this,name,"");if(this.nodeType==1)this.removeAttribute(name);},addClass:function(classNames){jQuery.className.add(this,classNames);},removeClass:function(classNames){jQuery.className.remove(this,classNames);},toggleClass:function(classNames){jQuery.className[jQuery.className.has(this,classNames)?"remove":"add"](this,classNames);},remove:function(selector){if(!selector||jQuery.filter(selector,[this]).r.length){jQuery("*",this).add(this).each(function(){jQuery.event.remove(this);jQuery.removeData(this);});if(this.parentNode)this.parentNode.removeChild(this);}!
 },empty:function(){jQuery(">*",this).remove();while(this.firstChild)this.removeChild(this.firstChild);}},function(name,fn){jQuery.fn[name]=function(){return this.each(fn,arguments);};});jQuery.each(["Height","Width"],function(i,name){var type=name.toLowerCase();jQuery.fn[type]=function(size){return this[0]==window?jQuery.browser.opera&&document.body["client"+name]||jQuery.browser.safari&&window["inner"+name]||document.compatMode=="CSS1Compat"&&document.documentElement["client"+name]||document.body["client"+name]:this[0]==document?Math.max(Math.max(document.body["scroll"+name],document.documentElement["scroll"+name]),Math.max(document.body["offset"+name],document.documentElement["offset"+name])):size==undefined?(this.length?jQuery.css(this[0],type):null):this.css(type,size.constructor==String?size:size+"px");};});function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0;}var chars=jQuery.browser.safari&&parseInt(jQuery.browser.version)<417?"(?:!
 [\\w*_-]|\\\\.)":"(?:[\\w\u0128-\uFFFF*_-]|\\\\.)",quickChild=!
 new RegE
xp("^>\\s*("+chars+"+)"),quickID=new RegExp("^("+chars+"+)(#)("+chars+"+)"),quickClass=new RegExp("^([#.]?)("+chars+"*)");jQuery.extend({expr:{"":function(a,i,m){return m[2]=="*"||jQuery.nodeName(a,m[2]);},"#":function(a,i,m){return a.getAttribute("id")==m[2];},":":{lt:function(a,i,m){return i<m[3]-0;},gt:function(a,i,m){return i>m[3]-0;},nth:function(a,i,m){return m[3]-0==i;},eq:function(a,i,m){return m[3]-0==i;},first:function(a,i){return i==0;},last:function(a,i,m,r){return i==r.length-1;},even:function(a,i){return i%2==0;},odd:function(a,i){return i%2;},"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]==a;},"last-child":function(a){return jQuery.nth(a.parentNode.lastChild,1,"previousSibling")==a;},"only-child":function(a){return!jQuery.nth(a.parentNode.lastChild,2,"previousSibling");},parent:function(a){return a.firstChild;},empty:function(a){return!a.firstChild;},contains:function(a,i,m){return(a.textContent||a.innerText||jQuery(a).text()||"").i!
 ndexOf(m[3])>=0;},visible:function(a){return"hidden"!=a.type&&jQuery.css(a,"display")!="none"&&jQuery.css(a,"visibility")!="hidden";},hidden:function(a){return"hidden"==a.type||jQuery.css(a,"display")=="none"||jQuery.css(a,"visibility")=="hidden";},enabled:function(a){return!a.disabled;},disabled:function(a){return a.disabled;},checked:function(a){return a.checked;},selected:function(a){return a.selected||jQuery.attr(a,"selected");},text:function(a){return"text"==a.type;},radio:function(a){return"radio"==a.type;},checkbox:function(a){return"checkbox"==a.type;},file:function(a){return"file"==a.type;},password:function(a){return"password"==a.type;},submit:function(a){return"submit"==a.type;},image:function(a){return"image"==a.type;},reset:function(a){return"reset"==a.type;},button:function(a){return"button"==a.type||jQuery.nodeName(a,"button");},input:function(a){return/input|select|textarea|button/i.test(a.nodeName);},has:function(a,i,m){return jQuery.find(m[3],a).length;},h!
 eader:function(a){return/h\d/i.test(a.nodeName);},animated:fun!
 ction(a)
{return jQuery.grep(jQuery.timers,function(fn){return a==fn.elem;}).length;}}},parse:[/^(\[) *@?([\w-]+) *([!*$^~=]*) *('?"?)(.*?)\4 *\]/,/^(:)([\w-]+)\("?'?(.*?(\(.*?\))?[^(]*?)"?'?\)/,new RegExp("^([:.#]*)("+chars+"+)")],multiFilter:function(expr,elems,not){var old,cur=[];while(expr&&expr!=old){old=expr;var f=jQuery.filter(expr,elems,not);expr=f.t.replace(/^\s*,\s*/,"");cur=not?elems=f.r:jQuery.merge(cur,f.r);}return cur;},find:function(t,context){if(typeof t!="string")return[t];if(context&&context.nodeType!=1&&context.nodeType!=9)return[];context=context||document;var ret=[context],done=[],last,nodeName;while(t&&last!=t){var r=[];last=t;t=jQuery.trim(t);var foundToken=false,re=quickChild,m=re.exec(t);if(m){nodeName=m[1].toUpperCase();for(var i=0;ret[i];i++)for(var c=ret[i].firstChild;c;c=c.nextSibling)if(c.nodeType==1&&(nodeName=="*"||c.nodeName.toUpperCase()==nodeName))r.push(c);ret=r;t=t.replace(re,"");if(t.indexOf(" ")==0)continue;foundToken=true;}else{re=/^([>+~])\s*(!
 \w*)/i;if((m=re.exec(t))!=null){r=[];var merge={};nodeName=m[2].toUpperCase();m=m[1];for(var j=0,rl=ret.length;j<rl;j++){var n=m=="~"||m=="+"?ret[j].nextSibling:ret[j].firstChild;for(;n;n=n.nextSibling)if(n.nodeType==1){var id=jQuery.data(n);if(m=="~"&&merge[id])break;if(!nodeName||n.nodeName.toUpperCase()==nodeName){if(m=="~")merge[id]=true;r.push(n);}if(m=="+")break;}}ret=r;t=jQuery.trim(t.replace(re,""));foundToken=true;}}if(t&&!foundToken){if(!t.indexOf(",")){if(context==ret[0])ret.shift();done=jQuery.merge(done,ret);r=ret=[context];t=" "+t.substr(1,t.length);}else{var re2=quickID;var m=re2.exec(t);if(m){m=[0,m[2],m[3],m[1]];}else{re2=quickClass;m=re2.exec(t);}m[2]=m[2].replace(/\\/g,"");var elem=ret[ret.length-1];if(m[1]=="#"&&elem&&elem.getElementById&&!jQuery.isXMLDoc(elem)){var oid=elem.getElementById(m[2]);if((jQuery.browser.msie||jQuery.browser.opera)&&oid&&typeof oid.id=="string"&&oid.id!=m[2])oid=jQuery('[@id="'+m[2]+'"]',elem)[0];ret=r=oid&&(!m[3]||jQuery.nodeN!
 ame(oid,m[3]))?[oid]:[];}else{for(var i=0;ret[i];i++){var tag=!
 m[1]=="#
"&&m[3]?m[3]:m[1]!=""||m[0]==""?"*":m[2];if(tag=="*"&&ret[i].nodeName.toLowerCase()=="object")tag="param";r=jQuery.merge(r,ret[i].getElementsByTagName(tag));}if(m[1]==".")r=jQuery.classFilter(r,m[2]);if(m[1]=="#"){var tmp=[];for(var i=0;r[i];i++)if(r[i].getAttribute("id")==m[2]){tmp=[r[i]];break;}r=tmp;}ret=r;}t=t.replace(re2,"");}}if(t){var val=jQuery.filter(t,r);ret=r=val.r;t=jQuery.trim(val.t);}}if(t)ret=[];if(ret&&context==ret[0])ret.shift();done=jQuery.merge(done,ret);return done;},classFilter:function(r,m,not){m=" "+m+" ";var tmp=[];for(var i=0;r[i];i++){var pass=(" "+r[i].className+" ").indexOf(m)>=0;if(!not&&pass||not&&!pass)tmp.push(r[i]);}return tmp;},filter:function(t,r,not){var last;while(t&&t!=last){last=t;var p=jQuery.parse,m;for(var i=0;p[i];i++){m=p[i].exec(t);if(m){t=t.substring(m[0].length);m[2]=m[2].replace(/\\/g,"");break;}}if(!m)break;if(m[1]==":"&&m[2]=="not")r=isSimple.test(m[3])?jQuery.filter(m[3],r,true).r:jQuery(r).not(m[3]);else if(m[1]==".")r=jQue!
 ry.classFilter(r,m[2],not);else if(m[1]=="["){var tmp=[],type=m[3];for(var i=0,rl=r.length;i<rl;i++){var a=r[i],z=a[jQuery.props[m[2]]||m[2]];if(z==null||/href|src|selected/.test(m[2]))z=jQuery.attr(a,m[2])||'';if((type==""&&!!z||type=="="&&z==m[5]||type=="!="&&z!=m[5]||type=="^="&&z&&!z.indexOf(m[5])||type=="$="&&z.substr(z.length-m[5].length)==m[5]||(type=="*="||type=="~=")&&z.indexOf(m[5])>=0)^not)tmp.push(a);}r=tmp;}else if(m[1]==":"&&m[2]=="nth-child"){var merge={},tmp=[],test=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(m[3]=="even"&&"2n"||m[3]=="odd"&&"2n+1"||!/\D/.test(m[3])&&"0n+"+m[3]||m[3]),first=(test[1]+(test[2]||1))-0,last=test[3]-0;for(var i=0,rl=r.length;i<rl;i++){var node=r[i],parentNode=node.parentNode,id=jQuery.data(parentNode);if(!merge[id]){var c=1;for(var n=parentNode.firstChild;n;n=n.nextSibling)if(n.nodeType==1)n.nodeIndex=c++;merge[id]=true;}var add=false;if(first==0){if(node.nodeIndex==last)add=true;}else if((node.nodeIndex-last)%first==0&&(node.nodeIndex-last)!
 /first>=0)add=true;if(add^not)tmp.push(node);}r=tmp;}else{var !
 fn=jQuer
y.expr[m[1]];if(typeof fn=="object")fn=fn[m[2]];if(typeof fn=="string")fn=eval("false||function(a,i){return "+fn+";}");r=jQuery.grep(r,function(elem,i){return fn(elem,i,m,r);},not);}}return{r:r,t:t};},dir:function(elem,dir){var matched=[],cur=elem[dir];while(cur&&cur!=document){if(cur.nodeType==1)matched.push(cur);cur=cur[dir];}return matched;},nth:function(cur,result,dir,elem){result=result||1;var num=0;for(;cur;cur=cur[dir])if(cur.nodeType==1&&++num==result)break;return cur;},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType==1&&n!=elem)r.push(n);}return r;}});jQuery.event={add:function(elem,types,handler,data){if(elem.nodeType==3||elem.nodeType==8)return;if(jQuery.browser.msie&&elem.setInterval)elem=window;if(!handler.guid)handler.guid=this.guid++;if(data!=undefined){var fn=handler;handler=this.proxy(fn,function(){return fn.apply(this,arguments);});handler.data=data;}var events=jQuery.data(elem,"events")||jQuery.data(elem,"events",{}),handle=jQuery.d!
 ata(elem,"handle")||jQuery.data(elem,"handle",function(){if(typeof jQuery!="undefined"&&!jQuery.event.triggered)return jQuery.event.handle.apply(arguments.callee.elem,arguments);});handle.elem=elem;jQuery.each(types.split(/\s+/),function(index,type){var parts=type.split(".");type=parts[0];handler.type=parts[1];var handlers=events[type];if(!handlers){handlers=events[type]={};if(!jQuery.event.special[type]||jQuery.event.special[type].setup.call(elem)===false){if(elem.addEventListener)elem.addEventListener(type,handle,false);else if(elem.attachEvent)elem.attachEvent("on"+type,handle);}}handlers[handler.guid]=handler;jQuery.event.global[type]=true;});elem=null;},guid:1,global:{},remove:function(elem,types,handler){if(elem.nodeType==3||elem.nodeType==8)return;var events=jQuery.data(elem,"events"),ret,index;if(events){if(types==undefined||(typeof types=="string"&&types.charAt(0)=="."))for(var type in events)this.remove(elem,type+(types||""));else{if(types.type){handler=types.hand!
 ler;types=types.type;}jQuery.each(types.split(/\s+/),function(!
 index,ty
pe){var parts=type.split(".");type=parts[0];if(events[type]){if(handler)delete events[type][handler.guid];else
+for(handler in events[type])if(!parts[1]||events[type][handler].type==parts[1])delete events[type][handler];for(ret in events[type])break;if(!ret){if(!jQuery.event.special[type]||jQuery.event.special[type].teardown.call(elem)===false){if(elem.removeEventListener)elem.removeEventListener(type,jQuery.data(elem,"handle"),false);else if(elem.detachEvent)elem.detachEvent("on"+type,jQuery.data(elem,"handle"));}ret=null;delete events[type];}}});}for(ret in events)break;if(!ret){var handle=jQuery.data(elem,"handle");if(handle)handle.elem=null;jQuery.removeData(elem,"events");jQuery.removeData(elem,"handle");}}},trigger:function(type,data,elem,donative,extra){data=jQuery.makeArray(data);if(type.indexOf("!")>=0){type=type.slice(0,-1);var exclusive=true;}if(!elem){if(this.global[type])jQuery("*").add([window,document]).trigger(type,data);}else{if(elem.nodeType==3||elem.nodeType==8)return undefined;var val,ret,fn=jQuery.isFunction(elem[type]||null),event=!data[0]||!data[0].preventDefau!
 lt;if(event){data.unshift({type:type,target:elem,preventDefault:function(){},stopPropagation:function(){},timeStamp:now()});data[0][expando]=true;}data[0].type=type;if(exclusive)data[0].exclusive=true;var handle=jQuery.data(elem,"handle");if(handle)val=handle.apply(elem,data);if((!fn||(jQuery.nodeName(elem,'a')&&type=="click"))&&elem["on"+type]&&elem["on"+type].apply(elem,data)===false)val=false;if(event)data.shift();if(extra&&jQuery.isFunction(extra)){ret=extra.apply(elem,val==null?data:data.concat(val));if(ret!==undefined)val=ret;}if(fn&&donative!==false&&val!==false&&!(jQuery.nodeName(elem,'a')&&type=="click")){this.triggered=true;try{elem[type]();}catch(e){}}this.triggered=false;}return val;},handle:function(event){var val,ret,namespace,all,handlers;event=arguments[0]=jQuery.event.fix(event||window.event);namespace=event.type.split(".");event.type=namespace[0];namespace=namespace[1];all=!namespace&&!event.exclusive;handlers=(jQuery.data(this,"events")||{})[event.type];f!
 or(var j in handlers){var handler=handlers[j];if(all||handler.!
 type==na
mespace){event.handler=handler;event.data=handler.data;ret=handler.apply(this,arguments);if(val!==false)val=ret;if(ret===false){event.preventDefault();event.stopPropagation();}}}return val;},fix:function(event){if(event[expando]==true)return event;var originalEvent=event;event={originalEvent:originalEvent};var props="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view wheelDelta which".split(" ");for(var i=props.length;i;i--)event[props[i]]=originalEvent[props[i]];event[expando]=true;event.preventDefault=function(){if(originalEvent.preventDefault)originalEvent.preventDefault();originalEvent.returnValue=false;};event.stopPropagation=function(){if(originalEvent.stopPropagation)originalEvent.stopPropagation();originalEvent.cancelB!
 ubble=true;};event.timeStamp=event.timeStamp||now();if(!event.target)event.target=event.srcElement||document;if(event.target.nodeType==3)event.target=event.target.parentNode;if(!event.relatedTarget&&event.fromElement)event.relatedTarget=event.fromElement==event.target?event.toElement:event.fromElement;if(event.pageX==null&&event.clientX!=null){var doc=document.documentElement,body=document.body;event.pageX=event.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc.clientLeft||0);event.pageY=event.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc.clientTop||0);}if(!event.which&&((event.charCode||event.charCode===0)?event.charCode:event.keyCode))event.which=event.charCode||event.keyCode;if(!event.metaKey&&event.ctrlKey)event.metaKey=event.ctrlKey;if(!event.which&&event.button)event.which=(event.button&1?1:(event.button&2?3:(event.button&4?2:0)));return event;},proxy:function(fn,proxy){proxy.guid=fn.guid=fn.guid||proxy.guid||this.guid++;return proxy;},special:!
 {ready:{setup:function(){bindReady();return;},teardown:functio!
 n(){retu
rn;}},mouseenter:{setup:function(){if(jQuery.browser.msie)return false;jQuery(this).bind("mouseover",jQuery.event.special.mouseenter.handler);return true;},teardown:function(){if(jQuery.browser.msie)return false;jQuery(this).unbind("mouseover",jQuery.event.special.mouseenter.handler);return true;},handler:function(event){if(withinElement(event,this))return true;event.type="mouseenter";return jQuery.event.handle.apply(this,arguments);}},mouseleave:{setup:function(){if(jQuery.browser.msie)return false;jQuery(this).bind("mouseout",jQuery.event.special.mouseleave.handler);return true;},teardown:function(){if(jQuery.browser.msie)return false;jQuery(this).unbind("mouseout",jQuery.event.special.mouseleave.handler);return true;},handler:function(event){if(withinElement(event,this))return true;event.type="mouseleave";return jQuery.event.handle.apply(this,arguments);}}}};jQuery.fn.extend({bind:function(type,data,fn){return type=="unload"?this.one(type,data,fn):this.each(function(){jQu!
 ery.event.add(this,type,fn||data,fn&&data);});},one:function(type,data,fn){var one=jQuery.event.proxy(fn||data,function(event){jQuery(this).unbind(event,one);return(fn||data).apply(this,arguments);});return this.each(function(){jQuery.event.add(this,type,one,fn&&data);});},unbind:function(type,fn){return this.each(function(){jQuery.event.remove(this,type,fn);});},trigger:function(type,data,fn){return this.each(function(){jQuery.event.trigger(type,data,this,true,fn);});},triggerHandler:function(type,data,fn){return this[0]&&jQuery.event.trigger(type,data,this[0],false,fn);},toggle:function(fn){var args=arguments,i=1;while(i<args.length)jQuery.event.proxy(fn,args[i++]);return this.click(jQuery.event.proxy(fn,function(event){this.lastToggle=(this.lastToggle||0)%i;event.preventDefault();return args[this.lastToggle++].apply(this,arguments)||false;}));},hover:function(fnOver,fnOut){return this.bind('mouseenter',fnOver).bind('mouseleave',fnOut);},ready:function(fn){bindReady();if(!
 jQuery.isReady)fn.call(document,jQuery);else
+jQuery.readyList.push(function(){return fn.call(this,jQuery);});return this;}});jQuery.extend({isReady:false,readyList:[],ready:function(){if(!jQuery.isReady){jQuery.isReady=true;if(jQuery.readyList){jQuery.each(jQuery.readyList,function(){this.call(document);});jQuery.readyList=null;}jQuery(document).triggerHandler("ready");}}});var readyBound=false;function bindReady(){if(readyBound)return;readyBound=true;if(document.addEventListener&&!jQuery.browser.opera)document.addEventListener("DOMContentLoaded",jQuery.ready,false);if(jQuery.browser.msie&&window==top)(function(){if(jQuery.isReady)return;try{document.documentElement.doScroll("left");}catch(error){setTimeout(arguments.callee,0);return;}jQuery.ready();})();if(jQuery.browser.opera)document.addEventListener("DOMContentLoaded",function(){if(jQuery.isReady)return;for(var i=0;i<document.styleSheets.length;i++)if(document.styleSheets[i].disabled){setTimeout(arguments.callee,0);return;}jQuery.ready();},false);if(jQuery.browser!
 .safari){var numStyles;(function(){if(jQuery.isReady)return;if(document.readyState!="loaded"&&document.readyState!="complete"){setTimeout(arguments.callee,0);return;}if(numStyles===undefined)numStyles=jQuery("style, link[rel=stylesheet]").length;if(document.styleSheets.length!=numStyles){setTimeout(arguments.callee,0);return;}jQuery.ready();})();}jQuery.event.add(window,"load",jQuery.ready);}jQuery.each(("blur,focus,load,resize,scroll,unload,click,dblclick,"+"mousedown,mouseup,mousemove,mouseover,mouseout,change,select,"+"submit,keydown,keypress,keyup,error").split(","),function(i,name){jQuery.fn[name]=function(fn){return fn?this.bind(name,fn):this.trigger(name);};});var withinElement=function(event,elem){var parent=event.relatedTarget;while(parent&&parent!=elem)try{parent=parent.parentNode;}catch(error){parent=elem;}return parent==elem;};jQuery(window).bind("unload",function(){jQuery("*").add(document).unbind();});jQuery.fn.extend({_load:jQuery.fn.load,load:function(url,pa!
 rams,callback){if(typeof url!='string')return this._load(url);!
 var off=
url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off);}callback=callback||function(){};var type="GET";if(params)if(jQuery.isFunction(params)){callback=params;params=null;}else{params=jQuery.param(params);type="POST";}var self=this;jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(res,status){if(status=="success"||status=="notmodified")self.html(selector?jQuery("<div/>").append(res.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):res.responseText);self.each(callback,[res.responseText,status,res]);}});return this;},serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){return jQuery.nodeName(this,"form")?jQuery.makeArray(this.elements):this;}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type));}).map(function(i,elem){var val=jQuery(this).v!
 al();return val==null?null:val.constructor==Array?jQuery.map(val,function(val,i){return{name:elem.name,value:val};}):{name:elem.name,value:val};}).get();}});jQuery.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(i,o){jQuery.fn[o]=function(f){return this.bind(o,f);};});var jsc=now();jQuery.extend({get:function(url,data,callback,type){if(jQuery.isFunction(data)){callback=data;data=null;}return jQuery.ajax({type:"GET",url:url,data:data,success:callback,dataType:type});},getScript:function(url,callback){return jQuery.get(url,null,callback,"script");},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},post:function(url,data,callback,type){if(jQuery.isFunction(data)){callback=data;data={};}return jQuery.ajax({type:"POST",url:url,data:data,success:callback,dataType:type});},ajaxSetup:function(settings){jQuery.extend(jQuery.ajaxSettings,settings);},ajaxSettings:{url:location.href,global:true,type:"GET",timeout!
 :0,contentType:"application/x-www-form-urlencoded",processData!
 :true,as
ync:true,data:null,username:null,password:null,accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(s){s=jQuery.extend(true,s,jQuery.extend(true,{},jQuery.ajaxSettings,s));var jsonp,jsre=/=\?(&|$)/g,status,data,type=s.type.toUpperCase();if(s.data&&s.processData&&typeof s.data!="string")s.data=jQuery.param(s.data);if(s.dataType=="jsonp"){if(type=="GET"){if(!s.url.match(jsre))s.url+=(s.url.match(/\?/)?"&":"?")+(s.jsonp||"callback")+"=?";}else if(!s.data||!s.data.match(jsre))s.data=(s.data?s.data+"&":"")+(s.jsonp||"callback")+"=?";s.dataType="json";}if(s.dataType=="json"&&(s.data&&s.data.match(jsre)||s.url.match(jsre))){jsonp="jsonp"+jsc++;if(s.data)s.data=(s.data+"").replace(jsre,"="+jsonp+"$1");s.url=s.url.replace(jsre,"="+jsonp+"$1");s.dataType="script";window[jsonp]=function(tmp){data=tmp;success();complete();window[!
 jsonp]=undefined;try{delete window[jsonp];}catch(e){}if(head)head.removeChild(script);};}if(s.dataType=="script"&&s.cache==null)s.cache=false;if(s.cache===false&&type=="GET"){var ts=now();var ret=s.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+ts+"$2");s.url=ret+((ret==s.url)?(s.url.match(/\?/)?"&":"?")+"_="+ts:"");}if(s.data&&type=="GET"){s.url+=(s.url.match(/\?/)?"&":"?")+s.data;s.data=null;}if(s.global&&!jQuery.active++)jQuery.event.trigger("ajaxStart");var remote=/^(?:\w+:)?\/\/([^\/?#]+)/;if(s.dataType=="script"&&type=="GET"&&remote.test(s.url)&&remote.exec(s.url)[1]!=location.host){var head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.src=s.url;if(s.scriptCharset)script.charset=s.scriptCharset;if(!jsonp){var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){done=true;success();complete();head.removeChild(script);}};}head.appendChild(!
 script);return undefined;}var requestDone=false;var xhr=window!
 .ActiveX
Object?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();if(s.username)xhr.open(type,s.url,s.async,s.username,s.password);else
+xhr.open(type,s.url,s.async);try{if(s.data)xhr.setRequestHeader("Content-Type",s.contentType);if(s.ifModified)xhr.setRequestHeader("If-Modified-Since",jQuery.lastModified[s.url]||"Thu, 01 Jan 1970 00:00:00 GMT");xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Accept",s.dataType&&s.accepts[s.dataType]?s.accepts[s.dataType]+", */*":s.accepts._default);}catch(e){}if(s.beforeSend&&s.beforeSend(xhr,s)===false){s.global&&jQuery.active--;xhr.abort();return false;}if(s.global)jQuery.event.trigger("ajaxSend",[xhr,s]);var onreadystatechange=function(isTimeout){if(!requestDone&&xhr&&(xhr.readyState==4||isTimeout=="timeout")){requestDone=true;if(ival){clearInterval(ival);ival=null;}status=isTimeout=="timeout"&&"timeout"||!jQuery.httpSuccess(xhr)&&"error"||s.ifModified&&jQuery.httpNotModified(xhr,s.url)&&"notmodified"||"success";if(status=="success"){try{data=jQuery.httpData(xhr,s.dataType,s.dataFilter);}catch(e){status="parsererror";}}if(status=="success!
 "){var modRes;try{modRes=xhr.getResponseHeader("Last-Modified");}catch(e){}if(s.ifModified&&modRes)jQuery.lastModified[s.url]=modRes;if(!jsonp)success();}else
+jQuery.handleError(s,xhr,status);complete();if(s.async)xhr=null;}};if(s.async){var ival=setInterval(onreadystatechange,13);if(s.timeout>0)setTimeout(function(){if(xhr){xhr.abort();if(!requestDone)onreadystatechange("timeout");}},s.timeout);}try{xhr.send(s.data);}catch(e){jQuery.handleError(s,xhr,null,e);}if(!s.async)onreadystatechange();function success(){if(s.success)s.success(data,status);if(s.global)jQuery.event.trigger("ajaxSuccess",[xhr,s]);}function complete(){if(s.complete)s.complete(xhr,status);if(s.global)jQuery.event.trigger("ajaxComplete",[xhr,s]);if(s.global&&!--jQuery.active)jQuery.event.trigger("ajaxStop");}return xhr;},handleError:function(s,xhr,status,e){if(s.error)s.error(xhr,status,e);if(s.global)jQuery.event.trigger("ajaxError",[xhr,s,e]);},active:0,httpSuccess:function(xhr){try{return!xhr.status&&location.protocol=="file:"||(xhr.status>=200&&xhr.status<300)||xhr.status==304||xhr.status==1223||jQuery.browser.safari&&xhr.status==undefined;}catch(e){}return!
  false;},httpNotModified:function(xhr,url){try{var xhrRes=xhr.getResponseHeader("Last-Modified");return xhr.status==304||xhrRes==jQuery.lastModified[url]||jQuery.browser.safari&&xhr.status==undefined;}catch(e){}return false;},httpData:function(xhr,type,filter){var ct=xhr.getResponseHeader("content-type"),xml=type=="xml"||!type&&ct&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.tagName=="parsererror")throw"parsererror";if(filter)data=filter(data,type);if(type=="script")jQuery.globalEval(data);if(type=="json")data=eval("("+data+")");return data;},param:function(a){var s=[];if(a.constructor==Array||a.jquery)jQuery.each(a,function(){s.push(encodeURIComponent(this.name)+"="+encodeURIComponent(this.value));});else
+for(var j in a)if(a[j]&&a[j].constructor==Array)jQuery.each(a[j],function(){s.push(encodeURIComponent(j)+"="+encodeURIComponent(this));});else
+s.push(encodeURIComponent(j)+"="+encodeURIComponent(jQuery.isFunction(a[j])?a[j]():a[j]));return s.join("&").replace(/%20/g,"+");}});jQuery.fn.extend({show:function(speed,callback){return speed?this.animate({height:"show",width:"show",opacity:"show"},speed,callback):this.filter(":hidden").each(function(){this.style.display=this.oldblock||"";if(jQuery.css(this,"display")=="none"){var elem=jQuery("<"+this.tagName+" />").appendTo("body");this.style.display=elem.css("display");if(this.style.display=="none")this.style.display="block";elem.remove();}}).end();},hide:function(speed,callback){return speed?this.animate({height:"hide",width:"hide",opacity:"hide"},speed,callback):this.filter(":visible").each(function(){this.oldblock=this.oldblock||jQuery.css(this,"display");this.style.display="none";}).end();},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2){return jQuery.isFunction(fn)&&jQuery.isFunction(fn2)?this._toggle.apply(this,arguments):fn?this.animate({height:"toggle",width:"t!
 oggle",opacity:"toggle"},fn,fn2):this.each(function(){jQuery(this)[jQuery(this).is(":hidden")?"show":"hide"]();});},slideDown:function(speed,callback){return this.animate({height:"show"},speed,callback);},slideUp:function(speed,callback){return this.animate({height:"hide"},speed,callback);},slideToggle:function(speed,callback){return this.animate({height:"toggle"},speed,callback);},fadeIn:function(speed,callback){return this.animate({opacity:"show"},speed,callback);},fadeOut:function(speed,callback){return this.animate({opacity:"hide"},speed,callback);},fadeTo:function(speed,to,callback){return this.animate({opacity:to},speed,callback);},animate:function(prop,speed,easing,callback){var optall=jQuery.speed(speed,easing,callback);return this[optall.queue===false?"each":"queue"](function(){if(this.nodeType!=1)return false;var opt=jQuery.extend({},optall),p,hidden=jQuery(this).is(":hidden"),self=this;for(p in prop){if(prop[p]=="hide"&&hidden||prop[p]=="show"&&!hidden)return opt!
 .complete.call(this);if(p=="height"||p=="width"){opt.display=j!
 Query.cs
s(this,"display");opt.overflow=this.style.overflow;}}if(opt.overflow!=null)this.style.overflow="hidden";opt.curAnim=jQuery.extend({},prop);jQuery.each(prop,function(name,val){var e=new jQuery.fx(self,opt,name);if(/toggle|show|hide/.test(val))e[val=="toggle"?hidden?"show":"hide":val](prop);else{var parts=val.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),start=e.cur(true)||0;if(parts){var end=parseFloat(parts[2]),unit=parts[3]||"px";if(unit!="px"){self.style[name]=(end||1)+unit;start=((end||1)/e.cur(true))*start;self.style[name]=start+unit;}if(parts[1])end=((parts[1]=="-="?-1:1)*end)+start;e.custom(start,end,unit);}else
+e.custom(start,val,"");}});return true;});},queue:function(type,fn){if(jQuery.isFunction(type)||(type&&type.constructor==Array)){fn=type;type="fx";}if(!type||(typeof type=="string"&&!fn))return queue(this[0],type);return this.each(function(){if(fn.constructor==Array)queue(this,type,fn);else{queue(this,type).push(fn);if(queue(this,type).length==1)fn.call(this);}});},stop:function(clearQueue,gotoEnd){var timers=jQuery.timers;if(clearQueue)this.queue([]);this.each(function(){for(var i=timers.length-1;i>=0;i--)if(timers[i].elem==this){if(gotoEnd)timers[i](true);timers.splice(i,1);}});if(!gotoEnd)this.dequeue();return this;}});var queue=function(elem,type,array){if(elem){type=type||"fx";var q=jQuery.data(elem,type+"queue");if(!q||array)q=jQuery.data(elem,type+"queue",jQuery.makeArray(array));}return q;};jQuery.fn.dequeue=function(type){type=type||"fx";return this.each(function(){var q=queue(this,type);q.shift();if(q.length)q[0].call(this);});};jQuery.extend({speed:function(speed!
 ,easing,fn){var opt=speed&&speed.constructor==Object?speed:{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&easing.constructor!=Function&&easing};opt.duration=(opt.duration&&opt.duration.constructor==Number?opt.duration:jQuery.fx.speeds[opt.duration])||jQuery.fx.speeds.def;opt.old=opt.complete;opt.complete=function(){if(opt.queue!==false)jQuery(this).dequeue();if(jQuery.isFunction(opt.old))opt.old.call(this);};return opt;},easing:{linear:function(p,n,firstNum,diff){return firstNum+diff*p;},swing:function(p,n,firstNum,diff){return((-Math.cos(p*Math.PI)/2)+0.5)*diff+firstNum;}},timers:[],timerId:null,fx:function(elem,options,prop){this.options=options;this.elem=elem;this.prop=prop;if(!options.orig)options.orig={};}});jQuery.fx.prototype={update:function(){if(this.options.step)this.options.step.call(this.elem,this.now,this);(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this);if(this.prop=="height"||this.prop=="width")t!
 his.elem.style.display="block";},cur:function(force){if(this.e!
 lem[this
.prop]!=null&&this.elem.style[this.prop]==null)return this.elem[this.prop];var r=parseFloat(jQuery.css(this.elem,this.prop,force));return r&&r>-10000?r:parseFloat(jQuery.curCSS(this.elem,this.prop))||0;},custom:function(from,to,unit){this.startTime=now();this.start=from;this.end=to;this.unit=unit||this.unit||"px";this.now=this.start;this.pos=this.state=0;this.update();var self=this;function t(gotoEnd){return self.step(gotoEnd);}t.elem=this.elem;jQuery.timers.push(t);if(jQuery.timerId==null){jQuery.timerId=setInterval(function(){var timers=jQuery.timers;for(var i=0;i<timers.length;i++)if(!timers[i]())timers.splice(i--,1);if(!timers.length){clearInterval(jQuery.timerId);jQuery.timerId=null;}},13);}},show:function(){this.options.orig[this.prop]=jQuery.attr(this.elem.style,this.prop);this.options.show=true;this.custom(0,this.cur());if(this.prop=="width"||this.prop=="height")this.elem.style[this.prop]="1px";jQuery(this.elem).show();},hide:function(){this.options.orig[this.prop]=j!
 Query.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0);},step:function(gotoEnd){var t=now();if(gotoEnd||t>this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var done=true;for(var i in this.options.curAnim)if(this.options.curAnim[i]!==true)done=false;if(done){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(jQuery.css(this.elem,"display")=="none")this.elem.style.display="block";}if(this.options.hide)this.elem.style.display="none";if(this.options.hide||this.options.show)for(var p in this.options.curAnim)jQuery.attr(this.elem.style,p,this.options.orig[p]);}if(done)this.options.complete.call(this.elem);return false;}else{var n=t-this.startTime;this.state=n/this.options.duration;this.pos=jQuery.easing[this.options.easing||(jQuery.easing.swing?"swing":"linear")](this.state,n,0,1,this.options.dura!
 tion);this.now=this.start+((this.end-this.start)*this.pos);thi!
 s.update
();}return true;}};jQuery.extend(jQuery.fx,{speeds:{slow:600,fast:200,def:400},step:{scrollLeft:function(fx){fx.elem.scrollLeft=fx.now;},scrollTop:function(fx){fx.elem.scrollTop=fx.now;},opacity:function(fx){jQuery.attr(fx.elem.style,"opacity",fx.now);},_default:function(fx){fx.elem.style[fx.prop]=fx.now+fx.unit;}}});jQuery.fn.offset=function(){var left=0,top=0,elem=this[0],results;if(elem)with(jQuery.browser){var parent=elem.parentNode,offsetChild=elem,offsetParent=elem.offsetParent,doc=elem.ownerDocument,safari2=safari&&parseInt(version)<522&&!/adobeair/i.test(userAgent),css=jQuery.curCSS,fixed=css(elem,"position")=="fixed";if(elem.getBoundingClientRect){var box=elem.getBoundingClientRect();add(box.left+Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft),box.top+Math.max(doc.documentElement.scrollTop,doc.body.scrollTop));add(-doc.documentElement.clientLeft,-doc.documentElement.clientTop);}else{add(elem.offsetLeft,elem.offsetTop);while(offsetParent){add(offsetParen!
 t.offsetLeft,offsetParent.offsetTop);if(mozilla&&!/^t(able|d|h)$/i.test(offsetParent.tagName)||safari&&!safari2)border(offsetParent);if(!fixed&&css(offsetParent,"position")=="fixed")fixed=true;offsetChild=/^body$/i.test(offsetParent.tagName)?offsetChild:offsetParent;offsetParent=offsetParent.offsetParent;}while(parent&&parent.tagName&&!/^body|html$/i.test(parent.tagName)){if(!/^inline|table.*$/i.test(css(parent,"display")))add(-parent.scrollLeft,-parent.scrollTop);if(mozilla&&css(parent,"overflow")!="visible")border(parent);parent=parent.parentNode;}if((safari2&&(fixed||css(offsetChild,"position")=="absolute"))||(mozilla&&css(offsetChild,"position")!="absolute"))add(-doc.body.offsetLeft,-doc.body.offsetTop);if(fixed)add(Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft),Math.max(doc.documentElement.scrollTop,doc.body.scrollTop));}results={top:top,left:left};}function border(elem){add(jQuery.curCSS(elem,"borderLeftWidth",true),jQuery.curCSS(elem,"borderTopWidth",tr!
 ue));}function add(l,t){left+=parseInt(l,10)||0;top+=parseInt(!
 t,10)||0
;}return results;};jQuery.fn.extend({position:function(){var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=/^body|html$/i.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();offset.top-=num(this,'marginTop');offset.left-=num(this,'marginLeft');parentOffset.top+=num(offsetParent,'borderTopWidth');parentOffset.left+=num(offsetParent,'borderLeftWidth');results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};}return results;},offsetParent:function(){var offsetParent=this[0].offsetParent;while(offsetParent&&(!/^body|html$/i.test(offsetParent.tagName)&&jQuery.css(offsetParent,'position')=='static'))offsetParent=offsetParent.offsetParent;return jQuery(offsetParent);}});jQuery.each(['Left','Top'],function(i,name){var method='scroll'+name;jQuery.fn[method]=function(val){if(!this[0])return;return val!=undefined?this.each(function(){this==window||this==document?window.scrollTo(!i?val:jQuery(wi!
 ndow).scrollLeft(),i?val:jQuery(window).scrollTop()):this[method]=val;}):this[0]==window||this[0]==document?self[i?'pageYOffset':'pageXOffset']||jQuery.boxModel&&document.documentElement[method]||document.body[method]:this[0][method];};});jQuery.each(["Height","Width"],function(i,name){var tl=i?"Left":"Top",br=i?"Right":"Bottom";jQuery.fn["inner"+name]=function(){return this[name.toLowerCase()]()+num(this,"padding"+tl)+num(this,"padding"+br);};jQuery.fn["outer"+name]=function(margin){return this["inner"+name]()+num(this,"border"+tl+"Width")+num(this,"border"+br+"Width")+(margin?num(this,"margin"+tl)+num(this,"margin"+br):0);};});})();
\ No newline at end of file

Added: online/trunk/webgriffith/public/pylons-logo.gif
===================================================================
(Binary files differ)


Property changes on: online/trunk/webgriffith/public/pylons-logo.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: online/trunk/webgriffith/templates/default/base.mako
===================================================================
--- online/trunk/webgriffith/templates/default/base.mako	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/templates/default/base.mako	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,23 @@
+## -*- coding: utf-8 -*-
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
+    <head>
+        ${self.head_tags()}
+    </head>
+    <body>
+        <h1>${ self.header() }</h1>
+        ${ self.body() }
+        ${ self.footer() }
+    </body>
+</html>
+
+<%def name="header()">
+    ${c.header}
+</%def>
+<%def name="footer()">
+<div id="footer"><small>Pylons &amp; WebGriffith powered</small></div>
+</%def>
+<%def name="head_tags()">
+    <title>WebGriffith</title>
+</%def>

Added: online/trunk/webgriffith/templates/default/details.mako
===================================================================
--- online/trunk/webgriffith/templates/default/details.mako	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/templates/default/details.mako	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,127 @@
+## -*- coding: utf-8 -*-
+<%page args="movie, **kwargs"/>
+
+##            'cameraman'      : _('Cameraman'),
+##            'color'          : _('Color'),
+##            'cond'           : _('Condition'),
+##            'image'          : _('Image'),
+##            'layers'         : _('Layers'),
+##            'media_num'      : _('Discs'),
+##            'ratio_id'       : _('Aspect ratio'),
+##            'region'         : _('Region'),
+##            'screenplay'     : _('Screenplay'),
+##            'vcodec_id'      : _('Video codec'),
+
+<table id="m_${movie.number}">
+ 
+	<tr class="title">
+		<th>${_('Title')}</th>
+		<td>${movie.title}</td>
+	</tr>
+	<tr class="o_title">
+		<th>${_('Original title')}</th>
+		<td>${movie.o_title}</td>
+	</tr>
+	<tr class="number">		
+		<th>${_('Number')}</th>
+		<td>${movie.number}</td>
+	</tr>
+	<tr class="year">
+		<th>${_('Year')}</th>
+		<td>${movie.year}</td>
+	</tr>
+	<tr class="director">
+		<th>${_('Director')}</th>
+		<td>${movie.director}</td>
+	</tr>
+	<tr class="rating">
+		<th>${_('Rating')}</th>
+		<td>${movie.rating}</td>
+	</tr>
+	<tr class="runtime">
+		<th>${_('Runtime')}</th>
+		<td>${movie.runtime}</td>
+	</tr>
+	<tr class="country">
+		<th>${_('Country')}</th>
+		<td>${movie.country}</td>
+	</tr>
+	<tr class="genre">
+		<th>${_('Genre')}</th>
+		<td>${movie.genre}</td>
+	</tr>
+% if movie.o_site:
+	<tr class="links">
+		<th>${_('Official site')}</th>
+		<td><a href="${movie.o_site}">${movie.o_site}</a></td>
+	</tr>
+% endif
+% if movie.site:
+	<tr class="links">
+		<th>${_('Site')}</th>
+		<td><a href="${movie.site}">${movie.site}</a></td>
+	</tr>
+% endif
+% if movie.trailer:
+	<tr class="links">
+		<th>${_('Trailer')}</th>
+		<td><a href="${movie.trailer}">${movie.trailer}</a></td>
+	</tr>
+% endif
+	<tr class="media">
+		<th>${_('Medium')}</th>
+		<td>${movie.medium.name}</td>
+	</tr>
+% if movie.collection:
+	<tr class="collection">
+		<th>${_('Collection')}</th>
+		<td>${movie.collection.name}</td>
+	</tr>
+% endif
+% if movie.volume:
+	<tr class="volume">
+		<th>${_('Volume')}</th>
+		<td>${movie.volume.name}</td>
+	</tr>
+% endif
+	<tr class="seen">
+		<th>${_('Seen it')}</th>
+        <td>
+% if movie.seen:
+		${_('Yes')}
+% else:
+		${_('No')}
+% endif
+        </td>
+	</tr>
+	<tr class="loaned">
+		<th>${_('Loaned')}</th>
+        <td>
+% if movie.loaned:
+		${_('Yes')}
+% else:
+		${_('No')}
+% endif
+        </td>
+	</tr>
+	<tr class="classification">
+		<th>${_('Classification')}</th>
+		<td>${movie.classification}</td>
+	</tr>
+	<tr class="studio">
+		<th>${_('Studio')}</th>
+		<td>${movie.studio}</td>
+	</tr>
+	<tr class="cast">
+		<th>${_('Cast')}</th>
+		<td>${movie.cast}</td>
+	</tr>
+	<tr class="plot">
+		<th>${_('Plot')}</th>
+		<td>${movie.plot}</td>
+	</tr>
+	<tr class="notes">
+		<th>${_('Notes')}</th>
+		<td>${movie.notes}</td>
+	</tr>
+</table>

Added: online/trunk/webgriffith/templates/default/index.mako
===================================================================
--- online/trunk/webgriffith/templates/default/index.mako	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/templates/default/index.mako	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,4 @@
+## -*- coding: utf-8 -*-
+<%inherit file="base.mako"/>
+<a href="${ h.url_for(action='view', id=1) }">first movie</a>
+

Added: online/trunk/webgriffith/templates/default/list.mako
===================================================================
--- online/trunk/webgriffith/templates/default/list.mako	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/templates/default/list.mako	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,38 @@
+## -*- coding: utf-8 -*-
+## vim: ft=mako
+<%inherit file="base.mako"/>
+
+<div id="movie_list">
+     ${showpage(movies)}
+</div>
+
+<p class="settings">
+    <a href="${ h.url_for(action='verbose', id=movies.page) }">verbose mode</a>
+    <a href="${ h.url_for(controller='settings', action=None, id=None) }">settings</a>
+</p>
+
+<hr/> 
+
+
+<%def name="showpage(movies)">
+    <p class="movie_list_pagenum">
+        ${movies.pager('$link_previous $page/$last_page $link_next', page_param='id', onclick="$('#movie_list').load('%s'); return false")}
+    </p>
+    % for movie in movies:
+    <div class="movie_list_row">
+        <span class="movie_list_number">${movie.number}</span>
+        <span class="movie_list_title">
+            <a href="${ h.url_for(controller='movie', action='view', id=movie.number) }">${movie.title}</a>
+        </span>
+    </div>
+    <hr />
+    % endfor
+    <p>
+        ${ movies.pager('~5~', page_param='id', onclick="$('#movie_list').load('%s'); return false") }
+    </p>
+</%def>
+
+<%def name="head_tags()">
+    ${parent.head_tags()}
+    ${h.javascript_link('/js/jquery.min.js')}
+</%def>

Added: online/trunk/webgriffith/templates/default/movie.mako
===================================================================
--- online/trunk/webgriffith/templates/default/movie.mako	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/templates/default/movie.mako	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,5 @@
+## -*- coding: utf-8 -*-
+<%inherit file="base.mako"/>
+<%namespace name="details_tpl" file="details.mako"/>
+
+${details_tpl.body(movie=c.movie)}

Added: online/trunk/webgriffith/templates/default/settings.mako
===================================================================
--- online/trunk/webgriffith/templates/default/settings.mako	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/templates/default/settings.mako	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,15 @@
+## -*- coding: utf-8 -*-
+## vim: ft=mako
+<%inherit file="base.mako"/>
+
+<div class="settings">
+    <p>${_('Language')}: ${c.session['lang']}</p>
+    <p>${_('Template')}: ${c.session['template']}</p>
+    <p>${_('Items per page')}: ${c.session['items_per_page']}
+        <a href="${ h.url_for(controller='settings', action='set', items=c.session['items_per_page']-1) }">-</a>
+        <a href="${ h.url_for(controller='settings', action='set', items=c.session['items_per_page']+1) }">+</a>
+</p>
+</div>
+<p>
+    <a href="${ h.url_for(controller='', action=None, id=None) }">main page</a>
+</p>

Added: online/trunk/webgriffith/templates/default/verbose_list.mako
===================================================================
--- online/trunk/webgriffith/templates/default/verbose_list.mako	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/templates/default/verbose_list.mako	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,31 @@
+## -*- coding: utf-8 -*-
+## vim: ft=mako
+<%inherit file="base.mako"/>
+<%namespace name="details_tpl" file="details.mako"/>
+
+<div id="movie_list">
+     ${showpage(movies)}
+</div>
+
+<p>
+    <a href="${ h.url_for(action='page', id=movies.page) }">normal mode</a>
+</p>
+
+<%def name="showpage(movies)">
+    <p class="movie_list_pagenum">
+        ${movies.pager('$link_previous $page/$last_page $link_next', page_param='id', onclick="$('#movie_list').load('%s'); return false")}
+    </p>
+    % for movie in movies:
+        ${details_tpl.body(movie=movie)}
+        <hr />
+    % endfor
+    <p>
+        ${ movies.pager('~5~', page_param='id', onclick="$('#movie_list').load('%s'); return false") }
+    </p>
+</%def>
+
+## include jQuery (for pagination)
+<%def name="head_tags()">
+    ${parent.head_tags()}
+    ${h.javascript_link('/js/jquery.min.js')}
+</%def>

Added: online/trunk/webgriffith/tests/__init__.py
===================================================================
--- online/trunk/webgriffith/tests/__init__.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/tests/__init__.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,36 @@
+"""Pylons application test package
+
+This package assumes the Pylons environment is already loaded, such as
+when this script is imported from the `nosetests --with-pylons=test.ini`
+command.
+
+This module initializes the application via ``websetup`` (`paster
+setup-app`) and provides the base testing objects.
+"""
+from unittest import TestCase
+
+from paste.deploy import loadapp
+from paste.fixture import TestApp
+from paste.script.appinstall import SetupCommand
+from pylons import config, url
+from routes.util import URLGenerator
+
+import pylons.test
+
+__all__ = ['environ', 'url', 'TestController']
+
+# Invoke websetup with the current config file
+SetupCommand('setup-app').run([config['__file__']])
+
+environ = {}
+
+class TestController(TestCase):
+
+    def __init__(self, *args, **kwargs):
+        if pylons.test.pylonsapp:
+            wsgiapp = pylons.test.pylonsapp
+        else:
+            wsgiapp = loadapp('config:%s' % config['__file__'])
+        self.app = TestApp(wsgiapp)
+        url._push_object(URLGenerator(config['routes.map'], environ))
+        TestCase.__init__(self, *args, **kwargs)

Added: online/trunk/webgriffith/tests/functional/__init__.py
===================================================================

Added: online/trunk/webgriffith/tests/functional/test_list.py
===================================================================
--- online/trunk/webgriffith/tests/functional/test_list.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/tests/functional/test_list.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,7 @@
+from webgriffith.tests import *
+
+class TestListController(TestController):
+
+    def test_index(self):
+        response = self.app.get(url(controller='list', action='index'))
+        # Test response...

Added: online/trunk/webgriffith/tests/functional/test_movie.py
===================================================================
--- online/trunk/webgriffith/tests/functional/test_movie.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/tests/functional/test_movie.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,7 @@
+from webgriffith.tests import *
+
+class TestMovieController(TestController):
+
+    def test_index(self):
+        response = self.app.get(url(controller='movie', action='index'))
+        # Test response...

Added: online/trunk/webgriffith/tests/functional/test_settings.py
===================================================================
--- online/trunk/webgriffith/tests/functional/test_settings.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/tests/functional/test_settings.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,7 @@
+from webgriffith.tests import *
+
+class TestSettingsController(TestController):
+
+    def test_index(self):
+        response = self.app.get(url(controller='settings', action='index'))
+        # Test response...

Added: online/trunk/webgriffith/tests/test_models.py
===================================================================

Added: online/trunk/webgriffith/websetup.py
===================================================================
--- online/trunk/webgriffith/websetup.py	2008-11-19 22:13:48 UTC (rev 1069)
+++ online/trunk/webgriffith/websetup.py	2008-11-22 16:40:48 UTC (rev 1070)
@@ -0,0 +1,17 @@
+"""Setup the WebGriffith application"""
+import logging
+
+from webgriffith.config.environment import load_environment
+
+log = logging.getLogger(__name__)
+
+def setup_app(command, conf, vars):
+    """Place any commands to setup webgriffith here"""
+    load_environment(conf.global_conf, conf.local_conf)
+
+    # Load the models
+    from webgriffith.model import meta
+    meta.metadata.bind = meta.engine
+
+    # Create the tables if they aren't there already
+    meta.metadata.create_all(checkfirst=True)



From piotrek at mail.berlios.de  Sat Nov 22 18:54:54 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sat, 22 Nov 2008 18:54:54 +0100
Subject: [Griffith-svn] r1071 - in online/trunk/webgriffith: controllers lib
Message-ID: <200811221754.mAMHss9Y031603@sheep.berlios.de>

Author: piotrek
Date: 2008-11-22 18:54:53 +0100 (Sat, 22 Nov 2008)
New Revision: 1071

Modified:
   online/trunk/webgriffith/controllers/settings.py
   online/trunk/webgriffith/lib/base.py
Log:
use c.session only in settings' index


Modified: online/trunk/webgriffith/controllers/settings.py
===================================================================
--- online/trunk/webgriffith/controllers/settings.py	2008-11-22 16:40:48 UTC (rev 1070)
+++ online/trunk/webgriffith/controllers/settings.py	2008-11-22 17:54:53 UTC (rev 1071)
@@ -11,6 +11,7 @@
 class SettingsController(BaseController):
 
     def index(self):
+        c.session = session
         return render("/%s/settings.mako" % session['template'])
 
     def set(self):
@@ -37,4 +38,5 @@
                 session_changed = True
         if session_changed:
             session.save()
+
         redirect_to(action='index', id=None)

Modified: online/trunk/webgriffith/lib/base.py
===================================================================
--- online/trunk/webgriffith/lib/base.py	2008-11-22 16:40:48 UTC (rev 1070)
+++ online/trunk/webgriffith/lib/base.py	2008-11-22 17:54:53 UTC (rev 1071)
@@ -31,7 +31,8 @@
             session['template'] = config["view.template"]
             session_changed = True
         if 'items_per_page' not in session:
-            session['items_per_page'] = config["view.items_per_page"]
+            session['items_per_page'] = int(config["view.items_per_page"])
+            session_changed = True
 
         if session_changed:
             session.save()
@@ -39,8 +40,8 @@
         set_lang(session['lang'])
         #add_fallback('griffith')
 
-        c.config = config
-        c.session = session
+        #c.config = config
+        #c.session = session
         c.header = config["view.header"]
 
 



From mikej06 at mail.berlios.de  Sat Nov 22 21:46:53 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 22 Nov 2008 21:46:53 +0100
Subject: [Griffith-svn] r1072 - branches/0.9.x branches/0.9.x/lib trunk
	trunk/lib
Message-ID: <200811222046.mAMKkrHu014485@sheep.berlios.de>

Author: mikej06
Date: 2008-11-22 21:46:29 +0100 (Sat, 22 Nov 2008)
New Revision: 1072

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/add.py
   branches/0.9.x/lib/main_treeview.py
   trunk/ChangeLog
   trunk/lib/add.py
   trunk/lib/main_treeview.py
Log:
fixed rating, runtime and year are not shown with MySQL backend
(MySQL backend use long instead of int datatype for this fields)

Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-22 17:54:53 UTC (rev 1071)
+++ branches/0.9.x/ChangeLog	2008-11-22 20:46:29 UTC (rev 1072)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-22  Michael Jahn
+	* fixed rating, runtime and year are not shown with MySQL backend
+
 2008-11-10  Michael Jahn
 	* optimized windows setup related code, added links to documentation files, forum and wiki to the installer
 

Modified: branches/0.9.x/lib/add.py
===================================================================
--- branches/0.9.x/lib/add.py	2008-11-22 17:54:53 UTC (rev 1071)
+++ branches/0.9.x/lib/add.py	2008-11-22 20:46:29 UTC (rev 1072)
@@ -441,7 +441,7 @@
 	if details['year'] is None:
 		self.treemodel.set_value(myiter, 7, '')
 	else:
-		self.treemodel.set_value(myiter, 7, details['year'])
+		self.treemodel.set_value(myiter, 7, int(details['year']))
 	if details['runtime'] is None:
 		self.treemodel.set_value(myiter, 8, '')
 	else:
@@ -449,7 +449,7 @@
 	if details['rating'] is None:
 		self.treemodel.set_value(myiter, 9, '')
 	else:
-		self.treemodel.set_value(myiter, 9, details['rating'])
+		self.treemodel.set_value(myiter, 9, int(details['rating']))
 	#update statusbar
 	self.total += 1
 	self.count_statusbar()

Modified: branches/0.9.x/lib/main_treeview.py
===================================================================
--- branches/0.9.x/lib/main_treeview.py	2008-11-22 17:54:53 UTC (rev 1071)
+++ branches/0.9.x/lib/main_treeview.py	2008-11-22 20:46:29 UTC (rev 1072)
@@ -491,11 +491,11 @@
 		self.treemodel.set_value(myiter,4,movie.director)
 		self.treemodel.set_value(myiter,5,movie.genre)
 		self.treemodel.set_value(myiter,6,movie.seen)
-		if movie.year is not None and isinstance(movie.year, int):
+		if movie.year is not None and (isinstance(movie.year, int) or isinstance(movie.year, long)):
 			self.treemodel.set_value(myiter,7,movie.year)
-		if movie.runtime is not None and isinstance(movie.runtime, int):
+		if movie.runtime is not None and (isinstance(movie.runtime, int) or isinstance(movie.runtime, long)):
 			self.treemodel.set_value(myiter,8, '%003d' % movie.runtime + _(' min'))
-		if movie.rating is not None and isinstance(movie.rating, int):
+		if movie.rating is not None and (isinstance(movie.rating, int) or isinstance(movie.rating, long)):
 			self.treemodel.set_value(myiter,9,movie.rating)
 		
 	# restore user sort column

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-22 17:54:53 UTC (rev 1071)
+++ trunk/ChangeLog	2008-11-22 20:46:29 UTC (rev 1072)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-22  Michael Jahn
+	* fixed rating, runtime and year are not shown with MySQL backend
+
 2008-11-10  Michael Jahn
 	* optimized windows setup related code, added links to documentation files, forum and wiki to the installer
 

Modified: trunk/lib/add.py
===================================================================
--- trunk/lib/add.py	2008-11-22 17:54:53 UTC (rev 1071)
+++ trunk/lib/add.py	2008-11-22 20:46:29 UTC (rev 1072)
@@ -694,7 +694,7 @@
     if details['year'] is None:
         self.treemodel.set_value(myiter, 7, '')
     else:
-        self.treemodel.set_value(myiter, 7, details['year'])
+        self.treemodel.set_value(myiter, 7, int(details['year']))
     if details['runtime'] is None:
         self.treemodel.set_value(myiter, 8, '')
     else:
@@ -702,7 +702,7 @@
     if details['rating'] is None:
         self.treemodel.set_value(myiter, 9, '')
     else:
-        self.treemodel.set_value(myiter, 9, details['rating'])
+        self.treemodel.set_value(myiter, 9, int(details['rating']))
     #update statusbar
     self.total += 1
     self.count_statusbar()

Modified: trunk/lib/main_treeview.py
===================================================================
--- trunk/lib/main_treeview.py	2008-11-22 17:54:53 UTC (rev 1071)
+++ trunk/lib/main_treeview.py	2008-11-22 20:46:29 UTC (rev 1072)
@@ -470,11 +470,11 @@
         self.treemodel.set_value(myiter,4,movie.director)
         self.treemodel.set_value(myiter,5,movie.genre)
         self.treemodel.set_value(myiter,6,movie.seen)
-        if movie.year is not None and isinstance(movie.year, int):
+        if movie.year is not None and (isinstance(movie.year, int) or isinstance(movie.year, long)):
             self.treemodel.set_value(myiter,7,movie.year)
-        if movie.runtime is not None and isinstance(movie.runtime, int):
+        if movie.runtime is not None and (isinstance(movie.runtime, int) or isinstance(movie.runtime, long)):
             self.treemodel.set_value(myiter,8, '%003d' % movie.runtime + _(' min'))
-        if movie.rating is not None and isinstance(movie.rating, int):
+        if movie.rating is not None and (isinstance(movie.rating, int) or isinstance(movie.rating, long)):
             self.treemodel.set_value(myiter,9,movie.rating)
 
     # restore user sort column



From mikej06 at mail.berlios.de  Sat Nov 22 22:06:44 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Sat, 22 Nov 2008 22:06:44 +0100
Subject: [Griffith-svn] r1073 - in trunk: . lib
Message-ID: <200811222106.mAML6i7b015600@sheep.berlios.de>

Author: mikej06
Date: 2008-11-22 22:06:27 +0100 (Sat, 22 Nov 2008)
New Revision: 1073

Modified:
   trunk/ChangeLog
   trunk/lib/add.py
   trunk/lib/movie.py
Log:
use unicode for fetched html pages in general

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-22 20:46:29 UTC (rev 1072)
+++ trunk/ChangeLog	2008-11-22 21:06:27 UTC (rev 1073)
@@ -6,6 +6,7 @@
 
 
 2008-11-22  Michael Jahn
+	* use unicode for fetched html pages in general
 	* fixed rating, runtime and year are not shown with MySQL backend
 
 2008-11-10  Michael Jahn

Modified: trunk/lib/add.py
===================================================================
--- trunk/lib/add.py	2008-11-22 20:46:29 UTC (rev 1072)
+++ trunk/lib/add.py	2008-11-22 21:06:27 UTC (rev 1073)
@@ -253,7 +253,10 @@
         self.treemodel_results.clear()
         for row in self.search_movie.ids:
             if (str(row)!=''):
-                title = str(self.search_movie.titles[key]).decode(self.search_movie.encode)
+                if isinstance(self.search_movie.titles[key], unicode):
+                    title = self.search_movie.titles[key]
+                else:
+                    title = str(self.search_movie.titles[key]).decode(self.search_movie.encode)
                 myiter = self.treemodel_results.insert_before(None, None)
                 self.treemodel_results.set_value(myiter, 0, str(row))
                 self.treemodel_results.set_value(myiter, 1, title)

Modified: trunk/lib/movie.py
===================================================================
--- trunk/lib/movie.py	2008-11-22 20:46:29 UTC (rev 1072)
+++ trunk/lib/movie.py	2008-11-22 21:06:27 UTC (rev 1073)
@@ -150,12 +150,13 @@
         try:
             ifile = file(retriever.html[0], "rb")
             data = ifile.read()
+            data = data.decode(self.encode)
         except IOError:
             pass
         if url is None:
             self.page = data
+        urlcleanup()
         return data
-        urlcleanup()
 
     def fetch_picture(self):
         if self.image_url:
@@ -204,17 +205,20 @@
             if 'cast' in fields:
                 self.get_cast()
                 self.cast = gutils.clean(self.cast)
-                self.cast = gutils.gdecode(self.cast, self.encode)
+                if not isinstance(self.cast, unicode):
+                    self.cast = gutils.gdecode(self.cast, self.encode)
                 fields.pop(fields.index('cast'))
             if 'plot' in fields:
                 self.get_plot()
                 self.plot = gutils.clean(self.plot)
-                self.plot = gutils.gdecode(self.plot, self.encode)
+                if not isinstance(self.plot, unicode):
+                    self.plot = gutils.gdecode(self.plot, self.encode)
                 fields.pop(fields.index('plot'))
             if 'notes' in fields:
                 self.get_notes()
                 self.notes = gutils.clean(self.notes)
-                self.notes = gutils.gdecode(self.notes, self.encode)
+                if not isinstance(self.notes, unicode):
+                    self.notes = gutils.gdecode(self.notes, self.encode)
                 fields.pop(fields.index('notes'))
             if 'image' in fields:
                 self.get_image()
@@ -224,14 +228,15 @@
             for i in fields:
                 getattr(self, "get_%s" % i)()
                 self[i] = gutils.clean(self[i])
-                self[i] = gutils.gdecode(self[i], self.encode)
+                if not isinstance(self[i], unicode):
+                    self[i] = gutils.gdecode(self[i], self.encode)
         
             if 'o_title' in self.fields_to_fetch and self.o_title is not None:
-                if self.o_title[:4] == 'The ':
-                    self.o_title = self.o_title[4:] + ', The'
+                if self.o_title[:4] == u'The ':
+                    self.o_title = self.o_title[4:] + u', The'
             if 'title' in self.fields_to_fetch and self.title is not None:
-                if self.title[:4] == 'The ':
-                    self.title = self.title[4:] + ', The'
+                if self.title[:4] == u'The ':
+                    self.title = self.title[4:] + u', The'
         finally:
             # close the progress dialog which was opened in get_movie
             self.progress.hide()
@@ -293,6 +298,7 @@
         try:
             ifile = file(retriever.html[0], "rb")
             self.page = ifile.read()
+            self.page = self.page.decode(self.encode)
         except IOError:
             pass
         urlcleanup()



From mikej06 at mail.berlios.de  Tue Nov 25 23:22:09 2008
From: mikej06 at mail.berlios.de (mikej06 at mail.berlios.de)
Date: Tue, 25 Nov 2008 23:22:09 +0100
Subject: [Griffith-svn] r1074 - branches/0.9.x branches/0.9.x/lib
	branches/0.9.x/lib/plugins/movie trunk trunk/lib
	trunk/lib/plugins/movie
Message-ID: <200811252222.mAPMM9CY019802@sheep.berlios.de>

Author: mikej06
Date: 2008-11-25 23:21:44 +0100 (Tue, 25 Nov 2008)
New Revision: 1074

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/add.py
   branches/0.9.x/lib/amazon.py
   branches/0.9.x/lib/edit.py
   branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
   trunk/ChangeLog
   trunk/lib/amazon.py
   trunk/lib/edit.py
   trunk/lib/plugins/movie/PluginMovieAmazon.py
Log:
fixed some amazon and unicode errors

Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-22 21:06:27 UTC (rev 1073)
+++ branches/0.9.x/ChangeLog	2008-11-25 22:21:44 UTC (rev 1074)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-25  Michael Jahn
+	* fixed some amazon and unicode errors
+
 2008-11-22  Michael Jahn
 	* fixed rating, runtime and year are not shown with MySQL backend
 

Modified: branches/0.9.x/lib/add.py
===================================================================
--- branches/0.9.x/lib/add.py	2008-11-22 21:06:27 UTC (rev 1073)
+++ branches/0.9.x/lib/add.py	2008-11-25 22:21:44 UTC (rev 1074)
@@ -234,33 +234,33 @@
 	plot_buffer  = w['plot'].get_buffer()
 	
 	t_movies = {
-		'classification' : w['classification'].get_text().decode('utf-8'),
+		'classification' : w['classification'].get_text(),
 		'color'          : w['color'].get_active(),
 		'cond'           : w['condition'].get_active(),
-		'country'        : w['country'].get_text().decode('utf-8'),
-		'director'       : w['director'].get_text().decode('utf-8'),
-		'genre'          : w['genre'].get_text().decode('utf-8'),
-		'image'          : w['image'].get_text().decode('utf-8'),
+		'country'        : w['country'].get_text(),
+		'director'       : w['director'].get_text(),
+		'genre'          : w['genre'].get_text(),
+		'image'          : w['image'].get_text(),
 		'layers'         : w['layers'].get_active(),
 		'media_num'      : w['discs'].get_value(),
 		'number'         : w['number'].get_value(),
-		'o_site'         : w['o_site'].get_text().decode('utf-8'),
-		'o_title'        : w['o_title'].get_text().decode('utf-8'),
+		'o_site'         : w['o_site'].get_text(),
+		'o_title'        : w['o_title'].get_text(),
 		'rating'         : w['rating_slider'].get_value(),
 		'region'         : w['region'].get_active(),
-		'runtime'        : w['runtime'].get_text().decode('utf-8'),
-		'site'           : w['site'].get_text().decode('utf-8'),
-		'studio'         : w['studio'].get_text().decode('utf-8'),
-		'title'          : w['title'].get_text().decode('utf-8'),
-		'trailer'        : w['trailer'].get_text().decode('utf-8'),
+		'runtime'        : w['runtime'].get_text(),
+		'site'           : w['site'].get_text(),
+		'studio'         : w['studio'].get_text(),
+		'title'          : w['title'].get_text(),
+		'trailer'        : w['trailer'].get_text(),
 		'year'           : w['year'].get_value(),
 		'collection_id'  : w['collection'].get_active(),
 		'medium_id'      : w['media'].get_active(),
 		'volume_id'      : w['volume'].get_active(),
 		'vcodec_id'      : w['vcodec'].get_active(),
-		'cast'           : cast_buffer.get_text(cast_buffer.get_start_iter(),cast_buffer.get_end_iter()).decode('utf-8'),
-		'notes'          : notes_buffer.get_text(notes_buffer.get_start_iter(),notes_buffer.get_end_iter()).decode('utf-8'),
-		'plot'           : plot_buffer.get_text(plot_buffer.get_start_iter(),plot_buffer.get_end_iter()).decode('utf-8'),
+		'cast'           : cast_buffer.get_text(cast_buffer.get_start_iter(),cast_buffer.get_end_iter()),
+		'notes'          : notes_buffer.get_text(notes_buffer.get_start_iter(),notes_buffer.get_end_iter()),
+		'plot'           : plot_buffer.get_text(plot_buffer.get_start_iter(),plot_buffer.get_end_iter()),
 	}
 	if self._am_movie_id is not None:
 		t_movies['movie_id'] = self._am_movie_id

Modified: branches/0.9.x/lib/amazon.py
===================================================================
--- branches/0.9.x/lib/amazon.py	2008-11-22 21:06:27 UTC (rev 1073)
+++ branches/0.9.x/lib/amazon.py	2008-11-25 22:21:44 UTC (rev 1074)
@@ -204,7 +204,7 @@
                 if type(getattr(rc, key)) <> type([]):
                     setattr(rc, key, [getattr(rc, key)])
                 setattr(rc, key, getattr(rc, key) + [unmarshal(child)])
-            elif isinstance(child, minidom.Element) and (child.tagName == 'Details'):
+            elif isinstance(child, minidom.Element) and (child.tagName == 'Details' or child.tagName == 'Item'):
                 # make the first Details element a key
                 setattr(rc,key,[unmarshal(child)])
                 #dbg: because otherwise 'hasattr' only tests
@@ -224,6 +224,8 @@
 
 def buildURL(search_type, searchfield, searchvalue, product_line, type, page, license_key, locale, associate):
     _checkLocaleSupported(locale)
+    if isinstance(searchvalue, unicode):
+        searchvalue = searchvalue.encode('iso8859-1')
     url = "http://" + _supportedLocales[locale][1]
     if search_type == 'ItemLookup':
         url += "&AssociateTag=%s" % associate

Modified: branches/0.9.x/lib/edit.py
===================================================================
--- branches/0.9.x/lib/edit.py	2008-11-22 21:06:27 UTC (rev 1073)
+++ branches/0.9.x/lib/edit.py	2008-11-25 22:21:44 UTC (rev 1074)
@@ -155,14 +155,15 @@
 	from widgets import connect_poster_signals, reconnect_add_signals
 	connect_poster_signals(self, get_poster_select_dc, result, current_poster)
 
-	if not len(result.Item):
+	if not hasattr(result, 'Item') or not len(result.Item):
 		gutils.warning(self, _("No posters found for this movie."))
 		reconnect_add_signals(self)
 		return
 
-	for f in range(len(result.Item)):
-		if self.widgets['movie']['o_title'].get_text().decode('utf-8') == result.Item[f].ItemAttributes.Title:
-			get_poster(self, f, result, current_poster)
+	if len(result.Item) == 1:
+		o_title = self.widgets['movie']['o_title'].get_text().decode('utf-8')
+		if o_title == result.Item[0].ItemAttributes.Title or keyword == result.Item[0].ItemAttributes.Title:
+			get_poster(self, 0, result, current_poster)
 			return
 
 	self.treemodel_results.clear()
@@ -171,6 +172,16 @@
 	for f in range(len(result.Item)):
 		if hasattr(result.Item[f], "LargeImage") and len(result.Item[f].LargeImage.URL):
 			title = result.Item[f].ItemAttributes.Title
+			if hasattr(result.Item[f].ItemAttributes, 'ProductGroup'):
+				title = title + u' - ' + result.Item[f].ItemAttributes.ProductGroup
+			elif hasattr(result.Item[f].ItemAttributes, 'Binding'):
+				title = title + u' - ' + result.Item[f].ItemAttributes.Binding
+			if hasattr(result.Item[f].ItemAttributes, 'ReleaseDate'):
+				title = title + u' - ' + result.Item[f].ItemAttributes.ReleaseDate[:4]
+			elif hasattr(result.Item[f].ItemAttributes, 'TheatricalReleaseDate'):
+				result.Item[f].ItemAttributes.TheatricalReleaseDate[:4]
+			if hasattr(result.Item[f].ItemAttributes, 'Studio'):
+				title = title + u' - ' + result.Item[f].ItemAttributes.Studio
 			myiter = self.treemodel_results.insert_before(None, None)
 			self.treemodel_results.set_value(myiter, 0, str(f))
 			self.treemodel_results.set_value(myiter, 1, title)

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-22 21:06:27 UTC (rev 1073)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieAmazon.py	2008-11-25 22:21:44 UTC (rev 1074)
@@ -71,7 +71,7 @@
 				self.progress.pulse()
 				while gtk.events_pending():
 					gtk.main_iteration()
-			self.page = retriever.result.Item
+			self.page = retriever.result.Item[0]
 		except:
 			self.page = ''
 			try:
@@ -104,7 +104,10 @@
 
 	def get_director(self):
 		if hasattr(self.page.ItemAttributes, 'Director'):
-			self.director = self.page.ItemAttributes.Director
+			if isinstance(self.page.ItemAttributes.Director, list):
+				self.director = string.join(self.page.ItemAttributes.Director, ', ')
+			else:
+				self.director = self.page.ItemAttributes.Director
 		else:
 			self.director = ''
 
@@ -154,8 +157,10 @@
 	def get_cast(self):
 		self.cast = ''
 		if hasattr(self.page.ItemAttributes, 'Actor'):
-			for actor in self.page.ItemAttributes.Actor:
-				self.cast += actor + '\n'
+			if isinstance(self.page.ItemAttributes.Actor, list):
+				self.cast = string.join(self.page.ItemAttributes.Actor, '\n')
+			else:
+				self.cast = self.page.ItemAttributes.Actor
 
 	def get_classification(self):
 		if hasattr(self.page.ItemAttributes, 'AudienceRating'):

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-22 21:06:27 UTC (rev 1073)
+++ trunk/ChangeLog	2008-11-25 22:21:44 UTC (rev 1074)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O?arowski
 
 
+2008-11-25  Michael Jahn
+	* fixed some amazon and unicode errors
+
 2008-11-22  Michael Jahn
 	* use unicode for fetched html pages in general
 	* fixed rating, runtime and year are not shown with MySQL backend

Modified: trunk/lib/amazon.py
===================================================================
--- trunk/lib/amazon.py	2008-11-22 21:06:27 UTC (rev 1073)
+++ trunk/lib/amazon.py	2008-11-25 22:21:44 UTC (rev 1074)
@@ -204,7 +204,7 @@
                 if type(getattr(rc, key)) <> type([]):
                     setattr(rc, key, [getattr(rc, key)])
                 setattr(rc, key, getattr(rc, key) + [unmarshal(child)])
-            elif isinstance(child, minidom.Element) and (child.tagName == 'Details'):
+            elif isinstance(child, minidom.Element) and (child.tagName == 'Details' or child.tagName == 'Item'):
                 # make the first Details element a key
                 setattr(rc,key,[unmarshal(child)])
                 #dbg: because otherwise 'hasattr' only tests
@@ -224,6 +224,8 @@
 
 def buildURL(search_type, searchfield, searchvalue, product_line, type, page, license_key, locale, associate):
     _checkLocaleSupported(locale)
+    if isinstance(searchvalue, unicode):
+        searchvalue = searchvalue.encode('iso8859-1')
     url = "http://" + _supportedLocales[locale][1]
     if search_type == 'ItemLookup':
         url += "&AssociateTag=%s" % associate

Modified: trunk/lib/edit.py
===================================================================
--- trunk/lib/edit.py	2008-11-22 21:06:27 UTC (rev 1073)
+++ trunk/lib/edit.py	2008-11-25 22:21:44 UTC (rev 1074)
@@ -166,23 +166,33 @@
     from widgets import connect_poster_signals, reconnect_add_signals
     connect_poster_signals(self, get_poster_select_dc, result, current_poster)
 
-    if not hasattr(result, "Item") or not len(result.Item):
+    if not hasattr(result, 'Item') or not len(result.Item):
         gutils.warning(self, _("No posters found for this movie."))
         reconnect_add_signals(self)
         return
 
-    for f in range(len(result.Item)):
-        if self.widgets['movie']['o_title'].get_text() == result.Item[f].ItemAttributes.Title:
-            get_poster(self, f, result)
+    if len(result.Item) == 1:
+        o_title = self.widgets['movie']['o_title'].get_text().decode('utf-8')
+        if o_title == result.Item[0].ItemAttributes.Title or keyword == result.Item[0].ItemAttributes.Title:
+            get_poster(self, 0, result, current_poster)
             return
 
     self.treemodel_results.clear()
     self.widgets['add']['b_get_from_web'].set_sensitive(False) # disable movie plugins (result window is shared)
 
     for f in range(len(result.Item)):
-
         if hasattr(result.Item[f], "LargeImage") and len(result.Item[f].LargeImage.URL):
             title = result.Item[f].ItemAttributes.Title
+            if hasattr(result.Item[f].ItemAttributes, 'ProductGroup'):
+                title = title + u' - ' + result.Item[f].ItemAttributes.ProductGroup
+            elif hasattr(result.Item[f].ItemAttributes, 'Binding'):
+                title = title + u' - ' + result.Item[f].ItemAttributes.Binding
+            if hasattr(result.Item[f].ItemAttributes, 'ReleaseDate'):
+                title = title + u' - ' + result.Item[f].ItemAttributes.ReleaseDate[:4]
+            elif hasattr(result.Item[f].ItemAttributes, 'TheatricalReleaseDate'):
+                result.Item[f].ItemAttributes.TheatricalReleaseDate[:4]
+            if hasattr(result.Item[f].ItemAttributes, 'Studio'):
+                title = title + u' - ' + result.Item[f].ItemAttributes.Studio
             myiter = self.treemodel_results.insert_before(None, None)
             self.treemodel_results.set_value(myiter, 0, str(f))
             self.treemodel_results.set_value(myiter, 1, title)

Modified: trunk/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-22 21:06:27 UTC (rev 1073)
+++ trunk/lib/plugins/movie/PluginMovieAmazon.py	2008-11-25 22:21:44 UTC (rev 1074)
@@ -72,7 +72,7 @@
                 self.progress.pulse()
                 while gtk.events_pending():
                     gtk.main_iteration()
-            self.page = retriever.result.Item
+            self.page = retriever.result.Item[0]
         except:
             self.page = ''
             try:
@@ -105,7 +105,10 @@
 
     def get_director(self):
         if hasattr(self.page.ItemAttributes, 'Director'):
-            self.director = self.page.ItemAttributes.Director
+            if isinstance(self.page.ItemAttributes.Director, list):
+                self.director = string.join(self.page.ItemAttributes.Director, ', ')
+            else:
+                self.director = self.page.ItemAttributes.Director,
         else:
             self.director = ''
 
@@ -155,8 +158,10 @@
     def get_cast(self):
         self.cast = ''
         if hasattr(self.page.ItemAttributes, 'Actor'):
-            for actor in self.page.ItemAttributes.Actor:
-                self.cast += actor + '\n'
+            if isinstance(self.page.ItemAttributes.Actor, list):
+                self.cast = string.join(self.page.ItemAttributes.Actor, '\n')
+            else:
+                self.cast = self.page.ItemAttributes.Actor
 
     def get_classification(self):
         if hasattr(self.page.ItemAttributes, 'AudienceRating'):
@@ -381,65 +386,65 @@
     #
     test_configuration = {
         'B000TIQMMI' : { 
-            'title'             : 'Rocky Balboa',
+            'title'               : 'Rocky Balboa',
             'o_title'             : 'Rocky Balboa',
             'director'            : '',
-            'plot'                 : True,
+            'plot'                : True,
             'cast'                : 'Sylvester Stallone\n\
 Antonio Traver\n\
 Burt Young',
-            'country'            : 'USA',
-            'genre'                : 'Mehr Drama, Drama',
-            'classification'    : 'Freigegeben ab 12 Jahren',
-            'studio'            : 'MGM Home Entertainment GmbH (dt.)',
-            'o_site'            : False,
+            'country'             : 'USA',
+            'genre'               : 'Mehr Drama, Drama',
+            'classification'      : 'Freigegeben ab 12 Jahren',
+            'studio'              : 'MGM Home Entertainment GmbH (dt.)',
+            'o_site'              : False,
             'site'                : 'http://www.amazon.de/dp/B000TIQMMI',
-            'trailer'            : False,
+            'trailer'             : False,
             'year'                : 2006,
-            'notes'                : 'EAN: 4045167004504',
-            'runtime'            : 97,
-            'image'                : True,
-            'rating'            : 9
+            'notes'               : 'EAN: 4045167004504',
+            'runtime'             : 97,
+            'image'               : True,
+            'rating'              : 9
         },
         'B0009NSASM' : { 
-            'title'             : 'Ein gl?ckliches Jahr',
+            'title'               : 'Ein gl?ckliches Jahr',
             'o_title'             : 'Ein gl?ckliches Jahr',
             'director'            : 'Claude Lelouch',
-            'plot'                 : False,
+            'plot'                : False,
             'cast'                : 'Lino Ventura\n\
 Fran?oise Fabian\n\
 Charles G?rard',
-            'country'            : 'Frankreich, Italien',
-            'genre'                : 'Krimi, Mehr Drama, Mehr Kom?die, Drama, Kom?die, Krimi',
-            'classification'    : 'Freigegeben ab 12 Jahren',
-            'studio'            : 'Warner Home Video - DVD',
-            'o_site'            : False,
+            'country'             : 'Frankreich, Italien',
+            'genre'               : 'Krimi, Mehr Drama, Mehr Kom?die, Drama, Kom?die, Krimi',
+            'classification'      : 'Freigegeben ab 12 Jahren',
+            'studio'              : 'Warner Home Video - DVD',
+            'o_site'              : False,
             'site'                : 'http://www.amazon.de/dp/B0009NSASM',
-            'trailer'            : False,
+            'trailer'             : False,
             'year'                : 1973,
-            'notes'                : 'EAN: 7321921998843',
-            'runtime'            : 110,
-            'image'                : True,
-            'rating'            : 10
+            'notes'               : 'EAN: 7321921998843',
+            'runtime'             : 110,
+            'image'               : True,
+            'rating'              : 10
         },
         'B000BSNOD6' : { 
-            'title'             : 'Arahan (Vanilla-DVD)',
+            'title'               : 'Arahan (Vanilla-DVD)',
             'o_title'             : 'Arahan (Vanilla-DVD)',
             'director'            : 'Ryoo Seung-wan',
-            'plot'                 : False,
+            'plot'                : False,
             'cast'                : 'Ryu Seung-beom\n\
 Yoon So-yi\n\
 Ahn Sung-kee',
-            'country'            : 'S?dkorea',
-            'genre'                : 'Actionkom?die, Abenteuer- & Actionkom?die, Fantasykom?die, Action, Kom?die, Mehr Fantasy, Korea, Action, Kom?die, Fantasy, Unter 10 EUR',
-            'classification'    : 'Freigegeben ab 16 Jahren',
-            'o_site'            : False,
+            'country'             : 'S?dkorea',
+            'genre'               : 'Actionkom?die, Abenteuer- & Actionkom?die, Fantasykom?die, Action, Kom?die, Mehr Fantasy, Korea, Action, Kom?die, Fantasy, Unter 10 EUR',
+            'classification'      : 'Freigegeben ab 16 Jahren',
+            'o_site'              : False,
             'site'                : 'http://www.amazon.de/dp/B000BSNOD6',
-            'trailer'            : False,
+            'trailer'             : False,
             'year'                : 2005,
-            'notes'                : 'EAN: 4013549871105',
-            'runtime'            : 108,
-            'image'                : True,
-            'rating'            : 8
+            'notes'               : 'EAN: 4013549871105',
+            'runtime'             : 108,
+            'image'               : True,
+            'rating'              : 8
         }
     }



From piotrek at mail.berlios.de  Sun Nov 30 22:05:42 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 30 Nov 2008 22:05:42 +0100
Subject: [Griffith-svn] r1075 - branches/0.9.x
	branches/0.9.x/lib/plugins/movie trunk trunk/lib/plugins/movie
Message-ID: <200811302105.mAUL5gW8031722@sheep.berlios.de>

Author: piotrek
Date: 2008-11-30 22:05:41 +0100 (Sun, 30 Nov 2008)
New Revision: 1075

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
   trunk/ChangeLog
   trunk/lib/plugins/movie/PluginMovieCSFD.py
Log:
CSFD movie plugin updated (thanks to Otakar)


Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-25 22:21:44 UTC (rev 1074)
+++ branches/0.9.x/ChangeLog	2008-11-30 21:05:41 UTC (rev 1075)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O??arowski
 
 
+2008-11-30  Piotr O??arowski
+	* CSFD movie plugin updated (thanks to Otakar)
+
 2008-11-25  Michael Jahn
 	* fixed some amazon and unicode errors
 

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-25 22:21:44 UTC (rev 1074)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieCSFD.py	2008-11-30 21:05:41 UTC (rev 1075)
@@ -1,4 +1,4 @@
-# -*- coding: cp1250 -*-
+# -*- coding: utf-8 -*-
 __revision__ = '$Id: PluginMovieCSFD.py 12 2007-01-05 09:08:06Z blondak $'
 # Copyright (c) 2005 Blondak
 #
@@ -34,7 +34,7 @@
 class Plugin(movie.Movie):
 	def __init__(self, id):
 		self.movie_id = id
-		self.encode = "cp1250"
+		self.encode = "utf-8"
 		self.url = "http://www.csfd.cz/"+str(id)
 
 	def get_image(self):
@@ -54,7 +54,7 @@
 			self.o_title = self.get_title(True)
 
 	def get_title(self, ret=False):
-		data = re.search(r"<title>([^,]*), ",self.page)
+		data = re.search(r"<title>CSFD.cz - ([^,]*)\(\d{4}\)",self.page)
 		if data:
 			data = data.group(1)
 		else:
@@ -65,7 +65,7 @@
 			self.title = data
 
 	def get_director(self):
-		self.director = re.search(r"Re?ie:(.*)<br><b>Hraj?:",self.page)
+		self.director = re.search(r"Re?ie:(.*)<br><b>Hraj?:",self.page)
 		if self.director:
 			self.director = gutils.strip_tags(self.director.group(1))
 		else:
@@ -79,7 +79,7 @@
 			self.year = ""
 
 	def get_runtime(self):
-		self.runtime = re.search(r"([\d]+) min</b><BR><BR><b>Re?ie:",self.page)
+		self.runtime = re.search(r"([\d]+) min</b><BR><BR><b>Re?ie:",self.page)
 		if self.runtime:
 			self.runtime = gutils.strip_tags(self.runtime.group(1))
 		else:
@@ -107,7 +107,7 @@
 			self.cast = ""
 
 	def get_plot(self):
-		self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,"Obsah / Info:","</td>"),"(ofici?ln? text distributora)",""))
+		self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,"Obsah:","</td>"),"(ofici?ln? text distributora)",""))
 
 	def get_site(self):
 		self.site = re.search(r"href=[\"'](http://.*imdb\.com/title/[^\"']*)",self.page)
@@ -149,7 +149,7 @@
 
 class SearchPlugin(movie.SearchMovie):
 	def __init__(self):
-		self.encode = "cp1250"
+		self.encode = "utf-8"
 		self.original_url_search   = "http://www.csfd.cz/search_pg.php?search="
 		self.translated_url_search = "http://www.csfd.cz/search_pg.php?search="
 

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2008-11-25 22:21:44 UTC (rev 1074)
+++ trunk/ChangeLog	2008-11-30 21:05:41 UTC (rev 1075)
@@ -5,6 +5,9 @@
 (c) 2005-2008  Vasco Nunes, Piotr O??arowski
 
 
+2008-11-30  Piotr O??arowski
+	* CSFD movie plugin updated (thanks to Otakar)
+
 2008-11-25  Michael Jahn
 	* fixed some amazon and unicode errors
 

Modified: trunk/lib/plugins/movie/PluginMovieCSFD.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCSFD.py	2008-11-25 22:21:44 UTC (rev 1074)
+++ trunk/lib/plugins/movie/PluginMovieCSFD.py	2008-11-30 21:05:41 UTC (rev 1075)
@@ -1,4 +1,4 @@
-# -*- coding: cp1250 -*-
+# -*- coding: utf-8 -*-
 __revision__ = '$Id: PluginMovieCSFD.py 12 2007-01-05 09:08:06Z blondak $'
 # Copyright (c) 2005 Blondak
 #
@@ -34,7 +34,7 @@
 class Plugin(movie.Movie):
     def __init__(self, id):
         self.movie_id = id
-        self.encode = "cp1250"
+        self.encode = "utf-8"
         self.url = "http://www.csfd.cz/"+str(id)
 
     def get_image(self):
@@ -54,7 +54,7 @@
             self.o_title = self.get_title(True)
 
     def get_title(self, ret=False):
-        data = re.search(r"<title>([^,]*), ",self.page)
+        data = re.search(r"<title>CSFD.cz - ([^,]*)\(\d{4}\)",self.page)
         if data:
             data = data.group(1)
         else:
@@ -65,7 +65,7 @@
             self.title = data
 
     def get_director(self):
-        self.director = re.search(r"Re?ie:(.*)<br><b>Hraj?:",self.page)
+        self.director = re.search(r"Re?ie:(.*)<br><b>Hraj?:",self.page)
         if self.director:
             self.director = gutils.strip_tags(self.director.group(1))
         else:
@@ -79,7 +79,7 @@
             self.year = ""
 
     def get_runtime(self):
-        self.runtime = re.search(r"([\d]+) min</b><BR><BR><b>Re?ie:",self.page)
+        self.runtime = re.search(r"([\d]+) min</b><BR><BR><b>Re?ie:",self.page)
         if self.runtime:
             self.runtime = gutils.strip_tags(self.runtime.group(1))
         else:
@@ -107,7 +107,7 @@
             self.cast = ""
 
     def get_plot(self):
-        self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,"Obsah / Info:","</td>"),"(ofici?ln? text distributora)",""))
+        self.plot = gutils.strip_tags(string.replace(gutils.trim(self.page,"Obsah:","</td>"),"(ofici?ln? text distributora)",""))
 
     def get_site(self):
         self.site = re.search(r"href=[\"'](http://.*imdb\.com/title/[^\"']*)",self.page)
@@ -149,7 +149,7 @@
 
 class SearchPlugin(movie.SearchMovie):
     def __init__(self):
-        self.encode = "cp1250"
+        self.encode = "utf-8"
         self.original_url_search   = "http://www.csfd.cz/search_pg.php?search="
         self.translated_url_search = "http://www.csfd.cz/search_pg.php?search="
 



From piotrek at mail.berlios.de  Sun Nov 30 22:15:51 2008
From: piotrek at mail.berlios.de (piotrek at BerliOS)
Date: Sun, 30 Nov 2008 22:15:51 +0100
Subject: [Griffith-svn] r1076 - in branches/0.9.x: . lib/plugins/movie
Message-ID: <200811302115.mAULFpR2000207@sheep.berlios.de>

Author: piotrek
Date: 2008-11-30 22:15:50 +0100 (Sun, 30 Nov 2008)
New Revision: 1076

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
   branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
Log:
Sync FDb, Filmweb and Stopklatka movie plugins with trunk


Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2008-11-30 21:05:41 UTC (rev 1075)
+++ branches/0.9.x/ChangeLog	2008-11-30 21:15:50 UTC (rev 1076)
@@ -7,6 +7,7 @@
 
 2008-11-30  Piotr O?arowski
 	* CSFD movie plugin updated (thanks to Otakar)
+	* Sync FDb, Filmweb and Stopklatka movie plugins with trunk
 
 2008-11-25  Michael Jahn
 	* fixed some amazon and unicode errors

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-30 21:05:41 UTC (rev 1075)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFDb.py	2008-11-30 21:15:50 UTC (rev 1076)
@@ -26,145 +26,147 @@
 import string
 import re
 
-plugin_name		= 'FDb'
-plugin_description	= 'Internetowa baza filmowa'
-plugin_url		= 'fdb.pl'
-plugin_language		= _('Polish')
-plugin_author		= 'Piotr O?arowski'
-plugin_author_email	= '<ozarow+griffith at gmail.com>'
-plugin_version		= '1.8'
+plugin_name        = 'FDb'
+plugin_description    = 'Internetowa baza filmowa'
+plugin_url        = 'fdb.pl'
+plugin_language        = _('Polish')
+plugin_author        = 'Piotr O?arowski, Bartosz Kurczewski'
+plugin_author_email    = '<bartosz.kurczewski at gmail.com>'
+plugin_version        = '1.11'
 
 class Plugin(movie.Movie):
-	TRAILER_PATTERN = re.compile('\s*<a\shref=[\'"](.*?)["\'].*?>\(zobacz\szwiastun\)</a>')
-	
-	def __init__(self, movie_id):
-		from md5 import md5
-		self.movie_id = md5(movie_id).hexdigest()
-		self.encode   = 'utf-8'
-		if string.find(movie_id, 'http://') != -1:
-			self.url = str(movie_id)
-		else:
-			self.url = "http://fdb.pl/%s" % str(movie_id)
+    TRAILER_PATTERN = re.compile('/film/.*/zwiastuny/odtwarzaj/[0-9]*')
 
-	def get_image(self):
-		self.image_url = gutils.trim(self.page, 'class="moviePosterTable"', '</td>');
-		self.image_url = gutils.trim(self.image_url,' src="',"\"\n")
-		if self.image_url.endswith('no_picture.png'):
-			self.image_url = ''
-		else:
-			self.image_url = "http://fdb.pl%s" % self.image_url
+    def __init__(self, movie_id):
+        from md5 import md5
+        self.movie_id = md5(movie_id).hexdigest()
+        self.encode   = 'utf-8'
+        if string.find(movie_id, 'http://') != -1:
+            self.url = str(movie_id)
+        else:
+            self.url = "http://fdb.pl/%s" % str(movie_id)
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '<h2>', '</h2>')
-		self.o_title = gutils.strip_tags(self.o_title)
-		if self.o_title == '':
-			self.o_title = self.get_title(True)
+    def get_image(self):
+        self.image_url = gutils.trim(self.page, 'class="poster"', '/></a>')
+        self.image_url = gutils.trim(self.image_url,'src="','"')
+        if self.image_url.endswith('no_picture.png'):
+            self.image_url = ''
 
-	def get_title(self, extra=False):
-		data = gutils.trim(self.page,'<title>', '</title>')
-		tmp = string.find(data, '(')
-		if tmp != -1:
-			data = data[:tmp]
-		if extra is False:
-			self.title = data
-		else:
-			return data
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '<h2 class="title">', '</h2>')
+        self.o_title = gutils.strip_tags(self.o_title)
+        if self.o_title == '':
+            self.o_title = self.get_title(True)
 
-	def get_director(self):
-		self.director = ''
-		elements = gutils.trim(self.page,'>Re?yseria</div>','<br />')
-		elements = string.split(elements, '<div>')
-		if elements[0] != '':
-			for element in elements:
-				element = gutils.trim(element, '>', '</a')
-				if element != '':
-					self.director += ', ' + element
-			self.director = string.replace(self.director[2:], ', &nbsp;&nbsp;&nbsp;(wi?cej)', '')
+    def get_title(self, extra=False):
+        data = gutils.trim(self.page,'<title>', '</title>')
+        tmp = string.find(data, '(')
+        if tmp != -1:
+            data = data[:tmp]
+        if extra is False:
+            self.title = data
+        else:
+            return data
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,'>Opis filmu:</div>','</div>')
-		self.plot = self.TRAILER_PATTERN.sub('', self.plot)
+    def get_director(self):
+        self.director = ''
+        elements = gutils.trim(self.page,'>Re?yseria: </h4>','</div>')
+        elements = string.split(elements, '</li>')
+        if elements[0] != '':
+            for element in elements:
+                element = gutils.trim(element, '>', '</a')
+                if element != '':
+                    self.director += ', ' + element
+            self.director = string.replace(self.director[2:], ', &nbsp;&nbsp;&nbsp;(wi?cej)', '')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page,' class="movieYear">(', ')</span>')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,'Opis filmu','</div>')
+        self.plot = gutils.trim(self.plot,'<p>',"\n\n")
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page,">Czas trwania:</span>\n        ",' min')
+    def get_year(self):
+        self.year = gutils.trim(self.page,'<small>(', ')</small>')
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,'>Gatunek:</span>','</div>')
-		self.genre = string.replace(self.genre, '   ', '')
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page,'Czas trwania: </h4>','</div>')
+        self.runtime = gutils.trim(self.runtime,'<li>',' minut')
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page,'>Obsada:</div>', """<tr>
-            <td colspan""")
-		if self.cast != '':
-			self.cast = self.cast.replace('....',_(' as '))
-			self.cast = self.cast.replace('  ', '')
-			self.cast = self.cast.replace("\n", '')
-			self.cast = self.cast.replace('</tr>', "\n")
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,'Gatunek: </h4>','</div>')
+        self.genre = gutils.trim(self.genre,'<li>','</li>')
+        self.genre = string.replace(self.genre, ' / ', ' | ')
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page,">Od lat:</span>\n","\n")
+    def get_cast(self):
+        self.cast = gutils.trim(self.page,'<h2 class="category-header">\n    Obsada','</div>')
+        self.cast = gutils.trim(self.cast,"<table>\n",'  </table>')
+        if self.cast != '':
+            self.cast = gutils.strip_tags(self.cast)
+            self.cast = self.cast.replace("      ","")
+            self.cast = self.cast.replace("    ","")
+            self.cast = self.cast.replace("\n...\n\n  ",_(' as '))
+            self.cast = self.cast.replace("\n\n\n\n\n","")
 
-	def get_studio(self):
-		self.studio = ''
+    def get_classification(self):
+        self.classification = gutils.trim(self.page,"Od lat: </h4>","</div>")
+        self.classification = gutils.trim(self.classification,'<li>','</li>')
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_site(self):
-		self.site = self.url
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_trailer(self):
-		trailer_url = self.TRAILER_PATTERN.findall(self.page)
-		if trailer_url:
-			self.trailer = trailer_url[0]
+    def get_site(self):
+        self.site = self.url
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,">Kraj:</span>\n",'</div>')
-		self.country = string.replace(self.country, "   ", '')
+    def get_trailer(self):
+        trailer_url = self.TRAILER_PATTERN.findall(self.page)
+        if trailer_url:
+            self.trailer = 'http://fdb.pl' + trailer_url[0]
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '>Ocena:</span>','/10</span>')
-		self.rating = gutils.after(self.rating, 'bold">')
-		if self.rating:
-			self.rating = str(float(gutils.clean(self.rating)))
+    def get_country(self):
+        self.country = gutils.trim(self.page,'Kraj produkcji: </h4>','</div>')
+        self.country = gutils.trim(self.country,'<li>','</li>')
 
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, 'class="vote"','/10</strong>')
+        self.rating = gutils.after(self.rating, '<strong>')
+        if self.rating:
+            self.rating = str(float(gutils.clean(self.rating)))
+
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode = 'utf-8'
-		self.original_url_search	= 'http://fdb.pl/szukaj.php?t=f&s='
-		self.translated_url_search	= 'http://fdb.pl/szukaj.php?t=f&s='
+    def __init__(self):
+        self.encode = 'utf-8'
+        self.original_url_search    = 'http://fdb.pl/szukaj.php?t=f&s='
+        self.translated_url_search    = 'http://fdb.pl/szukaj.php?t=f&s='
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		tmp = string.find(self.page,'<div>Wyniki wyszukiwania dla')
-		if tmp == -1:		# already a movie page
-			self.page = ''
-		else:			# multiple matches
-			self.page = gutils.before(self.page[tmp:],'<div id="mapaSerwisu">');
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        tmp = string.find(self.page,'<div>Wyniki wyszukiwania dla')
+        if tmp == -1:        # already a movie page
+            self.page = ''
+        else:            # multiple matches
+            self.page = gutils.before(self.page[tmp:],'<div id="mapaSerwisu">');
+        return self.page
 
-	def get_searches(self):
-		if self.page == '':	# movie page already
-			self.number_results = 1
-			self.ids.append(self.url)
-			self.titles.append(self.title)
-		else:			# multiple matches
-			elements = string.split(self.page,'<div class="searchItem">')
-			if len(elements)>0:
-				for element in elements:
-					tmpId = gutils.trim(element, '<a href="', '"')
-					if tmpId.endswith('dodajNowy.php'):
-						continue
-					self.ids.append(tmpId)
-					element = gutils.strip_tags(
-						gutils.trim(element, '">', '</div>'))
-					element = element.replace("\n", '')
-					element = element.replace('   ', '')
-					element = element.replace('aka ', ' aka ')
-					element = element.replace(' - Oryginalny', '')
-					self.titles.append(element)
-			else:
-				self.number_results = 0
+    def get_searches(self):
+        if self.page == '':    # movie page already
+            self.number_results = 1
+            self.ids.append(self.url)
+            self.titles.append(self.title)
+        else:            # multiple matches
+            elements = string.split(self.page,'<div class="searchItem">')
+            if len(elements)>0:
+                for element in elements:
+                    tmpId = gutils.trim(element, '<a href="', '"')
+                    if tmpId.endswith('dodajNowy.php'):
+                        continue
+                    self.ids.append(tmpId)
+                    element = gutils.strip_tags(
+                        gutils.trim(element, '">', '</div>'))
+                    element = element.replace("\n", '')
+                    element = element.replace('   ', '')
+                    element = element.replace('aka ', ' aka ')
+                    element = element.replace(' - Oryginalny', '')
+                    self.titles.append(element)
+            else:
+                self.number_results = 0

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-30 21:05:41 UTC (rev 1075)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmweb.py	2008-11-30 21:15:50 UTC (rev 1076)
@@ -24,157 +24,159 @@
 import gutils, movie
 import re,string
 
-plugin_name		= 'Filmweb'
-plugin_description	= 'Web pe?en film?w'
-plugin_url		= 'www.filmweb.pl'
-plugin_language		= _('Polish')
-plugin_author		= 'Piotr O?arowski'
-plugin_author_email	= '<ozarow+griffith at gmail.com>'
-plugin_version		= '1.12'
+plugin_name        = 'Filmweb'
+plugin_description    = 'Web pe?en film?w'
+plugin_url        = 'www.filmweb.pl'
+plugin_language        = _('Polish')
+plugin_author        = 'Piotr O?arowski, Bartosz Kurczewski'
+plugin_author_email    = '<bartosz.kurczewski at gmail.com>'
+plugin_version        = '1.13'
 
 class Plugin(movie.Movie):
-	TRAILER_PATTERN     = re.compile("""<a class=["']notSelected["'].*?href=["'](.*?)["']>zwiastuny</a>\s*\[\d+\]\s*&raquo;""")
-	DIRECTOR_PATTERN    = re.compile('yseria\s+(.*)\s+scenariusz', re.MULTILINE)
-	O_TITLE_AKA_PATTERN = re.compile('\(AKA\s+(.*?)\)')
+    TRAILER_PATTERN     = re.compile("""<a class=["']notSelected["'].*?href=["'](.*?)["']>zwiastuny</a>\s*\[\d+\]\s*&raquo;""")
+    DIRECTOR_PATTERN    = re.compile('yseria\s+(.*)\s+scenariusz', re.MULTILINE)
+    O_TITLE_AKA_PATTERN = re.compile('\(AKA\s+(.*?)\)')
 
-	def __init__(self, id):
-		self.movie_id = 'filmweb'
-		self.url      = str(id)
-		self.encode   = 'utf-8'
+    def __init__(self, id):
+        self.movie_id = 'filmweb'
+        self.url      = str(id)
+        self.encode   = 'utf-8'
 
-	def get_image(self):
-		if string.find(self.page,'<div class="film-poster">') > -1:
-			self.image_url = gutils.trim(self.page, 'rel="artshow" href="', '">')
-		else:
-			self.image_url = ''
+    def get_image(self):
+        if string.find(self.page,'<div class="film-poster">') > -1:
+            self.image_url = gutils.trim(self.page, 'rel="artshow" href="', '">')
+        else:
+            self.image_url = ''
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '<title>', '</title>')
-		if string.find(self.o_title, '/') > -1:
-			self.o_title = gutils.trim(self.o_title, '/', '(')
-		if string.find(self.o_title, '(') > -1:
-			self.o_title = gutils.before(self.o_title, '(')
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '<title>', '</title>')
+        if string.find(self.o_title, '/') > -1:
+            self.o_title = gutils.trim(self.o_title, '/', '(')
+        if string.find(self.o_title, '(') > -1:
+            self.o_title = gutils.before(self.o_title, '(')
 
-	def get_title(self):
-		self.title = gutils.trim(self.page, '<title>', '</title>')
-		if string.find(self.title, '(') > -1:
-			self.title = gutils.before(self.title, '(')
-		if string.find(self.title, '/') > -1:
-			self.title = gutils.before(self.title, '/')
-			
-	def get_director(self):
-		director = self.DIRECTOR_PATTERN.findall(self.page)
-		if len(director)>0:
-			self.director = director[0]
-			self.director = string.replace(self.director, "\t",'')
-			self.director = re.sub('\s+', ' ', self.director)
-			self.director = string.replace(self.director, ",",", ")
-			self.director = string.replace(self.director, "  "," ")
-			self.director = string.replace(self.director, " ,  ",", ")
-			self.director = string.replace(self.director, ",  (wi\xeacej&#160;...)",'')
+    def get_title(self):
+        self.title = gutils.trim(self.page, '<title>', '</title>')
+        if string.find(self.title, '(') > -1:
+            self.title = gutils.before(self.title, '(')
+        if string.find(self.title, '/') > -1:
+            self.title = gutils.before(self.title, '/')
+            
+    def get_director(self):
+        director = self.DIRECTOR_PATTERN.findall(self.page)
+        if len(director)>0:
+            self.director = director[0]
+            self.director = string.replace(self.director, "\t",'')
+            self.director = re.sub('\s+', ' ', self.director)
+            self.director = string.replace(self.director, ",",", ")
+            self.director = string.replace(self.director, "  "," ")
+            self.director = string.replace(self.director, " ,  ",", ")
+            self.director = string.replace(self.director, ",  (wi\xeacej&#160;...)",'')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page,'<h2 id="o-filmie-header" class="replace">','</div>')
-		self.plot = gutils.after(self.plot, '<p>')
-		url = gutils.trim(self.plot,"\t...","</a>")
-		url = gutils.trim(url, 'href="','"')
-		self.plot = gutils.strip_tags(self.plot)
-		if url != '':
-			plot_page = self.open_page(url=url)
-			self.plot = gutils.trim(plot_page, '<div class="filmContent">', '</ul>')
-			self.plot = gutils.after(self.plot, 'zg?o? poprawk?')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page,'<h2 id="o-filmie-header" class="replace">','</div>')
+        self.plot = gutils.after(self.plot, '<p>')
+        url = gutils.trim(self.plot,"\t...","</a>")
+        url = gutils.trim(url, 'href="','"')
+        self.plot = gutils.strip_tags(self.plot)
+        if url != '':
+            plot_page = self.open_page(url=url)
+            self.plot = gutils.trim(plot_page, '<div class="filmContent">', '</ul>')
+            self.plot = gutils.after(self.plot, 'zg?o? poprawk?')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '<span class="year">', '</a>')
+    def get_year(self):
+        self.year = gutils.trim(self.page, '<span class="year">', '</a>')
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page,"\tczas trwania: ","\n")
+    def get_runtime(self):
+        self.runtime = gutils.trim(self.page,"\tczas trwania: ","\n")
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page,"\tgatunek:", '</p>')
-		self.genre = string.replace(self.genre, "\t",'')
-		self.genre = string.replace(self.genre, "\n",'')
+    def get_genre(self):
+        self.genre = gutils.trim(self.page,"\tgatunek:", '</p>')
+        self.genre = string.replace(self.genre, "\t",'')
+        self.genre = string.replace(self.genre, "\n",'')
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page, '<td class="film-actor">',"zobacz wi?cej")
-		self.cast = string.replace(self.cast, chr(13),"")
-		self.cast = string.replace(self.cast, chr(10),"")
-#		self.cast = string.replace(self.cast, "\n","")
-		self.cast = string.replace(self.cast, "\t",'')
-		self.cast = string.replace(self.cast, "  ",'')
-		self.cast = string.replace(self.cast, '<td class="film-protagonist">', _(" as "))
-		self.cast = string.replace(self.cast, '</tr>',"\n")
-		self.cast = gutils.strip_tags(self.cast)
+    def get_cast(self):
+        self.cast = gutils.trim(self.page, '<td class="film-actor">',"zobacz wi?cej")
+        self.cast = string.replace(self.cast, chr(13),"")
+        self.cast = string.replace(self.cast, chr(10),"")
+#        self.cast = string.replace(self.cast, "\n","")
+        self.cast = string.replace(self.cast, "\t",'')
+        self.cast = string.replace(self.cast, "  ",'')
+        self.cast = string.replace(self.cast, '<td class="film-protagonist">', _(" as "))
+        self.cast = string.replace(self.cast, '</tr>',"\n")
+        self.cast = gutils.strip_tags(self.cast)
 
-	def get_classification(self):
-		self.classification = gutils.trim(self.page,"\tod lat: ","\t")
-		self.classification = string.replace(self.classification, "\t",'')
-		self.classification = string.replace(self.classification, "\n",'')
+    def get_classification(self):
+        self.classification = gutils.trim(self.page,"\tod lat: ","\t")
+        self.classification = string.replace(self.classification, "\t",'')
+        self.classification = string.replace(self.classification, "\n",'')
 
-	def get_studio(self):
-		self.studio = ''
+    def get_studio(self):
+        self.studio = ''
 
-	def get_o_site(self):
-		self.o_site = ''
+    def get_o_site(self):
+        self.o_site = ''
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		trailer = self.TRAILER_PATTERN.findall(self.page)
-		if trailer:
-			self.trailer = trailer[0]
+    def get_trailer(self):
+        trailer = self.TRAILER_PATTERN.findall(self.page)
+        if trailer:
+            self.trailer = trailer[0]
 
-	def get_country(self):
-		self.country = gutils.trim(self.page,"\tprodukcja:", '</strong>')
-		self.country = string.replace(self.country, "\t",'')
+    def get_country(self):
+        self.country = gutils.trim(self.page,"\tprodukcja:", '</strong>')
+        self.country = string.replace(self.country, "\t",'')
 
-	def get_rating(self):
-		self.rating = gutils.trim(self.page, '\t<span><strong class="value">', '</strong>')
-		if self.rating != '':
-			self.rating = string.replace(self.rating, ',', '.')
-			self.rating = str( float(string.strip(self.rating)) )
+    def get_rating(self):
+        self.rating = gutils.trim(self.page, '\t<span><strong class="value">', '</strong>')
+        if self.rating != '':
+            self.rating = string.replace(self.rating, ',', '.')
+            self.rating = str( float(string.strip(self.rating)) )
 
-	def get_notes(self):
-		self.notes = ''
+    def get_notes(self):
+        self.notes = ''
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode='utf-8'
-		self.original_url_search   = "http://www.filmweb.pl/szukaj?c=film&q="
-		self.translated_url_search = "http://www.filmweb.pl/szukaj?c=film&q="
+    def __init__(self):
+        self.encode='utf-8'
+        self.original_url_search   = "http://www.filmweb.pl/szukaj?c=film&q="
+        self.translated_url_search = "http://www.filmweb.pl/szukaj?c=film&q="
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		pos = string.find(self.page, 'Znaleziono <b>')
-		if pos == -1:	# movie page
-			self.page = None
-		else:		# search results
-			items = gutils.trim(self.page[pos:], '<b>', '</b>')
-			if items == '0':
-				self.page = False
-			else:
-				self.page = gutils.before(self.page[pos:], 'id="sitemap"')
-				self.page = gutils.after(self.page, '<li ')
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        pos = string.find(self.page, 'Znaleziono <b>')
+        if pos == -1:    # movie page
+            self.page = None
+        else:        # search results
+            items = gutils.trim(self.page[pos:], '<b>', '</b>')
+            if items == '0':
+                self.page = False
+            else:
+                self.page = gutils.before(self.page[pos:], 'id="sitemap"')
+                self.page = gutils.after(self.page, '<li ')
+        return self.page
 
-	def get_searches(self):
-		if self.page is None:	# movie page
-			self.number_results = 1
-			self.ids.append(self.url)
-			self.titles.append(gutils.convert_entities(self.title))
-		elif self.page is False: # no movie found
-			self.number_results = 0
-		else:			# multiple matches
-			elements = string.split(self.page, '<li ')
-			self.number_results = elements[-1]
-			if (elements[0]<>''):
-				for element in elements:
-					element = gutils.after(element, '<a class="searchResultTitle" href="')
-					self.ids.append(gutils.before(element, '">'))
-					element = gutils.trim(element, '">', '</a>')
-					element = gutils.convert_entities(element)
-					element = gutils.strip_tags(element)
-					self.titles.append(element)
-			else:
-				self.number_results = 0
+    def get_searches(self):
+        if self.page is None:    # movie page
+            self.number_results = 1
+            self.ids.append(self.url)
+            self.titles.append(gutils.convert_entities(self.title))
+        elif self.page is False: # no movie found
+            self.number_results = 0
+        else:            # multiple matches
+            elements = string.split(self.page, '<li ')
+            self.number_results = elements[-1]
+            if (elements[0]<>''):
+                for element in elements:
+                    element = gutils.after(element, '<a class="searchResultTitle" href="')
+                    self.ids.append(gutils.before(element, '">'))
+                    element_title = gutils.trim(element, '">', '</a>')
+                    element_year = gutils.trim(element, '</a>', '<span')
+                    element = string.strip(element_title) + ' ' + string.strip(element_year)
+                    element = gutils.convert_entities(element)
+                    element = gutils.strip_tags(element)
+                    self.titles.append(element)
+            else:
+                self.number_results = 0

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-30 21:05:41 UTC (rev 1075)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieStopklatka.py	2008-11-30 21:15:50 UTC (rev 1076)
@@ -28,108 +28,107 @@
 plugin_description  = 'Internetowy Serwis Filmowy'
 plugin_url          = 'www.stopklatka.pl'
 plugin_language     = _('Polish')
-plugin_author       = 'Piotr O?arowski'
-plugin_author_email = '<ozarow+griffith at gmail.com>'
-plugin_version      = '1.9'
+plugin_author       = 'Piotr O?arowski, Bartosz Kurczewski'
+plugin_author_email = '<bartosz.kurczewski at gmail.com>'
+plugin_version      = '1.10'
 
 class Plugin(movie.Movie):
-	IMAGE_PATTERN = re.compile('(http://img.stopklatka.pl/film/.*?)"')
+    IMAGE_PATTERN = re.compile('(http://img.stopklatka.pl/film/.*?)"')
 
-	def __init__(self, id):
-		self.movie_id = id
-		self.url = "http://www.stopklatka.pl/film/film.asp?fi=%s" % str(self.movie_id)
-		self.encode = 'iso-8859-2' # with some cp-1250 data (sic!)
+    def __init__(self, id):
+        self.movie_id = id
+        self.url = "http://www.stopklatka.pl/film/film.asp?fi=%s" % str(self.movie_id)
+        self.encode = 'iso-8859-2' # with some cp-1250 data (sic!)
 
-	def initialize(self):
-		self.page = self.page.replace('\x9c','?')
-		self.page = self.page.replace('?','?')
+    def initialize(self):
+        self.page = self.page.replace('\x9c','?')
+        self.page = self.page.replace('?','?')
+        self.res = re.findall("""</td><td class="middle_cell"><span class="bold">(.*?)</span>, <span class="bold">(.*?)</span>, <span class="bold">(.*?)</span>, <span class="bold">(.*?) min</span>""", self.page)
+        if len(self.res) == 0:
+            self.res = [( '','','','' )]
 
-	def get_image(self):
-		image = self.IMAGE_PATTERN.findall(self.page)
-		if len(image):
-			self.image_url = image[0]
+    def get_image(self):
+        image = self.IMAGE_PATTERN.findall(self.page)
+        if len(image):
+            self.image_url = image[0]
 
-	def get_o_title(self):
-		self.o_title = gutils.trim(self.page, '<h2> (', ')</h2>')
-		if self.o_title == '':
-			self.o_title = self.get_title(True)
+    def get_o_title(self):
+        self.o_title = gutils.trim(self.page, '<h2> (', ')</h2>')
+        if self.o_title == '':
+            self.o_title = self.get_title(True)
 
-	def get_title(self, ret=False):
-		data = gutils.trim(self.page, '<h1>', '</h1>')
-		if ret is True:
-			return data
-		else:
-			self.title = data
+    def get_title(self, ret=False):
+        data = gutils.trim(self.page, '<h1>', '</h1>')
+        if ret is True:
+            return data
+        else:
+            self.title = data
 
-	def get_director(self):
-		self.director = gutils.trim(self.page, '>re\xbfyseria:<', '</td></tr>')
-		self.director = gutils.after(self.director, '>')
+    def get_director(self):
+        self.director = gutils.trim(self.page, '>re\xbfyseria:<', '</td></tr>')
+        self.director = gutils.after(self.director, '>')
 
-	def get_plot(self):
-		self.plot = gutils.trim(self.page, '<p>', '</p>')
-		self.plot = gutils.before(self.plot, '<b>Wi\xEAcej ')
+    def get_plot(self):
+        self.plot = gutils.trim(self.page, '<p>', '</p>')
+        self.plot = gutils.before(self.plot, '<b>Wi\xEAcej ')
 
-	def get_year(self):
-		self.year = gutils.trim(self.page, '>rok produkcji:<', '</span>')
-		self.year = gutils.after(self.year, '>')
+    def get_year(self):
+        self.year = self.res[0][2]
 
-	def get_runtime(self):
-		self.runtime = gutils.trim(self.page, 'trwania:<', ' min<')
-		self.runtime = gutils.after(self.runtime, '>')
+    def get_runtime(self):
+        self.runtime = self.res[0][3]
 
-	def get_genre(self):
-		self.genre = gutils.trim(self.page, '>gatunek:<', '</span>')
-		self.genre = gutils.after(self.genre, '>')
+    def get_genre(self):
+        self.genre = self.res[0][0]
 
-	def get_cast(self):
-		self.cast = gutils.trim(self.page, '>obsada:<', '</td></tr>')
-		self.cast = gutils.after(self.cast, '>')
-		self.cast = string.replace(self.cast, ', ', "\n")
-		self.cast = gutils.before(self.cast, '<b>Wi\xEAcej ')
+    def get_cast(self):
+        self.cast = gutils.trim(self.page, '>obsada:<', '</td></tr>')
+        self.cast = gutils.after(self.cast, '>')
+        self.cast = string.replace(self.cast, ', ', "\n")
+        self.cast = gutils.before(self.cast, '<b>Wi\xEAcej ')
 
-	def get_classification(self):
-		self.classification = ''
+    def get_classification(self):
+        self.classification = ''
 
-	def get_studio(self):
-		self.studio = ""
+    def get_studio(self):
+        self.studio = ""
 
-	def get_o_site(self):
-		self.o_site = gutils.trim(self.page,">strona oficjalna:<"," target=_blank")
-		self.o_site = gutils.after(self.o_site,"href=")
+    def get_o_site(self):
+        self.o_site = gutils.trim(self.page,">strona oficjalna:<"," target=_blank")
+        self.o_site = gutils.after(self.o_site,"href=")
 
-	def get_site(self):
-		self.site = self.url
+    def get_site(self):
+        self.site = self.url
 
-	def get_trailer(self):
-		self.trailer = "http://www.stopklatka.pl/film/film.asp?fi=" + self.movie_id + "&sekcja=mmedia"
+    def get_trailer(self):
+        self.trailer = "http://www.stopklatka.pl/film/film.asp?fi=" + self.movie_id + "&sekcja=mmedia"
 
-	def get_country(self):
-		self.country = gutils.trim(self.page, '>kraj:<', '</span>')
-		self.country = gutils.after(self.country, '>')
+    def get_country(self):
+        self.country = self.res[0][1]
 
-	def get_rating(self):
-		self.rating = '0'
+    def get_rating(self):
+        self.rating = gutils.trim(self.page,'</script></span> (',')')
 
-	def get_notes(self):
-		self.notes = ''
+    def get_notes(self):
+        self.notes = ''
 
 class SearchPlugin(movie.SearchMovie):
-	def __init__(self):
-		self.encode='iso-8859-2'
-		self.original_url_search	= "http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&szukaj="
-		self.translated_url_search	= "http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&szukaj="
+    def __init__(self):
+        self.encode='iso-8859-2'
+        self.original_url_search    = "http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&szukaj="
+        self.translated_url_search    = "http://www.stopklatka.pl/szukaj/szukaj.asp?kategoria=film&szukaj="
 
-	def search(self,parent_window):
-		self.open_search(parent_window)
-		self.page = gutils.trim(self.page, '>Wyniki poszukiwania frazy:', '</div>');
-		self.page = self.page.replace('\x9c','?')
-		self.page = self.page.replace('?','?')
-		return self.page
+    def search(self,parent_window):
+        self.open_search(parent_window)
+        self.page = gutils.trim(self.page, '>Wyniki poszukiwania frazy:', '</div>');
+        self.page = self.page.replace('\x9c','?')
+        self.page = self.page.replace('?','?')
+        return self.page
 
-	def get_searches(self):
-		elements = re.findall("""/film/film.asp\?fi=(\d+)">.*?searchTitle\s*textB">(.*?)</span""", self.page)
-		self.number_results = len(elements)
+    def get_searches(self):
+        elements = re.findall("""/film/film.asp\?fi=(\d+)">.*?searchTitle\s*textB">(.*?)</span>.*?"> (.*?)</span>""", self.page)
+        self.number_results = len(elements)
 
-		for element in elements:
-			self.ids.append(element[0])
-			self.titles.append(element[1])
+        for element in elements:
+            self.ids.append(element[0])
+            self.titles.append(element[1] + ' ' + element[2])



