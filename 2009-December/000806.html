<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Griffith-svn] r1338 - in trunk: . lib lib/db
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/griffith-svn/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1338%20-%20in%20trunk%3A%20.%20lib%20lib/db&In-Reply-To=%3C200912221937.nBMJbhbR030672%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000805.html">
   <LINK REL="Next"  HREF="000807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Griffith-svn] r1338 - in trunk: . lib lib/db</H1>
    <B>piotrek at BerliOS</B> 
    <A HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1338%20-%20in%20trunk%3A%20.%20lib%20lib/db&In-Reply-To=%3C200912221937.nBMJbhbR030672%40sheep.berlios.de%3E"
       TITLE="[Griffith-svn] r1338 - in trunk: . lib lib/db">piotrek at mail.berlios.de
       </A><BR>
    <I>Tue Dec 22 20:37:43 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000805.html">[Griffith-svn] r1337 - trunk/lib/plugins/extensions
</A></li>
        <LI>Next message: <A HREF="000807.html">[Griffith-svn] r1339 - in trunk: . glade lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#806">[ date ]</a>
              <a href="thread.html#806">[ thread ]</a>
              <a href="subject.html#806">[ subject ]</a>
              <a href="author.html#806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: piotrek
Date: 2009-12-22 20:37:40 +0100 (Tue, 22 Dec 2009)
New Revision: 1338

Modified:
   trunk/griffith
   trunk/lib/config.py
   trunk/lib/db/__init__.py
   trunk/lib/db/_movie.py
   trunk/lib/db/_objects.py
   trunk/lib/db/tables.py
   trunk/lib/initialize.py
   trunk/lib/sql.py
Log:
pep8ify few files


Modified: trunk/griffith
===================================================================
--- trunk/griffith	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/griffith	2009-12-22 19:37:40 UTC (rev 1338)
@@ -3,7 +3,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2005-2008 Vasco Nunes, Piotr O&#380;arowski
+# Copyright &#169; 2005-2009 Vasco Nunes, Piotr O&#380;arowski
 
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by

Modified: trunk/lib/config.py
===================================================================
--- trunk/lib/config.py	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/lib/config.py	2009-12-22 19:37:40 UTC (rev 1338)
@@ -2,7 +2,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2005-2009 Vasco Nunes, Piotr O&#380;arowski
+# Copyright &#169; 2005-2009 Vasco Nunes, Piotr O&#380;arowski
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -26,9 +26,11 @@
 import logging
 log = logging.getLogger(&quot;Griffith&quot;)
 
+
 class Config(object):
     subst = {'True': True, 'False': False, 'None': None}
-    def __init__ (self, file):
+
+    def __init__(self, file):
         self._file = file
         if not self.load():
             self.make_defaults()
@@ -55,10 +57,10 @@
         self._cfg.set(section, option, value)
 
     def has_key(self, key, section='main'):
-        return self._cfg.has_option(section,key)
+        return self._cfg.has_option(section, key)
 
     def __setitem__(self, k, v):
-        self.set(k,v, section='main')
+        self.set(k, v, section='main')
 
     def __getitem__(self, key):
         return self.get('main', key)
@@ -67,14 +69,17 @@
         return self._cfg.remove_option(section, option)
 
     def keys(self, section='main'):
-        return [ i[0] for i in self._cfg.items(section) ]
+        return [i[0] for i in self._cfg.items(section)]
+
     def values(self, section='main'):
-        return [ i[1] for i in self._cfg.items(section) ]
+        return [i[1] for i in self._cfg.items(section)]
+
     def items(self, section='main'):
         return self._cfg.items(section)
+
     def to_dict(self, section='main'):
         d = {}
-        for i,j in self._cfg.items(section):
+        for i, j in self._cfg.items(section):
             d[i] = j
         return d
 
@@ -131,7 +136,7 @@
             return True
         else:
             return False
-            
+
     def make_defaults(self):
         self._cfg = ConfigParser.SafeConfigParser()
         self._cfg.read(self._file)

Modified: trunk/lib/db/__init__.py
===================================================================
--- trunk/lib/db/__init__.py	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/lib/db/__init__.py	2009-12-22 19:37:40 UTC (rev 1338)
@@ -43,24 +43,23 @@
     'movies': relation(Movie, backref='ratio')})
 mapper(VCodec, tables.vcodecs, properties={
     'movies': relation(Movie, backref='vcodec')})
-mapper(Person, tables.people, properties = {
+mapper(Person, tables.people, properties={
     'loans': relation(Loan, backref='person', cascade='all, delete-orphan'),
     'loaned_movies_count': column_property(select(
         [func.count(tables.loans.c.loan_id)],
         and_(tables.people.c.person_id == tables.loans.c.person_id,
-             tables.loans.c.return_date == None
-        )).label('loaned_movies_count'), deferred=True),
+             tables.loans.c.return_date == None))\
+        .label('loaned_movies_count'), deferred=True),
     'returned_movies_count': column_property(select( # AKA loan history
         [func.count(tables.loans.c.loan_id)],
         and_(tables.people.c.person_id == tables.loans.c.person_id,
-             tables.loans.c.return_date != None
-        )).label('returned_movies_count'), deferred=True)
-    })
-mapper(MovieLang, tables.movie_lang, primary_key=[tables.movie_lang.c.ml_id], properties = {
-    'movie'    : relation(Movie),
-    'language' : relation(Lang),
-    'achannel' : relation(AChannel),
-    'acodec'   : relation(ACodec),
+             tables.loans.c.return_date != None))\
+        .label('returned_movies_count'), deferred=True)})
+mapper(MovieLang, tables.movie_lang, primary_key=[tables.movie_lang.c.ml_id], properties={
+    'movie': relation(Movie),
+    'language': relation(Lang),
+    'achannel': relation(AChannel),
+    'acodec': relation(ACodec),
     'subformat': relation(SubFormat)})
 mapper(ACodec, tables.acodecs, properties={
     'movielangs': relation(MovieLang)})
@@ -72,19 +71,17 @@
     'movielangs': relation(MovieLang)})
 mapper(MovieTag, tables.movie_tag)
 mapper(Tag, tables.tags, properties={'movietags': relation(MovieTag, backref='tag')})
-mapper(Loan, tables.loans, properties = {
-    'volume'    : relation(Volume),
+mapper(Loan, tables.loans, properties={
+    'volume': relation(Volume),
     'collection': relation(Collection)})
-mapper(Movie, tables.movies, order_by=tables.movies.c.number , properties = {
-    'loans'     : relation(Loan, backref='movie', cascade='all, delete-orphan'),
-    #'tags'      : relation(Tag, cascade='all, delete-orphan', secondary=movie_tag,
-    'tags'      : relation(Tag, secondary=tables.movie_tag,
-                           primaryjoin=tables.movies.c.movie_id==tables.movie_tag.c.movie_id,
-                           secondaryjoin=tables.movie_tag.c.tag_id==tables.tags.c.tag_id),
-    'languages' : relation(MovieLang, cascade='all, delete-orphan')})
+mapper(Movie, tables.movies, order_by=tables.movies.c.number, properties={
+    'loans': relation(Loan, backref='movie', cascade='all, delete-orphan'),
+    #'tags': relation(Tag, cascade='all, delete-orphan', secondary=movie_tag,
+    'tags': relation(Tag, secondary=tables.movie_tag,
+                     primaryjoin=tables.movies.c.movie_id == tables.movie_tag.c.movie_id,
+                     secondaryjoin=tables.movie_tag.c.tag_id == tables.tags.c.tag_id),
+    'languages': relation(MovieLang, cascade='all, delete-orphan')})
 mapper(Poster, tables.posters, properties={
     'movies': relation(Movie),
-    'data'  : deferred(tables.posters.c.data)
-    })
+    'data': deferred(tables.posters.c.data)})
 mapper(Filter, tables.filters)
-

Modified: trunk/lib/db/_movie.py
===================================================================
--- trunk/lib/db/_movie.py	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/lib/db/_movie.py	2009-12-22 19:37:40 UTC (rev 1338)
@@ -60,6 +60,7 @@
         res_alias_res[alias.upper()] = res
 del aliases, alias, res
 
+
 class Movie(object):
 
     def _set_resolution(self, res_string):
@@ -93,8 +94,8 @@
         return &quot;&lt;Movie:%s (number=%s)&gt;&quot; % (self.movie_id, self.number)
 
     def __contains__(self, name):
-        if name in ('volume','collection','medium','vcodec','loans','tags',\
-                    'languages','lectors','dubbings','subtitles','resolution'):
+        if name in ('volume', 'collection', 'medium', 'vcodec', 'loans', 'tags',\
+                    'languages', 'lectors', 'dubbings', 'subtitles', 'resolution'):
             return True
         else:
             return name in tables.movies.columns
@@ -103,31 +104,32 @@
         if hasattr(self, name):
             return getattr(self, name)
         else:
-            raise AttributeError, name
+            raise AttributeError(name)
 
     def _get_loan_history(self):
-        where = [tables.loans.c.movie_id==self.movie_id]
+        where = [tables.loans.c.movie_id == self.movie_id]
         if self.collection_id is not None:
-            where.append(tables.loans.c.collection_id==self.collection_id)
+            where.append(tables.loans.c.collection_id == self.collection_id)
         if self.volume_id is not None:
-            where.append(tables.loans.c.volume_id==self.volume_id)
-        return object_session(self).query(Loan).filter(and_(tables.loans.c.return_date!=None, or_(*where))).all()
+            where.append(tables.loans.c.volume_id == self.volume_id)
+        return object_session(self).query(Loan).filter(\
+                and_(tables.loans.c.return_date != None, or_(*where))).all()
     loan_history = property(_get_loan_history, doc='list of already returned loans')
 
     def _get_loan_details(self):
-        where = [tables.loans.c.movie_id==self.movie_id]
+        where = [tables.loans.c.movie_id == self.movie_id]
         if self.collection_id is not None:
-            where.append(tables.loans.c.collection_id==self.collection_id)
+            where.append(tables.loans.c.collection_id == self.collection_id)
         if self.volume_id is not None:
-            where.append(tables.loans.c.volume_id==self.volume_id)
-        return object_session(self).query(Loan).filter(and_(tables.loans.c.return_date==None, or_(*where))).first()
+            where.append(tables.loans.c.volume_id == self.volume_id)
+        return object_session(self).query(Loan).filter(and_(tables.loans.c.return_date == None, or_(*where))).first()
     loan_details = property(_get_loan_details, doc='current loan details or None')
 
     def loan_to(self, person, whole_collection=False):
         &quot;&quot;&quot;
         Loans movie, all other movies from the same volume and optionally
         movie's collection.
-        
+
         :param person: Person instance or person_id.
         :param whole_collection=False: if True, will loan all movies from the same
             collection.
@@ -166,4 +168,3 @@
         session.add(loan)
 
         return True
-

Modified: trunk/lib/db/_objects.py
===================================================================
--- trunk/lib/db/_objects.py	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/lib/db/_objects.py	2009-12-22 19:37:40 UTC (rev 1338)
@@ -35,13 +35,16 @@
 
 EMAIL_PATTERN = re.compile('^[a-z0-9]+[.a-z0-9_+-]*@[a-z0-9_-]+(\.[a-z0-9_-]+)+$', re.IGNORECASE)
 
+
 class DBTable(object):
+
     def __init__(self, **kwargs):
         for i in kwargs:
             if hasattr(self, i):
                 setattr(self, i, kwargs[i])
             else:
                 log.warn(&quot;%s.%s not set&quot;, self.__class__.__name__, i)
+
     def __repr__(self):
         return &quot;&lt;%s:%s&gt;&quot; % (self.__class__.__name__, self.name.encode('utf-8'))
 
@@ -52,20 +55,48 @@
             raise ValueError(_(&quot;Name cannot be empty&quot;))
         return name.strip()
 
-class AChannel(DBTable): pass
-class ACodec(DBTable): pass
-class Lang(DBTable): pass
-class Medium(DBTable): pass
-class Ratio(DBTable): pass
-class SubFormat(DBTable): pass
-class Tag(DBTable): pass
-class VCodec(DBTable): pass
-class Filter(DBTable): pass
 
+class AChannel(DBTable):
+    pass
+
+
+class ACodec(DBTable):
+    pass
+
+
+class Lang(DBTable):
+    pass
+
+
+class Medium(DBTable):
+    pass
+
+
+class Ratio(DBTable):
+    pass
+
+
+class SubFormat(DBTable):
+    pass
+
+
+class Tag(DBTable):
+    pass
+
+
+class VCodec(DBTable):
+    pass
+
+
+class Filter(DBTable):
+    pass
+
+
 class Collection(DBTable):
+
     def _set_loaned_flag(self, flag):
         &quot;&quot;&quot;Sets loaned flag in current collection and all associated movies.
-       
+
         :param flag: if True and there are loaned movies in the collection
             already, exception will be raised (whole collection cannot be
             loaned if one of the movies is not available).
@@ -77,14 +108,14 @@
 
         if flag: # loaning whole collection
             loaned_movies = session.execute(select([tables.movies.columns.movie_id])\
-                    .where(and_(tables.movies.columns.collection_id==self.collection_id,\
-                        tables.movies.columns.loaned==True))).fetchall()
+                    .where(and_(tables.movies.columns.collection_id == self.collection_id,\
+                        tables.movies.columns.loaned == True))).fetchall()
             if loaned_movies:
                 log.error('cannot loan it, collection contains loaned movie(s): %s', loaned_movies)
                 raise Exception('loaned movies in the collection already')
 
         self._loaned = flag
-        update_query = update(tables.movies, tables.movies.columns.collection_id==self.collection_id)
+        update_query = update(tables.movies, tables.movies.columns.collection_id == self.collection_id)
         session.execute(update_query, params={'loaned': flag})
 
     def _is_loaned(self):
@@ -92,7 +123,9 @@
 
     loaned = property(_is_loaned, _set_loaned_flag)
 
+
 class Volume(DBTable):
+
     def _set_loaned_flag(self, flag):
         &quot;&quot;&quot;Sets loaned flag in current volume and all associated movies.
 
@@ -103,7 +136,7 @@
         session = object_session(self)
 
         self._loaned = flag
-        update_query = update(tables.movies, tables.movies.columns.volume_id==self.volume_id)
+        update_query = update(tables.movies, tables.movies.columns.volume_id == self.volume_id)
         session.execute(update_query, params={'loaned': flag})
 
     def _is_loaned(self):
@@ -111,16 +144,16 @@
 
     loaned = property(_is_loaned, _set_loaned_flag)
 
+
 class Loan(object):
+
     def __repr__(self):
         return &quot;&lt;Loan:%s (person:%s, movie_id:%s, volume_id:%s, collection_id:%s )&gt;&quot; % \
                 (self.loan_id, self.person_id, self.movie_id, self.volume_id, self.collection_id)
-    
+
     def returned_on(self, date=None):
         &quot;&quot;&quot;
         Marks the loan as returned and clears loaned flag in related movies.
-        
-        :param date=None: return date; accepted types: datetime, YYYYMMDD string or None
         &quot;&quot;&quot;
 
         if date is None:
@@ -132,7 +165,7 @@
             return True
 
         session = object_session(self)
-       
+
         if self.collection_id:
             self.collection.loaned = False # will update the loaned flag in all associated movies as well
         if self.volume_id:
@@ -141,7 +174,9 @@
             self.movie.loaned = False
         self.return_date = date
 
+
 class Person(DBTable):
+
     @validates('email')
     def _validate_email(self, key, address):
         address = address.strip()
@@ -157,7 +192,9 @@
         delchars = allchars.translate(allchars, string.digits)
         return unicode(str(value).translate(allchars, delchars))
 
+
 class Poster(object):
+
     @validates('md5sum')
     def _check_md5sum_length(self, key, value):
         if len(value) != 32:
@@ -172,11 +209,15 @@
     def __repr__(self):
         return &quot;&lt;Poster:%s&gt;&quot; % self.md5sum
 
+
 class Configuration(object):
+
     def __repr__(self):
         return &quot;&lt;Config:%s=%s&gt;&quot; % (self.param, self.value)
 
+
 class MovieLang(object):
+
     def __init__(self, lang_id=None, type=None, acodec_id=None, achannel_id=None, subformat_id=None):
         self.lang_id = lang_id
         self.type = type
@@ -188,7 +229,9 @@
         return &quot;&lt;MovieLang:%s-%s (Type:%s ACodec:%s AChannel:%s SubFormat:%s)&gt;&quot; % \
             (self.movie_id, self.lang_id, self.type, self.acodec_id, self.achannel_id, self.subformat_id)
 
+
 class MovieTag(object):
+
     def __init__(self, tag_id=None):
         self.tag_id = tag_id
 

Modified: trunk/lib/db/tables.py
===================================================================
--- trunk/lib/db/tables.py	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/lib/db/tables.py	2009-12-22 19:37:40 UTC (rev 1338)
@@ -100,7 +100,7 @@
 
 loans = Table('loans', metadata,
     Column('loan_id', Integer, primary_key=True),
-    Column('person_id',  ForeignKey(people.c.person_id), nullable=False),
+    Column('person_id', ForeignKey(people.c.person_id), nullable=False),
     Column('movie_id', ForeignKey(movies.c.movie_id), nullable=False),
     Column('volume_id', ForeignKey(volumes.c.volume_id)),
     Column('collection_id', ForeignKey(collections.c.collection_id)),

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/lib/initialize.py	2009-12-22 19:37:40 UTC (rev 1338)
@@ -2,7 +2,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2005-2009 Vasco Nunes, Piotr O&#380;arowski
+# Copyright &#169; 2005-2009 Vasco Nunes, Piotr O&#380;arowski
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -22,9 +22,8 @@
 # GNU General Public License, version 2 or later
 
 import gettext
-import gobject
-import gutils
 import logging
+import math
 import os
 import platform
 import re
@@ -32,9 +31,11 @@
 from glob import glob
 from locale import getdefaultlocale
 
+import gobject
 import gtk
 
 import db
+import gutils
 
 try:
     import gtkspell
@@ -44,26 +45,27 @@
 
 log = logging.getLogger(&quot;Griffith&quot;)
 
+
 def locations(self, home_dir):
     defaultLang, defaultEnc = getdefaultlocale()
     if defaultEnc is None:
         defaultEnc = 'UTF-8'
     locations = {}
     locations['exec'] = os.path.abspath(os.path.dirname(sys.argv[0])) # deprecated
-    locations['lib']  = os.path.dirname(__file__)
+    locations['lib'] = os.path.dirname(__file__)
     locations['home'] = home_dir
 
     if os.name == 'nt' or os.name.startswith('win'): # win32, win64
         import winshell
         from win32com.shell import shellcon, shell
 
-        locations['movie_plugins']  = &quot;%s\\lib\\plugins\\movie&quot; % locations['exec']
+        locations['movie_plugins'] = &quot;%s\\lib\\plugins\\movie&quot; % locations['exec']
         locations['export_plugins'] = &quot;%s\\lib\\plugins\\export&quot; % locations['exec']
-        locations['images']         = &quot;%s\\images&quot; % locations['exec']
-        locations['share']          = locations['images']
-        locations['glade']          = &quot;%s\\glade\\&quot; % locations['exec']
-        locations['desktop']        = ''
-        locations['i18n']           = &quot;%s\\i18n&quot; % locations['exec']
+        locations['images'] = &quot;%s\\images&quot; % locations['exec']
+        locations['share'] = locations['images']
+        locations['glade'] = &quot;%s\\glade\\&quot; % locations['exec']
+        locations['desktop'] = ''
+        locations['i18n'] = &quot;%s\\i18n&quot; % locations['exec']
         os.environ['PATH'] += &quot;;lib;&quot;
 
         # windows hack for locale setting
@@ -77,13 +79,13 @@
     elif os.name == 'posix':
         locations['share'] = os.path.abspath(os.path.join(locations['lib'], '..'))
         locations['glade'] = os.path.join(locations['share'], 'glade')
-        locations['i18n']  = os.path.abspath(os.path.join(locations['share'], '..', 'locale'))
+        locations['i18n'] = os.path.abspath(os.path.join(locations['share'], '..', 'locale'))
         if not os.path.isdir(locations['i18n']):
             locations['i18n'] = os.path.join(locations['share'], 'i18n')
         #some locations
-        locations['movie_plugins']  = os.path.join(locations['lib'], 'plugins', 'movie')
+        locations['movie_plugins'] = os.path.join(locations['lib'], 'plugins', 'movie')
         locations['export_plugins'] = os.path.join(locations['lib'], 'plugins', 'export')
-        locations['images']  = os.path.join(locations['share'], 'images')
+        locations['images'] = os.path.join(locations['share'], 'images')
         locations['desktop'] = os.path.join(os.path.expanduser('~'), 'Desktop').decode(defaultEnc)
     else:
         print 'Operating system not supported'
@@ -119,6 +121,7 @@
     self.locations = locations
     return locations
 
+
 def gui(self):
     self._ = None
 
@@ -138,6 +141,7 @@
 
     self.pdf_reader = self.config.get('pdf_reader')
 
+
 def i18n(self, location):
     gettext.bindtextdomain('griffith', location)
     gettext.textdomain('griffith')
@@ -145,6 +149,7 @@
     gtk.glade.textdomain('griffith')
     gettext.install('griffith', location, unicode=1)
 
+
 def toolbar(self):
     &quot;&quot;&quot;if toolbar is hide in config lets hide the widget&quot;&quot;&quot;
     if not self.config.get('view_toolbar', True, section='window'):
@@ -160,80 +165,81 @@
         self.widgets['extensions']['toolbar_hb'].show()
         self.widgets['menu']['ext_toolbar'].set_active(True)
 
+
 def treeview(self):
     self.treemodel = gtk.TreeStore(str, gtk.gdk.Pixbuf, str, str, str, str, bool, str, str)
     self.widgets['treeview'].set_model(self.treemodel)
     self.widgets['treeview'].set_headers_visible(True)
     # number column
-    renderer=gtk.CellRendererText()
-    self.number_column=gtk.TreeViewColumn(_('N.'), renderer, text=0)
+    renderer = gtk.CellRendererText()
+    self.number_column = gtk.TreeViewColumn(_('N.'), renderer, text=0)
     self.number_column.set_resizable(True)
     self.number_column.set_sort_column_id(0)
     self.number_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.number_column)
     # pic column
-    renderer=gtk.CellRendererPixbuf()
-    self.image_column=gtk.TreeViewColumn(_('Image'), renderer, pixbuf=1)
+    renderer = gtk.CellRendererPixbuf()
+    self.image_column = gtk.TreeViewColumn(_('Image'), renderer, pixbuf=1)
     self.image_column.set_resizable(False)
     self.image_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.image_column)
     # original title column
-    renderer=gtk.CellRendererText()
-    self.otitle_column=gtk.TreeViewColumn(_('Original Title'), renderer, text=2)
+    renderer = gtk.CellRendererText()
+    self.otitle_column = gtk.TreeViewColumn(_('Original Title'), renderer, text=2)
     self.otitle_column.set_resizable(True)
     self.otitle_column.set_sort_column_id(2)
     self.otitle_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.otitle_column)
     # title column
-    renderer=gtk.CellRendererText()
-    self.title_column=gtk.TreeViewColumn(_('Title'), renderer, text=3)
+    renderer = gtk.CellRendererText()
+    self.title_column = gtk.TreeViewColumn(_('Title'), renderer, text=3)
     self.title_column.set_resizable(True)
     self.title_column.set_sort_column_id(3)
     self.title_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.title_column)
     # director column
-    renderer=gtk.CellRendererText()
-    self.director_column=gtk.TreeViewColumn(_('Director'), renderer, text=4)
+    renderer = gtk.CellRendererText()
+    self.director_column = gtk.TreeViewColumn(_('Director'), renderer, text=4)
     self.director_column.set_sort_column_id(4)
     self.director_column.set_resizable(True)
     self.director_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.director_column)
     # genre column
-    renderer=gtk.CellRendererText()
-    self.genre_column=gtk.TreeViewColumn(_('Genre'), renderer, text=5)
+    renderer = gtk.CellRendererText()
+    self.genre_column = gtk.TreeViewColumn(_('Genre'), renderer, text=5)
     self.genre_column.set_sort_column_id(5)
     self.genre_column.set_resizable(True)
     self.genre_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.genre_column)
     # seen column
-    renderer=gtk.CellRendererToggle()
-    self.seen_column=gtk.TreeViewColumn(_('Seen it'), renderer, active=6)
+    renderer = gtk.CellRendererToggle()
+    self.seen_column = gtk.TreeViewColumn(_('Seen it'), renderer, active=6)
     self.seen_column.set_sort_column_id(6)
     self.seen_column.set_resizable(True)
     self.seen_column.set_reorderable(True)
     self.widgets['treeview'].insert_column(self.seen_column, 1)
     # year column
-    renderer=gtk.CellRendererText()
+    renderer = gtk.CellRendererText()
     renderer.set_property('xalign', 0.5)
-    self.year_column=gtk.TreeViewColumn(_('Year'), renderer, text=7)
+    self.year_column = gtk.TreeViewColumn(_('Year'), renderer, text=7)
     self.year_column.set_sort_column_id(7)
     self.year_column.set_resizable(True)
     self.year_column.set_alignment(0.5)
     self.year_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.year_column)
     # runtime column
-    renderer=gtk.CellRendererText()
+    renderer = gtk.CellRendererText()
     renderer.set_property('xalign', 1)
-    self.runtime_column=gtk.TreeViewColumn(_('Runtime'), renderer, text=8)
+    self.runtime_column = gtk.TreeViewColumn(_('Runtime'), renderer, text=8)
     self.runtime_column.set_sort_column_id(8)
     self.runtime_column.set_resizable(True)
     self.runtime_column.set_alignment(1)
     self.runtime_column.set_reorderable(True)
     self.widgets['treeview'].append_column(self.runtime_column)
     # rating column
-    renderer=gtk.CellRendererText()
+    renderer = gtk.CellRendererText()
     renderer.set_property('xalign', 0.5)
-    self.rating_column=gtk.TreeViewColumn(_('Rating'), renderer, text=9)
+    self.rating_column = gtk.TreeViewColumn(_('Rating'), renderer, text=9)
     self.rating_column.set_sort_column_id(9)
     self.rating_column.set_resizable(True)
     self.rating_column.set_alignment(0.5)
@@ -279,27 +285,29 @@
     self.total = self.db.session.query(db.Movie).count()
     self.widgets['treeview'].show()
 
+
 def loans_treeview(self):
     self.loans_treemodel = gtk.TreeStore(str, str, str) # move to self.widgets
     self.widgets['movie']['loan_history'].set_model(self.loans_treemodel)
     self.widgets['movie']['loan_history'].set_headers_visible(True)
     # loan date
-    renderer=gtk.CellRendererText()
-    self.date_column=gtk.TreeViewColumn(_('Loan Date'), renderer, text=0)
+    renderer = gtk.CellRendererText()
+    self.date_column = gtk.TreeViewColumn(_('Loan Date'), renderer, text=0)
     self.date_column.set_resizable(True)
     self.widgets['movie']['loan_history'].append_column(self.date_column)
     self.date_column.set_sort_column_id(0)
     # return date
-    renderer=gtk.CellRendererText()
-    self.return_column=gtk.TreeViewColumn(_('Return Date'), renderer, text=1)
+    renderer = gtk.CellRendererText()
+    self.return_column = gtk.TreeViewColumn(_('Return Date'), renderer, text=1)
     self.return_column.set_resizable(True)
     self.widgets['movie']['loan_history'].append_column(self.return_column)
     # loan to
-    renderer=gtk.CellRendererText()
-    self.loaner_column=gtk.TreeViewColumn(_('Loaned To'), renderer, text=2)
+    renderer = gtk.CellRendererText()
+    self.loaner_column = gtk.TreeViewColumn(_('Loaned To'), renderer, text=2)
     self.loaner_column.set_resizable(True)
     self.widgets['movie']['loan_history'].append_column(self.loaner_column)
 
+
 def lang_treeview(self):
     treeview = self.widgets['add']['lang_treeview']
     self.lang['model'] = gtk.TreeStore(str, str, str, str, str)
@@ -315,7 +323,7 @@
     combo.set_property('editable', True)
     combo.set_property('has-entry', False)
     combo.connect('edited', self.on_tv_lang_combo_edited, 0)
-    column=gtk.TreeViewColumn(_('Language'), combo, text=0)
+    column = gtk.TreeViewColumn(_('Language'), combo, text=0)
     column.set_property('min-width', 80)
     column.set_property('resizable', True)
     column.set_sort_column_id(0)
@@ -337,7 +345,7 @@
     combo.set_property('editable', True)
     combo.set_property('has-entry', False)
     combo.connect('edited', self.on_tv_lang_combo_edited, 1)
-    column=gtk.TreeViewColumn(_('Type'), combo, text=1)
+    column = gtk.TreeViewColumn(_('Type'), combo, text=1)
     column.set_property('min-width', 80)
     column.set_property('resizable', True)
     column.set_sort_column_id(1)
@@ -352,7 +360,7 @@
     combo.set_property('editable', True)
     combo.set_property('has-entry', False)
     combo.connect('edited', self.on_tv_lang_combo_edited, 2)
-    column=gtk.TreeViewColumn(_('Codec'), combo, text=2)
+    column = gtk.TreeViewColumn(_('Codec'), combo, text=2)
     column.set_property('min-width', 80)
     column.set_property('resizable', True)
     column.set_sort_column_id(2)
@@ -367,7 +375,7 @@
     combo.set_property('editable', True)
     combo.set_property('has-entry', False)
     combo.connect('edited', self.on_tv_lang_combo_edited, 3)
-    column=gtk.TreeViewColumn(_('Channels'), combo, text=3)
+    column = gtk.TreeViewColumn(_('Channels'), combo, text=3)
     column.set_property('min-width', 80)
     column.set_property('resizable', True)
     column.set_sort_column_id(3)
@@ -382,7 +390,7 @@
     combo.set_property('editable', True)
     combo.set_property('has-entry', False)
     combo.connect('edited', self.on_tv_lang_combo_edited, 4)
-    column=gtk.TreeViewColumn(_('Subtitle format'), combo, text=4)
+    column = gtk.TreeViewColumn(_('Subtitle format'), combo, text=4)
     column.set_property('min-width', 80)
     column.set_property('resizable', True)
     column.set_sort_column_id(4)
@@ -390,6 +398,7 @@
 
     treeview.show_all()
 
+
 def movie_plugins(self):
     &quot;&quot;&quot;
     dinamically finds the movie source information plugins
@@ -401,8 +410,8 @@
     mcounter = 0
     default_plugin = self.config.get('default_movie_plugin')
     for p in self.plugins:
-        plugin_module = os.path.basename(p).replace('.py','')
-        plugin_name = plugin_module.replace('PluginMovie','')
+        plugin_module = os.path.basename(p).replace('.py', '')
+        plugin_name = plugin_module.replace('PluginMovie', '')
         self.widgets['add']['source'].append_text(plugin_name)
         self.widgets['preferences']['default_plugin'].append_text(plugin_name)
         if plugin_name == default_plugin:
@@ -410,6 +419,7 @@
             self.widgets['add']['source'].set_active(mcounter)
         mcounter = mcounter + 1
 
+
 def export_plugins(self):
     &quot;&quot;&quot;
     dinamically finds the available export plugins
@@ -426,15 +436,16 @@
         menu_items.connect('activate', self.on_export_activate, plugin_name)
         menu_items.show()
 
+
 def import_plugins(self):
     &quot;&quot;&quot;
     dinamically finds the available import plugins
     and fills the import menu entry
     &quot;&quot;&quot;
 
-    import plugins.imp, math
+    import plugins.imp
 
-    fields_to_import = ( 'number','title', 'o_title', 'director', 'year', 'runtime', 'country',
+    fields_to_import = ('number', 'title', 'o_title', 'director', 'year', 'runtime', 'country',
         'seen', 'rating', 'genre', 'studio', 'plot', 'cast', 'notes', 'classification',
         'site', 'o_site', 'trailer', 'medium_id', 'media_num', 'vcodec_id', 'color', 'cond',
         'layers', 'region', 'collection_id', 'volume_id', 'image', 'ratio_id', 'screenplay',
@@ -445,21 +456,21 @@
     get = lambda x: glade_file.get_widget(x)
 
     w = self.widgets['import'] = {
-        'window'    : get('dialog_import'),
-        'pwindow'    : get('dialog_progress'),
-        'pabort'    : get('p_abortbutton'),
-        'fcw'        : get('fcw'),
-        'plugin'    : get('combo_plugin'),
-        'author'    : get('l_author'),
-        'email'        : get('l_email'),
-        'version'    : get('l_version'),
-        'description'    : get('l_description'),
-        'box_import_1'    : get('box_import_1'),
-        'box_import_2'    : get('box_import_2'),
-        'box_import_3'    : get('box_import_3'),
-        'progress'    : get('l_progress'),
-        'progressbar'    : get('progressbar'),
-        'fields'    : {},
+        'window': get('dialog_import'),
+        'pwindow': get('dialog_progress'),
+        'pabort': get('p_abortbutton'),
+        'fcw': get('fcw'),
+        'plugin': get('combo_plugin'),
+        'author': get('l_author'),
+        'email': get('l_email'),
+        'version': get('l_version'),
+        'description': get('l_description'),
+        'box_import_1': get('box_import_1'),
+        'box_import_2': get('box_import_2'),
+        'box_import_3': get('box_import_3'),
+        'progress': get('l_progress'),
+        'progressbar': get('progressbar'),
+        'fields': {},
     }
     get('cancel_button').connect('clicked', plugins.imp.on_abort_button_clicked, self)
     get('import_button').connect('clicked', plugins.imp.on_import_button_clicked, self)
@@ -473,14 +484,14 @@
 
     # fields to import
     j = 0
-    k = math.ceil( len(self.field_names) / float(3) )
+    k = math.ceil(len(self.field_names) / float(3))
     for i in fields_to_import:
         j = j + 1
         w['fields'][i] = gtk.CheckButton(self.field_names[i])
         w['fields'][i].set_active(True) # TODO: get from config
         if j &lt;= k:
             w['box_import_1'].add(w['fields'][i])
-        elif j&lt;= 2*k:
+        elif j &lt;= 2 * k:
             w['box_import_2'].add(w['fields'][i])
         else:
             w['box_import_3'].add(w['fields'][i])
@@ -488,6 +499,7 @@
     w['box_import_2'].show_all()
     w['box_import_3'].show_all()
 
+
 def extension(self, module, enabled):
     if enabled:
         try:
@@ -515,6 +527,7 @@
 
     return ext
 
+
 def extension_preferences(self, module, enabled):
     # preferences window
     p_vbox = self.widgets['extensions']['preferences_vbox']
@@ -567,9 +580,9 @@
                 count = count + 1
             # combobox with complex binding to a model needs cell renderer
             w = gtk.ComboBox(model=model)
-            renderer=gtk.CellRendererText()
+            renderer = gtk.CellRendererText()
             w.pack_start(renderer)
-            w.add_attribute(renderer, 'text', 1);
+            w.add_attribute(renderer, 'text', 1)
             if pos is not None:
                 w.set_active(int(pos))
         else:
@@ -590,6 +603,7 @@
 
     return configwidgets
 
+
 def extensions(self):
     import plugins.extensions
     user_extensions_path = os.path.join(self.locations['home'], 'lib', 'extensions')
@@ -610,22 +624,23 @@
         if ext:
             self.extensions.append(ext)
 
+
 def people_treeview(self, create=True):
     row = None
     self.p_treemodel = gtk.TreeStore(gobject.TYPE_STRING, gobject.TYPE_STRING, gobject.TYPE_STRING, gobject.TYPE_STRING)
     self.widgets['preferences']['treeview'].set_model(self.p_treemodel)
     self.widgets['preferences']['treeview'].set_headers_visible(True)
 
-    if create==True:
+    if create is True:
         # name column
-        renderer=gtk.CellRendererText()
-        column=gtk.TreeViewColumn(_('Name'), renderer, text=0)
+        renderer = gtk.CellRendererText()
+        column = gtk.TreeViewColumn(_('Name'), renderer, text=0)
         column.set_resizable(True)
         column.set_sort_column_id(0)
         self.widgets['preferences']['treeview'].append_column(column)
         # email column
-        renderer=gtk.CellRendererText()
-        column=gtk.TreeViewColumn(_('E-mail'),renderer, text=1)
+        renderer = gtk.CellRendererText()
+        column = gtk.TreeViewColumn(_('E-mail'), renderer, text=1)
         column.set_resizable(True)
         column.set_sort_column_id(1)
         self.widgets['preferences']['treeview'].append_column(column)
@@ -637,6 +652,7 @@
         self.p_treemodel.set_value(myiter, 1, i.email)
     self.widgets['preferences']['treeview'].show()
 
+
 def combos(self):
     i = 0
     for cond in self._conditions:
@@ -678,6 +694,7 @@
     self.widgets['preferences']['sortby'].set_wrap_width(3)
     self.widgets['preferences']['sortby'].set_active(0) # Number
 
+
 def dictionaries(self):
     &quot;&quot;&quot;initializes data filled dynamically by users&quot;&quot;&quot;
     self.am_tags = {} # dictionary for tag CheckBoxes
@@ -702,42 +719,42 @@
         'o_title', 'title', 'number', 'director', 'plot', 'cast', 'notes', 'year',
         'runtime', 'country', 'genre', 'studio', 'media_num', 'rating')
     self.field_names = {
-        'barcode'        : _('Barcode'),
-        'cast'           : _('Cast'),
-        'cameraman'      : _('Cameraman'),
-        'classification' : _('Classification'),
-        'collection_id'  : _('Collection'),
-        'color'          : _('Color'),
-        'cond'           : _('Condition'),
-        'country'        : _('Country'),
-        'director'       : _('Director'),
-        'genre'          : _('Genre'),
-        'image'          : _('Image'),
-        'layers'         : _('Layers'),
-        'loaned'         : _('Loaned'),
-        'media_num'      : _('Discs'),
-        'medium_id'      : _('Medium'),
-        'notes'          : _('Notes'),
-        'number'         : _('Number'),
-        'o_site'         : _('Official site'),
-        'o_title'        : _('Original Title'),
-        'plot'           : _('Plot'),
-        'poster'         : _('Poster'),
-        'ratio_id'       : _('Aspect ratio'),
-        'rating'         : _('Rating'),
-        'region'         : _('Region'),
-        'runtime'        : _('Runtime'),
-        'screenplay'     : _('Screenplay'),
-        'seen'           : _('Seen it'),
-        'site'           : _('Site'),
-        'studio'         : _('Studio'),
-        'tags'           : _('Tags'),
-        'title'          : _('Title'),
-        'trailer'        : _('Trailer'),
-        'vcodec_id'      : _('Video codec'),
-        'volume_id'      : _('Volume'),
-        'year'           : _('Year')}
-    self._conditions = (_('N/A'), _('Damaged'), _('Poor'),  _('Fair'), _('Good'), _('Excellent'))
+        'barcode': _('Barcode'),
+        'cast': _('Cast'),
+        'cameraman': _('Cameraman'),
+        'classification': _('Classification'),
+        'collection_id': _('Collection'),
+        'color': _('Color'),
+        'cond': _('Condition'),
+        'country': _('Country'),
+        'director': _('Director'),
+        'genre': _('Genre'),
+        'image': _('Image'),
+        'layers': _('Layers'),
+        'loaned': _('Loaned'),
+        'media_num': _('Discs'),
+        'medium_id': _('Medium'),
+        'notes': _('Notes'),
+        'number': _('Number'),
+        'o_site': _('Official site'),
+        'o_title': _('Original Title'),
+        'plot': _('Plot'),
+        'poster': _('Poster'),
+        'ratio_id': _('Aspect ratio'),
+        'rating': _('Rating'),
+        'region': _('Region'),
+        'runtime': _('Runtime'),
+        'screenplay': _('Screenplay'),
+        'seen': _('Seen it'),
+        'site': _('Site'),
+        'studio': _('Studio'),
+        'tags': _('Tags'),
+        'title': _('Title'),
+        'trailer': _('Trailer'),
+        'vcodec_id': _('Video codec'),
+        'volume_id': _('Volume'),
+        'year': _('Year')}
+    self._conditions = (_('N/A'), _('Damaged'), _('Poor'), _('Fair'), _('Good'), _('Excellent'))
     self._colors = (_('N/A'), _('Color'), _('Black and White'), _('Mixed'))
     self._lang_types = ('', _('lector'), _('dubbing'), _('subtitles'), _('commentary'))
     self._layers = (_('N/A'), _('Single Side, Single Layer'), _('Single Side, Dual Layer'), _('Dual Side, Single Layer'), _('Dual Side, Dual Layer'))
@@ -753,6 +770,7 @@
         _('Region 8 (Airlines/Cruise Ships)'),
     )
 
+
 def web_results(self):
     self.treemodel_results = gtk.TreeStore(str, str)
     self.widgets['results']['treeview'].set_model(self.treemodel_results)
@@ -769,6 +787,7 @@
     column2.set_sort_column_id(1)
     self.widgets['results']['treeview'].append_column(column2)
 
+
 def spellcheck(self):
     global spell_support
     spell_error = False
@@ -779,7 +798,7 @@
                     self.notes_spell = gtkspell.Spell(self.widgets['add']['cast'], self.config.get('lang', section='spell'))
                 except:
                     spell_error = True
-            if self.config.get('plot', True, section='spell')==True and self.config.get('lang', section='spell') != '':
+            if self.config.get('plot', True, section='spell') is True and self.config.get('lang', section='spell') != '':
                 try:
                     self.plot_spell = gtkspell.Spell(self.widgets['add']['plot'], self.config.get('lang', section='spell'))
                 except:
@@ -788,18 +807,19 @@
                 log.info('Dictionary not available. Spellcheck will be disabled.')
                 if not self.config.get('notified', False, section='spell'):
                     gutils.info(_(&quot;Dictionary not available. Spellcheck will be disabled. \n&quot; + \
-                        &quot;Please install the aspell-%s package or adjust the spellchekcer preferences.&quot;)%self.config.get('lang', section='spell'), \
+                        &quot;Please install the aspell-%s package or adjust the spellchekcer preferences.&quot;) % self.config.get('lang', section='spell'), \
                         self.widgets['preferences']['window'])
                     self.config.set('notified', True, section='spell')
                     self.config.save()
     else:
         log.info('Spellchecker is not available')
 
+
 def preferences(self):
-    self.widgets['preferences']['db_type'].insert_text(0,'SQLite3 (internal)')
-    self.widgets['preferences']['db_type'].insert_text(1,'PostgreSQL')
-    self.widgets['preferences']['db_type'].insert_text(2,'MySQL')
-    self.widgets['preferences']['db_type'].insert_text(3,'Microsoft SQL')
+    self.widgets['preferences']['db_type'].insert_text(0, 'SQLite3 (internal)')
+    self.widgets['preferences']['db_type'].insert_text(1, 'PostgreSQL')
+    self.widgets['preferences']['db_type'].insert_text(2, 'MySQL')
+    self.widgets['preferences']['db_type'].insert_text(3, 'Microsoft SQL')
     self.widgets['preferences']['db_host'].set_text(self.config.get('host', '', section='database'))
     self.widgets['preferences']['db_port'].set_value(int(self.config.get('port', 0, section='database')))
     self.widgets['preferences']['db_user'].set_text(self.config.get('user', '', section='database'))
@@ -826,18 +846,21 @@
     completion.set_model(treemodel)
     completion.set_text_column(0)
 
+
 def update_volume_combo_ids(self):
     self.volume_combo_ids = {}
     self.volume_combo_ids[0] = 0
     for i, item in enumerate(self.db.session.query(db.Volume.volume_id).all()):
-        self.volume_combo_ids[i+1] = item.volume_id
+        self.volume_combo_ids[i + 1] = item.volume_id
 
+
 def update_collection_combo_ids(self):
     self.collection_combo_ids = {}
     self.collection_combo_ids[0] = 0
     for i, item in enumerate(self.db.session.query(db.Collection.collection_id).all()):
-        self.collection_combo_ids[i+1] = item.collection_id
+        self.collection_combo_ids[i + 1] = item.collection_id
 
+
 def fill_volumes_combo(self, default=0):
     _tmp = self.initialized
     self.initialized = False # don't refresh main treeview
@@ -856,6 +879,7 @@
     self.widgets['add']['volume'].set_wrap_width(3)
     self.initialized = _tmp
 
+
 def fill_collections_combo(self, default=0):
     _tmp = self.initialized
     self.initialized = False # don't refresh main treeview
@@ -879,6 +903,7 @@
     self.widgets['add']['collection'].set_wrap_width(2)
     self.initialized = _tmp
 
+
 def fill_advfilter_combo(self):
     _tmp = self.initialized
     self.initialized = False # don't refresh main treeview
@@ -886,11 +911,12 @@
     self.widgets['filter']['advfilter'].insert_text(0, '') # empty one
     for i, item in enumerate(self.db.session.query(db.Filter.name).all()):
         # add some white spaces to prevent scrollbar hides parts of the names
-        self.widgets['filter']['advfilter'].insert_text(i+1, item.name + '   ')
+        self.widgets['filter']['advfilter'].insert_text(i + 1, item.name + '   ')
     self.widgets['filter']['advfilter'].show_all()
     self.widgets['filter']['advfilter'].set_active(0)
     self.initialized = _tmp
 
+
 def fill_preferences_tags_combo(self):
     _tmp = self.initialized
     self.initialized = False # don't refresh main treeview
@@ -903,6 +929,7 @@
     self.widgets['preferences']['tag_name'].set_active(0)
     self.initialized = _tmp
 
+
 def language_combos(self):
     self.widgets['preferences']['lang_name'].get_model().clear()
     self.languages_ids = {}
@@ -911,12 +938,13 @@
     self.widgets['preferences']['lang_name'].insert_text(0, '')
     for i, lang in enumerate(self.db.session.query(db.Lang.lang_id, db.Lang.name).all()):
         self.languages_ids[i] = lang.lang_id
-        self.widgets['preferences']['lang_name'].insert_text(i+1, lang.name)
+        self.widgets['preferences']['lang_name'].insert_text(i + 1, lang.name)
         # add movie languages treeview
         self.lang['lang'].append([lang.lang_id, lang.name])
     self.widgets['preferences']['lang_name'].show_all()
     self.widgets['preferences']['lang_name'].set_active(0)
 
+
 def acodec_combos(self):
     self.widgets['preferences']['acodec_name'].get_model().clear()
     self.acodecs_ids = {}
@@ -925,12 +953,13 @@
     self.widgets['preferences']['acodec_name'].insert_text(0, '')
     for i, acodec in enumerate(self.db.session.query(db.ACodec.acodec_id, db.ACodec.name).all()):
         self.acodecs_ids[i] = acodec.acodec_id
-        self.widgets['preferences']['acodec_name'].insert_text(i+1, acodec.name)
+        self.widgets['preferences']['acodec_name'].insert_text(i + 1, acodec.name)
         # add movie languages treeview
         self.lang['acodec'].append([acodec.acodec_id, acodec.name])
     self.widgets['preferences']['acodec_name'].show_all()
     self.widgets['preferences']['acodec_name'].set_active(0)
 
+
 def achannel_combos(self):
     self.widgets['preferences']['achannel_name'].get_model().clear()
     self.achannels_ids = {}
@@ -939,12 +968,13 @@
     self.widgets['preferences']['achannel_name'].insert_text(0, '')
     for i, achannel in enumerate(self.db.session.query(db.AChannel.achannel_id, db.AChannel.name).all()):
         self.achannels_ids[i] = achannel.achannel_id
-        self.widgets['preferences']['achannel_name'].insert_text(i+1, achannel.name)
+        self.widgets['preferences']['achannel_name'].insert_text(i + 1, achannel.name)
         # add movie languages treeview
         self.lang['achannel'].append([achannel.achannel_id, achannel.name])
     self.widgets['preferences']['achannel_name'].show_all()
     self.widgets['preferences']['achannel_name'].set_active(0)
 
+
 def subformat_combos(self):
     self.widgets['preferences']['subformat_name'].get_model().clear()
     self.subformats_ids = {}
@@ -953,12 +983,13 @@
     self.widgets['preferences']['subformat_name'].insert_text(0, '')
     for i, subformat in enumerate(self.db.session.query(db.SubFormat.subformat_id, db.SubFormat.name).all()):
         self.subformats_ids[i] = subformat.subformat_id
-        self.widgets['preferences']['subformat_name'].insert_text(i+1, subformat.name)
+        self.widgets['preferences']['subformat_name'].insert_text(i + 1, subformat.name)
         # add movie languages treeview
         self.lang['subformat'].append([subformat.subformat_id, subformat.name])
     self.widgets['preferences']['subformat_name'].show_all()
     self.widgets['preferences']['subformat_name'].set_active(0)
 
+
 def media_combos(self):
     # clear data
     self.widgets['preferences']['medium_name'].get_model().clear()
@@ -972,10 +1003,10 @@
     self.widgets['add']['media'].insert_text(0, _('N/A'))
     self.widgets['preferences']['media'].insert_text(0, _('N/A'))
     for i, medium in enumerate(self.db.session.query(db.Medium.medium_id, db.Medium.name).all()):
-        self.media_ids[i+1] = medium.medium_id
-        self.widgets['preferences']['medium_name'].insert_text(i+1, medium.name)
-        self.widgets['add']['media'].insert_text(i+1, medium.name)
-        self.widgets['preferences']['media'].insert_text(i+1, medium.name)
+        self.media_ids[i + 1] = medium.medium_id
+        self.widgets['preferences']['medium_name'].insert_text(i + 1, medium.name)
+        self.widgets['add']['media'].insert_text(i + 1, medium.name)
+        self.widgets['preferences']['media'].insert_text(i + 1, medium.name)
 
     self.widgets['preferences']['medium_name'].show_all()
     self.widgets['add']['media'].show_all()
@@ -990,6 +1021,7 @@
         self.widgets['preferences']['media'].set_active(0)
     self.widgets['preferences']['medium_name'].set_active(0)
 
+
 def vcodec_combos(self):
     # clear data
     self.widgets['preferences']['vcodec_name'].get_model().clear()
@@ -1003,10 +1035,10 @@
     self.widgets['add']['vcodec'].insert_text(0, _('N/A'))
     self.widgets['preferences']['vcodec'].insert_text(0, _('N/A'))
     for i, vcodec in enumerate(self.db.session.query(db.VCodec.vcodec_id, db.VCodec.name).all()):
-        self.vcodecs_ids[i+1] = vcodec.vcodec_id
-        self.widgets['preferences']['vcodec_name'].insert_text(i+1, vcodec.name)
-        self.widgets['add']['vcodec'].insert_text(i+1, vcodec.name)
-        self.widgets['preferences']['vcodec'].insert_text(i+1, vcodec.name)
+        self.vcodecs_ids[i + 1] = vcodec.vcodec_id
+        self.widgets['preferences']['vcodec_name'].insert_text(i + 1, vcodec.name)
+        self.widgets['add']['vcodec'].insert_text(i + 1, vcodec.name)
+        self.widgets['preferences']['vcodec'].insert_text(i + 1, vcodec.name)
 
     self.widgets['preferences']['vcodec_name'].show_all()
     self.widgets['add']['vcodec'].show_all()
@@ -1019,6 +1051,7 @@
         self.widgets['preferences']['vcodec'].set_active(0)
     self.widgets['preferences']['vcodec_name'].set_active(0)
 
+
 def create_tag_vbox(self, widget, tab):
     for i in widget.get_children():
         i.destroy()
@@ -1030,6 +1063,7 @@
         widget.pack_start(tab[i])
     widget.show_all()
 
+
 def remove_hbox(self, widget, tab):
     number = len(widget.get_children())-1    # last box number
     try:
@@ -1038,4 +1072,3 @@
     except:
         log.info('List is empty')
     widget.show_all()
-

Modified: trunk/lib/sql.py
===================================================================
--- trunk/lib/sql.py	2009-12-22 19:25:32 UTC (rev 1337)
+++ trunk/lib/sql.py	2009-12-22 19:37:40 UTC (rev 1338)
@@ -3,7 +3,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2005-2009 Vasco Nunes, Piotr O&#380;arowski
+# Copyright &#169; 2005-2009 Vasco Nunes, Piotr O&#380;arowski
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -144,15 +144,16 @@
         except:
             log.exception('')
 
+
 def update_whereclause(query, cond): # {{{
     if cond['loaned'] is True:
-        query = query.where(db.Movie.loaned==True)
+        query = query.where(db.Movie.loaned == True)
     if cond['loaned'] is False:
-        query = query.where(db.Movie.loaned==False)
+        query = query.where(db.Movie.loaned == False)
     if cond['seen'] is True:
-        query = query.where(db.Movie.seen==True)
+        query = query.where(db.Movie.seen == True)
     if cond['seen'] is False:
-        query = query.where(db.Movie.seen==False)
+        query = query.where(db.Movie.seen == False)
 
     if cond[&quot;collections&quot;]:
         query = query.where(db.Movie.collection_id.in_(cond[&quot;collections&quot;]))
@@ -167,68 +168,74 @@
     loaned_to = []
     for per_id in cond[&quot;loaned_to&quot;]:
         loaned_to.append(exists([db.tables.loans.c.movie_id],\
-                and_(db.Movie.movie_id==db.tables.loans.c.movie_id, db.tables.loans.c.person_id==per_id, db.tables.loans.c.return_date==None)))
+                and_(db.Movie.movie_id == db.tables.loans.c.movie_id,
+                     db.tables.loans.c.person_id == per_id,
+                     db.tables.loans.c.return_date == None)))
     if loaned_to:
         query = query.where(or_(*loaned_to))
 
     loan_history = []
     for per_id in cond[&quot;loan_history&quot;]:
         loan_history.append(exists([db.tables.loans.c.movie_id],\
-                and_(db.Movie.movie_id==db.tables.loans.c.movie_id, db.tables.loans.c.person_id==per_id)))
+                and_(db.Movie.movie_id == db.tables.loans.c.movie_id,
+                     db.tables.loans.c.person_id == per_id)))
     if loan_history:
         query = query.where(or_(*loan_history))
 
     required_tags = []
     for tag_id in cond[&quot;required_tags&quot;]:
         required_tags.append(exists([db.MovieTag.movie_id], \
-            and_(db.Movie.movie_id==db.MovieTag.movie_id, db.MovieTag.tag_id==tag_id)))
+            and_(db.Movie.movie_id == db.MovieTag.movie_id,
+                 db.MovieTag.tag_id == tag_id)))
     if required_tags:
         query = query.where(and_(*required_tags))
 
     tags = []
     for tag_id in cond[&quot;tags&quot;]:
         tags.append(exists([db.MovieTag.movie_id], \
-            and_(db.Movie.movie_id==db.MovieTag.movie_id, db.MovieTag.tag_id==tag_id)))
+            and_(db.Movie.movie_id == db.MovieTag.movie_id,
+                 db.MovieTag.tag_id == tag_id)))
     if tags:
         query = query.where(or_(*tags))
 
     no_tags = []
     for tag_id in cond[&quot;no_tags&quot;]:
         no_tags.append(~exists([db.MovieTag.movie_id], \
-            and_(db.Movie.movie_id==db.MovieTag.movie_id, db.MovieTag.tag_id==tag_id)))
+            and_(db.Movie.movie_id == db.MovieTag.movie_id,
+                 db.MovieTag.tag_id == tag_id)))
     if no_tags:
         query = query.where(and_(*no_tags))
 
     for field in cond[&quot;equals_n&quot;]:
-        values = [ db.tables.movies.columns[field]!=value for value in cond[&quot;equals_n&quot;][field] ]
+        values = [db.tables.movies.columns[field] != value for value in cond[&quot;equals_n&quot;][field]]
         query = query.where(and_(*values))
 
     for field in cond[&quot;startswith_n&quot;]:
-        values = [ not_(db.tables.movies.columns[field].startswith(value)) for value in cond[&quot;startswith_n&quot;][field] ]
+        values = [not_(db.tables.movies.columns[field].startswith(value)) for value in cond[&quot;startswith_n&quot;][field]]
         query = query.where(and_(*values))
 
     for field in cond[&quot;like_n&quot;]:
-        values = [ not_(db.tables.movies.columns[field].like(value)) for value in cond[&quot;like_n&quot;][field] ]
+        values = [not_(db.tables.movies.columns[field].like(value)) for value in cond[&quot;like_n&quot;][field]]
         query = query.where(and_(*values))
 
     for field in cond[&quot;contains_n&quot;]: # XXX: it's not the SQLAlchemy's .contains() i.e. not for one-to-many or many-to-many collections
-        values = [ not_(db.tables.movies.columns[field].like('%'+value+'%')) for value in cond[&quot;contains_n&quot;][field] ]
+        values = [not_(db.tables.movies.columns[field].like('%' + value + '%')) for value in cond[&quot;contains_n&quot;][field]]
         query = query.where(and_(*values))
 
     for field in cond[&quot;equals&quot;]:
-        values = [ db.tables.movies.columns[field]==value for value in cond[&quot;equals&quot;][field] ]
+        values = [db.tables.movies.columns[field] == value for value in cond[&quot;equals&quot;][field]]
         query = query.where(or_(*values))
 
     for field in cond[&quot;startswith&quot;]:
-        values = [ db.tables.movies.columns[field].startswith(value) for value in cond[&quot;startswith&quot;][field] ]
+        values = [db.tables.movies.columns[field].startswith(value) for value in cond[&quot;startswith&quot;][field]]
         query = query.where(or_(*values))
 
     for field in cond[&quot;like&quot;]:
-        values = [ db.tables.movies.columns[field].like(value) for value in cond[&quot;like&quot;][field] ]
+        values = [db.tables.movies.columns[field].like(value) for value in cond[&quot;like&quot;][field]]
         query = query.where(or_(*values))
 
     for field in cond[&quot;contains&quot;]: # XXX: it's not the SQLAlchemy's .contains() i.e. not for one-to-many or many-to-many collections
-        values = [ db.tables.movies.columns[field].like('%'+value+'%') for value in cond[&quot;contains&quot;][field] ]
+        values = [db.tables.movies.columns[field].like('%' + value + '%') for value in cond[&quot;contains&quot;][field]]
         query = query.where(or_(*values))
 
     # sorting
@@ -254,4 +261,3 @@
 
     log.debug(query)
     return query #}}}
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000805.html">[Griffith-svn] r1337 - trunk/lib/plugins/extensions
</A></li>
	<LI>Next message: <A HREF="000807.html">[Griffith-svn] r1339 - in trunk: . glade lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#806">[ date ]</a>
              <a href="thread.html#806">[ thread ]</a>
              <a href="subject.html#806">[ subject ]</a>
              <a href="author.html#806">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/griffith-svn">More information about the Griffith-svn
mailing list</a><br>
</body></html>
