<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Griffith-svn] r1189 - branches/0.9.x branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk trunk/lib	trunk/lib/plugins/movie
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/griffith-svn/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1189%20-%20branches/0.9.x%20branches/0.9.x/lib%0A%09branches/0.9.x/lib/plugins/movie%20trunk%20trunk/lib%0A%09trunk/lib/plugins/movie&In-Reply-To=%3C200904172028.n3HKSQKd002762%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000660.html">
   <LINK REL="Next"  HREF="000662.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Griffith-svn] r1189 - branches/0.9.x branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk trunk/lib	trunk/lib/plugins/movie</H1>
    <B>mikej06 at mail.berlios.de</B> 
    <A HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1189%20-%20branches/0.9.x%20branches/0.9.x/lib%0A%09branches/0.9.x/lib/plugins/movie%20trunk%20trunk/lib%0A%09trunk/lib/plugins/movie&In-Reply-To=%3C200904172028.n3HKSQKd002762%40sheep.berlios.de%3E"
       TITLE="[Griffith-svn] r1189 - branches/0.9.x branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk trunk/lib	trunk/lib/plugins/movie">mikej06 at mail.berlios.de
       </A><BR>
    <I>Fri Apr 17 22:28:26 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000660.html">[Griffith-svn] r1188 - branches/0.9.x branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk trunk/lib	trunk/lib/plugins/movie
</A></li>
        <LI>Next message: <A HREF="000662.html">[Griffith-svn] r1190 - trunk/lib/plugins/movie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#661">[ date ]</a>
              <a href="thread.html#661">[ thread ]</a>
              <a href="subject.html#661">[ subject ]</a>
              <a href="author.html#661">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mikej06
Date: 2009-04-17 22:27:26 +0200 (Fri, 17 Apr 2009)
New Revision: 1189

Modified:
   branches/0.9.x/ChangeLog
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
   branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
   branches/0.9.x/lib/test_movieplugins.py
   trunk/ChangeLog
   trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
   trunk/lib/plugins/movie/PluginMovieFilmtipset.py
   trunk/lib/test_movieplugins.py
Log:
* updated FilmAffinity plugin
* updated Filmtipset plugin

Modified: branches/0.9.x/ChangeLog
===================================================================
--- branches/0.9.x/ChangeLog	2009-04-16 20:23:17 UTC (rev 1188)
+++ branches/0.9.x/ChangeLog	2009-04-17 20:27:26 UTC (rev 1189)
@@ -5,6 +5,10 @@
 (c) 2005-2009  Vasco Nunes, Piotr O&#197;&#188;arowski
 
 
+2009-04-17  Michael Jahn
+	* updated FilmAffinity plugin
+	* updated Filmtipset plugin
+
 2009-04-16  Michael Jahn
 	* updated Culturalia plugin
 	* updated E-Pipoca plugin

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2009-04-16 20:23:17 UTC (rev 1188)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmAffinity.py	2009-04-17 20:27:26 UTC (rev 1189)
@@ -1,8 +1,8 @@
-# -*- coding: iso-8859-15 -*-
+# -*- coding: iso8859-1 -*-
 
 __revision__ = '$Id: PluginMovieFilmAffinity.py 389 2006-07-29 18:43:35Z piotrek $'
 
-# Copyright (c) 2006 Pedro D. S&#225;nchez
+# Copyright (c) 2006-2009 Pedro D. S&#225;nchez
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -25,17 +25,17 @@
 import movie
 import string, re
 
-plugin_name		= 'FilmAffinity'
-plugin_description	= 'Base de Datos de Peliculas'
-plugin_url		= 'www.filmaffinity.com'
-plugin_language		= _('Spanish')
-plugin_author		= 'Pedro D. S&#225;nchez'
-plugin_author_email	= '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
-plugin_version		= '0.3'
+plugin_name         = 'FilmAffinity'
+plugin_description  = 'Base de Datos de Peliculas'
+plugin_url          = 'www.filmaffinity.com'
+plugin_language     = _('Spanish')
+plugin_author       = 'Pedro D. S&#225;nchez'
+plugin_author_email = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
+plugin_version      = '0.3'
 
 class Plugin(movie.Movie):
 	def __init__(self, id):
-		self.encode   = 'iso-8859-15'
+		self.encode   = 'iso-8859-1'
 		self.movie_id = id
 		self.url      = &quot;<A HREF="http://www.filmaffinity.com/es/film%s.html">http://www.filmaffinity.com/es/film%s.html</A>&quot; % str(self.movie_id)
 
@@ -94,6 +94,7 @@
 		self.cast = re.sub('&lt;/a&gt;,[ ]*', '\n', self.cast)
 		self.cast = string.strip(gutils.strip_tags(self.cast))
 		self.cast = re.sub('[ ]+', ' ', self.cast)
+		self.cast = re.sub('\n[ ]+', '\n', self.cast)
 
 	def get_classification(self):
 		self.classification = ''
@@ -128,9 +129,9 @@
 class SearchPlugin(movie.SearchMovie):
 
 	def __init__(self):
-		self.original_url_search	= '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
-		self.translated_url_search	= '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
-		self.encode = 'iso-8859-15'
+		self.original_url_search   = '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
+		self.translated_url_search = '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
+		self.encode                = 'iso-8859-1'
 
 	def search(self,parent_window):
 		self.open_search(parent_window)
@@ -160,3 +161,54 @@
 					self.ids.append(gutils.trim(element, '&lt;b&gt;&lt;a href=&quot;/es/film', '.html'))
 					title = gutils.after(element, '&lt;b&gt;&lt;a href=&quot;/es/film')
 					self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.after(title, '&gt;'))))
+
+#
+# Plugin Test
+#
+class SearchPluginTest(SearchPlugin):
+	#
+	# Configuration for automated tests:
+	# dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
+	#
+	test_configuration = {
+		'Rocky' : [ 9, 9 ],
+	}
+
+class PluginTest:
+	#
+	# Configuration for automated tests:
+	# dict { movie_id -&gt; dict { arribute -&gt; value } }
+	#
+	# value: * True/False if attribute only should be tested for any value
+	#        * or the expected value
+	#
+	test_configuration = {
+		'706925' : { 
+			'title'               : 'Rocky Balboa (Rocky VI)',
+			'o_title'             : 'Rocky Balboa (Rocky VI)',
+			'director'            : 'Sylvester Stallone',
+			'plot'                : True,
+			'cast'                : 'Sylvester Stallone\n\
+Burt Young\n\
+Tony Burton\n\
+Milo Ventimiglia\n\
+James Francis Kelly III\n\
+Talia Shire\n\
+Angela Boyd\n\
+Antonio Tarver\n\
+Geraldine Hughes\n\
+Mike Tyson',
+			'country'             : 'Estados Unidos',
+			'genre'               : u'Acci&#243;n / Drama / Deporte (Boxeo)',
+			'classification'      : False,
+			'studio'              : 'MGM / UA / Columbia Pictures / Revolution Studios',
+			'o_site'              : '<A HREF="http://www.rockythemovie.com">http://www.rockythemovie.com</A>',
+			'site'                : '<A HREF="http://www.filmaffinity.com/es/film706925.html">http://www.filmaffinity.com/es/film706925.html</A>',
+			'trailer'             : False,
+			'year'                : 2006,
+			'notes'               : False,
+			'runtime'             : 102,
+			'image'               : True,
+			'rating'              : 6
+		},
+	}

Modified: branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2009-04-16 20:23:17 UTC (rev 1188)
+++ branches/0.9.x/lib/plugins/movie/PluginMovieFilmtipset.py	2009-04-17 20:27:26 UTC (rev 1189)
@@ -2,7 +2,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2007
+# Copyright (c) 2007-2009
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -26,20 +26,20 @@
 import string
 import re
 
-plugin_name = &quot;Filmtipset.se&quot;
-plugin_description = &quot;Filmtipset.se&quot;
-plugin_url = &quot;www.filmtipset.se&quot;
-plugin_language = _(&quot;Swedish&quot;)
-plugin_author = &quot;Michael Jahn&quot;
+plugin_name         = &quot;Filmtipset.se&quot;
+plugin_description  = &quot;Filmtipset.se&quot;
+plugin_url          = &quot;www.filmtipset.se&quot;
+plugin_language     = _(&quot;Swedish&quot;)
+plugin_author       = &quot;Michael Jahn&quot;
 plugin_author_email = &quot;&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;&quot;
-plugin_version = &quot;1.1&quot;
+plugin_version      = &quot;1.2&quot;
 
 class Plugin(movie.Movie):
 
 	def __init__(self, id):
-		self.encode='iso-8859-1'
+		self.encode   = 'iso-8859-1'
 		self.movie_id = id
-		self.url = '<A HREF="http://www.filmtipset.se/film/">http://www.filmtipset.se/film/</A>' + str(self.movie_id)
+		self.url      = '<A HREF="http://www.filmtipset.se/film/">http://www.filmtipset.se/film/</A>' + str(self.movie_id)
 
 	def get_image(self):
 		self.image_url = ''
@@ -53,7 +53,7 @@
 			self.o_title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
 
 	def get_title(self):
-		self.title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
+		self.title = gutils.after(gutils.trim(self.page, 'class=&quot;movie_header&quot;', '&lt;td'), '&gt;')
 
 	def get_director(self):
 		self.director = gutils.trim(self.page, 'Regiss&ouml;r:', '&lt;/tr&gt;')
@@ -73,7 +73,7 @@
 			self.genre = string.strip(gutils.trim(self.page, 'Genre:', '&lt;/tr&gt;'))
 
 	def get_cast(self):
-		self.cast = self.regextrim(self.page, 'Sk&aring;despelare [^:]*[:]', '&lt;/tr&gt;')
+		self.cast = self.regextrim(self.page, 'Sk&aring;despelare[^:]*[:]', '&lt;/tr&gt;')
 		self.cast = string.replace(self.cast, ', ', '\n')
 
 	def get_classification(self):
@@ -99,6 +99,11 @@
 
 	def get_rating(self):
 		self.rating = &quot;0&quot;
+		tmp = gutils.trim(self.page, 'grade_images/grade1', '_')
+		try:
+			self.rating = str(int(tmp) * 2)
+		except:
+			pass
 
 	def get_notes(self):
 		self.notes = ''
@@ -124,7 +129,7 @@
 	def __init__(self):
 		self.original_url_search   = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
 		self.translated_url_search = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
-		self.encode='iso-8859-1'
+		self.encode                = 'iso-8859-1'
 
 	def search(self,parent_window):
 		self.open_search(parent_window)
@@ -146,5 +151,54 @@
 					self.ids.append(element[:searchResult.end() - 1])
 				self.titles.append(
 					gutils.strip_tags(gutils.trim(element, '&gt;', '&lt;/a&gt;')) + ' / ' +
-					string.replace(gutils.trim(element, 'title=&quot;', '&quot;'), '&nbsp;', ' ')
+					gutils.clean(string.replace(gutils.trim(element, 'Originaltitel:', '&lt;/div&gt;'), '&nbsp;', ' '))
 				)
+
+#
+# Plugin Test
+#
+class SearchPluginTest(SearchPlugin):
+	#
+	# Configuration for automated tests:
+	# dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
+	#
+	test_configuration = {
+		'Rocky' : [ 16, 16 ],
+	}
+
+class PluginTest:
+	#
+	# Configuration for automated tests:
+	# dict { movie_id -&gt; dict { arribute -&gt; value } }
+	#
+	# value: * True/False if attribute only should be tested for any value
+	#        * or the expected value
+	#
+	test_configuration = {
+		'rocky-balboa.html' : { 
+			'title'               : 'Rocky Balboa',
+			'o_title'             : 'Rocky Balboa',
+			'director'            : 'Sylvester Stallone',
+			'plot'                : True,
+			'cast'                : 'Sylvester Stallone\n\
+Burt Young\n\
+Milo Ventimiglia\n\
+Geraldine Hughes\n\
+Antonio Tarver\n\
+James Francis Kelly III\n\
+Tony Burton\n\
+Henry G Sanders',
+			'country'             : 'USA',
+			'genre'               : 'Drama, Action',
+			'classification'      : False,
+			'studio'              : False,
+			'o_site'              : '<A HREF="http://www.imdb.com/title/tt0479143/">http://www.imdb.com/title/tt0479143/</A>',
+			'site'                : '<A HREF="http://www.filmtipset.se/film/rocky-balboa.html">http://www.filmtipset.se/film/rocky-balboa.html</A>',
+			'trailer'             : False,
+			'year'                : 2006,
+			'notes'               : False,
+			'runtime'             : 102,
+			'image'               : True,
+			'rating'              : 6
+		},
+	}

Modified: branches/0.9.x/lib/test_movieplugins.py
===================================================================
--- branches/0.9.x/lib/test_movieplugins.py	2009-04-16 20:23:17 UTC (rev 1188)
+++ branches/0.9.x/lib/test_movieplugins.py	2009-04-17 20:27:26 UTC (rev 1189)
@@ -70,8 +70,10 @@
 		'PluginMovieCulturalia',
 		'PluginMovieDVDEmpire',
 		'PluginMovieE-Pipoca',
+		'PluginMovieFilmAffinity',
 		'PluginMovieFilmDb',
 		'PluginMovieFilmeVonAZ',
+		'PluginMovieFilmtipset',
 		'PluginMovieIMDB',
 		'PluginMovieIMDB-de',
 		'PluginMovieKinoDe',

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2009-04-16 20:23:17 UTC (rev 1188)
+++ trunk/ChangeLog	2009-04-17 20:27:26 UTC (rev 1189)
@@ -5,6 +5,10 @@
 (c) 2005-2009  Vasco Nunes, Piotr O&#197;&#188;arowski
 
 
+2009-04-17  Michael Jahn
+	* updated FilmAffinity plugin
+	* updated Filmtipset plugin
+
 2009-04-16  Michael Jahn
 	* updated Culturalia plugin
 	* updated E-Pipoca plugin

Modified: trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2009-04-16 20:23:17 UTC (rev 1188)
+++ trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2009-04-17 20:27:26 UTC (rev 1189)
@@ -2,7 +2,7 @@
 
 __revision__ = '$Id: PluginMovieFilmAffinity.py 389 2006-07-29 18:43:35Z piotrek $'
 
-# Copyright (c) 2006 Pedro D. S&#225;nchez
+# Copyright (c) 2006-2009 Pedro D. S&#225;nchez
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -35,7 +35,7 @@
 
 class Plugin(movie.Movie):
     def __init__(self, id):
-        self.encode   = 'iso-8859-15'
+        self.encode   = 'iso-8859-1'
         self.movie_id = id
         self.url      = &quot;<A HREF="http://www.filmaffinity.com/es/film%s.html">http://www.filmaffinity.com/es/film%s.html</A>&quot; % str(self.movie_id)
 
@@ -94,6 +94,7 @@
         self.cast = re.sub('&lt;/a&gt;,[ ]*', '\n', self.cast)
         self.cast = string.strip(gutils.strip_tags(self.cast))
         self.cast = re.sub('[ ]+', ' ', self.cast)
+        self.cast = re.sub('\n[ ]+', '\n', self.cast)
 
     def get_classification(self):
         self.classification = ''
@@ -126,16 +127,21 @@
             self.rating = str(round(float(gutils.clean(string.replace(self.rating, ',', '.')))))
 
     def get_cameraman(self):
-        self.cameraman = gutils.trim(self.page, u'&lt;b&gt;FOTOGRAF&#205;A&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
+        self.cameraman = gutils.trim(self.page, u'&lt;b&gt;FOTOGRAF&#205;A&lt;/b&gt;&lt;/td&gt;', u'&lt;/td&gt;')
         if self.cameraman == '':
-            self.cameraman = gutils.trim(self.page, '&lt;b&gt;FOTOGRAF&Iacute;A&lt;/b&gt;&lt;/td&gt;', '&lt;/td&gt;')
+            self.cameraman = gutils.trim(self.page, u'&lt;b&gt;FOTOGRAF&Iacute;A&lt;/b&gt;&lt;/td&gt;', u'&lt;/td&gt;')
 
+    def get_screenplay(self):
+        self.screenplay = gutils.trim(self.page, u'&lt;b&gt;GUI&#211;N&lt;/b&gt;&lt;/td&gt;', u'&lt;/td&gt;')
+        if self.screenplay == '':
+            self.screenplay = gutils.trim(self.page, u'&lt;b&gt;GUI&Oacute;N&lt;/b&gt;&lt;/td&gt;', u'&lt;/td&gt;')
+
 class SearchPlugin(movie.SearchMovie):
 
     def __init__(self):
         self.original_url_search   = '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
         self.translated_url_search = '<A HREF="http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=">http://www.filmaffinity.com/es/search.php?stype=title&amp;stext=</A>'
-        self.encode                = 'iso-8859-15'
+        self.encode                = 'iso-8859-1'
 
     def search(self,parent_window):
         if not self.open_search(parent_window):
@@ -166,3 +172,57 @@
                     self.ids.append(gutils.trim(element, '&lt;b&gt;&lt;a href=&quot;/es/film', '.html'))
                     title = gutils.after(element, '&lt;b&gt;&lt;a href=&quot;/es/film')
                     self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.after(title, '&gt;'))))
+
+#
+# Plugin Test
+#
+class SearchPluginTest(SearchPlugin):
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
+    #
+    test_configuration = {
+        'Rocky' : [ 9, 9 ],
+    }
+
+class PluginTest:
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute only should be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        '706925' : { 
+            'title'               : 'Rocky Balboa (Rocky VI)',
+            'o_title'             : 'Rocky Balboa (Rocky VI)',
+            'director'            : 'Sylvester Stallone',
+            'plot'                : True,
+            'cast'                : 'Sylvester Stallone\n\
+Burt Young\n\
+Tony Burton\n\
+Milo Ventimiglia\n\
+James Francis Kelly III\n\
+Talia Shire\n\
+Angela Boyd\n\
+Antonio Tarver\n\
+Geraldine Hughes\n\
+Mike Tyson',
+            'country'             : 'Estados Unidos',
+            'genre'               : u'Acci&#243;n / Drama / Deporte (Boxeo)',
+            'classification'      : False,
+            'studio'              : 'MGM / UA / Columbia Pictures / Revolution Studios',
+            'o_site'              : '<A HREF="http://www.rockythemovie.com">http://www.rockythemovie.com</A>',
+            'site'                : '<A HREF="http://www.filmaffinity.com/es/film706925.html">http://www.filmaffinity.com/es/film706925.html</A>',
+            'trailer'             : False,
+            'year'                : 2006,
+            'notes'               : False,
+            'runtime'             : 102,
+            'image'               : True,
+            'rating'              : 6,
+            'cameraman'           : 'J. Clark Mathis',
+            'screenplay'          : 'Sylvester Stallone (Personajes: Sylvester Stallone)',
+            'barcode'             : False
+        },
+    }

Modified: trunk/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2009-04-16 20:23:17 UTC (rev 1188)
+++ trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2009-04-17 20:27:26 UTC (rev 1189)
@@ -2,7 +2,7 @@
 
 __revision__ = '$Id$'
 
-# Copyright (c) 2007
+# Copyright (c) 2007-2009
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -26,20 +26,20 @@
 import string
 import re
 
-plugin_name = &quot;Filmtipset.se&quot;
-plugin_description = &quot;Filmtipset.se&quot;
-plugin_url = &quot;www.filmtipset.se&quot;
-plugin_language = _(&quot;Swedish&quot;)
-plugin_author = &quot;Michael Jahn&quot;
+plugin_name        = &quot;Filmtipset.se&quot;
+plugin_description  = &quot;Filmtipset.se&quot;
+plugin_url          = &quot;www.filmtipset.se&quot;
+plugin_language     = _(&quot;Swedish&quot;)
+plugin_author       = &quot;Michael Jahn&quot;
 plugin_author_email = &quot;&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>&gt;&quot;
-plugin_version = &quot;1.1&quot;
+plugin_version      = &quot;1.2&quot;
 
 class Plugin(movie.Movie):
 
     def __init__(self, id):
-        self.encode='iso-8859-1'
+        self.encode   = 'iso-8859-1'
         self.movie_id = id
-        self.url = '<A HREF="http://www.filmtipset.se/film/">http://www.filmtipset.se/film/</A>' + str(self.movie_id)
+        self.url      = '<A HREF="http://www.filmtipset.se/film/">http://www.filmtipset.se/film/</A>' + str(self.movie_id)
 
     def get_image(self):
         self.image_url = ''
@@ -53,7 +53,7 @@
             self.o_title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
 
     def get_title(self):
-        self.title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;/h1&gt;')
+        self.title = gutils.after(gutils.trim(self.page, 'class=&quot;movie_header&quot;', '&lt;td'), '&gt;')
 
     def get_director(self):
         self.director = gutils.trim(self.page, 'Regiss&ouml;r:', '&lt;/tr&gt;')
@@ -73,7 +73,7 @@
             self.genre = string.strip(gutils.trim(self.page, 'Genre:', '&lt;/tr&gt;'))
 
     def get_cast(self):
-        self.cast = gutils.regextrim(self.page, 'Sk&aring;despelare [^:]*[:]', '&lt;/tr&gt;')
+        self.cast = gutils.regextrim(self.page, 'Sk&aring;despelare[^:]*[:]', '&lt;/tr&gt;')
         self.cast = string.replace(self.cast, ', ', '\n')
 
     def get_classification(self):
@@ -99,6 +99,11 @@
 
     def get_rating(self):
         self.rating = &quot;0&quot;
+        tmp = gutils.trim(self.page, 'grade_images/grade1', '_')
+        try:
+            self.rating = str(int(tmp) * 2)
+        except:
+            pass
 
     def get_notes(self):
         self.notes = ''
@@ -106,12 +111,15 @@
         if tmp != '':
             self.notes = self.notes + 'Alt. titel:' + string.strip(gutils.strip_tags(tmp))
 
+    def get_screenplay(self):
+        self.screenplay = gutils.trim(self.page, 'Manus:', '&lt;/tr&gt;')
+
 class SearchPlugin(movie.SearchMovie):
 
     def __init__(self):
         self.original_url_search   = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
         self.translated_url_search = &quot;<A HREF="http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=">http://www.filmtipset.se/search.cgi?field=name&amp;field=orgname&amp;show_graded=1&amp;search_value=</A>&quot;
-        self.encode='iso-8859-1'
+        self.encode                = 'iso-8859-1'
 
     def search(self,parent_window):
         if not self.open_search(parent_window):
@@ -134,5 +142,57 @@
                     self.ids.append(element[:searchResult.end() - 1])
                 self.titles.append(
                     gutils.strip_tags(gutils.trim(element, '&gt;', '&lt;/a&gt;')) + ' / ' +
-                    string.replace(gutils.trim(element, 'title=&quot;', '&quot;'), '&nbsp;', ' ')
+                    gutils.clean(string.replace(gutils.trim(element, 'Originaltitel:', '&lt;/div&gt;'), '&nbsp;', ' '))
                 )
+
+#
+# Plugin Test
+#
+class SearchPluginTest(SearchPlugin):
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
+    #
+    test_configuration = {
+        'Rocky' : [ 16, 16 ],
+    }
+
+class PluginTest:
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute only should be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        'rocky-balboa.html' : { 
+            'title'               : 'Rocky Balboa',
+            'o_title'             : 'Rocky Balboa',
+            'director'            : 'Sylvester Stallone',
+            'plot'                : True,
+            'cast'                : 'Sylvester Stallone\n\
+Burt Young\n\
+Milo Ventimiglia\n\
+Geraldine Hughes\n\
+Antonio Tarver\n\
+James Francis Kelly III\n\
+Tony Burton\n\
+Henry G Sanders',
+            'country'             : 'USA',
+            'genre'               : 'Drama, Action',
+            'classification'      : False,
+            'studio'              : False,
+            'o_site'              : '<A HREF="http://www.imdb.com/title/tt0479143/">http://www.imdb.com/title/tt0479143/</A>',
+            'site'                : '<A HREF="http://www.filmtipset.se/film/rocky-balboa.html">http://www.filmtipset.se/film/rocky-balboa.html</A>',
+            'trailer'             : False,
+            'year'                : 2006,
+            'notes'               : False,
+            'runtime'             : 102,
+            'image'               : True,
+            'rating'              : 6,
+            'cameraman'           : False,
+            'screenplay'          : 'Sylvester Stallone',
+            'barcode'             : False
+        },
+    }

Modified: trunk/lib/test_movieplugins.py
===================================================================
--- trunk/lib/test_movieplugins.py	2009-04-16 20:23:17 UTC (rev 1188)
+++ trunk/lib/test_movieplugins.py	2009-04-17 20:27:26 UTC (rev 1189)
@@ -75,8 +75,10 @@
         'PluginMovieCulturalia',
         'PluginMovieDVDEmpire',
         'PluginMovieE-Pipoca',
+        'PluginMovieFilmAffinity',
         'PluginMovieFilmDb',
         'PluginMovieFilmeVonAZ',
+        'PluginMovieFilmtipset',
         'PluginMovieIMDB',
         'PluginMovieIMDB-de',
         'PluginMovieKinoDe',


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000660.html">[Griffith-svn] r1188 - branches/0.9.x branches/0.9.x/lib	branches/0.9.x/lib/plugins/movie trunk trunk/lib	trunk/lib/plugins/movie
</A></li>
	<LI>Next message: <A HREF="000662.html">[Griffith-svn] r1190 - trunk/lib/plugins/movie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#661">[ date ]</a>
              <a href="thread.html#661">[ thread ]</a>
              <a href="subject.html#661">[ subject ]</a>
              <a href="author.html#661">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/griffith-svn">More information about the Griffith-svn
mailing list</a><br>
</body></html>
