<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Griffith-svn] r1410 - in trunk: . lib lib/plugins/movie
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/griffith-svn/2010-March/index.html" >
   <LINK REL="made" HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1410%20-%20in%20trunk%3A%20.%20lib%20lib/plugins/movie&In-Reply-To=%3C201003272111.o2RLBbDr001561%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000873.html">
   <LINK REL="Next"  HREF="000875.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Griffith-svn] r1410 - in trunk: . lib lib/plugins/movie</H1>
    <B>mikej06 at mail.berlios.de</B> 
    <A HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1410%20-%20in%20trunk%3A%20.%20lib%20lib/plugins/movie&In-Reply-To=%3C201003272111.o2RLBbDr001561%40sheep.berlios.de%3E"
       TITLE="[Griffith-svn] r1410 - in trunk: . lib lib/plugins/movie">mikej06 at mail.berlios.de
       </A><BR>
    <I>Sat Mar 27 22:11:37 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000873.html">[Griffith-svn] r1409 - in trunk: . lib/plugins/movie
</A></li>
        <LI>Next message: <A HREF="000875.html">[Griffith-svn] r1411 - trunk/lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#874">[ date ]</a>
              <a href="thread.html#874">[ thread ]</a>
              <a href="subject.html#874">[ subject ]</a>
              <a href="author.html#874">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: mikej06
Date: 2010-03-27 22:11:21 +0100 (Sat, 27 Mar 2010)
New Revision: 1410

Modified:
   trunk/ChangeLog
   trunk/lib/plugins/movie/PluginMovieAllocine.py
   trunk/lib/plugins/movie/PluginMovieAmazon.py
   trunk/lib/plugins/movie/PluginMovieCinematografo.py
   trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
   trunk/lib/plugins/movie/PluginMovieFilmtipset.py
   trunk/lib/plugins/movie/PluginMovieIMDB-de.py
   trunk/lib/plugins/movie/PluginMovieIMDB-es.py
   trunk/lib/plugins/movie/PluginMovieIMDB.py
   trunk/lib/plugins/movie/PluginMovieKinoDe.py
   trunk/lib/plugins/movie/PluginMovieOFDb.py
   trunk/lib/plugins/movie/PluginMovieZelluloid.py
   trunk/lib/test_movieplugins.py
Log:
updated movie plugin IMDb-de, IMDb-es, Zelluloid
plugin test data updated

Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/ChangeLog	2010-03-27 21:11:21 UTC (rev 1410)
@@ -5,6 +5,9 @@
 (c) 2005-2010  Vasco Nunes, Piotr O&#197;&#188;arowski
 
 
+2010-03-27  Michael Jahn
+	* updated movie plugin IMDb-de, IMDb-es, Zelluloid
+
 2010-03-12  Michael Jahn
 	* updated movie plugin DVDPalace
 

Modified: trunk/lib/plugins/movie/PluginMovieAllocine.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAllocine.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieAllocine.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -210,7 +210,7 @@
     #        * or the expected value
     #
     test_configuration = {
-        '110585' : { 
+        '110585' : {
             'title'               : u'Le Prix &#195;&#160; payer',
             'o_title'             : u'Le Prix &#195;&#160; payer',
             'director'            : u'Alexandra Lecl&#195;&#168;re',
@@ -239,7 +239,7 @@
             'screenplay'          : u'Alexandra Lecl&#195;&#168;re',
             'barcode'             : False
         },
-        '309' : { 
+        '309' : {
             'title'               : u'Terminator',
             'o_title'             : u'Terminator',
             'director'            : u'James Cameron',
@@ -259,7 +259,7 @@
 Marianne Muellerleile' + _(' as ') + 'la \'mauvaise\' Sarah Connor\n\
 Franco Columbu' + _(' as ') + 'le Terminator infiltrant le bunker dans le futur',
             'country'             : u'am&#195;&#169;ricain',
-            'genre'               : u'Science fiction, Thriller',
+            'genre'               : u'Science fiction',
             'classification'      : False,
             'studio'              : False,
             'o_site'              : False,

Modified: trunk/lib/plugins/movie/PluginMovieAmazon.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieAmazon.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieAmazon.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -397,7 +397,7 @@
     # dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
     #
     test_configuration = {
-        'Rocky Balboa'         : [ 17, 17 ],
+        'Rocky Balboa'         : [ 19, 19 ],
         'Arahan'               : [  7,  7 ],
         'Ein gl&#195;&#188;ckliches Jahr' : [  3,  3 ]
     }
@@ -412,7 +412,7 @@
     #        * or the expected value
     #
     test_configuration = {
-        'B000TIQMMI' : { 
+        'B000TIQMMI' : {
             'title'               : 'Rocky Balboa',
             'o_title'             : 'Rocky Balboa',
             'director'            : '',
@@ -434,7 +434,7 @@
             'rating'              : 9,
             'barcode'             : '4045167004504'
         },
-        'B0009NSASM' : { 
+        'B0009NSASM' : {
             'title'               : 'Ein gl&#195;&#188;ckliches Jahr',
             'o_title'             : 'Ein gl&#195;&#188;ckliches Jahr',
             'director'            : 'Claude Lelouch',
@@ -456,7 +456,7 @@
             'rating'              : 10,
             'barcode'             : '7321921998843'
         },
-        'B000BSNOD6' : { 
+        'B000BSNOD6' : {
             'title'               : 'Arahan (Vanilla-DVD)',
             'o_title'             : 'Arahan (Vanilla-DVD)',
             'director'            : 'Ryoo Seung-wan',

Modified: trunk/lib/plugins/movie/PluginMovieCinematografo.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieCinematografo.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieCinematografo.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -234,7 +234,7 @@
     test_configuration = {
         'Rocky'      : [12, 12],
         'per&#195;&#178;'       : [6, 6],
-        'il ritorno' : [97, 97]}
+        'il ritorno' : [98, 98]}
 
 
 class PluginTest:
@@ -251,7 +251,7 @@
             'o_title'           : 'Amor non ho, per&#195;&#178;... per&#195;&#178;...',
             'director'          : 'Giorgio Bianchi',
             'plot'              : True,
-            'cast'              : 'Renato Rascel' + _(' as ') + 'Teodoro\n\
+            'cast'              : u'Renato Rascel' + _(' as ') + 'Teodoro\n\
 Gina Lollobrigida' + _(' as ') + 'Gina\n\
 Luigi Pavese' + _(' as ') + 'Antonio Scutipizzo\n\
 Aroldo Tieri' + _(' as ') + 'Giuliano\n\
@@ -261,18 +261,18 @@
 Strelsa Brown' + _(' as ') + 'Mabel\n\
 Virgilio Riento' + _(' as ') + 'Il contadino\n\
 Gabriele Tinti' + _(' as ') + '(Gastone Tinti) Un componente dell\'orchestra\n\
-Guglielmo Barnab&#195;&#178;' + _(' as ') + '\n\
+Guido Barbarisi' + _(' as ') + '\n\
 Giuseppe De Martino' + _(' as ') + '\n\
+Maria Carla Vittone' + _(' as ') + '\n\
 Raimondo Vianello' + _(' as ') + '(Riccardo Vianello) \n\
-Maria Carla Vittone' + _(' as ') + '\n\
 Marco Tulli' + _(' as ') + '\n\
 Giuseppe Ricagno' + _(' as ') + '\n\
 Luciano Rebeggiani' + _(' as ') + '\n\
+Giovanni Lesa' + _(' as ') + '\n\
 Kurt Lary' + _(' as ') + '\n\
-Giovanni Lesa' + _(' as ') + '\n\
 Riccardo Ferri' + _(' as ') + '\n\
 Pia De Doses' + _(' as ') + '\n\
-Guido Barbarisi' + _(' as ') + '\n\
+Guglielmo Barnab&#195;&#178;' + _(' as ') + '\n\
 Galeazzo Benti as',
             'country'           : 'Italia',
             'genre'             : 'Commedia',

Modified: trunk/lib/plugins/movie/PluginMovieFilmAffinity.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieFilmAffinity.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -209,7 +209,7 @@
 Geraldine Hughes\n\
 Mike Tyson',
             'country'             : 'Estados Unidos',
-            'genre'               : u'Acci&#243;n. Drama. Deporte. Boxeo',
+            'genre'               : u'Acci&#243;n. Drama. Deporte. Boxeo. Secuela',
             'classification'      : False,
             'studio'              : 'MGM / UA / Columbia Pictures / Revolution Studios',
             'o_site'              : '<A HREF="http://www.rockythemovie.com">http://www.rockythemovie.com</A>',

Modified: trunk/lib/plugins/movie/PluginMovieFilmtipset.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieFilmtipset.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -154,7 +154,7 @@
     # dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
     #
     test_configuration = {
-        'Rocky' : [ 15, 15 ],
+        'Rocky' : [ 16, 16 ],
     }
 
 class PluginTest:
@@ -166,7 +166,7 @@
     #        * or the expected value
     #
     test_configuration = {
-        'rocky-balboa.html' : { 
+        'rocky-balboa.html' : {
             'title'               : 'Rocky Balboa',
             'o_title'             : 'Rocky Balboa',
             'director'            : 'Sylvester Stallone',

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-de.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-de.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -26,21 +26,22 @@
 
 plugin_name         = 'IMDb-de'
 plugin_description  = 'Internet Movie Database German'
-plugin_url          = 'german.imdb.com'
+plugin_url          = 'www.imdb.de'
 plugin_language     = _('German')
 plugin_author       = 'Michael Jahn'
 plugin_author_email = '<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">mikej06 at hotmail.com</A>'
-plugin_version      = '1.6'
+plugin_version      = '1.7'
 
 class Plugin(movie.Movie):
     def __init__(self, id):
         self.encode   = 'iso8859-1'
         self.movie_id = id
-        self.url      = &quot;<A HREF="http://german.imdb.com/title/tt%s">http://german.imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
+        self.url      = &quot;<A HREF="http://www.imdb.de/title/tt%s">http://www.imdb.de/title/tt%s</A>&quot; % str(self.movie_id)
 
     def initialize(self):
         self.cast_page = self.open_page(url=self.url + '/fullcredits')
         self.plot_page = self.open_page(url=self.url + '/plotsummary')
+        self.comp_page = self.open_page(url=self.url + '/companycredits')
         # looking for the original imdb page
         self.imdb_page = self.open_page(url=&quot;<A HREF="http://www.imdb.com/title/tt%s">http://www.imdb.com/title/tt%s</A>&quot; % str(self.movie_id))
         self.imdb_plot_page = self.open_page(url=&quot;<A HREF="http://www.imdb.com/title/tt%s/plotsummary">http://www.imdb.com/title/tt%s/plotsummary</A>&quot; % str(self.movie_id))
@@ -48,6 +49,7 @@
         self.page = gutils.convert_entities(self.page)
         self.cast_page = gutils.convert_entities(self.cast_page)
         self.plot_page = gutils.convert_entities(self.plot_page)
+        self.comp_page = gutils.convert_entities(self.comp_page)
         self.imdb_page = gutils.convert_entities(self.imdb_page)
         self.imdb_plot_page = gutils.convert_entities(self.imdb_plot_page)
 
@@ -142,17 +144,20 @@
         self.classification = gutils.trim(gutils.trim(self.page, 'Altersfreigabe:', '&lt;/div&gt;'), 'Deutschland:', '|')
 
     def get_studio(self):
-        self.studio = gutils.trim(self.page, '&lt;h5&gt;Firma:&lt;/h5&gt;', '&lt;/div&gt;')
-        self.studio = self.__before_more(self.studio)
+        self.studio = gutils.trim(self.comp_page, '&lt;h2&gt;Produktionsfirmen&lt;/h2&gt;', '&lt;/ul&gt;')
+        self.studio = string.replace(self.studio, '&lt;/li&gt;&lt;li&gt;', ', ')
+        if not self.studio:
+            self.studio = gutils.trim(self.page, '&lt;h5&gt;Firma:&lt;/h5&gt;', '&lt;/div&gt;')
+            self.studio = self.__before_more(self.studio)
 
     def get_o_site(self):
         self.o_site = ''
 
     def get_site(self):
-        self.site = &quot;<A HREF="http://german.imdb.com/title/tt%s">http://german.imdb.com/title/tt%s</A>&quot; % self.movie_id
+        self.site = &quot;<A HREF="http://www.imdb.de/title/tt%s">http://www.imdb.de/title/tt%s</A>&quot; % self.movie_id
 
     def get_trailer(self):
-        self.trailer = &quot;<A HREF="http://german.imdb.com/title/tt%s/trailers">http://german.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
+        self.trailer = &quot;<A HREF="http://www.imdb.de/title/tt%s/trailers">http://www.imdb.de/title/tt%s/trailers</A>&quot; % self.movie_id
 
     def get_country(self):
         self.country = gutils.trim(self.page, '&lt;h5&gt;Land:&lt;/h5&gt;', '&lt;/div&gt;')
@@ -211,11 +216,32 @@
             self.notes += &quot;%s: %s\n&quot; %(_('Color').encode('utf8'), color)
         if len(tagline)&gt;0:
             self.notes += &quot;%s: %s\n&quot; %('Tagline', tagline)
-    
+
+    def get_screenplay(self):
+        self.screenplay = ''
+        parts = re.split('&lt;a href=', gutils.trim(self.cast_page, '&gt;Buch&lt;', '&lt;/table&gt;'))
+        if len(parts) &gt; 1:
+            for part in parts[1:]:
+                screenplay = gutils.trim(part, '&gt;', '&lt;')
+                if screenplay == 'WGA':
+                    continue
+                screenplay = screenplay.replace(' (geschrieben von)', '')
+                screenplay = screenplay.replace(' (original scenario)', '')
+                screenplay = screenplay.replace(' und&lt;', '&lt;')
+                self.screenplay = self.screenplay + screenplay + ', '
+            if len(self.screenplay) &gt; 2:
+                self.screenplay = self.screenplay[0:len(self.screenplay) - 2]
+
+    def get_cameraman(self):
+        self.cameraman = '&lt;' + gutils.trim(self.cast_page, '&gt;Kamera&lt;', '&lt;/table&gt;')
+        self.cameraman = string.replace(self.cameraman, '(Kamera)', '')
+        self.cameraman = string.replace(self.cameraman, '(nicht im Abspann)', '')
+
     def __before_more(self, data):
-        tmp = string.find(data, '&gt;mehr&lt;')
-        if tmp&gt;0:
-            data = data[:tmp] + '&gt;'
+        for element in ['&gt;Mehr ansehen&lt;', '&gt;mehr&lt;', '&gt;Full summary&lt;', '&gt;Full synopsis&lt;']:
+            tmp = string.find(data, element)
+            if tmp&gt;0:
+                data = data[:tmp] + '&gt;'
         return data
 
 class SearchPlugin(movie.SearchMovie):
@@ -223,8 +249,8 @@
     PATTERN_POWERSEARCH = re.compile(r&quot;&quot;&quot;Here are the [0-9]+ matching titles&quot;&quot;&quot;)
 
     def __init__(self):
-        self.original_url_search   = '<A HREF="http://german.imdb.com/find?more=tt&amp;q=">http://german.imdb.com/find?more=tt&amp;q=</A>'
-        self.translated_url_search = '<A HREF="http://german.imdb.com/find?more=tt&amp;q=">http://german.imdb.com/find?more=tt&amp;q=</A>'
+        self.original_url_search   = '<A HREF="http://www.imdb.de/find?more=tt&amp;q=">http://www.imdb.de/find?more=tt&amp;q=</A>'
+        self.translated_url_search = '<A HREF="http://www.imdb.de/find?more=tt&amp;q=">http://www.imdb.de/find?more=tt&amp;q=</A>'
         self.encode                = 'utf8'
         self.remove_accents        = False
 
@@ -236,7 +262,7 @@
             if self.PATTERN_POWERSEARCH.search(self.page) is None:
                 self.page = ''
         else:
-            self.page = tmp 
+            self.page = tmp
         # correction of all &amp;#xxx entities
         self.page = self.page.decode('iso8859-1')
         self.page = gutils.convert_entities(self.page)
@@ -265,7 +291,7 @@
     # dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
     #
     test_configuration = {
-        'Rocky Balboa'         : [ 18, 18 ],
+        'Rocky Balboa'         : [ 20, 20 ],
         'Ein gl&#195;&#188;ckliches Jahr' : [  6,  6 ]
     }
 
@@ -278,7 +304,7 @@
     #        * or the expected value
     #
     test_configuration = {
-        '0479143' : { 
+        '0479143' : {
             'title'             : 'Rocky Balboa',
             'o_title'           : 'Rocky Balboa',
             'director'          : 'Sylvester Stallone',
@@ -339,15 +365,20 @@
 Don Sherman' + _(' as ') + 'Andy\n\
 Stu Nahan' + _(' as ') + 'Computer Fight Commentator (Sprechrolle)\n\
 Gary Compton' + _(' as ') + 'Sicherheitsbediensteter &#195;&#188;brige Besetzung in alphabetischer Reihenfolge:\n\
-Michael Ahl' + _(' as ') + 'Restaurant patron (nicht im Abspann)\n\
+Vale Anoai' + _(' as ') + 'Shopper in Italian Market\n\
+Michael Ahl' + _(' as ') + 'Restaurant Patron (nicht im Abspann)\n\
 Andrew Aninsman' + _(' as ') + 'Promoter (nicht im Abspann)\n\
 Lacy Bevis' + _(' as ') + 'Boxing Spectator (nicht im Abspann)\n\
 Tim Brooks' + _(' as ') + 'Boxing Spectator (nicht im Abspann)\n\
+D.T. Carney' + _(' as ') + 'High Roller (nicht im Abspann)\n\
 Ricky Cavazos' + _(' as ') + 'Boxing Spectator (nicht im Abspann)\n\
-Rennie Cowan' + _(' as ') + 'Boxing spectator (nicht im Abspann)\n\
-Deon Derrico' + _(' as ') + 'High roller at limo (nicht im Abspann)\n\
+Rennie Cowan' + _(' as ') + 'Boxing Spectator (nicht im Abspann)\n\
+Peter Defeo' + _(' as ') + 'Vendor (nicht im Abspann)\n\
+Deon Derrico' + _(' as ') + 'High Roller at Limo (nicht im Abspann)\n\
+Jacob \'Stitch\' Duran' + _(' as ') + 'Dixon\'s Trainer (nicht im Abspann)\n\
 Ruben Fischman' + _(' as ') + 'High-Roller in Las Vegas (nicht im Abspann)\n\
 David Gere' + _(' as ') + 'Patron at Adrian\'s (nicht im Abspann)\n\
+Noah Jacobs' + _(' as ') + 'Boxing Fan (nicht im Abspann)\n\
 Mark J. Kilbane' + _(' as ') + 'Businessman (nicht im Abspann)\n\
 Zach Klinefelter' + _(' as ') + 'Boxing Spectator (nicht im Abspann)\n\
 David Kneeream' + _(' as ') + 'Adrian\'s Patron (nicht im Abspann)\n\
@@ -362,23 +393,25 @@
 Jackie Sereni' + _(' as ') + 'Girl on Steps (nicht im Abspann)\n\
 Keyon Smith' + _(' as ') + 'Boxing Spectator (nicht im Abspann)\n\
 Frank Traynor' + _(' as ') + 'Rechtsanwalt (nicht im Abspann)\n\
-Kimberly Villanova' + _(' as ') + 'Business woman (nicht im Abspann)',
+Kimberly Villanova' + _(' as ') + 'Businesswoman (nicht im Abspann)',
             'country'           : 'USA',
             'genre'             : 'Drama | Sport',
             'classification'    : False,
-            'studio'            : 'Metro-Goldwyn-Mayer (MGM)',
+            'studio'            : 'Metro-Goldwyn-Mayer (MGM) (presents) (copyright owner), Columbia Pictures (presents) (copyright owner), Revolution Studios (presents) (copyright owner), Chartoff-Winkler Productions, Rogue Marble',
             'o_site'            : False,
-            'site'              : '<A HREF="http://german.imdb.com/title/tt0479143">http://german.imdb.com/title/tt0479143</A>',
-            'trailer'           : '<A HREF="http://german.imdb.com/title/tt0479143/trailers">http://german.imdb.com/title/tt0479143/trailers</A>',
+            'site'              : '<A HREF="http://www.imdb.de/title/tt0479143">http://www.imdb.de/title/tt0479143</A>',
+            'trailer'           : '<A HREF="http://www.imdb.de/title/tt0479143/trailers">http://www.imdb.de/title/tt0479143/trailers</A>',
             'year'              : 2006,
             'notes'             : _('Language') + ': Englisch | Spanisch\n'\
 + _('Audio') + ': DTS | Dolby Digital | SDDS\n'\
 + _('Color') + ': Farbe',
             'runtime'           : 102,
             'image'             : True,
-            'rating'            : 7
+            'rating'            : 7,
+            'screenplay'        : 'Sylvester Stallone, Sylvester Stallone',
+            'cameraman'         : 'Clark Mathis'
         },
-        '0069815' : { 
+        '0069815' : {
             'title'             : 'Ein gl&#195;&#188;ckliches Jahr',
             'o_title'           : 'La bonne ann&#195;&#169;e',
             'director'          : 'Claude Lelouch',
@@ -410,17 +443,19 @@
 Jean-Louis Trintignant' + _(' as ') + 'Un homme (Archivmaterial) (nicht im Abspann)',
             'country'            : 'Frankreich | Italien',
             'genre'              : 'Kom&#195;&#182;die',
-            'classification'     : False,
-            'studio'             : 'Les Films 13',
+            'classification'     : '12 (f)',
+            'studio'             : 'Les Films 13, Rizzoli Film',
             'o_site'             : False,
-            'site'               : '<A HREF="http://german.imdb.com/title/tt0069815">http://german.imdb.com/title/tt0069815</A>',
-            'trailer'            : '<A HREF="http://german.imdb.com/title/tt0069815/trailers">http://german.imdb.com/title/tt0069815/trailers</A>',
+            'site'               : '<A HREF="http://www.imdb.de/title/tt0069815">http://www.imdb.de/title/tt0069815</A>',
+            'trailer'            : '<A HREF="http://www.imdb.de/title/tt0069815/trailers">http://www.imdb.de/title/tt0069815/trailers</A>',
             'year'               : 1973,
             'notes'              : _('Language') + ': Franz&#195;&#182;sisch\n'\
 + _('Audio') + ': Mono\n'\
 + _('Color') + ': Farbe (Eastmancolor)',
             'runtime'            : 90,
             'image'              : True,
-            'rating'             : 7
+            'rating'             : 7,
+            'screenplay'         : 'Claude Lelouch, Pierre Uytterhoeven, Claude Lelouch',
+            'cameraman'          : 'Claude Lelouch'
         },
     }

Modified: trunk/lib/plugins/movie/PluginMovieIMDB-es.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB-es.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieIMDB-es.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -24,21 +24,37 @@
 import gutils
 import movie
 import string
+import re
 
-plugin_name        = 'IMDb-es'
-plugin_description    = 'Internet Movie Database Spanish'
-plugin_url        = 'spanish.imdb.com'
-plugin_language        = _('Spanish')
-plugin_author        = 'Pedro D. S&#225;nchez'
-plugin_author_email    = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
-plugin_version        = '0.2'
+plugin_name         = 'IMDb-es'
+plugin_description  = 'Internet Movie Database Spanish'
+plugin_url          = 'www.imdb.es'
+plugin_language     = _('Spanish')
+plugin_author       = 'Pedro D. S&#225;nchez'
+plugin_author_email = '&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/griffith-svn">pedrodav at gmail.com</A>&gt;'
+plugin_version      = '0.3'
 
 class Plugin(movie.Movie):
     def __init__(self, id):
         self.encode='iso-8859-15'
         self.movie_id = id
-        self.url = &quot;<A HREF="http://spanish.imdb.com/title/tt%s">http://spanish.imdb.com/title/tt%s</A>&quot; % str(self.movie_id)
+        self.url = &quot;<A HREF="http://www.imdb.es/title/tt%s">http://www.imdb.es/title/tt%s</A>&quot; % str(self.movie_id)
 
+    def initialize(self):
+        self.cast_page = self.open_page(url=self.url + '/fullcredits')
+        self.plot_page = self.open_page(url=self.url + '/plotsummary')
+        self.comp_page = self.open_page(url=self.url + '/companycredits')
+        # looking for the original imdb page
+        self.imdb_page = self.open_page(url=&quot;<A HREF="http://www.imdb.com/title/tt%s">http://www.imdb.com/title/tt%s</A>&quot; % str(self.movie_id))
+        self.imdb_plot_page = self.open_page(url=&quot;<A HREF="http://www.imdb.com/title/tt%s/plotsummary">http://www.imdb.com/title/tt%s/plotsummary</A>&quot; % str(self.movie_id))
+        # correction of all &amp;#xxx entities
+        self.page = gutils.convert_entities(self.page)
+        self.cast_page = gutils.convert_entities(self.cast_page)
+        self.plot_page = gutils.convert_entities(self.plot_page)
+        self.comp_page = gutils.convert_entities(self.comp_page)
+        self.imdb_page = gutils.convert_entities(self.imdb_page)
+        self.imdb_plot_page = gutils.convert_entities(self.imdb_plot_page)
+
     def get_image(self):
         tmp = string.find(self.page, 'a name=&quot;poster&quot;')
         if tmp == -1:        # poster not available
@@ -47,7 +63,7 @@
             self.image_url = gutils.trim(self.page[tmp:], 'src=&quot;', '&quot;')
 
     def get_o_title(self):
-        self.o_title = gutils.trim(self.page, '&lt;strong class=&quot;title&quot;&gt;', ' &lt;small&gt;')
+        self.o_title = gutils.trim(self.page, '&lt;h1&gt;', '&lt;')
 
     def get_title(self):
         tmp = 0
@@ -71,74 +87,131 @@
             self.title = self.o_title
 
     def get_director(self):
-        self.director = gutils.trim(self.page,'Dirigida por&lt;/b&gt;&lt;br&gt;', '&lt;br&gt;')
+        self.director = '&lt;' + gutils.trim(self.cast_page,'&gt;Dirigida por&lt;', '&lt;/table&gt;')
 
     def get_plot(self):
         self.plot = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Resumen', '&lt;a href=&quot;/rg/title-tease/plot')
         self.plot = gutils.after(self.plot, ':&lt;/b&gt; ')
 
+        self.plot = gutils.trim(self.page, '&lt;h5&gt;Trama:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.plot = self.__before_more(self.plot)
+        tmp = gutils.trim(self.plot_page, '&lt;div id=&quot;swiki.2.1&quot;&gt;', '&lt;/div&gt;')
+        if tmp:
+            self.plot = tmp
+        elements = string.split(self.plot_page, '&lt;p class=&quot;plotpar&quot;&gt;')
+        if len(elements) &gt; 1:
+            self.plot = self.plot + '\n\n'
+            elements[0] = ''
+            for element in elements:
+                if element != '':
+                    self.plot = self.plot + gutils.strip_tags(gutils.before(element, '&lt;/a&gt;')) + '\n'
+        if not self.plot:
+            # nothing in spanish found, try original
+            self.plot = gutils.regextrim(self.imdb_page, '&lt;h5&gt;Plot:&lt;/h5&gt;', '(&lt;/div&gt;|&lt;a href.*)')
+            self.plot = self.__before_more(self.plot)
+            elements = string.split(self.imdb_plot_page, '&lt;p class=&quot;plotpar&quot;&gt;')
+            if len(elements) &gt; 1:
+                self.plot = self.plot + '\n\n'
+                elements[0] = ''
+                for element in elements:
+                    if element &lt;&gt; '':
+                        self.plot = self.plot + gutils.strip_tags(gutils.before(element, '&lt;/a&gt;')) + '\n\n'
+
     def get_year(self):
-        self.year = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Years/', '&lt;/a&gt;)&lt;/small&gt;')
-        self.year = gutils.after(self.year, '&quot;&gt;')
+        self.year = gutils.trim(self.page, '&lt;h1&gt;', ' &lt;span class')
+        self.year = gutils.trim(self.year, '(', ')')
 
     def get_runtime(self):
-        self.runtime = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Duraci&#243;n:&lt;/b&gt;', ' min')
+        self.runtime = gutils.trim(self.page, u'&lt;h5&gt;Duraci&#243;n:&lt;/h5&gt;', ' min')
         if self.runtime == '':
-            self.runtime = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Duraci&oacute;n:&lt;/b&gt;', ' min')
+            self.runtime = gutils.trim(self.page, '&lt;h5&gt;Duraci&oacute;n:&lt;/h5&gt;', ' min')
 
     def get_genre(self):
-        self.genre = gutils.trim(self.page, '&lt;a href=&quot;/Sections/Genres/', '&lt;br&gt;')
-        self.genre = gutils.after(self.genre, '/&quot;&gt;')
-        self.genre = string.replace(self.genre, '(m&#225;s)', '')
+        self.genre = gutils.trim(self.page, u'&lt;h5&gt;G&#233;nero:&lt;/h5&gt;', '&lt;/div&gt;')
+        self.genre = string.replace(self.genre, u'(m&#225;s)', '')
         self.genre = string.replace(self.genre, '(m&aacute;s)', '')
 
     def get_cast(self):
         self.cast = ''
-        self.cast = gutils.trim(self.page, 'Cast overview, first billed only:', '&lt;a href=&quot;fullcredits&quot;&gt;')
-        if (self.cast==''):
-            self.cast = gutils.trim(self.page, 'cast: ','&lt;a href=&quot;fullcredits&quot;&gt;')
-        self.cast = string.replace(self.cast, ' .... ', _(' as '))
+        self.cast = gutils.trim(self.cast_page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
+        if self.cast == '':
+            self.cast = gutils.trim(self.page, '&lt;table class=&quot;cast&quot;&gt;', '&lt;/table&gt;')
+        self.cast = string.replace(self.cast, ' ... ', _(' as ').encode('utf8'))
+        self.cast = string.replace(self.cast, '...', _(' as ').encode('utf8'))
         self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr&gt;', &quot;\n&quot;)
-        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr bgcolor=&quot;#FFFFFF&quot;&gt;', &quot;\n&quot;)
-        self.cast = string.replace(self.cast, '&lt;/tr&gt;&lt;tr bgcolor=&quot;#F0F0F0&quot;&gt;', &quot;\n&quot;)
-        self.cast = string.strip(gutils.strip_tags(self.cast))
+        self.cast = re.sub('&lt;/tr&gt;[ \t]*&lt;tr[ \t]*class=&quot;even&quot;&gt;', &quot;\n&quot;, self.cast)
+        self.cast = re.sub('&lt;/tr&gt;[ \t]*&lt;tr[ \t]*class=&quot;odd&quot;&gt;', &quot;\n&quot;, self.cast)
+        self.cast = self.__before_more(self.cast)
+        self.cast = re.sub('[ ]+', ' ', self.cast)
 
     def get_classification(self):
-        self.classification = gutils.trim(self.page, '&lt;a href=&quot;/List?certificates=Spain:', '&lt;/a&gt;')
-        self.classification = gutils.after(self.classification, '&quot;&gt;Spain:')
-        #self.classification = gutils.trim(self.page, 'MPAA&lt;/a&gt;:&lt;/b&gt; ', '&lt;br&gt;')
-        #self.classification = ''
+        self.classification = gutils.trim(self.page, u'&lt;h5&gt;Clasificaci&#243;n:&lt;/h5&gt;', '&lt;/div&gt;')
 
     def get_studio(self):
-        self.studio = ''
+        self.studio = gutils.trim(self.comp_page, u'&lt;h2&gt;Compa&#241;&#237;as Productores&lt;/h2&gt;', '&lt;/ul&gt;')
+        self.studio = string.replace(self.studio, '&lt;/li&gt;&lt;li&gt;', ', ')
 
     def get_o_site(self):
         self.o_site = ''
 
     def get_site(self):
-        self.site = &quot;<A HREF="http://spanish.imdb.com/title/tt%s">http://spanish.imdb.com/title/tt%s</A>&quot; % self.movie_id
+        self.site = &quot;<A HREF="http://www.imdb.es/title/tt%s">http://www.imdb.es/title/tt%s</A>&quot; % self.movie_id
 
     def get_trailer(self):
-        self.trailer = &quot;<A HREF="http://spanish.imdb.com/title/tt%s/trailers">http://spanish.imdb.com/title/tt%s/trailers</A>&quot; % self.movie_id
+        self.trailer = &quot;<A HREF="http://www.imdb.es/title/tt%s/trailers">http://www.imdb.es/title/tt%s/trailers</A>&quot; % self.movie_id
 
     def get_country(self):
-        self.country = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Pa&#237;s:&lt;/b&gt;', '&lt;/a&gt;')
+        self.country = gutils.trim(self.page, u'&lt;h5&gt;Pa&#237;s:&lt;/h5&gt;', '&lt;/div&gt;')
         if self.country == '':
-            self.country = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Pa&iacute;s:&lt;/b&gt;', '&lt;/a&gt;')
-        self.country = gutils.after(self.country, '/&quot;&gt;')
+            self.country = gutils.trim(self.page, '&lt;h5&gt;Pa&iacute;s:&lt;/h5&gt;', '&lt;/a&gt;')
+        self.country = self.__before_more(self.country)
+        self.country = re.sub('[\n]+', '', self.country)
+        self.country = re.sub('[ ]+', ' ', self.country)
 
     def get_rating(self):
-        self.rating = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Calificaci&#243;n de los usuarios:&lt;/b&gt;', '/10&lt;/b&gt; (')
+        self.rating = gutils.trim(self.page, u'&lt;h5&gt;Calificaci&#243;n:&lt;/h5&gt;', '/10&lt;/b&gt;')
         if self.rating == '':
-            self.rating = gutils.trim(self.page, '&lt;b class=&quot;ch&quot;&gt;Calificaci&oacute;n de los usuarios:&lt;/b&gt;', '/10&lt;/b&gt; (')
+            self.rating = gutils.trim(self.page, '&lt;h5&gt;Calificaci&oacute;n de los usuarios:&lt;/h5&gt;', '/10&lt;/b&gt;')
         if self.rating:
-            self.rating = str(float(gutils.clean(self.rating)))
+            try:
+                tmp = re.findall('[0-9.,]+', gutils.clean(self.rating))
+                if tmp and len(tmp) &gt; 0:
+                    self.rating = round(float(tmp[0].replace(',', '.')))
+            except:
+                self.rating = 0
+        else:
+            self.rating = 0
 
+    def get_screenplay(self):
+        self.screenplay = ''
+        parts = re.split('&lt;a href=', gutils.trim(self.cast_page, u'&gt;Cr&#233;ditos del gui&#243;n&lt;', '&lt;/table&gt;'))
+        if len(parts) &gt; 1:
+            for part in parts[1:]:
+                screenplay = gutils.trim(part, '&gt;', '&lt;')
+                if screenplay == 'WGA':
+                    continue
+                screenplay = screenplay.replace(' (escrito por)', '')
+                screenplay = screenplay.replace(' and&lt;', '&lt;')
+                self.screenplay = self.screenplay + screenplay + ', '
+            if len(self.screenplay) &gt; 2:
+                self.screenplay = self.screenplay[0:len(self.screenplay) - 2]
+
+    def get_cameraman(self):
+        self.cameraman = string.replace('&lt;' + gutils.trim(self.cast_page, u'&gt;Fotograf&#237;a por&lt;', '&lt;/table&gt;'), u'(director de fotograf&#237;a) ', '')
+
+    def __before_more(self, data):
+        for element in [u'&gt;Ver m&#225;s&lt;', '&gt;Full summary&lt;', '&gt;Full synopsis&lt;']:
+            tmp = string.find(data, element)
+            if tmp&gt;0:
+                data = data[:tmp] + '&gt;'
+        return data
+
 class SearchPlugin(movie.SearchMovie):
+    PATTERN = re.compile(r&quot;&quot;&quot;&lt;a href=['&quot;]/title/tt([0-9]+)/[&quot;'](.*?)&lt;/tr&gt;&quot;&quot;&quot;, re.IGNORECASE)
 
     def __init__(self):
-        self.original_url_search    = '<A HREF="http://spanish.imdb.com/find?more=tt;q=">http://spanish.imdb.com/find?more=tt;q=</A>'
-        self.translated_url_search    = '<A HREF="http://spanish.imdb.com/find?more=tt;q=">http://spanish.imdb.com/find?more=tt;q=</A>'
+        self.original_url_search = '<A HREF="http://www.imdb.es/find?more=tt;q=">http://www.imdb.es/find?more=tt;q=</A>'
+        self.translated_url_search = '<A HREF="http://www.imdb.es/find?more=tt;q=">http://www.imdb.es/find?more=tt;q=</A>'
         self.encode = 'iso-8859-15'
 
     def search(self,parent_window):
@@ -148,13 +221,148 @@
         return self.page
 
     def sub_search(self):
-        self.page = gutils.trim(self.page, '&lt;/b&gt; found the following results:', '&lt;b&gt;Suggestions For Improving Your Results&lt;/b&gt;');
+        self.page = gutils.regextrim(self.page, ' resultado[s]*[)]', 'Sugerencias Para Mejorar Sus Resultados');
         self.page = self.page.decode('iso-8859-15')
+        # correction of all &amp;#xxx entities
+        self.page = gutils.convert_entities(self.page)
 
     def get_searches(self):
-        elements = string.split(self.page, '&lt;li&gt;')
+        elements = string.split(self.page, '&lt;tr&gt;')
+        if len(elements) &lt; 2:
+            elements = string.split(self.page, '&lt;TR&gt;')
 
-        if (elements[0]&lt;&gt;''):
-            for element in elements:
-                self.ids.append(gutils.trim(element, '/title/tt','/?fr='))
-                self.titles.append(gutils.strip_tags(gutils.convert_entities(gutils.trim(element, ';fm=1&quot;&gt;', '&lt;/li&gt;'))))
+        if len(elements):
+            for element in elements[1:]:
+                match = self.PATTERN.findall(element)
+                for entry in match:
+                    tmp  = re.sub('^[0-9]+[.]', '', gutils.clean(gutils.after(entry[1], '&gt;')))
+                    self.ids.append(entry[0])
+                    self.titles.append(tmp)
+
+#
+# Plugin Test
+#
+class SearchPluginTest(SearchPlugin):
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
+    #
+    test_configuration = {
+        'Rocky Balboa'         : [ 20, 20 ]
+    }
+
+class PluginTest:
+    #
+    # Configuration for automated tests:
+    # dict { movie_id -&gt; dict { arribute -&gt; value } }
+    #
+    # value: * True/False if attribute only should be tested for any value
+    #        * or the expected value
+    #
+    test_configuration = {
+        '0479143' : {
+            'title'             : 'Rocky Balboa',
+            'o_title'           : 'Rocky Balboa',
+            'director'          : 'Sylvester Stallone',
+            'plot'              : True,
+            'cast'              : 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
+Burt Young' + _(' as ') + 'Paulie\n\
+Antonio Tarver' + _(' as ') + 'Mason \'The Line\' Dixon\n\
+Geraldine Hughes' + _(' as ') + 'Marie\n\
+Milo Ventimiglia' + _(' as ') + 'Robert Balboa Jr.\n\
+Tony Burton' + _(' as ') + 'Duke\n\
+A.J. Benza' + _(' as ') + 'L.C.\n\
+James Francis Kelly III' + _(' as ') + 'Steps\n\
+Talia Shire' + _(' as ') + 'Adrian (tomas de archivo)\n\
+Lou DiBella' + _(' as ') + u'&#201;l Mismo\n\
+Mike Tyson' + _(' as ') + u'&#201;l Mismo\n\
+Henry G. Sanders' + _(' as ') + 'Martin\n\
+Pedro Lovell' + _(' as ') + 'Spider Rico\n\
+Ana Gerena' + _(' as ') + 'Isabel\n\
+Angela Boyd' + _(' as ') + 'Angie\n\
+Louis Giansante' + _(' as ') + 'Bar Thug\n\
+Maureen Schilling' + _(' as ') + 'Lucky\'s Bartender\n\
+Lahmard J. Tate' + _(' as ') + 'X-Cell (como Lahmard Tate)\n\
+Woody Paige' + _(' as ') + 'ESPN Commentator (como Woodrow W. Paige)\n\
+Skip Bayless' + _(' as ') + 'ESPN Commentator\n\
+Jay Crawford' + _(' as ') + 'ESPN Commentator\n\
+Brian Kenny' + _(' as ') + 'ESPN Host\n\
+Dana Jacobson' + _(' as ') + 'ESPN Host\n\
+Charles Johnson' + _(' as ') + 'ESPN Host (como Chuck Johnson)\n\
+James Binns' + _(' as ') + 'Commissioner (como James J. Binns)\n\
+Johnnie Hobbs Jr.' + _(' as ') + 'Commissioner\n\
+Barney Fitzpatrick' + _(' as ') + 'Commissioner\n\
+Jim Lampley' + _(' as ') + 'HBO Commentator\n\
+Larry Merchant' + _(' as ') + 'HBO Commentator\n\
+Max Kellerman' + _(' as ') + 'HBO Commentator\n\
+LeRoy Neiman' + _(' as ') + u'&#201;l Mismo\n\
+Bert Randolph Sugar' + _(' as ') + u'Ring Magazine Reporter\n\
+Bernard Fern&#225;ndez' + _(' as ') + 'Boxing Association of America Writer (como Bernard Fernandez)\n\
+Gunnar Peterson' + _(' as ') + 'Weightlifting Trainer\n\
+Yahya' + _(' as ') + 'Dixon\'s Opponent\n\
+Marc Ratner' + _(' as ') + 'Weigh-In Official\n\
+Anthony Lato Jr.' + _(' as ') + 'Rocky\'s Inspector\n\
+Jack Lazzarado' + _(' as ') + 'Dixon\'s Inspector\n\
+Michael Buffer' + _(' as ') + 'Ring Announcer\n\
+Joe Cortez' + _(' as ') + u'&#193;rbitro\n\
+Carter Mitchell' + _(' as ') + 'Shamrock Foreman\n\
+Vinod Kumar' + _(' as ') + 'Ravi\n\
+Fran Pultro' + _(' as ') + 'Father at Restaurant\n\
+Frank Stallone' + _(' as ') + 'Dinner Patron (como Frank Stallone Jr.)\n\
+Jody Giambelluca' + _(' as ') + 'Dinner Patron\n\
+Tobias Segal' + _(' as ') + 'Robert\'s Friend\n\
+Tim Carr' + _(' as ') + 'Robert\'s Friend\n\
+Matt Frack' + _(' as ') + 'Robert\'s Friend #3\n\
+Paul Dion Monte' + _(' as ') + 'Robert\'s Friend\n\
+Kevin King Templeton' + _(' as ') + 'Robert\'s Friend (como Kevin King-Templeton)\n\
+Robert Michael Kelly' + _(' as ') + 'Mr. Tomilson\n\
+Rick Buchborn' + _(' as ') + 'Rocky Fan\n\
+Nick Baker' + _(' as ') + 'Irish Pub Bartender\n\
+Don Sherman' + _(' as ') + 'Andy\n\
+Stu Nahan' + _(' as ') + 'Computer Fight Commentator (voz)\n\
+Gary Compton' + _(' as ') + u'Oficial de Seguridad listado alfab&#233;tico del resto del reparto:\n\
+Vale Anoai' + _(' as ') + 'Shopper in Italian Market\n\
+Michael Ahl' + _(' as ') + 'Restaurant Patron (sin acreditar)\n\
+Andrew Aninsman' + _(' as ') + 'Promoter (sin acreditar)\n\
+Lacy Bevis' + _(' as ') + 'Boxing Spectator (sin acreditar)\n\
+Tim Brooks' + _(' as ') + 'Boxing Spectator (sin acreditar)\n\
+D.T. Carney' + _(' as ') + 'High Roller (sin acreditar)\n\
+Ricky Cavazos' + _(' as ') + 'Boxing Spectator (sin acreditar)\n\
+Rennie Cowan' + _(' as ') + 'Boxing Spectator (sin acreditar)\n\
+Peter Defeo' + _(' as ') + 'Vendor (sin acreditar)\n\
+Deon Derrico' + _(' as ') + 'High Roller at Limo (sin acreditar)\n\
+Jacob \'Stitch\' Duran' + _(' as ') + 'Dixon\'s Trainer (sin acreditar)\n\
+Ruben Fischman' + _(' as ') + 'High-Roller in Las Vegas (sin acreditar)\n\
+David Gere' + _(' as ') + 'Patron at Adrian\'s (sin acreditar)\n\
+Noah Jacobs' + _(' as ') + 'Boxing Fan (sin acreditar)\n\
+Mark J. Kilbane' + _(' as ') + 'Businessman (sin acreditar)\n\
+Zach Klinefelter' + _(' as ') + 'Boxing Spectator (sin acreditar)\n\
+David Kneeream' + _(' as ') + 'Adrian\'s Patron (sin acreditar)\n\
+Dolph Lundgren' + _(' as ') + 'Captain Ivan Drago (tomas de archivo) (sin acreditar)\n\
+Dean Mauro' + _(' as ') + 'Sports Journalist (sin acreditar) (sin confirmar)\n\
+Burgess Meredith' + _(' as ') + 'Mickey Goldmill (tomas de archivo) (sin acreditar)\n\
+Dan Montero' + _(' as ') + 'Boxing Spectator (sin acreditar)\n\
+Keith Moyer' + _(' as ') + 'Administrador del Bar (sin acreditar)\n\
+Mr. T' + _(' as ') + 'Clubber Lang (tomas de archivo) (sin acreditar)\n\
+Jacqueline Olivia' + _(' as ') + 'Chica (sin acreditar)\n\
+Brian H. Scott' + _(' as ') + 'Ringside Cop #1 (sin acreditar)\n\
+Jackie Sereni' + _(' as ') + 'Girl on Steps (sin acreditar)\n\
+Keyon Smith' + _(' as ') + 'Boxing Spectator (sin acreditar)\n\
+Frank Traynor' + _(' as ') + 'Abogado (sin acreditar)\n\
+Kimberly Villanova' + _(' as ') + 'Businesswoman (sin acreditar)',
+            'country'           : 'Estados Unidos',
+            'genre'             : 'Drama | Deporte',
+            'classification'    : u'Estados Unidos:PG  | Singapur:PG  | Finlandia:K-11  | Reino Unido:12A  | Canad&#225;:G (British Columbia) | Australia:M  | Irlanda:PG  | Hong Kong:IIA  | M&#233;xico:A  | Noruega:11  | Suiza:12 (canton of Geneva) | Suiza:12 (canton of Vaud) | Brasil:12  | Argentina:Atp  | Malasia:U  | Filipinas:PG-13 (MTRCB) | Portugal:M/12  | Corea del Sur:12  | Suecia:11  | Nueva Zelanda:M',
+            'studio'            : 'Metro-Goldwyn-Mayer (MGM) (presents) (copyright owner), Columbia Pictures (presents) (copyright owner), Revolution Studios (presents) (copyright owner), Chartoff-Winkler Productions, Rogue Marble',
+            'o_site'            : False,
+            'site'              : '<A HREF="http://www.imdb.es/title/tt0479143">http://www.imdb.es/title/tt0479143</A>',
+            'trailer'           : '<A HREF="http://www.imdb.es/title/tt0479143/trailers">http://www.imdb.es/title/tt0479143/trailers</A>',
+            'year'              : 2006,
+            'notes'             : False,
+            'runtime'           : 102,
+            'image'             : True,
+            'rating'            : 7,
+            'screenplay'        : 'Sylvester Stallone, Sylvester Stallone',
+            'cameraman'         : 'Clark Mathis',
+        },
+    }

Modified: trunk/lib/plugins/movie/PluginMovieIMDB.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieIMDB.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieIMDB.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -185,9 +185,10 @@
         self.cameraman = ''
 
     def __before_more(self, data):
-        tmp = string.find(data, '&gt;more&lt;')
-        if tmp &gt; 0:
-            data = data[:tmp] + '&gt;'
+        for element in ['&gt;See more&lt;', '&gt;more&lt;', '&gt;Full summary&lt;', '&gt;Full synopsis&lt;']:
+            tmp = string.find(data, element)
+            if tmp&gt;0:
+                data = data[:tmp] + '&gt;'
         return data
 
 class SearchPlugin(movie.SearchMovie):
@@ -254,8 +255,8 @@
     # dict { movie_id -&gt; [ expected result count for original url, expected result count for translated url ] }
     #
     test_configuration = {
-        'Rocky Balboa'         : [ 18, 18 ],
-        'Ein gl&#195;&#188;ckliches Jahr' : [ 25, 25 ]
+        'Rocky Balboa'         : [ 20, 20 ],
+        'Ein gl&#195;&#188;ckliches Jahr' : [ 41, 41 ]
     }
 
 class PluginTest:

Modified: trunk/lib/plugins/movie/PluginMovieKinoDe.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieKinoDe.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieKinoDe.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -364,7 +364,7 @@
     #        * or the expected value
     #
     test_configuration = {
-        'K_rocky-balboa/96132.html' : { 
+        'K_rocky-balboa/96132.html' : {
             'title'               : 'Rocky Balboa',
             'o_title'             : 'Rocky Balboa',
             'director'            : 'Sylvester Stallone',
@@ -392,7 +392,7 @@
             'cameraman'           : 'J. Clark Mathis',
             'screenplay'          : 'Sylvester Stallone'
         },
-        'K_ein-glueckliches-jahr/28675.html' : { 
+        'K_ein-glueckliches-jahr/28675.html' : {
             'title'               : 'Ein gl&#195;&#188;ckliches Jahr',
             'o_title'             : 'La bonne ann&#195;&#169;e',
             'director'            : 'Claude Lelouch',
@@ -416,7 +416,7 @@
             'cameraman'           : 'Jean Collomb',
             'screenplay'          : 'Claude Lelouch'
         },
-        'V_ein-glueckliches-jahr-dvd/85546.html' : { 
+        'V_ein-glueckliches-jahr-dvd/85546.html' : {
             'title'               : 'Ein gl&#195;&#188;ckliches Jahr',
             'o_title'             : 'La bonne ann&#195;&#169;e',
             'director'            : 'Claude Lelouch',
@@ -427,7 +427,7 @@
 Andr&#195;&#169; Falcon',
             'country'             : 'Frankreich/Italien',
             'genre'               : 'Drama',
-            'classification'      : 'ab 12 Jahren',
+            'classification'      : 'ab 12',
             'studio'              : 'Warner Home Video',
             'o_site'              : False,
             'site'                : '<A HREF="http://www.video.de/videofilm/ein-glueckliches-jahr-dvd/85546.html">http://www.video.de/videofilm/ein-glueckliches-jahr-dvd/85546.html</A>',
@@ -447,7 +447,7 @@
             'cameraman'           : 'Jean Collomb',
             'screenplay'          : 'Claude Lelouch'
         },
-        'V_arahan-vanilla-dvd/90405.html' : { 
+        'V_arahan-vanilla-dvd/90405.html' : {
             'title'               : 'Arahan',
             'o_title'             : 'Arahan jangpung dae jakjeon',
             'director'            : 'Ryoo Seung-wan',
@@ -459,7 +459,7 @@
 Yun Ju-sang' + _(' as ') + 'Mu-woon',
             'country'             : 'S&#195;&#188;dkorea',
             'genre'               : 'Action/ Kom&#195;&#182;die',
-            'classification'      : 'ab 16 Jahren',
+            'classification'      : 'ab 16',
             'studio'              : 'WVG Medien',
             'o_site'              : False,
             'site'                : '<A HREF="http://www.video.de/videofilm/arahan-vanilla-dvd/90405.html">http://www.video.de/videofilm/arahan-vanilla-dvd/90405.html</A>',

Modified: trunk/lib/plugins/movie/PluginMovieOFDb.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieOFDb.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieOFDb.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -39,7 +39,7 @@
 
     def get_image(self):
         self.image_url = &quot;<A HREF="http://img.ofdb.de/film/">http://img.ofdb.de/film/</A>&quot; + gutils.trim(self.page, 'img src=&quot;<A HREF="http://img.ofdb.de/film/">http://img.ofdb.de/film/</A>', '&quot;' )
-        
+
     def get_o_title(self):
         self.o_title = gutils.clean(gutils.trim(self.page, 'Originaltitel:', '&lt;/tr&gt;'))
         if self.o_title == '':
@@ -168,11 +168,11 @@
     #        * or the expected value
     #
     test_configuration = {
-        'film/103013,Rocky%20Balboa' : { 
-            'title'             : 'Rocky Balboa',
+        'film/103013,Rocky%20Balboa' : {
+            'title'               : 'Rocky Balboa',
             'o_title'             : 'Rocky Balboa',
             'director'            : 'Sylvester Stallone',
-            'plot'                 : True,
+            'plot'                : True,
             'cast'                : 'Sylvester Stallone' + _(' as ') + 'Rocky Balboa\n\
 Burt Young' + _(' as ') + 'Paulie\n\
 Milo Ventimiglia' + _(' as ') + 'Robert Jr.\n\
@@ -229,24 +229,24 @@
 Lou DiBella\n\
 Joe Cortez\n\
 Ricky Cavazos',
-            'country'            : 'USA',
-            'genre'                : 'Action, Drama, Sportfilm',
-            'classification'    : False,
-            'studio'            : 'Metro-Goldwyn-Mayer (MGM)',
-            'o_site'            : False,
+            'country'             : 'USA',
+            'genre'               : 'Action, Drama, Sportfilm',
+            'classification'      : False,
+            'studio'              : 'Metro-Goldwyn-Mayer (MGM)',
+            'o_site'              : False,
             'site'                : '<A HREF="http://www.ofdb.de/film/103013,Rocky%20Balboa">http://www.ofdb.de/film/103013,Rocky%20Balboa</A>',
-            'trailer'            : False,
+            'trailer'             : False,
             'year'                : 2006,
-            'notes'                : False,
-            'runtime'            : 102,
-            'image'                : True,
-            'rating'            : 8
+            'notes'               : False,
+            'runtime'             : 102,
+            'image'               : True,
+            'rating'              : 8
         },
-        'film/22489,Ein-Gl%C3%BCckliches-Jahr' : { 
-            'title'             : 'Gl&#195;&#188;ckliches Jahr, Ein',
+        'film/22489,Ein-Gl%C3%BCckliches-Jahr' : {
+            'title'               : 'Gl&#195;&#188;ckliches Jahr, Ein',
             'o_title'             : 'Bonne ann&#195;&#169;e, La',
             'director'            : 'Claude Lelouch',
-            'plot'                 : False,
+            'plot'                : False,
             'cast'                : 'Lino Ventura' + _(' as ') + 'Simon \n\
 Fran&#195;&#167;oise Fabian' + _(' as ') + 'Fran&#195;&#167;oise\n\
 Charles G&#195;&#169;rard' + _(' as ') + 'Charlot\n\
@@ -256,7 +256,7 @@
 Claude Mann\n\
 Fr&#195;&#169;d&#195;&#169;ric de Pasquale\n\
 G&#195;&#169;rard Sire\n\
-Silvano Tranquilli\n\
+Silvano Tranquilli' + _(' as ') + 'L\'amant italien \n\
 Andr&#195;&#169; Barello\n\
 Michel Bertay\n\
 Norman de la Chesnaye\n\
@@ -269,20 +269,20 @@
 Jacques Villedieu\n\
 Harry Walter\n\
 Elie Chouraqui',
-            'country'            : 'Frankreich',
-            'genre'                : 'Kom&#195;&#182;die, Krimi',
-            'classification'    : False,
-            'studio'            : 'Les Films 13',
-            'o_site'            : False,
+            'country'             : 'Frankreich',
+            'genre'               : 'Kom&#195;&#182;die, Krimi',
+            'classification'      : '12 (f)',
+            'studio'              : 'Les Films 13',
+            'o_site'              : False,
             'site'                : '<A HREF="http://www.ofdb.de/film/22489,Ein-Gl%C3%BCckliches-Jahr">http://www.ofdb.de/film/22489,Ein-Gl%C3%BCckliches-Jahr</A>',
-            'trailer'            : False,
+            'trailer'             : False,
             'year'                : 1973,
-            'notes'                : False,
-            'runtime'            : 90,
-            'image'                : True,
-            'rating'            : 6
+            'notes'               : False,
+            'runtime'             : 90,
+            'image'               : True,
+            'rating'              : 6
         },
-        'film/54088,Arahan' : { 
+        'film/54088,Arahan' : {
             'title'             : 'Arahan',
             'o_title'             : 'Arahan jangpung daejakjeon',
             'director'            : 'Ryoo Seung-wan',

Modified: trunk/lib/plugins/movie/PluginMovieZelluloid.py
===================================================================
--- trunk/lib/plugins/movie/PluginMovieZelluloid.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/plugins/movie/PluginMovieZelluloid.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -36,7 +36,7 @@
 
 class Plugin(movie.Movie):
     index_url = '<A HREF="http://www.zelluloid.de/filme/index.php3?id=">http://www.zelluloid.de/filme/index.php3?id=</A>'
-    
+
     def __init__(self, id):
         self.encode='iso-8859-1'
         self.movie_id = id
@@ -63,7 +63,9 @@
 
     def get_plot(self):
         self.plot = gutils.trim(self.page, '&lt;DIV CLASS=bigtext&gt;', '&lt;/DIV&gt;')
-        
+        if not self.plot:
+            self.plot = gutils.trim(self.page, '&lt;div class=&quot;bigtext&quot;&gt;', '&lt;/div&gt;')
+
     def get_year(self):
         self.year = ''
         elements = string.split(self.detail_page, '/directory/az.php3?j')
@@ -115,7 +117,7 @@
         self.studio = self.studio.replace('&lt;tr&gt;', ', ')
         self.studio = gutils.strip_tags(self.studio)
         self.studio = re.sub('((^, )|(, $))', '', self.studio)
-        
+
     def get_o_site(self):
         self.o_site = &quot;&quot;
 
@@ -198,7 +200,7 @@
     #        * or the expected value
     #
     test_configuration = {
-        '2835' : { 
+        '2835' : {
             'title'             : 'Rocky Balboa',
             'o_title'           : 'Rocky Balboa',
             'director'          : 'Sylvester Stallone',
@@ -229,7 +231,7 @@
             'rating'            : 8.0,
             'screenplay'        : 'Sylvester Stallone'
         },
-        '6342' : { 
+        '6342' : {
             'title'             : 'Die wilden H&#195;&#188;hner',
             'o_title'           : 'Die wilden H&#195;&#188;hner',
             'director'          : 'Vivian Naefe',

Modified: trunk/lib/test_movieplugins.py
===================================================================
--- trunk/lib/test_movieplugins.py	2010-03-12 21:22:28 UTC (rev 1409)
+++ trunk/lib/test_movieplugins.py	2010-03-27 21:11:21 UTC (rev 1410)
@@ -83,6 +83,7 @@
         'PluginMovieFilmtipset',
         'PluginMovieIMDB',
         'PluginMovieIMDB-de',
+        'PluginMovieIMDB-es',
         'PluginMovieKinoDe',
         'PluginMovieMovieMeter',
         'PluginMovieOFDb',
@@ -138,14 +139,14 @@
     #
     def do_test_searchplugin(self, plugin_name, domsgbox=True):
         result = True
-        
+
         plugin = __import__(plugin_name)
         try:
             pluginTestConfig = plugin.SearchPluginTest()
         except:
             print &quot;Warning: SearchPlugin test could not be executed for %s because of missing configuration class SearchPluginTest.&quot; % plugin_name
             pluginTestConfig = None
-        
+
         if not pluginTestConfig == None:
             logFile = open(plugin_name + '-searchtest.txt', 'w+')
             try:
@@ -156,13 +157,13 @@
                     sleep(1) # needed for amazon
             finally:
                 logFile.close()
-        
+
         if domsgbox:
             if not result:
                 gutils.error('SearchPluginTest %s: Test NOT successful !' % plugin_name)
             else:
                 gutils.info('SearchPluginTest %s: Test successful !' % plugin_name)
-        
+
         return result
 
     #
@@ -183,7 +184,7 @@
                 'resolution', 'barcode']
 
         self.movie.fields_to_fetch = fields_to_fetch
-    
+
         self.movie.get_movie(None)
         self.movie.parse_movie()
 
@@ -215,7 +216,7 @@
         # other fields
         for i in fields_to_fetch:
             results[i] = gutils.convert_entities(self.movie[i])
-            
+
         # check the fields
         for i in results_expected:
             i_val = results_expected[i]
@@ -241,20 +242,20 @@
                         logFile.write(&quot;Test error: %s: Wrong value returned.\nKey: %s\nValue expected: %s\nValue returned: %s\n\n&quot; % (movieplugin.movie_id, i, i_val, results[i]))
                         result = False
         return result
-    
+
     #
     # check every configured movie
     #
     def do_test_plugin(self, plugin_name, domsgbox=True):
         result = True
-        
+
         plugin = __import__(plugin_name)
         try:
             pluginTestConfig = plugin.PluginTest()
         except:
             print &quot;Warning: Plugin test could not be executed for %s because of missing configuration class PluginTest.&quot; % plugin_name
             pluginTestConfig = None
-        
+
         if not pluginTestConfig == None:
             logFile = open(plugin_name + '-loadtest.txt', 'w+')
             try:
@@ -265,13 +266,13 @@
                     sleep(1) # needed for amazon
             finally:
                 logFile.close()
-        
+
         if domsgbox:
             if not result:
                 gutils.error('PluginTest %s: Test NOT successful !' % plugin_name)
             else:
                 gutils.info('PluginTest %s: Test successful !' % plugin_name)
-        
+
         return result
 
     #


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000873.html">[Griffith-svn] r1409 - in trunk: . lib/plugins/movie
</A></li>
	<LI>Next message: <A HREF="000875.html">[Griffith-svn] r1411 - trunk/lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#874">[ date ]</a>
              <a href="thread.html#874">[ thread ]</a>
              <a href="subject.html#874">[ subject ]</a>
              <a href="author.html#874">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/griffith-svn">More information about the Griffith-svn
mailing list</a><br>
</body></html>
