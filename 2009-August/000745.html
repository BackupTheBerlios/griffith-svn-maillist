<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Griffith-svn] r1277 - in trunk: . glade lib lib/plugins/extensions
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/griffith-svn/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1277%20-%20in%20trunk%3A%20.%20glade%20lib%20lib/plugins/extensions&In-Reply-To=%3C200908122156.n7CLumXf027709%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000744.html">
   <LINK REL="Next"  HREF="000746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Griffith-svn] r1277 - in trunk: . glade lib lib/plugins/extensions</H1>
    <B>piotrek at BerliOS</B> 
    <A HREF="mailto:griffith-svn%40lists.berlios.de?Subject=Re%3A%20%5BGriffith-svn%5D%20r1277%20-%20in%20trunk%3A%20.%20glade%20lib%20lib/plugins/extensions&In-Reply-To=%3C200908122156.n7CLumXf027709%40sheep.berlios.de%3E"
       TITLE="[Griffith-svn] r1277 - in trunk: . glade lib lib/plugins/extensions">piotrek at mail.berlios.de
       </A><BR>
    <I>Wed Aug 12 23:56:48 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000744.html">[Griffith-svn] r1276 - trunk/lib/plugins/extensions
</A></li>
        <LI>Next message: <A HREF="000746.html">[Griffith-svn] r1278 - in trunk: . lib lib/plugins/extensions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#745">[ date ]</a>
              <a href="thread.html#745">[ thread ]</a>
              <a href="subject.html#745">[ subject ]</a>
              <a href="author.html#745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: piotrek
Date: 2009-08-12 23:56:47 +0200 (Wed, 12 Aug 2009)
New Revision: 1277

Modified:
   trunk/ChangeLog
   trunk/glade/griffith.glade
   trunk/lib/initialize.py
   trunk/lib/plugins/extensions/__init__.py
   trunk/lib/plugins/extensions/ge_amazon.py
   trunk/lib/preferences.py
   trunk/lib/widgets.py
Log:
* Remove Amazon stuff from preferences window
* Region 2 and 4 names shorten (to fit in preferences window)
* Show tabs on the left side of preferences window
* Show extension settings in preferences


Modified: trunk/ChangeLog
===================================================================
--- trunk/ChangeLog	2009-08-11 22:01:14 UTC (rev 1276)
+++ trunk/ChangeLog	2009-08-12 21:56:47 UTC (rev 1277)
@@ -5,6 +5,12 @@
 (c) 2005-2009  Vasco Nunes, Piotr O&#380;arowski
 
 
+2009-08-12  Piotr O&#380;arowski
+	* Remove Amazon stuff from preferences window
+	* Region 2 and 4 names shorten (to fit in preferences window)
+	* Show tabs on the left side of preferences window
+	* Show extension settings in preferences
+
 2009-08-11  Piotr O&#380;arowski
 	* Add Player extension
 

Modified: trunk/glade/griffith.glade
===================================================================
--- trunk/glade/griffith.glade	2009-08-11 22:01:14 UTC (rev 1276)
+++ trunk/glade/griffith.glade	2009-08-12 21:56:47 UTC (rev 1277)
@@ -2577,6 +2577,7 @@
             &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
             &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
             &lt;property name=&quot;border_width&quot;&gt;4&lt;/property&gt;
+            &lt;property name=&quot;tab_pos&quot;&gt;left&lt;/property&gt;
             &lt;child&gt;
               &lt;widget class=&quot;GtkVBox&quot; id=&quot;vbox58&quot;&gt;
                 &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
@@ -5525,63 +5526,6 @@
                         &lt;/child&gt;
                       &lt;/widget&gt;
                     &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkFrame&quot; id=&quot;frame26&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label_xalign&quot;&gt;0&lt;/property&gt;
-                        &lt;child&gt;
-                          &lt;widget class=&quot;GtkAlignment&quot; id=&quot;alignment90&quot;&gt;
-                            &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                            &lt;property name=&quot;left_padding&quot;&gt;12&lt;/property&gt;
-                            &lt;child&gt;
-                              &lt;widget class=&quot;GtkVBox&quot; id=&quot;vbox61&quot;&gt;
-                                &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                                &lt;property name=&quot;border_width&quot;&gt;8&lt;/property&gt;
-                                &lt;property name=&quot;spacing&quot;&gt;4&lt;/property&gt;
-                                &lt;child&gt;
-                                  &lt;widget class=&quot;GtkLabel&quot; id=&quot;label302&quot;&gt;
-                                    &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                                    &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Use locale:&lt;/property&gt;
-                                  &lt;/widget&gt;
-                                  &lt;packing&gt;
-                                    &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-                                  &lt;/packing&gt;
-                                &lt;/child&gt;
-                                &lt;child&gt;
-                                  &lt;widget class=&quot;GtkComboBox&quot; id=&quot;cb_amazon_locale&quot;&gt;
-                                    &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                                    &lt;property name=&quot;items&quot;&gt;US
-UK
-DE
-CA
-FR
-JP&lt;/property&gt;
-                                  &lt;/widget&gt;
-                                  &lt;packing&gt;
-                                    &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-                                    &lt;property name=&quot;position&quot;&gt;1&lt;/property&gt;
-                                  &lt;/packing&gt;
-                                &lt;/child&gt;
-                              &lt;/widget&gt;
-                            &lt;/child&gt;
-                          &lt;/widget&gt;
-                        &lt;/child&gt;
-                        &lt;child&gt;
-                          &lt;widget class=&quot;GtkLabel&quot; id=&quot;label301&quot;&gt;
-                            &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                            &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Fetch from Amazon&lt;/property&gt;
-                            &lt;property name=&quot;use_markup&quot;&gt;True&lt;/property&gt;
-                          &lt;/widget&gt;
-                          &lt;packing&gt;
-                            &lt;property name=&quot;type&quot;&gt;label_item&lt;/property&gt;
-                          &lt;/packing&gt;
-                        &lt;/child&gt;
-                      &lt;/widget&gt;
-                      &lt;packing&gt;
-                        &lt;property name=&quot;expand&quot;&gt;False&lt;/property&gt;
-                        &lt;property name=&quot;position&quot;&gt;1&lt;/property&gt;
-                      &lt;/packing&gt;
-                    &lt;/child&gt;
                   &lt;/widget&gt;
                 &lt;/child&gt;
                 &lt;child&gt;
@@ -5749,6 +5693,63 @@
                 &lt;property name=&quot;tab_fill&quot;&gt;False&lt;/property&gt;
               &lt;/packing&gt;
             &lt;/child&gt;
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkScrolledWindow&quot; id=&quot;scrolledwindow12&quot;&gt;
+	      &lt;property name=&quot;border_width&quot;&gt;4&lt;/property&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;can_focus&quot;&gt;True&lt;/property&gt;
+	      &lt;property name=&quot;hscrollbar_policy&quot;&gt;GTK_POLICY_NEVER&lt;/property&gt;
+	      &lt;property name=&quot;vscrollbar_policy&quot;&gt;GTK_POLICY_AUTOMATIC&lt;/property&gt;
+	      &lt;property name=&quot;shadow_type&quot;&gt;GTK_SHADOW_NONE&lt;/property&gt;
+	      &lt;property name=&quot;window_placement&quot;&gt;GTK_CORNER_TOP_LEFT&lt;/property&gt;
+
+	      &lt;child&gt;
+		&lt;widget class=&quot;GtkViewport&quot; id=&quot;viewport11&quot;&gt;
+		  &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+		  &lt;property name=&quot;shadow_type&quot;&gt;GTK_SHADOW_NONE&lt;/property&gt;
+
+		  &lt;child&gt;
+		    &lt;widget class=&quot;GtkVBox&quot; id=&quot;p_extensions_vbox&quot;&gt;
+		      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+		      &lt;property name=&quot;homogeneous&quot;&gt;False&lt;/property&gt;
+		      &lt;property name=&quot;spacing&quot;&gt;0&lt;/property&gt;
+
+		      &lt;child&gt;
+			&lt;placeholder/&gt;
+		      &lt;/child&gt;
+		    &lt;/widget&gt;
+		  &lt;/child&gt;
+		&lt;/widget&gt;
+	      &lt;/child&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;tab_expand&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;tab_fill&quot;&gt;True&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
+
+	  &lt;child&gt;
+	    &lt;widget class=&quot;GtkLabel&quot; id=&quot;label308&quot;&gt;
+	      &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+          &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Extensions&lt;/property&gt;
+	      &lt;property name=&quot;use_underline&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;use_markup&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;justify&quot;&gt;GTK_JUSTIFY_LEFT&lt;/property&gt;
+	      &lt;property name=&quot;wrap&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;selectable&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;xalign&quot;&gt;0.5&lt;/property&gt;
+	      &lt;property name=&quot;yalign&quot;&gt;0.5&lt;/property&gt;
+	      &lt;property name=&quot;xpad&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;ypad&quot;&gt;0&lt;/property&gt;
+	      &lt;property name=&quot;ellipsize&quot;&gt;PANGO_ELLIPSIZE_NONE&lt;/property&gt;
+	      &lt;property name=&quot;width_chars&quot;&gt;-1&lt;/property&gt;
+	      &lt;property name=&quot;single_line_mode&quot;&gt;False&lt;/property&gt;
+	      &lt;property name=&quot;angle&quot;&gt;0&lt;/property&gt;
+	    &lt;/widget&gt;
+	    &lt;packing&gt;
+	      &lt;property name=&quot;type&quot;&gt;tab&lt;/property&gt;
+	    &lt;/packing&gt;
+	  &lt;/child&gt;
           &lt;/widget&gt;
           &lt;packing&gt;
             &lt;property name=&quot;position&quot;&gt;2&lt;/property&gt;

Modified: trunk/lib/initialize.py
===================================================================
--- trunk/lib/initialize.py	2009-08-11 22:01:14 UTC (rev 1276)
+++ trunk/lib/initialize.py	2009-08-12 21:56:47 UTC (rev 1277)
@@ -478,6 +478,83 @@
     w['box_import_2'].show_all()
     w['box_import_3'].show_all()
 
+def extension(self, module, enabled):
+    if enabled:
+        try:
+            ext = module(self)
+        except (NotImplementedError, DeprecationWarning), e:
+            log.warning('extension skipped: %s', e.message)
+            log.debug('extension skipped: %s', module.__file__)
+            return False
+        if module.toolbar_icon:
+            toolbar = self.widgets['extensions']['toolbar']
+            ext.toolbar_icon_widget = toolbar.insert_stock(module.toolbar_icon, module.description, None, ext._on_toolbar_icon_clicked, None, -1)
+    else:
+        ext = None
+
+    # preferences window
+
+    p_vbox = self.widgets['extensions']['preferences_vbox']
+
+    label = &quot;%s v%s &lt;i&gt;(%s &lt;%s&gt;)&lt;/i&gt;&quot; % (module.name, module.version, module.author, module.email)
+    expander = gtk.Expander(label=label)
+    expander.set_use_markup(True)
+    vbox = gtk.VBox()
+
+    # extension details
+    hbox = gtk.HBox()
+    vbox.pack_start(hbox, expand=False)
+    enabled_cb = gtk.CheckButton(label=_('use this extension'))
+    enabled_cb.set_active(enabled)
+    vbox.pack_start(enabled_cb, expand=False)
+
+    for pref_name in module.preferences:
+        #preferences = {'command': {'name': _('Command'),
+        #                       'hint': _('%s (if given) will be replaced with file path'),
+        #                       'default': 'mplayer %s',
+        #                       'type': unicode}}
+        name = module.preferences[pref_name].get('name', pref_name)
+        hint = module.preferences[pref_name].get('hint')
+        value = module.preferences[pref_name].get('default')
+        #TODO: get value from config
+        type_ = module.preferences[pref_name].get('type', unicode)
+
+        hbox = gtk.HBox()
+        hbox.pack_start(gtk.Label(name), expand=False, padding=4)
+
+        if type_ is unicode:
+            w = gtk.Entry()
+            w.insert_text(value)
+            # TODO: min, max
+        # elif type is int: # TODO
+        elif isinstance(type_, (list, tuple, dict)):
+            model = gtk.TreeStore(str, str)
+            myiter = model.append(None, None)
+            if isinstance(type_, dict):
+                iterable = type_.iteritems()
+            else:
+                iterable = enumerate(type_)
+            for code, value in iterable:
+                model.set_value(myiter, 0, unicode(code))
+                model.set_value(myiter, 1, unicode(value))
+            w = gtk.ComboBox(model=model)
+            # TODO: select default value
+        else:
+            log.error('type not recognized %s', type(type_))
+            continue
+
+        if hint:
+            w.set_tooltip_markup(hint)
+        hbox.pack_start(w)
+
+        vbox.pack_start(hbox, expand=False)
+
+    expander.add(vbox)
+    p_vbox.pack_start(expander, expand=False)
+    p_vbox.show_all()
+
+    return ext
+
 def extensions(self):
     import plugins.extensions
     user_extensions_path = os.path.join(self.locations['home'], 'lib', 'extensions')
@@ -491,18 +568,11 @@
 
     for ext_name in plugins.extensions.by_name:
         ext_module = plugins.extensions.by_name[ext_name]
-        if ext_module.enabled:
-            try:
-                ext = ext_module(self)
-                self.extensions.append(ext)
-            except (NotImplementedError, DeprecationWarning), e:
-                log.warning('extension skipped: %s', e.message)
-                log.debug('extension skipped: %s', ext_module.__file__)
-                continue
-            if ext_module.toolbar_icon:
-                toolbar = self.widgets['extensions']['toolbar']
-                i = ext_module.toolbar_icon
-                ext.toolbar_icon_widget = toolbar.insert_stock(ext_module.toolbar_icon, ext_module.description, None, ext._on_toolbar_icon_clicked, None, -1)
+        enabled = ext_module.enabled
+        # TODO: get list of disabled extensions from config
+        ext = extension(self, ext_module, enabled)
+        if ext:
+            self.extensions.append(ext)
 
 def people_treeview(self, create=True):
     row = None
@@ -635,9 +705,9 @@
     self._regions = (
         _('Region 0 (No Region Coding)'),
         _('Region 1 (United States of America, Canada)'),
-        _('Region 2 (Europe,including France, Greece, Turkey, Egypt, Arabia, Japan and South Africa)'),
+        _('Region 2 (Europe, Egypt, Arabia, Japan and South Africa)'),
         _('Region 3 (Korea, Thailand, Vietnam, Borneo and Indonesia)'),
-        _('Region 4 (Australia and New Zealand, Mexico, the Caribbean, and South America)'),
+        _('Region 4 (Australia and New Zealand, Mexico and South America)'),
         _('Region 5 (India, Africa, Russia and former USSR countries)'),
         _('Region 6 (Popular Republic of China)'),
         _('Region 7 (Reserved for Unspecified Special Use)'),

Modified: trunk/lib/plugins/extensions/__init__.py
===================================================================
--- trunk/lib/plugins/extensions/__init__.py	2009-08-11 22:01:14 UTC (rev 1276)
+++ trunk/lib/plugins/extensions/__init__.py	2009-08-12 21:56:47 UTC (rev 1277)
@@ -43,7 +43,7 @@
     :attr preferences: dictionary used to generate new widgets in preferences window
         every key points to another dictionary that contains:
         * name: will be shown to user
-        * type: int or unicode (type) or list (instance)
+        * type: int, unicode (type) or list, tuple, dict (instance)
         * min: minimum value (int) or length (unicode)
         * max: maximum value (int) or length (unicode)
     :attr app: application reference (use only if really needed)

Modified: trunk/lib/plugins/extensions/ge_amazon.py
===================================================================
--- trunk/lib/plugins/extensions/ge_amazon.py	2009-08-11 22:01:14 UTC (rev 1276)
+++ trunk/lib/plugins/extensions/ge_amazon.py	2009-08-12 21:56:47 UTC (rev 1277)
@@ -48,7 +48,7 @@
     api = 1
 
     preferences = {'locale': {'name': _('Select source'),
-                              'type': ('US', 'UK', 'DE', 'CA', 'FR', 'JP')}}
+                              'type': (u'US', u'UK', u'DE', u'CA', u'FR', u'JP')}}
     toolbar_icon = 'gtk-network'
 
     def toolbar_icon_clicked(self, widget, movie):

Modified: trunk/lib/preferences.py
===================================================================
--- trunk/lib/preferences.py	2009-08-11 22:01:14 UTC (rev 1276)
+++ trunk/lib/preferences.py	2009-08-12 21:56:47 UTC (rev 1277)
@@ -200,8 +200,6 @@
 
     w['spell_lang'].set_text(str(self.config.get('lang', 'en', section='spell')))
 
-    w['amazon_locale'].set_active(int(self.config.get('amazon_locale', 0, section='add')))
-
     if page is not None:
         w['notebook'].set_current_page(page)
     w['window'].show()

Modified: trunk/lib/widgets.py
===================================================================
--- trunk/lib/widgets.py	2009-08-11 22:01:14 UTC (rev 1276)
+++ trunk/lib/widgets.py	2009-08-12 21:56:47 UTC (rev 1277)
@@ -347,6 +347,7 @@
     }#}}}
     self.widgets['extensions'] = {
         'toolbar': get('ext_toolbar'),
+        'preferences_vbox': get('p_extensions_vbox'),
     }
     
     self.widgets['w_loan_to']     = get('w_loan_to')


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000744.html">[Griffith-svn] r1276 - trunk/lib/plugins/extensions
</A></li>
	<LI>Next message: <A HREF="000746.html">[Griffith-svn] r1278 - in trunk: . lib lib/plugins/extensions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#745">[ date ]</a>
              <a href="thread.html#745">[ thread ]</a>
              <a href="subject.html#745">[ subject ]</a>
              <a href="author.html#745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/griffith-svn">More information about the Griffith-svn
mailing list</a><br>
</body></html>
